{
  "nodes": [
    {
      "content": "Azure Security Guidance",
      "pos": [
        1,
        24
      ]
    },
    {
      "content": "Abstract",
      "pos": [
        28,
        36
      ]
    },
    {
      "content": "When developing applications for Azure, identity and",
      "pos": [
        38,
        90
      ]
    },
    {
      "content": "access are the primary security concerns that you need to keep in mind.",
      "pos": [
        91,
        162
      ]
    },
    {
      "content": "This topic explains the key security concerns related to identity and access in the cloud and how you",
      "pos": [
        163,
        264
      ]
    },
    {
      "content": "can best protect your cloud applications.",
      "pos": [
        265,
        306
      ]
    },
    {
      "content": "Overview",
      "pos": [
        310,
        318
      ]
    },
    {
      "content": "An application's security is a function of its surface.",
      "pos": [
        320,
        375
      ]
    },
    {
      "content": "The more surface",
      "pos": [
        376,
        392
      ]
    },
    {
      "content": "that the application exposes the greater the security concerns.",
      "pos": [
        393,
        456
      ]
    },
    {
      "content": "For",
      "pos": [
        457,
        460
      ]
    },
    {
      "content": "example, an application that runs as an unattended batch process exposes",
      "pos": [
        461,
        533
      ]
    },
    {
      "content": "less, from a security perspective, than a publicly available website.",
      "pos": [
        534,
        603
      ]
    },
    {
      "content": "When you move to the cloud you gain a certain peace of mind about",
      "pos": [
        605,
        670
      ]
    },
    {
      "content": "infrastructure and networking since these are managed in data centers",
      "pos": [
        671,
        740
      ]
    },
    {
      "content": "with world-class security practices, tools, technology.",
      "pos": [
        741,
        796
      ]
    },
    {
      "content": "On the other",
      "pos": [
        797,
        809
      ]
    },
    {
      "content": "hand, the cloud intrinsically exposes more surface area for your",
      "pos": [
        810,
        874
      ]
    },
    {
      "content": "application that can be potentially exploited by attackers.",
      "pos": [
        875,
        934
      ]
    },
    {
      "content": "This is",
      "pos": [
        935,
        942
      ]
    },
    {
      "content": "because many cloud technologies and services are exposed as end points",
      "pos": [
        943,
        1013
      ]
    },
    {
      "content": "vs. in-memory components.",
      "pos": [
        1014,
        1039
      ]
    },
    {
      "content": "Azure storage, Service Bus, SQL",
      "pos": [
        1040,
        1071
      ]
    },
    {
      "content": "Database (formerly SQL Azure), and many other services are accessible",
      "pos": [
        1072,
        1141
      ]
    },
    {
      "content": "via their endpoints over the wire.",
      "pos": [
        1142,
        1176
      ]
    },
    {
      "content": "In cloud applications more responsibility lays on the shoulders of the",
      "pos": [
        1178,
        1248
      ]
    },
    {
      "content": "application developers to design, develop, and maintain their cloud",
      "pos": [
        1249,
        1316
      ]
    },
    {
      "content": "applications to high security standards to keep attackers at bay.",
      "pos": [
        1317,
        1382
      ]
    },
    {
      "content": "Consider the following diagram (from J.D.",
      "pos": [
        1383,
        1424
      ]
    },
    {
      "content": "Meier's <bpt id=\"p1\">[</bpt>Azure Security\nNotes PDF<ept id=\"p1\">](http://blogs.msdn.com/b/jmeier/archive/2010/08/03/now-available-azure-security-notes-pdf.aspx)</ept>): notice how the infrastructure part is being addressed by the",
      "pos": [
        1425,
        1617
      ]
    },
    {
      "content": "cloud provider--in our case by Azure--leaving more security work",
      "pos": [
        1618,
        1682
      ]
    },
    {
      "content": "to the application developers:",
      "pos": [
        1683,
        1713
      ]
    },
    {
      "content": "Securing the application",
      "pos": [
        1717,
        1741
      ]
    },
    {
      "content": "The good news is that all of the security development practices,",
      "pos": [
        1748,
        1812
      ]
    },
    {
      "content": "principles, and techniques you already know still apply when developing",
      "pos": [
        1813,
        1884
      ]
    },
    {
      "content": "cloud applications.",
      "pos": [
        1885,
        1904
      ]
    },
    {
      "content": "Consider the following key areas that must be",
      "pos": [
        1905,
        1950
      ]
    },
    {
      "content": "addressed:",
      "pos": [
        1951,
        1961
      ]
    },
    {
      "pos": [
        1967,
        2131
      ],
      "content": "All input is validated for type, length, range, and string patterns\nto avoid injection attacks, and all the data your app echoes back is\nproperly sanitized.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "All input is validated for type, length, range, and string patterns",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "to avoid injection attacks, and all the data your app echoes back is",
          "pos": [
            68,
            136
          ]
        },
        {
          "content": "properly sanitized.",
          "pos": [
            137,
            156
          ]
        }
      ]
    },
    {
      "pos": [
        2136,
        2261
      ],
      "content": "Sensitive data should be protected at rest and on the wire to\nmitigate information disclosure and data tampering threats.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Sensitive data should be protected at rest and on the wire to",
          "pos": [
            0,
            61
          ]
        },
        {
          "content": "mitigate information disclosure and data tampering threats.",
          "pos": [
            62,
            121
          ]
        }
      ]
    },
    {
      "pos": [
        2266,
        2356
      ],
      "content": "Auditing and logging must be properly implemented to mitigate non\nrepudiation threats.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Auditing and logging must be properly implemented to mitigate non",
          "pos": [
            0,
            65
          ]
        },
        {
          "content": "repudiation threats.",
          "pos": [
            66,
            86
          ]
        }
      ]
    },
    {
      "pos": [
        2361,
        2537
      ],
      "content": "Authentication and Authorization should be implemented using proven\nmechanisms offered by the platform to prevent identity spoofing and\nelevation of privileges threats.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "Authentication and Authorization should be implemented using proven",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "mechanisms offered by the platform to prevent identity spoofing and",
          "pos": [
            68,
            135
          ]
        },
        {
          "content": "elevation of privileges threats.",
          "pos": [
            136,
            168
          ]
        }
      ]
    },
    {
      "content": "For a complete list of threats, attacks, vulnerabilities, and",
      "pos": [
        2539,
        2600
      ]
    },
    {
      "content": "countermeasures refer to patterns &amp; practices' <bpt id=\"p1\">[</bpt>Cheat Sheet: Web\nApplication Security Frame<ept id=\"p1\">](http://msdn.microsoft.com/library/ff649461.aspx)</ept> and <bpt id=\"p2\">[</bpt>Security Guidance for Applications Index<ept id=\"p2\">](http://msdn.microsoft.com/library/ff650760.aspx)</ept>.",
      "pos": [
        2601,
        2839
      ]
    },
    {
      "content": "In the cloud, authentication and access control mechanisms are very",
      "pos": [
        2841,
        2908
      ]
    },
    {
      "content": "different than those available for on-premises applications.",
      "pos": [
        2909,
        2969
      ]
    },
    {
      "content": "There are",
      "pos": [
        2970,
        2979
      ]
    },
    {
      "content": "many more authentication and access options offered for cloud",
      "pos": [
        2980,
        3041
      ]
    },
    {
      "content": "applications that can lead to confusion, and as a result, to flawed",
      "pos": [
        3042,
        3109
      ]
    },
    {
      "content": "implementations.",
      "pos": [
        3110,
        3126
      ]
    },
    {
      "content": "More confusion is introduced when defining what a cloud",
      "pos": [
        3127,
        3182
      ]
    },
    {
      "content": "app is.",
      "pos": [
        3183,
        3190
      ]
    },
    {
      "content": "For example, the application could be deployed to the cloud yet",
      "pos": [
        3191,
        3254
      ]
    },
    {
      "content": "its authentication mechanism might be provided by Active Directory.",
      "pos": [
        3255,
        3322
      ]
    },
    {
      "content": "On",
      "pos": [
        3323,
        3325
      ]
    },
    {
      "content": "other hand, the application could be deployed on-premises but with",
      "pos": [
        3326,
        3392
      ]
    },
    {
      "content": "authentication mechanisms in the cloud (for example, by Azure",
      "pos": [
        3393,
        3454
      ]
    },
    {
      "content": "Active Directory Access Control (previously known as Access Control",
      "pos": [
        3455,
        3522
      ]
    },
    {
      "content": "Service or ACS)).",
      "pos": [
        3523,
        3540
      ]
    },
    {
      "content": "Threats, Vulnerabilities, and Attacks",
      "pos": [
        3544,
        3581
      ]
    },
    {
      "content": "A threat is a potential bad outcome that you want to avoid such as the",
      "pos": [
        3583,
        3653
      ]
    },
    {
      "content": "disclosure of sensitive information or a service becoming unavailable.",
      "pos": [
        3654,
        3724
      ]
    },
    {
      "content": "It is common practice to classify threats by using the acronym \"STRIDE\":",
      "pos": [
        3725,
        3797
      ]
    },
    {
      "pos": [
        3803,
        3833
      ],
      "content": "<bpt id=\"p1\">**</bpt>S<ept id=\"p1\">**</ept>poofing or identity theft"
    },
    {
      "pos": [
        3838,
        3861
      ],
      "content": "<bpt id=\"p1\">**</bpt>T<ept id=\"p1\">**</ept>ampering with data"
    },
    {
      "pos": [
        3866,
        3892
      ],
      "content": "<bpt id=\"p1\">**</bpt>R<ept id=\"p1\">**</ept>epudiation of actions"
    },
    {
      "pos": [
        3897,
        3923
      ],
      "content": "<bpt id=\"p1\">**</bpt>I<ept id=\"p1\">**</ept>nformation disclosure"
    },
    {
      "pos": [
        3928,
        3949
      ],
      "content": "<bpt id=\"p1\">**</bpt>D<ept id=\"p1\">**</ept>enial of service"
    },
    {
      "pos": [
        3954,
        3981
      ],
      "content": "<bpt id=\"p1\">**</bpt>E<ept id=\"p1\">**</ept>levation of privileges"
    },
    {
      "content": "Vulnerabilities are bugs that we, as developers, introduce into the code",
      "pos": [
        3983,
        4055
      ]
    },
    {
      "content": "that make an application exploitable by attackers.",
      "pos": [
        4056,
        4106
      ]
    },
    {
      "content": "For example, sending",
      "pos": [
        4107,
        4127
      ]
    },
    {
      "content": "sensitive data in clear text makes an information disclosure threat",
      "pos": [
        4128,
        4195
      ]
    },
    {
      "content": "possible by a traffic sniffing attack.",
      "pos": [
        4196,
        4234
      ]
    },
    {
      "content": "Attacks are the exploitation of those vulnerabilities to cause harm to",
      "pos": [
        4236,
        4306
      ]
    },
    {
      "content": "an application.",
      "pos": [
        4307,
        4322
      ]
    },
    {
      "content": "For example, a Cross Site Scripting, or XSS, is an",
      "pos": [
        4323,
        4373
      ]
    },
    {
      "content": "attack that exploits unsanitized output.",
      "pos": [
        4374,
        4414
      ]
    },
    {
      "content": "Another example is",
      "pos": [
        4415,
        4433
      ]
    },
    {
      "content": "eavesdropping on the wire to capture credentials sent in clear.",
      "pos": [
        4434,
        4497
      ]
    },
    {
      "content": "These",
      "pos": [
        4498,
        4503
      ]
    },
    {
      "content": "attacks can lead to an identity spoof threat being realized.",
      "pos": [
        4504,
        4564
      ]
    },
    {
      "content": "To make it",
      "pos": [
        4565,
        4575
      ]
    },
    {
      "content": "simple consider threats, vulnerabilities, and attacks as bad things.",
      "pos": [
        4576,
        4644
      ]
    },
    {
      "content": "Consider the following diagrams as a balcony view of the bad things",
      "pos": [
        4645,
        4712
      ]
    },
    {
      "content": "related to a Web application deployed to Azure (from J.D.",
      "pos": [
        4713,
        4770
      ]
    },
    {
      "content": "Meier's <bpt id=\"p1\">[</bpt>Azure Security Notes PDF<ept id=\"p1\">](http://blogs.msdn.com/b/jmeier/archive/2010/08/03/now-available-azure-security-notes-pdf.aspx)</ept>):",
      "pos": [
        4771,
        4902
      ]
    },
    {
      "content": "Threats Vulnerabilities and Attacks",
      "pos": [
        4906,
        4941
      ]
    },
    {
      "content": "You, as a developer, have control over the vulnerabilities.",
      "pos": [
        4948,
        5007
      ]
    },
    {
      "content": "The fewer",
      "pos": [
        5008,
        5017
      ]
    },
    {
      "content": "vulnerabilities that you introduce, the fewer options that are left to",
      "pos": [
        5018,
        5088
      ]
    },
    {
      "content": "attacker to exploit.",
      "pos": [
        5089,
        5109
      ]
    },
    {
      "content": "Identity and access related vulnerabilities leave you open to all",
      "pos": [
        5111,
        5176
      ]
    },
    {
      "content": "threats in the STRIDE model.",
      "pos": [
        5177,
        5205
      ]
    },
    {
      "content": "For example, an improperly implemented",
      "pos": [
        5206,
        5244
      ]
    },
    {
      "content": "authentication mechanism may lead to an identity spoof and, as a result,",
      "pos": [
        5245,
        5317
      ]
    },
    {
      "content": "information disclosure, data tampering, elevated privileges operations,",
      "pos": [
        5318,
        5389
      ]
    },
    {
      "content": "or even shutting down the service altogether.",
      "pos": [
        5390,
        5435
      ]
    },
    {
      "content": "Consider the following",
      "pos": [
        5436,
        5458
      ]
    },
    {
      "content": "questions that may point to potential vulnerabilities in your cloud",
      "pos": [
        5459,
        5526
      ]
    },
    {
      "content": "app's identity and access implementation:",
      "pos": [
        5527,
        5568
      ]
    },
    {
      "pos": [
        5574,
        5652
      ],
      "content": "Are you sending credentials in clear over the wire to your\nAzure services?",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Are you sending credentials in clear over the wire to your",
          "pos": [
            0,
            58
          ]
        },
        {
          "content": "Azure services?",
          "pos": [
            59,
            74
          ]
        }
      ]
    },
    {
      "content": "Do you store Azure services credentials in clear?",
      "pos": [
        5657,
        5706
      ]
    },
    {
      "pos": [
        5711,
        5782
      ],
      "content": "Do your Azure services credentials follow strong password\npolicies?",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Do your Azure services credentials follow strong password",
          "pos": [
            0,
            57
          ]
        },
        {
          "content": "policies?",
          "pos": [
            58,
            67
          ]
        }
      ]
    },
    {
      "pos": [
        5787,
        5875
      ],
      "content": "Do you rely on Azure to verify credentials vs.\nusing custom verification mechanisms?",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Do you rely on Azure to verify credentials vs.",
          "pos": [
            0,
            46
          ]
        },
        {
          "content": "using custom verification mechanisms?",
          "pos": [
            47,
            84
          ]
        }
      ]
    },
    {
      "pos": [
        5880,
        5982
      ],
      "content": "Do you limit Azure services authentication sessions or token\nlifetime to a reasonable time window?",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Do you limit Azure services authentication sessions or token",
          "pos": [
            0,
            60
          ]
        },
        {
          "content": "lifetime to a reasonable time window?",
          "pos": [
            61,
            98
          ]
        }
      ]
    },
    {
      "pos": [
        5987,
        6074
      ],
      "content": "Do you verify permissions for each Azure entry point of your\ndistributed cloud app?",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Do you verify permissions for each Azure entry point of your",
          "pos": [
            0,
            60
          ]
        },
        {
          "content": "distributed cloud app?",
          "pos": [
            61,
            83
          ]
        }
      ]
    },
    {
      "pos": [
        6079,
        6208
      ],
      "content": "Does your authorization mechanism fail securely without exposing\nsensitive information, or without allowing limitless access?",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Does your authorization mechanism fail securely without exposing",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "sensitive information, or without allowing limitless access?",
          "pos": [
            65,
            125
          ]
        }
      ]
    },
    {
      "content": "Countermeasures",
      "pos": [
        6212,
        6227
      ]
    },
    {
      "content": "The best countermeasure against an attack is by using the identity and",
      "pos": [
        6229,
        6299
      ]
    },
    {
      "content": "access mechanisms offered by the platform rather than implementing your",
      "pos": [
        6300,
        6371
      ]
    },
    {
      "content": "own.",
      "pos": [
        6372,
        6376
      ]
    },
    {
      "content": "Consider the following prominent identity and access technologies:",
      "pos": [
        6377,
        6443
      ]
    },
    {
      "content": "Windows Identity Foundation (WIF).",
      "pos": [
        6447,
        6481
      ]
    },
    {
      "content": "WIF is a .NET runtime library",
      "pos": [
        6484,
        6513
      ]
    },
    {
      "content": "included with the .NET Framework 4.5 (it is also available as separate",
      "pos": [
        6514,
        6584
      ]
    },
    {
      "content": "download for .NET 3.5/4.0).",
      "pos": [
        6585,
        6612
      ]
    },
    {
      "content": "WIF does the heavy lifting for handling",
      "pos": [
        6613,
        6652
      ]
    },
    {
      "content": "protocols such as WS-Federation and WS-Trust and tokens handling such as",
      "pos": [
        6653,
        6725
      ]
    },
    {
      "content": "Security Assertion Markup Language (SAML) so you don't need to write",
      "pos": [
        6726,
        6794
      ]
    },
    {
      "content": "very complex security-related code in your application.",
      "pos": [
        6795,
        6850
      ]
    },
    {
      "content": "The following",
      "pos": [
        6851,
        6864
      ]
    },
    {
      "content": "resources provide in-depth information about WIF:",
      "pos": [
        6865,
        6914
      ]
    },
    {
      "pos": [
        6920,
        7136
      ],
      "content": "<bpt id=\"p1\">[</bpt>Windows Identity Foundation 4.5 Samples<ept id=\"p1\">](http://code.msdn.microsoft.com/site/search?f%5B0%5D.Type=SearchText&amp;f%5B0%5D.Value=wif&amp;f%5B1%5D.Type=Topic&amp;f%5B1%5D.Value=claims-based%20authentication)</ept> on MSDN Code Gallery."
    },
    {
      "pos": [
        7141,
        7316
      ],
      "content": "[Windows Identity Foundation 4.5 tools for Visual Studio 11 Beta](http://visualstudiogallery.msdn.microsoft.com/e21bf653-dfe1-4d81-b3d3-795cb104066e) on\nMSDN Code Gallery.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">[</bpt>Windows Identity Foundation 4.5 tools for Visual Studio 11 Beta<ept id=\"p1\">](http://visualstudiogallery.msdn.microsoft.com/e21bf653-dfe1-4d81-b3d3-795cb104066e)</ept> on",
          "pos": [
            0,
            152
          ]
        },
        {
          "content": "MSDN Code Gallery.",
          "pos": [
            153,
            171
          ]
        }
      ]
    },
    {
      "pos": [
        7321,
        7439
      ],
      "content": "<bpt id=\"p1\">[</bpt>Windows Identity Foundation runtime (.Net 3.5/4.0)<ept id=\"p1\">](http://www.microsoft.com/download/details.aspx?id=17331)</ept> on MSDN."
    },
    {
      "pos": [
        7444,
        7611
      ],
      "content": "<bpt id=\"p1\">[</bpt>Windows Identity Foundation 3.5/4.0 samples and Visual Studio\n2008/2010 templates<ept id=\"p1\">](http://www.microsoft.com/download/details.aspx?displaylang=en&amp;id=4451)</ept> on MSDN.",
      "leadings": [
        "",
        "    "
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Azure AD Access Control (previously known as ACS)<ept id=\"p1\">**</ept>.",
      "pos": [
        7613,
        7667
      ]
    },
    {
      "content": "Azure AD Access Control is a cloud service that provides Security Token",
      "pos": [
        7669,
        7740
      ]
    },
    {
      "content": "Service (STS) and allows federation with different identity providers",
      "pos": [
        7741,
        7810
      ]
    },
    {
      "content": "(IdPs) such as a corporate Active Directory or Internet IdPs such as",
      "pos": [
        7811,
        7879
      ]
    },
    {
      "content": "Windows Live ID / Microsoft Account, Facebook, Google, Yahoo!, and Open",
      "pos": [
        7880,
        7951
      ]
    },
    {
      "content": "ID 2.0 identity providers.",
      "pos": [
        7952,
        7978
      ]
    },
    {
      "content": "The following resources provide in-depth",
      "pos": [
        7979,
        8019
      ]
    },
    {
      "content": "information about Azure AD Access Control:",
      "pos": [
        8020,
        8062
      ]
    },
    {
      "content": "Access Control Service 2.0",
      "pos": [
        8069,
        8095
      ]
    },
    {
      "content": "Scenarios and Solutions Using ACS",
      "pos": [
        8152,
        8185
      ]
    },
    {
      "content": "ACS How To's",
      "pos": [
        8241,
        8253
      ]
    },
    {
      "content": "A Guide to Claims-Based Identity and Access Control",
      "pos": [
        8322,
        8373
      ]
    },
    {
      "content": "Identity Developer Training Kit",
      "pos": [
        8429,
        8460
      ]
    },
    {
      "content": "MSDN-hosted Identity Developer Training Course",
      "pos": [
        8524,
        8570
      ]
    },
    {
      "content": "Active Directory Federation Services (AD FS).",
      "pos": [
        8625,
        8670
      ]
    },
    {
      "content": "Active Directory",
      "pos": [
        8672,
        8688
      ]
    },
    {
      "content": "Federation Services (AD FS) 2.0 provides support for claims-aware",
      "pos": [
        8689,
        8754
      ]
    },
    {
      "content": "identity solutions that involve Windows Server??",
      "pos": [
        8755,
        8803
      ]
    },
    {
      "content": "and Active Directory",
      "pos": [
        8804,
        8824
      ]
    },
    {
      "content": "technology.",
      "pos": [
        8825,
        8836
      ]
    },
    {
      "content": "AD FS 2.0 supports the WS-Trust, WS-Federation, and SAML",
      "pos": [
        8837,
        8893
      ]
    },
    {
      "content": "protocols.",
      "pos": [
        8894,
        8904
      ]
    },
    {
      "content": "The following resources provide in-depth information about AD",
      "pos": [
        8905,
        8966
      ]
    },
    {
      "content": "FS:",
      "pos": [
        8967,
        8970
      ]
    },
    {
      "content": "AD FS 2.0 Content Map",
      "pos": [
        8977,
        8998
      ]
    },
    {
      "content": "Web SSO Design",
      "pos": [
        9097,
        9111
      ]
    },
    {
      "content": "Federated Web SSO Design",
      "pos": [
        9134,
        9158
      ]
    },
    {
      "content": "Azure Shared Access Signatures.",
      "pos": [
        9189,
        9220
      ]
    },
    {
      "content": "Shared Access Signatures",
      "pos": [
        9223,
        9247
      ]
    },
    {
      "content": "enable you to fine-tune access to a blob or container resource.",
      "pos": [
        9248,
        9311
      ]
    },
    {
      "content": "The",
      "pos": [
        9312,
        9315
      ]
    },
    {
      "content": "following resources provide in-depth information about Shared Access",
      "pos": [
        9316,
        9384
      ]
    },
    {
      "content": "Signatures.",
      "pos": [
        9385,
        9396
      ]
    },
    {
      "content": "Managing Access to Blobs and Containers",
      "pos": [
        9403,
        9442
      ]
    },
    {
      "content": "New Storage Feature: Shared Access Signatures",
      "pos": [
        9498,
        9543
      ]
    },
    {
      "content": "Shared Access Signatures Are Easy These Days",
      "pos": [
        9624,
        9668
      ]
    },
    {
      "content": "Scenarios Map",
      "pos": [
        9747,
        9760
      ]
    },
    {
      "content": "This section briefly outlines the key scenarios covered in this topic.",
      "pos": [
        9762,
        9832
      ]
    },
    {
      "content": "Use it as a map to determine the right identity solution for your",
      "pos": [
        9833,
        9898
      ]
    },
    {
      "content": "application.",
      "pos": [
        9899,
        9911
      ]
    },
    {
      "pos": [
        9917,
        10191
      ],
      "content": "**ASP.NET Web Form Application with Federated Authentication.** In\nthis scenario you control access to your ASP.NET Web Forms app using\neither Internet identity such as Live ID / Microsoft Account or\ncorporate identity managed in Windows Server Active Directory.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**ASP.NET Web Form Application with Federated Authentication.** In",
          "pos": [
            0,
            66
          ],
          "nodes": [
            {
              "content": "ASP.NET Web Form Application with Federated Authentication.",
              "pos": [
                2,
                61
              ]
            },
            {
              "content": "In",
              "pos": [
                64,
                66
              ]
            }
          ]
        },
        {
          "content": "this scenario you control access to your ASP.NET Web Forms app using",
          "pos": [
            67,
            135
          ]
        },
        {
          "content": "either Internet identity such as Live ID / Microsoft Account or",
          "pos": [
            136,
            199
          ]
        },
        {
          "content": "corporate identity managed in Windows Server Active Directory.",
          "pos": [
            200,
            262
          ]
        }
      ]
    },
    {
      "pos": [
        10196,
        10380
      ],
      "content": "**WCF (SOAP) Service with Federated Authentication.**In this\nscenario you control access to your WCF (SOAP) service using Service\nIdentities managed by Azure AD Access Control.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**WCF (SOAP) Service with Federated Authentication.**In this",
          "pos": [
            0,
            60
          ],
          "nodes": [
            {
              "content": "WCF (SOAP) Service with Federated Authentication.",
              "pos": [
                2,
                51
              ]
            },
            {
              "content": "In this",
              "pos": [
                53,
                60
              ]
            }
          ]
        },
        {
          "content": "scenario you control access to your WCF (SOAP) service using Service",
          "pos": [
            61,
            129
          ]
        },
        {
          "content": "Identities managed by Azure AD Access Control.",
          "pos": [
            130,
            176
          ]
        }
      ]
    },
    {
      "pos": [
        10385,
        10620
      ],
      "content": "**WCF (SOAP) Service with Federated Authentication, Identities in\nActive Directory.** In this scenario you control access to your WCF\n(SOAP) web service using identities managed by corporate Windows\nServer Active Directory.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>WCF (SOAP) Service with Federated Authentication, Identities in\nActive Directory.<ept id=\"p1\">**</ept> In this scenario you control access to your WCF",
          "pos": [
            0,
            133
          ]
        },
        {
          "content": "(SOAP) web service using identities managed by corporate Windows",
          "pos": [
            134,
            198
          ]
        },
        {
          "content": "Server Active Directory.",
          "pos": [
            199,
            223
          ]
        }
      ]
    },
    {
      "pos": [
        10625,
        10809
      ],
      "content": "**WCF (REST) Service With Federated Authentication.**In this\nscenario you control access to your WCF (REST) service using Service\nIdentities managed by Azure AD Access Control.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**WCF (REST) Service With Federated Authentication.**In this",
          "pos": [
            0,
            60
          ],
          "nodes": [
            {
              "content": "WCF (REST) Service With Federated Authentication.",
              "pos": [
                2,
                51
              ]
            },
            {
              "content": "In this",
              "pos": [
                53,
                60
              ]
            }
          ]
        },
        {
          "content": "scenario you control access to your WCF (REST) service using Service",
          "pos": [
            61,
            129
          ]
        },
        {
          "content": "Identities managed by Azure AD Access Control.",
          "pos": [
            130,
            176
          ]
        }
      ]
    },
    {
      "pos": [
        10814,
        11041
      ],
      "content": "**WCF (REST) Service With Live ID / Microsoft Account, Facebook,\nGoogle, Yahoo!, Open ID.** In this scenario you control access to\nyour WCF (REST) service using Internet identity such as Live ID /\nMicrosoft Account.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>WCF (REST) Service With Live ID / Microsoft Account, Facebook,\nGoogle, Yahoo!, Open ID.<ept id=\"p1\">**</ept> In this scenario you control access to",
          "pos": [
            0,
            130
          ]
        },
        {
          "content": "your WCF (REST) service using Internet identity such as Live ID /",
          "pos": [
            131,
            196
          ]
        },
        {
          "content": "Microsoft Account.",
          "pos": [
            197,
            215
          ]
        }
      ]
    },
    {
      "pos": [
        11046,
        11294
      ],
      "content": "**ASP.NET Web App to REST WCF Service Using Shared SWT Token.** In\nthis scenario you have distributed application with front end\nASP.NET web app and downstream REST service and you want to flow end\nuser's context through physical tiers.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**ASP.NET Web App to REST WCF Service Using Shared SWT Token.** In",
          "pos": [
            0,
            66
          ],
          "nodes": [
            {
              "content": "ASP.NET Web App to REST WCF Service Using Shared SWT Token.",
              "pos": [
                2,
                61
              ]
            },
            {
              "content": "In",
              "pos": [
                64,
                66
              ]
            }
          ]
        },
        {
          "content": "this scenario you have distributed application with front end",
          "pos": [
            67,
            128
          ]
        },
        {
          "content": "ASP.NET web app and downstream REST service and you want to flow end",
          "pos": [
            129,
            197
          ]
        },
        {
          "content": "user's context through physical tiers.",
          "pos": [
            198,
            236
          ]
        }
      ]
    },
    {
      "pos": [
        11299,
        11487
      ],
      "content": "**Role-Based Access Control (RBAC) Authorization In Claims-Aware\nApplications and Services.** In this scenario you want to implement\nauthorization logic in your app based on roles.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Role-Based Access Control (RBAC) Authorization In Claims-Aware\nApplications and Services.<ept id=\"p1\">**</ept> In this scenario you want to implement",
          "pos": [
            0,
            132
          ]
        },
        {
          "content": "authorization logic in your app based on roles.",
          "pos": [
            133,
            180
          ]
        }
      ]
    },
    {
      "pos": [
        11492,
        11682
      ],
      "content": "**Claims-Based Authorization In Claims-Aware Applications and\nServices.** In this scenario you want to implement authorization\nlogic in your app based on complex authorization rules.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Claims-Based Authorization In Claims-Aware Applications and\nServices.<ept id=\"p1\">**</ept> In this scenario you want to implement authorization",
          "pos": [
            0,
            126
          ]
        },
        {
          "content": "logic in your app based on complex authorization rules.",
          "pos": [
            127,
            182
          ]
        }
      ]
    },
    {
      "pos": [
        11687,
        11840
      ],
      "content": "**Azure Storage Service Identity and Access Scenarios.**In\nthis scenario you need to securely share access to Azure\nstorage blobs and containers.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Azure Storage Service Identity and Access Scenarios.**In",
          "pos": [
            0,
            58
          ],
          "nodes": [
            {
              "content": "Azure Storage Service Identity and Access Scenarios.",
              "pos": [
                2,
                54
              ]
            },
            {
              "content": "In",
              "pos": [
                56,
                58
              ]
            }
          ]
        },
        {
          "content": "this scenario you need to securely share access to Azure",
          "pos": [
            59,
            115
          ]
        },
        {
          "content": "storage blobs and containers.",
          "pos": [
            116,
            145
          ]
        }
      ]
    },
    {
      "pos": [
        11845,
        12123
      ],
      "content": "**Azure SQL Database Identity and Access Scenarios.**SQL\nDatabase supports only SQL Server Authentication. Windows\nAuthentication (integrated security) is not supported. Users must\nprovide credentials (login and password) every time they connect to\nSQL Database.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Azure SQL Database Identity and Access Scenarios.**SQL",
          "pos": [
            0,
            56
          ],
          "nodes": [
            {
              "content": "Azure SQL Database Identity and Access Scenarios.",
              "pos": [
                2,
                51
              ]
            },
            {
              "content": "SQL",
              "pos": [
                53,
                56
              ]
            }
          ]
        },
        {
          "content": "Database supports only SQL Server Authentication. Windows",
          "pos": [
            57,
            114
          ],
          "nodes": [
            {
              "content": "Database supports only SQL Server Authentication.",
              "pos": [
                0,
                49
              ]
            },
            {
              "content": "Windows",
              "pos": [
                50,
                57
              ]
            }
          ]
        },
        {
          "content": "Authentication (integrated security) is not supported. Users must",
          "pos": [
            115,
            180
          ],
          "nodes": [
            {
              "content": "Authentication (integrated security) is not supported.",
              "pos": [
                0,
                54
              ]
            },
            {
              "content": "Users must",
              "pos": [
                55,
                65
              ]
            }
          ]
        },
        {
          "content": "provide credentials (login and password) every time they connect to",
          "pos": [
            181,
            248
          ]
        },
        {
          "content": "SQL Database.",
          "pos": [
            249,
            262
          ]
        }
      ]
    },
    {
      "pos": [
        12128,
        12251
      ],
      "content": "**Azure Service Bus Identity and Access Scenarios.**In this\nscenario you need securely access Azure Service Bus queues.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "**Azure Service Bus Identity and Access Scenarios.**In this",
          "pos": [
            0,
            59
          ],
          "nodes": [
            {
              "content": "Azure Service Bus Identity and Access Scenarios.",
              "pos": [
                2,
                50
              ]
            },
            {
              "content": "In this",
              "pos": [
                52,
                59
              ]
            }
          ]
        },
        {
          "content": "scenario you need securely access Azure Service Bus queues.",
          "pos": [
            60,
            119
          ]
        }
      ]
    },
    {
      "pos": [
        12256,
        12387
      ],
      "content": "**In-Memory Cache Identity and Access Scenarios.**In this scenario\nyou need to securely access data managed by in-memory cache.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "**In-Memory Cache Identity and Access Scenarios.**In this scenario",
          "pos": [
            0,
            66
          ],
          "nodes": [
            {
              "content": "In-Memory Cache Identity and Access Scenarios.",
              "pos": [
                2,
                48
              ]
            },
            {
              "content": "In this scenario",
              "pos": [
                50,
                66
              ]
            }
          ]
        },
        {
          "content": "you need to securely access data managed by in-memory cache.",
          "pos": [
            67,
            127
          ]
        }
      ]
    },
    {
      "pos": [
        12392,
        12524
      ],
      "content": "**Azure Marketplace Identity and Access Scenarios.**In this\nscenario you need to securely access Azure Marketplace\ndatasets.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Azure Marketplace Identity and Access Scenarios.**In this",
          "pos": [
            0,
            59
          ],
          "nodes": [
            {
              "content": "Azure Marketplace Identity and Access Scenarios.",
              "pos": [
                2,
                50
              ]
            },
            {
              "content": "In this",
              "pos": [
                52,
                59
              ]
            }
          ]
        },
        {
          "content": "scenario you need to securely access Azure Marketplace",
          "pos": [
            60,
            114
          ]
        },
        {
          "content": "datasets.",
          "pos": [
            115,
            124
          ]
        }
      ]
    },
    {
      "content": "Azure Identity and Access Scenarios",
      "pos": [
        12528,
        12563
      ]
    },
    {
      "content": "This section outlines common identity and access scenarios for different",
      "pos": [
        12565,
        12637
      ]
    },
    {
      "content": "application architectures.",
      "pos": [
        12638,
        12664
      ]
    },
    {
      "content": "Use the Scenarios Map for a quick",
      "pos": [
        12665,
        12698
      ]
    },
    {
      "content": "orientation.",
      "pos": [
        12699,
        12711
      ]
    },
    {
      "content": "ASP.NET Web Form Application with Federated Authentication",
      "pos": [
        12716,
        12774
      ]
    },
    {
      "content": "In this application architecture scenario your web application may be",
      "pos": [
        12776,
        12845
      ]
    },
    {
      "content": "deployed to Azure or on-premises.",
      "pos": [
        12846,
        12879
      ]
    },
    {
      "content": "The application requires that",
      "pos": [
        12880,
        12909
      ]
    },
    {
      "content": "its users will be authenticated by either corporate Active Directory or",
      "pos": [
        12910,
        12981
      ]
    },
    {
      "content": "Internet identity providers.",
      "pos": [
        12982,
        13010
      ]
    },
    {
      "content": "To solve this scenarios use Azure AD Access control and Windows",
      "pos": [
        13012,
        13075
      ]
    },
    {
      "content": "Identity Foundation.",
      "pos": [
        13076,
        13096
      ]
    },
    {
      "content": "Azure Active Directory Access control",
      "pos": [
        13100,
        13137
      ]
    },
    {
      "content": "Refer to the following resources to implement this scenario:",
      "pos": [
        13144,
        13204
      ]
    },
    {
      "content": "How To: Create My First Claims-Aware ASP.NET Application Using ACS",
      "pos": [
        13211,
        13277
      ]
    },
    {
      "content": "How To: Host Login Pages in Your ASP.NET Web Application",
      "pos": [
        13333,
        13389
      ]
    },
    {
      "content": "How To: Implement Claims Authorization in a Claims-Aware ASP.NET Application Using WIF and ACS",
      "pos": [
        13445,
        13539
      ]
    },
    {
      "pos": [
        13599,
        13709
      ],
      "content": "How To: Implement Role Based Access Control (RBAC) in a Claims-Aware\nASP.NET Application Using WIF and ACS",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Implement Role Based Access Control (RBAC) in a Claims-Aware",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "ASP.NET Application Using WIF and ACS",
          "pos": [
            69,
            106
          ]
        }
      ]
    },
    {
      "pos": [
        13765,
        13858
      ],
      "content": "How To: Configure Trust Between ACS and ASP.NET Web Applications\nUsing X.509 Certificates",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Configure Trust Between ACS and ASP.NET Web Applications",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "Using X.509 Certificates",
          "pos": [
            65,
            89
          ]
        }
      ]
    },
    {
      "content": "Code Sample: ASP.NET Simple Forms",
      "pos": [
        13914,
        13947
      ]
    },
    {
      "content": "WCF (SOAP) Service with Service Identity",
      "pos": [
        14002,
        14042
      ]
    },
    {
      "content": "In this application architecture scenario your WCF (SOAP) service may be",
      "pos": [
        14044,
        14116
      ]
    },
    {
      "content": "deployed to Azure or on-premises.",
      "pos": [
        14117,
        14150
      ]
    },
    {
      "content": "The service is being accessed",
      "pos": [
        14151,
        14180
      ]
    },
    {
      "content": "as a downstream service by a web application or even by another web",
      "pos": [
        14181,
        14248
      ]
    },
    {
      "content": "service.",
      "pos": [
        14249,
        14257
      ]
    },
    {
      "content": "You need to control access to it using application specific",
      "pos": [
        14258,
        14317
      ]
    },
    {
      "content": "identity.",
      "pos": [
        14318,
        14327
      ]
    },
    {
      "content": "Think of it in terms of the type of app pool account that you",
      "pos": [
        14328,
        14389
      ]
    },
    {
      "content": "used in IIS - although the technology is different, the approaches are",
      "pos": [
        14390,
        14460
      ]
    },
    {
      "content": "similar in that the service is accessed using an application scope",
      "pos": [
        14461,
        14527
      ]
    },
    {
      "content": "account vs. end user account.",
      "pos": [
        14528,
        14557
      ]
    },
    {
      "content": "Use the Service Identity feature in Azure AD Access control.",
      "pos": [
        14559,
        14619
      ]
    },
    {
      "content": "This is similar to the IIS app pool account you were using when",
      "pos": [
        14620,
        14683
      ]
    },
    {
      "content": "deploying your apps to Windows Server and IIS.",
      "pos": [
        14684,
        14730
      ]
    },
    {
      "content": "Configure Azure",
      "pos": [
        14731,
        14746
      ]
    },
    {
      "content": "AD Access Control to issue SAML tokens that will be handled by WIF at",
      "pos": [
        14747,
        14816
      ]
    },
    {
      "content": "the WCF (SOAP) service.",
      "pos": [
        14817,
        14840
      ]
    },
    {
      "content": "WCF (SOAP) Service",
      "pos": [
        14844,
        14862
      ]
    },
    {
      "content": "Refer to the following resources to implement this scenario:",
      "pos": [
        14870,
        14930
      ]
    },
    {
      "pos": [
        14937,
        15025
      ],
      "content": "How To: Add Service Identities with an X.509 Certificate, Password,\nor Symmetric Key",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Add Service Identities with an X.509 Certificate, Password,",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "or Symmetric Key",
          "pos": [
            68,
            84
          ]
        }
      ]
    },
    {
      "pos": [
        15081,
        15165
      ],
      "content": "How To: Authenticate with a Client Certificate to a WCF Service\nProtected by ACS",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Authenticate with a Client Certificate to a WCF Service",
          "pos": [
            0,
            63
          ]
        },
        {
          "content": "Protected by ACS",
          "pos": [
            64,
            80
          ]
        }
      ]
    },
    {
      "pos": [
        15221,
        15308
      ],
      "content": "How To: Authenticate with a Username and Password to a WCF Service\nProtected by ACS",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Authenticate with a Username and Password to a WCF Service",
          "pos": [
            0,
            66
          ]
        },
        {
          "content": "Protected by ACS",
          "pos": [
            67,
            83
          ]
        }
      ]
    },
    {
      "content": "Code Sample: WCF Certificate Authentication",
      "pos": [
        15364,
        15407
      ]
    },
    {
      "content": "Code Sample: WCF Username Authentication",
      "pos": [
        15463,
        15503
      ]
    },
    {
      "content": "WCF (SOAP) Service With Federated Authentication, Identities In Active Directory",
      "pos": [
        15558,
        15638
      ]
    },
    {
      "content": "In this application architecture scenario your WCF (SOAP) service may be",
      "pos": [
        15640,
        15712
      ]
    },
    {
      "content": "deployed to Azure or on-premises.",
      "pos": [
        15713,
        15746
      ]
    },
    {
      "content": "You need to control access to",
      "pos": [
        15747,
        15776
      ]
    },
    {
      "content": "it by using an identity that is managed by a corporate Windows Server",
      "pos": [
        15777,
        15846
      ]
    },
    {
      "content": "Active Directory (AD).",
      "pos": [
        15847,
        15869
      ]
    },
    {
      "content": "Use Azure AD Access Control configured for federation with",
      "pos": [
        15871,
        15929
      ]
    },
    {
      "content": "Windows Server AD FS.",
      "pos": [
        15930,
        15951
      ]
    },
    {
      "content": "In this case you do not need to configure Service",
      "pos": [
        15952,
        16001
      ]
    },
    {
      "content": "Identity with Azure AD Access Control.",
      "pos": [
        16002,
        16040
      ]
    },
    {
      "content": "The agent that needs to",
      "pos": [
        16041,
        16064
      ]
    },
    {
      "content": "access the WCF (SOAP) service provides credentials to AD FS and upon",
      "pos": [
        16065,
        16133
      ]
    },
    {
      "content": "successful authentication is issued the token by AD FS.",
      "pos": [
        16134,
        16189
      ]
    },
    {
      "content": "The token is",
      "pos": [
        16190,
        16202
      ]
    },
    {
      "content": "then submitted to Azure AD Access Control and reissued back to",
      "pos": [
        16203,
        16265
      ]
    },
    {
      "content": "the agent.",
      "pos": [
        16266,
        16276
      ]
    },
    {
      "content": "The agent uses the token to submit request to the WCF (SOAP)",
      "pos": [
        16277,
        16337
      ]
    },
    {
      "content": "service.",
      "pos": [
        16338,
        16346
      ]
    },
    {
      "content": "WCF (SOAP) Service With AD",
      "pos": [
        16350,
        16376
      ]
    },
    {
      "content": "Refer to the following resources to implement this scenario:",
      "pos": [
        16383,
        16443
      ]
    },
    {
      "pos": [
        16450,
        16538
      ],
      "content": "How To: Add Service Identities with an X.509 Certificate, Password,\nor Symmetric Key",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Add Service Identities with an X.509 Certificate, Password,",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "or Symmetric Key",
          "pos": [
            68,
            84
          ]
        }
      ]
    },
    {
      "content": "How To: Configure AD FS 2.0 as an Identity Provider",
      "pos": [
        16594,
        16645
      ]
    },
    {
      "pos": [
        16701,
        16793
      ],
      "content": "How To: Use Management Service to Configure AD FS 2.0 as an\nEnterprise Identity Provider",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Use Management Service to Configure AD FS 2.0 as an",
          "pos": [
            0,
            59
          ]
        },
        {
          "content": "Enterprise Identity Provider",
          "pos": [
            60,
            88
          ]
        }
      ]
    },
    {
      "content": "Code Sample: WCF Federated Authentication With AD FS 2.0",
      "pos": [
        16849,
        16905
      ]
    },
    {
      "content": "WCF (REST) Service With Service Identities",
      "pos": [
        16961,
        17003
      ]
    },
    {
      "content": "In this scenario your WCF (REST) service may be deployed to",
      "pos": [
        17005,
        17064
      ]
    },
    {
      "content": "Azure or on-premises.",
      "pos": [
        17066,
        17087
      ]
    },
    {
      "content": "The service is accessed as a downstream service by",
      "pos": [
        17088,
        17138
      ]
    },
    {
      "content": "a web application or by another web service.",
      "pos": [
        17139,
        17183
      ]
    },
    {
      "content": "You need to control access",
      "pos": [
        17184,
        17210
      ]
    },
    {
      "content": "to it using an application-specific identity Think of it in terms of the",
      "pos": [
        17211,
        17283
      ]
    },
    {
      "content": "type of app pool account that you used in IIS - although the technology",
      "pos": [
        17284,
        17355
      ]
    },
    {
      "content": "is different, the approaches are similar in that the service is accessed",
      "pos": [
        17356,
        17428
      ]
    },
    {
      "content": "using an application scope account vs. end user account.",
      "pos": [
        17429,
        17485
      ]
    },
    {
      "content": "Use the Service Identity feature in Azure AD Access Control.",
      "pos": [
        17487,
        17547
      ]
    },
    {
      "content": "Configure Azure AD Access Control to issue Simple Web Token",
      "pos": [
        17548,
        17607
      ]
    },
    {
      "content": "(SWT) tokens.",
      "pos": [
        17608,
        17621
      ]
    },
    {
      "content": "To handle the SWT token on the REST service side, you can",
      "pos": [
        17622,
        17679
      ]
    },
    {
      "content": "either implement a custom token handler and plug it into the WIF",
      "pos": [
        17680,
        17744
      ]
    },
    {
      "content": "pipeline, or you can parse it \"manually\" without using the WIF",
      "pos": [
        17745,
        17807
      ]
    },
    {
      "content": "infrastructure.",
      "pos": [
        17808,
        17823
      ]
    },
    {
      "content": "Consider the following diagram (WIF is optional):",
      "pos": [
        17825,
        17874
      ]
    },
    {
      "content": "REST Service",
      "pos": [
        17878,
        17890
      ]
    },
    {
      "content": "Refer to the following resources to implement this scenario:",
      "pos": [
        17897,
        17957
      ]
    },
    {
      "pos": [
        17964,
        18040
      ],
      "content": "How To: Configure Trust Between ACS and WCF Service Using Symmetric\nKeys",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Configure Trust Between ACS and WCF Service Using Symmetric",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "Keys",
          "pos": [
            68,
            72
          ]
        }
      ]
    },
    {
      "pos": [
        18096,
        18170
      ],
      "content": "How To: Authenticate to a REST WCF Service Deployed to Azure\nUsing ACS",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Authenticate to a REST WCF Service Deployed to Azure",
          "pos": [
            0,
            60
          ]
        },
        {
          "content": "Using ACS",
          "pos": [
            61,
            70
          ]
        }
      ]
    },
    {
      "content": "Code Sample: ASP.NET Web Service",
      "pos": [
        18226,
        18258
      ]
    },
    {
      "content": "Code Sample: Windows Phone 7 Application",
      "pos": [
        18314,
        18354
      ]
    },
    {
      "pos": [
        18410,
        18482
      ],
      "content": "REST WCF With SWT Token Issued By Azure Access Control\nService (ACS)",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "REST WCF With SWT Token Issued By Azure Access Control",
          "pos": [
            0,
            54
          ]
        },
        {
          "content": "Service (ACS)",
          "pos": [
            55,
            68
          ]
        }
      ]
    },
    {
      "content": "WCF (REST) Service with Live ID / Microsoft Account, Facebook, Google, Yahoo!, Open ID",
      "pos": [
        18553,
        18639
      ]
    },
    {
      "content": "In this scenario, your WCF (REST) service can be deployed to",
      "pos": [
        18641,
        18701
      ]
    },
    {
      "content": "Azure or on-premises.",
      "pos": [
        18703,
        18724
      ]
    },
    {
      "content": "You need to control access to it using a public",
      "pos": [
        18725,
        18772
      ]
    },
    {
      "content": "Internet identity, such as Live ID / Microsoft Account or Facebook.",
      "pos": [
        18773,
        18840
      ]
    },
    {
      "content": "Use Azure AD Access Control to issue SWT tokens.",
      "pos": [
        18842,
        18890
      ]
    },
    {
      "content": "To handle the",
      "pos": [
        18891,
        18904
      ]
    },
    {
      "content": "SWT token on the REST service side, you can implement a custom token",
      "pos": [
        18905,
        18973
      ]
    },
    {
      "content": "handler and plug it into a WIF pipeline, or you can parse it \"manually\"",
      "pos": [
        18974,
        19045
      ]
    },
    {
      "content": "without using the WIF infrastructure.",
      "pos": [
        19046,
        19083
      ]
    },
    {
      "content": "It is important to note that in order to implement this scenario, the",
      "pos": [
        19085,
        19154
      ]
    },
    {
      "content": "application needs to use web browser control to collect end user",
      "pos": [
        19155,
        19219
      ]
    },
    {
      "content": "credentials.",
      "pos": [
        19220,
        19232
      ]
    },
    {
      "content": "This makes it unsuitable for scenarios in which the REST",
      "pos": [
        19233,
        19289
      ]
    },
    {
      "content": "service is accessed from an ASP.NET web app.",
      "pos": [
        19290,
        19334
      ]
    },
    {
      "content": "It is only suitable for",
      "pos": [
        19335,
        19358
      ]
    },
    {
      "content": "scenarios in which the REST service is being accessed by the user's",
      "pos": [
        19359,
        19426
      ]
    },
    {
      "content": "client application, such as a Windows Phone 7 app or a rich desktop",
      "pos": [
        19427,
        19494
      ]
    },
    {
      "content": "client.",
      "pos": [
        19495,
        19502
      ]
    },
    {
      "content": "The key reason for popping the web browser control is that",
      "pos": [
        19503,
        19561
      ]
    },
    {
      "content": "Internet identities don't natively support active profile scenarios (web",
      "pos": [
        19562,
        19634
      ]
    },
    {
      "content": "services scenario).",
      "pos": [
        19635,
        19654
      ]
    },
    {
      "content": "Internet identities mainly support passive profile",
      "pos": [
        19655,
        19705
      ]
    },
    {
      "content": "scenarios (web apps) that rely on browser redirects: this is where web",
      "pos": [
        19706,
        19776
      ]
    },
    {
      "content": "browser control comes handy.",
      "pos": [
        19777,
        19805
      ]
    },
    {
      "content": "Consider the following diagram (WIF is optional, and thus not shown):",
      "pos": [
        19807,
        19876
      ]
    },
    {
      "content": "WIF is optional",
      "pos": [
        19880,
        19895
      ]
    },
    {
      "content": "Refer to the following resources to implement this scenario:",
      "pos": [
        19902,
        19962
      ]
    },
    {
      "content": "How To: Authenticate to a REST WCF Service Deployed to Azure Using ACS",
      "pos": [
        19969,
        20039
      ]
    },
    {
      "content": "How To: Configure Google as an Identity Provider",
      "pos": [
        20095,
        20143
      ]
    },
    {
      "content": "How To: Configure Facebook as an Identity Provider",
      "pos": [
        20199,
        20249
      ]
    },
    {
      "content": "How To: Configure Yahoo!",
      "pos": [
        20305,
        20329
      ]
    },
    {
      "content": "as an Identity Provider",
      "pos": [
        20330,
        20353
      ]
    },
    {
      "content": "Code Sample: Windows Phone 7 Application",
      "pos": [
        20409,
        20449
      ]
    },
    {
      "pos": [
        20505,
        20577
      ],
      "content": "REST WCF With SWT Token Issued By Azure Access Control\nService (ACS)",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "REST WCF With SWT Token Issued By Azure Access Control",
          "pos": [
            0,
            54
          ]
        },
        {
          "content": "Service (ACS)",
          "pos": [
            55,
            68
          ]
        }
      ]
    },
    {
      "content": "ASP.NET Web App to REST WCF Service Using Shared SWT Token",
      "pos": [
        20649,
        20707
      ]
    },
    {
      "content": "In this scenario you have a distributed application with a front-end",
      "pos": [
        20709,
        20777
      ]
    },
    {
      "content": "ASP.NET web app and a downstream REST service and you want to maintain",
      "pos": [
        20778,
        20848
      ]
    },
    {
      "content": "the end user's context across physical tiers.",
      "pos": [
        20849,
        20894
      ]
    },
    {
      "content": "This is sometimes needed",
      "pos": [
        20895,
        20919
      ]
    },
    {
      "content": "when implementing authorization logic or logging based on the end user's",
      "pos": [
        20920,
        20992
      ]
    },
    {
      "content": "identity in the downstream REST service.",
      "pos": [
        20993,
        21033
      ]
    },
    {
      "content": "Configure Azure AD Access Control to issue SWT token.",
      "pos": [
        21035,
        21088
      ]
    },
    {
      "content": "The SWT",
      "pos": [
        21089,
        21096
      ]
    },
    {
      "content": "token is issued to the front-end ASP.NET web app and then shared with",
      "pos": [
        21097,
        21166
      ]
    },
    {
      "content": "the downstream REST service.",
      "pos": [
        21167,
        21195
      ]
    },
    {
      "content": "In this case, there is only one relying",
      "pos": [
        21196,
        21235
      ]
    },
    {
      "content": "party configured in Azure AD Access Control.",
      "pos": [
        21236,
        21280
      ]
    },
    {
      "content": "However, there are",
      "pos": [
        21281,
        21299
      ]
    },
    {
      "content": "several caveats:",
      "pos": [
        21300,
        21316
      ]
    },
    {
      "pos": [
        21322,
        21633
      ],
      "content": "Since WIF does not provide a SWT token handler out of the box you\nneed to implement a custom token handler to be used with the ASP.NET\nweb app. You should rely on the heavy lifting that WIF does to\nsupport the WS-Federation protocol that relies on browser redirects\nvs. implementing it yourself.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "Since WIF does not provide a SWT token handler out of the box you",
          "pos": [
            0,
            65
          ]
        },
        {
          "content": "need to implement a custom token handler to be used with the ASP.NET",
          "pos": [
            66,
            134
          ]
        },
        {
          "content": "web app. You should rely on the heavy lifting that WIF does to",
          "pos": [
            135,
            197
          ],
          "nodes": [
            {
              "content": "web app.",
              "pos": [
                0,
                8
              ]
            },
            {
              "content": "You should rely on the heavy lifting that WIF does to",
              "pos": [
                9,
                62
              ]
            }
          ]
        },
        {
          "content": "support the WS-Federation protocol that relies on browser redirects",
          "pos": [
            198,
            265
          ]
        },
        {
          "content": "vs. implementing it yourself.",
          "pos": [
            266,
            295
          ]
        }
      ]
    },
    {
      "pos": [
        21638,
        21856
      ],
      "content": "When implementing a SWT custom token handler, make sure the\nbootstrap token is being addressed to make sure it's retained.\nOtherwise you won't be able to share it and send it to the\ndownstream REST service.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "When implementing a SWT custom token handler, make sure the",
          "pos": [
            0,
            59
          ]
        },
        {
          "content": "bootstrap token is being addressed to make sure it's retained.",
          "pos": [
            60,
            122
          ]
        },
        {
          "content": "Otherwise you won't be able to share it and send it to the",
          "pos": [
            123,
            181
          ]
        },
        {
          "content": "downstream REST service.",
          "pos": [
            182,
            206
          ]
        }
      ]
    },
    {
      "pos": [
        21861,
        22013
      ],
      "content": "You don't have to use WIF on a REST service; rather, you can parse\nthe token \"manually\" since there is no need to handle redirects in\nthis case.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "You don't have to use WIF on a REST service; rather, you can parse",
          "pos": [
            0,
            66
          ]
        },
        {
          "content": "the token \"manually\" since there is no need to handle redirects in",
          "pos": [
            67,
            133
          ]
        },
        {
          "content": "this case.",
          "pos": [
            134,
            144
          ]
        }
      ]
    },
    {
      "content": "ASP.NET Web Application",
      "pos": [
        22017,
        22040
      ]
    },
    {
      "content": "Refer to the following resources to implement this scenario:",
      "pos": [
        22047,
        22107
      ]
    },
    {
      "content": "How To: Configure Google as an Identity Provider",
      "pos": [
        22114,
        22162
      ]
    },
    {
      "content": "How To: Configure Facebook as an Identity Provider",
      "pos": [
        22218,
        22268
      ]
    },
    {
      "content": "How To: Configure Yahoo!",
      "pos": [
        22324,
        22348
      ]
    },
    {
      "content": "as an Identity Provider",
      "pos": [
        22349,
        22372
      ]
    },
    {
      "pos": [
        22428,
        22501
      ],
      "content": "ASP.NET Web App To REST WCF Service Delegation Using Shared SWT\nToken",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "ASP.NET Web App To REST WCF Service Delegation Using Shared SWT",
          "pos": [
            0,
            63
          ]
        },
        {
          "content": "Token",
          "pos": [
            64,
            69
          ]
        }
      ]
    },
    {
      "content": "Role-Based Access Control (RBAC) In Claims-Aware Applications and Services",
      "pos": [
        22575,
        22649
      ]
    },
    {
      "content": "In this scenario you need to implement authorization in your web",
      "pos": [
        22651,
        22715
      ]
    },
    {
      "content": "application or service based on user roles: user with required roles get",
      "pos": [
        22716,
        22788
      ]
    },
    {
      "content": "access and those that don't have required roles are denied.",
      "pos": [
        22789,
        22848
      ]
    },
    {
      "content": "Simply put,",
      "pos": [
        22849,
        22860
      ]
    },
    {
      "content": "your application needs to answer simple question - is the user in role",
      "pos": [
        22861,
        22931
      ]
    },
    {
      "content": "X?",
      "pos": [
        22932,
        22934
      ]
    },
    {
      "content": "There are several ways to solve this scenario.",
      "pos": [
        22936,
        22982
      ]
    },
    {
      "content": "You can use Azure",
      "pos": [
        22983,
        23000
      ]
    },
    {
      "content": "AD Access Control, WIF Claims Authentication Manager,",
      "pos": [
        23001,
        23054
      ]
    },
    {
      "content": "samlSecurityTokenRequirement mapping, or Customer Role Manager.",
      "pos": [
        23055,
        23118
      ]
    },
    {
      "content": "WIF is used in all cases.",
      "pos": [
        23120,
        23145
      ]
    },
    {
      "content": "WIF supports the IPrincipal.IsInRole(\"MyRole\")",
      "pos": [
        23146,
        23192
      ]
    },
    {
      "content": "method.",
      "pos": [
        23193,
        23200
      ]
    },
    {
      "content": "In most of the cases the key is to make sure there is role type",
      "pos": [
        23201,
        23264
      ]
    },
    {
      "content": "claim with URI of",
      "pos": [
        23265,
        23282
      ]
    },
    {
      "content": "http://schemas.microsoft.com/ws/2008/06/identity/claims/role in the",
      "pos": [
        23283,
        23350
      ]
    },
    {
      "content": "token so that WIF can successfully verify role membership when the",
      "pos": [
        23351,
        23417
      ]
    },
    {
      "content": "IsInRole method is called.",
      "pos": [
        23418,
        23444
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Azure AD Access Control<ept id=\"p1\">**</ept>.",
      "pos": [
        23446,
        23474
      ]
    },
    {
      "content": "In this implementation the",
      "pos": [
        23475,
        23501
      ]
    },
    {
      "content": "Azure AD Access Control claims transformation rule engine is used.",
      "pos": [
        23503,
        23569
      ]
    },
    {
      "content": "Using",
      "pos": [
        23570,
        23575
      ]
    },
    {
      "content": "the claims transformation rule engine rules you can transform any",
      "pos": [
        23576,
        23641
      ]
    },
    {
      "content": "incoming claim into a role type claim so that when the token hits the",
      "pos": [
        23642,
        23711
      ]
    },
    {
      "content": "application or a service WIF can parse this role claim to make sure",
      "pos": [
        23712,
        23779
      ]
    },
    {
      "content": "IsInRole method call is succesful.",
      "pos": [
        23780,
        23814
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>WIF ClaimsAuthenticationManager<ept id=\"p1\">**</ept>.",
      "pos": [
        23825,
        23861
      ]
    },
    {
      "content": "In this implementation use",
      "pos": [
        23862,
        23888
      ]
    },
    {
      "content": "ClaimsAuthenticationManager as WIF's extensibility point.",
      "pos": [
        23889,
        23946
      ]
    },
    {
      "content": "Using this",
      "pos": [
        23947,
        23957
      ]
    },
    {
      "content": "approach you transform any arbitrary incoming claims to a role claim",
      "pos": [
        23958,
        24026
      ]
    },
    {
      "content": "type at the application.",
      "pos": [
        24027,
        24051
      ]
    },
    {
      "content": "The complexity of the transformation is only",
      "pos": [
        24052,
        24096
      ]
    },
    {
      "content": "limited by the code you write.",
      "pos": [
        24097,
        24127
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>samlSecurityTokenRequriement mapping<ept id=\"p1\">**</ept>.",
      "pos": [
        24138,
        24179
      ]
    },
    {
      "content": "In this implementation you use",
      "pos": [
        24180,
        24210
      ]
    },
    {
      "content": "the samlSecurityTokenRequirement configuration in web.config to tell WIF",
      "pos": [
        24211,
        24283
      ]
    },
    {
      "content": "which claim types behave as if they were role claim types.",
      "pos": [
        24284,
        24342
      ]
    },
    {
      "content": "For example,",
      "pos": [
        24343,
        24355
      ]
    },
    {
      "content": "if the token carries a claim of group type, you can map it to role claim",
      "pos": [
        24356,
        24428
      ]
    },
    {
      "content": "type.",
      "pos": [
        24429,
        24434
      ]
    },
    {
      "content": "You can achieve only simple mappings using this approach.",
      "pos": [
        24435,
        24492
      ]
    },
    {
      "content": "Custom RoleManager.",
      "pos": [
        24505,
        24524
      ]
    },
    {
      "content": "In this implementation you implement custom",
      "pos": [
        24527,
        24570
      ]
    },
    {
      "content": "RoleManger.",
      "pos": [
        24571,
        24582
      ]
    },
    {
      "content": "WIF is used to inspect the incoming claims when implementing",
      "pos": [
        24583,
        24643
      ]
    },
    {
      "content": "custom RoleManager interface methods such as GetAllRoles().",
      "pos": [
        24644,
        24703
      ]
    },
    {
      "content": "Refer to the following resources to implement this scenario:",
      "pos": [
        24714,
        24774
      ]
    },
    {
      "pos": [
        24781,
        24891
      ],
      "content": "How To: Implement Role Based Access Control (RBAC) in a Claims-Aware\nASP.NET Application Using WIF and ACS",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Implement Role Based Access Control (RBAC) in a Claims-Aware",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "ASP.NET Application Using WIF and ACS",
          "pos": [
            69,
            106
          ]
        }
      ]
    },
    {
      "content": "How To: Implement Token Transformation Logic Using Rules",
      "pos": [
        24947,
        25003
      ]
    },
    {
      "pos": [
        25059,
        25141
      ],
      "content": "Authorization With RoleManager For Claims Aware (WIF) ASP.NET Web\nApplications",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Authorization With RoleManager For Claims Aware (WIF) ASP.NET Web",
          "pos": [
            0,
            65
          ]
        },
        {
          "content": "Applications",
          "pos": [
            66,
            78
          ]
        }
      ]
    },
    {
      "pos": [
        25279,
        25452
      ],
      "content": "Code Sample: Using Claims In IsInRole in <bpt id=\"p1\">[</bpt>Windows Identity Foundation\nSDK<ept id=\"p1\">](http://www.microsoft.com/downloads/details.aspx?FamilyID=c148b2df-c7af-46bb-9162-2c9422208504)</ept>",
      "leadings": [
        "",
        "    "
      ]
    },
    {
      "content": "Claims-Based Authorization In Claims-Aware Applications and Services",
      "pos": [
        25457,
        25525
      ]
    },
    {
      "content": "In this scenario you need to implement complex authorization logic in",
      "pos": [
        25527,
        25596
      ]
    },
    {
      "content": "your web application or service and the IsInRole() method is not",
      "pos": [
        25597,
        25661
      ]
    },
    {
      "content": "satisfactory for your authorization needs.",
      "pos": [
        25662,
        25704
      ]
    },
    {
      "content": "If your authorization",
      "pos": [
        25705,
        25726
      ]
    },
    {
      "content": "approach relies on roles then consider implementing role-based access",
      "pos": [
        25727,
        25796
      ]
    },
    {
      "content": "control outlined in previous section.",
      "pos": [
        25797,
        25834
      ]
    },
    {
      "content": "Use ClaimsAuthorizationManager as the WIF extensibility point.",
      "pos": [
        25836,
        25898
      ]
    },
    {
      "content": "ClaimsAuthorizationManager allows external access check calls so that",
      "pos": [
        25899,
        25968
      ]
    },
    {
      "content": "your application code looks cleaner and more maintainable than when",
      "pos": [
        25969,
        26036
      ]
    },
    {
      "content": "access checks implemented in the application's code.",
      "pos": [
        26037,
        26089
      ]
    },
    {
      "content": "Refer to the following resources to implement this scenario:",
      "pos": [
        26100,
        26160
      ]
    },
    {
      "content": "How To: Implement Token Transformation Logic Using Rules",
      "pos": [
        26167,
        26223
      ]
    },
    {
      "pos": [
        26279,
        26377
      ],
      "content": "How To: Implement Claims Authorization in a Claims-Aware ASP.NET\nApplication Using WIF and ACS",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How To: Implement Claims Authorization in a Claims-Aware ASP.NET",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "Application Using WIF and ACS",
          "pos": [
            65,
            94
          ]
        }
      ]
    },
    {
      "pos": [
        26432,
        26607
      ],
      "content": "Code Sample: Claims based Authorization in <bpt id=\"p1\">[</bpt>Windows Identity\nFoundation SDK<ept id=\"p1\">](http://www.microsoft.com/downloads/details.aspx?FamilyID=c148b2df-c7af-46bb-9162-2c9422208504)</ept>",
      "leadings": [
        "",
        "    "
      ]
    },
    {
      "content": "Azure Storage Service Identity and Access Scenarios",
      "pos": [
        26612,
        26663
      ]
    },
    {
      "content": "In this scenario you need to securely share access to Azure",
      "pos": [
        26665,
        26724
      ]
    },
    {
      "content": "storage blobs and containers.",
      "pos": [
        26725,
        26754
      ]
    },
    {
      "content": "Use Shared Access Signatures.",
      "pos": [
        26756,
        26785
      ]
    },
    {
      "content": "To access your storage service account",
      "pos": [
        26786,
        26824
      ]
    },
    {
      "content": "from your own application, use the shared hash that is available through",
      "pos": [
        26825,
        26897
      ]
    },
    {
      "content": "Azure portal when you configure and manage your storage service",
      "pos": [
        26898,
        26961
      ]
    },
    {
      "content": "accounts.",
      "pos": [
        26962,
        26971
      ]
    },
    {
      "content": "When you want to give someone else access to the blobs and",
      "pos": [
        26972,
        27030
      ]
    },
    {
      "content": "containers in your storage service account use Shared Access Signatures",
      "pos": [
        27031,
        27102
      ]
    },
    {
      "content": "URL's.",
      "pos": [
        27103,
        27109
      ]
    },
    {
      "content": "Pay special attention to securely managing the information to avoid its",
      "pos": [
        27111,
        27182
      ]
    },
    {
      "content": "exposure; also, pay special attention to the lifetime of the Shared",
      "pos": [
        27183,
        27250
      ]
    },
    {
      "content": "Access Signatures.",
      "pos": [
        27251,
        27269
      ]
    },
    {
      "content": "Refer to the following resources to solve this scenario",
      "pos": [
        27280,
        27335
      ]
    },
    {
      "content": "Managing Access to Blobs and Containers",
      "pos": [
        27342,
        27381
      ]
    },
    {
      "content": "New Storage Feature: Shared Access Signatures",
      "pos": [
        27437,
        27482
      ]
    },
    {
      "content": "Shared Access Signatures Are Easy These Days",
      "pos": [
        27563,
        27607
      ]
    },
    {
      "content": "Azure SQL Database Identity and Access Scenarios",
      "pos": [
        27688,
        27736
      ]
    },
    {
      "content": "SQL Database only supports SQL Server Authentication.",
      "pos": [
        27739,
        27792
      ]
    },
    {
      "content": "Windows",
      "pos": [
        27793,
        27800
      ]
    },
    {
      "content": "Authentication (integrated security) is not supported.",
      "pos": [
        27801,
        27855
      ]
    },
    {
      "content": "Users must",
      "pos": [
        27856,
        27866
      ]
    },
    {
      "content": "provide credentials (login and password) every time they connect to a",
      "pos": [
        27867,
        27936
      ]
    },
    {
      "content": "SQL Database.",
      "pos": [
        27937,
        27950
      ]
    },
    {
      "content": "Pay special attention when managing your username and",
      "pos": [
        27951,
        28004
      ]
    },
    {
      "content": "password to avoid information disclosure.",
      "pos": [
        28005,
        28046
      ]
    },
    {
      "content": "To solve this scenario, refer to the following Help topic:",
      "pos": [
        28059,
        28117
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Azure SQL Database Development: How-to Topics<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/ee621787.aspx)</ept>",
      "pos": [
        28123,
        28225
      ]
    },
    {
      "content": "Or refer to one of its many child topics, some of which are:",
      "pos": [
        28228,
        28288
      ]
    },
    {
      "content": "How to: Connect to SQL Database Using sqlcmd",
      "pos": [
        28294,
        28338
      ]
    },
    {
      "content": "Code sample: Retry logic for connecting to Azure SQL Database with ADO.NET",
      "pos": [
        28398,
        28472
      ]
    },
    {
      "content": "How to: Connect to SQL Database Using PHP",
      "pos": [
        28532,
        28573
      ]
    },
    {
      "content": "How to: Connect to SQL Database Using JDBC",
      "pos": [
        28633,
        28675
      ]
    },
    {
      "content": "Or refer to:",
      "pos": [
        28734,
        28746
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Azure SQL Database Security Guidelines and Limitations<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/ff394108.aspx#authentication)</ept>",
      "pos": [
        28752,
        28878
      ]
    },
    {
      "content": "Azure Service Bus Identity and Access Scenarios",
      "pos": [
        28883,
        28930
      ]
    },
    {
      "content": "The Service Bus and Azure AD Access Control have a special",
      "pos": [
        28932,
        28990
      ]
    },
    {
      "content": "relationship in that each Service Bus service namespace is paired with a",
      "pos": [
        28991,
        29063
      ]
    },
    {
      "content": "matching Access Control service namespace of the same name, with the",
      "pos": [
        29064,
        29132
      ]
    },
    {
      "content": "suffix \"-sb\".",
      "pos": [
        29133,
        29146
      ]
    },
    {
      "content": "The reason for this special relationship is in the way",
      "pos": [
        29147,
        29201
      ]
    },
    {
      "content": "that Service Bus and Access Control manage their mutual trust",
      "pos": [
        29202,
        29263
      ]
    },
    {
      "content": "relationship and the associated cryptographic secrets.",
      "pos": [
        29264,
        29318
      ]
    },
    {
      "content": "Refer to the",
      "pos": [
        29319,
        29331
      ]
    },
    {
      "content": "resources listed below for more details.",
      "pos": [
        29332,
        29372
      ]
    },
    {
      "content": "Refer to the following resources to solve this scenario:",
      "pos": [
        29383,
        29439
      ]
    },
    {
      "pos": [
        29445,
        29546
      ],
      "content": "<bpt id=\"p1\">[</bpt>Securing Service Bus with ACS<ept id=\"p1\">](http://channel9.msdn.com/posts/Securing-Service-Bus-with-ACS)</ept> (Video)"
    },
    {
      "pos": [
        29551,
        29679
      ],
      "content": "<bpt id=\"p1\">[</bpt>Securing Service Bus with ACS<ept id=\"p1\">](https://skydrive.live.com/view.aspx?cid=123CCD2A7AB10107&amp;resid=123CCD2A7AB10107%211849)</ept> (Slides)"
    },
    {
      "pos": [
        29685,
        29765
      ],
      "content": "Service Bus Authentication and Authorization with the Access Control\nService",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Service Bus Authentication and Authorization with the Access Control",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "Service",
          "pos": [
            69,
            76
          ]
        }
      ]
    },
    {
      "content": "In-Memory Cache Identity and Access Scenarios",
      "pos": [
        29819,
        29864
      ]
    },
    {
      "content": "In-memory cache (formerly known as Azure Cache) relies on",
      "pos": [
        29866,
        29923
      ]
    },
    {
      "content": "Azure AD Access Control for authentication.",
      "pos": [
        29924,
        29967
      ]
    },
    {
      "content": "It uses shared keys",
      "pos": [
        29968,
        29987
      ]
    },
    {
      "content": "available through the management portal.",
      "pos": [
        29988,
        30028
      ]
    },
    {
      "content": "Use the keys in your code or",
      "pos": [
        30029,
        30057
      ]
    },
    {
      "content": "configuration files when accessing the cache.",
      "pos": [
        30058,
        30103
      ]
    },
    {
      "content": "Be sure to store the keys",
      "pos": [
        30104,
        30129
      ]
    },
    {
      "content": "securely so as to avoid information disclosure.",
      "pos": [
        30130,
        30177
      ]
    },
    {
      "content": "Refer to the following resources to solve this scenario:",
      "pos": [
        30189,
        30245
      ]
    },
    {
      "pos": [
        30252,
        30323
      ],
      "content": "How to: Configure a Cache Client Programmatically for Azure\nCaching",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How to: Configure a Cache Client Programmatically for Azure",
          "pos": [
            0,
            59
          ]
        },
        {
          "content": "Caching",
          "pos": [
            60,
            67
          ]
        }
      ]
    },
    {
      "pos": [
        30392,
        30487
      ],
      "content": "How to: Configure a Cache Client using the Application Configuration\nFile for Azure Caching",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "How to: Configure a Cache Client using the Application Configuration",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "File for Azure Caching",
          "pos": [
            69,
            91
          ]
        }
      ]
    },
    {
      "pos": [
        30555,
        30673
      ],
      "content": "[Azure Service Bus and Caching Samples](http://msdn.microsoft.com/library/ee706741.aspx) (Caching Samples\nsection)",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">[</bpt>Azure Service Bus and Caching Samples<ept id=\"p1\">](http://msdn.microsoft.com/library/ee706741.aspx)</ept> (Caching Samples",
          "pos": [
            0,
            105
          ]
        },
        {
          "content": "section)",
          "pos": [
            106,
            114
          ]
        }
      ]
    },
    {
      "content": "Azure Marketplace Identity and Access Scenarios",
      "pos": [
        30677,
        30724
      ]
    },
    {
      "content": "Every access to an Azure Marketplace dataset, whether free or",
      "pos": [
        30726,
        30787
      ]
    },
    {
      "content": "paid, must authenticate the user before access is granted.",
      "pos": [
        30788,
        30846
      ]
    },
    {
      "content": "When you",
      "pos": [
        30847,
        30855
      ]
    },
    {
      "content": "create an application the authentication process must be included in",
      "pos": [
        30856,
        30924
      ]
    },
    {
      "content": "your code.",
      "pos": [
        30925,
        30935
      ]
    },
    {
      "content": "Consider the following common scenarios:",
      "pos": [
        30936,
        30976
      ]
    },
    {
      "content": "I Access My Dataset",
      "pos": [
        30981,
        31000
      ]
    },
    {
      "content": "In this scenario you are building an application that consumes datasets",
      "pos": [
        31002,
        31073
      ]
    },
    {
      "content": "in your Marketplace subscription.",
      "pos": [
        31074,
        31107
      ]
    },
    {
      "content": "You are the user of the application.",
      "pos": [
        31108,
        31144
      ]
    },
    {
      "content": "The application can be deployed either to Azure, on-premises, or Marketplace.",
      "pos": [
        31145,
        31222
      ]
    },
    {
      "content": "Use the shared key that's available through your Marketplace",
      "pos": [
        31224,
        31284
      ]
    },
    {
      "content": "subscription.",
      "pos": [
        31285,
        31298
      ]
    },
    {
      "content": "You obtain the shared key using the Marketplace portal.",
      "pos": [
        31299,
        31354
      ]
    },
    {
      "content": "Refer to the following resources to solve this scenario:",
      "pos": [
        31365,
        31421
      ]
    },
    {
      "content": "Use HTTP Basic Auth in your Marketplace App",
      "pos": [
        31428,
        31471
      ]
    },
    {
      "content": "Users Access My Datasets",
      "pos": [
        31526,
        31550
      ]
    },
    {
      "content": "In this scenario you are building an application that allows users to",
      "pos": [
        31552,
        31621
      ]
    },
    {
      "content": "access your dataset.",
      "pos": [
        31622,
        31642
      ]
    },
    {
      "content": "The application can be deployed on Azure,",
      "pos": [
        31643,
        31684
      ]
    },
    {
      "content": "on-premises, or Marketplace.",
      "pos": [
        31685,
        31713
      ]
    },
    {
      "content": "To solve this scenario, use OAuth delegation.",
      "pos": [
        31715,
        31760
      ]
    },
    {
      "content": "Users will be prompted to",
      "pos": [
        31761,
        31786
      ]
    },
    {
      "content": "provide their Live ID / Microsoft Account credentials, and then they",
      "pos": [
        31787,
        31855
      ]
    },
    {
      "content": "will be taken through the consent process.",
      "pos": [
        31856,
        31898
      ]
    },
    {
      "content": "Refer to the following resources to solve this scenario:",
      "pos": [
        31909,
        31965
      ]
    },
    {
      "content": "OAuth Web Client Example",
      "pos": [
        31972,
        31996
      ]
    },
    {
      "content": "OAuth Rich Client Example",
      "pos": [
        32050,
        32075
      ]
    },
    {
      "content": "Application Access Marketplace API",
      "pos": [
        32128,
        32162
      ]
    },
    {
      "content": "In this scenario you are building an application that accesses the",
      "pos": [
        32164,
        32230
      ]
    },
    {
      "content": "Marketplace API.",
      "pos": [
        32231,
        32247
      ]
    },
    {
      "content": "The Marketplace API requires authentication to",
      "pos": [
        32248,
        32294
      ]
    },
    {
      "content": "successfully accomplish calls to it.",
      "pos": [
        32295,
        32331
      ]
    },
    {
      "content": "The application is deployed to",
      "pos": [
        32332,
        32362
      ]
    },
    {
      "content": "Azure Marketplace.",
      "pos": [
        32363,
        32381
      ]
    },
    {
      "content": "Consult the Marketplace publishing kit for details about the",
      "pos": [
        32392,
        32452
      ]
    },
    {
      "content": "authentication implementation.",
      "pos": [
        32453,
        32483
      ]
    },
    {
      "content": "Refer to the following resources to solve this scenario:",
      "pos": [
        32485,
        32541
      ]
    },
    {
      "content": "Download the App Publishing Kit",
      "pos": [
        32548,
        32579
      ]
    },
    {
      "content": "Introduction to Azure Marketplace for Applications",
      "pos": [
        32633,
        32683
      ]
    },
    {
      "content": "Security Knobs",
      "pos": [
        32719,
        32733
      ]
    },
    {
      "content": "This section outlines security knobs for Windows Identity Foundation and",
      "pos": [
        32735,
        32807
      ]
    },
    {
      "content": "Azure AD Access Control.",
      "pos": [
        32808,
        32832
      ]
    },
    {
      "content": "Use it as a basic security checklist",
      "pos": [
        32833,
        32869
      ]
    },
    {
      "content": "for these technologies when designing and deploying your application.",
      "pos": [
        32870,
        32939
      ]
    },
    {
      "content": "Windows Identity Foundation",
      "pos": [
        32944,
        32971
      ]
    },
    {
      "content": "The following are key security knobs of WIF.",
      "pos": [
        32973,
        33017
      ]
    },
    {
      "content": "The information below is a",
      "pos": [
        33018,
        33044
      ]
    },
    {
      "content": "digest from <bpt id=\"p1\">[</bpt>WIF Design Considerations<ept id=\"p1\">](http://msdn.microsoft.com/library/ee517298.aspx)</ept> and <bpt id=\"p2\">[</bpt>Windows Identity Foundation\n(WIF) Security for ASP.NET Web Applications - Threats &amp; Countermeasures<ept id=\"p2\">](http://blogs.msdn.com/b/alikl/archive/2010/12/02/windows-identity-foundation-wif-security-for-asp-net-web-applications-threats-amp-countermeasures.aspx)</ept>",
      "pos": [
        33045,
        33392
      ]
    },
    {
      "content": ".",
      "pos": [
        33393,
        33394
      ]
    },
    {
      "pos": [
        33400,
        33517
      ],
      "content": "**IssuerNameRegistry**. Specifies trusted Security Token Services\n(STS's). Make sure only trusted STS are listed.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "**IssuerNameRegistry**. Specifies trusted Security Token Services",
          "pos": [
            0,
            65
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>IssuerNameRegistry<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                23
              ]
            },
            {
              "content": "Specifies trusted Security Token Services",
              "pos": [
                24,
                65
              ]
            }
          ]
        },
        {
          "content": "(STS's). Make sure only trusted STS are listed.",
          "pos": [
            66,
            113
          ],
          "nodes": [
            {
              "content": "(STS's).",
              "pos": [
                0,
                8
              ]
            },
            {
              "content": "Make sure only trusted STS are listed.",
              "pos": [
                9,
                47
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        33522,
        33631
      ],
      "content": "**cookieHandler requireSsl=\"true\"**. Specifies whether session\ncookies transferred over the SSL protocol.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "**cookieHandler requireSsl=\"true\"**. Specifies whether session",
          "pos": [
            0,
            62
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>cookieHandler requireSsl=\"true\"<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                36
              ]
            },
            {
              "content": "Specifies whether session",
              "pos": [
                37,
                62
              ]
            }
          ]
        },
        {
          "content": "cookies transferred over the SSL protocol.",
          "pos": [
            63,
            105
          ]
        }
      ]
    },
    {
      "pos": [
        33636,
        33791
      ],
      "content": "**wsFederation's requireHttps=\"true\"**. Specifies whether the\nfederation protocol communication with identity provider performed\nover SSL protocol.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**wsFederation's requireHttps=\"true\"**. Specifies whether the",
          "pos": [
            0,
            61
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>wsFederation's requireHttps=\"true\"<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                39
              ]
            },
            {
              "content": "Specifies whether the",
              "pos": [
                40,
                61
              ]
            }
          ]
        },
        {
          "content": "federation protocol communication with identity provider performed",
          "pos": [
            62,
            128
          ]
        },
        {
          "content": "over SSL protocol.",
          "pos": [
            129,
            147
          ]
        }
      ]
    },
    {
      "pos": [
        33796,
        33999
      ],
      "content": "**tokenReplayDetection enabled=\"true\"**. Specifies whether token\nreplay detection feature is enabled. Be aware that this feature\ncreates server affinity as it manages local copies of used tokens.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**tokenReplayDetection enabled=\"true\"**. Specifies whether token",
          "pos": [
            0,
            64
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>tokenReplayDetection enabled=\"true\"<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                40
              ]
            },
            {
              "content": "Specifies whether token",
              "pos": [
                41,
                64
              ]
            }
          ]
        },
        {
          "content": "replay detection feature is enabled. Be aware that this feature",
          "pos": [
            65,
            128
          ],
          "nodes": [
            {
              "content": "replay detection feature is enabled.",
              "pos": [
                0,
                36
              ]
            },
            {
              "content": "Be aware that this feature",
              "pos": [
                37,
                63
              ]
            }
          ]
        },
        {
          "content": "creates server affinity as it manages local copies of used tokens.",
          "pos": [
            129,
            195
          ]
        }
      ]
    },
    {
      "pos": [
        34004,
        34171
      ],
      "content": "**audienceUris**. Specifies intended audience of the token. If your\napplication receives a token that was not intended for your app it\nwill be rejected by WIF.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**audienceUris**. Specifies intended audience of the token. If your",
          "pos": [
            0,
            67
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>audienceUris<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                17
              ]
            },
            {
              "content": "Specifies intended audience of the token.",
              "pos": [
                18,
                59
              ]
            },
            {
              "content": "If your",
              "pos": [
                60,
                67
              ]
            }
          ]
        },
        {
          "content": "application receives a token that was not intended for your app it",
          "pos": [
            68,
            134
          ]
        },
        {
          "content": "will be rejected by WIF.",
          "pos": [
            135,
            159
          ]
        }
      ]
    },
    {
      "pos": [
        34176,
        34636
      ],
      "content": "**requestValidation** and **httpRuntime requestValidationType**.\nEnables/disables ASP.NET validation feature. See guidance as\noutlined in [Windows Identity Foundation (WIF): A Potentially\nDangerous Request.Form Value Was Detected from the Client](http://social.technet.microsoft.com/wiki/contents/articles/1725.windows-identity-foundation-wif-a-potentially-dangerous-request-form-value-was-detected-from-the-client-wresult-t-requestsecurityto.aspx)",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>requestValidation<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>httpRuntime requestValidationType<ept id=\"p2\">**</ept>.",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "Enables/disables ASP.NET validation feature. See guidance as",
          "pos": [
            65,
            125
          ],
          "nodes": [
            {
              "content": "Enables/disables ASP.NET validation feature.",
              "pos": [
                0,
                44
              ]
            },
            {
              "content": "See guidance as",
              "pos": [
                45,
                60
              ]
            }
          ]
        },
        {
          "content": "outlined in <bpt id=\"p1\">[</bpt>Windows Identity Foundation (WIF): A Potentially\nDangerous Request.Form Value Was Detected from the Client<ept id=\"p1\">](http://social.technet.microsoft.com/wiki/contents/articles/1725.windows-identity-foundation-wif-a-potentially-dangerous-request-form-value-was-detected-from-the-client-wresult-t-requestsecurityto.aspx)</ept>",
          "pos": [
            126,
            448
          ]
        }
      ]
    },
    {
      "content": "Azure AD Access Control",
      "pos": [
        34641,
        34664
      ]
    },
    {
      "content": "Consider the following security knobs in Azure AD Access Control",
      "pos": [
        34666,
        34730
      ]
    },
    {
      "content": "deployment.",
      "pos": [
        34731,
        34742
      ]
    },
    {
      "content": "The information below is a digest from <bpt id=\"p1\">[</bpt>ACS Security\nGuidelines<ept id=\"p1\">](http://msdn.microsoft.com/library/gg185962.aspx)</ept> and <bpt id=\"p2\">[</bpt>Certificates and Keys Management Guidelines<ept id=\"p2\">](http://msdn.microsoft.com/library/hh204521.aspx)</ept>.",
      "pos": [
        34743,
        34956
      ]
    },
    {
      "pos": [
        34962,
        35074
      ],
      "content": "**STS tokens expiration**. Use Azure AD Access Control\nmanagement portal to set aggressive token expiration.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "**STS tokens expiration**. Use Azure AD Access Control",
          "pos": [
            0,
            54
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>STS tokens expiration<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                26
              ]
            },
            {
              "content": "Use Azure AD Access Control",
              "pos": [
                27,
                54
              ]
            }
          ]
        },
        {
          "content": "management portal to set aggressive token expiration.",
          "pos": [
            55,
            108
          ]
        }
      ]
    },
    {
      "pos": [
        35079,
        35333
      ],
      "content": "**Data validation when using the Error URL feature**. Azure\nAD Access Control Error URL feature requires anonymous access to the\napp's page where it sends error messages. Assume all data coming to\nthis page as dangerous from untrusted source.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Data validation when using the Error URL feature**. Azure",
          "pos": [
            0,
            59
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Data validation when using the Error URL feature<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                53
              ]
            },
            {
              "content": "Azure",
              "pos": [
                54,
                59
              ]
            }
          ]
        },
        {
          "content": "AD Access Control Error URL feature requires anonymous access to the",
          "pos": [
            60,
            128
          ]
        },
        {
          "content": "app's page where it sends error messages. Assume all data coming to",
          "pos": [
            129,
            196
          ],
          "nodes": [
            {
              "content": "app's page where it sends error messages.",
              "pos": [
                0,
                41
              ]
            },
            {
              "content": "Assume all data coming to",
              "pos": [
                42,
                67
              ]
            }
          ]
        },
        {
          "content": "this page as dangerous from untrusted source.",
          "pos": [
            197,
            242
          ]
        }
      ]
    },
    {
      "pos": [
        35338,
        35504
      ],
      "content": "**Encrypting tokens for highly sensitive scenarios**. To mitigate\nthreat of information disclosure that available in the token\nconsider encrypting the tokens.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Encrypting tokens for highly sensitive scenarios**. To mitigate",
          "pos": [
            0,
            65
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Encrypting tokens for highly sensitive scenarios<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                53
              ]
            },
            {
              "content": "To mitigate",
              "pos": [
                54,
                65
              ]
            }
          ]
        },
        {
          "content": "threat of information disclosure that available in the token",
          "pos": [
            66,
            126
          ]
        },
        {
          "content": "consider encrypting the tokens.",
          "pos": [
            127,
            158
          ]
        }
      ]
    },
    {
      "pos": [
        35509,
        35783
      ],
      "content": "**Encrypting cookies using RSA when deploying to Azure**.\nWIF encrypts cookies using DPAPI by default. It creates server\naffinity and may result in exceptions when deployed to web farm and\nAzure environments. Use RSA instead in web farm and \nAzure scenarios.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Encrypting cookies using RSA when deploying to Azure<ept id=\"p1\">**</ept>.",
          "pos": [
            0,
            57
          ]
        },
        {
          "content": "WIF encrypts cookies using DPAPI by default. It creates server",
          "pos": [
            58,
            120
          ],
          "nodes": [
            {
              "content": "WIF encrypts cookies using DPAPI by default.",
              "pos": [
                0,
                44
              ]
            },
            {
              "content": "It creates server",
              "pos": [
                45,
                62
              ]
            }
          ]
        },
        {
          "content": "affinity and may result in exceptions when deployed to web farm and",
          "pos": [
            121,
            188
          ]
        },
        {
          "content": "Azure environments. Use RSA instead in web farm and",
          "pos": [
            189,
            240
          ],
          "nodes": [
            {
              "content": "Azure environments.",
              "pos": [
                0,
                19
              ]
            },
            {
              "content": "Use RSA instead in web farm and",
              "pos": [
                20,
                51
              ]
            }
          ]
        },
        {
          "content": "Azure scenarios.",
          "pos": [
            242,
            258
          ]
        }
      ]
    },
    {
      "pos": [
        35788,
        36174
      ],
      "content": "**Token signing certificates**. Renew token signing certificates\nperiodically to avoid denial of service. Azure AD Access\nControl signs all security tokens it issues. X.509 certificates are\nused for signing when you build an application that consumes SAML\ntokens issued by ACS. When signing certificates expire you will\nreceive errors when trying to request a token.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Token signing certificates**. Renew token signing certificates",
          "pos": [
            0,
            64
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Token signing certificates<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                31
              ]
            },
            {
              "content": "Renew token signing certificates",
              "pos": [
                32,
                64
              ]
            }
          ]
        },
        {
          "content": "periodically to avoid denial of service. Azure AD Access",
          "pos": [
            65,
            121
          ],
          "nodes": [
            {
              "content": "periodically to avoid denial of service.",
              "pos": [
                0,
                40
              ]
            },
            {
              "content": "Azure AD Access",
              "pos": [
                41,
                56
              ]
            }
          ]
        },
        {
          "content": "Control signs all security tokens it issues. X.509 certificates are",
          "pos": [
            122,
            189
          ],
          "nodes": [
            {
              "content": "Control signs all security tokens it issues.",
              "pos": [
                0,
                44
              ]
            },
            {
              "content": "X.509 certificates are",
              "pos": [
                45,
                67
              ]
            }
          ]
        },
        {
          "content": "used for signing when you build an application that consumes SAML",
          "pos": [
            190,
            255
          ]
        },
        {
          "content": "tokens issued by ACS. When signing certificates expire you will",
          "pos": [
            256,
            319
          ],
          "nodes": [
            {
              "content": "tokens issued by ACS.",
              "pos": [
                0,
                21
              ]
            },
            {
              "content": "When signing certificates expire you will",
              "pos": [
                22,
                63
              ]
            }
          ]
        },
        {
          "content": "receive errors when trying to request a token.",
          "pos": [
            320,
            366
          ]
        }
      ]
    },
    {
      "pos": [
        36179,
        36540
      ],
      "content": "**Token signing keys**. Renew token signing keys periodically to\navoid denial of service. Azure AD Access Control signs all\nsecurity tokens it issues. 256-bit symmetric signing keys are used\nwhen you build an application that consumes SWT tokens issued by\nACS. When signing keys expire you will receive errors when trying to\nrequest a token.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Token signing keys**. Renew token signing keys periodically to",
          "pos": [
            0,
            64
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Token signing keys<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                23
              ]
            },
            {
              "content": "Renew token signing keys periodically to",
              "pos": [
                24,
                64
              ]
            }
          ]
        },
        {
          "content": "avoid denial of service. Azure AD Access Control signs all",
          "pos": [
            65,
            123
          ],
          "nodes": [
            {
              "content": "avoid denial of service.",
              "pos": [
                0,
                24
              ]
            },
            {
              "content": "Azure AD Access Control signs all",
              "pos": [
                25,
                58
              ]
            }
          ]
        },
        {
          "content": "security tokens it issues. 256-bit symmetric signing keys are used",
          "pos": [
            124,
            190
          ],
          "nodes": [
            {
              "content": "security tokens it issues.",
              "pos": [
                0,
                26
              ]
            },
            {
              "content": "256-bit symmetric signing keys are used",
              "pos": [
                27,
                66
              ]
            }
          ]
        },
        {
          "content": "when you build an application that consumes SWT tokens issued by",
          "pos": [
            191,
            255
          ]
        },
        {
          "content": "ACS. When signing keys expire you will receive errors when trying to",
          "pos": [
            256,
            324
          ],
          "nodes": [
            {
              "content": "ACS.",
              "pos": [
                0,
                4
              ]
            },
            {
              "content": "When signing keys expire you will receive errors when trying to",
              "pos": [
                5,
                68
              ]
            }
          ]
        },
        {
          "content": "request a token.",
          "pos": [
            325,
            341
          ]
        }
      ]
    },
    {
      "pos": [
        36545,
        36955
      ],
      "content": "**Token encryption certificates**. Renew token encryption\ncertificates periodically to avoid denial of service. Token\nencryption is required if a relying party application is a web\nservice using proof-of-possession tokens over the WS-Trust protocol,\nin other cases token encryption is optional. When encryption\ncertificates expire you will receive errors when trying to request a\ntoken.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Token encryption certificates**. Renew token encryption",
          "pos": [
            0,
            57
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Token encryption certificates<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                34
              ]
            },
            {
              "content": "Renew token encryption",
              "pos": [
                35,
                57
              ]
            }
          ]
        },
        {
          "content": "certificates periodically to avoid denial of service. Token",
          "pos": [
            58,
            117
          ],
          "nodes": [
            {
              "content": "certificates periodically to avoid denial of service.",
              "pos": [
                0,
                53
              ]
            },
            {
              "content": "Token",
              "pos": [
                54,
                59
              ]
            }
          ]
        },
        {
          "content": "encryption is required if a relying party application is a web",
          "pos": [
            118,
            180
          ]
        },
        {
          "content": "service using proof-of-possession tokens over the WS-Trust protocol,",
          "pos": [
            181,
            249
          ]
        },
        {
          "content": "in other cases token encryption is optional. When encryption",
          "pos": [
            250,
            310
          ],
          "nodes": [
            {
              "content": "in other cases token encryption is optional.",
              "pos": [
                0,
                44
              ]
            },
            {
              "content": "When encryption",
              "pos": [
                45,
                60
              ]
            }
          ]
        },
        {
          "content": "certificates expire you will receive errors when trying to request a",
          "pos": [
            311,
            379
          ]
        },
        {
          "content": "token.",
          "pos": [
            380,
            386
          ]
        }
      ]
    },
    {
      "pos": [
        36960,
        37382
      ],
      "content": "**Token decryption certificates**. Renew token decryption\ncertificates periodically to avoid denial of service. Azure\nAD Access Control can accept encrypted tokens from WS-Federation\nidentity providers (for example, AD FS 2.0). An X.509 certificate\nhosted in Azure AD Access Control is used for decryption.\nWhen decryption certificates expire you will receive errors when\ntrying to request a token.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Token decryption certificates**. Renew token decryption",
          "pos": [
            0,
            57
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Token decryption certificates<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                34
              ]
            },
            {
              "content": "Renew token decryption",
              "pos": [
                35,
                57
              ]
            }
          ]
        },
        {
          "content": "certificates periodically to avoid denial of service. Azure",
          "pos": [
            58,
            117
          ],
          "nodes": [
            {
              "content": "certificates periodically to avoid denial of service.",
              "pos": [
                0,
                53
              ]
            },
            {
              "content": "Azure",
              "pos": [
                54,
                59
              ]
            }
          ]
        },
        {
          "content": "AD Access Control can accept encrypted tokens from WS-Federation",
          "pos": [
            118,
            182
          ]
        },
        {
          "content": "identity providers (for example, AD FS 2.0). An X.509 certificate",
          "pos": [
            183,
            248
          ],
          "nodes": [
            {
              "content": "identity providers (for example, AD FS 2.0).",
              "pos": [
                0,
                44
              ]
            },
            {
              "content": "An X.509 certificate",
              "pos": [
                45,
                65
              ]
            }
          ]
        },
        {
          "content": "hosted in Azure AD Access Control is used for decryption.",
          "pos": [
            249,
            306
          ]
        },
        {
          "content": "When decryption certificates expire you will receive errors when",
          "pos": [
            307,
            371
          ]
        },
        {
          "content": "trying to request a token.",
          "pos": [
            372,
            398
          ]
        }
      ]
    },
    {
      "pos": [
        37387,
        37965
      ],
      "content": "**Service identity credentials**. Renew Service Identity credentials\nperiodically to avoid denial of service. Service identities use\ncredentials that are configured globally for your Azure AD\nAccess Control namespace that allow applications or clients to\nauthenticate directly with Azure AD Access Control and\nreceive a token. There are three credential types that Azure\nAD Access Control service identity can be associated with: Symmetric\nkey, Password, and X.509 certificate. You will start receiving\nexception when the credentials are expired.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Service identity credentials**. Renew Service Identity credentials",
          "pos": [
            0,
            68
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Service identity credentials<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                33
              ]
            },
            {
              "content": "Renew Service Identity credentials",
              "pos": [
                34,
                68
              ]
            }
          ]
        },
        {
          "content": "periodically to avoid denial of service. Service identities use",
          "pos": [
            69,
            132
          ],
          "nodes": [
            {
              "content": "periodically to avoid denial of service.",
              "pos": [
                0,
                40
              ]
            },
            {
              "content": "Service identities use",
              "pos": [
                41,
                63
              ]
            }
          ]
        },
        {
          "content": "credentials that are configured globally for your Azure AD",
          "pos": [
            133,
            191
          ]
        },
        {
          "content": "Access Control namespace that allow applications or clients to",
          "pos": [
            192,
            254
          ]
        },
        {
          "content": "authenticate directly with Azure AD Access Control and",
          "pos": [
            255,
            309
          ]
        },
        {
          "content": "receive a token. There are three credential types that Azure",
          "pos": [
            310,
            370
          ],
          "nodes": [
            {
              "content": "receive a token.",
              "pos": [
                0,
                16
              ]
            },
            {
              "content": "There are three credential types that Azure",
              "pos": [
                17,
                60
              ]
            }
          ]
        },
        {
          "content": "AD Access Control service identity can be associated with: Symmetric",
          "pos": [
            371,
            439
          ]
        },
        {
          "content": "key, Password, and X.509 certificate. You will start receiving",
          "pos": [
            440,
            502
          ],
          "nodes": [
            {
              "content": "key, Password, and X.509 certificate.",
              "pos": [
                0,
                37
              ]
            },
            {
              "content": "You will start receiving",
              "pos": [
                38,
                62
              ]
            }
          ]
        },
        {
          "content": "exception when the credentials are expired.",
          "pos": [
            503,
            546
          ]
        }
      ]
    },
    {
      "pos": [
        37970,
        38547
      ],
      "content": "**Azure AD Access Control Management Service account\ncredentials**. Renew Management service credentials periodically to\navoid denial of service. The Azure AD Access Control\nManagement Service is a key component that allows you to\nprogrammatically manage and configure settings for your \nAzure AD Access Control namespace. There are three credential types\nthat the Management service account can be associated with. These\nare symmetric key, password, and an X.509 certificate. You will\nstart receiving exception when the credentials are expired.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Azure AD Access Control Management Service account\ncredentials**. Renew Management service credentials periodically to",
          "pos": [
            0,
            120
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Azure AD Access Control Management Service account\ncredentials<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                67
              ]
            },
            {
              "content": "Renew Management service credentials periodically to",
              "pos": [
                68,
                120
              ]
            }
          ]
        },
        {
          "content": "avoid denial of service. The Azure AD Access Control",
          "pos": [
            121,
            173
          ],
          "nodes": [
            {
              "content": "avoid denial of service.",
              "pos": [
                0,
                24
              ]
            },
            {
              "content": "The Azure AD Access Control",
              "pos": [
                25,
                52
              ]
            }
          ]
        },
        {
          "content": "Management Service is a key component that allows you to",
          "pos": [
            174,
            230
          ]
        },
        {
          "content": "programmatically manage and configure settings for your",
          "pos": [
            231,
            286
          ]
        },
        {
          "content": "Azure AD Access Control namespace. There are three credential types",
          "pos": [
            288,
            355
          ],
          "nodes": [
            {
              "content": "Azure AD Access Control namespace.",
              "pos": [
                0,
                34
              ]
            },
            {
              "content": "There are three credential types",
              "pos": [
                35,
                67
              ]
            }
          ]
        },
        {
          "content": "that the Management service account can be associated with. These",
          "pos": [
            356,
            421
          ],
          "nodes": [
            {
              "content": "that the Management service account can be associated with.",
              "pos": [
                0,
                59
              ]
            },
            {
              "content": "These",
              "pos": [
                60,
                65
              ]
            }
          ]
        },
        {
          "content": "are symmetric key, password, and an X.509 certificate. You will",
          "pos": [
            422,
            485
          ],
          "nodes": [
            {
              "content": "are symmetric key, password, and an X.509 certificate.",
              "pos": [
                0,
                54
              ]
            },
            {
              "content": "You will",
              "pos": [
                55,
                63
              ]
            }
          ]
        },
        {
          "content": "start receiving exception when the credentials are expired.",
          "pos": [
            486,
            545
          ]
        }
      ]
    },
    {
      "pos": [
        38552,
        39226
      ],
      "content": "**WS-Federation identity provider signing and encryption\ncertificates**. Query for WS-Federation identity provider's\ncertificate validity to avoid denial of service. WS-Federation\nidentity provider certificate is available through its metadata.\nWhen configuring WS-Federation identity provider, such as AD FS, the\nWS-Federation signing certificate is configured through\nWS-Federation metadata available via URL or as a file. After the\nWS-Federation identity provider configured use Azure AD\nAccess Control management service to query it for its certificates\nvalidness. When the certificate expires you will start receiving\nexceptions.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**WS-Federation identity provider signing and encryption\ncertificates**. Query for WS-Federation identity provider's",
          "pos": [
            0,
            116
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>WS-Federation identity provider signing and encryption\ncertificates<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                72
              ]
            },
            {
              "content": "Query for WS-Federation identity provider's",
              "pos": [
                73,
                116
              ]
            }
          ]
        },
        {
          "content": "certificate validity to avoid denial of service. WS-Federation",
          "pos": [
            117,
            179
          ],
          "nodes": [
            {
              "content": "certificate validity to avoid denial of service.",
              "pos": [
                0,
                48
              ]
            },
            {
              "content": "WS-Federation",
              "pos": [
                49,
                62
              ]
            }
          ]
        },
        {
          "content": "identity provider certificate is available through its metadata.",
          "pos": [
            180,
            244
          ]
        },
        {
          "content": "When configuring WS-Federation identity provider, such as AD FS, the",
          "pos": [
            245,
            313
          ]
        },
        {
          "content": "WS-Federation signing certificate is configured through",
          "pos": [
            314,
            369
          ]
        },
        {
          "content": "WS-Federation metadata available via URL or as a file. After the",
          "pos": [
            370,
            434
          ],
          "nodes": [
            {
              "content": "WS-Federation metadata available via URL or as a file.",
              "pos": [
                0,
                54
              ]
            },
            {
              "content": "After the",
              "pos": [
                55,
                64
              ]
            }
          ]
        },
        {
          "content": "WS-Federation identity provider configured use Azure AD",
          "pos": [
            435,
            490
          ]
        },
        {
          "content": "Access Control management service to query it for its certificates",
          "pos": [
            491,
            557
          ]
        },
        {
          "content": "validness. When the certificate expires you will start receiving",
          "pos": [
            558,
            622
          ],
          "nodes": [
            {
              "content": "validness.",
              "pos": [
                0,
                10
              ]
            },
            {
              "content": "When the certificate expires you will start receiving",
              "pos": [
                11,
                64
              ]
            }
          ]
        },
        {
          "content": "exceptions.",
          "pos": [
            623,
            634
          ]
        }
      ]
    },
    {
      "content": "Shared Hosting Using Azure Websites",
      "pos": [
        39230,
        39265
      ]
    },
    {
      "content": "All scenarios and solutions outlined in this topic are valid when the",
      "pos": [
        39267,
        39336
      ]
    },
    {
      "content": "application is hosted on Azure Websites.",
      "pos": [
        39337,
        39377
      ]
    },
    {
      "content": "Azure Virtual Machines",
      "pos": [
        39381,
        39403
      ]
    },
    {
      "content": "All scenarios and solutions outlined in this topic are valid when the",
      "pos": [
        39405,
        39474
      ]
    },
    {
      "content": "application is hosted on Azure Virtual Machines.",
      "pos": [
        39475,
        39523
      ]
    },
    {
      "content": "Resources",
      "pos": [
        39527,
        39536
      ]
    },
    {
      "content": "Identity Developer Training Kit",
      "pos": [
        39543,
        39574
      ]
    },
    {
      "content": "MSDN-hosted Identity Developer Training Course",
      "pos": [
        39628,
        39674
      ]
    },
    {
      "content": "A Guide to Claims-based Identity and Access Control",
      "pos": [
        39728,
        39779
      ]
    },
    {
      "content": "Access Control Service",
      "pos": [
        39833,
        39855
      ]
    },
    {
      "content": "ACS How To's",
      "pos": [
        39924,
        39936
      ]
    },
    {
      "content": "Secure Azure Web Role ASP.NET Web Application Using Access Control Service v2.0",
      "pos": [
        40005,
        40084
      ]
    },
    {
      "content": "Azure AD Access Control Service (ACS) Academy Videos",
      "pos": [
        40161,
        40213
      ]
    },
    {
      "content": "Microsoft Security Development Lifecycle",
      "pos": [
        40290,
        40330
      ]
    },
    {
      "content": "SDL Threat Modeling Tool 3.1.8",
      "pos": [
        40389,
        40419
      ]
    },
    {
      "content": "Security and Privacy Blogs",
      "pos": [
        40500,
        40526
      ]
    },
    {
      "content": "Security Response Center",
      "pos": [
        40586,
        40610
      ]
    },
    {
      "content": "Security Intelligence Report",
      "pos": [
        40670,
        40698
      ]
    },
    {
      "content": "Security Development Lifecycle",
      "pos": [
        40745,
        40775
      ]
    },
    {
      "content": "Security Developer Center (MSDN)",
      "pos": [
        40834,
        40866
      ]
    }
  ],
  "content": "#Azure Security Guidance\n\n##Abstract\n\nWhen developing applications for Azure, identity and\naccess are the primary security concerns that you need to keep in mind.\nThis topic explains the key security concerns related to identity and access in the cloud and how you\ncan best protect your cloud applications.\n\n##Overview\n\nAn application's security is a function of its surface. The more surface\nthat the application exposes the greater the security concerns. For\nexample, an application that runs as an unattended batch process exposes\nless, from a security perspective, than a publicly available website.\n\nWhen you move to the cloud you gain a certain peace of mind about\ninfrastructure and networking since these are managed in data centers\nwith world-class security practices, tools, technology. On the other\nhand, the cloud intrinsically exposes more surface area for your\napplication that can be potentially exploited by attackers. This is\nbecause many cloud technologies and services are exposed as end points\nvs. in-memory components. Azure storage, Service Bus, SQL\nDatabase (formerly SQL Azure), and many other services are accessible\nvia their endpoints over the wire.\n\nIn cloud applications more responsibility lays on the shoulders of the\napplication developers to design, develop, and maintain their cloud\napplications to high security standards to keep attackers at bay.\nConsider the following diagram (from J.D. Meier's [Azure Security\nNotes PDF](http://blogs.msdn.com/b/jmeier/archive/2010/08/03/now-available-azure-security-notes-pdf.aspx)): notice how the infrastructure part is being addressed by the\ncloud provider--in our case by Azure--leaving more security work\nto the application developers:\n\n![Securing the application][01]\n\nThe good news is that all of the security development practices,\nprinciples, and techniques you already know still apply when developing\ncloud applications. Consider the following key areas that must be\naddressed:\n\n-   All input is validated for type, length, range, and string patterns\n    to avoid injection attacks, and all the data your app echoes back is\n    properly sanitized.\n-   Sensitive data should be protected at rest and on the wire to\n    mitigate information disclosure and data tampering threats.\n-   Auditing and logging must be properly implemented to mitigate non\n    repudiation threats.\n-   Authentication and Authorization should be implemented using proven\n    mechanisms offered by the platform to prevent identity spoofing and\n    elevation of privileges threats.\n\nFor a complete list of threats, attacks, vulnerabilities, and\ncountermeasures refer to patterns & practices' [Cheat Sheet: Web\nApplication Security Frame](http://msdn.microsoft.com/library/ff649461.aspx) and [Security Guidance for Applications Index](http://msdn.microsoft.com/library/ff650760.aspx).\n\nIn the cloud, authentication and access control mechanisms are very\ndifferent than those available for on-premises applications. There are\nmany more authentication and access options offered for cloud\napplications that can lead to confusion, and as a result, to flawed\nimplementations. More confusion is introduced when defining what a cloud\napp is. For example, the application could be deployed to the cloud yet\nits authentication mechanism might be provided by Active Directory. On\nother hand, the application could be deployed on-premises but with\nauthentication mechanisms in the cloud (for example, by Azure\nActive Directory Access Control (previously known as Access Control\nService or ACS)).\n\n##Threats, Vulnerabilities, and Attacks\n\nA threat is a potential bad outcome that you want to avoid such as the\ndisclosure of sensitive information or a service becoming unavailable.\nIt is common practice to classify threats by using the acronym \"STRIDE\":\n\n-   **S**poofing or identity theft\n-   **T**ampering with data\n-   **R**epudiation of actions\n-   **I**nformation disclosure\n-   **D**enial of service\n-   **E**levation of privileges\n\nVulnerabilities are bugs that we, as developers, introduce into the code\nthat make an application exploitable by attackers. For example, sending\nsensitive data in clear text makes an information disclosure threat\npossible by a traffic sniffing attack.\n\nAttacks are the exploitation of those vulnerabilities to cause harm to\nan application. For example, a Cross Site Scripting, or XSS, is an\nattack that exploits unsanitized output. Another example is\neavesdropping on the wire to capture credentials sent in clear. These\nattacks can lead to an identity spoof threat being realized. To make it\nsimple consider threats, vulnerabilities, and attacks as bad things.\nConsider the following diagrams as a balcony view of the bad things\nrelated to a Web application deployed to Azure (from J.D.\nMeier's [Azure Security Notes PDF](http://blogs.msdn.com/b/jmeier/archive/2010/08/03/now-available-azure-security-notes-pdf.aspx)):\n\n![Threats Vulnerabilities and Attacks][02]\n\nYou, as a developer, have control over the vulnerabilities. The fewer\nvulnerabilities that you introduce, the fewer options that are left to\nattacker to exploit.\n\nIdentity and access related vulnerabilities leave you open to all\nthreats in the STRIDE model. For example, an improperly implemented\nauthentication mechanism may lead to an identity spoof and, as a result,\ninformation disclosure, data tampering, elevated privileges operations,\nor even shutting down the service altogether. Consider the following\nquestions that may point to potential vulnerabilities in your cloud\napp's identity and access implementation:\n\n-   Are you sending credentials in clear over the wire to your\n    Azure services?\n-   Do you store Azure services credentials in clear?\n-   Do your Azure services credentials follow strong password\n    policies?\n-   Do you rely on Azure to verify credentials vs.\n    using custom verification mechanisms?\n-   Do you limit Azure services authentication sessions or token\n    lifetime to a reasonable time window?\n-   Do you verify permissions for each Azure entry point of your\n    distributed cloud app?\n-   Does your authorization mechanism fail securely without exposing\n    sensitive information, or without allowing limitless access?\n\n##Countermeasures\n\nThe best countermeasure against an attack is by using the identity and\naccess mechanisms offered by the platform rather than implementing your\nown. Consider the following prominent identity and access technologies:\n\n**Windows Identity Foundation (WIF).** WIF is a .NET runtime library\nincluded with the .NET Framework 4.5 (it is also available as separate\ndownload for .NET 3.5/4.0). WIF does the heavy lifting for handling\nprotocols such as WS-Federation and WS-Trust and tokens handling such as\nSecurity Assertion Markup Language (SAML) so you don't need to write\nvery complex security-related code in your application. The following\nresources provide in-depth information about WIF:\n\n-   [Windows Identity Foundation 4.5 Samples](http://code.msdn.microsoft.com/site/search?f%5B0%5D.Type=SearchText&f%5B0%5D.Value=wif&f%5B1%5D.Type=Topic&f%5B1%5D.Value=claims-based%20authentication) on MSDN Code Gallery.\n-   [Windows Identity Foundation 4.5 tools for Visual Studio 11 Beta](http://visualstudiogallery.msdn.microsoft.com/e21bf653-dfe1-4d81-b3d3-795cb104066e) on\n    MSDN Code Gallery.\n-   [Windows Identity Foundation runtime (.Net 3.5/4.0)](http://www.microsoft.com/download/details.aspx?id=17331) on MSDN.\n-   [Windows Identity Foundation 3.5/4.0 samples and Visual Studio\n    2008/2010 templates](http://www.microsoft.com/download/details.aspx?displaylang=en&id=4451) on MSDN.\n\n**Azure AD Access Control (previously known as ACS)**. \nAzure AD Access Control is a cloud service that provides Security Token\nService (STS) and allows federation with different identity providers\n(IdPs) such as a corporate Active Directory or Internet IdPs such as\nWindows Live ID / Microsoft Account, Facebook, Google, Yahoo!, and Open\nID 2.0 identity providers. The following resources provide in-depth\ninformation about Azure AD Access Control:\n\n-   [Access Control Service 2.0](http://msdn.microsoft.com/library/gg429786.aspx) \n-   [Scenarios and Solutions Using ACS](http://msdn.microsoft.com/library/gg185920.aspx)\n-   [ACS How To's](http://msdn.microsoft.com/library/windowsazure/gg185939.aspx)\n-   [A Guide to Claims-Based Identity and Access Control](http://msdn.microsoft.com/library/ff423674.aspx)\n-   [Identity Developer Training Kit](http://www.microsoft.com/download/details.aspx?id=14347)\n-   [MSDN-hosted Identity Developer Training Course](http://msdn.microsoft.com/IdentityTrainingCourse)\n\n**Active Directory Federation Services (AD FS).**Active Directory\nFederation Services (AD FS) 2.0 provides support for claims-aware\nidentity solutions that involve Windows Server?? and Active Directory\ntechnology. AD FS 2.0 supports the WS-Trust, WS-Federation, and SAML\nprotocols. The following resources provide in-depth information about AD\nFS:\n\n-   [AD FS 2.0 Content Map](http://social.technet.microsoft.com/wiki/contents/articles/2735.ad-fs-2-0-content-map.aspx)\n-   [Web SSO Design][Web SSO Design]\n-   [Federated Web SSO Design][Federated Web SSO Design]\n\n**Azure Shared Access Signatures.** Shared Access Signatures\nenable you to fine-tune access to a blob or container resource. The\nfollowing resources provide in-depth information about Shared Access\nSignatures.\n\n-   [Managing Access to Blobs and Containers](http://msdn.microsoft.com/library/ee393343.aspx)\n-   [New Storage Feature: Shared Access Signatures](http://blog.smarx.com/posts/new-storage-feature-signed-access-signatures)\n-   [Shared Access Signatures Are Easy These Days](http://blog.smarx.com/posts/shared-access-signatures-are-easy-these-days)\n\n##Scenarios Map\n\nThis section briefly outlines the key scenarios covered in this topic.\nUse it as a map to determine the right identity solution for your\napplication.\n\n-   **ASP.NET Web Form Application with Federated Authentication.** In\n    this scenario you control access to your ASP.NET Web Forms app using\n    either Internet identity such as Live ID / Microsoft Account or\n    corporate identity managed in Windows Server Active Directory.\n-   **WCF (SOAP) Service with Federated Authentication.**In this\n    scenario you control access to your WCF (SOAP) service using Service\n    Identities managed by Azure AD Access Control.\n-   **WCF (SOAP) Service with Federated Authentication, Identities in\n    Active Directory.** In this scenario you control access to your WCF\n    (SOAP) web service using identities managed by corporate Windows\n    Server Active Directory.\n-   **WCF (REST) Service With Federated Authentication.**In this\n    scenario you control access to your WCF (REST) service using Service\n    Identities managed by Azure AD Access Control.\n-   **WCF (REST) Service With Live ID / Microsoft Account, Facebook,\n    Google, Yahoo!, Open ID.** In this scenario you control access to\n    your WCF (REST) service using Internet identity such as Live ID /\n    Microsoft Account.\n-   **ASP.NET Web App to REST WCF Service Using Shared SWT Token.** In\n    this scenario you have distributed application with front end\n    ASP.NET web app and downstream REST service and you want to flow end\n    user's context through physical tiers.\n-   **Role-Based Access Control (RBAC) Authorization In Claims-Aware\n    Applications and Services.** In this scenario you want to implement\n    authorization logic in your app based on roles.\n-   **Claims-Based Authorization In Claims-Aware Applications and\n    Services.** In this scenario you want to implement authorization\n    logic in your app based on complex authorization rules.\n-   **Azure Storage Service Identity and Access Scenarios.**In\n    this scenario you need to securely share access to Azure\n    storage blobs and containers.\n-   **Azure SQL Database Identity and Access Scenarios.**SQL\n    Database supports only SQL Server Authentication. Windows\n    Authentication (integrated security) is not supported. Users must\n    provide credentials (login and password) every time they connect to\n    SQL Database.\n-   **Azure Service Bus Identity and Access Scenarios.**In this\n    scenario you need securely access Azure Service Bus queues.\n-   **In-Memory Cache Identity and Access Scenarios.**In this scenario\n    you need to securely access data managed by in-memory cache.\n-   **Azure Marketplace Identity and Access Scenarios.**In this\n    scenario you need to securely access Azure Marketplace\n    datasets.\n\n##Azure Identity and Access Scenarios\n\nThis section outlines common identity and access scenarios for different\napplication architectures. Use the Scenarios Map for a quick\norientation.\n\n###ASP.NET Web Form Application with Federated Authentication\n\nIn this application architecture scenario your web application may be\ndeployed to Azure or on-premises. The application requires that\nits users will be authenticated by either corporate Active Directory or\nInternet identity providers.\n\nTo solve this scenarios use Azure AD Access control and Windows\nIdentity Foundation.\n\n![Azure Active Directory Access control][03]\n\nRefer to the following resources to implement this scenario:\n\n-   [How To: Create My First Claims-Aware ASP.NET Application Using ACS](http://msdn.microsoft.com/library/gg429779.aspx)\n-   [How To: Host Login Pages in Your ASP.NET Web Application](http://msdn.microsoft.com/library/gg185926.aspx)\n-   [How To: Implement Claims Authorization in a Claims-Aware ASP.NET Application Using WIF and ACS](http://msdn.microsoft.com/library/gg185907.aspx)    \n-   [How To: Implement Role Based Access Control (RBAC) in a Claims-Aware\n    ASP.NET Application Using WIF and ACS](http://msdn.microsoft.com/library/gg185914.aspx)\n-   [How To: Configure Trust Between ACS and ASP.NET Web Applications\n    Using X.509 Certificates](http://msdn.microsoft.com/library/gg185947.aspx)\n-   [Code Sample: ASP.NET Simple Forms](http://msdn.microsoft.com/library/gg185938.aspx)\n\n###WCF (SOAP) Service with Service Identity\n\nIn this application architecture scenario your WCF (SOAP) service may be\ndeployed to Azure or on-premises. The service is being accessed\nas a downstream service by a web application or even by another web\nservice. You need to control access to it using application specific\nidentity. Think of it in terms of the type of app pool account that you\nused in IIS - although the technology is different, the approaches are\nsimilar in that the service is accessed using an application scope\naccount vs. end user account.\n\nUse the Service Identity feature in Azure AD Access control.\nThis is similar to the IIS app pool account you were using when\ndeploying your apps to Windows Server and IIS. Configure Azure\nAD Access Control to issue SAML tokens that will be handled by WIF at\nthe WCF (SOAP) service.\n\n![WCF (SOAP) Service][04]\n\n\nRefer to the following resources to implement this scenario:\n\n-   [How To: Add Service Identities with an X.509 Certificate, Password,\n    or Symmetric Key](http://msdn.microsoft.com/library/gg185924.aspx)\n-   [How To: Authenticate with a Client Certificate to a WCF Service\n    Protected by ACS](http://msdn.microsoft.com/library/hh289316.aspx)\n-   [How To: Authenticate with a Username and Password to a WCF Service\n    Protected by ACS](http://msdn.microsoft.com/library/gg185954.aspx)\n-   [Code Sample: WCF Certificate Authentication](http://msdn.microsoft.com/library/gg185952.aspx)\n-   [Code Sample: WCF Username Authentication](http://msdn.microsoft.com/library/gg185927.aspx)\n\n###WCF (SOAP) Service With Federated Authentication, Identities In Active Directory\n\nIn this application architecture scenario your WCF (SOAP) service may be\ndeployed to Azure or on-premises. You need to control access to\nit by using an identity that is managed by a corporate Windows Server\nActive Directory (AD).\n\nUse Azure AD Access Control configured for federation with\nWindows Server AD FS. In this case you do not need to configure Service\nIdentity with Azure AD Access Control. The agent that needs to\naccess the WCF (SOAP) service provides credentials to AD FS and upon\nsuccessful authentication is issued the token by AD FS. The token is\nthen submitted to Azure AD Access Control and reissued back to\nthe agent. The agent uses the token to submit request to the WCF (SOAP)\nservice.\n\n![WCF (SOAP) Service With AD][05]\n\nRefer to the following resources to implement this scenario:\n\n-   [How To: Add Service Identities with an X.509 Certificate, Password,\n    or Symmetric Key](http://msdn.microsoft.com/library/gg185924.aspx)\n-   [How To: Configure AD FS 2.0 as an Identity Provider](http://msdn.microsoft.com/library/gg185961.aspx)\n-   [How To: Use Management Service to Configure AD FS 2.0 as an\n    Enterprise Identity Provider](http://msdn.microsoft.com/library/gg185905.aspx)\n-   [Code Sample: WCF Federated Authentication With AD FS 2.0\n](http://msdn.microsoft.com/library/hh127796.aspx)\n\n###WCF (REST) Service With Service Identities\n\nIn this scenario your WCF (REST) service may be deployed to \nAzure or on-premises. The service is accessed as a downstream service by\na web application or by another web service. You need to control access\nto it using an application-specific identity Think of it in terms of the\ntype of app pool account that you used in IIS - although the technology\nis different, the approaches are similar in that the service is accessed\nusing an application scope account vs. end user account.\n\nUse the Service Identity feature in Azure AD Access Control.\nConfigure Azure AD Access Control to issue Simple Web Token\n(SWT) tokens. To handle the SWT token on the REST service side, you can\neither implement a custom token handler and plug it into the WIF\npipeline, or you can parse it \"manually\" without using the WIF\ninfrastructure.\n\nConsider the following diagram (WIF is optional):\n\n![REST Service][06]\n\nRefer to the following resources to implement this scenario:\n\n-   [How To: Configure Trust Between ACS and WCF Service Using Symmetric\n    Keys](http://msdn.microsoft.com/library/gg185958.aspx)\n-   [How To: Authenticate to a REST WCF Service Deployed to Azure\n    Using ACS](http://msdn.microsoft.com/library/hh289317.aspx)\n-   [Code Sample: ASP.NET Web Service](http://msdn.microsoft.com/library/gg983271.aspx)\n-   [Code Sample: Windows Phone 7 Application](http://msdn.microsoft.com/library/gg983271.aspx)\n-   [REST WCF With SWT Token Issued By Azure Access Control\n    Service (ACS)](http://code.msdn.microsoft.com/REST-WCF-With-SWT-Token-123d93c0)\n\n###WCF (REST) Service with Live ID / Microsoft Account, Facebook, Google, Yahoo!, Open ID\n\nIn this scenario, your WCF (REST) service can be deployed to \nAzure or on-premises. You need to control access to it using a public\nInternet identity, such as Live ID / Microsoft Account or Facebook.\n\nUse Azure AD Access Control to issue SWT tokens. To handle the\nSWT token on the REST service side, you can implement a custom token\nhandler and plug it into a WIF pipeline, or you can parse it \"manually\"\nwithout using the WIF infrastructure.\n\nIt is important to note that in order to implement this scenario, the\napplication needs to use web browser control to collect end user\ncredentials. This makes it unsuitable for scenarios in which the REST\nservice is accessed from an ASP.NET web app. It is only suitable for\nscenarios in which the REST service is being accessed by the user's\nclient application, such as a Windows Phone 7 app or a rich desktop\nclient. The key reason for popping the web browser control is that\nInternet identities don't natively support active profile scenarios (web\nservices scenario). Internet identities mainly support passive profile\nscenarios (web apps) that rely on browser redirects: this is where web\nbrowser control comes handy.\n\nConsider the following diagram (WIF is optional, and thus not shown):\n\n![WIF is optional][07]\n\nRefer to the following resources to implement this scenario:\n\n-   [How To: Authenticate to a REST WCF Service Deployed to Azure Using ACS](http://msdn.microsoft.com/library/hh289317.aspx)\n-   [How To: Configure Google as an Identity Provider](http://msdn.microsoft.com/library/gg185976.aspx)\n-   [How To: Configure Facebook as an Identity Provider](http://msdn.microsoft.com/library/gg185919.aspx)\n-   [How To: Configure Yahoo! as an Identity Provider](http://msdn.microsoft.com/library/gg185977.aspx)\n-  [ Code Sample: Windows Phone 7 Application](http://msdn.microsoft.com/library/gg983271.aspx)\n-   [REST WCF With SWT Token Issued By Azure Access Control\n    Service (ACS)](http://code.msdn.microsoft.com/REST-WCF-With-SWT-Token-123d93c0)\n\n\n###ASP.NET Web App to REST WCF Service Using Shared SWT Token\n\nIn this scenario you have a distributed application with a front-end\nASP.NET web app and a downstream REST service and you want to maintain\nthe end user's context across physical tiers. This is sometimes needed\nwhen implementing authorization logic or logging based on the end user's\nidentity in the downstream REST service.\n\nConfigure Azure AD Access Control to issue SWT token. The SWT\ntoken is issued to the front-end ASP.NET web app and then shared with\nthe downstream REST service. In this case, there is only one relying\nparty configured in Azure AD Access Control. However, there are\nseveral caveats:\n\n-   Since WIF does not provide a SWT token handler out of the box you\n    need to implement a custom token handler to be used with the ASP.NET\n    web app. You should rely on the heavy lifting that WIF does to\n    support the WS-Federation protocol that relies on browser redirects\n    vs. implementing it yourself.\n-   When implementing a SWT custom token handler, make sure the\n    bootstrap token is being addressed to make sure it's retained.\n    Otherwise you won't be able to share it and send it to the\n    downstream REST service.\n-   You don't have to use WIF on a REST service; rather, you can parse\n    the token \"manually\" since there is no need to handle redirects in\n    this case.\n\n![ASP.NET Web Application][08]\n\nRefer to the following resources to implement this scenario:\n\n-   [How To: Configure Google as an Identity Provider](http://msdn.microsoft.com/library/gg185976.aspx)\n-   [How To: Configure Facebook as an Identity Provider](http://msdn.microsoft.com/library/gg185919.aspx)\n-   [How To: Configure Yahoo! as an Identity Provider](http://msdn.microsoft.com/library/gg185977.aspx)\n-   [ASP.NET Web App To REST WCF Service Delegation Using Shared SWT\n    Token](http://code.msdn.microsoft.com/ASPNET-Web-App-To-REST-WCF-b2b95f82)\n\n###Role-Based Access Control (RBAC) In Claims-Aware Applications and Services\n\nIn this scenario you need to implement authorization in your web\napplication or service based on user roles: user with required roles get\naccess and those that don't have required roles are denied. Simply put,\nyour application needs to answer simple question - is the user in role\nX?\n\nThere are several ways to solve this scenario. You can use Azure\nAD Access Control, WIF Claims Authentication Manager,\nsamlSecurityTokenRequirement mapping, or Customer Role Manager.\n\nWIF is used in all cases. WIF supports the IPrincipal.IsInRole(\"MyRole\")\nmethod. In most of the cases the key is to make sure there is role type\nclaim with URI of\nhttp://schemas.microsoft.com/ws/2008/06/identity/claims/role in the\ntoken so that WIF can successfully verify role membership when the\nIsInRole method is called.\n\n**Azure AD Access Control**. In this implementation the \nAzure AD Access Control claims transformation rule engine is used. Using\nthe claims transformation rule engine rules you can transform any\nincoming claim into a role type claim so that when the token hits the\napplication or a service WIF can parse this role claim to make sure\nIsInRole method call is succesful.\n\n![][09]\n\n**WIF ClaimsAuthenticationManager**. In this implementation use\nClaimsAuthenticationManager as WIF's extensibility point. Using this\napproach you transform any arbitrary incoming claims to a role claim\ntype at the application. The complexity of the transformation is only\nlimited by the code you write.\n\n![][10]\n\n**samlSecurityTokenRequriement mapping**. In this implementation you use\nthe samlSecurityTokenRequirement configuration in web.config to tell WIF\nwhich claim types behave as if they were role claim types. For example,\nif the token carries a claim of group type, you can map it to role claim\ntype. You can achieve only simple mappings using this approach.\n\n![][11]\n\n**Custom RoleManager.** In this implementation you implement custom\nRoleManger. WIF is used to inspect the incoming claims when implementing\ncustom RoleManager interface methods such as GetAllRoles().\n\n![][12]\n\nRefer to the following resources to implement this scenario:\n\n-   [How To: Implement Role Based Access Control (RBAC) in a Claims-Aware\n    ASP.NET Application Using WIF and ACS](http://msdn.microsoft.com/library/gg185914.aspx)\n-   [How To: Implement Token Transformation Logic Using Rules](http://msdn.microsoft.com/library/gg185955.aspx)\n-   [Authorization With RoleManager For Claims Aware (WIF) ASP.NET Web\n    Applications](http://blogs.msdn.com/b/alikl/archive/2010/11/18/authorization-with-rolemanager-for-claims-aware-wif-asp-net-web-applications.aspx)\n-   Code Sample: Using Claims In IsInRole in [Windows Identity Foundation\n    SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=c148b2df-c7af-46bb-9162-2c9422208504)\n\n###Claims-Based Authorization In Claims-Aware Applications and Services\n\nIn this scenario you need to implement complex authorization logic in\nyour web application or service and the IsInRole() method is not\nsatisfactory for your authorization needs. If your authorization\napproach relies on roles then consider implementing role-based access\ncontrol outlined in previous section.\n\nUse ClaimsAuthorizationManager as the WIF extensibility point.\nClaimsAuthorizationManager allows external access check calls so that\nyour application code looks cleaner and more maintainable than when\naccess checks implemented in the application's code.\n\n![][13]\n\nRefer to the following resources to implement this scenario:\n\n-   [How To: Implement Token Transformation Logic Using Rules](http://msdn.microsoft.com/library/gg185955.aspx)\n-   [How To: Implement Claims Authorization in a Claims-Aware ASP.NET\n    Application Using WIF and ACS](http://msdn.microsoft.com/library/gg185907.aspx)\n-   Code Sample: Claims based Authorization in [Windows Identity\n    Foundation SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=c148b2df-c7af-46bb-9162-2c9422208504)\n\n\n##Azure Storage Service Identity and Access Scenarios\n\nIn this scenario you need to securely share access to Azure\nstorage blobs and containers.\n\nUse Shared Access Signatures. To access your storage service account\nfrom your own application, use the shared hash that is available through\nAzure portal when you configure and manage your storage service\naccounts. When you want to give someone else access to the blobs and\ncontainers in your storage service account use Shared Access Signatures\nURL's.\n\nPay special attention to securely managing the information to avoid its\nexposure; also, pay special attention to the lifetime of the Shared\nAccess Signatures.\n\n![][14]\n\nRefer to the following resources to solve this scenario\n\n-   [Managing Access to Blobs and Containers](http://msdn.microsoft.com/library/ee393343.aspx)\n-   [New Storage Feature: Shared Access Signatures](http://blog.smarx.com/posts/new-storage-feature-signed-access-signatures)\n-   [Shared Access Signatures Are Easy These Days](http://blog.smarx.com/posts/shared-access-signatures-are-easy-these-days)\n\n\n## Azure SQL Database Identity and Access Scenarios\n\n\nSQL Database only supports SQL Server Authentication. Windows\nAuthentication (integrated security) is not supported. Users must\nprovide credentials (login and password) every time they connect to a\nSQL Database. Pay special attention when managing your username and\npassword to avoid information disclosure.\n\n\n![][15]\n\n\nTo solve this scenario, refer to the following Help topic:<br/>\n[Azure SQL Database Development: How-to Topics](http://msdn.microsoft.com/library/azure/ee621787.aspx)\n\n\nOr refer to one of its many child topics, some of which are:\n\n\n- [How to: Connect to SQL Database Using sqlcmd](http://msdn.microsoft.com/library/azure/ee336280.aspx)\n- [Code sample: Retry logic for connecting to Azure SQL Database with ADO.NET](http://msdn.microsoft.com/library/azure/ee336243.aspx)\n- [How to: Connect to SQL Database Using PHP](http://msdn.microsoft.com/library/azure/ff394110.aspx)\n- [How to: Connect to SQL Database Using JDBC](http://msdn.microsoft.com/library/azure/gg715284.aspx)\n\n\nOr refer to:<br/>\n[Azure SQL Database Security Guidelines and Limitations](http://msdn.microsoft.com/library/azure/ff394108.aspx#authentication)\n\n\n##Azure Service Bus Identity and Access Scenarios\n\nThe Service Bus and Azure AD Access Control have a special\nrelationship in that each Service Bus service namespace is paired with a\nmatching Access Control service namespace of the same name, with the\nsuffix \"-sb\". The reason for this special relationship is in the way\nthat Service Bus and Access Control manage their mutual trust\nrelationship and the associated cryptographic secrets. Refer to the\nresources listed below for more details.\n\n![][16]\n\nRefer to the following resources to solve this scenario:\n\n-   [Securing Service Bus with ACS](http://channel9.msdn.com/posts/Securing-Service-Bus-with-ACS) (Video)\n-   [Securing Service Bus with ACS](https://skydrive.live.com/view.aspx?cid=123CCD2A7AB10107&resid=123CCD2A7AB10107%211849) (Slides)\n-   [Service Bus Authentication and Authorization with the Access Control\n    Service](http://msdn.microsoft.com/library/hh403962.aspx)\n\n##In-Memory Cache Identity and Access Scenarios\n\nIn-memory cache (formerly known as Azure Cache) relies on\nAzure AD Access Control for authentication. It uses shared keys\navailable through the management portal. Use the keys in your code or\nconfiguration files when accessing the cache. Be sure to store the keys\nsecurely so as to avoid information disclosure.\n\n![][17]\n\n\nRefer to the following resources to solve this scenario:\n\n-   [How to: Configure a Cache Client Programmatically for Azure\n    Caching](http://msdn.microsoft.com/library/windowsazure/gg618003.aspx)\n-   [How to: Configure a Cache Client using the Application Configuration\n    File for Azure Caching](http://msdn.microsoft.com/library/windowsazure/gg278346.aspx)\n-   [Azure Service Bus and Caching Samples](http://msdn.microsoft.com/library/ee706741.aspx) (Caching Samples\n    section)\n\n##Azure Marketplace Identity and Access Scenarios\n\nEvery access to an Azure Marketplace dataset, whether free or\npaid, must authenticate the user before access is granted. When you\ncreate an application the authentication process must be included in\nyour code. Consider the following common scenarios:\n\n###I Access My Dataset\n\nIn this scenario you are building an application that consumes datasets\nin your Marketplace subscription. You are the user of the application.\nThe application can be deployed either to Azure, on-premises, or Marketplace.\n\nUse the shared key that's available through your Marketplace\nsubscription. You obtain the shared key using the Marketplace portal.\n\n![][18]\n\nRefer to the following resources to solve this scenario:\n\n-   [Use HTTP Basic Auth in your Marketplace App](http://msdn.microsoft.com/library/gg193417.aspx)\n\n###Users Access My Datasets\n\nIn this scenario you are building an application that allows users to\naccess your dataset. The application can be deployed on Azure,\non-premises, or Marketplace.\n\nTo solve this scenario, use OAuth delegation. Users will be prompted to\nprovide their Live ID / Microsoft Account credentials, and then they\nwill be taken through the consent process.\n\n![][19]\n\nRefer to the following resources to solve this scenario:\n\n-   [OAuth Web Client Example](http://go.microsoft.com/fwlink/?LinkId=219162)\n-   [OAuth Rich Client Example](http://go.microsoft.com/fwlink/?LinkId=219163)\n\n###Application Access Marketplace API\n\nIn this scenario you are building an application that accesses the\nMarketplace API. The Marketplace API requires authentication to\nsuccessfully accomplish calls to it. The application is deployed to\nAzure Marketplace.\n\n![][20]\n\nConsult the Marketplace publishing kit for details about the\nauthentication implementation.\n\nRefer to the following resources to solve this scenario:\n\n-   [Download the App Publishing Kit](http://go.microsoft.com/fwlink/?LinkId=221323)\n-   [Introduction to Azure Marketplace for Applications](https://datamarket.azure.com/)\n\n##Security Knobs\n\nThis section outlines security knobs for Windows Identity Foundation and\nAzure AD Access Control. Use it as a basic security checklist\nfor these technologies when designing and deploying your application.\n\n###Windows Identity Foundation\n\nThe following are key security knobs of WIF. The information below is a\ndigest from [WIF Design Considerations](http://msdn.microsoft.com/library/ee517298.aspx) and [Windows Identity Foundation\n(WIF) Security for ASP.NET Web Applications - Threats & Countermeasures](http://blogs.msdn.com/b/alikl/archive/2010/12/02/windows-identity-foundation-wif-security-for-asp-net-web-applications-threats-amp-countermeasures.aspx)\n.\n\n-   **IssuerNameRegistry**. Specifies trusted Security Token Services\n    (STS's). Make sure only trusted STS are listed.\n-   **cookieHandler requireSsl=\"true\"**. Specifies whether session\n    cookies transferred over the SSL protocol.\n-   **wsFederation's requireHttps=\"true\"**. Specifies whether the\n    federation protocol communication with identity provider performed\n    over SSL protocol.\n-   **tokenReplayDetection enabled=\"true\"**. Specifies whether token\n    replay detection feature is enabled. Be aware that this feature\n    creates server affinity as it manages local copies of used tokens.\n-   **audienceUris**. Specifies intended audience of the token. If your\n    application receives a token that was not intended for your app it\n    will be rejected by WIF.\n-   **requestValidation** and **httpRuntime requestValidationType**.\n    Enables/disables ASP.NET validation feature. See guidance as\n    outlined in [Windows Identity Foundation (WIF): A Potentially\n    Dangerous Request.Form Value Was Detected from the Client](http://social.technet.microsoft.com/wiki/contents/articles/1725.windows-identity-foundation-wif-a-potentially-dangerous-request-form-value-was-detected-from-the-client-wresult-t-requestsecurityto.aspx)\n\n###Azure AD Access Control\n\nConsider the following security knobs in Azure AD Access Control\ndeployment. The information below is a digest from [ACS Security\nGuidelines](http://msdn.microsoft.com/library/gg185962.aspx) and [Certificates and Keys Management Guidelines](http://msdn.microsoft.com/library/hh204521.aspx).\n\n-   **STS tokens expiration**. Use Azure AD Access Control\n    management portal to set aggressive token expiration.\n-   **Data validation when using the Error URL feature**. Azure\n    AD Access Control Error URL feature requires anonymous access to the\n    app's page where it sends error messages. Assume all data coming to\n    this page as dangerous from untrusted source.\n-   **Encrypting tokens for highly sensitive scenarios**. To mitigate\n    threat of information disclosure that available in the token\n    consider encrypting the tokens.\n-   **Encrypting cookies using RSA when deploying to Azure**.\n    WIF encrypts cookies using DPAPI by default. It creates server\n    affinity and may result in exceptions when deployed to web farm and\n    Azure environments. Use RSA instead in web farm and \n    Azure scenarios.\n-   **Token signing certificates**. Renew token signing certificates\n    periodically to avoid denial of service. Azure AD Access\n    Control signs all security tokens it issues. X.509 certificates are\n    used for signing when you build an application that consumes SAML\n    tokens issued by ACS. When signing certificates expire you will\n    receive errors when trying to request a token.\n-   **Token signing keys**. Renew token signing keys periodically to\n    avoid denial of service. Azure AD Access Control signs all\n    security tokens it issues. 256-bit symmetric signing keys are used\n    when you build an application that consumes SWT tokens issued by\n    ACS. When signing keys expire you will receive errors when trying to\n    request a token.\n-   **Token encryption certificates**. Renew token encryption\n    certificates periodically to avoid denial of service. Token\n    encryption is required if a relying party application is a web\n    service using proof-of-possession tokens over the WS-Trust protocol,\n    in other cases token encryption is optional. When encryption\n    certificates expire you will receive errors when trying to request a\n    token.\n-   **Token decryption certificates**. Renew token decryption\n    certificates periodically to avoid denial of service. Azure\n    AD Access Control can accept encrypted tokens from WS-Federation\n    identity providers (for example, AD FS 2.0). An X.509 certificate\n    hosted in Azure AD Access Control is used for decryption.\n    When decryption certificates expire you will receive errors when\n    trying to request a token.\n-   **Service identity credentials**. Renew Service Identity credentials\n    periodically to avoid denial of service. Service identities use\n    credentials that are configured globally for your Azure AD\n    Access Control namespace that allow applications or clients to\n    authenticate directly with Azure AD Access Control and\n    receive a token. There are three credential types that Azure\n    AD Access Control service identity can be associated with: Symmetric\n    key, Password, and X.509 certificate. You will start receiving\n    exception when the credentials are expired.\n-   **Azure AD Access Control Management Service account\n    credentials**. Renew Management service credentials periodically to\n    avoid denial of service. The Azure AD Access Control\n    Management Service is a key component that allows you to\n    programmatically manage and configure settings for your \n    Azure AD Access Control namespace. There are three credential types\n    that the Management service account can be associated with. These\n    are symmetric key, password, and an X.509 certificate. You will\n    start receiving exception when the credentials are expired.\n-   **WS-Federation identity provider signing and encryption\n    certificates**. Query for WS-Federation identity provider's\n    certificate validity to avoid denial of service. WS-Federation\n    identity provider certificate is available through its metadata.\n    When configuring WS-Federation identity provider, such as AD FS, the\n    WS-Federation signing certificate is configured through\n    WS-Federation metadata available via URL or as a file. After the\n    WS-Federation identity provider configured use Azure AD\n    Access Control management service to query it for its certificates\n    validness. When the certificate expires you will start receiving\n    exceptions.\n\n##Shared Hosting Using Azure Websites\n\nAll scenarios and solutions outlined in this topic are valid when the\napplication is hosted on Azure Websites.\n\n##Azure Virtual Machines\n\nAll scenarios and solutions outlined in this topic are valid when the\napplication is hosted on Azure Virtual Machines.\n\n##Resources\n\n-   [Identity Developer Training Kit](http://go.microsoft.com/fwlink/?LinkId=214555)\n-   [MSDN-hosted Identity Developer Training Course](http://go.microsoft.com/fwlink/?LinkId=214561)\n-   [A Guide to Claims-based Identity and Access Control](http://go.microsoft.com/fwlink/?LinkId=214562)\n-   [Access Control Service](http://msdn.microsoft.com/library/windowsazure/gg429786.aspx)\n-   [ACS How To's](http://msdn.microsoft.com/library/windowsazure/gg185939.aspx)\n-   [Secure Azure Web Role ASP.NET Web Application Using Access Control Service v2.0](http://social.technet.microsoft.com/wiki/contents/articles/2590.aspx)\n-   [Azure AD Access Control Service (ACS) Academy Videos](http://social.technet.microsoft.com/wiki/contents/articles/2777.aspx)\n-   [Microsoft Security Development Lifecycle](http://www.microsoft.com/security/sdl/default.aspx)\n-   [SDL Threat Modeling Tool 3.1.8](http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=2955)\n-   [Security and Privacy Blogs](http://www.microsoft.com/about/twc/en/us/blogs.aspx)\n-   [Security Response Center](http://www.microsoft.com/security/msrc/default.aspx)\n-   [Security Intelligence Report](http://www.microsoft.com/security/sir/)\n-   [Security Development Lifecycle](http://www.microsoft.com/security/sdl/default.aspx)\n-   [Security Developer Center (MSDN)](http://msdn.microsoft.com/security/)\n\n\n[01]:./media/SecurityRX/01_SecuringTheApplication.gif\n[02]:./media/SecurityRX/02_ThreatsVulnerabilitiesandAttacks.gif\n[03]:./media/SecurityRX/03_WindowsAzureADAccesscontrol.gif\n[04]:./media/SecurityRX/04_WCF(SOAP)Service.gif\n[05]:./media/SecurityRX/05_AzureADAccessControl.gif\n[06]:./media/SecurityRX/06_RESTService.gif\n[07]:./media/SecurityRX/07_WIFisOptional.gif\n[08]:./media/SecurityRX/08_ASPNETWebApptoREST.gif\n[09]:./media/SecurityRX/09_RBAC.gif\n[10]:./media/SecurityRX/10_WIFClaimsAuthenticationManager.gif\n[11]:./media/SecurityRX/11_SecurityTokenRequriementmapping.gif\n[12]:./media/SecurityRX/12_CustomRoleManager.gif\n[13]:./media/SecurityRX/13_ClaimsAuthorizationManager.gif\n[14]:./media/SecurityRX/14_WindowsAzurestorage.gif\n[15]:./media/SecurityRX/15_SQLAzureIdentityandAccessScenarios.gif\n[16]:./media/SecurityRX/16_WindowsAzureServiceBusIdentity.gif\n[17]:./media/SecurityRX/17_WindowsAzureCacheIdentity.gif\n[18]:./media/SecurityRX/18_IAccessMyDataset.gif\n[19]:./media/SecurityRX/19_UsersAccessMyDatasets.gif\n[20]:./media/SecurityRX/20_ApplicationAccessMarketplaceAPI.gif\n\n[Web SSO Design]: http://technet.microsoft.com/library/dd807033(WS.10).aspx\n[Federated Web SSO Design]: http://technet.microsoft.com/library/dd807050(WS.10).aspx\n"
}