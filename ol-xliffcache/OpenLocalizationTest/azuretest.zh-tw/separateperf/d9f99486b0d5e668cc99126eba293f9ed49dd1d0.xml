{
  "nodes": [
    {
      "content": "Use R in HDInsight to customize clusters | Microsoft Azure",
      "pos": [
        27,
        85
      ]
    },
    {
      "content": "Learn how to install and use R to customize Hadoop clusters.",
      "pos": [
        104,
        164
      ]
    },
    {
      "content": "Install and use R on HDInsight Hadoop clusters",
      "pos": [
        488,
        534
      ]
    },
    {
      "content": "You can install R on any type of cluster in Hadoop on HDInsight by using <bpt id=\"p1\">**</bpt>Script Action<ept id=\"p1\">**</ept> cluster customization.",
      "pos": [
        536,
        649
      ]
    },
    {
      "content": "This enables data scientists and analysts to use R to deploy the powerful MapReduce/YARN programming framework to process large amounts of data on Hadoop clusters that are deployed in HDInsight.",
      "pos": [
        650,
        844
      ]
    },
    {
      "content": "Script action lets you run scripts to customize a cluster, only when the cluster is being created.",
      "pos": [
        846,
        944
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Customize HDInsight cluster using script action<ept id=\"p1\">][hdinsight-cluster-customize]</ept>.",
      "pos": [
        945,
        1050
      ]
    },
    {
      "content": "What is R?",
      "pos": [
        1056,
        1066
      ]
    },
    {
      "content": "The <ph id=\"ph1\">&lt;a href=\"http://www.r-project.org/\" target=\"_blank\"&gt;</ph>R Project for Statistical Computing<ph id=\"ph2\">&lt;/a&gt;</ph> is an open source language and environment for statistical computing.",
      "pos": [
        1068,
        1233
      ]
    },
    {
      "content": "R provides hundreds of build-in statistical functions and its own programming language that combines aspects of functional and object-oriented programming.",
      "pos": [
        1234,
        1389
      ]
    },
    {
      "content": "It also provides extensive graphical capabilities.",
      "pos": [
        1390,
        1440
      ]
    },
    {
      "content": "R is the preferred programming environment for most professional statisticians and scientists in a wide variety of fields.",
      "pos": [
        1441,
        1563
      ]
    },
    {
      "content": "R scripts can be run on Hadoop clusters in HDInsight that were customized using Script Action when created to install the R environment.",
      "pos": [
        1565,
        1701
      ]
    },
    {
      "content": "R is compatible with Azure Blob Storage (WASB) so that data that is stored there can be processed using R on HDInsight.",
      "pos": [
        1702,
        1821
      ]
    },
    {
      "content": "Install R",
      "pos": [
        1828,
        1837
      ]
    },
    {
      "content": "A <bpt id=\"p1\">[</bpt>sample script<ept id=\"p1\">](https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1)</ept> to install R on an HDInsight cluster is available from a read-only blob in Azure Storage.",
      "pos": [
        1839,
        2031
      ]
    },
    {
      "content": "This section provides instructions about how to use the sample script while provisioning the cluster using the Azure preview portal.",
      "pos": [
        2032,
        2164
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The sample script was introduced with HDInsight cluster version 3.1.",
      "pos": [
        2168,
        2249
      ]
    },
    {
      "content": "For more information about  HDInsight cluster versions, see <bpt id=\"p1\">[</bpt>HDInsight cluster versions<ept id=\"p1\">](../hdinsight-component-versioning/)</ept>.",
      "pos": [
        2250,
        2375
      ]
    },
    {
      "pos": [
        2380,
        2513
      ],
      "content": "When you provision an HDInsight cluster from the preview portal, click <bpt id=\"p1\">**</bpt>Optional Configuration<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Script Actions<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        2517,
        2576
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Script Actions<ept id=\"p1\">**</ept> page, enter the following values:"
    },
    {
      "content": "Use Script Action to customize a cluster",
      "pos": [
        2584,
        2624
      ]
    },
    {
      "pos": [
        2734,
        3566
      ],
      "content": "<table border='1'>\n     <tr><th>Property</th><th>Value</th></tr>\n     <tr><td>Name</td>\n         <td>Specify a name for the script action, for example, <b>Install R</b>.</td></tr>\n     <tr><td>Script URI</td>\n         <td>Specify the URI to the script that is invoked to customize the cluster, for example, <i>https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1</i></td></tr>\n     <tr><td>Node Type</td>\n         <td>Specify the nodes on which the customization script is run. You can choose <b>All Nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes</b> only.\n     <tr><td>Parameters</td>\n         <td>Specify the parameters, if required by the script. However, the script to install R does not require any parameters, so you can leave this blank.</td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Property",
          "pos": [
            32,
            40
          ]
        },
        {
          "content": "Value",
          "pos": [
            49,
            54
          ]
        },
        {
          "content": "Name",
          "pos": [
            78,
            82
          ]
        },
        {
          "content": "Specify a name for the script action, for example, <ph id=\"ph1\">&lt;b&gt;</ph>Install R<ph id=\"ph2\">&lt;/b&gt;</ph>.",
          "pos": [
            101,
            169
          ]
        },
        {
          "content": "Script URI",
          "pos": [
            193,
            203
          ]
        },
        {
          "content": "Specify the URI to the script that is invoked to customize the cluster, for example, <ph id=\"ph1\">&lt;i&gt;</ph>https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1<ph id=\"ph2\">&lt;/i&gt;</ph>",
          "pos": [
            222,
            397
          ]
        },
        {
          "content": "Node Type",
          "pos": [
            421,
            430
          ]
        },
        {
          "content": "Specify the nodes on which the customization script is run. You can choose <b>All Nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes</b> only.",
          "pos": [
            449,
            594
          ],
          "nodes": [
            {
              "content": "Specify the nodes on which the customization script is run.",
              "pos": [
                0,
                59
              ]
            },
            {
              "content": "You can choose <ph id=\"ph1\">&lt;b&gt;</ph>All Nodes<ph id=\"ph2\">&lt;/b&gt;</ph>, <ph id=\"ph3\">&lt;b&gt;</ph>Head nodes only<ph id=\"ph4\">&lt;/b&gt;</ph>, or <ph id=\"ph5\">&lt;b&gt;</ph>Worker nodes<ph id=\"ph6\">&lt;/b&gt;</ph> only.",
              "pos": [
                60,
                145
              ]
            }
          ]
        },
        {
          "content": "Parameters",
          "pos": [
            608,
            618
          ]
        },
        {
          "content": "Specify the parameters, if required by the script. However, the script to install R does not require any parameters, so you can leave this blank.",
          "pos": [
            637,
            782
          ],
          "nodes": [
            {
              "content": "Specify the parameters, if required by the script.",
              "pos": [
                0,
                50
              ]
            },
            {
              "content": "However, the script to install R does not require any parameters, so you can leave this blank.",
              "pos": [
                51,
                145
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "You can add more than one script action to install multiple components on the cluster.",
      "pos": [
        3572,
        3658
      ]
    },
    {
      "content": "After you have added the scripts, click the check mark to start provisioning the cluster.",
      "pos": [
        3659,
        3748
      ]
    },
    {
      "content": "You can also use the script to install R on HDInsight by using Azure PowerShell or the HDInsight .NET SDK.",
      "pos": [
        3750,
        3856
      ]
    },
    {
      "content": "Instructions for these procedures are provided later in this article.",
      "pos": [
        3857,
        3926
      ]
    },
    {
      "content": "Run R scripts",
      "pos": [
        3931,
        3944
      ]
    },
    {
      "content": "This section describes how to run an R script on the Hadoop cluster with HDInsight.",
      "pos": [
        3945,
        4028
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Establish a Remote Desktop connection to the cluster<ept id=\"p1\">**</ept>: From the preview portal, enable Remote Desktop for the cluster you created with R installed, and then connect to the cluster.",
      "pos": [
        4033,
        4216
      ]
    },
    {
      "content": "For instructions, see <ph id=\"ph1\">&lt;a href=\"http://azure.microsoft.com/documentation/articles/hdinsight-administer-use-management-portal/#rdp\" target=\"_blank\"&gt;</ph>Connect to HDInsight clusters using RDP<ph id=\"ph2\">&lt;/a&gt;</ph>.",
      "pos": [
        4217,
        4407
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Open the R console<ept id=\"p1\">**</ept>: The R installation puts a link to the R console on the desktop of the head node.",
      "pos": [
        4412,
        4516
      ]
    },
    {
      "content": "Click on it to open the R console.",
      "pos": [
        4517,
        4551
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Run the R script<ept id=\"p1\">**</ept>: The R script can be run directly from the R console by pasting it, selecting it, and pressing ENTER.",
      "pos": [
        4556,
        4678
      ]
    },
    {
      "content": "Here is a simple example script that generates the numbers 1 to 100 and then multiplies them by 2.",
      "pos": [
        4679,
        4777
      ]
    },
    {
      "content": "The first two lines call the RHadoop libraries that are installed with R. The final line prints the results to the console.",
      "pos": [
        4952,
        5075
      ]
    },
    {
      "content": "The output should look like this:",
      "pos": [
        5076,
        5109
      ]
    },
    {
      "content": "Install R using Azure PowerShell",
      "pos": [
        5216,
        5248
      ]
    },
    {
      "content": "In this section, we use the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&lt;a href = \"http://msdn.microsoft.com/library/dn858088.aspx\" target=\"_blank\"&gt;</ph>Add-AzureHDInsightScriptAction<ph id=\"ph2\">&lt;/a&gt;</ph><ept id=\"p1\">**</ept> cmdlet to invoke scripts by using Script Action to customize a cluster.",
      "pos": [
        5250,
        5464
      ]
    },
    {
      "content": "Before proceeding, make sure you have installed and configured Azure PowerShell.",
      "pos": [
        5465,
        5545
      ]
    },
    {
      "content": "For information about configuring a workstation to run HDInsight Powershell cmdlets, see <bpt id=\"p1\">[</bpt>Install and configure Azure PowerShell<ept id=\"p1\">][powershell-install-configure]</ept>.",
      "pos": [
        5546,
        5706
      ]
    },
    {
      "content": "Perform the following steps:",
      "pos": [
        5708,
        5736
      ]
    },
    {
      "content": "Open the Azure PowerShell console and declare the following variables:",
      "pos": [
        5741,
        5811
      ]
    },
    {
      "content": "Specify the configuration values (such as nodes in the cluster) and the default storage to be used.",
      "pos": [
        6620,
        6719
      ]
    },
    {
      "pos": [
        7154,
        7254
      ],
      "content": "Use <bpt id=\"p1\">**</bpt>Add-AzureHDInsightScriptAction<ept id=\"p1\">**</ept> cmdlet to invoke the sample script to install R, for example:"
    },
    {
      "pos": [
        7528,
        7601
      ],
      "content": "<bpt id=\"p1\">**</bpt>Add-AzureHDInsightScriptAction<ept id=\"p1\">**</ept> cmdlet takes the following parameters:"
    },
    {
      "pos": [
        7607,
        9901
      ],
      "content": "<table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n <tr>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Parameter</th>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:550px; padding-left:5px; padding-right:5px;\">Definition</th></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Config</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Configuration object to which script action information is added</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name of the script action</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">ClusterRoleCollection</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Specifies the nodes on which the customization script is run. The valid values are **HeadNode** (to install on the head node) or **DataNode** (to install on all the data nodes). You can use either or both values.</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters required by the script\n </td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Uri</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Specifies the URI to the script that is executed</td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Parameter",
          "pos": [
            264,
            273
          ]
        },
        {
          "content": "Definition",
          "pos": [
            432,
            442
          ]
        },
        {
          "content": "Config",
          "pos": [
            580,
            586
          ]
        },
        {
          "content": "Configuration object to which script action information is added",
          "pos": [
            732,
            796
          ]
        },
        {
          "content": "Name",
          "pos": [
            934,
            938
          ]
        },
        {
          "content": "Name of the script action",
          "pos": [
            1065,
            1090
          ]
        },
        {
          "content": "ClusterRoleCollection",
          "pos": [
            1228,
            1249
          ]
        },
        {
          "content": "Specifies the nodes on which the customization script is run. The valid values are **HeadNode** (to install on the head node) or **DataNode** (to install on all the data nodes). You can use either or both values.",
          "pos": [
            1376,
            1588
          ],
          "nodes": [
            {
              "content": "Specifies the nodes on which the customization script is run.",
              "pos": [
                0,
                61
              ]
            },
            {
              "content": "The valid values are <bpt id=\"p1\">**</bpt>HeadNode<ept id=\"p1\">**</ept> (to install on the head node) or <bpt id=\"p2\">**</bpt>DataNode<ept id=\"p2\">**</ept> (to install on all the data nodes).",
              "pos": [
                62,
                177
              ]
            },
            {
              "content": "You can use either or both values.",
              "pos": [
                178,
                212
              ]
            }
          ]
        },
        {
          "content": "Parameters",
          "pos": [
            1726,
            1736
          ]
        },
        {
          "content": "Parameters required by the script",
          "pos": [
            1863,
            1896
          ]
        },
        {
          "content": "Uri",
          "pos": [
            2036,
            2039
          ]
        },
        {
          "content": "Specifies the URI to the script that is executed",
          "pos": [
            2166,
            2214
          ]
        }
      ]
    },
    {
      "content": "Finally, provision the cluster that you customized to have R installed.",
      "pos": [
        9906,
        9977
      ]
    },
    {
      "content": "When prompted, enter the credentials for the cluster.",
      "pos": [
        10136,
        10189
      ]
    },
    {
      "content": "It can take several minutes before the cluster is created.",
      "pos": [
        10190,
        10248
      ]
    },
    {
      "content": "Install R using the .NET SDK",
      "pos": [
        10254,
        10282
      ]
    },
    {
      "content": "The HDInsight .NET SDK provides .NET client libraries that makes it easier to work with HDInsight from a .NET application.",
      "pos": [
        10284,
        10406
      ]
    },
    {
      "content": "Perform the following procedures to provision an HDInsight cluster using the SDK:",
      "pos": [
        10408,
        10489
      ]
    },
    {
      "content": "Install the HDInsight .NET SDK",
      "pos": [
        10494,
        10524
      ]
    },
    {
      "content": "Create a self-signed certificate",
      "pos": [
        10542,
        10574
      ]
    },
    {
      "content": "Create a .NET application in Visual Studio",
      "pos": [
        10592,
        10634
      ]
    },
    {
      "content": "Run the application",
      "pos": [
        10651,
        10670
      ]
    },
    {
      "content": "The following sections show how to perform these procedures.",
      "pos": [
        10682,
        10742
      ]
    },
    {
      "content": "To install the HDInsight .NET SDK",
      "pos": [
        10746,
        10779
      ]
    },
    {
      "content": "You can install latest published build of the SDK from <bpt id=\"p1\">[</bpt>NuGet<ept id=\"p1\">](http://nuget.codeplex.com/wikipage?title=Getting%20Started)</ept>.",
      "pos": [
        10783,
        10906
      ]
    },
    {
      "content": "The instructions will be shown in the next procedure.",
      "pos": [
        10907,
        10960
      ]
    },
    {
      "content": "To create a self-signed certificate",
      "pos": [
        10964,
        10999
      ]
    },
    {
      "content": "Create a self-signed certificate, install it on your workstation, and upload it to your Azure subscription.",
      "pos": [
        11003,
        11110
      ]
    },
    {
      "content": "For instructions, see <bpt id=\"p1\">[</bpt>Create a self-signed certificate<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=511138)</ept>.",
      "pos": [
        11111,
        11215
      ]
    },
    {
      "content": "To create a .NET application in Visual Studio",
      "pos": [
        11220,
        11265
      ]
    },
    {
      "content": "Open Visual Studio 2013.",
      "pos": [
        11272,
        11296
      ]
    },
    {
      "pos": [
        11301,
        11367
      ],
      "content": "From the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        11372,
        11430
      ],
      "content": "From <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept>, type or select the following values:"
    },
    {
      "pos": [
        11436,
        12824
      ],
      "content": "<table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n <tr>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Property</th>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Value</th></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Category</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Templates/Visual C#/Windows</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Template</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Console Application</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">CreateRCluster</td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Property",
          "pos": [
            264,
            272
          ]
        },
        {
          "content": "Value",
          "pos": [
            430,
            435
          ]
        },
        {
          "content": "Category",
          "pos": [
            573,
            581
          ]
        },
        {
          "content": "Templates/Visual C#/Windows",
          "pos": [
            727,
            754
          ]
        },
        {
          "content": "Template",
          "pos": [
            892,
            900
          ]
        },
        {
          "content": "Console Application",
          "pos": [
            1027,
            1046
          ]
        },
        {
          "content": "Name",
          "pos": [
            1184,
            1188
          ]
        },
        {
          "content": "CreateRCluster",
          "pos": [
            1315,
            1329
          ]
        }
      ]
    },
    {
      "pos": [
        12829,
        12864
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to create the project."
    },
    {
      "pos": [
        12869,
        12970
      ],
      "content": "From the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Nuget Package Manager<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Package Manager Console<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Run the following command in the console to install the package.",
      "pos": [
        12975,
        13039
      ]
    },
    {
      "content": "This command adds the .NET libraries and references to them from the current Visual Studio project.",
      "pos": [
        13114,
        13213
      ]
    },
    {
      "pos": [
        13218,
        13285
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, double-click <bpt id=\"p2\">**</bpt>Program.cs<ept id=\"p2\">**</ept> to open it."
    },
    {
      "pos": [
        13290,
        13352
      ],
      "content": "Add the following <bpt id=\"p1\">**</bpt>using<ept id=\"p1\">**</ept> statements to the top of the file:"
    },
    {
      "pos": [
        13634,
        13726
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Main()<ept id=\"p1\">**</ept> function, paste the following code, and provide values for the variables :"
    },
    {
      "pos": [
        15348,
        15594
      ],
      "content": "Append the following code to the <bpt id=\"p1\">**</bpt>Main()<ept id=\"p1\">**</ept> function to use the <bpt id=\"p2\">[</bpt>ScriptAction<ept id=\"p2\">](http://msdn.microsoft.com/library/microsoft.windowsazure.management.hdinsight.clusterprovisioning.data.scriptaction.aspx)</ept> class to invoke a custom script to install R."
    },
    {
      "content": "Finally, create the cluster:",
      "pos": [
        15948,
        15976
      ]
    },
    {
      "content": "Save changes to the application and build the solution.",
      "pos": [
        16026,
        16081
      ]
    },
    {
      "content": "To run the application",
      "pos": [
        16085,
        16107
      ]
    },
    {
      "content": "Open the Azure PowerShell console, navigate to the location where you saved the project, navigate to the \\bin\\debug directory within the project, and then run the following command:",
      "pos": [
        16111,
        16292
      ]
    },
    {
      "content": "Provide a cluster name and press ENTER to provision a cluster with R installed.",
      "pos": [
        16331,
        16410
      ]
    },
    {
      "content": "See also",
      "pos": [
        16415,
        16423
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Install and use Spark on HDInsight clusters<ept id=\"p1\">][hdinsight-install-spark]</ept> for  instructions about how to use cluster customization to install and use Spark on HDInsight Hadoop clusters.",
      "pos": [
        16427,
        16609
      ]
    },
    {
      "content": "Spark is an open-source parallel processing framework that supports in-memory processing to boost the performance of big data analytic applications.",
      "pos": [
        16610,
        16758
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Install Giraph on HDInsight clusters<ept id=\"p1\">](../hdinsight-hadoop-giraph-install)</ept>.",
      "pos": [
        16761,
        16836
      ]
    },
    {
      "content": "Use cluster customization to install Giraph on HDInsight Hadoop clusters.",
      "pos": [
        16837,
        16910
      ]
    },
    {
      "content": "Giraph allows you to perform graph processing using Hadoop, and it can be used with Azure HDInsight.",
      "pos": [
        16911,
        17011
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Install Solr on HDInsight clusters<ept id=\"p1\">](../hdinsight-hadoop-solr-install)</ept>.",
      "pos": [
        17014,
        17085
      ]
    },
    {
      "content": "Use cluster customization to install Solr on HDInsight Hadoop clusters.",
      "pos": [
        17086,
        17157
      ]
    },
    {
      "content": "Solr allows you to perform powerful search operations on stored data.",
      "pos": [
        17158,
        17227
      ]
    },
    {
      "content": "test",
      "pos": [
        17484,
        17488
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Use R in HDInsight to customize clusters | Microsoft Azure\"\n    description=\"Learn how to install and use R to customize Hadoop clusters.\"\n    services=\"hdinsight\"\n    documentationCenter=\"\"\n    tags=\"azure-portal\"\n    authors=\"mumian\"\n    manager=\"paulettm\"\n    editor=\"cgronlun\"/>\n\n<tags\n    ms.service=\"hdinsight\"\n    ms.workload=\"big-data\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"07/28/2015\"\n    ms.author=\"jgao\"/>\n\n# Install and use R on HDInsight Hadoop clusters\n\nYou can install R on any type of cluster in Hadoop on HDInsight by using **Script Action** cluster customization. This enables data scientists and analysts to use R to deploy the powerful MapReduce/YARN programming framework to process large amounts of data on Hadoop clusters that are deployed in HDInsight.\n\nScript action lets you run scripts to customize a cluster, only when the cluster is being created. For more information, see [Customize HDInsight cluster using script action][hdinsight-cluster-customize].\n\n\n## What is R?\n\nThe <a href=\"http://www.r-project.org/\" target=\"_blank\">R Project for Statistical Computing</a> is an open source language and environment for statistical computing. R provides hundreds of build-in statistical functions and its own programming language that combines aspects of functional and object-oriented programming. It also provides extensive graphical capabilities. R is the preferred programming environment for most professional statisticians and scientists in a wide variety of fields.\n\nR scripts can be run on Hadoop clusters in HDInsight that were customized using Script Action when created to install the R environment. R is compatible with Azure Blob Storage (WASB) so that data that is stored there can be processed using R on HDInsight.  \n\n## Install R\n\nA [sample script](https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1) to install R on an HDInsight cluster is available from a read-only blob in Azure Storage. This section provides instructions about how to use the sample script while provisioning the cluster using the Azure preview portal.\n\n> [AZURE.NOTE] The sample script was introduced with HDInsight cluster version 3.1. For more information about  HDInsight cluster versions, see [HDInsight cluster versions](../hdinsight-component-versioning/).\n\n1. When you provision an HDInsight cluster from the preview portal, click **Optional Configuration**, and then click **Script Actions**.\n2. On the **Script Actions** page, enter the following values:\n\n    ![Use Script Action to customize a cluster](./media/hdinsight-hadoop-r-scripts/hdi-r-script-action.png \"Use Script Action to customize a cluster\")\n\n    <table border='1'>\n        <tr><th>Property</th><th>Value</th></tr>\n        <tr><td>Name</td>\n            <td>Specify a name for the script action, for example, <b>Install R</b>.</td></tr>\n        <tr><td>Script URI</td>\n            <td>Specify the URI to the script that is invoked to customize the cluster, for example, <i>https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1</i></td></tr>\n        <tr><td>Node Type</td>\n            <td>Specify the nodes on which the customization script is run. You can choose <b>All Nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes</b> only.\n        <tr><td>Parameters</td>\n            <td>Specify the parameters, if required by the script. However, the script to install R does not require any parameters, so you can leave this blank.</td></tr>\n    </table>\n\n    You can add more than one script action to install multiple components on the cluster. After you have added the scripts, click the check mark to start provisioning the cluster.\n\nYou can also use the script to install R on HDInsight by using Azure PowerShell or the HDInsight .NET SDK. Instructions for these procedures are provided later in this article.\n\n## Run R scripts\nThis section describes how to run an R script on the Hadoop cluster with HDInsight.\n\n1. **Establish a Remote Desktop connection to the cluster**: From the preview portal, enable Remote Desktop for the cluster you created with R installed, and then connect to the cluster. For instructions, see <a href=\"http://azure.microsoft.com/documentation/articles/hdinsight-administer-use-management-portal/#rdp\" target=\"_blank\">Connect to HDInsight clusters using RDP</a>.\n\n2. **Open the R console**: The R installation puts a link to the R console on the desktop of the head node. Click on it to open the R console.\n\n3. **Run the R script**: The R script can be run directly from the R console by pasting it, selecting it, and pressing ENTER. Here is a simple example script that generates the numbers 1 to 100 and then multiplies them by 2.\n\n        library(rmr2)\n        library(rhdfs)\n        ints = to.dfs(1:100)\n        calc = mapreduce(input = ints, map = function(k, v) cbind(v, 2*v))\n        from.dfs(calc)\n\nThe first two lines call the RHadoop libraries that are installed with R. The final line prints the results to the console. The output should look like this:\n\n    [1,]  1 2\n    [2,]  2 4\n    .\n    .\n    .\n    [98,]  98 196\n    [99,]  99 198\n    [100,] 100 200\n\n## Install R using Azure PowerShell\n\nIn this section, we use the **<a href = \"http://msdn.microsoft.com/library/dn858088.aspx\" target=\"_blank\">Add-AzureHDInsightScriptAction</a>** cmdlet to invoke scripts by using Script Action to customize a cluster. Before proceeding, make sure you have installed and configured Azure PowerShell. For information about configuring a workstation to run HDInsight Powershell cmdlets, see [Install and configure Azure PowerShell][powershell-install-configure].\n\nPerform the following steps:\n\n1. Open the Azure PowerShell console and declare the following variables:\n\n        # PROVIDE VALUES FOR THESE VARIABLES\n        $subscriptionName = \"<SubscriptionName>\"        # Name of the Azure subscription\n        $clusterName = \"<HDInsightClusterName>\"         # HDInsight cluster name\n        $storageAccountName = \"<StorageAccountName>\"    # Azure storage account that hosts the default container\n        $storageAccountKey = \"<StorageAccountKey>\"      # Key for the storage account\n        $containerName = $clusterName\n        $location = \"<MicrosoftDataCenter>\"             # Location of the HDInsight cluster. It must be in the same data center as the storage account.\n        $clusterNodes = <ClusterSizeInNumbers>          # The number of nodes in the HDInsight cluster.\n        $version = \"<HDInsightClusterVersion>\"          # HDInsight version, for example \"3.1\"\n\n2. Specify the configuration values (such as nodes in the cluster) and the default storage to be used.\n\n        # SPECIFY THE CONFIGURATION OPTIONS\n        Select-AzureSubscription $subscriptionName\n        $config = New-AzureHDInsightClusterConfig -ClusterSizeInNodes $clusterNodes\n        $config.DefaultStorageAccount.StorageAccountName=\"$storageAccountName.blob.core.windows.net\"\n        $config.DefaultStorageAccount.StorageAccountKey=$storageAccountKey\n        $config.DefaultStorageAccount.StorageContainerName=$containerName\n\n3. Use **Add-AzureHDInsightScriptAction** cmdlet to invoke the sample script to install R, for example:\n\n        # INVOKE THE SCRIPT USING THE SCRIPT ACTION\n        $config = Add-AzureHDInsightScriptAction -Config $config -Name \"Install R\"  -ClusterRoleCollection HeadNode,DataNode -Uri https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1\n\n\n    **Add-AzureHDInsightScriptAction** cmdlet takes the following parameters:\n\n    <table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n    <tr>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Parameter</th>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:550px; padding-left:5px; padding-right:5px;\">Definition</th></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Config</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Configuration object to which script action information is added</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name of the script action</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">ClusterRoleCollection</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Specifies the nodes on which the customization script is run. The valid values are **HeadNode** (to install on the head node) or **DataNode** (to install on all the data nodes). You can use either or both values.</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters required by the script\n    </td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Uri</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Specifies the URI to the script that is executed</td></tr>\n    </table>\n\n4. Finally, provision the cluster that you customized to have R installed.  \n\n        # PROVISION A CLUSTER WITH R INSTALLED\n        New-AzureHDInsightCluster -Config $config -Name $clusterName -Location $location -Version $version\n\nWhen prompted, enter the credentials for the cluster. It can take several minutes before the cluster is created.\n\n\n## Install R using the .NET SDK\n\nThe HDInsight .NET SDK provides .NET client libraries that makes it easier to work with HDInsight from a .NET application.\n\nPerform the following procedures to provision an HDInsight cluster using the SDK:\n\n- [Install the HDInsight .NET SDK](#installSDK)\n- [Create a self-signed certificate](#createCert)\n- [Create a .NET application in Visual Studio](#createApp)\n- [Run the application](#runApp)\n\nThe following sections show how to perform these procedures.\n\n**To install the HDInsight .NET SDK**\n\nYou can install latest published build of the SDK from [NuGet](http://nuget.codeplex.com/wikipage?title=Getting%20Started). The instructions will be shown in the next procedure.\n\n**To create a self-signed certificate**\n\nCreate a self-signed certificate, install it on your workstation, and upload it to your Azure subscription. For instructions, see [Create a self-signed certificate](http://go.microsoft.com/fwlink/?LinkId=511138).\n\n\n**To create a .NET application in Visual Studio**\n\n1. Open Visual Studio 2013.\n\n2. From the **File** menu, click **New**, and then click **Project**.\n\n3. From **New Project**, type or select the following values:\n\n    <table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n    <tr>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Property</th>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Value</th></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Category</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Templates/Visual C#/Windows</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Template</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Console Application</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">CreateRCluster</td></tr>\n    </table>\n\n4. Click **OK** to create the project.\n\n5. From the **Tools** menu, click **Nuget Package Manager**, and then click **Package Manager Console**.\n\n6. Run the following command in the console to install the package.\n\n        Install-Package Microsoft.WindowsAzure.Management.HDInsight\n\n    This command adds the .NET libraries and references to them from the current Visual Studio project.\n\n7. From **Solution Explorer**, double-click **Program.cs** to open it.\n\n8. Add the following **using** statements to the top of the file:\n\n        using System.Security.Cryptography.X509Certificates;\n        using Microsoft.WindowsAzure.Management.HDInsight;\n        using Microsoft.WindowsAzure.Management.HDInsight.ClusterProvisioning;\n        using Microsoft.WindowsAzure.Management.HDInsight.Framework.Logging;\n\n9. In the **Main()** function, paste the following code, and provide values for the variables :\n\n        var clusterName = args[0];\n\n        // PROVIDE VALUES FOR THE VARIABLES\n        string thumbprint = \"<CertificateThumbprint>\";  \n        string subscriptionId = \"<AzureSubscriptionID>\";\n        string location = \"<MicrosoftDataCenterLocation>\";\n        string storageaccountname = \"<AzureStorageAccountName>.blob.core.windows.net\";\n        string storageaccountkey = \"<AzureStorageAccountKey>\";\n        string username = \"<HDInsightUsername>\";\n        string password = \"<HDInsightUserPassword>\";\n        int clustersize = <NumberOfNodesInTheCluster>;\n\n        // PROVIDE THE CERTIFICATE THUMBPRINT TO RETRIEVE THE CERTIFICATE FROM THE CERTIFICATE STORE\n        X509Store store = new X509Store();\n        store.Open(OpenFlags.ReadOnly);\n        X509Certificate2 cert = store.Certificates.Cast<X509Certificate2>().First(item => item.Thumbprint == thumbprint);\n\n        // CREATE AN HDINSIGHT CLIENT OBJECT\n        HDInsightCertificateCredential creds = new HDInsightCertificateCredential(new Guid(subscriptionId), cert);\n        var client = HDInsightClient.Connect(creds);\n        client.IgnoreSslErrors = true;\n\n        // PROVIDE THE CLUSTER INFORMATION\n        var clusterInfo = new ClusterCreateParameters()\n        {\n            Name = clusterName,\n            Location = location,\n            DefaultStorageAccountName = storageaccountname,\n            DefaultStorageAccountKey = storageaccountkey,\n            DefaultStorageContainer = clusterName,\n            UserName = username,\n            Password = password,\n            ClusterSizeInNodes = clustersize,\n            Version = \"3.1\"\n        };\n\n10. Append the following code to the **Main()** function to use the [ScriptAction](http://msdn.microsoft.com/library/microsoft.windowsazure.management.hdinsight.clusterprovisioning.data.scriptaction.aspx) class to invoke a custom script to install R.\n\n        // ADD THE SCRIPT ACTION TO INSTALL R\n\n        clusterInfo.ConfigActions.Add(new ScriptAction(\n            \"Install R\",\n            new ClusterNodeType[] { ClusterNodeType.HeadNode, ClusterNodeType.DataNode },\n            new Uri(\"https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1\"), null\n            ));\n\n11. Finally, create the cluster:\n\n        client.CreateCluster(clusterInfo);\n\n11. Save changes to the application and build the solution.\n\n**To run the application**\n\nOpen the Azure PowerShell console, navigate to the location where you saved the project, navigate to the \\bin\\debug directory within the project, and then run the following command:\n\n    .\\CreateRCluster <cluster-name>\n\nProvide a cluster name and press ENTER to provision a cluster with R installed.\n\n## See also\n\n- [Install and use Spark on HDInsight clusters][hdinsight-install-spark] for  instructions about how to use cluster customization to install and use Spark on HDInsight Hadoop clusters. Spark is an open-source parallel processing framework that supports in-memory processing to boost the performance of big data analytic applications.\n- [Install Giraph on HDInsight clusters](../hdinsight-hadoop-giraph-install). Use cluster customization to install Giraph on HDInsight Hadoop clusters. Giraph allows you to perform graph processing using Hadoop, and it can be used with Azure HDInsight.\n- [Install Solr on HDInsight clusters](../hdinsight-hadoop-solr-install). Use cluster customization to install Solr on HDInsight Hadoop clusters. Solr allows you to perform powerful search operations on stored data.\n\n[powershell-install-configure]: ../install-configure-powershell.md\n[hdinsight-provision]: ../hdinsight-provision-clusters/\n[hdinsight-cluster-customize]: ../hdinsight-hadoop-customize-cluster\n[hdinsight-install-spark]: ../hdinsight-hadoop-spark-install/\n\ntest\n"
}