{
  "nodes": [
    {
      "content": "Deploy and configure a SaaS connector API app",
      "pos": [
        28,
        73
      ]
    },
    {
      "content": "Learn how to configure a SaaS connector that you install in your Azure subscription from the Azure Marketplace.",
      "pos": [
        93,
        204
      ]
    },
    {
      "content": "Deploy and configure a SaaS connector API app in Azure App Service",
      "pos": [
        534,
        600
      ]
    },
    {
      "content": "Overview",
      "pos": [
        605,
        613
      ]
    },
    {
      "content": "This tutorial shows how to install, configure, and test a <bpt id=\"p1\">[</bpt>Software-as-a-Service (SaaS) connector<ept id=\"p1\">](../app-service-logic-what-are-bizTalk-api-apps.md)</ept> in <bpt id=\"p2\">[</bpt>Azure App Service<ept id=\"p2\">](/documentation/services/app-service/)</ept> for calling it programmatically, such as from a mobile app.",
      "pos": [
        615,
        885
      ]
    },
    {
      "content": "A SaaS connector is an <bpt id=\"p1\">[</bpt>API app<ept id=\"p1\">](app-service-api-apps-why-best-platform.md)</ept> that simplifies interaction with a SaaS platform such as Office 365, Salesforce, Facebook, and Dropbox.",
      "pos": [
        886,
        1065
      ]
    },
    {
      "content": "If instead of using a prepackaged connector you want to create a custom .NET API app, see <bpt id=\"p1\">[</bpt>Connect to a SaaS platform from an ASP.NET API app<ept id=\"p1\">](app-service-api-dotnet-connect-to-saas.md)</ept>.",
      "pos": [
        1066,
        1252
      ]
    },
    {
      "content": "For example, if you want to code HTTP requests to read and write files in your Dropbox account, the authentication process for working directly with Dropbox is complicated.",
      "pos": [
        1255,
        1427
      ]
    },
    {
      "content": "A Dropbox connector takes care of the complexity of authentication so that you can focus on writing your business-specific code.",
      "pos": [
        1428,
        1556
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The instructions here are not required if you want to use a SaaS connector from a logic app.",
      "pos": [
        1560,
        1665
      ]
    },
    {
      "content": "For information  about how to use SaaS connectors inside logic apps, see <bpt id=\"p1\">[</bpt>Create a new logic app<ept id=\"p1\">](../app-service-logic/app-service-logic-create-a-logic-app.md)</ept> and <bpt id=\"p2\">[</bpt>Using custom OAUTH Application in Connectors<ept id=\"p2\">](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps&amp;announcementId=4af1e4c5-d220-4457-97d8-d08e427ae6c1)</ept>.",
      "pos": [
        1666,
        2003
      ]
    },
    {
      "content": "This tutorial uses a DropBox connector as an example and walks you through the following steps:",
      "pos": [
        2006,
        2101
      ]
    },
    {
      "pos": [
        2105,
        2215
      ],
      "content": "Install the Dropbox connector in a <bpt id=\"p1\">[</bpt>resource group<ept id=\"p1\">](../resource-group-overview.md)</ept> in your Azure subscription."
    },
    {
      "content": "Configure the Dropbox connector so that it can connect to the Dropbox service.",
      "pos": [
        2219,
        2297
      ]
    },
    {
      "content": "(To complete this step you'll need a Dropbox account.)",
      "pos": [
        2298,
        2352
      ]
    },
    {
      "content": "Configure the resource group so that only authenticated users can access API apps that are included in the resource group.",
      "pos": [
        2355,
        2477
      ]
    },
    {
      "content": "Test to verify that both user authentication and Dropbox authentication work.",
      "pos": [
        2480,
        2557
      ]
    },
    {
      "pos": [
        2559,
        2722
      ],
      "content": "For more information about authentication in App Service, see <bpt id=\"p1\">[</bpt>Authentication for API apps and mobile apps<ept id=\"p1\">](../app-service/app-service-authentication-overview.md)</ept>."
    },
    {
      "content": "Install the Dropbox connector",
      "pos": [
        2728,
        2757
      ]
    },
    {
      "pos": [
        2762,
        2831
      ],
      "content": "Go to the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure preview portal]</ept> home page and click <bpt id=\"p2\">**</bpt>Marketplace<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Marketplace in Azure preview portal",
      "pos": [
        2839,
        2874
      ]
    },
    {
      "pos": [
        2957,
        3023
      ],
      "content": "Search for Dropbox, and then click the <bpt id=\"p1\">**</bpt>Dropbox Connector<ept id=\"p1\">**</ept> icon."
    },
    {
      "content": "Click Dropbox Connector",
      "pos": [
        3031,
        3054
      ]
    },
    {
      "pos": [
        3135,
        3152
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Click Create",
      "pos": [
        3160,
        3172
      ]
    },
    {
      "pos": [
        3256,
        3411
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Dropbox Connector<ept id=\"p1\">**</ept> blade, under <bpt id=\"p2\">**</bpt>App Service plan<ept id=\"p2\">**</ept> click <bpt id=\"p3\">**</bpt>Create New<ept id=\"p3\">**</ept>, and then in the <bpt id=\"p4\">**</bpt>Create new App Service plan<ept id=\"p4\">**</ept> box enter DropBoxPlan."
    },
    {
      "pos": [
        3418,
        3568
      ],
      "content": "For more information about App Service plans, see <bpt id=\"p1\">[</bpt>Azure App Service plans in-depth overview<ept id=\"p1\">](azure-web-sites-web-hosting-plans-in-depth-overview.md)</ept>."
    },
    {
      "pos": [
        3574,
        3688
      ],
      "content": "Under <bpt id=\"p1\">**</bpt>Resource Group<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Create New<ept id=\"p2\">**</ept>, and then in the <bpt id=\"p3\">**</bpt>Create New Resource Group<ept id=\"p3\">**</ept> box enter DropboxRG."
    },
    {
      "pos": [
        3694,
        3828
      ],
      "content": "For more information about resource groups, see <bpt id=\"p1\">[</bpt>Using resource groups to manage your Azure resources<ept id=\"p1\">](../resource-group-overview.md)</ept>."
    },
    {
      "content": "Select the Free <bpt id=\"p1\">**</bpt>Pricing Tier<ept id=\"p1\">**</ept>.",
      "pos": [
        3833,
        3866
      ]
    },
    {
      "content": "(If you don't see it in the list, click <bpt id=\"p1\">**</bpt>View All<ept id=\"p1\">**</ept>.",
      "pos": [
        3867,
        3920
      ]
    },
    {
      "content": "After you click <bpt id=\"p1\">**</bpt>F1 Free<ept id=\"p1\">**</ept>, click the <bpt id=\"p2\">**</bpt>Select<ept id=\"p2\">**</ept> button.)",
      "pos": [
        3921,
        3979
      ]
    },
    {
      "content": "You can use a paid pricing tier, but it isn't required for this tutorial.",
      "pos": [
        3985,
        4058
      ]
    },
    {
      "pos": [
        4065,
        4100
      ],
      "content": "Choose a <bpt id=\"p1\">**</bpt>Location<ept id=\"p1\">**</ept> close to you."
    },
    {
      "pos": [
        4107,
        4223
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"gateway\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Keep the default \"DropboxConnector\" as the <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> of the connector, and then click <bpt id=\"p2\">**</bpt>Create<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Click create",
      "pos": [
        4232,
        4244
      ]
    },
    {
      "content": "Azure App Service creates a resource group, and in the resource group it creates a Dropbox connector API app, and a <bpt id=\"p1\">*</bpt>gateway<ept id=\"p1\">*</ept> web app.",
      "pos": [
        4331,
        4465
      ]
    },
    {
      "content": "The gateway's function is to manage access to all API apps in the resource group.",
      "pos": [
        4466,
        4547
      ]
    },
    {
      "pos": [
        4554,
        4670
      ],
      "content": "You can check the progress of resource creation by clicking <bpt id=\"p1\">**</bpt>Notifications<ept id=\"p1\">**</ept> on the Azure preview portal home page."
    },
    {
      "pos": [
        4675,
        4766
      ],
      "content": "When Azure finishes creating the connector, click <bpt id=\"p1\">**</bpt>Browse &gt; Resource groups &gt; DropboxRG<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        4773,
        4874
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Resource Group<ept id=\"p1\">**</ept> blade for DropboxRG shows the connector and the gateway in the resource group."
    },
    {
      "content": "Resource group diagram",
      "pos": [
        4882,
        4904
      ]
    },
    {
      "content": "Configure your Dropbox account and the Dropbox connector",
      "pos": [
        4986,
        5042
      ]
    },
    {
      "content": "To enable API access to your Dropbox account, you have to create a Dropbox app on the Dropbox developer site.",
      "pos": [
        5044,
        5153
      ]
    },
    {
      "content": "Then you copy the client ID and client secret values from that Dropbox app to your Dropbox connector, and you set the connector to accept only authenticated requests.",
      "pos": [
        5154,
        5320
      ]
    },
    {
      "pos": [
        5326,
        5370
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"createdbapp\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Create a Dropbox app"
    },
    {
      "pos": [
        5484,
        5584
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"copysettings\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Copy the Dropbox app settings to the Azure Dropbox connector and vice versa"
    },
    {
      "content": "Set the Dropbox connector to require authenticated access",
      "pos": [
        5713,
        5770
      ]
    },
    {
      "content": "By default the connector's <bpt id=\"p1\">**</bpt>Access level<ept id=\"p1\">**</ept> is set to <bpt id=\"p2\">**</bpt>Internal<ept id=\"p2\">**</ept>, meaning it can only be called by other API apps and web apps in the same resource group.",
      "pos": [
        5772,
        5928
      ]
    },
    {
      "content": "But Dropbox allows only authenticated users to access your Dropbox account, so you have to change the access level setting to require user authentication.",
      "pos": [
        5929,
        6083
      ]
    },
    {
      "pos": [
        6088,
        6158
      ],
      "content": "Go back to the <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> blade, and click <bpt id=\"p2\">**</bpt>Application settings<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        6163,
        6278
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Application settings<ept id=\"p1\">**</ept> blade, set <bpt id=\"p2\">**</bpt>Access level<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>Public (authenticated)<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>Save<ept id=\"p4\">**</ept>."
    },
    {
      "content": "Set to Public (authenticated)",
      "pos": [
        6291,
        6320
      ]
    },
    {
      "content": "You have now configured the Dropbox Connector so that outgoing calls can access your Dropbox account, and incoming calls must be from authenticated users.",
      "pos": [
        6396,
        6550
      ]
    },
    {
      "content": "In the next section you specify which authentication provider you want to use to authenticate users.",
      "pos": [
        6551,
        6651
      ]
    },
    {
      "content": "Configure the gateway",
      "pos": [
        6656,
        6677
      ]
    },
    {
      "content": "As explained <bpt id=\"p1\">[</bpt>earlier<ept id=\"p1\">](#gateway)</ept>, the gateway is a special web app that manages access to all API apps in a resource group.",
      "pos": [
        6679,
        6802
      ]
    },
    {
      "content": "To set up the gateway to authenticate users, you choose an authentication provider such as Azure Active Directory, Google, or Twitter.",
      "pos": [
        6803,
        6937
      ]
    },
    {
      "content": "Users will then have to authenticate with the chosen provider before they can successfully call the Dropbox connector.",
      "pos": [
        6938,
        7056
      ]
    },
    {
      "pos": [
        7060,
        7366
      ],
      "content": "To perform this step, go to the <bpt id=\"p1\">[</bpt>Configure the gateway<ept id=\"p1\">](app-service-api-dotnet-add-authentication.md#configure-the-gateway)</ept> section of the <bpt id=\"p2\">[</bpt>Protect an API app<ept id=\"p2\">](app-service-api-dotnet-add-authentication.md)</ept> tutorial, and follow the directions there to configure the gateway in your DropboxRG resource group."
    },
    {
      "content": "Test to verify user and Dropbox authentication",
      "pos": [
        7371,
        7417
      ]
    },
    {
      "content": "After you have configured the gateway in your DropboxRG resource group to use an authentication provider, you can test your Dropbox connector.",
      "pos": [
        7419,
        7561
      ]
    },
    {
      "content": "Most of the time you'll use a connector by calling it from code, and we're also writing tutorials that will show how to do that.",
      "pos": [
        7563,
        7691
      ]
    },
    {
      "content": "But sometimes you'll want to validate that the connector is working before wiring up other parts of an app.",
      "pos": [
        7692,
        7799
      ]
    },
    {
      "content": "This tutorial shows how to use a browser and a simple REST client tool to verify that you can interact with the Dropbox service through the Dropbox connector that you just installed and configured.",
      "pos": [
        7800,
        7997
      ]
    },
    {
      "content": "The following instructions show how to do these steps by using the Chrome browser developer tools and Postman REST client tool.",
      "pos": [
        7999,
        8126
      ]
    },
    {
      "content": "This is just an example, and you can do the same procedures with other browsers and tools.",
      "pos": [
        8127,
        8217
      ]
    },
    {
      "content": "\"Advanced REST Client\" is another Chrome add-in you can use.",
      "pos": [
        8218,
        8278
      ]
    },
    {
      "content": "Log in as an end user",
      "pos": [
        8284,
        8305
      ]
    },
    {
      "content": "Do the following steps in a new browser window.",
      "pos": [
        8307,
        8354
      ]
    },
    {
      "content": "Depending on what authentication provider you're using, you might find that you need to use a private or incognito window.",
      "pos": [
        8355,
        8477
      ]
    },
    {
      "content": "Go to the login URL for the gateway and the authentication provider that you configured.",
      "pos": [
        8482,
        8570
      ]
    },
    {
      "content": "The URL follows this pattern:",
      "pos": [
        8571,
        8600
      ]
    },
    {
      "content": "You can get the gateway URL from the <bpt id=\"p1\">**</bpt>Gateway<ept id=\"p1\">**</ept> blade in the <bpt id=\"p2\">[</bpt><ept id=\"p2\">Azure preview portal]</ept>.",
      "pos": [
        8657,
        8742
      ]
    },
    {
      "content": "(To get to the <bpt id=\"p1\">**</bpt>Gateway<ept id=\"p1\">**</ept> blade, click the gateway in the diagram shown on the <bpt id=\"p2\">**</bpt>Resource group<ept id=\"p2\">**</ept> blade.)",
      "pos": [
        8743,
        8849
      ]
    },
    {
      "content": "Gateway URL",
      "pos": [
        8857,
        8868
      ]
    },
    {
      "content": "The [providername] value is \"facebook\" for Facebook, \"twitter\" for Twitter, \"aad\" for Azure Active directory, etc.",
      "pos": [
        8951,
        9065
      ]
    },
    {
      "content": "Here is a sample login URL for Azure Active Directory:",
      "pos": [
        9071,
        9125
      ]
    },
    {
      "content": "Enter your credentials when the browser displays a login page.",
      "pos": [
        9210,
        9272
      ]
    },
    {
      "pos": [
        9280,
        9510
      ],
      "content": "If you configured Azure Active Directory login, log in as one of the users listed in the <bpt id=\"p1\">**</bpt>Users<ept id=\"p1\">**</ept> tab for the application you created in the Azure Active Directory tab of the <bpt id=\"p2\">[</bpt><ept id=\"p2\">Azure portal]</ept>, such as admin@contoso.onmicrosoft.com."
    },
    {
      "content": "When login is successful, you get a \"Login complete\" page.",
      "pos": [
        9516,
        9574
      ]
    },
    {
      "content": "Provide the user's identity to Dropbox",
      "pos": [
        9664,
        9702
      ]
    },
    {
      "content": "To get Dropbox authorization to use the Dropbox API, you have to provide the user's credentials to Dropbox.",
      "pos": [
        9704,
        9811
      ]
    },
    {
      "content": "Azure will initiate that process for you, but to trigger that process you have to go to a special gateway URL in the browser.",
      "pos": [
        9813,
        9938
      ]
    },
    {
      "content": "To get that URL you make an HTTP Post request to the gateway.",
      "pos": [
        9940,
        10001
      ]
    },
    {
      "content": "The HTTP Post request to the gateway has to include the authentication token that Azure provided when you logged in.",
      "pos": [
        10003,
        10119
      ]
    },
    {
      "content": "For browser requests, including the token is automatic because the token is stored in a cookie, but for an HTTP Post request using a REST client tool you have to get the token from the cookie and put it in the request header of the HTTP Post request.",
      "pos": [
        10120,
        10370
      ]
    },
    {
      "content": "In the browser window that has the \"Login complete\" message, go to the browser's developer tools and find the <ph id=\"ph1\">`x-zumo-auth`</ph> cookie.",
      "pos": [
        10375,
        10506
      ]
    },
    {
      "content": "Keep this window open so you can copy the value of the cookie in the next step.",
      "pos": [
        10507,
        10586
      ]
    },
    {
      "content": "To get the cookie value in Chrome, perform the following steps:",
      "pos": [
        10593,
        10656
      ]
    },
    {
      "content": "Press F12 to open developer tools.",
      "pos": [
        10664,
        10698
      ]
    },
    {
      "pos": [
        10705,
        10733
      ],
      "content": "Go to the <bpt id=\"p1\">**</bpt>Resources<ept id=\"p1\">**</ept> tab."
    },
    {
      "content": "Find the cookies for your gateway site, and triple-click the <bpt id=\"p1\">**</bpt>Value<ept id=\"p1\">**</ept> of the <ph id=\"ph1\">`x-zumo-auth`</ph> cookie to select all of it.",
      "pos": [
        10740,
        10859
      ]
    },
    {
      "content": "(Make sure you get all of the cookie's value.",
      "pos": [
        10860,
        10905
      ]
    },
    {
      "content": "If you double-click, you might get only the first part of it.)",
      "pos": [
        10906,
        10968
      ]
    },
    {
      "content": "Copy token",
      "pos": [
        10978,
        10988
      ]
    },
    {
      "content": "In a new browser tab or window, create and send an HTTP Post request to the gateway to request a consent URL.",
      "pos": [
        11070,
        11179
      ]
    },
    {
      "content": "Include the <ph id=\"ph1\">`x-zumo-auth`</ph> token as an HTTP header.",
      "pos": [
        11180,
        11230
      ]
    },
    {
      "content": "The URL follows this pattern:",
      "pos": [
        11236,
        11265
      ]
    },
    {
      "content": "For example:",
      "pos": [
        11406,
        11418
      ]
    },
    {
      "content": "To send the request in Postman in Chrome, perform the following steps:",
      "pos": [
        11570,
        11640
      ]
    },
    {
      "pos": [
        11648,
        11690
      ],
      "content": "Enter the <bpt id=\"p1\">**</bpt>Request URL<ept id=\"p1\">**</ept> described above."
    },
    {
      "pos": [
        11697,
        11724
      ],
      "content": "Set the method to <bpt id=\"p1\">**</bpt>Post<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        11731,
        11764
      ],
      "content": "Add a header named <ph id=\"ph1\">`x-zumo-auth`</ph>."
    },
    {
      "pos": [
        11771,
        11858
      ],
      "content": "In the header <bpt id=\"p1\">**</bpt>Value<ept id=\"p1\">**</ept> field paste the value you copied from the <ph id=\"ph1\">`x-zumo-auth`</ph> cookie."
    },
    {
      "pos": [
        11865,
        11880
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Send<ept id=\"p1\">**</ept>."
    },
    {
      "content": "The following illustration shows the Postman tool in Chrome:",
      "pos": [
        11891,
        11951
      ]
    },
    {
      "content": "Send for consent URL",
      "pos": [
        11959,
        11979
      ]
    },
    {
      "content": "The response includes a URL to use in order to initiate the process of logging in the user with Dropbox.",
      "pos": [
        12066,
        12170
      ]
    },
    {
      "content": "(If you get an error response that indicates the Get method is not supported although you have the method dropdown set to <bpt id=\"p1\">**</bpt>Post<ept id=\"p1\">**</ept>, make sure that your gateway URL is HTTPS, not HTTP.)",
      "pos": [
        12171,
        12355
      ]
    },
    {
      "content": "Consent URL",
      "pos": [
        12363,
        12374
      ]
    },
    {
      "content": "Go to the URL that you received in response to the HTTP Post request.",
      "pos": [
        12459,
        12528
      ]
    },
    {
      "content": "The response to this URL redirects the browser to the Dropbox site, where the user logs in and grants consent for the app to access the user's account.",
      "pos": [
        12534,
        12685
      ]
    },
    {
      "content": "When the login and consent process is done, Dropbox redirects the browser to the redirect URL that you specified (e.g., the Azure preview portal if you followed the example and used https://portal.azure.com).",
      "pos": [
        12695,
        12903
      ]
    },
    {
      "content": "If you were calling from a web app, this would be the next page to be displayed in the web app.",
      "pos": [
        12904,
        12999
      ]
    },
    {
      "content": "The app should check the URL, because if there was an error in the login or consent process, the redirect URL could include an <ph id=\"ph1\">`error`</ph> querystring variable.",
      "pos": [
        13001,
        13157
      ]
    },
    {
      "content": "Keep this browser window open, as you'll use it in the following section.",
      "pos": [
        13162,
        13235
      ]
    },
    {
      "content": "Call the Dropbox connector API",
      "pos": [
        13241,
        13271
      ]
    },
    {
      "content": "Azure is now managing three authentication tokens for you:",
      "pos": [
        13274,
        13332
      ]
    },
    {
      "content": "One from the authentication provider you configured for the gateway, for example Azure Active Directory.",
      "pos": [
        13336,
        13440
      ]
    },
    {
      "content": "One from Dropbox.",
      "pos": [
        13443,
        13460
      ]
    },
    {
      "content": "One that Azure creates (the \"zumo\" token).",
      "pos": [
        13463,
        13505
      ]
    },
    {
      "content": "The only one you have to use when making HTTP requests to work with Dropbox is the zumo token.",
      "pos": [
        13507,
        13601
      ]
    },
    {
      "content": "Behind the scenes Azure has associated that token with the other two, and the connector provides the other two on your behalf when it makes calls to Dropbox.",
      "pos": [
        13602,
        13759
      ]
    },
    {
      "content": "In the following steps you make a Get request to the Dropbox connector to look at files in your Dropbox account.",
      "pos": [
        13761,
        13873
      ]
    },
    {
      "content": "Since you can use a browser window for a Get request, and since your browser window already has the zumo token in a cookie, all you have to do is go to a URL and you get back Dropbox data.",
      "pos": [
        13874,
        14062
      ]
    },
    {
      "pos": [
        14068,
        14190
      ],
      "content": "In the browser window that has the Azure preview portal open, go back to the <bpt id=\"p1\">**</bpt>API App<ept id=\"p1\">**</ept> blade for your Dropbox connector."
    },
    {
      "content": "Copy the API app's URL.",
      "pos": [
        14196,
        14219
      ]
    },
    {
      "pos": [
        14225,
        14309
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>API definition<ept id=\"p1\">**</ept> icon to see the API methods available in the connector."
    },
    {
      "content": "API App blade",
      "pos": [
        14317,
        14330
      ]
    },
    {
      "content": "API definition",
      "pos": [
        14417,
        14431
      ]
    },
    {
      "content": "In the browser window that you used to authenticate to the gateway, call the GET method that retrieves file names from a folder.",
      "pos": [
        14510,
        14638
      ]
    },
    {
      "content": "Here is the URL pattern:",
      "pos": [
        14639,
        14663
      ]
    },
    {
      "content": "For example, if your connector URL is https://dropboxrg784237ad3e7.azurewebsites.net and you want to see the files in your blog folder, the URL would be:",
      "pos": [
        14715,
        14868
      ]
    },
    {
      "content": "Different browsers respond to API calls differently; if you're using Chrome you'll see a response similar to the following example:",
      "pos": [
        14942,
        15073
      ]
    },
    {
      "content": "Get response to folder request",
      "pos": [
        15081,
        15111
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        15194,
        15204
      ]
    },
    {
      "content": "You've seen how to install, configure, and test a SaaS connector.",
      "pos": [
        15206,
        15271
      ]
    },
    {
      "content": "For more information, see these resources:",
      "pos": [
        15272,
        15314
      ]
    },
    {
      "content": "Using connectors",
      "pos": [
        15319,
        15335
      ]
    },
    {
      "content": "Authentication for API apps and mobile apps",
      "pos": [
        15399,
        15442
      ]
    },
    {
      "content": "test",
      "pos": [
        15604,
        15608
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Deploy and configure a SaaS connector API app\" \n    description=\"Learn how to configure a SaaS connector that you install in your Azure subscription from the Azure Marketplace.\" \n    services=\"app-service\\api\" \n    documentationCenter=\".net\" \n    authors=\"tdykstra\" \n    manager=\"wpickett\" \n    editor=\"jimbe\"/>\n\n<tags \n    ms.service=\"app-service-api\" \n    ms.workload=\"web\" \n    ms.tgt_pltfrm=\"dotnet\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"08/06/2015\" \n    ms.author=\"tdykstra\"/>\n\n# Deploy and configure a SaaS connector API app in Azure App Service\n\n## Overview\n\nThis tutorial shows how to install, configure, and test a [Software-as-a-Service (SaaS) connector](../app-service-logic-what-are-bizTalk-api-apps.md) in [Azure App Service](/documentation/services/app-service/) for calling it programmatically, such as from a mobile app. A SaaS connector is an [API app](app-service-api-apps-why-best-platform.md) that simplifies interaction with a SaaS platform such as Office 365, Salesforce, Facebook, and Dropbox. If instead of using a prepackaged connector you want to create a custom .NET API app, see [Connect to a SaaS platform from an ASP.NET API app](app-service-api-dotnet-connect-to-saas.md). \n\nFor example, if you want to code HTTP requests to read and write files in your Dropbox account, the authentication process for working directly with Dropbox is complicated. A Dropbox connector takes care of the complexity of authentication so that you can focus on writing your business-specific code.\n\n> [AZURE.NOTE] The instructions here are not required if you want to use a SaaS connector from a logic app. For information  about how to use SaaS connectors inside logic apps, see [Create a new logic app](../app-service-logic/app-service-logic-create-a-logic-app.md) and [Using custom OAUTH Application in Connectors](https://social.msdn.microsoft.com/Forums/en-US/home?forum=azurelogicapps&announcementId=4af1e4c5-d220-4457-97d8-d08e427ae6c1).\n \nThis tutorial uses a DropBox connector as an example and walks you through the following steps:\n\n* Install the Dropbox connector in a [resource group](../resource-group-overview.md) in your Azure subscription. \n* Configure the Dropbox connector so that it can connect to the Dropbox service. (To complete this step you'll need a Dropbox account.)\n* Configure the resource group so that only authenticated users can access API apps that are included in the resource group.\n* Test to verify that both user authentication and Dropbox authentication work.\n\nFor more information about authentication in App Service, see [Authentication for API apps and mobile apps](../app-service/app-service-authentication-overview.md). \n\n## Install the Dropbox connector\n\n1. Go to the [Azure preview portal] home page and click **Marketplace**.\n\n    ![Marketplace in Azure preview portal](./media/app-service-api-connnect-your-app-to-saas-connector/marketplace.png)\n\n2. Search for Dropbox, and then click the **Dropbox Connector** icon.\n\n    ![Click Dropbox Connector](./media/app-service-api-connnect-your-app-to-saas-connector/searchdb.png)\n \n3. Click **Create**.\n\n    ![Click Create](./media/app-service-api-connnect-your-app-to-saas-connector/clickcreate.png)\n \n5. In the **Dropbox Connector** blade, under **App Service plan** click **Create New**, and then in the **Create new App Service plan** box enter DropBoxPlan. \n\n    For more information about App Service plans, see [Azure App Service plans in-depth overview](azure-web-sites-web-hosting-plans-in-depth-overview.md). \n\n4. Under **Resource Group**, click **Create New**, and then in the **Create New Resource Group** box enter DropboxRG.\n\n    For more information about resource groups, see [Using resource groups to manage your Azure resources](../resource-group-overview.md).\n\n7. Select the Free **Pricing Tier**. (If you don't see it in the list, click **View All**. After you click **F1 Free**, click the **Select** button.)\n\n    You can use a paid pricing tier, but it isn't required for this tutorial.\n \n11. Choose a **Location** close to you.  \n\n9. <a id=\"gateway\"></a>Keep the default \"DropboxConnector\" as the **Name** of the connector, and then click **Create**. \n\n    ![Click create](./media/app-service-api-connnect-your-app-to-saas-connector/createdropbox.png) \n\n    Azure App Service creates a resource group, and in the resource group it creates a Dropbox connector API app, and a *gateway* web app. The gateway's function is to manage access to all API apps in the resource group. \n\n    You can check the progress of resource creation by clicking **Notifications** on the Azure preview portal home page.\n\n3. When Azure finishes creating the connector, click **Browse > Resource groups > DropboxRG**.\n \n    The **Resource Group** blade for DropboxRG shows the connector and the gateway in the resource group.\n\n    ![Resource group diagram](./media/app-service-api-connnect-your-app-to-saas-connector/rgdiagram.png) \n\n## Configure your Dropbox account and the Dropbox connector\n\nTo enable API access to your Dropbox account, you have to create a Dropbox app on the Dropbox developer site. Then you copy the client ID and client secret values from that Dropbox app to your Dropbox connector, and you set the connector to accept only authenticated requests.\n\n### <a id=\"createdbapp\"></a>Create a Dropbox app\n\n[AZURE.INCLUDE [app-service-api-create-dropbox-app](../../includes/app-service-api-create-dropbox-app.md)]\n\n### <a id=\"copysettings\"></a>Copy the Dropbox app settings to the Azure Dropbox connector and vice versa \n\n[AZURE.INCLUDE [app-service-api-exchange-dropbox-settings](../../includes/app-service-api-exchange-dropbox-settings.md)]\n\n### Set the Dropbox connector to require authenticated access\n\nBy default the connector's **Access level** is set to **Internal**, meaning it can only be called by other API apps and web apps in the same resource group. But Dropbox allows only authenticated users to access your Dropbox account, so you have to change the access level setting to require user authentication.\n\n1. Go back to the **Settings** blade, and click **Application settings**.\n\n2. In the **Application settings** blade, set **Access level** to **Public (authenticated)**, and then click **Save**. \n    \n    ![Set to Public (authenticated)](./media/app-service-api-connnect-your-app-to-saas-connector/pubauth.png)\n\nYou have now configured the Dropbox Connector so that outgoing calls can access your Dropbox account, and incoming calls must be from authenticated users. In the next section you specify which authentication provider you want to use to authenticate users.\n\n## Configure the gateway\n\nAs explained [earlier](#gateway), the gateway is a special web app that manages access to all API apps in a resource group. To set up the gateway to authenticate users, you choose an authentication provider such as Azure Active Directory, Google, or Twitter. Users will then have to authenticate with the chosen provider before they can successfully call the Dropbox connector.\n\n- To perform this step, go to the [Configure the gateway](app-service-api-dotnet-add-authentication.md#configure-the-gateway) section of the [Protect an API app](app-service-api-dotnet-add-authentication.md) tutorial, and follow the directions there to configure the gateway in your DropboxRG resource group.\n\n## Test to verify user and Dropbox authentication\n\nAfter you have configured the gateway in your DropboxRG resource group to use an authentication provider, you can test your Dropbox connector.\n\nMost of the time you'll use a connector by calling it from code, and we're also writing tutorials that will show how to do that. But sometimes you'll want to validate that the connector is working before wiring up other parts of an app. This tutorial shows how to use a browser and a simple REST client tool to verify that you can interact with the Dropbox service through the Dropbox connector that you just installed and configured.\n\nThe following instructions show how to do these steps by using the Chrome browser developer tools and Postman REST client tool. This is just an example, and you can do the same procedures with other browsers and tools. \"Advanced REST Client\" is another Chrome add-in you can use.\n\n### Log in as an end user\n\nDo the following steps in a new browser window. Depending on what authentication provider you're using, you might find that you need to use a private or incognito window.\n\n2. Go to the login URL for the gateway and the authentication provider that you configured. The URL follows this pattern: \n\n        http://[gatewayurl]/login/[providername]\n\n    You can get the gateway URL from the **Gateway** blade in the [Azure preview portal]. (To get to the **Gateway** blade, click the gateway in the diagram shown on the **Resource group** blade.)\n\n    ![Gateway URL](./media/app-service-api-connnect-your-app-to-saas-connector/gatewayurl.png)\n\n    The [providername] value is \"facebook\" for Facebook, \"twitter\" for Twitter, \"aad\" for Azure Active directory, etc.\n\n    Here is a sample login URL for Azure Active Directory:\n\n        https://dropboxrgaeb4ae60b7cb4f3d966dfa43.azurewebsites.net/login/aad/\n\n3. Enter your credentials when the browser displays a login page. \n \n    If you configured Azure Active Directory login, log in as one of the users listed in the **Users** tab for the application you created in the Azure Active Directory tab of the [Azure portal], such as admin@contoso.onmicrosoft.com.\n\n    When login is successful, you get a \"Login complete\" page.\n\n    ![](./media/app-service-api-connnect-your-app-to-saas-connector/logindone.png)\n\n### Provide the user's identity to Dropbox\n\nTo get Dropbox authorization to use the Dropbox API, you have to provide the user's credentials to Dropbox.  Azure will initiate that process for you, but to trigger that process you have to go to a special gateway URL in the browser.  To get that URL you make an HTTP Post request to the gateway.\n\nThe HTTP Post request to the gateway has to include the authentication token that Azure provided when you logged in. For browser requests, including the token is automatic because the token is stored in a cookie, but for an HTTP Post request using a REST client tool you have to get the token from the cookie and put it in the request header of the HTTP Post request.\n\n1. In the browser window that has the \"Login complete\" message, go to the browser's developer tools and find the `x-zumo-auth` cookie. Keep this window open so you can copy the value of the cookie in the next step.\n \n    To get the cookie value in Chrome, perform the following steps:\n\n    - Press F12 to open developer tools.\n    - Go to the **Resources** tab.\n    - Find the cookies for your gateway site, and triple-click the **Value** of the `x-zumo-auth` cookie to select all of it. (Make sure you get all of the cookie's value. If you double-click, you might get only the first part of it.)  \n\n    ![Copy token](./media/app-service-api-connnect-your-app-to-saas-connector/copytoken.png) \n\n4. In a new browser tab or window, create and send an HTTP Post request to the gateway to request a consent URL. Include the `x-zumo-auth` token as an HTTP header.\n\n    The URL follows this pattern:\n\n        [gatewayurl]/api/consent/list?api-version=2015-01-14&redirecturl=[a URL you want the browser to go to after you authenticate]\n\n    For example:\n\n        https://dropboxrgaeb4ae60b7cb4f3d966dfa43.azurewebsites.net/api/consent/list?api-version=2015-01-14&redirecturl=https://portal.azure.com\n\n    To send the request in Postman in Chrome, perform the following steps:\n\n    - Enter the **Request URL** described above.\n    - Set the method to **Post**.\n    - Add a header named `x-zumo-auth`.\n    - In the header **Value** field paste the value you copied from the `x-zumo-auth` cookie.\n    - Click **Send**.\n     \n    The following illustration shows the Postman tool in Chrome:\n\n    ![Send for consent URL](./media/app-service-api-connnect-your-app-to-saas-connector/sendforconsent.png)\n\n    The response includes a URL to use in order to initiate the process of logging in the user with Dropbox. (If you get an error response that indicates the Get method is not supported although you have the method dropdown set to **Post**, make sure that your gateway URL is HTTPS, not HTTP.)\n\n    ![Consent URL](./media/app-service-api-connnect-your-app-to-saas-connector/getconsenturl.png)\n\n2. Go to the URL that you received in response to the HTTP Post request.\n\n    The response to this URL redirects the browser to the Dropbox site, where the user logs in and grants consent for the app to access the user's account.\n    \n    When the login and consent process is done, Dropbox redirects the browser to the redirect URL that you specified (e.g., the Azure preview portal if you followed the example and used https://portal.azure.com). If you were calling from a web app, this would be the next page to be displayed in the web app.  The app should check the URL, because if there was an error in the login or consent process, the redirect URL could include an `error` querystring variable.\n\n3. Keep this browser window open, as you'll use it in the following section.\n\n### Call the Dropbox connector API \n\nAzure is now managing three authentication tokens for you:\n\n- One from the authentication provider you configured for the gateway, for example Azure Active Directory.\n- One from Dropbox.\n- One that Azure creates (the \"zumo\" token).\n\nThe only one you have to use when making HTTP requests to work with Dropbox is the zumo token. Behind the scenes Azure has associated that token with the other two, and the connector provides the other two on your behalf when it makes calls to Dropbox.\n\nIn the following steps you make a Get request to the Dropbox connector to look at files in your Dropbox account. Since you can use a browser window for a Get request, and since your browser window already has the zumo token in a cookie, all you have to do is go to a URL and you get back Dropbox data. \n\n1. In the browser window that has the Azure preview portal open, go back to the **API App** blade for your Dropbox connector. \n\n2. Copy the API app's URL.\n \n4. Click the **API definition** icon to see the API methods available in the connector.\n\n    ![API App blade](./media/app-service-api-connnect-your-app-to-saas-connector/apiappblade.png) \n\n    ![API definition](./media/app-service-api-connnect-your-app-to-saas-connector/apidef.png) \n\n2. In the browser window that you used to authenticate to the gateway, call the GET method that retrieves file names from a folder. Here is the URL pattern:\n\n        [connectorurl]/folder/[foldername]\n   \n3. For example, if your connector URL is https://dropboxrg784237ad3e7.azurewebsites.net and you want to see the files in your blog folder, the URL would be:\n\n        https://dropboxrg784237ad3e7.azurewebsites.net/folder/blog\n\n    Different browsers respond to API calls differently; if you're using Chrome you'll see a response similar to the following example:\n\n    ![Get response to folder request](./media/app-service-api-connnect-your-app-to-saas-connector/dbresponse.png) \n\n## Next steps\n\nYou've seen how to install, configure, and test a SaaS connector. For more information, see these resources:\n\n* [Using connectors](../app-service-logic/app-service-logic-connectors-list.md)\n* [Authentication for API apps and mobile apps](../app-service/app-service-authentication-overview.md)  \n\n[Azure preview portal]: https://portal.azure.com/\n[Azure portal]: https://manage.windowsazure.com/\n \n\ntest\n"
}