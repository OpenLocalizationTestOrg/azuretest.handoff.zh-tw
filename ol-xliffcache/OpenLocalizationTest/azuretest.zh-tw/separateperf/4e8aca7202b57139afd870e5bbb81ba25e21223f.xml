{
  "nodes": [
    {
      "content": "Setting up services required to publish a cloud service from Visual Studio",
      "pos": [
        27,
        101
      ]
    },
    {
      "content": "Learn the procedures to set up cloud and storage account services and configure your Azure application",
      "pos": [
        119,
        221
      ]
    },
    {
      "content": "Setting up services required to publish a cloud service from Visual Studio",
      "pos": [
        521,
        595
      ]
    },
    {
      "content": "Overview",
      "pos": [
        599,
        607
      ]
    },
    {
      "content": "Before you can publish a cloud service project, you must set up the following services:",
      "pos": [
        609,
        696
      ]
    },
    {
      "pos": [
        700,
        762
      ],
      "content": "A <bpt id=\"p1\">**</bpt>cloud service<ept id=\"p1\">**</ept> to run your roles in the Azure environment"
    },
    {
      "pos": [
        766,
        848
      ],
      "content": "A <bpt id=\"p1\">**</bpt>storage account<ept id=\"p1\">**</ept> that provides access to the Blob, Queue, and Table services."
    },
    {
      "content": "Use the following procedures to set up these services and configure your application",
      "pos": [
        850,
        934
      ]
    },
    {
      "content": "Create a cloud service",
      "pos": [
        940,
        962
      ]
    },
    {
      "content": "To publish a cloud service to Azure, you must first create a cloud service, which runs your roles in the Azure environment.",
      "pos": [
        964,
        1087
      ]
    },
    {
      "content": "You can create a cloud service in the Azure Management Portal, as described <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](#to-create-a-cloud-service-by-using-the-azure-management-portal)</ept>.",
      "pos": [
        1088,
        1236
      ]
    },
    {
      "content": "You can also create a cloud service in Visual Studio when you use the publishing wizard.",
      "pos": [
        1237,
        1325
      ]
    },
    {
      "content": "To create a cloud service by using Visual Studio",
      "pos": [
        1331,
        1379
      ]
    },
    {
      "pos": [
        1384,
        1453
      ],
      "content": "Open the shortcut menu for the Azure project, and choose <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept>."
    },
    {
      "content": "VST_PublishMenu",
      "pos": [
        1461,
        1476
      ]
    },
    {
      "content": "If you haven't signed in, sign in with your username and password for the Microsoft account or organizational account that's associated with your Azure subscription.",
      "pos": [
        1591,
        1756
      ]
    },
    {
      "pos": [
        1761,
        1824
      ],
      "content": "Choose the <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> button to advance to the <bpt id=\"p2\">**</bpt>Settings<ept id=\"p2\">**</ept> page."
    },
    {
      "content": "Publishing Wizard Common Settings",
      "pos": [
        1832,
        1865
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Cloud Services<ept id=\"p1\">**</ept> list, choose <bpt id=\"p2\">**</bpt>Create New<ept id=\"p2\">**</ept>.",
      "pos": [
        1985,
        2039
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Create Azure Services<ept id=\"p1\">**</ept> dialog appears.",
      "pos": [
        2040,
        2085
      ]
    },
    {
      "content": "Enter the name of your cloud service.",
      "pos": [
        2090,
        2127
      ]
    },
    {
      "content": "The name forms part of the URL for your service and therefore must be globally unique.",
      "pos": [
        2128,
        2214
      ]
    },
    {
      "content": "The name is not case-sensitive.",
      "pos": [
        2215,
        2246
      ]
    },
    {
      "content": "To create a cloud service by using the Azure Management Portal",
      "pos": [
        2252,
        2314
      ]
    },
    {
      "pos": [
        2319,
        2432
      ],
      "content": "Sign in to the <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=253103)</ept> on the Microsoft website."
    },
    {
      "content": "(optional) To display a list of cloud services that you've already created, choose the Cloud Services link on the left side of the page.",
      "pos": [
        2437,
        2573
      ]
    },
    {
      "content": "Choose the <bpt id=\"p1\">**</bpt>+<ept id=\"p1\">**</ept> icon in the lower-left corner, and then choose <bpt id=\"p2\">**</bpt>Cloud Service<ept id=\"p2\">**</ept> on the menu that appears.",
      "pos": [
        2578,
        2685
      ]
    },
    {
      "content": "Another screen with two options, <bpt id=\"p1\">**</bpt>Quick Create<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Custom Create<ept id=\"p2\">**</ept>, appears.",
      "pos": [
        2686,
        2767
      ]
    },
    {
      "content": "If you choose <bpt id=\"p1\">**</bpt>Quick Create<ept id=\"p1\">**</ept>, you can create a cloud service just by specifying its URL and the region where it will be physically hosted.",
      "pos": [
        2768,
        2908
      ]
    },
    {
      "content": "If you choose <bpt id=\"p1\">**</bpt>Custom Create<ept id=\"p1\">**</ept>, you can immediately publish a cloud service by specifying a package (.cspkg file), a configuration (.cscfg) file, and a certificate.",
      "pos": [
        2909,
        3074
      ]
    },
    {
      "content": "Custom Create isn’t required if you intend to publish your cloud service by using the <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept> command in an Azure project.",
      "pos": [
        3075,
        3201
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept> command is available on the shortcut menu for an Azure project.",
      "pos": [
        3202,
        3281
      ]
    },
    {
      "pos": [
        3286,
        3369
      ],
      "content": "Choose <bpt id=\"p1\">**</bpt>Quick Create<ept id=\"p1\">**</ept> to later publish your cloud service by using Visual Studio."
    },
    {
      "content": "Specify a name for your cloud service.The complete URL appears next to the name.",
      "pos": [
        3374,
        3454
      ]
    },
    {
      "content": "In the list, choose the region where most of your users are located.",
      "pos": [
        3459,
        3527
      ]
    },
    {
      "pos": [
        3532,
        3602
      ],
      "content": "At the bottom of the window, choose the <bpt id=\"p1\">**</bpt>Create Cloud Service<ept id=\"p1\">**</ept> link."
    },
    {
      "content": "Create a storage account",
      "pos": [
        3607,
        3631
      ]
    },
    {
      "content": "A storage account provides access to the Blob, Queue, and Table services.",
      "pos": [
        3633,
        3706
      ]
    },
    {
      "content": "You can create a storage account by using Visual Studio or the <bpt id=\"p1\">[</bpt>Azure Platform Management Portal<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=253103)</ept>.",
      "pos": [
        3707,
        3852
      ]
    },
    {
      "content": "To create a storage account by using Visual Studio",
      "pos": [
        3858,
        3908
      ]
    },
    {
      "pos": [
        3913,
        4027
      ],
      "content": "In Solution Explorer, open the shortcut menu for the <bpt id=\"p1\">**</bpt>Storage<ept id=\"p1\">**</ept> node, and then choose <bpt id=\"p2\">**</bpt>Create Storage Account<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Create a new Azure storage account",
      "pos": [
        4035,
        4069
      ]
    },
    {
      "pos": [
        4176,
        4291
      ],
      "content": "Select or enter the following information for the new storage account in the <bpt id=\"p1\">**</bpt>Create Storage Account<ept id=\"p1\">**</ept> dialog box."
    },
    {
      "content": "The Azure subscription to which you want to add the storage account.",
      "pos": [
        4298,
        4366
      ]
    },
    {
      "content": "The name you want to use for the new storage account.",
      "pos": [
        4373,
        4426
      ]
    },
    {
      "content": "The region or affinity group (such as West US or East Asia).",
      "pos": [
        4433,
        4493
      ]
    },
    {
      "content": "The type of replication you want to use for the storage account, such as Geo-Redundant.",
      "pos": [
        4500,
        4587
      ]
    },
    {
      "pos": [
        4592,
        4703
      ],
      "content": "When you’re done, choose <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>.The new storage account appears in the <bpt id=\"p2\">**</bpt>Storage<ept id=\"p2\">**</ept> list in Server Explorer."
    },
    {
      "content": "To create a storage account by using the Azure Management Portal",
      "pos": [
        4709,
        4773
      ]
    },
    {
      "pos": [
        4778,
        4900
      ],
      "content": "Sign in to the <bpt id=\"p1\">[</bpt>Azure Platform Management Portal<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=253103)</ept> on the Microsoft website."
    },
    {
      "pos": [
        4905,
        5017
      ],
      "content": "(optional) To view your storage accounts, choose the <bpt id=\"p1\">**</bpt>Storage<ept id=\"p1\">**</ept> link in the panel on the left side of the page."
    },
    {
      "pos": [
        5022,
        5082
      ],
      "content": "In the lower-left corner of the page, choose the <bpt id=\"p1\">**</bpt>+<ept id=\"p1\">**</ept> icon."
    },
    {
      "pos": [
        5087,
        5166
      ],
      "content": "In the menu that appears, choose <bpt id=\"p1\">**</bpt>Storage<ept id=\"p1\">**</ept>, and then choose <bpt id=\"p2\">**</bpt>Quick Create<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Give the storage account a name that will result in a unique url.",
      "pos": [
        5171,
        5236
      ]
    },
    {
      "content": "Give your cloud service a name.",
      "pos": [
        5241,
        5272
      ]
    },
    {
      "content": "The complete URL appears next to the name.",
      "pos": [
        5273,
        5315
      ]
    },
    {
      "content": "In the list of regions, choose a region where most of your users are located.",
      "pos": [
        5320,
        5397
      ]
    },
    {
      "content": "Specify whether you want to enable geo-replication.",
      "pos": [
        5402,
        5453
      ]
    },
    {
      "content": "If you enable geo-replication, your data will be saved in multiple physical locations to reduce the chance of loss.",
      "pos": [
        5454,
        5569
      ]
    },
    {
      "content": "This feature makes storage more expensive, but you can reduce the cost by enabling geo-location when you create the storage account instead of adding the feature later.",
      "pos": [
        5570,
        5738
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Geo-replication<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=253108)</ept>.",
      "pos": [
        5739,
        5830
      ]
    },
    {
      "pos": [
        5835,
        5907
      ],
      "content": "At the bottom of the window, choose the <bpt id=\"p1\">**</bpt>Create Storage Account<ept id=\"p1\">**</ept> link."
    },
    {
      "content": "After you create your storage account, you will see the URLs that you can use to access resources in each of the Azure storage services, and also the primary and secondary access keys for your account.",
      "pos": [
        5909,
        6110
      ]
    },
    {
      "content": "You use these keys to authenticate requests made against the storage services.",
      "pos": [
        6111,
        6189
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The secondary access key provides the same access to your storage account as the primary access key and is generated as a backup should your primary access key be compromised.",
      "pos": [
        6192,
        6380
      ]
    },
    {
      "content": "Additionally, it is recommended that you regenerate your access keys on a regular basis.",
      "pos": [
        6381,
        6469
      ]
    },
    {
      "content": "You can modify a connection string setting to use the secondary key while you regenerate the primary key, then you can modify it to use the regenerated primary key while you regenerate the secondary key.",
      "pos": [
        6470,
        6673
      ]
    },
    {
      "content": "Configure your app to use services provided by the storage account",
      "pos": [
        6678,
        6744
      ]
    },
    {
      "content": "You must configure any role that accesses storage services to use the Azure storage services that you have created.",
      "pos": [
        6746,
        6861
      ]
    },
    {
      "content": "To do this, you can use multiple service configurations for your Azure project.",
      "pos": [
        6862,
        6941
      ]
    },
    {
      "content": "By default, two are created in your Azure project.",
      "pos": [
        6942,
        6992
      ]
    },
    {
      "content": "By using multiple service configurations, you can use the same connection string in your code, but have a different value for a connection string in each service configuration.",
      "pos": [
        6993,
        7169
      ]
    },
    {
      "content": "For example, you can use one service configuration to run and debug your application locally using the Azure storage emulator and a different service configuration to publish your application to Azure.",
      "pos": [
        7170,
        7371
      ]
    },
    {
      "content": "For more information about service configurations, see <bpt id=\"p1\">[</bpt>Configuring an Azure Project<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/ee405486.aspx)</ept>.",
      "pos": [
        7372,
        7514
      ]
    },
    {
      "content": "To configure your application to use services that the storage account provides",
      "pos": [
        7520,
        7599
      ]
    },
    {
      "content": "In Visual Studio open your Azure solution.",
      "pos": [
        7604,
        7646
      ]
    },
    {
      "content": "In Solution Explorer, open the shortcut menu for each role in your Azure project that accesses the storage services and choose <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.",
      "pos": [
        7647,
        7789
      ]
    },
    {
      "content": "A page with the name of the role is displayed in the Visual Studio editor.",
      "pos": [
        7790,
        7864
      ]
    },
    {
      "content": "The page displays the fields for the <bpt id=\"p1\">**</bpt>Configuration<ept id=\"p1\">**</ept> tab.",
      "pos": [
        7865,
        7924
      ]
    },
    {
      "pos": [
        7929,
        7985
      ],
      "content": "In the property pages for the role, choose <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept>."
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Service Configuration<ept id=\"p1\">**</ept> list, choose the name of the service configuration that you want to edit.",
      "pos": [
        7990,
        8096
      ]
    },
    {
      "content": "If you want to make changes to all of the service configurations for this role, you can choose <bpt id=\"p1\">**</bpt>All Configurations<ept id=\"p1\">**</ept>.",
      "pos": [
        8097,
        8215
      ]
    },
    {
      "content": "For more information about how to update service configurations, see <bpt id=\"p1\">[</bpt>Manage Connection Strings for Storage Accounts<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/8cda8963-ef0e-4f64-8d29-5eac467e5f53#ConnectionStrings)</ept>.",
      "pos": [
        8217,
        8432
      ]
    },
    {
      "content": "To modify any connection string settings, choose the <bpt id=\"p1\">**</bpt>…<ept id=\"p1\">**</ept> button next to the setting.",
      "pos": [
        8437,
        8523
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Create Storage Connection String<ept id=\"p1\">**</ept> dialog box appears.",
      "pos": [
        8524,
        8584
      ]
    },
    {
      "pos": [
        8589,
        8654
      ],
      "content": "Under <bpt id=\"p1\">**</bpt>Connect using<ept id=\"p1\">**</ept>, choose the <bpt id=\"p2\">**</bpt>Your subscription<ept id=\"p2\">**</ept> option."
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Subscription<ept id=\"p1\">**</ept> list, choose your subscription.",
      "pos": [
        8659,
        8714
      ]
    },
    {
      "content": "If the list of subscriptions doesn't include the one that you want, choose the <bpt id=\"p1\">**</bpt>Download Publish Settings<ept id=\"p1\">**</ept> link.",
      "pos": [
        8715,
        8829
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Account name<ept id=\"p1\">**</ept> list, choose your storage account name.",
      "pos": [
        8834,
        8897
      ]
    },
    {
      "content": "Azure Tools obtains storage account credentials automatically by using the .publishsettings file.",
      "pos": [
        8898,
        8995
      ]
    },
    {
      "content": "To specify your storage account credentials manually, choose the <bpt id=\"p1\">**</bpt>Manually entered credentials<ept id=\"p1\">**</ept> option, and then continue with this procedure.",
      "pos": [
        8996,
        9140
      ]
    },
    {
      "content": "You can get your storage account name and primary key from the <bpt id=\"p1\">[</bpt>Management Portal<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkID=213885)</ept>.",
      "pos": [
        9141,
        9273
      ]
    },
    {
      "content": "If you don’t want to specify your storage account settings manually, choose the <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> button to close the dialog box.",
      "pos": [
        9274,
        9392
      ]
    },
    {
      "pos": [
        9397,
        9451
      ],
      "content": "Choose the <bpt id=\"p1\">**</bpt>Enter storage account<ept id=\"p1\">**</ept> credentials link."
    },
    {
      "pos": [
        9456,
        9524
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Account name<ept id=\"p1\">**</ept> box, enter the name of your storage account."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Log into the Management Portal, and then choose the <bpt id=\"p1\">**</bpt>Storage<ept id=\"p1\">**</ept> button.",
      "pos": [
        9531,
        9615
      ]
    },
    {
      "content": "The portal shows a list of storage accounts.",
      "pos": [
        9616,
        9660
      ]
    },
    {
      "content": "If you choose an account, a page for it opens.",
      "pos": [
        9661,
        9707
      ]
    },
    {
      "content": "You can copy the name of the storage account from this page.",
      "pos": [
        9708,
        9768
      ]
    },
    {
      "content": "If you are using a previous version of the Management Portal, the name of your storage account appears in the <bpt id=\"p1\">**</bpt>Storage Accounts<ept id=\"p1\">**</ept> view of the Management Portal.",
      "pos": [
        9769,
        9930
      ]
    },
    {
      "content": "To copy this name, highlight it in the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window of this view, and then choose the Ctrl-C keys.",
      "pos": [
        9931,
        10038
      ]
    },
    {
      "content": "To paste the name into Visual Studio, choose the <bpt id=\"p1\">**</bpt>Account name<ept id=\"p1\">**</ept> text box, and then choose the Ctrl+V keys.",
      "pos": [
        10039,
        10147
      ]
    },
    {
      "pos": [
        10152,
        10351
      ],
      "content": "In the **Account key** box, enter your primary key, or copy and paste it from the [Management Portal](http://go.microsoft.com/fwlink/?LinkID=213885). \n To copy this key from the Management Portal:",
      "leadings": [
        "",
        "   "
      ],
      "nodes": [
        {
          "content": "In the <bpt id=\"p1\">**</bpt>Account key<ept id=\"p1\">**</ept> box, enter your primary key, or copy and paste it from the <bpt id=\"p2\">[</bpt>Management Portal<ept id=\"p2\">](http://go.microsoft.com/fwlink/?LinkID=213885)</ept>.",
          "pos": [
            0,
            149
          ]
        },
        {
          "content": "To copy this key from the Management Portal:",
          "pos": [
            152,
            196
          ]
        }
      ]
    },
    {
      "pos": [
        10360,
        10457
      ],
      "content": "At the bottom of the page for the appropriate storage account, choose the <bpt id=\"p1\">**</bpt>Manage Keys<ept id=\"p1\">**</ept> button."
    },
    {
      "pos": [
        10466,
        10577
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Manage Keys Access<ept id=\"p1\">**</ept> page, select the text of the primary access key, and then choose the Ctrl+C keys."
    },
    {
      "pos": [
        10586,
        10645
      ],
      "content": "In Azure Tools, paste the key into the <bpt id=\"p1\">**</bpt>Account key<ept id=\"p1\">**</ept> box."
    },
    {
      "content": "You must select one of the following options to determine how the service will access the storage account:",
      "pos": [
        10654,
        10760
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Use HTTP<ept id=\"p1\">**</ept>.",
      "pos": [
        10771,
        10784
      ]
    },
    {
      "content": "This is the standard option.",
      "pos": [
        10785,
        10813
      ]
    },
    {
      "content": "For example, <ph id=\"ph1\">`http://&lt;account name&gt;.blob.core.windows.net`</ph>.",
      "pos": [
        10814,
        10873
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Use HTTPS<ept id=\"p1\">**</ept> for a secure connection.",
      "pos": [
        10884,
        10922
      ]
    },
    {
      "content": "For example, <ph id=\"ph1\">`https://&lt;accountname&gt;.blob.core.windows.net`</ph>.",
      "pos": [
        10923,
        10982
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Specify custom endpoints<ept id=\"p1\">**</ept> for each of the three services.",
      "pos": [
        10993,
        11053
      ]
    },
    {
      "content": "You can then type these endpoints into the field for the specific service.",
      "pos": [
        11054,
        11128
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you create custom endpoints, you can create a more complex connection string.",
      "pos": [
        11140,
        11233
      ]
    },
    {
      "content": "When you use this string format, you can specify storage service endpoints that include a custom domain name that you have registered for your storage account with the Blob service.",
      "pos": [
        11234,
        11415
      ]
    },
    {
      "content": "Also you can grant access only to blob resources in a single container through a shared access signature.",
      "pos": [
        11416,
        11521
      ]
    },
    {
      "content": "For more information about how to create custom endpoints, see <bpt id=\"p1\">[</bpt>Configure Azure Storage Connection Strings<ept id=\"p1\">](https://azure.microsoft.com/documentation/articles/storage-configure-connection-string/)</ept>.",
      "pos": [
        11522,
        11719
      ]
    },
    {
      "content": "To save these connection string changes, choose the <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> button and then choose the <bpt id=\"p2\">**</bpt>Save<ept id=\"p2\">**</ept> button on the toolbar.",
      "pos": [
        11724,
        11841
      ]
    },
    {
      "content": "After you save these changes, you can get the value of this connection string in your code by using <bpt id=\"p1\">[</bpt>GetConfigurationSettingValue<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx)</ept>.",
      "pos": [
        11842,
        12103
      ]
    },
    {
      "content": "When you publish your application to Azure, choose the service configuration that contains the Azure storage account for the connection string.",
      "pos": [
        12104,
        12247
      ]
    },
    {
      "content": "After your application is published, verify that the application works as expected against the Azure storage services",
      "pos": [
        12248,
        12365
      ]
    },
    {
      "content": "Additional resources",
      "pos": [
        12370,
        12390
      ]
    },
    {
      "content": "Publishing to an Azure Cloud Service from Visual Studio",
      "pos": [
        12393,
        12448
      ]
    },
    {
      "content": "test",
      "pos": [
        12508,
        12512
      ]
    }
  ],
  "content": "<properties \n   pageTitle=\"Setting up services required to publish a cloud service from Visual Studio\"\n   description=\"Learn the procedures to set up cloud and storage account services and configure your Azure application\"\n   services=\"visual-studio-online\"\n   documentationCenter=\"na\"\n   authors=\"kempb\"\n   manager=\"douge\"\n   editor=\"tglee\" />\n<tags \n   ms.service=\"multiple\"\n   ms.devlang=\"dotnet\"\n   ms.topic=\"article\"\n   ms.tgt_pltfrm=\"na\"\n   ms.workload=\"multiple\"\n   ms.date=\"08/13/2015\"\n   ms.author=\"kempb\" />\n\n# Setting up services required to publish a cloud service from Visual Studio\n\n##Overview\n\nBefore you can publish a cloud service project, you must set up the following services:\n\n- A **cloud service** to run your roles in the Azure environment\n\n- A **storage account** that provides access to the Blob, Queue, and Table services.\n\nUse the following procedures to set up these services and configure your application\n\n\n## Create a cloud service\n\nTo publish a cloud service to Azure, you must first create a cloud service, which runs your roles in the Azure environment. You can create a cloud service in the Azure Management Portal, as described [here](#to-create-a-cloud-service-by-using-the-azure-management-portal). You can also create a cloud service in Visual Studio when you use the publishing wizard.\n\n### To create a cloud service by using Visual Studio\n\n1. Open the shortcut menu for the Azure project, and choose **Publish**.\n\n    ![VST_PublishMenu](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/vst-publish-menu.png)\n\n1. If you haven't signed in, sign in with your username and password for the Microsoft account or organizational account that's associated with your Azure subscription.\n\n1. Choose the **Next** button to advance to the **Settings** page.\n\n    ![Publishing Wizard Common Settings](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/publish-settings-page.png)\n\n1. In the **Cloud Services** list, choose **Create New**. The **Create Azure Services** dialog appears.\n\n1. Enter the name of your cloud service. The name forms part of the URL for your service and therefore must be globally unique. The name is not case-sensitive.\n\n### To create a cloud service by using the Azure Management Portal\n\n1. Sign in to the [Azure Management Portal](http://go.microsoft.com/fwlink/?LinkId=253103) on the Microsoft website.\n\n1. (optional) To display a list of cloud services that you've already created, choose the Cloud Services link on the left side of the page.\n\n1. Choose the **+** icon in the lower-left corner, and then choose **Cloud Service** on the menu that appears. Another screen with two options, **Quick Create** and **Custom Create**, appears. If you choose **Quick Create**, you can create a cloud service just by specifying its URL and the region where it will be physically hosted. If you choose **Custom Create**, you can immediately publish a cloud service by specifying a package (.cspkg file), a configuration (.cscfg) file, and a certificate. Custom Create isn’t required if you intend to publish your cloud service by using the **Publish** command in an Azure project. The **Publish** command is available on the shortcut menu for an Azure project.\n\n1. Choose **Quick Create** to later publish your cloud service by using Visual Studio.\n\n1. Specify a name for your cloud service.The complete URL appears next to the name.\n\n1. In the list, choose the region where most of your users are located.\n\n1. At the bottom of the window, choose the **Create Cloud Service** link.\n\n## Create a storage account\n\nA storage account provides access to the Blob, Queue, and Table services. You can create a storage account by using Visual Studio or the [Azure Platform Management Portal](http://go.microsoft.com/fwlink/?LinkId=253103).\n\n### To create a storage account by using Visual Studio\n\n1. In Solution Explorer, open the shortcut menu for the **Storage** node, and then choose **Create Storage Account**.\n\n    ![Create a new Azure storage account](./media/vs-azure-tools-cloud-service-publish-set-up-required-services-in-visual-studio/IC744166.png)\n\n1. Select or enter the following information for the new storage account in the **Create Storage Account** dialog box.\n    - The Azure subscription to which you want to add the storage account.\n    - The name you want to use for the new storage account.\n    - The region or affinity group (such as West US or East Asia).\n    - The type of replication you want to use for the storage account, such as Geo-Redundant.\n\n1. When you’re done, choose **Create**.The new storage account appears in the **Storage** list in Server Explorer.\n\n### To create a storage account by using the Azure Management Portal\n\n1. Sign in to the [Azure Platform Management Portal](http://go.microsoft.com/fwlink/?LinkId=253103) on the Microsoft website.\n\n1. (optional) To view your storage accounts, choose the **Storage** link in the panel on the left side of the page.\n\n1. In the lower-left corner of the page, choose the **+** icon.\n\n1. In the menu that appears, choose **Storage**, and then choose **Quick Create**.\n\n1. Give the storage account a name that will result in a unique url.\n\n1. Give your cloud service a name. The complete URL appears next to the name.\n\n1. In the list of regions, choose a region where most of your users are located.\n\n1. Specify whether you want to enable geo-replication. If you enable geo-replication, your data will be saved in multiple physical locations to reduce the chance of loss. This feature makes storage more expensive, but you can reduce the cost by enabling geo-location when you create the storage account instead of adding the feature later. For more information, see [Geo-replication](http://go.microsoft.com/fwlink/?LinkId=253108).\n\n1. At the bottom of the window, choose the **Create Storage Account** link.\n\nAfter you create your storage account, you will see the URLs that you can use to access resources in each of the Azure storage services, and also the primary and secondary access keys for your account. You use these keys to authenticate requests made against the storage services.\n\n>[AZURE.NOTE] The secondary access key provides the same access to your storage account as the primary access key and is generated as a backup should your primary access key be compromised. Additionally, it is recommended that you regenerate your access keys on a regular basis. You can modify a connection string setting to use the secondary key while you regenerate the primary key, then you can modify it to use the regenerated primary key while you regenerate the secondary key.\n\n## Configure your app to use services provided by the storage account\n\nYou must configure any role that accesses storage services to use the Azure storage services that you have created. To do this, you can use multiple service configurations for your Azure project. By default, two are created in your Azure project. By using multiple service configurations, you can use the same connection string in your code, but have a different value for a connection string in each service configuration. For example, you can use one service configuration to run and debug your application locally using the Azure storage emulator and a different service configuration to publish your application to Azure. For more information about service configurations, see [Configuring an Azure Project](https://msdn.microsoft.com/library/azure/ee405486.aspx).\n\n### To configure your application to use services that the storage account provides\n\n1. In Visual Studio open your Azure solution. In Solution Explorer, open the shortcut menu for each role in your Azure project that accesses the storage services and choose **Properties**. A page with the name of the role is displayed in the Visual Studio editor. The page displays the fields for the **Configuration** tab.\n\n1. In the property pages for the role, choose **Settings**.\n\n1. In the **Service Configuration** list, choose the name of the service configuration that you want to edit. If you want to make changes to all of the service configurations for this role, you can choose **All Configurations**.  For more information about how to update service configurations, see [Manage Connection Strings for Storage Accounts](https://msdn.microsoft.com/library/azure/8cda8963-ef0e-4f64-8d29-5eac467e5f53#ConnectionStrings).\n\n1. To modify any connection string settings, choose the **…** button next to the setting. The **Create Storage Connection String** dialog box appears.\n\n1. Under **Connect using**, choose the **Your subscription** option.\n\n1. In the **Subscription** list, choose your subscription. If the list of subscriptions doesn't include the one that you want, choose the **Download Publish Settings** link.\n\n1. In the **Account name** list, choose your storage account name. Azure Tools obtains storage account credentials automatically by using the .publishsettings file. To specify your storage account credentials manually, choose the **Manually entered credentials** option, and then continue with this procedure. You can get your storage account name and primary key from the [Management Portal](http://go.microsoft.com/fwlink/p/?LinkID=213885). If you don’t want to specify your storage account settings manually, choose the **OK** button to close the dialog box.\n\n1. Choose the **Enter storage account** credentials link.\n\n1. In the **Account name** box, enter the name of your storage account.\n\n    >[AZURE.NOTE] Log into the Management Portal, and then choose the **Storage** button. The portal shows a list of storage accounts. If you choose an account, a page for it opens. You can copy the name of the storage account from this page. If you are using a previous version of the Management Portal, the name of your storage account appears in the **Storage Accounts** view of the Management Portal. To copy this name, highlight it in the **Properties** window of this view, and then choose the Ctrl-C keys. To paste the name into Visual Studio, choose the **Account name** text box, and then choose the Ctrl+V keys.\n\n1. In the **Account key** box, enter your primary key, or copy and paste it from the [Management Portal](http://go.microsoft.com/fwlink/?LinkID=213885). \n    To copy this key from the Management Portal:\n\n    1. At the bottom of the page for the appropriate storage account, choose the **Manage Keys** button.\n\n    1. On the **Manage Keys Access** page, select the text of the primary access key, and then choose the Ctrl+C keys.\n\n    1. In Azure Tools, paste the key into the **Account key** box.\n\n    1. You must select one of the following options to determine how the service will access the storage account:\n        - **Use HTTP**. This is the standard option. For example, `http://<account name>.blob.core.windows.net`.\n        - **Use HTTPS** for a secure connection. For example, `https://<accountname>.blob.core.windows.net`.\n        - **Specify custom endpoints** for each of the three services. You can then type these endpoints into the field for the specific service. \n\n        >[AZURE.NOTE] If you create custom endpoints, you can create a more complex connection string. When you use this string format, you can specify storage service endpoints that include a custom domain name that you have registered for your storage account with the Blob service. Also you can grant access only to blob resources in a single container through a shared access signature. For more information about how to create custom endpoints, see [Configure Azure Storage Connection Strings](https://azure.microsoft.com/documentation/articles/storage-configure-connection-string/).\n\n1. To save these connection string changes, choose the **OK** button and then choose the **Save** button on the toolbar. After you save these changes, you can get the value of this connection string in your code by using [GetConfigurationSettingValue](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.getconfigurationsettingvalue.aspx). When you publish your application to Azure, choose the service configuration that contains the Azure storage account for the connection string. After your application is published, verify that the application works as expected against the Azure storage services\n\n## Additional resources\n\n[Publishing to an Azure Cloud Service from Visual Studio](https://msdn.microsoft.com/library/azure/ee460772.aspx)\n\n\ntest\n"
}