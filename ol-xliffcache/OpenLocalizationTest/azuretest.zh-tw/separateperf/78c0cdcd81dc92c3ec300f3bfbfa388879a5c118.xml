{
  "nodes": [
    {
      "content": "How to use table storage (C++) | Microsoft Azure",
      "pos": [
        28,
        76
      ]
    },
    {
      "content": "Learn how to use the table storage service in Azure.",
      "pos": [
        96,
        148
      ]
    },
    {
      "content": "Samples are written in C++.",
      "pos": [
        149,
        176
      ]
    },
    {
      "content": "How to use Table Storage from C++",
      "pos": [
        479,
        512
      ]
    },
    {
      "content": "Overview",
      "pos": [
        617,
        625
      ]
    },
    {
      "content": "This guide will show you how to perform common scenarios using the Azure Table Storage Service.",
      "pos": [
        628,
        723
      ]
    },
    {
      "content": "The samples are written in C++ and use the <bpt id=\"p1\">[</bpt>Azure Storage Client Library for C++<ept id=\"p1\">](https://github.com/Azure/azure-storage-cpp/blob/v1.0.0/README.md)</ept>.",
      "pos": [
        724,
        872
      ]
    },
    {
      "content": "The scenarios covered include <bpt id=\"p1\">**</bpt>creating and deleting a table<ept id=\"p1\">**</ept>, as well as <bpt id=\"p2\">**</bpt>working with table entities<ept id=\"p2\">**</ept>.",
      "pos": [
        873,
        981
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> This guide targets the Azure Storage Client Library for C++ version 1.0.0 and above.",
      "pos": [
        984,
        1081
      ]
    },
    {
      "content": "The recommended version is Storage Client Library 1.0.0, which is available via <bpt id=\"p1\">[</bpt>NuGet<ept id=\"p1\">](http://www.nuget.org/packages/wastorage)</ept> or <bpt id=\"p2\">[</bpt>GitHub<ept id=\"p2\">](https://github.com/)</ept>.",
      "pos": [
        1082,
        1244
      ]
    },
    {
      "content": "Create a C++ application",
      "pos": [
        1450,
        1474
      ]
    },
    {
      "content": "In this guide, you will use storage features which can be run within a C++ application.",
      "pos": [
        1477,
        1564
      ]
    },
    {
      "content": "To do so, you will need to install the Azure Storage Client Library for C++ and create an Azure storage account in your Azure subscription.",
      "pos": [
        1565,
        1704
      ]
    },
    {
      "content": "To install the Azure Storage Client Library for C++, you can use the following methods:",
      "pos": [
        1708,
        1795
      ]
    },
    {
      "pos": [
        1801,
        1966
      ],
      "content": "<bpt id=\"p1\">**</bpt>Linux:<ept id=\"p1\">**</ept> Follow the instructions given in the <bpt id=\"p2\">[</bpt>Azure Storage Client Library for C++ README<ept id=\"p2\">](https://github.com/Azure/azure-storage-cpp/blob/master/README.md)</ept> page."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Windows:<ept id=\"p1\">**</ept> In Visual Studio, click <bpt id=\"p2\">**</bpt>Tools &gt; NuGet Package Manager &gt; Package Manager Console<ept id=\"p2\">**</ept>.",
      "pos": [
        1973,
        2070
      ]
    },
    {
      "content": "Type the following command into the <bpt id=\"p1\">[</bpt>NuGet Package Manager console<ept id=\"p1\">](http://docs.nuget.org/docs/start-here/using-the-package-manager-console)</ept> and press <bpt id=\"p2\">**</bpt>ENTER<ept id=\"p2\">**</ept>.",
      "pos": [
        2071,
        2232
      ]
    },
    {
      "content": "Configure your application to access Table Storage",
      "pos": [
        2274,
        2324
      ]
    },
    {
      "content": "Add the following include statements to the top of the C++ file where you want to use the Azure storage APIs to access tables:",
      "pos": [
        2327,
        2453
      ]
    },
    {
      "content": "Setup an Azure storage connection string",
      "pos": [
        2525,
        2565
      ]
    },
    {
      "content": "An Azure storage client uses a storage connection string to store endpoints and credentials for accessing data management services.",
      "pos": [
        2568,
        2699
      ]
    },
    {
      "content": "When running in a client application, you must provide the storage connection string in the following format, using the name of your storage account and the storage access key for the storage account listed in the Management Portal for the <bpt id=\"p1\">*</bpt>AccountName<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>AccountKey<ept id=\"p2\">*</ept> values.",
      "pos": [
        2700,
        2978
      ]
    },
    {
      "content": "For information on storage accounts and access keys, see <bpt id=\"p1\">[</bpt>About Azure Storage Accounts<ept id=\"p1\">](storage-create-storage-account.md)</ept>.",
      "pos": [
        2979,
        3102
      ]
    },
    {
      "content": "This example shows how you can declare a static field to hold the connection string:",
      "pos": [
        3103,
        3187
      ]
    },
    {
      "content": "To test your application in your local Windows computer, you can use the Microsoft Azure <bpt id=\"p1\">[</bpt>storage emulator<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/hh403989.aspx)</ept> that is installed with the <bpt id=\"p2\">[</bpt>Azure SDK<ept id=\"p2\">](http://azure.microsoft.com/downloads/)</ept>.",
      "pos": [
        3407,
        3649
      ]
    },
    {
      "content": "The storage emulator is a utility that simulates the Blob, Queue, and Table services available in Azure on your local development machine.",
      "pos": [
        3650,
        3788
      ]
    },
    {
      "content": "The following example shows how you can declare a static field to hold the connection string to your local storage emulator:",
      "pos": [
        3789,
        3913
      ]
    },
    {
      "content": "To start the Azure storage emulator, Select the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> button or press the <bpt id=\"p2\">**</bpt>Windows<ept id=\"p2\">**</ept> key.",
      "pos": [
        4074,
        4168
      ]
    },
    {
      "content": "Begin typing <bpt id=\"p1\">**</bpt>Azure Storage Emulator<ept id=\"p1\">**</ept>, and select <bpt id=\"p2\">**</bpt>Microsoft Azure Storage Emulator<ept id=\"p2\">**</ept> from the list of applications.",
      "pos": [
        4169,
        4288
      ]
    },
    {
      "content": "The following samples assume that you have used one of these two methods to get the storage connection string.",
      "pos": [
        4292,
        4402
      ]
    },
    {
      "content": "Retrieve your connection string",
      "pos": [
        4409,
        4440
      ]
    },
    {
      "content": "You can use the <bpt id=\"p1\">**</bpt>cloud_storage_account<ept id=\"p1\">**</ept> class to represent your Storage Account information.",
      "pos": [
        4443,
        4537
      ]
    },
    {
      "content": "To retrieve your storage account information from the storage connection string, you can use the parse method.",
      "pos": [
        4538,
        4648
      ]
    },
    {
      "content": "Next, get a reference to a <bpt id=\"p1\">**</bpt>cloud_table_client<ept id=\"p1\">**</ept> class as it allows you lets you get reference objects for tables and entities stored within the Table Storage Service.",
      "pos": [
        4850,
        5018
      ]
    },
    {
      "content": "The following code creates a <bpt id=\"p1\">**</bpt>cloud_table_client<ept id=\"p1\">**</ept> object using the storage account object we retrieved above:",
      "pos": [
        5019,
        5130
      ]
    },
    {
      "content": "How to: Create a table",
      "pos": [
        5269,
        5291
      ]
    },
    {
      "content": "A <bpt id=\"p1\">**</bpt>cloud_table_client<ept id=\"p1\">**</ept> object lets you get reference objects for tables and entities.",
      "pos": [
        5292,
        5379
      ]
    },
    {
      "content": "The following code creates a <bpt id=\"p1\">**</bpt>cloud_table_client<ept id=\"p1\">**</ept> object and uses it to create a new table.",
      "pos": [
        5380,
        5473
      ]
    },
    {
      "content": "How to: Add an entity to a table",
      "pos": [
        6021,
        6053
      ]
    },
    {
      "content": "To add an entity to a table, create a new <bpt id=\"p1\">**</bpt>table_entity<ept id=\"p1\">**</ept> object and pass it to <bpt id=\"p2\">**</bpt>table_operation::insert_entity<ept id=\"p2\">**</ept>.",
      "pos": [
        6054,
        6170
      ]
    },
    {
      "content": "The following code uses the customer's first name as the row key and last name as the partition key.",
      "pos": [
        6171,
        6271
      ]
    },
    {
      "content": "Together, an entity's partition and row key uniquely identify the entity in the table.",
      "pos": [
        6272,
        6358
      ]
    },
    {
      "content": "Entities with the same partition key can be queried faster than those with different partition keys, but using diverse partition keys allows for greater parallel operation scalability.",
      "pos": [
        6359,
        6543
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Microsoft Azure Storage Performance and Scalability Checklist<ept id=\"p1\">](storage-performance-checklist.md/)</ept>.",
      "pos": [
        6544,
        6669
      ]
    },
    {
      "content": "The following code creates a new instance of <bpt id=\"p1\">**</bpt>table_entity<ept id=\"p1\">**</ept> with some customer data to be stored.",
      "pos": [
        6672,
        6771
      ]
    },
    {
      "content": "The code next calls <bpt id=\"p1\">**</bpt>table_operation::insert_entity<ept id=\"p1\">**</ept> to create a <bpt id=\"p2\">**</bpt>table_operation<ept id=\"p2\">**</ept> object to insert an entity into a table, and associates the new table entity with it.",
      "pos": [
        6772,
        6944
      ]
    },
    {
      "content": "Finally, the code calls the execute method on the <bpt id=\"p1\">**</bpt>cloud_table<ept id=\"p1\">**</ept> object.",
      "pos": [
        6945,
        7018
      ]
    },
    {
      "content": "And the new <bpt id=\"p1\">**</bpt>table_operation<ept id=\"p1\">**</ept> sends a request to the storage service to insert the new customer entity into the \"people\" table.",
      "pos": [
        7019,
        7148
      ]
    },
    {
      "content": "How to: Insert a batch of entities",
      "pos": [
        8387,
        8421
      ]
    },
    {
      "content": "You can insert a batch of entities to the table service in one write operation.",
      "pos": [
        8422,
        8501
      ]
    },
    {
      "content": "The following code creates a <bpt id=\"p1\">**</bpt>table_batch_operation<ept id=\"p1\">**</ept> object, then adds three insert operations to it.",
      "pos": [
        8502,
        8605
      ]
    },
    {
      "content": "Each insert operation is added by creating a new entity object, setting its values, and then calling the insert method on the <bpt id=\"p1\">**</bpt>table_batch_operation<ept id=\"p1\">**</ept> object to associate the entity with a new insert operation.",
      "pos": [
        8606,
        8817
      ]
    },
    {
      "content": "Then, <bpt id=\"p1\">**</bpt>cloud_table.execute<ept id=\"p1\">**</ept> is called to execute the operation.",
      "pos": [
        8818,
        8883
      ]
    },
    {
      "content": "Some things to note on batch operations:",
      "pos": [
        11062,
        11102
      ]
    },
    {
      "content": "You can perform up to 100 insert, delete, merge, replace, insert or merge, and insert or replace operations in any combination in a single batch.",
      "pos": [
        11110,
        11255
      ]
    },
    {
      "content": "A batch operation can have a retrieve operation, if it is the only operation in the batch.",
      "pos": [
        11262,
        11352
      ]
    },
    {
      "content": "All entities in a single batch operation must have the same partition key.",
      "pos": [
        11359,
        11433
      ]
    },
    {
      "content": "A batch operation is limited to a 4MB data payload.",
      "pos": [
        11440,
        11491
      ]
    },
    {
      "content": "How to: Retrieve all entities in a partition",
      "pos": [
        11498,
        11542
      ]
    },
    {
      "content": "To query a table for all entities in a partition, use a <bpt id=\"p1\">**</bpt>table_query<ept id=\"p1\">**</ept> object.",
      "pos": [
        11543,
        11622
      ]
    },
    {
      "content": "The following code example specifies a filter for entities where 'Smith' is the partition key.",
      "pos": [
        11623,
        11717
      ]
    },
    {
      "content": "This example prints the fields of each entity in the query results to the console.",
      "pos": [
        11718,
        11800
      ]
    },
    {
      "content": "The query in this example brings all the entities that match the filter criteria.",
      "pos": [
        13197,
        13278
      ]
    },
    {
      "content": "If you have large tables and need to download the table entities so often, we recommend that you store your data in Azure Storage Blobs instead.",
      "pos": [
        13279,
        13423
      ]
    },
    {
      "content": "How to: Retrieve a range of entities in a partition",
      "pos": [
        13428,
        13479
      ]
    },
    {
      "content": "If you don't want to query all the entities in a partition, you can specify a range by combining the partition key filter with a row key filter.",
      "pos": [
        13480,
        13624
      ]
    },
    {
      "content": "The following code example uses two filters to get all entities in partition 'Smith' where the row key (first name) starts with a letter earlier than 'E' in the alphabet and then prints the query results.",
      "pos": [
        13625,
        13829
      ]
    },
    {
      "content": "How to: Retrieve a single entity",
      "pos": [
        15461,
        15493
      ]
    },
    {
      "content": "You can write a query to retrieve a single, specific entity.",
      "pos": [
        15494,
        15554
      ]
    },
    {
      "content": "The following code uses a <bpt id=\"p1\">**</bpt>table_operation::retrive_entity<ept id=\"p1\">**</ept> to specify the customer 'Jeff Smith'.",
      "pos": [
        15555,
        15654
      ]
    },
    {
      "content": "This method returns just one entity, rather than a collection, and the returned value is in <bpt id=\"p1\">**</bpt>table_result<ept id=\"p1\">**</ept>.",
      "pos": [
        15655,
        15764
      ]
    },
    {
      "content": "Specifying both partition and row keys in a query is the fastest way to retrieve a single entity from the Table service.",
      "pos": [
        15765,
        15885
      ]
    },
    {
      "content": "How to: Replace an entity",
      "pos": [
        17045,
        17070
      ]
    },
    {
      "content": "To replace an entity, retrieve it from the table service, modify the entity object, and then save the changes back to the table service.",
      "pos": [
        17071,
        17207
      ]
    },
    {
      "content": "The following code changes an existing customer's phone number and email address.",
      "pos": [
        17208,
        17289
      ]
    },
    {
      "content": "Instead of calling <bpt id=\"p1\">**</bpt>table_operation::insert_entity<ept id=\"p1\">**</ept>, this code uses <bpt id=\"p2\">**</bpt>table_operation::replace_entity<ept id=\"p2\">**</ept>.",
      "pos": [
        17290,
        17396
      ]
    },
    {
      "content": "This causes the entity to be fully replaced on the server, unless the entity on the server has changed since it was retrieved, in which case the operation will fail.",
      "pos": [
        17397,
        17562
      ]
    },
    {
      "content": "This failure is to prevent your application from inadvertently overwriting a change made between the retrieval and update by another component of your application.",
      "pos": [
        17563,
        17726
      ]
    },
    {
      "content": "The proper handling of this failure is to retrieve the entity again, make your changes (if still valid), and then perform another <bpt id=\"p1\">**</bpt>table_operation::replace_entity<ept id=\"p1\">**</ept> operation.",
      "pos": [
        17727,
        17903
      ]
    },
    {
      "content": "The next section will show you how to override this behavior.",
      "pos": [
        17904,
        17965
      ]
    },
    {
      "content": "How to: Insert-or-replace an entity",
      "pos": [
        19259,
        19294
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>table_operation::replace_entity<ept id=\"p1\">**</ept> operations will fail if the entity has been changed since it was retrieved from the server.",
      "pos": [
        19295,
        19422
      ]
    },
    {
      "content": "Furthermore, you must retrieve the entity from the server first in order for the <bpt id=\"p1\">**</bpt>table_operation::replace_entity<ept id=\"p1\">**</ept> to be successful.",
      "pos": [
        19423,
        19557
      ]
    },
    {
      "content": "Sometimes, however, you don't know if the entity exists on the server and the current values stored in it are irrelevant - your update should overwrite them all.",
      "pos": [
        19558,
        19719
      ]
    },
    {
      "content": "To accomplish this, you would use a <bpt id=\"p1\">**</bpt>table_operation::insert_or_replace_entity<ept id=\"p1\">**</ept> operation.",
      "pos": [
        19720,
        19812
      ]
    },
    {
      "content": "This operation inserts the entity if it doesn't exist, or replaces it if it does, regardless of when the last update was made.",
      "pos": [
        19813,
        19939
      ]
    },
    {
      "content": "In the following code example, the customer entity for Jeff Smith is still retrieved, but it is then saved back to the server using <bpt id=\"p1\">**</bpt>table_operation::insert_or_replace_entity<ept id=\"p1\">**</ept>.",
      "pos": [
        19940,
        20118
      ]
    },
    {
      "content": "Any updates made to the entity between the retrieval and update operation will be overwritten.",
      "pos": [
        20119,
        20213
      ]
    },
    {
      "content": "How to: Query a subset of entity properties",
      "pos": [
        21633,
        21676
      ]
    },
    {
      "content": "A query to a table can retrieve just a few properties from an entity.",
      "pos": [
        21679,
        21748
      ]
    },
    {
      "content": "The query in the following code uses the <bpt id=\"p1\">**</bpt>table_query::set_select_columns<ept id=\"p1\">**</ept> method to return only the email addresses of entities in the table.",
      "pos": [
        21749,
        21893
      ]
    },
    {
      "pos": [
        23243,
        23353
      ],
      "content": "<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Querying a few properties from an entity is more efficient operation than retrieving all properties."
    },
    {
      "content": "How to: Delete an entity",
      "pos": [
        23359,
        23383
      ]
    },
    {
      "content": "You can easily delete an entity after you have retrieved it.",
      "pos": [
        23384,
        23444
      ]
    },
    {
      "content": "Once the entity is retrieved, call <bpt id=\"p1\">**</bpt>table_operation::delete_entity<ept id=\"p1\">**</ept> with the entity to delete.",
      "pos": [
        23445,
        23541
      ]
    },
    {
      "content": "Then call execute on the <bpt id=\"p1\">**</bpt>cloud_table.execute<ept id=\"p1\">**</ept> method.",
      "pos": [
        23542,
        23598
      ]
    },
    {
      "content": "The following code retrieves and deletes an entity with partition key of \"Smith\" and row key of \"Jeff\".",
      "pos": [
        23599,
        23702
      ]
    },
    {
      "content": "How to: Delete a table",
      "pos": [
        24819,
        24841
      ]
    },
    {
      "content": "Finally, the following code example deletes a table from a storage account.",
      "pos": [
        24842,
        24917
      ]
    },
    {
      "content": "A table which has been deleted will be unavailable to be recreated for a period of time following the deletion.",
      "pos": [
        24918,
        25029
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        26143,
        26153
      ]
    },
    {
      "content": "Now that you've learned the basics of table storage, follow these links to learn more about Azure Storage.",
      "pos": [
        26154,
        26260
      ]
    },
    {
      "content": "How to use Blob Storage from C++",
      "pos": [
        26269,
        26301
      ]
    },
    {
      "content": "How to use Queue Storage from C++",
      "pos": [
        26349,
        26382
      ]
    },
    {
      "content": "List Azure Storage Resources in C++",
      "pos": [
        26431,
        26466
      ]
    },
    {
      "content": "Storage Client Library for C++ Reference",
      "pos": [
        26509,
        26549
      ]
    },
    {
      "content": "Azure Storage Documentation",
      "pos": [
        26598,
        26625
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"How to use table storage (C++) | Microsoft Azure\" \n    description=\"Learn how to use the table storage service in Azure. Samples are written in C++.\" \n    services=\"storage\" \n    documentationCenter=\".net\" \n    authors=\"tamram\" \n    manager=\"adinah\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"storage\" \n    ms.workload=\"storage\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"07/19/2015\" \n    ms.author=\"tamram\"/>\n\n# How to use Table Storage from C++\n\n[AZURE.INCLUDE [storage-selector-table-include](../../includes/storage-selector-table-include.md)]\n\n## Overview  \nThis guide will show you how to perform common scenarios using the Azure Table Storage Service. The samples are written in C++ and use the [Azure Storage Client Library for C++](https://github.com/Azure/azure-storage-cpp/blob/v1.0.0/README.md). The scenarios covered include **creating and deleting a table**, as well as **working with table entities**.\n\n>[AZURE.NOTE] This guide targets the Azure Storage Client Library for C++ version 1.0.0 and above. The recommended version is Storage Client Library 1.0.0, which is available via [NuGet](http://www.nuget.org/packages/wastorage) or [GitHub](https://github.com/). \n\n[AZURE.INCLUDE [storage-table-concepts-include](../../includes/storage-table-concepts-include.md)]\n[AZURE.INCLUDE [storage-create-account-include](../../includes/storage-create-account-include.md)]\n\n\n## Create a C++ application  \nIn this guide, you will use storage features which can be run within a C++ application. To do so, you will need to install the Azure Storage Client Library for C++ and create an Azure storage account in your Azure subscription.  \n\nTo install the Azure Storage Client Library for C++, you can use the following methods:\n\n-   **Linux:** Follow the instructions given in the [Azure Storage Client Library for C++ README](https://github.com/Azure/azure-storage-cpp/blob/master/README.md) page.  \n-   **Windows:** In Visual Studio, click **Tools > NuGet Package Manager > Package Manager Console**. Type the following command into the [NuGet Package Manager console](http://docs.nuget.org/docs/start-here/using-the-package-manager-console) and press **ENTER**.  \n\n        Install-Package wastorage\n\n## Configure your application to access Table Storage  \nAdd the following include statements to the top of the C++ file where you want to use the Azure storage APIs to access tables:  \n\n    #include \"was/storage_account.h\"\n    #include \"was/table.h\"\n\n## Setup an Azure storage connection string  \nAn Azure storage client uses a storage connection string to store endpoints and credentials for accessing data management services. When running in a client application, you must provide the storage connection string in the following format, using the name of your storage account and the storage access key for the storage account listed in the Management Portal for the *AccountName* and *AccountKey* values. For information on storage accounts and access keys, see [About Azure Storage Accounts](storage-create-storage-account.md). This example shows how you can declare a static field to hold the connection string:  \n\n    // Define the connection-string with your values.\n    const utility::string_t storage_connection_string(U(\"DefaultEndpointsProtocol=https;AccountName=your_storage_account;AccountKey=your_storage_account_key\"));\n\nTo test your application in your local Windows computer, you can use the Microsoft Azure [storage emulator](https://msdn.microsoft.com/library/azure/hh403989.aspx) that is installed with the [Azure SDK](http://azure.microsoft.com/downloads/). The storage emulator is a utility that simulates the Blob, Queue, and Table services available in Azure on your local development machine. The following example shows how you can declare a static field to hold the connection string to your local storage emulator:  \n\n    // Define the connection-string with Azure Storage Emulator.\n    const utility::string_t storage_connection_string(U(\"UseDevelopmentStorage=true;\"));  \n\nTo start the Azure storage emulator, Select the **Start** button or press the **Windows** key. Begin typing **Azure Storage Emulator**, and select **Microsoft Azure Storage Emulator** from the list of applications.  \n\nThe following samples assume that you have used one of these two methods to get the storage connection string.  \n\n## Retrieve your connection string  \nYou can use the **cloud_storage_account** class to represent your Storage Account information. To retrieve your storage account information from the storage connection string, you can use the parse method. \n\n    // Retrieve the storage account from the connection string. \n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\nNext, get a reference to a **cloud_table_client** class as it allows you lets you get reference objects for tables and entities stored within the Table Storage Service. The following code creates a **cloud_table_client** object using the storage account object we retrieved above:  \n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n## How to: Create a table\nA **cloud_table_client** object lets you get reference objects for tables and entities. The following code creates a **cloud_table_client** object and uses it to create a new table. \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);  \n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Retrieve a reference to a table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Create the table if it doesn't exist.\n    table.create_if_not_exists();  \n\n## How to: Add an entity to a table\nTo add an entity to a table, create a new **table_entity** object and pass it to **table_operation::insert_entity**. The following code uses the customer's first name as the row key and last name as the partition key. Together, an entity's partition and row key uniquely identify the entity in the table. Entities with the same partition key can be queried faster than those with different partition keys, but using diverse partition keys allows for greater parallel operation scalability. For more information, see [Microsoft Azure Storage Performance and Scalability Checklist](storage-performance-checklist.md/). \n\nThe following code creates a new instance of **table_entity** with some customer data to be stored. The code next calls **table_operation::insert_entity** to create a **table_operation** object to insert an entity into a table, and associates the new table entity with it. Finally, the code calls the execute method on the **cloud_table** object. And the new **table_operation** sends a request to the storage service to insert the new customer entity into the \"people\" table.  \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Retrieve a reference to a table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Create the table if it doesn't exist.\n    table.create_if_not_exists();\n\n    // Create a new customer entity.\n    azure::storage::table_entity customer1(U(\"Harp\"), U(\"Walter\"));\n\n    azure::storage::table_entity::properties_type& properties = customer1.properties();\n    properties.reserve(2);\n    properties[U(\"Email\")] = azure::storage::entity_property(U(\"Walter@contoso.com\"));\n\n    properties[U(\"Phone\")] = azure::storage::entity_property(U(\"425-555-0101\"));\n\n    // Create the table operation that inserts the customer entity.\n    azure::storage::table_operation insert_operation = azure::storage::table_operation::insert_entity(customer1);\n\n    // Execute the insert operation.\n    azure::storage::table_result insert_result = table.execute(insert_operation);\n\n## How to: Insert a batch of entities\nYou can insert a batch of entities to the table service in one write operation. The following code creates a **table_batch_operation** object, then adds three insert operations to it. Each insert operation is added by creating a new entity object, setting its values, and then calling the insert method on the **table_batch_operation** object to associate the entity with a new insert operation. Then, **cloud_table.execute** is called to execute the operation.  \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Create a cloud table object for the table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Define a batch operation.\n    azure::storage::table_batch_operation batch_operation;\n\n    // Create a customer entity and add it to the table.\n    azure::storage::table_entity customer1(U(\"Smith\"), U(\"Jeff\"));\n\n    azure::storage::table_entity::properties_type& properties1 = customer1.properties();\n    properties1.reserve(2);\n    properties1[U(\"Email\")] = azure::storage::entity_property(U(\"Jeff@contoso.com\"));\n    properties1[U(\"Phone\")] = azure::storage::entity_property(U(\"425-555-0104\"));\n\n    // Create another customer entity and add it to the table.\n    azure::storage::table_entity customer2(U(\"Smith\"), U(\"Ben\"));\n\n    azure::storage::table_entity::properties_type& properties2 = customer2.properties();\n    properties2.reserve(2);\n    properties2[U(\"Email\")] = azure::storage::entity_property(U(\"Ben@contoso.com\"));\n    properties2[U(\"Phone\")] = azure::storage::entity_property(U(\"425-555-0102\"));\n\n    // Create a third customer entity to add to the table.\n    azure::storage::table_entity customer3(U(\"Smith\"), U(\"Denise\"));\n\n    azure::storage::table_entity::properties_type& properties3 = customer3.properties();\n    properties3.reserve(2);\n    properties3[U(\"Email\")] = azure::storage::entity_property(U(\"Denise@contoso.com\"));\n    properties3[U(\"Phone\")] = azure::storage::entity_property(U(\"425-555-0103\"));\n        \n    // Add customer entities to the batch insert operation.\n    batch_operation.insert_or_replace_entity(customer1);\n    batch_operation.insert_or_replace_entity(customer2);\n    batch_operation.insert_or_replace_entity(customer3);\n\n    // Execute the batch operation.\n    std::vector<azure::storage::table_result> results = table.execute_batch(batch_operation);\n\nSome things to note on batch operations:  \n\n-   You can perform up to 100 insert, delete, merge, replace, insert or merge, and insert or replace operations in any combination in a single batch.  \n-   A batch operation can have a retrieve operation, if it is the only operation in the batch.  \n-   All entities in a single batch operation must have the same partition key.  \n-   A batch operation is limited to a 4MB data payload.  \n\n## How to: Retrieve all entities in a partition\nTo query a table for all entities in a partition, use a **table_query** object. The following code example specifies a filter for entities where 'Smith' is the partition key. This example prints the fields of each entity in the query results to the console.  \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Create a cloud table object for the table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Construct the query operation for all customer entities where PartitionKey=\"Smith\".\n    azure::storage::table_query query;\n\n    query.set_filter_string(azure::storage::table_query::generate_filter_condition(U(\"PartitionKey\"), azure::storage::query_comparison_operator::equal, U(\"Smith\")));\n\n    // Execute the query.\n    azure::storage::table_query_iterator it = table.execute_query(query);\n\n    // Print the fields for each customer.\n    azure::storage::table_query_iterator end_of_results;\n    for (; it != end_of_results; ++it)\n    {\n        const azure::storage::table_entity::properties_type& properties = it->properties();\n\n        std::wcout << U(\"PartitionKey: \") << it->partition_key() << U(\", RowKey: \") << it->row_key()        \n            << U(\", Property1: \") << properties.at(U(\"Email\")).string_value()\n            << U(\", Property2: \") << properties.at(U(\"Phone\")).string_value() << std::endl;\n    }  \n\nThe query in this example brings all the entities that match the filter criteria. If you have large tables and need to download the table entities so often, we recommend that you store your data in Azure Storage Blobs instead.\n\n## How to: Retrieve a range of entities in a partition\nIf you don't want to query all the entities in a partition, you can specify a range by combining the partition key filter with a row key filter. The following code example uses two filters to get all entities in partition 'Smith' where the row key (first name) starts with a letter earlier than 'E' in the alphabet and then prints the query results.  \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Create a cloud table object for the table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Create the table query.\n    azure::storage::table_query query;\n\n    query.set_filter_string(azure::storage::table_query::combine_filter_conditions(\n        azure::storage::table_query::generate_filter_condition(U(\"PartitionKey\"), \n        azure::storage::query_comparison_operator::equal, U(\"Smith\")),\n        azure::storage::query_logical_operator::op_and,\n        azure::storage::table_query::generate_filter_condition(U(\"RowKey\"), azure::storage::query_comparison_operator::less_than, U(\"E\"))));\n\n    // Execute the query.\n    azure::storage::table_query_iterator it = table.execute_query(query);\n\n    // Loop through the results, displaying information about the entity.\n    azure::storage::table_query_iterator end_of_results;\n    for (; it != end_of_results; ++it)\n    {\n        const azure::storage::table_entity::properties_type& properties = it->properties();\n\n        std::wcout << U(\"PartitionKey: \") << it->partition_key() << U(\", RowKey: \") << it->row_key()\n            << U(\", Property1: \") << properties.at(U(\"Email\")).string_value()\n            << U(\", Property2: \") << properties.at(U(\"Phone\")).string_value() << std::endl;\n    }  \n\n## How to: Retrieve a single entity\nYou can write a query to retrieve a single, specific entity. The following code uses a **table_operation::retrive_entity** to specify the customer 'Jeff Smith'. This method returns just one entity, rather than a collection, and the returned value is in **table_result**. Specifying both partition and row keys in a query is the fastest way to retrieve a single entity from the Table service.  \n\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Create a cloud table object for the table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Retrieve the entity with partition key of \"Smith\" and row key of \"Jeff\".\n    azure::storage::table_operation retrieve_operation = azure::storage::table_operation::retrieve_entity(U(\"Smith\"), U(\"Jeff\"));\n    azure::storage::table_result retrieve_result = table.execute(retrieve_operation);\n\n    // Output the entity.\n    azure::storage::table_entity entity = retrieve_result.entity();\n    const azure::storage::table_entity::properties_type& properties = entity.properties();\n\n    std::wcout << U(\"PartitionKey: \") << entity.partition_key() << U(\", RowKey: \") << entity.row_key()\n        << U(\", Property1: \") << properties.at(U(\"Email\")).string_value()\n        << U(\", Property2: \") << properties.at(U(\"Phone\")).string_value() << std::endl;\n\n## How to: Replace an entity\nTo replace an entity, retrieve it from the table service, modify the entity object, and then save the changes back to the table service. The following code changes an existing customer's phone number and email address. Instead of calling **table_operation::insert_entity**, this code uses **table_operation::replace_entity**. This causes the entity to be fully replaced on the server, unless the entity on the server has changed since it was retrieved, in which case the operation will fail. This failure is to prevent your application from inadvertently overwriting a change made between the retrieval and update by another component of your application. The proper handling of this failure is to retrieve the entity again, make your changes (if still valid), and then perform another **table_operation::replace_entity** operation. The next section will show you how to override this behavior.  \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Create a cloud table object for the table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Replace an entity.\n    azure::storage::table_entity entity_to_replace(U(\"Smith\"), U(\"Jeff\"));\n    azure::storage::table_entity::properties_type& properties_to_replace = entity_to_replace.properties();\n    properties_to_replace.reserve(2);\n\n    // Specify a new phone number.\n    properties_to_replace[U(\"Phone\")] = azure::storage::entity_property(U(\"425-555-0106\"));\n\n    // Specify a new email address.\n    properties_to_replace[U(\"Email\")] = azure::storage::entity_property(U(\"JeffS@contoso.com\"));\n\n    // Create an operation to replace the entity.\n    azure::storage::table_operation replace_operation = azure::storage::table_operation::replace_entity(entity_to_replace);\n\n    // Submit the operation to the table service.\n    azure::storage::table_result replace_result = table.execute(replace_operation);\n\n## How to: Insert-or-replace an entity\n**table_operation::replace_entity** operations will fail if the entity has been changed since it was retrieved from the server. Furthermore, you must retrieve the entity from the server first in order for the **table_operation::replace_entity** to be successful. Sometimes, however, you don't know if the entity exists on the server and the current values stored in it are irrelevant - your update should overwrite them all. To accomplish this, you would use a **table_operation::insert_or_replace_entity** operation. This operation inserts the entity if it doesn't exist, or replaces it if it does, regardless of when the last update was made. In the following code example, the customer entity for Jeff Smith is still retrieved, but it is then saved back to the server using **table_operation::insert_or_replace_entity**. Any updates made to the entity between the retrieval and update operation will be overwritten.  \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Create a cloud table object for the table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Insert-or-replace an entity.\n    azure::storage::table_entity entity_to_insert_or_replace(U(\"Smith\"), U(\"Jeff\"));\n    azure::storage::table_entity::properties_type& properties_to_insert_or_replace = entity_to_insert_or_replace.properties();\n\n    properties_to_insert_or_replace.reserve(2);\n\n    // Specify a phone number.\n    properties_to_insert_or_replace[U(\"Phone\")] = azure::storage::entity_property(U(\"425-555-0107\"));\n\n    // Specify an email address.\n    properties_to_insert_or_replace[U(\"Email\")] = azure::storage::entity_property(U(\"Jeffsm@contoso.com\"));\n\n    // Create an operation to insert or replace the entity.\n    azure::storage::table_operation insert_or_replace_operation = azure::storage::table_operation::insert_or_replace_entity(entity_to_insert_or_replace);\n\n    // Submit the operation to the table service.\n    azure::storage::table_result insert_or_replace_result = table.execute(insert_or_replace_operation);\n \n## How to: Query a subset of entity properties  \nA query to a table can retrieve just a few properties from an entity. The query in the following code uses the **table_query::set_select_columns** method to return only the email addresses of entities in the table.  \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Create a cloud table object for the table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Define the query, and only select the Email property.\n    azure::storage::table_query query;\n    std::vector<utility::string_t> columns;\n\n    columns.push_back(U(\"Email\"));\n    query.set_select_columns(columns);\n\n    // Execute the query.\n    azure::storage::table_query_iterator it = table.execute_query(query);\n\n    // Display the results.\n    azure::storage::table_query_iterator end_of_results;\n    for (; it != end_of_results; ++it)\n    {\n        std::wcout << U(\"PartitionKey: \") << it->partition_key() << U(\", RowKey: \") << it->row_key();\n\n        const azure::storage::table_entity::properties_type& properties = it->properties();\n        for (auto prop_it = properties.begin(); prop_it != properties.end(); ++prop_it)\n        {\n            std::wcout << \", \" << prop_it->first << \": \" << prop_it->second.str();\n        }\n\n        std::wcout << std::endl;\n    }\n\n**Note:** Querying a few properties from an entity is more efficient operation than retrieving all properties. \n\n## How to: Delete an entity\nYou can easily delete an entity after you have retrieved it. Once the entity is retrieved, call **table_operation::delete_entity** with the entity to delete. Then call execute on the **cloud_table.execute** method. The following code retrieves and deletes an entity with partition key of \"Smith\" and row key of \"Jeff\".  \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Create a cloud table object for the table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Create an operation to retrieve the entity with partition key of \"Smith\" and row key of \"Jeff\".\n    azure::storage::table_operation retrieve_operation = azure::storage::table_operation::retrieve_entity(U(\"Smith\"), U(\"Jeff\"));\n    azure::storage::table_result retrieve_result = table.execute(retrieve_operation);\n\n    // Create an operation to delete the entity.\n    azure::storage::table_operation delete_operation = azure::storage::table_operation::delete_entity(retrieve_result.entity());\n\n    // Submit the delete operation to the table service.\n    azure::storage::table_result delete_result = table.execute(delete_operation);  \n \n## How to: Delete a table\nFinally, the following code example deletes a table from a storage account. A table which has been deleted will be unavailable to be recreated for a period of time following the deletion.  \n\n    // Retrieve the storage account from the connection string.\n    azure::storage::cloud_storage_account storage_account = azure::storage::cloud_storage_account::parse(storage_connection_string);\n\n    // Create the table client.\n    azure::storage::cloud_table_client table_client = storage_account.create_cloud_table_client();\n\n    // Create a cloud table object for the table.\n    azure::storage::cloud_table table = table_client.get_table_reference(U(\"people\"));\n\n    // Create an operation to retrieve the entity with partition key of \"Smith\" and row key of \"Jeff\".\n    azure::storage::table_operation retrieve_operation = azure::storage::table_operation::retrieve_entity(U(\"Smith\"), U(\"Jeff\"));\n    azure::storage::table_result retrieve_result = table.execute(retrieve_operation);\n\n    // Create an operation to delete the entity.\n    azure::storage::table_operation delete_operation = azure::storage::table_operation::delete_entity(retrieve_result.entity());\n\n    // Submit the delete operation to the table service.\n    azure::storage::table_result delete_result = table.execute(delete_operation);\n\n## Next steps\nNow that you've learned the basics of table storage, follow these links to learn more about Azure Storage.  \n\n-   [How to use Blob Storage from C++](storage-c-plus-plus-how-to-use-blobs.md)\n-   [How to use Queue Storage from C++](storage-c-plus-plus-how-to-use-queues.md)\n-   [List Azure Storage Resources in C++](storage-c-plus-plus-enumeration.md)\n-   [Storage Client Library for C++ Reference](http://azure.github.io/azure-storage-cpp)\n-   [Azure Storage Documentation](http://azure.microsoft.com/documentation/services/storage/)\n \n"
}