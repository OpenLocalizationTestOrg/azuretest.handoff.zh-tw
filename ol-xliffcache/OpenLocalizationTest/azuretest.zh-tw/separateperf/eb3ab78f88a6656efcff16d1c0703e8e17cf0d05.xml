{
  "nodes": [
    {
      "content": "Connect to on-premises SQL Server from a web app in Azure App Service using Hybrid Connections",
      "pos": [
        27,
        121
      ]
    },
    {
      "content": "Create a web app on Microsoft Azure and connect it to an on-premises SQL Server database",
      "pos": [
        140,
        228
      ]
    },
    {
      "content": "Connect to on-premises SQL Server from a web app in Azure App Service using Hybrid Connections",
      "pos": [
        541,
        635
      ]
    },
    {
      "content": "Hybrid Connections can connect <bpt id=\"p1\">[</bpt>Azure App Service<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529714)</ept> Web Apps to on-premises resources that use a static TCP port.",
      "pos": [
        637,
        796
      ]
    },
    {
      "content": "Supported resources include Microsoft SQL Server, MySQL, HTTP Web APIs, Mobile Services, and most custom Web Services.",
      "pos": [
        797,
        915
      ]
    },
    {
      "content": "In this tutorial, you will learn how to create an App Service web app in the <bpt id=\"p1\">[</bpt>Azure preview<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529715)</ept>, connect the web app to your local on-premises SQL Server database using the new Hybrid Connection feature, create a simple ASP.NET application that will use the hybrid connection, and deploy the application to the App Service web app.",
      "pos": [
        917,
        1292
      ]
    },
    {
      "content": "The completed web app on Azure stores user credentials in a membership database that is on-premises.",
      "pos": [
        1293,
        1393
      ]
    },
    {
      "content": "The tutorial assumes no prior experience using Azure or ASP.NET.",
      "pos": [
        1394,
        1458
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you want to get started with Azure App Service before signing up for an Azure account, go to <bpt id=\"p1\">[</bpt>Try App Service<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=523751)</ept>, where you can immediately create a short-lived starter web app in App Service.",
      "pos": [
        1461,
        1714
      ]
    },
    {
      "content": "No credit cards required; no commitments.",
      "pos": [
        1715,
        1756
      ]
    },
    {
      "content": "The Web Apps portion of the Hybrid Connections feature is available only in the <bpt id=\"p1\">[</bpt>Azure preview portal<ept id=\"p1\">](https://portal.azure.com)</ept>.",
      "pos": [
        1760,
        1889
      ]
    },
    {
      "content": "To create a connection in BizTalk Services, see <bpt id=\"p1\">[</bpt>Hybrid Connections<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkID=397274)</ept>.",
      "pos": [
        1890,
        2008
      ]
    },
    {
      "content": "Prerequisites",
      "pos": [
        2015,
        2028
      ]
    },
    {
      "content": "To complete this tutorial, you'll need the following products.",
      "pos": [
        2033,
        2095
      ]
    },
    {
      "content": "All are available in free versions, so you can start developing for Azure entirely for free.",
      "pos": [
        2096,
        2188
      ]
    },
    {
      "pos": [
        2192,
        2287
      ],
      "content": "<bpt id=\"p1\">**</bpt>Azure subscription<ept id=\"p1\">**</ept> - For a free subscription, see <bpt id=\"p2\">[</bpt>Azure Free Trial<ept id=\"p2\">](/pricing/free-trial/)</ept>."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Visual Studio 2013<ept id=\"p1\">**</ept> - To download a free trial version of Visual Studio 2013, see <bpt id=\"p2\">[</bpt>Visual Studio Downloads<ept id=\"p2\">](http://www.visualstudio.com/downloads/download-visual-studio-vs)</ept>.",
      "pos": [
        2291,
        2467
      ]
    },
    {
      "content": "Install this before continuing.",
      "pos": [
        2468,
        2499
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Microsoft .NET Framework 3.5 Service Pack 1<ept id=\"p1\">**</ept> - If your operating system is Windows 8.1, Windows Server 2012 R2, Windows 8, Windows Server 2012, Windows 7, or Windows Server 2008 R2, you can enable this in Control Panel &gt; Programs and Features &gt; Turn Windows features on or off.",
      "pos": [
        2503,
        2783
      ]
    },
    {
      "content": "Otherwise, you can download it from the <bpt id=\"p1\">[</bpt>Microsoft Download Center<ept id=\"p1\">](http://www.microsoft.com/download/en/details.aspx?displaylang=en&amp;id=22)</ept>.",
      "pos": [
        2784,
        2924
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>SQL Server 2014 Express with Tools<ept id=\"p1\">**</ept> - download Microsoft SQL Server Express for free at the <bpt id=\"p2\">[</bpt>Microsoft Web Platform Database page<ept id=\"p2\">](http://www.microsoft.com/web/platform/database.aspx)</ept>.",
      "pos": [
        2928,
        3115
      ]
    },
    {
      "content": "Choose the <bpt id=\"p1\">**</bpt>Express<ept id=\"p1\">**</ept> (not LocalDB) version.",
      "pos": [
        3116,
        3161
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Express with Tools<ept id=\"p1\">**</ept> version includes SQL Server Management Studio, which you will use in this tutorial.",
      "pos": [
        3162,
        3272
      ]
    },
    {
      "pos": [
        3276,
        3577
      ],
      "content": "<bpt id=\"p1\">**</bpt>SQL Server Management Studio Express<ept id=\"p1\">**</ept> - This is included with the SQL Server 2014 Express with Tools download mentioned above, but if you need to install it separately, you can download and install it from the <bpt id=\"p2\">[</bpt>SQL Server Express download page<ept id=\"p2\">](http://www.microsoft.com/web/platform/database.aspx)</ept>."
    },
    {
      "content": "The tutorial assumes that you have an Azure subscription, that you have installed Visual Studio 2013, and that you have installed or enabled .NET Framework 3.5.",
      "pos": [
        3579,
        3739
      ]
    },
    {
      "content": "The tutorial shows you how to install SQL Server 2014 Express in a configuration that works well with the Azure Hybrid Connections feature (a default instance with a static TCP port).",
      "pos": [
        3740,
        3923
      ]
    },
    {
      "content": "Before starting the tutorial, download SQL Server 2014 Express with Tools from the location mentioned above if you do not have SQL Server installed.",
      "pos": [
        3924,
        4072
      ]
    },
    {
      "content": "Notes",
      "pos": [
        4078,
        4083
      ]
    },
    {
      "content": "To use an on-premises SQL Server or SQL Server Express database with a hybrid connection, TCP/IP needs to be enabled on a static port.",
      "pos": [
        4088,
        4222
      ]
    },
    {
      "content": "Default instances on SQL Server use static port 1433, whereas named instances do not.",
      "pos": [
        4223,
        4308
      ]
    },
    {
      "content": "The computer on which you install the on-premises Hybrid Connection Manager agent:",
      "pos": [
        4310,
        4392
      ]
    },
    {
      "content": "Must have outbound connectivity to Azure over:",
      "pos": [
        4396,
        4442
      ]
    },
    {
      "content": "Port",
      "pos": [
        4444,
        4448
      ]
    },
    {
      "content": "Why",
      "pos": [
        4449,
        4452
      ]
    },
    {
      "content": "80",
      "pos": [
        4461,
        4463
      ]
    },
    {
      "pos": [
        4464,
        4555
      ],
      "content": "<bpt id=\"p1\">**</bpt>Required<ept id=\"p1\">**</ept> for HTTP port for certificate validation and optionally for data connectivity."
    },
    {
      "content": "443",
      "pos": [
        4556,
        4559
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Optional<ept id=\"p1\">**</ept> for data connectivity.",
      "pos": [
        4560,
        4595
      ]
    },
    {
      "content": "If outbound connectivity to 443 is unavailable, TCP port 80 is used.",
      "pos": [
        4596,
        4664
      ]
    },
    {
      "content": "5671 and 9352",
      "pos": [
        4665,
        4678
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Recommended<ept id=\"p1\">**</ept> but Optional for data connectivity.",
      "pos": [
        4679,
        4730
      ]
    },
    {
      "content": "Note this mode usually yields higher throughput.",
      "pos": [
        4731,
        4779
      ]
    },
    {
      "content": "If outbound connectivity to these ports is unavailable, TCP port 443 is used.",
      "pos": [
        4780,
        4857
      ]
    },
    {
      "pos": [
        4860,
        4939
      ],
      "content": "Must be able to reach the <bpt id=\"p1\">*</bpt>hostname<ept id=\"p1\">*</ept>:<bpt id=\"p2\">*</bpt>portnumber<ept id=\"p2\">*</ept> of your on-premises resource."
    },
    {
      "content": "The steps in this article assume that you are using the browser from the computer that will host the on-premises hybrid connection agent.",
      "pos": [
        4941,
        5078
      ]
    },
    {
      "pos": [
        5080,
        5296
      ],
      "content": "If you already have SQL Server installed in a configuration and in an environment that meets the conditions described above, you can skip ahead and start with <bpt id=\"p1\">[</bpt>Create a SQL Server database on-premises<ept id=\"p1\">](#CreateSQLDB)</ept>."
    },
    {
      "content": "A.",
      "pos": [
        5327,
        5329
      ]
    },
    {
      "content": "Install SQL Server Express, enable TCP/IP, and create a SQL Server database on-premises",
      "pos": [
        5330,
        5417
      ]
    },
    {
      "content": "This section shows you how to install SQL Server Express, enable TCP/IP, and create a database so that your web application will work with the Azure Preview environment.",
      "pos": [
        5422,
        5591
      ]
    },
    {
      "content": "Install SQL Server Express",
      "pos": [
        5597,
        5623
      ]
    },
    {
      "content": "To install SQL Server Express, run the <bpt id=\"p1\">**</bpt>SQLEXPRWT_x64_ENU.exe<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>SQLEXPR_x86_ENU.exe<ept id=\"p2\">**</ept> file that you downloaded.",
      "pos": [
        5632,
        5749
      ]
    },
    {
      "content": "The SQL Server Installation Center wizard appears.",
      "pos": [
        5750,
        5800
      ]
    },
    {
      "content": "![SQL Server Install][SQLServerInstall]",
      "pos": [
        5806,
        5845
      ]
    },
    {
      "content": "Choose <bpt id=\"p1\">**</bpt>New SQL Server stand-alone installation or add features to an existing installation<ept id=\"p1\">**</ept>.",
      "pos": [
        5850,
        5945
      ]
    },
    {
      "content": "Follow the instructions, accepting the default choices and settings, until you get to the <bpt id=\"p1\">**</bpt>Instance Configuration<ept id=\"p1\">**</ept> page.",
      "pos": [
        5946,
        6068
      ]
    },
    {
      "pos": [
        6073,
        6141
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Instance Configuration<ept id=\"p1\">**</ept> page, choose <bpt id=\"p2\">**</bpt>Default instance<ept id=\"p2\">**</ept>."
    },
    {
      "content": "![Choose Default Instance][ChooseDefaultInstance]",
      "pos": [
        6147,
        6196
      ]
    },
    {
      "content": "By default, the default instance of SQL Server listens for requests from SQL Server clients on static port 1433, which is what the Hybrid Connections feature requires.",
      "pos": [
        6202,
        6369
      ]
    },
    {
      "content": "Named instances use dynamic ports and UDP, which are not supported by Hybrid Connections.",
      "pos": [
        6370,
        6459
      ]
    },
    {
      "pos": [
        6464,
        6521
      ],
      "content": "Accept the defaults on the <bpt id=\"p1\">**</bpt>Server Configuration<ept id=\"p1\">**</ept> page."
    },
    {
      "pos": [
        6526,
        6705
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Database Engine Configuration<ept id=\"p1\">**</ept> page, under <bpt id=\"p2\">**</bpt>Authentication Mode<ept id=\"p2\">**</ept>, choose <bpt id=\"p3\">**</bpt>Mixed Mode (SQL Server authentication and Windows authentication)<ept id=\"p3\">**</ept>, and provide a password."
    },
    {
      "content": "![Choose Mixed Mode][ChooseMixedMode]",
      "pos": [
        6711,
        6748
      ]
    },
    {
      "content": "In this tutorial, you will be using SQL Server authentication.",
      "pos": [
        6754,
        6816
      ]
    },
    {
      "content": "Be sure to remember the password that you provide, because you will need it later.",
      "pos": [
        6817,
        6899
      ]
    },
    {
      "content": "Step through the rest of the wizard to complete the installation.",
      "pos": [
        6904,
        6969
      ]
    },
    {
      "content": "Enable TCP/IP",
      "pos": [
        6975,
        6988
      ]
    },
    {
      "content": "To enable TCP/IP, you will use SQL Server Configuration Manager, which was installed when you installed SQL Server Express.",
      "pos": [
        6993,
        7116
      ]
    },
    {
      "content": "Follow the steps in <bpt id=\"p1\">[</bpt>Enable TCP/IP Network Protocol for SQL Server<ept id=\"p1\">](http://technet.microsoft.com/library/hh231672%28v=sql.110%29.aspx)</ept> before continuing.",
      "pos": [
        7117,
        7270
      ]
    },
    {
      "content": "Create a SQL Server database on-premises",
      "pos": [
        7303,
        7343
      ]
    },
    {
      "content": "Your Visual Studio web application requires a membership database that can be accessed by Azure.",
      "pos": [
        7349,
        7445
      ]
    },
    {
      "content": "This requires a SQL Server or SQL Server Express database (not the LocalDB database that the MVC template uses by default), so you'll create the membership database next.",
      "pos": [
        7446,
        7616
      ]
    },
    {
      "pos": [
        7621,
        7919
      ],
      "content": "In SQL Server Management Studio, connect to the SQL Server you just installed. (If the **Connect to Server** dialog does not appear automatically, navigate to **Object Explorer** in the left pane, click **Connect**, and then click **Database Engine**.)\n ![Connect to Server][SSMSConnectToServer]",
      "leadings": [
        "",
        "   "
      ],
      "nodes": [
        {
          "content": "In SQL Server Management Studio, connect to the SQL Server you just installed. (If the **Connect to Server** dialog does not appear automatically, navigate to **Object Explorer** in the left pane, click **Connect**, and then click **Database Engine**.)",
          "pos": [
            0,
            252
          ],
          "nodes": [
            {
              "content": "In SQL Server Management Studio, connect to the SQL Server you just installed.",
              "pos": [
                0,
                78
              ]
            },
            {
              "content": "(If the <bpt id=\"p1\">**</bpt>Connect to Server<ept id=\"p1\">**</ept> dialog does not appear automatically, navigate to <bpt id=\"p2\">**</bpt>Object Explorer<ept id=\"p2\">**</ept> in the left pane, click <bpt id=\"p3\">**</bpt>Connect<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>Database Engine<ept id=\"p4\">**</ept>.)",
              "pos": [
                79,
                252
              ]
            }
          ]
        },
        {
          "content": "![Connect to Server][SSMSConnectToServer]",
          "pos": [
            254,
            295
          ]
        }
      ]
    },
    {
      "content": "For <bpt id=\"p1\">**</bpt>Server type<ept id=\"p1\">**</ept>, choose <bpt id=\"p2\">**</bpt>Database Engine<ept id=\"p2\">**</ept>.",
      "pos": [
        7925,
        7973
      ]
    },
    {
      "content": "For <bpt id=\"p1\">**</bpt>Server name<ept id=\"p1\">**</ept>, you can use <bpt id=\"p2\">**</bpt>localhost<ept id=\"p2\">**</ept> or the name of the computer that you are using.",
      "pos": [
        7974,
        8068
      ]
    },
    {
      "content": "Choose <bpt id=\"p1\">**</bpt>SQL Server authentication<ept id=\"p1\">**</ept>, and then log in with the sa user name and the password that you created earlier.",
      "pos": [
        8069,
        8187
      ]
    },
    {
      "pos": [
        8192,
        8334
      ],
      "content": "To create a new database by using SQL Server Management Studio, right-click <bpt id=\"p1\">**</bpt>Databases<ept id=\"p1\">**</ept> in Object Explorer, and then click <bpt id=\"p2\">**</bpt>New Database<ept id=\"p2\">**</ept>."
    },
    {
      "content": "![Create new database][SSMScreateNewDB]",
      "pos": [
        8340,
        8379
      ]
    },
    {
      "pos": [
        8384,
        8480
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>New Database<ept id=\"p1\">**</ept> dialog, enter MembershipDB for the database name, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "![Provide database name][SSMSprovideDBname]",
      "pos": [
        8486,
        8529
      ]
    },
    {
      "content": "Note that you do not make any changes to the database at this point.",
      "pos": [
        8535,
        8603
      ]
    },
    {
      "content": "The membership information will be added automatically later by your web application when you run it.",
      "pos": [
        8604,
        8705
      ]
    },
    {
      "pos": [
        8710,
        8818
      ],
      "content": "In Object Explorer, if you expand <bpt id=\"p1\">**</bpt>Databases<ept id=\"p1\">**</ept>, you will see that the membership database has been created."
    },
    {
      "content": "![MembershipDB created][SSMSMembershipDBCreated]",
      "pos": [
        8824,
        8872
      ]
    },
    {
      "content": "B.",
      "pos": [
        8903,
        8905
      ]
    },
    {
      "content": "Create a web app in the Azure preview portal",
      "pos": [
        8906,
        8950
      ]
    },
    {
      "pos": [
        8957,
        9184
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you have already created a web app in the Azure preview portal that you want to use for this tutorial, you can skip ahead to <bpt id=\"p1\">[</bpt>Create a Hybrid Connection and a BizTalk Service<ept id=\"p1\">](#CreateHC)</ept> and continue from there."
    },
    {
      "pos": [
        9189,
        9293
      ],
      "content": "In the <bpt id=\"p1\">[</bpt>Azure preview portal<ept id=\"p1\">](https://portal.azure.com)</ept>, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>Web + Mobile<ept id=\"p3\">**</ept> &gt; <bpt id=\"p4\">**</bpt>Web app<ept id=\"p4\">**</ept>."
    },
    {
      "content": "![New button][New]",
      "pos": [
        9299,
        9317
      ]
    },
    {
      "pos": [
        9322,
        9372
      ],
      "content": "Configure your web app, and then click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>."
    },
    {
      "content": "![Website name][WebsiteCreationBlade]",
      "pos": [
        9378,
        9415
      ]
    },
    {
      "content": "After a few moments, the web app is created and its web app blade appears.",
      "pos": [
        9420,
        9494
      ]
    },
    {
      "content": "The blade is a vertically scrollable dashboard that lets you manage your web app.",
      "pos": [
        9495,
        9576
      ]
    },
    {
      "content": "![Website running][WebSiteRunningBlade]",
      "pos": [
        9582,
        9621
      ]
    },
    {
      "pos": [
        9627,
        9720
      ],
      "content": "To verify the web app is live, you can click the <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept> icon to display the default page."
    },
    {
      "content": "Next, you will create a hybrid connection and a BizTalk service for the web app.",
      "pos": [
        9722,
        9802
      ]
    },
    {
      "content": "C.",
      "pos": [
        9831,
        9833
      ]
    },
    {
      "content": "Create a Hybrid Connection and a BizTalk Service",
      "pos": [
        9834,
        9882
      ]
    },
    {
      "pos": [
        9890,
        10029
      ],
      "content": "Back in the portal, scroll down your web app's blade and click <bpt id=\"p1\">**</bpt>Network Feature status<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Configure your hybrid connection endpoints<ept id=\"p2\">**</ept>."
    },
    {
      "content": "![Hybrid connections][CreateHCHCIcon]",
      "pos": [
        10035,
        10072
      ]
    },
    {
      "pos": [
        10077,
        10152
      ],
      "content": "On the Hybrid connections blade, click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>New hybrid connection<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        10157,
        10199
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Create hybrid connection<ept id=\"p1\">**</ept> blade:"
    },
    {
      "pos": [
        10206,
        10254
      ],
      "content": "For <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept>, provide a name for the connection."
    },
    {
      "pos": [
        10261,
        10336
      ],
      "content": "For <bpt id=\"p1\">**</bpt>Hostname<ept id=\"p1\">**</ept>, enter the computer name of your SQL Server host computer."
    },
    {
      "pos": [
        10343,
        10402
      ],
      "content": "For <bpt id=\"p1\">**</bpt>Port<ept id=\"p1\">**</ept>, enter 1433 (the default port for SQL Server)."
    },
    {
      "pos": [
        10409,
        10502
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>BizTalk Service<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>New BizTalk Service<ept id=\"p2\">**</ept> and enter a name for the BizTalk service."
    },
    {
      "content": "![Create a hybrid connection][TwinCreateHCBlades]",
      "pos": [
        10508,
        10557
      ]
    },
    {
      "pos": [
        10562,
        10581
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> twice."
    },
    {
      "pos": [
        10587,
        10782
      ],
      "content": "When the process completes, the <bpt id=\"p1\">**</bpt>Notifications<ept id=\"p1\">**</ept> area will flash a green <bpt id=\"p2\">**</bpt>SUCCESS<ept id=\"p2\">**</ept> and the <bpt id=\"p3\">**</bpt>Hybrid connection<ept id=\"p3\">**</ept> blade will show the new hybrid connection with the status as <bpt id=\"p4\">**</bpt>Not connected<ept id=\"p4\">**</ept>."
    },
    {
      "content": "![One hybrid connection created][CreateHCOneConnectionCreated]",
      "pos": [
        10788,
        10850
      ]
    },
    {
      "content": "At this point, you have completed an important part of the cloud hybrid connection infrastructure.",
      "pos": [
        10852,
        10950
      ]
    },
    {
      "content": "Next, you will create a corresponding on-premises piece.",
      "pos": [
        10951,
        11007
      ]
    },
    {
      "content": "D.",
      "pos": [
        11038,
        11040
      ]
    },
    {
      "content": "Install the on-premises Hybrid Connection Manager to complete the connection",
      "pos": [
        11041,
        11117
      ]
    },
    {
      "content": "Now that the hybrid connection infrastructure is complete, you will create a web application that uses it.",
      "pos": [
        11254,
        11360
      ]
    },
    {
      "content": "E.",
      "pos": [
        11393,
        11395
      ]
    },
    {
      "content": "Create a basic ASP.NET web project, edit the database connection string, and run the project locally",
      "pos": [
        11396,
        11496
      ]
    },
    {
      "content": "Create a basic ASP.NET project",
      "pos": [
        11505,
        11535
      ]
    },
    {
      "pos": [
        11543,
        11604
      ],
      "content": "In Visual Studio, on the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, create a new Project:"
    },
    {
      "content": "![New Visual Studio project][HCVSNewProject]",
      "pos": [
        11610,
        11654
      ]
    },
    {
      "pos": [
        11659,
        11796
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Templates<ept id=\"p1\">**</ept> section of the <bpt id=\"p2\">**</bpt>New Project<ept id=\"p2\">**</ept> dialog, select <bpt id=\"p3\">**</bpt>Web<ept id=\"p3\">**</ept> and choose <bpt id=\"p4\">**</bpt>ASP.NET Web Application<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>OK<ept id=\"p5\">**</ept>."
    },
    {
      "content": "![Choose ASP.NET Web Application][HCVSChooseASPNET]",
      "pos": [
        11802,
        11853
      ]
    },
    {
      "pos": [
        11858,
        11935
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>New ASP.NET Project<ept id=\"p1\">**</ept> dialog, choose <bpt id=\"p2\">**</bpt>MVC<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>."
    },
    {
      "content": "![Choose MVC][HCVSChooseMVC]",
      "pos": [
        11941,
        11969
      ]
    },
    {
      "content": "When the project has been created, the application readme page appears.",
      "pos": [
        11974,
        12045
      ]
    },
    {
      "content": "Do not run the web project yet.",
      "pos": [
        12046,
        12077
      ]
    },
    {
      "content": "![Readme page][HCVSReadmePage]",
      "pos": [
        12083,
        12113
      ]
    },
    {
      "content": "Edit the database connection string for the application",
      "pos": [
        12119,
        12174
      ]
    },
    {
      "content": "In this step, you edit the connection string that tells your application where to find your local SQL Server Express database.",
      "pos": [
        12180,
        12306
      ]
    },
    {
      "content": "The connection string is in the application's Web.config file, which contains configuration information for the application.",
      "pos": [
        12307,
        12431
      ]
    },
    {
      "pos": [
        12435,
        12662
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> To ensure that your application uses the database that you created in SQL Server Express, and not the one in Visual Studio's default LocalDB, it is important that you complete this step before running your project."
    },
    {
      "content": "In Solution Explorer, double-click the Web.config file.",
      "pos": [
        12667,
        12722
      ]
    },
    {
      "content": "![Web.config][HCVSChooseWebConfig]",
      "pos": [
        12728,
        12762
      ]
    },
    {
      "pos": [
        12767,
        12911
      ],
      "content": "Edit the <bpt id=\"p1\">**</bpt>connectionStrings<ept id=\"p1\">**</ept> section to point to the SQL Server database on your local machine, following the syntax in the following example:"
    },
    {
      "content": "![Connection string][HCVSConnectionString]",
      "pos": [
        12917,
        12959
      ]
    },
    {
      "content": "When composing the connection string, keep in mind the following:",
      "pos": [
        12965,
        13030
      ]
    },
    {
      "content": "If you are connecting to a named instance instead of a default instance (for example, YourServer\\SQLEXPRESS), you must configure your SQL Server to use static ports.",
      "pos": [
        13038,
        13203
      ]
    },
    {
      "content": "For information on configuring static ports, see <bpt id=\"p1\">[</bpt>How to configure SQL Server to listen on a specific port<ept id=\"p1\">](http://support.microsoft.com/kb/823938)</ept>.",
      "pos": [
        13204,
        13352
      ]
    },
    {
      "content": "By default, named instances use UDP and dynamic ports, which are not supported by Hybrid Connections.",
      "pos": [
        13353,
        13454
      ]
    },
    {
      "content": "It is recommended that you specify the port (1433 by default, as shown in the example) n the connection string so that you can be sure that your local SQL Server has TCP enabled and is using the correct port.",
      "pos": [
        13462,
        13670
      ]
    },
    {
      "content": "Remember to use SQL Server Authentication to connect, specifying the user ID and password in your connection string.",
      "pos": [
        13678,
        13794
      ]
    },
    {
      "pos": [
        13799,
        13859
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept> in Visual Studio to save the Web.config file."
    },
    {
      "content": "Run the project locally and register a new user",
      "pos": [
        13865,
        13912
      ]
    },
    {
      "content": "Now, run your new web project locally by clicking the browse button under Debug.",
      "pos": [
        13921,
        14001
      ]
    },
    {
      "content": "This example uses Internet Explorer.",
      "pos": [
        14002,
        14038
      ]
    },
    {
      "content": "![Run project][HCVSRunProject]",
      "pos": [
        14044,
        14074
      ]
    },
    {
      "pos": [
        14079,
        14169
      ],
      "content": "On the upper right of the default web page, choose <bpt id=\"p1\">**</bpt>Register<ept id=\"p1\">**</ept> to register a new account:"
    },
    {
      "content": "![Register a new account][HCVSRegisterLocally]",
      "pos": [
        14175,
        14221
      ]
    },
    {
      "content": "Enter a user name and password:",
      "pos": [
        14226,
        14257
      ]
    },
    {
      "content": "![Enter user name and password][HCVSCreateNewAccount]",
      "pos": [
        14263,
        14316
      ]
    },
    {
      "content": "This automatically creates a database on your local SQL Server that holds the membership information for your application.",
      "pos": [
        14322,
        14444
      ]
    },
    {
      "content": "One of the tables (<bpt id=\"p1\">**</bpt>dbo.AspNetUsers<ept id=\"p1\">**</ept>) holds web app user credentials like the ones that you just entered.",
      "pos": [
        14445,
        14552
      ]
    },
    {
      "content": "You will see this table later in the tutorial.",
      "pos": [
        14553,
        14599
      ]
    },
    {
      "content": "Close the browser window of the default web page.",
      "pos": [
        14604,
        14653
      ]
    },
    {
      "content": "This stops the application in Visual Studio.",
      "pos": [
        14654,
        14698
      ]
    },
    {
      "content": "You are now ready for the next step, which is to publish the application to Azure and test it.",
      "pos": [
        14700,
        14794
      ]
    },
    {
      "content": "F.",
      "pos": [
        14823,
        14825
      ]
    },
    {
      "content": "Publish the web application to Azure and test it",
      "pos": [
        14826,
        14874
      ]
    },
    {
      "content": "Now, you'll publish your application to your App Service web app and then test it to see how the hybrid connection you configured earlier is being used to connect your web app to the database on your local machine.",
      "pos": [
        14879,
        15093
      ]
    },
    {
      "content": "Publish the web application",
      "pos": [
        15099,
        15126
      ]
    },
    {
      "content": "You can download your publishing profile for the App Service web app in the Azure preview portal.",
      "pos": [
        15135,
        15232
      ]
    },
    {
      "content": "On the blade for your web app, click <bpt id=\"p1\">**</bpt>Get publish profile<ept id=\"p1\">**</ept>, and then save the file to your computer.",
      "pos": [
        15233,
        15335
      ]
    },
    {
      "content": "![Download publish profile][PortalDownloadPublishProfile]",
      "pos": [
        15341,
        15398
      ]
    },
    {
      "content": "Next, you will import this file into your Visual Studio web application.",
      "pos": [
        15404,
        15476
      ]
    },
    {
      "pos": [
        15481,
        15572
      ],
      "content": "In Visual Studio, right-click the project name in Solution Explorer and select <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept>."
    },
    {
      "content": "![Select publish][HCVSRightClickProjectSelectPublish]",
      "pos": [
        15578,
        15631
      ]
    },
    {
      "pos": [
        15636,
        15709
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Publish Web<ept id=\"p1\">**</ept> dialog, on the <bpt id=\"p2\">**</bpt>Profile<ept id=\"p2\">**</ept> tab, choose <bpt id=\"p3\">**</bpt>Import<ept id=\"p3\">**</ept>."
    },
    {
      "content": "![Import][HCVSPublishWebDialogImport]",
      "pos": [
        15715,
        15752
      ]
    },
    {
      "pos": [
        15757,
        15836
      ],
      "content": "Browse to your downloaded publishing profile, select it, and then click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>."
    },
    {
      "content": "![Browse to profile][HCVSBrowseToImportPubProfile]",
      "pos": [
        15842,
        15892
      ]
    },
    {
      "pos": [
        15897,
        15990
      ],
      "content": "Your publishing information is imported and displays on the <bpt id=\"p1\">**</bpt>Connection<ept id=\"p1\">**</ept> tab of the dialog."
    },
    {
      "content": "![Click Publish][HCVSClickPublish]",
      "pos": [
        15996,
        16030
      ]
    },
    {
      "pos": [
        16036,
        16054
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept>."
    },
    {
      "content": "When publishing completes, your browser will launch and show your now familiar ASP.NET application -- except that now it is live in the Azure cloud!",
      "pos": [
        16060,
        16208
      ]
    },
    {
      "content": "Next, you will use your live web application to see its Hybrid Connection in action.",
      "pos": [
        16210,
        16294
      ]
    },
    {
      "content": "Test the completed web application on Azure",
      "pos": [
        16300,
        16343
      ]
    },
    {
      "pos": [
        16352,
        16414
      ],
      "content": "On the top right of your web page on Azure, choose <bpt id=\"p1\">**</bpt>Log in<ept id=\"p1\">**</ept>."
    },
    {
      "content": "![Test log in][HCTestLogIn]",
      "pos": [
        16420,
        16447
      ]
    },
    {
      "content": "Your App Service web app is now connected to your web application's membership database on your local machine.",
      "pos": [
        16452,
        16562
      ]
    },
    {
      "content": "To verify this, log in with the same credentials that you entered in the local database earlier.",
      "pos": [
        16563,
        16659
      ]
    },
    {
      "content": "![Hello greeting][HCTestHelloContoso]",
      "pos": [
        16665,
        16702
      ]
    },
    {
      "content": "To further test your new hybrid connection, log off of your Azure web application and register as another user.",
      "pos": [
        16707,
        16818
      ]
    },
    {
      "content": "Provide a new user name and password, and then click <bpt id=\"p1\">**</bpt>Register<ept id=\"p1\">**</ept>.",
      "pos": [
        16819,
        16885
      ]
    },
    {
      "content": "![Test register another user][HCTestRegisterRelecloud]",
      "pos": [
        16891,
        16945
      ]
    },
    {
      "content": "To verify that the new user's credentials have been stored in your local database through your hybrid connection, open SQL Management Studio on your local computer.",
      "pos": [
        16950,
        17114
      ]
    },
    {
      "content": "In Object Explorer, expand the <bpt id=\"p1\">**</bpt>MembershipDB<ept id=\"p1\">**</ept> database, and then expand <bpt id=\"p2\">**</bpt>Tables<ept id=\"p2\">**</ept>.",
      "pos": [
        17115,
        17200
      ]
    },
    {
      "content": "Right-click the <bpt id=\"p1\">**</bpt>dbo.AspNetUsers<ept id=\"p1\">**</ept> membership table and choose <bpt id=\"p2\">**</bpt>Select Top 1000 Rows<ept id=\"p2\">**</ept> to view the results.",
      "pos": [
        17201,
        17310
      ]
    },
    {
      "content": "![View the results][HCTestSSMSTree]",
      "pos": [
        17316,
        17351
      ]
    },
    {
      "content": "Your local membership table now shows both accounts - the one that you created locally, and the one that you created in the Azure cloud.",
      "pos": [
        17356,
        17492
      ]
    },
    {
      "content": "The one that you created in the cloud has been saved to your on-premises database through Azure's Hybrid Connection feature.",
      "pos": [
        17493,
        17617
      ]
    },
    {
      "content": "![Registered users in on-premises database][HCTestShowMemberDb]",
      "pos": [
        17623,
        17686
      ]
    },
    {
      "content": "You have now created and deployed an ASP.NET web application that uses a hybrid connection between a web app in the Azure cloud and an on-premises SQL Server database.",
      "pos": [
        17688,
        17855
      ]
    },
    {
      "content": "Congratulations!",
      "pos": [
        17856,
        17872
      ]
    },
    {
      "content": "See Also",
      "pos": [
        17877,
        17885
      ]
    },
    {
      "content": "Hybrid Connections overview",
      "pos": [
        17890,
        17917
      ]
    },
    {
      "content": "Josh Twist introduces hybrid connections (Channel 9 video)",
      "pos": [
        17970,
        18028
      ]
    },
    {
      "content": "Hybrid Connections overview",
      "pos": [
        18118,
        18145
      ]
    },
    {
      "content": "BizTalk Services: Dashboard, Monitor, Scale, Configure, and Hybrid Connection tabs",
      "pos": [
        18178,
        18260
      ]
    },
    {
      "content": "Building a Real-World Hybrid Cloud with Seamless Application Portability (Channel 9 video)",
      "pos": [
        18306,
        18396
      ]
    },
    {
      "content": "Connect to an on-premises SQL Server from an Azure mobile service using Hybrid Connections",
      "pos": [
        18474,
        18564
      ]
    },
    {
      "content": "Connect to an on-premises SQL Server from Azure Mobile Services using Hybrid Connections (Channel 9 video)",
      "pos": [
        18637,
        18743
      ]
    },
    {
      "content": "ASP.NET Identity Overview",
      "pos": [
        18899,
        18924
      ]
    },
    {
      "content": "test",
      "pos": [
        24730,
        24734
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Connect to on-premises SQL Server from a web app in Azure App Service using Hybrid Connections\"\n    description=\"Create a web app on Microsoft Azure and connect it to an on-premises SQL Server database\"\n    services=\"app-service\\web\"\n    documentationCenter=\"\"\n    authors=\"cephalin\"\n    manager=\"wpickett\"\n    editor=\"mollybos\"/>\n\n<tags\n    ms.service=\"app-service-web\"\n    ms.workload=\"web\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"09/01/2015\"\n    ms.author=\"cephalin\"/>\n\n# Connect to on-premises SQL Server from a web app in Azure App Service using Hybrid Connections\n\nHybrid Connections can connect [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714) Web Apps to on-premises resources that use a static TCP port. Supported resources include Microsoft SQL Server, MySQL, HTTP Web APIs, Mobile Services, and most custom Web Services.\n\nIn this tutorial, you will learn how to create an App Service web app in the [Azure preview](http://go.microsoft.com/fwlink/?LinkId=529715), connect the web app to your local on-premises SQL Server database using the new Hybrid Connection feature, create a simple ASP.NET application that will use the hybrid connection, and deploy the application to the App Service web app. The completed web app on Azure stores user credentials in a membership database that is on-premises. The tutorial assumes no prior experience using Azure or ASP.NET.\n\n>[AZURE.NOTE] If you want to get started with Azure App Service before signing up for an Azure account, go to [Try App Service](http://go.microsoft.com/fwlink/?LinkId=523751), where you can immediately create a short-lived starter web app in App Service. No credit cards required; no commitments.\n>\n>The Web Apps portion of the Hybrid Connections feature is available only in the [Azure preview portal](https://portal.azure.com). To create a connection in BizTalk Services, see [Hybrid Connections](http://go.microsoft.com/fwlink/p/?LinkID=397274).  \n\n## Prerequisites ##\n\nTo complete this tutorial, you'll need the following products. All are available in free versions, so you can start developing for Azure entirely for free.\n\n- **Azure subscription** - For a free subscription, see [Azure Free Trial](/pricing/free-trial/).\n\n- **Visual Studio 2013** - To download a free trial version of Visual Studio 2013, see [Visual Studio Downloads](http://www.visualstudio.com/downloads/download-visual-studio-vs). Install this before continuing.\n\n- **Microsoft .NET Framework 3.5 Service Pack 1** - If your operating system is Windows 8.1, Windows Server 2012 R2, Windows 8, Windows Server 2012, Windows 7, or Windows Server 2008 R2, you can enable this in Control Panel > Programs and Features > Turn Windows features on or off. Otherwise, you can download it from the [Microsoft Download Center](http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=22).\n\n- **SQL Server 2014 Express with Tools** - download Microsoft SQL Server Express for free at the [Microsoft Web Platform Database page](http://www.microsoft.com/web/platform/database.aspx). Choose the **Express** (not LocalDB) version. The **Express with Tools** version includes SQL Server Management Studio, which you will use in this tutorial.\n\n- **SQL Server Management Studio Express** - This is included with the SQL Server 2014 Express with Tools download mentioned above, but if you need to install it separately, you can download and install it from the [SQL Server Express download page](http://www.microsoft.com/web/platform/database.aspx).\n\nThe tutorial assumes that you have an Azure subscription, that you have installed Visual Studio 2013, and that you have installed or enabled .NET Framework 3.5. The tutorial shows you how to install SQL Server 2014 Express in a configuration that works well with the Azure Hybrid Connections feature (a default instance with a static TCP port). Before starting the tutorial, download SQL Server 2014 Express with Tools from the location mentioned above if you do not have SQL Server installed.\n\n### Notes ###\nTo use an on-premises SQL Server or SQL Server Express database with a hybrid connection, TCP/IP needs to be enabled on a static port. Default instances on SQL Server use static port 1433, whereas named instances do not.\n\nThe computer on which you install the on-premises Hybrid Connection Manager agent:\n\n- Must have outbound connectivity to Azure over:\n\nPort|Why\n---|---\n80|**Required** for HTTP port for certificate validation and optionally for data connectivity.\n443|**Optional** for data connectivity. If outbound connectivity to 443 is unavailable, TCP port 80 is used.\n5671 and 9352|**Recommended** but Optional for data connectivity. Note this mode usually yields higher throughput. If outbound connectivity to these ports is unavailable, TCP port 443 is used.\n- Must be able to reach the *hostname*:*portnumber* of your on-premises resource.\n\nThe steps in this article assume that you are using the browser from the computer that will host the on-premises hybrid connection agent.\n\nIf you already have SQL Server installed in a configuration and in an environment that meets the conditions described above, you can skip ahead and start with [Create a SQL Server database on-premises](#CreateSQLDB).\n\n<a name=\"InstallSQL\"></a>\n## A. Install SQL Server Express, enable TCP/IP, and create a SQL Server database on-premises ##\n\nThis section shows you how to install SQL Server Express, enable TCP/IP, and create a database so that your web application will work with the Azure Preview environment.\n\n### Install SQL Server Express ###\n\n1. To install SQL Server Express, run the **SQLEXPRWT_x64_ENU.exe** or **SQLEXPR_x86_ENU.exe** file that you downloaded. The SQL Server Installation Center wizard appears.\n\n    ![SQL Server Install][SQLServerInstall]\n\n2. Choose **New SQL Server stand-alone installation or add features to an existing installation**. Follow the instructions, accepting the default choices and settings, until you get to the **Instance Configuration** page.\n\n3. On the **Instance Configuration** page, choose **Default instance**.\n\n    ![Choose Default Instance][ChooseDefaultInstance]\n\n    By default, the default instance of SQL Server listens for requests from SQL Server clients on static port 1433, which is what the Hybrid Connections feature requires. Named instances use dynamic ports and UDP, which are not supported by Hybrid Connections.\n\n4. Accept the defaults on the **Server Configuration** page.\n\n5. On the **Database Engine Configuration** page, under **Authentication Mode**, choose **Mixed Mode (SQL Server authentication and Windows authentication)**, and provide a password.\n\n    ![Choose Mixed Mode][ChooseMixedMode]\n\n    In this tutorial, you will be using SQL Server authentication. Be sure to remember the password that you provide, because you will need it later.\n\n6. Step through the rest of the wizard to complete the installation.\n\n### Enable TCP/IP ###\nTo enable TCP/IP, you will use SQL Server Configuration Manager, which was installed when you installed SQL Server Express. Follow the steps in [Enable TCP/IP Network Protocol for SQL Server](http://technet.microsoft.com/library/hh231672%28v=sql.110%29.aspx) before continuing.\n\n<a name=\"CreateSQLDB\"></a>\n### Create a SQL Server database on-premises ###\n\nYour Visual Studio web application requires a membership database that can be accessed by Azure. This requires a SQL Server or SQL Server Express database (not the LocalDB database that the MVC template uses by default), so you'll create the membership database next.\n\n1. In SQL Server Management Studio, connect to the SQL Server you just installed. (If the **Connect to Server** dialog does not appear automatically, navigate to **Object Explorer** in the left pane, click **Connect**, and then click **Database Engine**.)\n    ![Connect to Server][SSMSConnectToServer]\n\n    For **Server type**, choose **Database Engine**. For **Server name**, you can use **localhost** or the name of the computer that you are using. Choose **SQL Server authentication**, and then log in with the sa user name and the password that you created earlier.\n\n2. To create a new database by using SQL Server Management Studio, right-click **Databases** in Object Explorer, and then click **New Database**.\n\n    ![Create new database][SSMScreateNewDB]\n\n3. In the **New Database** dialog, enter MembershipDB for the database name, and then click **OK**.\n\n    ![Provide database name][SSMSprovideDBname]\n\n    Note that you do not make any changes to the database at this point. The membership information will be added automatically later by your web application when you run it.\n\n4. In Object Explorer, if you expand **Databases**, you will see that the membership database has been created.\n\n    ![MembershipDB created][SSMSMembershipDBCreated]\n\n<a name=\"CreateSite\"></a>\n## B. Create a web app in the Azure preview portal ##\n\n> [AZURE.NOTE] If you have already created a web app in the Azure preview portal that you want to use for this tutorial, you can skip ahead to [Create a Hybrid Connection and a BizTalk Service](#CreateHC) and continue from there.\n\n1. In the [Azure preview portal](https://portal.azure.com), click **New** > **Web + Mobile** > **Web app**.\n\n    ![New button][New]\n\n2. Configure your web app, and then click **Create**.\n\n    ![Website name][WebsiteCreationBlade]\n\n3. After a few moments, the web app is created and its web app blade appears. The blade is a vertically scrollable dashboard that lets you manage your web app.\n\n    ![Website running][WebSiteRunningBlade]\n\n    To verify the web app is live, you can click the **Browse** icon to display the default page.\n\nNext, you will create a hybrid connection and a BizTalk service for the web app.\n\n<a name=\"CreateHC\"></a>\n## C. Create a Hybrid Connection and a BizTalk Service ##\n\n1. Back in the portal, scroll down your web app's blade and click **Network Feature status** > **Configure your hybrid connection endpoints**.\n\n    ![Hybrid connections][CreateHCHCIcon]\n\n2. On the Hybrid connections blade, click **Add** > **New hybrid connection**.\n\n3. On the **Create hybrid connection** blade:\n    - For **Name**, provide a name for the connection.\n    - For **Hostname**, enter the computer name of your SQL Server host computer.\n    - For **Port**, enter 1433 (the default port for SQL Server).\n    - Click **BizTalk Service** > **New BizTalk Service** and enter a name for the BizTalk service.\n\n    ![Create a hybrid connection][TwinCreateHCBlades]\n\n5. Click **OK** twice.\n\n    When the process completes, the **Notifications** area will flash a green **SUCCESS** and the **Hybrid connection** blade will show the new hybrid connection with the status as **Not connected**.\n\n    ![One hybrid connection created][CreateHCOneConnectionCreated]\n\nAt this point, you have completed an important part of the cloud hybrid connection infrastructure. Next, you will create a corresponding on-premises piece.\n\n<a name=\"InstallHCM\"></a>\n## D. Install the on-premises Hybrid Connection Manager to complete the connection ##\n\n[AZURE.INCLUDE [app-service-hybrid-connections-manager-install](../../includes/app-service-hybrid-connections-manager-install.md)]\n\nNow that the hybrid connection infrastructure is complete, you will create a web application that uses it.\n\n<a name=\"CreateASPNET\"></a>\n## E. Create a basic ASP.NET web project, edit the database connection string, and run the project locally ##\n\n### Create a basic ASP.NET project ###\n1. In Visual Studio, on the **File** menu, create a new Project:\n\n    ![New Visual Studio project][HCVSNewProject]\n\n2. In the **Templates** section of the **New Project** dialog, select **Web** and choose **ASP.NET Web Application**, and then click **OK**.\n\n    ![Choose ASP.NET Web Application][HCVSChooseASPNET]\n\n3. In the **New ASP.NET Project** dialog, choose **MVC**, and then click **OK**.\n\n    ![Choose MVC][HCVSChooseMVC]\n\n4. When the project has been created, the application readme page appears. Do not run the web project yet.\n\n    ![Readme page][HCVSReadmePage]\n\n### Edit the database connection string for the application ###\n\nIn this step, you edit the connection string that tells your application where to find your local SQL Server Express database. The connection string is in the application's Web.config file, which contains configuration information for the application.\n\n> [AZURE.NOTE] To ensure that your application uses the database that you created in SQL Server Express, and not the one in Visual Studio's default LocalDB, it is important that you complete this step before running your project.\n\n1. In Solution Explorer, double-click the Web.config file.\n\n    ![Web.config][HCVSChooseWebConfig]\n\n2. Edit the **connectionStrings** section to point to the SQL Server database on your local machine, following the syntax in the following example:\n\n    ![Connection string][HCVSConnectionString]\n\n    When composing the connection string, keep in mind the following:\n\n    - If you are connecting to a named instance instead of a default instance (for example, YourServer\\SQLEXPRESS), you must configure your SQL Server to use static ports. For information on configuring static ports, see [How to configure SQL Server to listen on a specific port](http://support.microsoft.com/kb/823938). By default, named instances use UDP and dynamic ports, which are not supported by Hybrid Connections.\n\n    - It is recommended that you specify the port (1433 by default, as shown in the example) n the connection string so that you can be sure that your local SQL Server has TCP enabled and is using the correct port.\n\n    - Remember to use SQL Server Authentication to connect, specifying the user ID and password in your connection string.\n\n3. Click **Save** in Visual Studio to save the Web.config file.\n\n### Run the project locally and register a new user ###\n\n1. Now, run your new web project locally by clicking the browse button under Debug. This example uses Internet Explorer.\n\n    ![Run project][HCVSRunProject]\n\n2. On the upper right of the default web page, choose **Register** to register a new account:\n\n    ![Register a new account][HCVSRegisterLocally]\n\n3. Enter a user name and password:\n\n    ![Enter user name and password][HCVSCreateNewAccount]\n\n    This automatically creates a database on your local SQL Server that holds the membership information for your application. One of the tables (**dbo.AspNetUsers**) holds web app user credentials like the ones that you just entered. You will see this table later in the tutorial.\n\n4. Close the browser window of the default web page. This stops the application in Visual Studio.\n\nYou are now ready for the next step, which is to publish the application to Azure and test it.\n\n<a name=\"PubNTest\"></a>\n## F. Publish the web application to Azure and test it ##\n\nNow, you'll publish your application to your App Service web app and then test it to see how the hybrid connection you configured earlier is being used to connect your web app to the database on your local machine.\n\n### Publish the web application ###\n\n1. You can download your publishing profile for the App Service web app in the Azure preview portal. On the blade for your web app, click **Get publish profile**, and then save the file to your computer.\n\n    ![Download publish profile][PortalDownloadPublishProfile]\n\n    Next, you will import this file into your Visual Studio web application.\n\n2. In Visual Studio, right-click the project name in Solution Explorer and select **Publish**.\n\n    ![Select publish][HCVSRightClickProjectSelectPublish]\n\n3. In the **Publish Web** dialog, on the **Profile** tab, choose **Import**.\n\n    ![Import][HCVSPublishWebDialogImport]\n\n4. Browse to your downloaded publishing profile, select it, and then click **OK**.\n\n    ![Browse to profile][HCVSBrowseToImportPubProfile]\n\n5. Your publishing information is imported and displays on the **Connection** tab of the dialog.\n\n    ![Click Publish][HCVSClickPublish]\n\n    Click **Publish**.\n\n    When publishing completes, your browser will launch and show your now familiar ASP.NET application -- except that now it is live in the Azure cloud!\n\nNext, you will use your live web application to see its Hybrid Connection in action.\n\n### Test the completed web application on Azure ###\n\n1. On the top right of your web page on Azure, choose **Log in**.\n\n    ![Test log in][HCTestLogIn]\n\n2. Your App Service web app is now connected to your web application's membership database on your local machine. To verify this, log in with the same credentials that you entered in the local database earlier.\n\n    ![Hello greeting][HCTestHelloContoso]\n\n3. To further test your new hybrid connection, log off of your Azure web application and register as another user. Provide a new user name and password, and then click **Register**.\n\n    ![Test register another user][HCTestRegisterRelecloud]\n\n4. To verify that the new user's credentials have been stored in your local database through your hybrid connection, open SQL Management Studio on your local computer. In Object Explorer, expand the **MembershipDB** database, and then expand **Tables**. Right-click the **dbo.AspNetUsers** membership table and choose **Select Top 1000 Rows** to view the results.\n\n    ![View the results][HCTestSSMSTree]\n\n5. Your local membership table now shows both accounts - the one that you created locally, and the one that you created in the Azure cloud. The one that you created in the cloud has been saved to your on-premises database through Azure's Hybrid Connection feature.\n\n    ![Registered users in on-premises database][HCTestShowMemberDb]\n\nYou have now created and deployed an ASP.NET web application that uses a hybrid connection between a web app in the Azure cloud and an on-premises SQL Server database. Congratulations!\n\n## See Also ##\n[Hybrid Connections overview](http://go.microsoft.com/fwlink/p/?LinkID=397274)\n\n[Josh Twist introduces hybrid connections (Channel 9 video)](http://channel9.msdn.com/Shows/Azure-Friday/Josh-Twist-introduces-hybrid-connections)\n\n[Hybrid Connections overview](/services/biztalk-services/)\n\n[BizTalk Services: Dashboard, Monitor, Scale, Configure, and Hybrid Connection tabs](../biztalk-dashboard-monitor-scale-tabs/)\n\n[Building a Real-World Hybrid Cloud with Seamless Application Portability (Channel 9 video)](http://channel9.msdn.com/events/TechEd/NorthAmerica/2014/DCIM-B323#fbid=)\n\n[Connect to an on-premises SQL Server from an Azure mobile service using Hybrid Connections](../mobile-services-dotnet-backend-hybrid-connections-get-started.md)\n\n[Connect to an on-premises SQL Server from Azure Mobile Services using Hybrid Connections (Channel 9 video)](http://channel9.msdn.com/Series/Windows-Azure-Mobile-Services/Connect-to-an-on-premises-SQL-Server-from-Azure-Mobile-Services-using-Hybrid-Connections)\n\n[ASP.NET Identity Overview](http://www.asp.net/identity)\n\n[AZURE.INCLUDE [app-service-web-whats-changed](../../includes/app-service-web-whats-changed.md)]\n\n\n<!-- IMAGES -->\n[SQLServerInstall]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/A01SQLServerInstall.png\n[ChooseDefaultInstance]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/A02ChooseDefaultInstance.png\n[ChooseMixedMode]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/A03ChooseMixedMode.png\n[SSMSConnectToServer]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/A04SSMSConnectToServer.png\n[SSMScreateNewDB]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/A05SSMScreateNewDBlh.png\n[SSMSprovideDBname]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/A06SSMSprovideDBname.png\n[SSMSMembershipDBCreated]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/A07SSMSMembershipDBCreated.png\n[New]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/B01New.png\n[NewWebsite]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/B02NewWebsite.png\n[WebsiteCreationBlade]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/B03WebsiteCreationBlade.png\n[WebSiteRunningBlade]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/B04WebSiteRunningBlade.png\n[Browse]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/B05Browse.png\n[DefaultWebSitePage]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/B06DefaultWebSitePage.png\n[CreateHCHCIcon]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/C01CreateHCHCIcon.png\n[CreateHCAddHC]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/C02CreateHCAddHC.png\n[TwinCreateHCBlades]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/C03TwinCreateHCBlades.png\n[CreateHCCreateBTS]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/C04CreateHCCreateBTS.png\n[CreateBTScomplete]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/C05CreateBTScomplete.png\n[CreateHCSuccessNotification]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/C06CreateHCSuccessNotification.png\n[CreateHCOneConnectionCreated]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/C07CreateHCOneConnectionCreated.png\n[HCIcon]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D01HCIcon.png\n[NotConnected]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D02NotConnected.png\n[NotConnectedBlade]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D03NotConnectedBlade.png\n[ClickListenerSetup]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D04ClickListenerSetup.png\n[ClickToInstallHCM]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D05ClickToInstallHCM.png\n[ApplicationRunWarning]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D06ApplicationRunWarning.png\n[UAC]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D07UAC.png\n[HCMInstalling]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D08HCMInstalling.png\n[HCMInstallComplete]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D09HCMInstallComplete.png\n[HCStatusConnected]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/D10HCStatusConnected.png\n[HCVSNewProject]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/E01HCVSNewProject.png\n[HCVSChooseASPNET]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/E02HCVSChooseASPNET.png\n[HCVSChooseMVC]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/E03HCVSChooseMVC.png\n[HCVSReadmePage]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/E04HCVSReadmePage.png\n[HCVSChooseWebConfig]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/E05HCVSChooseWebConfig.png\n[HCVSConnectionString]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/E06HCVSConnectionString.png\n[HCVSRunProject]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/E06HCVSRunProject.png\n[HCVSRegisterLocally]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/E07HCVSRegisterLocally.png\n[HCVSCreateNewAccount]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/E08HCVSCreateNewAccount.png\n[PortalDownloadPublishProfile]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F01PortalDownloadPublishProfile.png\n[HCVSPublishProfileInDownloadsFolder]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F02HCVSPublishProfileInDownloadsFolder.png\n[HCVSRightClickProjectSelectPublish]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F03HCVSRightClickProjectSelectPublish.png\n[HCVSPublishWebDialogImport]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F04HCVSPublishWebDialogImport.png\n[HCVSBrowseToImportPubProfile]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F05HCVSBrowseToImportPubProfile.png\n[HCVSClickPublish]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F06HCVSClickPublish.png\n[HCTestLogIn]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F07HCTestLogIn.png\n[HCTestHelloContoso]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F08HCTestHelloContoso.png\n[HCTestRegisterRelecloud]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F09HCTestRegisterRelecloud.png\n[HCTestSSMSTree]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F10HCTestSSMSTree.png\n[HCTestShowMemberDb]:./media/web-sites-hybrid-connection-connect-on-premises-sql-server/F11HCTestShowMemberDb.png\n\ntest\n"
}