{
  "nodes": [
    {
      "content": "Use SSH keys with  Linux-based Hadoop from Linux, Unix, or OS X | Microsoft Azure",
      "pos": [
        26,
        107
      ]
    },
    {
      "content": "You can access Linux-based HDInsight using Secure Shell (SSH).",
      "pos": [
        126,
        188
      ]
    },
    {
      "content": "This document provides information on using SSH with HDInsight from Linux, Unix, or OS X clients.",
      "pos": [
        189,
        286
      ]
    },
    {
      "content": "Use SSH with Linux-based Hadoop on HDInsight from Linux, Unix, or OS X (preview)",
      "pos": [
        603,
        683
      ]
    },
    {
      "content": "[AZURE.SELECTOR]",
      "pos": [
        687,
        703
      ]
    },
    {
      "content": "Windows",
      "pos": [
        707,
        714
      ]
    },
    {
      "content": "Linux, Unix, OS X",
      "pos": [
        762,
        779
      ]
    },
    {
      "content": "Linux-based Azure HDInsight clusters provide the option of using Secure Shell (SSH) access through either a password or an SSH key.",
      "pos": [
        822,
        953
      ]
    },
    {
      "content": "This document provides information on using SSH with HDInsight from Linux, Unix, or OS X clients.",
      "pos": [
        954,
        1051
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The steps in this article assume you are using a Linux, Unix, or OS X client.",
      "pos": [
        1055,
        1145
      ]
    },
    {
      "content": "While these steps may be performed on a Windows-based client if you have installed a package that provides <ph id=\"ph1\">`ssh`</ph> and <ph id=\"ph2\">`ssh-keygen`</ph> (such as Git for Windows,) we recommend that Windows-based clients follow the steps in <bpt id=\"p1\">[</bpt>Use SSH with Linux-based HDInsight (Hadoop) from Windows<ept id=\"p1\">](hdinsight-hadoop-linux-use-ssh-windows.md)</ept>.",
      "pos": [
        1146,
        1465
      ]
    },
    {
      "content": "Prerequisites",
      "pos": [
        1469,
        1482
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>ssh-keygen<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>ssh<ept id=\"p2\">**</ept> for Linux, Unix, and OS X clients.",
      "pos": [
        1486,
        1547
      ]
    },
    {
      "content": "This utilities are usually provided with your operating system, or available through the package management system.",
      "pos": [
        1548,
        1663
      ]
    },
    {
      "content": "A modern web browser that supports HTML5.",
      "pos": [
        1667,
        1708
      ]
    },
    {
      "content": "OR",
      "pos": [
        1710,
        1712
      ]
    },
    {
      "pos": [
        1716,
        1772
      ],
      "content": "<bpt id=\"p1\">[</bpt>Azure CLI for Mac, Linux and Windows<ept id=\"p1\">](../xplat-cli.md)</ept>."
    },
    {
      "content": "What is SSH?",
      "pos": [
        1776,
        1788
      ]
    },
    {
      "content": "SSH is a utility for logging in to, and remotely executing, commands on a remote server.",
      "pos": [
        1790,
        1878
      ]
    },
    {
      "content": "With Linux-based HDInsight, SSH establishes an encrypted connection to the cluster head node and provides a command line that you use to type in commands.",
      "pos": [
        1879,
        2033
      ]
    },
    {
      "content": "Commands are then executed directly on the server.",
      "pos": [
        2034,
        2084
      ]
    },
    {
      "content": "Create an SSH key (optional)",
      "pos": [
        2088,
        2116
      ]
    },
    {
      "content": "When creating a Linux-based HDInsight cluster, you have the option of using a password or an SSH key to authenticate to the server when using SSH.",
      "pos": [
        2118,
        2264
      ]
    },
    {
      "content": "SSH keys are considered more secure, as they are certificate-based.",
      "pos": [
        2265,
        2332
      ]
    },
    {
      "content": "Use the following information if you plan on using SSH keys with your cluster.",
      "pos": [
        2333,
        2411
      ]
    },
    {
      "content": "Open a terminal session and use the following command to see if you have any existing SSH keys:",
      "pos": [
        2416,
        2511
      ]
    },
    {
      "content": "Look for the following files in the directory listing.",
      "pos": [
        2540,
        2594
      ]
    },
    {
      "content": "These are common names for public SSH keys.",
      "pos": [
        2595,
        2638
      ]
    },
    {
      "content": "id\\_dsa.pub",
      "pos": [
        2646,
        2657
      ]
    },
    {
      "content": "id\\_ecdsa.pub",
      "pos": [
        2664,
        2677
      ]
    },
    {
      "content": "id\\_ed25519.pub",
      "pos": [
        2684,
        2699
      ]
    },
    {
      "content": "id\\_rsa.pub",
      "pos": [
        2706,
        2717
      ]
    },
    {
      "content": "If you do not want to use an existing file, or you have no existing SSH keys, use the following to generate a new file:",
      "pos": [
        2722,
        2841
      ]
    },
    {
      "content": "You will be prompted for the following information:",
      "pos": [
        2874,
        2925
      ]
    },
    {
      "content": "The file location - The location defaults to ~/.ssh/id\\_rsa.",
      "pos": [
        2933,
        2993
      ]
    },
    {
      "content": "A passphrase - You will be prompted to re-enter this.",
      "pos": [
        3000,
        3053
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> We strongly recommend that you use a secure passphrase for the key.",
      "pos": [
        3065,
        3145
      ]
    },
    {
      "content": "However, if you forget the passphrase, there is no way to recover it.",
      "pos": [
        3146,
        3215
      ]
    },
    {
      "pos": [
        3221,
        3371
      ],
      "content": "After the command finishes, you will have two new files, the private key (for example, <bpt id=\"p1\">**</bpt>id\\_rsa<ept id=\"p1\">**</ept>) and the public key (for example, <bpt id=\"p2\">**</bpt>id\\_rsa.pub<ept id=\"p2\">**</ept>)."
    },
    {
      "content": "Create a Linux-based HDInsight cluster",
      "pos": [
        3375,
        3413
      ]
    },
    {
      "content": "When creating a Linux-based HDInsight cluster, you must provide the public key created previously.",
      "pos": [
        3415,
        3513
      ]
    },
    {
      "content": "From Linux, Unix, or OS X clients, there are two ways to create an HDInsight cluster:",
      "pos": [
        3514,
        3599
      ]
    },
    {
      "pos": [
        3603,
        3676
      ],
      "content": "<bpt id=\"p1\">**</bpt>Azure preview portal<ept id=\"p1\">**</ept> - Uses a web-based portal to create the cluster."
    },
    {
      "pos": [
        3680,
        3772
      ],
      "content": "<bpt id=\"p1\">**</bpt>Azure CLI for Mac, Linux and Windows<ept id=\"p1\">**</ept> - Uses command-line commands to create the cluster."
    },
    {
      "content": "Each of these methods will require either a password or a public key.",
      "pos": [
        3774,
        3843
      ]
    },
    {
      "content": "For complete information on creating a Linux-based HDInsight cluster, see <bpt id=\"p1\">[</bpt>Provision Linux-based HDInsight clusters<ept id=\"p1\">](hdinsight-hadoop-provision-linux-clusters.md)</ept>.",
      "pos": [
        3844,
        4007
      ]
    },
    {
      "content": "Azure preview portal",
      "pos": [
        4012,
        4032
      ]
    },
    {
      "pos": [
        4034,
        4225
      ],
      "content": "When using the <bpt id=\"p1\">[</bpt>Azure preview portal<ept id=\"p1\">][preview-portal]</ept> to create a Linux-based HDInsight cluster, you must enter an <bpt id=\"p2\">**</bpt>SSH USER NAME<ept id=\"p2\">**</ept>, and select to enter a <bpt id=\"p3\">**</bpt>PASSWORD<ept id=\"p3\">**</ept> or <bpt id=\"p4\">**</bpt>SSH PUBLIC KEY<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        4227,
        4452
      ],
      "content": "If you select <bpt id=\"p1\">**</bpt>SSH PUBLIC KEY<ept id=\"p1\">**</ept>, you can either paste the public key (contained in the file with the <bpt id=\"p2\">**</bpt>.pub<ept id=\"p2\">**</ept> extension) into the <bpt id=\"p3\">__</bpt>SSH PublicKey<ept id=\"p3\">__</ept> field, or select <bpt id=\"p4\">__</bpt>Select a file<ept id=\"p4\">__</ept> to browse and select the public key file."
    },
    {
      "content": "Image of form asking for public key",
      "pos": [
        4456,
        4491
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The key file is simply a text file.",
      "pos": [
        4553,
        4601
      ]
    },
    {
      "content": "The contents should appear similar to the following:",
      "pos": [
        4602,
        4654
      ]
    },
    {
      "content": "This creates a login for the specified user, by using the password or public key you provide.",
      "pos": [
        5061,
        5154
      ]
    },
    {
      "content": "Azure Command-Line Interface for Mac, Linux and Windows",
      "pos": [
        5159,
        5214
      ]
    },
    {
      "pos": [
        5216,
        5362
      ],
      "content": "You can use the <bpt id=\"p1\">[</bpt>Azure CLI for Mac, Linux and Windows<ept id=\"p1\">](../xplat.md)</ept> to create a new cluster by using the <ph id=\"ph1\">`azure hdinsight cluster create`</ph> command."
    },
    {
      "pos": [
        5364,
        5526
      ],
      "content": "For more information on using this command, see <bpt id=\"p1\">[</bpt>Provision Hadoop Linux clusters in HDInsight using custom options<ept id=\"p1\">](hdinsight-hadoop-provision-linux-clusters.md)</ept>."
    },
    {
      "content": "Connect to a Linux-based HDInsight cluster",
      "pos": [
        5530,
        5572
      ]
    },
    {
      "content": "From a terminal session, use the SSH command to connect to the cluster head node by providing the address and user name:",
      "pos": [
        5574,
        5694
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>SSH address<ept id=\"p1\">**</ept> - The cluster name, followed by <bpt id=\"p2\">**</bpt>-ssh.azurehdinsight.net<ept id=\"p2\">**</ept>.",
      "pos": [
        5698,
        5774
      ]
    },
    {
      "content": "For example, <bpt id=\"p1\">**</bpt>mycluster-ssh.azurehdinsight.net<ept id=\"p1\">**</ept>.",
      "pos": [
        5775,
        5825
      ]
    },
    {
      "pos": [
        5829,
        5905
      ],
      "content": "<bpt id=\"p1\">**</bpt>User name<ept id=\"p1\">**</ept> - The SSH user name you provided when you created the cluster."
    },
    {
      "pos": [
        5907,
        5990
      ],
      "content": "The following example will connect to the cluster <bpt id=\"p1\">**</bpt>mycluster<ept id=\"p1\">**</ept> as the user <bpt id=\"p2\">**</bpt>me<ept id=\"p2\">**</ept>:"
    },
    {
      "content": "If you used a password for the user account, you will be prompted to enter the password.",
      "pos": [
        6037,
        6125
      ]
    },
    {
      "content": "If you used an SSH key that is secured with a passphrase, you will be prompted to enter the passphrase.",
      "pos": [
        6127,
        6230
      ]
    },
    {
      "content": "Otherwise, SSH will attempt to automatically authenticate by using one of the local private keys on your client.",
      "pos": [
        6231,
        6343
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If SSH does not automatically authenticate with the correct private key, use the <bpt id=\"p1\">**</bpt>-i<ept id=\"p1\">**</ept> parameter and specify the path to the private key.",
      "pos": [
        6347,
        6498
      ]
    },
    {
      "content": "The following example will load the private key from <ph id=\"ph1\">`~/.ssh/id_rsa`</ph>:",
      "pos": [
        6499,
        6568
      ]
    },
    {
      "content": "If no port is specified, SSH will default to port 22, which will connect to headnode0 on the HDInsight cluster.",
      "pos": [
        6633,
        6744
      ]
    },
    {
      "content": "If you use port 23, you will connect to headnode1.",
      "pos": [
        6745,
        6795
      ]
    },
    {
      "content": "For more information on the head nodes, see <bpt id=\"p1\">[</bpt>Availability and reliability of Hadoop clusters in HDInsight<ept id=\"p1\">](hdinsight-high-availability-linux.md)</ept>.",
      "pos": [
        6796,
        6941
      ]
    },
    {
      "content": "Connect to worker nodes",
      "pos": [
        6946,
        6969
      ]
    },
    {
      "content": "The worker nodes are not directly accessible from outside the Azure datacenter, but they can be accessed from the cluster head node via SSH.",
      "pos": [
        6971,
        7111
      ]
    },
    {
      "content": "If you use an SSH key to authenticate your user account, you must complete the following steps on your client:",
      "pos": [
        7113,
        7223
      ]
    },
    {
      "content": "Using a text editor, open <ph id=\"ph1\">`~/.ssh/config`</ph>.",
      "pos": [
        7228,
        7270
      ]
    },
    {
      "content": "If this file doesn't exist, you can create it by entering <ph id=\"ph1\">`touch ~/.ssh/config`</ph> in the terminal.",
      "pos": [
        7271,
        7367
      ]
    },
    {
      "content": "Add the following to the file.",
      "pos": [
        7372,
        7402
      ]
    },
    {
      "content": "Replace <bpt id=\"p1\">*</bpt>CLUSTERNAME<ept id=\"p1\">*</ept> with the name of your HDInsight cluster.",
      "pos": [
        7403,
        7465
      ]
    },
    {
      "content": "This configures SSH agent forwarding for your HDInsight cluster.",
      "pos": [
        7547,
        7611
      ]
    },
    {
      "content": "Test SSH agent forwarding by using the following command from the terminal:",
      "pos": [
        7616,
        7691
      ]
    },
    {
      "content": "This should return information similar to the following:",
      "pos": [
        7728,
        7784
      ]
    },
    {
      "content": "If nothing is returned, this indicates that <bpt id=\"p1\">**</bpt>ssh-agent<ept id=\"p1\">**</ept> is not running.",
      "pos": [
        7832,
        7905
      ]
    },
    {
      "content": "Consult your operating system documentation for specific steps on installing and configuring <bpt id=\"p1\">**</bpt>ssh-agent<ept id=\"p1\">**</ept>, or see <bpt id=\"p2\">[</bpt>Using ssh-agent with ssh<ept id=\"p2\">](http://mah.everybody.org/docs/ssh)</ept>.",
      "pos": [
        7906,
        8083
      ]
    },
    {
      "pos": [
        8088,
        8201
      ],
      "content": "Once you have verified that <bpt id=\"p1\">**</bpt>ssh-agent<ept id=\"p1\">**</ept> is running, use the following to add your SSH private key to the agent:"
    },
    {
      "pos": [
        8238,
        8339
      ],
      "content": "If your private key is stored in a different file, replace <ph id=\"ph1\">`~/.ssh/id_rsa`</ph> with the path to the file."
    },
    {
      "content": "Use the following steps to connect to the worker nodes for your cluster.",
      "pos": [
        8341,
        8413
      ]
    },
    {
      "pos": [
        8417,
        8567
      ],
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> If you use an SSH key to authenticate your account, you must complete the previous steps to verify that agent forwarding is working."
    },
    {
      "content": "Connect to the HDInsight cluster by using SSH as described previously.",
      "pos": [
        8572,
        8642
      ]
    },
    {
      "content": "Once you are connected, use the following to retrieve a list of the nodes in your cluster.",
      "pos": [
        8647,
        8737
      ]
    },
    {
      "content": "Replace <bpt id=\"p1\">*</bpt>ADMINPASSWORD<ept id=\"p1\">*</ept> with the password for your cluster admin account.",
      "pos": [
        8738,
        8811
      ]
    },
    {
      "content": "Replace <bpt id=\"p1\">*</bpt>CLUSTERNAME<ept id=\"p1\">*</ept> with the name of your cluster.",
      "pos": [
        8812,
        8864
      ]
    },
    {
      "content": "This will return information in JSON format for the nodes in the cluster, including <ph id=\"ph1\">`host_name`</ph>, which contains the fully qualified domain name (FQDN) for each node.",
      "pos": [
        8963,
        9128
      ]
    },
    {
      "content": "The following is an example of a <ph id=\"ph1\">`host_name`</ph> entry returned by the <bpt id=\"p1\">**</bpt>curl<ept id=\"p1\">**</ept> command:",
      "pos": [
        9129,
        9213
      ]
    },
    {
      "content": "Once you have a list of the worker nodes you want to connect to, use the following command from the SSH session to the server to open a connection to a worker node:",
      "pos": [
        9326,
        9490
      ]
    },
    {
      "content": "Replace <bpt id=\"p1\">*</bpt>USERNAME<ept id=\"p1\">*</ept> with your SSH user name and <bpt id=\"p2\">*</bpt>FQDN<ept id=\"p2\">*</ept> with the FQDN for the worker node.",
      "pos": [
        9523,
        9611
      ]
    },
    {
      "content": "For example, <ph id=\"ph1\">`workernode0.workernode-0-e2f35e63355b4f15a31c460b6d4e1230.j1.internal.cloudapp.net`</ph>.",
      "pos": [
        9612,
        9710
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you use a password to authentication your SSH session, you will be prompted to enter the password again.",
      "pos": [
        9718,
        9838
      ]
    },
    {
      "content": "If you use an SSH key, the connection should finish without any prompts.",
      "pos": [
        9839,
        9911
      ]
    },
    {
      "content": "Once the session has been established, the terminal prompt will change from <ph id=\"ph1\">`username@headnode`</ph> to <ph id=\"ph2\">`username@workernode`</ph> to indicate that you are connected to the worker node.",
      "pos": [
        9916,
        10091
      ]
    },
    {
      "content": "Any commands you run at this point will run on the worker node.",
      "pos": [
        10092,
        10155
      ]
    },
    {
      "content": "Once you have finished performing actions on the worker node, use the <ph id=\"ph1\">`exit`</ph> command to close the session to the worker node.",
      "pos": [
        10160,
        10285
      ]
    },
    {
      "content": "This will return you to the <ph id=\"ph1\">`username@headnode`</ph> prompt.",
      "pos": [
        10286,
        10341
      ]
    },
    {
      "content": "Add more accounts",
      "pos": [
        10345,
        10362
      ]
    },
    {
      "pos": [
        10367,
        10512
      ],
      "content": "Generate a new public key and private key for the new user account, as described in the <bpt id=\"p1\">[</bpt>Create an SSH key<ept id=\"p1\">](#create-an-ssh-key-optional)</ept> section."
    },
    {
      "pos": [
        10520,
        10694
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The private key should either be generated on a client that the user will use to connect to the cluster, or securely transferred to such a client after creation."
    },
    {
      "content": "From an SSH session to the cluster, add the new user with the following command:",
      "pos": [
        10699,
        10779
      ]
    },
    {
      "content": "This will create a new user account, but will disable password authentication.",
      "pos": [
        10838,
        10916
      ]
    },
    {
      "content": "Create the directory and files to hold the key by using the following commands:",
      "pos": [
        10921,
        11000
      ]
    },
    {
      "content": "When the nano editor opens, copy and paste in the contents of the public key for the new user account.",
      "pos": [
        11163,
        11265
      ]
    },
    {
      "content": "Finally, use <bpt id=\"p1\">**</bpt>Ctrl-X<ept id=\"p1\">**</ept> to save the file and exit the editor.",
      "pos": [
        11266,
        11327
      ]
    },
    {
      "content": "image of nano editor with example key",
      "pos": [
        11335,
        11372
      ]
    },
    {
      "content": "Use the following command to change ownership of the .ssh folder and contents to the new user account:",
      "pos": [
        11432,
        11534
      ]
    },
    {
      "content": "You should now be able to authenticate to the server with the new user account and private key.",
      "pos": [
        11607,
        11702
      ]
    },
    {
      "pos": [
        11706,
        11738
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"tunnel\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>SSH tunneling"
    },
    {
      "content": "SSH can be used to tunnel local requests, such as web requests, to the HDInsight cluster.",
      "pos": [
        11740,
        11829
      ]
    },
    {
      "content": "The request will then be routed to the requested resource as if it had originated on the HDInsight cluster head node.",
      "pos": [
        11830,
        11947
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> An SSH tunnel is a requirement for accessing the web UI for sopme Hadoop services.",
      "pos": [
        11951,
        12051
      ]
    },
    {
      "content": "For example, both the Job History UI or Resource Manager UI can only be accessed using an SSH tunnel.",
      "pos": [
        12052,
        12153
      ]
    },
    {
      "content": "Use the following steps to create an SSH tunnel and configure your browser to use it to connect to the cluster.",
      "pos": [
        12155,
        12266
      ]
    },
    {
      "content": "The following command can be used to create an SSH tunnel to the cluster head node:",
      "pos": [
        12271,
        12354
      ]
    },
    {
      "content": "This creates a connection that routes traffic to local port 9876 to the cluster over SSH.",
      "pos": [
        12434,
        12523
      ]
    },
    {
      "content": "The options are:",
      "pos": [
        12524,
        12540
      ]
    },
    {
      "pos": [
        12548,
        12619
      ],
      "content": "<bpt id=\"p1\">**</bpt>D 8080<ept id=\"p1\">**</ept> - The local port that will route traffic through the tunnel."
    },
    {
      "pos": [
        12627,
        12689
      ],
      "content": "<bpt id=\"p1\">**</bpt>C<ept id=\"p1\">**</ept> - Compress all data, because web traffic is mostly text."
    },
    {
      "pos": [
        12697,
        12746
      ],
      "content": "<bpt id=\"p1\">**</bpt>2<ept id=\"p1\">**</ept> - Force SSH to try protocol version 2 only."
    },
    {
      "pos": [
        12754,
        12773
      ],
      "content": "<bpt id=\"p1\">**</bpt>q<ept id=\"p1\">**</ept> - Quiet mode."
    },
    {
      "pos": [
        12781,
        12856
      ],
      "content": "<bpt id=\"p1\">**</bpt>T<ept id=\"p1\">**</ept> - Disable pseudo-tty allocation, since we are just forwarding a port."
    },
    {
      "pos": [
        12864,
        12934
      ],
      "content": "<bpt id=\"p1\">**</bpt>n<ept id=\"p1\">**</ept> - Prevent reading of STDIN, since we are just forwarding a port."
    },
    {
      "pos": [
        12942,
        13019
      ],
      "content": "<bpt id=\"p1\">**</bpt>N<ept id=\"p1\">**</ept> - Do not execute a remote command, since we are just forwarding a port."
    },
    {
      "pos": [
        13027,
        13057
      ],
      "content": "<bpt id=\"p1\">**</bpt>f<ept id=\"p1\">**</ept> - Run in the background."
    },
    {
      "pos": [
        13063,
        13190
      ],
      "content": "If you configured the cluster with an SSH key, you may need use the <ph id=\"ph1\">`-i`</ph> parameter and specify the path to the private SSH key."
    },
    {
      "content": "Once the command finishes, traffic sent to port 9876 on the local computer will be routed over Secure Sockets Layer (SSL) to the cluster head node and appear to originate there.",
      "pos": [
        13196,
        13373
      ]
    },
    {
      "content": "Configure the client program, such as Firefox, to use <bpt id=\"p1\">**</bpt>localhost:9876<ept id=\"p1\">**</ept> as a <bpt id=\"p2\">**</bpt>SOCKS v5<ept id=\"p2\">**</ept> proxy.",
      "pos": [
        13378,
        13475
      ]
    },
    {
      "content": "Here's what the Firefox settings look like:",
      "pos": [
        13476,
        13519
      ]
    },
    {
      "content": "image of Firefox settings",
      "pos": [
        13527,
        13552
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Selecting <bpt id=\"p1\">**</bpt>Remote DNS<ept id=\"p1\">**</ept> will resolve Domain Name System (DNS) requests by using the HDInsight cluster.",
      "pos": [
        13616,
        13732
      ]
    },
    {
      "content": "If this is unselected, DNS will be resolved locally.",
      "pos": [
        13733,
        13785
      ]
    },
    {
      "content": "You can verify that traffic is being routed through the tunnel by vising a site such as <bpt id=\"p1\">[</bpt>http://www.whatismyip.com/<ept id=\"p1\">](http://www.whatismyip.com/)</ept> with the proxy settings enabled and disabled in Firefox.",
      "pos": [
        13791,
        13992
      ]
    },
    {
      "content": "While the settings are enabled, the IP address will be for a machine in the Microsoft Azure datacenter.",
      "pos": [
        13993,
        14096
      ]
    },
    {
      "content": "Browser extensions",
      "pos": [
        14101,
        14119
      ]
    },
    {
      "content": "While configuring the browser to use the tunnel works, you don't usually want to route all traffic over the tunnel.",
      "pos": [
        14121,
        14236
      ]
    },
    {
      "content": "Browser extensions such as <bpt id=\"p1\">[</bpt>FoxyProxy<ept id=\"p1\">](http://getfoxyproxy.org/)</ept> support pattern matching for URL requests (FoxyProxy Standard or Plus only), so that only requests for specific URLs will be sent over the tunnel.",
      "pos": [
        14237,
        14448
      ]
    },
    {
      "content": "If you have installed FoxyProxy Standard, use the following steps to configure it to only forward traffic for HDInsight over the tunnel:",
      "pos": [
        14450,
        14586
      ]
    },
    {
      "content": "Open the FoxyProxy extension in your browser.",
      "pos": [
        14591,
        14636
      ]
    },
    {
      "content": "For example, in Firefox, select the FoxyProxy icon next to the address field.",
      "pos": [
        14637,
        14714
      ]
    },
    {
      "content": "foxyproxy icon",
      "pos": [
        14722,
        14736
      ]
    },
    {
      "pos": [
        14801,
        14905
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Add New Proxy<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>General<ept id=\"p2\">**</ept> tab, and then enter a proxy name of <bpt id=\"p3\">**</bpt>HDInsightProxy<ept id=\"p3\">**</ept>."
    },
    {
      "content": "foxyproxy general",
      "pos": [
        14913,
        14930
      ]
    },
    {
      "pos": [
        14997,
        15064
      ],
      "content": "Select the <bpt id=\"p1\">**</bpt>Proxy Details<ept id=\"p1\">**</ept> tab and populate the following fields:"
    },
    {
      "pos": [
        15072,
        15170
      ],
      "content": "<bpt id=\"p1\">**</bpt>Host or IP Address<ept id=\"p1\">**</ept> - This is localhost, since we are using an SSH tunnel on the local machine."
    },
    {
      "pos": [
        15178,
        15234
      ],
      "content": "<bpt id=\"p1\">**</bpt>Port<ept id=\"p1\">**</ept> - This is the port you used for the SSH tunnel."
    },
    {
      "pos": [
        15242,
        15323
      ],
      "content": "<bpt id=\"p1\">**</bpt>SOCKS proxy<ept id=\"p1\">**</ept> - Select this to enable the browser to use the tunnel as a proxy."
    },
    {
      "pos": [
        15331,
        15400
      ],
      "content": "<bpt id=\"p1\">**</bpt>SOCKS v5<ept id=\"p1\">**</ept> - Select this to set the required version for the proxy."
    },
    {
      "content": "foxyproxy proxy",
      "pos": [
        15408,
        15423
      ]
    },
    {
      "content": "Select the <bpt id=\"p1\">**</bpt>URL Patterns<ept id=\"p1\">**</ept> tab, and then select <bpt id=\"p2\">**</bpt>Add New Pattern<ept id=\"p2\">**</ept>.",
      "pos": [
        15493,
        15562
      ]
    },
    {
      "content": "Use the following to define the pattern, and then click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>:",
      "pos": [
        15563,
        15626
      ]
    },
    {
      "pos": [
        15634,
        15713
      ],
      "content": "<bpt id=\"p1\">**</bpt>Pattern Name<ept id=\"p1\">**</ept> - <bpt id=\"p2\">**</bpt>headnode<ept id=\"p2\">**</ept> - This is just a friendly name for the pattern."
    },
    {
      "pos": [
        15721,
        15835
      ],
      "content": "<bpt id=\"p1\">**</bpt>URL pattern<ept id=\"p1\">**</ept> - <bpt id=\"p2\">**</bpt>\\*headnode\\*<ept id=\"p2\">**</ept> - This defines a pattern that matches any URL with the word <bpt id=\"p3\">**</bpt>headnode<ept id=\"p3\">**</ept> in it."
    },
    {
      "content": "foxyproxy pattern",
      "pos": [
        15843,
        15860
      ]
    },
    {
      "pos": [
        15927,
        15986
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to add the proxy and close <bpt id=\"p2\">**</bpt>Proxy Settings<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        15991,
        16146
      ],
      "content": "At the top of the FoxyProxy dialog, change <bpt id=\"p1\">**</bpt>Select Mode<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>Use proxies based on their pre-defined patterns and priorities<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Close<ept id=\"p3\">**</ept>."
    },
    {
      "content": "foxyproxy select mode",
      "pos": [
        16154,
        16175
      ]
    },
    {
      "pos": [
        16238,
        16362
      ],
      "content": "After following these steps, only requests for URLs that contain the string <bpt id=\"p1\">**</bpt>headnode<ept id=\"p1\">**</ept> will be routed over the SSL tunnel."
    },
    {
      "content": "Next steps",
      "pos": [
        16366,
        16376
      ]
    },
    {
      "content": "Now that you understand how to authenticate by using an SSH key, learn how to use MapReduce with Hadoop on HDInsight.",
      "pos": [
        16378,
        16495
      ]
    },
    {
      "content": "Use Hive with HDInsight",
      "pos": [
        16500,
        16523
      ]
    },
    {
      "content": "Use Pig with HDInsight",
      "pos": [
        16552,
        16574
      ]
    },
    {
      "content": "Use MapReduce jobs with HDInsight",
      "pos": [
        16602,
        16635
      ]
    },
    {
      "content": "test",
      "pos": [
        16666,
        16670
      ]
    }
  ],
  "content": "<properties\n   pageTitle=\"Use SSH keys with  Linux-based Hadoop from Linux, Unix, or OS X | Microsoft Azure\"\n   description=\" You can access Linux-based HDInsight using Secure Shell (SSH). This document provides information on using SSH with HDInsight from Linux, Unix, or OS X clients.\"\n   services=\"hdinsight\"\n   documentationCenter=\"\"\n   authors=\"Blackmist\"\n   manager=\"paulettm\"\n   editor=\"cgronlun\"\n    tags=\"azure-portal\"/>\n\n<tags\n   ms.service=\"hdinsight\"\n   ms.devlang=\"na\"\n   ms.topic=\"article\"\n   ms.tgt_pltfrm=\"na\"\n   ms.workload=\"big-data\"\n   ms.date=\"07/24/2015\"\n   ms.author=\"larryfr\"/>\n\n#Use SSH with Linux-based Hadoop on HDInsight from Linux, Unix, or OS X (preview)\n\n> [AZURE.SELECTOR]\n- [Windows](hdinsight-hadoop-linux-use-ssh-windows.md)\n- [Linux, Unix, OS X](hdinsight-hadoop-linux-use-ssh-unix.md)\n\nLinux-based Azure HDInsight clusters provide the option of using Secure Shell (SSH) access through either a password or an SSH key. This document provides information on using SSH with HDInsight from Linux, Unix, or OS X clients.\n\n> [AZURE.NOTE] The steps in this article assume you are using a Linux, Unix, or OS X client. While these steps may be performed on a Windows-based client if you have installed a package that provides `ssh` and `ssh-keygen` (such as Git for Windows,) we recommend that Windows-based clients follow the steps in [Use SSH with Linux-based HDInsight (Hadoop) from Windows](hdinsight-hadoop-linux-use-ssh-windows.md).\n\n##Prerequisites\n\n* **ssh-keygen** and **ssh** for Linux, Unix, and OS X clients. This utilities are usually provided with your operating system, or available through the package management system.\n\n* A modern web browser that supports HTML5.\n\nOR\n\n* [Azure CLI for Mac, Linux and Windows](../xplat-cli.md).\n\n##What is SSH?\n\nSSH is a utility for logging in to, and remotely executing, commands on a remote server. With Linux-based HDInsight, SSH establishes an encrypted connection to the cluster head node and provides a command line that you use to type in commands. Commands are then executed directly on the server.\n\n##Create an SSH key (optional)\n\nWhen creating a Linux-based HDInsight cluster, you have the option of using a password or an SSH key to authenticate to the server when using SSH. SSH keys are considered more secure, as they are certificate-based. Use the following information if you plan on using SSH keys with your cluster.\n\n1. Open a terminal session and use the following command to see if you have any existing SSH keys:\n\n        ls -al ~/.ssh\n\n    Look for the following files in the directory listing. These are common names for public SSH keys.\n\n    * id\\_dsa.pub\n    * id\\_ecdsa.pub\n    * id\\_ed25519.pub\n    * id\\_rsa.pub\n\n2. If you do not want to use an existing file, or you have no existing SSH keys, use the following to generate a new file:\n\n        ssh-keygen -t rsa\n\n    You will be prompted for the following information:\n\n    * The file location - The location defaults to ~/.ssh/id\\_rsa.\n    * A passphrase - You will be prompted to re-enter this.\n\n        > [AZURE.NOTE] We strongly recommend that you use a secure passphrase for the key. However, if you forget the passphrase, there is no way to recover it.\n\n    After the command finishes, you will have two new files, the private key (for example, **id\\_rsa**) and the public key (for example, **id\\_rsa.pub**).\n\n##Create a Linux-based HDInsight cluster\n\nWhen creating a Linux-based HDInsight cluster, you must provide the public key created previously. From Linux, Unix, or OS X clients, there are two ways to create an HDInsight cluster:\n\n* **Azure preview portal** - Uses a web-based portal to create the cluster.\n\n* **Azure CLI for Mac, Linux and Windows** - Uses command-line commands to create the cluster.\n\nEach of these methods will require either a password or a public key. For complete information on creating a Linux-based HDInsight cluster, see [Provision Linux-based HDInsight clusters](hdinsight-hadoop-provision-linux-clusters.md).\n\n###Azure preview portal\n\nWhen using the [Azure preview portal][preview-portal] to create a Linux-based HDInsight cluster, you must enter an **SSH USER NAME**, and select to enter a **PASSWORD** or **SSH PUBLIC KEY**.\n\nIf you select **SSH PUBLIC KEY**, you can either paste the public key (contained in the file with the **.pub** extension) into the __SSH PublicKey__ field, or select __Select a file__ to browse and select the public key file.\n\n![Image of form asking for public key](./media/hdinsight-hadoop-linux-use-ssh-unix/ssh-key.png)\n\n> [AZURE.NOTE] The key file is simply a text file. The contents should appear similar to the following:\n> ```\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCelfkjrpYHYiks4TM+r1LVsTYQ4jAXXGeOAF9Vv/KGz90pgMk3VRJk4PEUSELfXKxP3NtsVwLVPN1l09utI/tKHQ6WL3qy89WVVVLiwzL7tfJ2B08Gmcw8mC/YoieT/YG+4I4oAgPEmim+6/F9S0lU2I2CuFBX9JzauX8n1Y9kWzTARST+ERx2hysyA5ObLv97Xe4C2CQvGE01LGAXkw2ffP9vI+emUM+VeYrf0q3w/b1o/COKbFVZ2IpEcJ8G2SLlNsHWXofWhOKQRi64TMxT7LLoohD61q2aWNKdaE4oQdiuo8TGnt4zWLEPjzjIYIEIZGk00HiQD+KCB5pxoVtp user@system\n> ```\n\nThis creates a login for the specified user, by using the password or public key you provide.\n\n###Azure Command-Line Interface for Mac, Linux and Windows\n\nYou can use the [Azure CLI for Mac, Linux and Windows](../xplat.md) to create a new cluster by using the `azure hdinsight cluster create` command.\n\nFor more information on using this command, see [Provision Hadoop Linux clusters in HDInsight using custom options](hdinsight-hadoop-provision-linux-clusters.md).\n\n##Connect to a Linux-based HDInsight cluster\n\nFrom a terminal session, use the SSH command to connect to the cluster head node by providing the address and user name:\n\n* **SSH address** - The cluster name, followed by **-ssh.azurehdinsight.net**. For example, **mycluster-ssh.azurehdinsight.net**.\n\n* **User name** - The SSH user name you provided when you created the cluster.\n\nThe following example will connect to the cluster **mycluster** as the user **me**:\n\n    ssh me@mycluster-ssh.azurehdinsight.net\n\nIf you used a password for the user account, you will be prompted to enter the password.\n\nIf you used an SSH key that is secured with a passphrase, you will be prompted to enter the passphrase. Otherwise, SSH will attempt to automatically authenticate by using one of the local private keys on your client.\n\n> [AZURE.NOTE] If SSH does not automatically authenticate with the correct private key, use the **-i** parameter and specify the path to the private key. The following example will load the private key from `~/.ssh/id_rsa`:\n>\n> `ssh -i ~/.ssh/id_rsa me@mycluster-ssh.azurehdinsight.net`\n\nIf no port is specified, SSH will default to port 22, which will connect to headnode0 on the HDInsight cluster. If you use port 23, you will connect to headnode1. For more information on the head nodes, see [Availability and reliability of Hadoop clusters in HDInsight](hdinsight-high-availability-linux.md).\n\n###Connect to worker nodes\n\nThe worker nodes are not directly accessible from outside the Azure datacenter, but they can be accessed from the cluster head node via SSH.\n\nIf you use an SSH key to authenticate your user account, you must complete the following steps on your client:\n\n1. Using a text editor, open `~/.ssh/config`. If this file doesn't exist, you can create it by entering `touch ~/.ssh/config` in the terminal.\n\n2. Add the following to the file. Replace *CLUSTERNAME* with the name of your HDInsight cluster.\n\n        Host CLUSTERNAME-ssh.azurehdinsight.net\n          ForwardAgent yes\n\n    This configures SSH agent forwarding for your HDInsight cluster.\n\n3. Test SSH agent forwarding by using the following command from the terminal:\n\n        echo \"$SSH_AUTH_SOCK\"\n\n    This should return information similar to the following:\n\n        /tmp/ssh-rfSUL1ldCldQ/agent.1792\n\n    If nothing is returned, this indicates that **ssh-agent** is not running. Consult your operating system documentation for specific steps on installing and configuring **ssh-agent**, or see [Using ssh-agent with ssh](http://mah.everybody.org/docs/ssh).\n\n4. Once you have verified that **ssh-agent** is running, use the following to add your SSH private key to the agent:\n\n        ssh-add ~/.ssh/id_rsa\n\n    If your private key is stored in a different file, replace `~/.ssh/id_rsa` with the path to the file.\n\nUse the following steps to connect to the worker nodes for your cluster.\n\n> [AZURE.IMPORTANT] If you use an SSH key to authenticate your account, you must complete the previous steps to verify that agent forwarding is working.\n\n1. Connect to the HDInsight cluster by using SSH as described previously.\n\n2. Once you are connected, use the following to retrieve a list of the nodes in your cluster. Replace *ADMINPASSWORD* with the password for your cluster admin account. Replace *CLUSTERNAME* with the name of your cluster.\n\n        curl --user admin:ADMINPASSWORD https://CLUSTERNAME.azurehdinsight.net/api/v1/hosts\n\n    This will return information in JSON format for the nodes in the cluster, including `host_name`, which contains the fully qualified domain name (FQDN) for each node. The following is an example of a `host_name` entry returned by the **curl** command:\n\n        \"host_name\" : \"workernode0.workernode-0-e2f35e63355b4f15a31c460b6d4e1230.j1.internal.cloudapp.net\"\n\n3. Once you have a list of the worker nodes you want to connect to, use the following command from the SSH session to the server to open a connection to a worker node:\n\n        ssh USERNAME@FQDN\n\n    Replace *USERNAME* with your SSH user name and *FQDN* with the FQDN for the worker node. For example, `workernode0.workernode-0-e2f35e63355b4f15a31c460b6d4e1230.j1.internal.cloudapp.net`.\n\n    > [AZURE.NOTE] If you use a password to authentication your SSH session, you will be prompted to enter the password again. If you use an SSH key, the connection should finish without any prompts.\n\n4. Once the session has been established, the terminal prompt will change from `username@headnode` to `username@workernode` to indicate that you are connected to the worker node. Any commands you run at this point will run on the worker node.\n\n4. Once you have finished performing actions on the worker node, use the `exit` command to close the session to the worker node. This will return you to the `username@headnode` prompt.\n\n##Add more accounts\n\n1. Generate a new public key and private key for the new user account, as described in the [Create an SSH key](#create-an-ssh-key-optional) section.\n\n    > [AZURE.NOTE] The private key should either be generated on a client that the user will use to connect to the cluster, or securely transferred to such a client after creation.\n\n1. From an SSH session to the cluster, add the new user with the following command:\n\n        sudo adduser --disabled-password <username>\n\n    This will create a new user account, but will disable password authentication.\n\n2. Create the directory and files to hold the key by using the following commands:\n\n        sudo mkdir -p /home/<username>/.ssh\n        sudo touch /home/<username>/.ssh/authorized_keys\n        sudo nano /home/<username>/.ssh/authorized_keys\n\n3. When the nano editor opens, copy and paste in the contents of the public key for the new user account. Finally, use **Ctrl-X** to save the file and exit the editor.\n\n    ![image of nano editor with example key](./media/hdinsight-hadoop-linux-use-ssh-unix/nano.png)\n\n4. Use the following command to change ownership of the .ssh folder and contents to the new user account:\n\n        sudo chown -hR <username>:<username> /home/<username>/.ssh\n\n5. You should now be able to authenticate to the server with the new user account and private key.\n\n##<a id=\"tunnel\"></a>SSH tunneling\n\nSSH can be used to tunnel local requests, such as web requests, to the HDInsight cluster. The request will then be routed to the requested resource as if it had originated on the HDInsight cluster head node.\n\n> [AZURE.IMPORTANT] An SSH tunnel is a requirement for accessing the web UI for sopme Hadoop services. For example, both the Job History UI or Resource Manager UI can only be accessed using an SSH tunnel.\n\nUse the following steps to create an SSH tunnel and configure your browser to use it to connect to the cluster.\n\n1. The following command can be used to create an SSH tunnel to the cluster head node:\n\n        ssh -C2qTnNf -D 9876 username@clustername-ssh.azurehdinsight.net\n\n    This creates a connection that routes traffic to local port 9876 to the cluster over SSH. The options are:\n\n    * **D 8080** - The local port that will route traffic through the tunnel.\n\n    * **C** - Compress all data, because web traffic is mostly text.\n\n    * **2** - Force SSH to try protocol version 2 only.\n\n    * **q** - Quiet mode.\n\n    * **T** - Disable pseudo-tty allocation, since we are just forwarding a port.\n\n    * **n** - Prevent reading of STDIN, since we are just forwarding a port.\n\n    * **N** - Do not execute a remote command, since we are just forwarding a port.\n\n    * **f** - Run in the background.\n\n    If you configured the cluster with an SSH key, you may need use the `-i` parameter and specify the path to the private SSH key.\n\n    Once the command finishes, traffic sent to port 9876 on the local computer will be routed over Secure Sockets Layer (SSL) to the cluster head node and appear to originate there.\n\n2. Configure the client program, such as Firefox, to use **localhost:9876** as a **SOCKS v5** proxy. Here's what the Firefox settings look like:\n\n    ![image of Firefox settings](./media/hdinsight-hadoop-linux-use-ssh-unix/socks.png)\n\n    > [AZURE.NOTE] Selecting **Remote DNS** will resolve Domain Name System (DNS) requests by using the HDInsight cluster. If this is unselected, DNS will be resolved locally.\n\n    You can verify that traffic is being routed through the tunnel by vising a site such as [http://www.whatismyip.com/](http://www.whatismyip.com/) with the proxy settings enabled and disabled in Firefox. While the settings are enabled, the IP address will be for a machine in the Microsoft Azure datacenter.\n\n###Browser extensions\n\nWhile configuring the browser to use the tunnel works, you don't usually want to route all traffic over the tunnel. Browser extensions such as [FoxyProxy](http://getfoxyproxy.org/) support pattern matching for URL requests (FoxyProxy Standard or Plus only), so that only requests for specific URLs will be sent over the tunnel.\n\nIf you have installed FoxyProxy Standard, use the following steps to configure it to only forward traffic for HDInsight over the tunnel:\n\n1. Open the FoxyProxy extension in your browser. For example, in Firefox, select the FoxyProxy icon next to the address field.\n\n    ![foxyproxy icon](./media/hdinsight-hadoop-linux-use-ssh-unix/foxyproxy.png)\n\n2. Select **Add New Proxy**, select the **General** tab, and then enter a proxy name of **HDInsightProxy**.\n\n    ![foxyproxy general](./media/hdinsight-hadoop-linux-use-ssh-unix/foxygeneral.png)\n\n3. Select the **Proxy Details** tab and populate the following fields:\n\n    * **Host or IP Address** - This is localhost, since we are using an SSH tunnel on the local machine.\n\n    * **Port** - This is the port you used for the SSH tunnel.\n\n    * **SOCKS proxy** - Select this to enable the browser to use the tunnel as a proxy.\n\n    * **SOCKS v5** - Select this to set the required version for the proxy.\n\n    ![foxyproxy proxy](./media/hdinsight-hadoop-linux-use-ssh-unix/foxyproxyproxy.png)\n\n4. Select the **URL Patterns** tab, and then select **Add New Pattern**. Use the following to define the pattern, and then click **OK**:\n\n    * **Pattern Name** - **headnode** - This is just a friendly name for the pattern.\n\n    * **URL pattern** - **\\*headnode\\*** - This defines a pattern that matches any URL with the word **headnode** in it.\n\n    ![foxyproxy pattern](./media/hdinsight-hadoop-linux-use-ssh-unix/foxypattern.png)\n\n4. Click **OK** to add the proxy and close **Proxy Settings**.\n\n5. At the top of the FoxyProxy dialog, change **Select Mode** to **Use proxies based on their pre-defined patterns and priorities**, and then click **Close**.\n\n    ![foxyproxy select mode](./media/hdinsight-hadoop-linux-use-ssh-unix/selectmode.png)\n\nAfter following these steps, only requests for URLs that contain the string **headnode** will be routed over the SSL tunnel.\n\n##Next steps\n\nNow that you understand how to authenticate by using an SSH key, learn how to use MapReduce with Hadoop on HDInsight.\n\n* [Use Hive with HDInsight](hdinsight-use-hive.md)\n\n* [Use Pig with HDInsight](hdinsight-use-pig.md)\n\n* [Use MapReduce jobs with HDInsight](hdinsight-use-mapreduce.md)\n\n[preview-portal]: https://portal.azure.com/\ntest\n"
}