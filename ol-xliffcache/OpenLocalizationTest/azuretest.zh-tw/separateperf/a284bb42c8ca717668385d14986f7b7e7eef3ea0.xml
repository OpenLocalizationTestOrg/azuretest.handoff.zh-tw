{
  "nodes": [
    {
      "content": "Using Azure PowerShell with Azure Storage | Microsoft Azure",
      "pos": [
        27,
        86
      ]
    },
    {
      "content": "Learn how to use the Azure PowerShell cmdlets for Azure Storage to create and manage storage accounts; work with blobs, tables, queues, and files; configure and query storage analytics, and create shared access signatures.",
      "pos": [
        105,
        327
      ]
    },
    {
      "content": "Using Azure PowerShell with Azure Storage",
      "pos": [
        604,
        645
      ]
    },
    {
      "content": "Overview",
      "pos": [
        650,
        658
      ]
    },
    {
      "pos": [
        660,
        887
      ],
      "content": "In this guide, we’ll explore how to use the <bpt id=\"p1\">[</bpt>Azure Service Management Cmdlets for Storage<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/dn806401.aspx)</ept> to perform a variety of development and administration tasks with Azure Storage."
    },
    {
      "content": "Azure PowerShell is a module that provides cmdlets to manage Azure through Windows PowerShell.",
      "pos": [
        889,
        983
      ]
    },
    {
      "content": "It is a task-based command-line shell and scripting language designed especially for system administration.",
      "pos": [
        984,
        1091
      ]
    },
    {
      "content": "With PowerShell, you can easily control and automate the administration of your Azure services and applications.",
      "pos": [
        1092,
        1204
      ]
    },
    {
      "content": "For example, you can use the cmdlets to perform the same tasks that you can perform through the Azure Management Portal.",
      "pos": [
        1205,
        1325
      ]
    },
    {
      "content": "This guide assumes that you have prior experience using <bpt id=\"p1\">[</bpt>Azure Storage<ept id=\"p1\">](http://azure.microsoft.com/documentation/services/storage/)</ept> and <bpt id=\"p2\">[</bpt>Windows PowerShell<ept id=\"p2\">](http://technet.microsoft.com/library/bb978526.aspx)</ept>.",
      "pos": [
        1327,
        1536
      ]
    },
    {
      "content": "The guide provides a number of scripts to demonstrate the usage of PowerShell with Azure Storage.",
      "pos": [
        1537,
        1634
      ]
    },
    {
      "content": "You should update the script variables based on your configuration before running each script.",
      "pos": [
        1635,
        1729
      ]
    },
    {
      "content": "The first section in this guide provides a quick glance at Azure Storage and PowerShell.",
      "pos": [
        1731,
        1819
      ]
    },
    {
      "content": "For detailed information and instructions, start from the <bpt id=\"p1\">[</bpt>Prerequisites for using Azure PowerShell with Azure Storage<ept id=\"p1\">](#prerequisites-for-using-azure-powershell-with-azure-storage)</ept>.",
      "pos": [
        1820,
        2002
      ]
    },
    {
      "content": "Getting started with Azure Storage and PowerShell in 5 minutes",
      "pos": [
        2008,
        2070
      ]
    },
    {
      "content": "This section shows you how to access Azure Storage via PowerShell in 5 minutes.",
      "pos": [
        2072,
        2151
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>New to Azure:<ept id=\"p1\">**</ept> Get a Microsoft Azure subscription and a Microsoft account associated with that subscription.",
      "pos": [
        2153,
        2264
      ]
    },
    {
      "content": "For information on Azure purchase options, see <bpt id=\"p1\">[</bpt>Free Trial<ept id=\"p1\">](http://azure.microsoft.com/pricing/free-trial/)</ept>, <bpt id=\"p2\">[</bpt>Purchase Options<ept id=\"p2\">](http://azure.microsoft.com/pricing/purchase-options/)</ept>, and <bpt id=\"p3\">[</bpt>Member Offers<ept id=\"p3\">](http://azure.microsoft.com/pricing/member-offers/)</ept> (for members of MSDN, Microsoft Partner Network, and BizSpark, and other Microsoft programs).",
      "pos": [
        2265,
        2612
      ]
    },
    {
      "pos": [
        2614,
        2780
      ],
      "content": "See <bpt id=\"p1\">[</bpt>Manage Accounts, Subscriptions, and Administrative Roles<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/hh531793.aspx)</ept> for more information about Azure subscriptions."
    },
    {
      "content": "After creating a Microsoft Azure subscription and account:",
      "pos": [
        2784,
        2842
      ]
    },
    {
      "pos": [
        2850,
        2943
      ],
      "content": "Download and install <bpt id=\"p1\">[</bpt>Azure PowerShell<ept id=\"p1\">](http://go.microsoft.com/?linkid=9811175&amp;clcid=0x409)</ept>."
    },
    {
      "content": "Start Windows PowerShell Integrated Scripting Environment (ISE): In your local computer, go to the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> menu.",
      "pos": [
        2948,
        3062
      ]
    },
    {
      "content": "Type <bpt id=\"p1\">**</bpt>Administrative Tools<ept id=\"p1\">**</ept> and click to run it.",
      "pos": [
        3063,
        3113
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Administrative Tools<ept id=\"p1\">**</ept> window, right-click <bpt id=\"p2\">**</bpt>Windows PowerShell ISE<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Run as Administrator<ept id=\"p3\">**</ept>.",
      "pos": [
        3114,
        3225
      ]
    },
    {
      "pos": [
        3230,
        3314
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Windows PowerShell ISE<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>File<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>New<ept id=\"p3\">**</ept> to create a new script file."
    },
    {
      "content": "Now, we’ll give you a simple script that shows basic PowerShell commands to access Azure Storage.",
      "pos": [
        3319,
        3416
      ]
    },
    {
      "content": "The script will first ask your Azure account credentials to add your Azure account to the local PowerShell environment.",
      "pos": [
        3417,
        3536
      ]
    },
    {
      "content": "Then, the script will set the default Azure subscription and create a new storage account in Azure.",
      "pos": [
        3537,
        3636
      ]
    },
    {
      "content": "Next, the script will create a new container in this new storage account and upload an existing image file (blob) to that container.",
      "pos": [
        3637,
        3769
      ]
    },
    {
      "content": "After the script lists all blobs in that container, it will create a new destination directory in your local computer and download the image file.",
      "pos": [
        3770,
        3916
      ]
    },
    {
      "content": "In the following code section, select the script between the remarks <bpt id=\"p1\">**</bpt>#begin<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>#end<ept id=\"p2\">**</ept>.",
      "pos": [
        3921,
        4014
      ]
    },
    {
      "content": "Press CTRL+C to copy it to the clipboard.",
      "pos": [
        4015,
        4056
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Windows PowerShell ISE<ept id=\"p1\">**</ept>, press CTRL+V to copy the script.",
      "pos": [
        5986,
        6049
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Save<ept id=\"p2\">**</ept>.",
      "pos": [
        6050,
        6076
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Save As<ept id=\"p1\">**</ept> dialog window, type the name of the script file, such as \"mystoragescript\".",
      "pos": [
        6077,
        6171
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>.",
      "pos": [
        6172,
        6187
      ]
    },
    {
      "content": "Now, you need to update the script variables based on your configuration settings.",
      "pos": [
        6193,
        6275
      ]
    },
    {
      "content": "You must update the <bpt id=\"p1\">**</bpt>$SubscriptionName<ept id=\"p1\">**</ept> variable with your own subscription.",
      "pos": [
        6276,
        6354
      ]
    },
    {
      "content": "You can keep the other variables as specified in the script or update them as you wish.",
      "pos": [
        6355,
        6442
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>$SubscriptionName:<ept id=\"p1\">**</ept> You must update this variable with your own subscription name.",
      "pos": [
        6450,
        6535
      ]
    },
    {
      "content": "Follow one of the following three ways to locate the name of your subscription:",
      "pos": [
        6536,
        6615
      ]
    },
    {
      "content": "a.",
      "pos": [
        6625,
        6627
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Windows PowerShell ISE<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>File<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>New<ept id=\"p3\">**</ept> to create a new script file.",
      "pos": [
        6628,
        6712
      ]
    },
    {
      "content": "Copy the following script to the new script file and click <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept>.",
      "pos": [
        6713,
        6792
      ]
    },
    {
      "content": "The following script will first ask your Azure account credentials to add your Azure account to the local PowerShell environment and then show all the subscriptions that are connected to the local PowerShell session.",
      "pos": [
        6793,
        7009
      ]
    },
    {
      "content": "Take a note of the name of the subscription that you want to use while following this tutorial:",
      "pos": [
        7010,
        7105
      ]
    },
    {
      "content": "b.",
      "pos": [
        7261,
        7263
      ]
    },
    {
      "content": "Currently, Azure supports two portals: the <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">](https://manage.windowsazure.com/)</ept> and the <bpt id=\"p2\">[</bpt>Azure Preview Portal<ept id=\"p2\">](https://portal.azure.com/)</ept>.",
      "pos": [
        7264,
        7425
      ]
    },
    {
      "content": "If you sign in to the current <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">](https://portal.azure.com/)</ept>, scroll down and click <bpt id=\"p2\">**</bpt>Settings<ept id=\"p2\">**</ept> on the left side of the portal.",
      "pos": [
        7426,
        7576
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Subscriptions<ept id=\"p1\">**</ept>.",
      "pos": [
        7577,
        7601
      ]
    },
    {
      "content": "Copy the name of subscription that you want to use while running the scripts given in this guide.",
      "pos": [
        7602,
        7699
      ]
    },
    {
      "content": "See the following screenshot as an example.",
      "pos": [
        7700,
        7743
      ]
    },
    {
      "content": "Azure Management Portal",
      "pos": [
        7755,
        7778
      ]
    },
    {
      "content": "c.",
      "pos": [
        7797,
        7799
      ]
    },
    {
      "content": "If you sign in to the <bpt id=\"p1\">[</bpt>Azure Preview Portal<ept id=\"p1\">](https://portal.azure.com/)</ept>, in the Hub menu on the left, click <bpt id=\"p2\">**</bpt>BROWSE<ept id=\"p2\">**</ept>.",
      "pos": [
        7800,
        7919
      ]
    },
    {
      "content": "Then, click <bpt id=\"p1\">**</bpt>Everything<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Subscriptions<ept id=\"p2\">**</ept>.",
      "pos": [
        7920,
        7972
      ]
    },
    {
      "content": "Copy the name of subscription that you want to use while running the scripts in this guide.",
      "pos": [
        7973,
        8064
      ]
    },
    {
      "content": "See the following screenshot as an example.",
      "pos": [
        8065,
        8108
      ]
    },
    {
      "content": "Azure Preview Portal",
      "pos": [
        8120,
        8140
      ]
    },
    {
      "content": "After updating the script variables in the \"mystoragescript.ps1\" file, click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Save<ept id=\"p2\">**</ept>.",
      "pos": [
        8856,
        8953
      ]
    },
    {
      "content": "Then, click <bpt id=\"p1\">**</bpt>Debug<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept> or press <bpt id=\"p3\">**</bpt>F5<ept id=\"p3\">**</ept> to run the script.",
      "pos": [
        8954,
        9020
      ]
    },
    {
      "content": "After the script runs, you should have a local destination folder that includes the downloaded image file.",
      "pos": [
        9024,
        9130
      ]
    },
    {
      "content": "The following screenshot shows an example output:",
      "pos": [
        9131,
        9180
      ]
    },
    {
      "content": "Download Blobs",
      "pos": [
        9184,
        9198
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The \"Getting started with Azure Storage and PowerShell in 5 minutes\" section provided a quick introduction on how to use Azure PowerShell with Azure Storage.",
      "pos": [
        9212,
        9382
      ]
    },
    {
      "content": "For detailed information and instructions, we encourage you to read the following sections.",
      "pos": [
        9383,
        9474
      ]
    },
    {
      "content": "Prerequisites for using Azure PowerShell with Azure Storage",
      "pos": [
        9479,
        9538
      ]
    },
    {
      "content": "You need an Azure subscription and account to run the PowerShell cmdlets given in this guide, as described above.",
      "pos": [
        9539,
        9652
      ]
    },
    {
      "content": "Azure PowerShell is a module that provides cmdlets to manage Azure through Windows PowerShell.",
      "pos": [
        9654,
        9748
      ]
    },
    {
      "content": "For information on installing and setting up Azure PowerShell, see <bpt id=\"p1\">[</bpt>How to install and configure Azure PowerShell<ept id=\"p1\">](../powershell-install-configure.md)</ept>.",
      "pos": [
        9749,
        9900
      ]
    },
    {
      "content": "We recommend that you download and install or upgrade to the latest Azure PowerShell module before using this guide.",
      "pos": [
        9901,
        10017
      ]
    },
    {
      "content": "You can run the cmdlets in the Azure PowerShell console, the standard Windows PowerShell console, or the Windows PowerShell Integrated Scripting Environment (ISE).",
      "pos": [
        10019,
        10182
      ]
    },
    {
      "content": "For example, to open an <bpt id=\"p1\">**</bpt>Azure PowerShell console<ept id=\"p1\">**</ept>, go to the Start menu, type Microsoft Azure PowerShell, right-click and click Run as administrator.",
      "pos": [
        10183,
        10335
      ]
    },
    {
      "content": "To open <bpt id=\"p1\">**</bpt>Windows PowerShell ISE<ept id=\"p1\">**</ept>, go to the Start menu, type Administrative Tools and click to run it.",
      "pos": [
        10336,
        10440
      ]
    },
    {
      "content": "In the Administrative Tools window, right-click Windows PowerShell ISE, click Run as Administrator.",
      "pos": [
        10441,
        10540
      ]
    },
    {
      "content": "How to manage storage accounts in Azure",
      "pos": [
        10545,
        10584
      ]
    },
    {
      "content": "How to set a default Azure subscription",
      "pos": [
        10590,
        10629
      ]
    },
    {
      "content": "To manage Azure Storage using Azure PowerShell, you need to authenticate your client environment with Azure via Azure Active Directory Authentication or Certificate-based Authentication.",
      "pos": [
        10630,
        10816
      ]
    },
    {
      "content": "For detailed information, see <bpt id=\"p1\">[</bpt>How to install and configure Azure PowerShell<ept id=\"p1\">](../powershell-install-configure.md)</ept> tutorial.",
      "pos": [
        10817,
        10940
      ]
    },
    {
      "content": "This guide uses the Azure Active Directory authentication.",
      "pos": [
        10941,
        10999
      ]
    },
    {
      "content": "In the Azure PowerShell console or in Windows PowerShell ISE, type the following command to add your Azure account to the local PowerShell environment:",
      "pos": [
        11005,
        11156
      ]
    },
    {
      "content": "In the “Sign in to Microsoft Azure” window, type the email address and password associated with your account.",
      "pos": [
        11186,
        11295
      ]
    },
    {
      "content": "Azure authenticates and saves the credential information, and then closes the window.",
      "pos": [
        11296,
        11381
      ]
    },
    {
      "content": "Next, run the following command to view the Azure accounts in your local PowerShell environment, and verify that your account is listed:",
      "pos": [
        11387,
        11523
      ]
    },
    {
      "content": "Then, run the following cmdlet to view all the subscriptions that are connected to the local PowerShell session, and verify that your subscription is listed:",
      "pos": [
        11553,
        11710
      ]
    },
    {
      "content": "To set a default Azure subscription, run the Select-AzureSubscription cmdlet:",
      "pos": [
        11826,
        11903
      ]
    },
    {
      "content": "Verify the name of the default subscription by running the Get-AzureSubscription cmdlet:",
      "pos": [
        12041,
        12129
      ]
    },
    {
      "content": "To see all the available PowerShell cmdlets for Azure Storage, run:",
      "pos": [
        12173,
        12240
      ]
    },
    {
      "content": "How to create a new Azure storage account",
      "pos": [
        12295,
        12336
      ]
    },
    {
      "content": "To use Azure storage, you will need a storage account.",
      "pos": [
        12337,
        12391
      ]
    },
    {
      "content": "You can create a new Azure storage account after you have configured your computer to connect to your subscription.",
      "pos": [
        12392,
        12507
      ]
    },
    {
      "content": "Run the Get-AzureLocation cmdlet to find all the available datacenter locations:",
      "pos": [
        12513,
        12593
      ]
    },
    {
      "content": "Next, run the New-AzureStorageAccount cmdlet to create a new storage account.",
      "pos": [
        12694,
        12771
      ]
    },
    {
      "content": "The following example creates a new storage account in the \"West US\" datacenter.",
      "pos": [
        12772,
        12852
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> The name of your storage account must be unique within Azure and must be lowercase.",
      "pos": [
        13030,
        13131
      ]
    },
    {
      "content": "For naming conventions and restrictions, see <bpt id=\"p1\">[</bpt>About Azure Storage Accounts<ept id=\"p1\">](storage-create-storage-account.md)</ept> and <bpt id=\"p2\">[</bpt>Naming and Referencing Containers, Blobs, and Metadata<ept id=\"p2\">](http://msdn.microsoft.com/library/azure/dd135715.aspx)</ept>.",
      "pos": [
        13132,
        13359
      ]
    },
    {
      "content": "How to set a default Azure storage account",
      "pos": [
        13365,
        13407
      ]
    },
    {
      "content": "You can have multiple storage accounts in your subscription.",
      "pos": [
        13408,
        13468
      ]
    },
    {
      "content": "You can choose one of them and set it as the default storage account for all the storage commands in the same PowerShell session.",
      "pos": [
        13469,
        13598
      ]
    },
    {
      "content": "This enables you to run the Azure PowerShell storage commands without specifying the storage context explicitly.",
      "pos": [
        13599,
        13711
      ]
    },
    {
      "content": "To set a default storage account for your subscription, you can run the Set-AzureSubscription cmdlet.",
      "pos": [
        13717,
        13818
      ]
    },
    {
      "content": "Next, run the Get-AzureSubscription cmdlet to verify that the storage account is associated with your default subscription account.",
      "pos": [
        14044,
        14175
      ]
    },
    {
      "content": "This command returns the subscription properties on the current subscription including its current storage account.",
      "pos": [
        14176,
        14291
      ]
    },
    {
      "content": "How to list all Azure storage accounts in a subscription",
      "pos": [
        14337,
        14393
      ]
    },
    {
      "content": "Each Azure subscription can have up to 100 storage accounts.",
      "pos": [
        14394,
        14454
      ]
    },
    {
      "content": "For the most up-to-date information on limits, see <bpt id=\"p1\">[</bpt>Azure Subscription and Service Limits, Quotas, and Constraints<ept id=\"p1\">](../azure-subscription-service-limits.md)</ept>.",
      "pos": [
        14455,
        14612
      ]
    },
    {
      "content": "Run the following cmdlet to find out the name and status of the storage accounts in the current subscription:",
      "pos": [
        14614,
        14723
      ]
    },
    {
      "content": "How to create an Azure storage context",
      "pos": [
        14847,
        14885
      ]
    },
    {
      "content": "Azure storage context is an object in PowerShell to encapsulate the storage credentials.",
      "pos": [
        14886,
        14974
      ]
    },
    {
      "content": "Using a storage context while running any subsequent cmdlet enables you to authenticate your request without specifying the storage account and its access key explicitly.",
      "pos": [
        14975,
        15145
      ]
    },
    {
      "content": "You can create a storage context in many ways, such as using storage account name and access key, shared access signature (SAS) token, connection string, or anonymous.",
      "pos": [
        15146,
        15313
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>New-AzureStorageContext<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806380.aspx)</ept>.",
      "pos": [
        15314,
        15421
      ]
    },
    {
      "content": "Use one of the following three ways to create a storage context:",
      "pos": [
        15425,
        15489
      ]
    },
    {
      "content": "Run the <bpt id=\"p1\">[</bpt>Get-AzureStorageKey<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn495235.aspx)</ept> cmdlet to find out the primary storage access key for your Azure storage account.",
      "pos": [
        15493,
        15659
      ]
    },
    {
      "content": "Next, call the <bpt id=\"p1\">[</bpt>New-AzureStorageContext<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806380.aspx)</ept> cmdlet to create a storage context:",
      "pos": [
        15660,
        15791
      ]
    },
    {
      "content": "Generate a shared access signature token for an Azure storage container and use it to create a storage context:",
      "pos": [
        16042,
        16153
      ]
    },
    {
      "pos": [
        16343,
        16579
      ],
      "content": "For more information, see <bpt id=\"p1\">[</bpt>New-AzureStorageContainerSASToken<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806416.aspx)</ept> and <bpt id=\"p2\">[</bpt>Shared Access Signatures, Part 1: Understanding the SAS Model <ept id=\"p2\">](storage-dotnet-shared-access-signature-part-1.md)</ept>."
    },
    {
      "content": "In some cases, you may want to specify the service endpoints when you create a new storage context.",
      "pos": [
        16583,
        16682
      ]
    },
    {
      "content": "This might be necessary when you have registered a custom domain name for your storage account with the Blob service or you want to use a shared access signature for accessing storage resources.",
      "pos": [
        16683,
        16877
      ]
    },
    {
      "content": "Set the service endpoints in a connection string and use it to create a new storage context as shown below:",
      "pos": [
        16878,
        16985
      ]
    },
    {
      "pos": [
        17261,
        17408
      ],
      "content": "For more information on how to configure a storage connection string, see <bpt id=\"p1\">[</bpt>Configuring Connection Strings<ept id=\"p1\">](storage-configure-connection-string.md)</ept>."
    },
    {
      "content": "Now that you have set up your computer and learned how to manage subscriptions and storage accounts using Azure PowerShell.",
      "pos": [
        17410,
        17533
      ]
    },
    {
      "content": "Go to the next section to learn how to manage Azure blobs and blob snapshots.",
      "pos": [
        17534,
        17611
      ]
    },
    {
      "content": "How to manage Azure blobs and blob snapshots",
      "pos": [
        17616,
        17660
      ]
    },
    {
      "content": "Azure Blob storage is a service for storing large amounts of unstructured data, such as text or binary data, that can be accessed from anywhere in the world via HTTP or HTTPS.",
      "pos": [
        17661,
        17836
      ]
    },
    {
      "content": "This section assumes that you are already familiar with the Azure Blob Storage Service concepts.",
      "pos": [
        17837,
        17933
      ]
    },
    {
      "content": "For detailed information, see <bpt id=\"p1\">[</bpt>How to use Blob Storage from .NET<ept id=\"p1\">](storage-dotnet-how-to-use-blobs.md)</ept> and <bpt id=\"p2\">[</bpt>Blob Service Concepts<ept id=\"p2\">](http://msdn.microsoft.com/library/azure/dd179376.aspx)</ept>.",
      "pos": [
        17934,
        18119
      ]
    },
    {
      "content": "How to create a container",
      "pos": [
        18125,
        18150
      ]
    },
    {
      "content": "Every blob in Azure storage must be in a container.",
      "pos": [
        18151,
        18202
      ]
    },
    {
      "content": "You can create a private container using the New-AzureStorageContainer cmdlet:",
      "pos": [
        18203,
        18281
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> There are three levels of anonymous read access: <bpt id=\"p1\">**</bpt>Off<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Blob<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Container<ept id=\"p3\">**</ept>.",
      "pos": [
        18408,
        18507
      ]
    },
    {
      "content": "To prevent anonymous access to blobs, set the Permission parameter to <bpt id=\"p1\">**</bpt>Off<ept id=\"p1\">**</ept>.",
      "pos": [
        18508,
        18586
      ]
    },
    {
      "content": "By default, the new container is private and can be accessed only by the account owner.",
      "pos": [
        18587,
        18674
      ]
    },
    {
      "content": "To allow anonymous public read access to blob resources, but not to container metadata or to the list of blobs in the container, set the Permission parameter to <bpt id=\"p1\">**</bpt>Blob<ept id=\"p1\">**</ept>.",
      "pos": [
        18675,
        18845
      ]
    },
    {
      "content": "To allow full public read access to blob resources, container metadata, and the list of blobs in the container, set the Permission parameter to <bpt id=\"p1\">**</bpt>Container<ept id=\"p1\">**</ept>.",
      "pos": [
        18846,
        19004
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Manage Access to Azure Storage Resources<ept id=\"p1\">](storage-manage-access-to-resources.md)</ept>.",
      "pos": [
        19005,
        19113
      ]
    },
    {
      "content": "How to upload a blob into a container",
      "pos": [
        19119,
        19156
      ]
    },
    {
      "content": "Azure Blob Storage supports block blobs and page blobs.",
      "pos": [
        19157,
        19212
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Understanding Block Blobs and Page Blobs<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/ee691964.aspx)</ept>.",
      "pos": [
        19213,
        19337
      ]
    },
    {
      "content": "To upload blobs in to a container, you can use the <bpt id=\"p1\">[</bpt>Set-AzureStorageBlobContent<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806379.aspx)</ept> cmdlet.",
      "pos": [
        19339,
        19482
      ]
    },
    {
      "content": "By default, this command uploads the local files to a block blob.",
      "pos": [
        19483,
        19548
      ]
    },
    {
      "content": "To specify the type for the blob, you can use the -BlobType parameter.",
      "pos": [
        19549,
        19619
      ]
    },
    {
      "content": "The following example runs the <bpt id=\"p1\">[</bpt>Get-ChildItem<ept id=\"p1\">](http://technet.microsoft.com/library/hh849800.aspx)</ept> cmdlet to get all the files in the specified folder, and then passes them to the next cmdlet by using the pipeline operator.",
      "pos": [
        19621,
        19844
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>Set-AzureStorageBlobContent<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806379.aspx)</ept> cmdlet uploads the local files to your container:",
      "pos": [
        19845,
        19983
      ]
    },
    {
      "content": "How to download blobs from a container",
      "pos": [
        20087,
        20125
      ]
    },
    {
      "content": "The following example demonstrates how to download blobs from a container.",
      "pos": [
        20126,
        20200
      ]
    },
    {
      "content": "The example first establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its primary access key.",
      "pos": [
        20201,
        20363
      ]
    },
    {
      "content": "Then, the example retrieves a blob reference using the <bpt id=\"p1\">[</bpt>Get-AzureStorageBlob<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806392.aspx)</ept> cmdlet.",
      "pos": [
        20364,
        20504
      ]
    },
    {
      "content": "Next, the example uses the <bpt id=\"p1\">[</bpt>Get-AzureStorageBlobContent<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806418.aspx)</ept> cmdlet to download blobs into the local destination folder.",
      "pos": [
        20505,
        20676
      ]
    },
    {
      "content": "How to copy blobs from one storage container to another",
      "pos": [
        21379,
        21434
      ]
    },
    {
      "content": "You can copy blobs across storage accounts and regions asynchronously.",
      "pos": [
        21435,
        21505
      ]
    },
    {
      "content": "The following example demonstrates how to copy blobs from one storage container to another in two different storage accounts.",
      "pos": [
        21506,
        21631
      ]
    },
    {
      "content": "The example first sets variables for source and destination storage accounts, and then creates a storage context for each account.",
      "pos": [
        21632,
        21762
      ]
    },
    {
      "content": "Next, the example copies blobs from the source container to the destination container using the <bpt id=\"p1\">[</bpt>Start-AzureStorageBlobCopy<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806394.aspx)</ept> cmdlet.",
      "pos": [
        21763,
        21950
      ]
    },
    {
      "content": "The example assumes that the source and destination storage accounts and containers already exist.",
      "pos": [
        21951,
        22049
      ]
    },
    {
      "content": "Note that this example performs an asynchronous copy.",
      "pos": [
        23066,
        23119
      ]
    },
    {
      "content": "You can monitor the status of each copy by running the <bpt id=\"p1\">[</bpt>Get-AzureStorageBlobCopyState<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806406.aspx)</ept> cmdlet.",
      "pos": [
        23120,
        23269
      ]
    },
    {
      "content": "How to copy blobs from a secondary location",
      "pos": [
        23275,
        23318
      ]
    },
    {
      "content": "You can copy blobs from the secondary locatioon of a RA-GRS enabled account.",
      "pos": [
        23319,
        23395
      ]
    },
    {
      "content": "How to delete a blob",
      "pos": [
        23996,
        24016
      ]
    },
    {
      "content": "To delete a blob, first get a blob reference and then call the Remove-AzureStorageBlob cmdlet on it.",
      "pos": [
        24017,
        24117
      ]
    },
    {
      "content": "The following example deletes all the blobs in a given container.",
      "pos": [
        24118,
        24183
      ]
    },
    {
      "content": "The example first sets variables for a storage account, and then creates a storage context.",
      "pos": [
        24184,
        24275
      ]
    },
    {
      "content": "Next, the example retrieves a blob reference using the <bpt id=\"p1\">[</bpt>Get-AzureStorageBlob<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806392.aspx)</ept> cmdlet and runs the <bpt id=\"p2\">[</bpt>Remove-AzureStorageBlob<ept id=\"p2\">](http://msdn.microsoft.com/library/azure/dn806399.aspx)</ept> cmdlet to remove blobs from a container in Azure storage.",
      "pos": [
        24276,
        24567
      ]
    },
    {
      "content": "How to manage Azure blob snapshots",
      "pos": [
        25102,
        25136
      ]
    },
    {
      "content": "Azure lets you create a snapshot of a blob.",
      "pos": [
        25137,
        25180
      ]
    },
    {
      "content": "A snapshot is a read-only version of a blob that's taken at a point in time.",
      "pos": [
        25181,
        25257
      ]
    },
    {
      "content": "Once a snapshot has been created, it can be read, copied, or deleted, but not modified.",
      "pos": [
        25258,
        25345
      ]
    },
    {
      "content": "Snapshots provide a way to back up a blob as it appears at a moment in time.",
      "pos": [
        25346,
        25422
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Creating a Snapshot of a Blob<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/hh488361.aspx)</ept>.",
      "pos": [
        25423,
        25536
      ]
    },
    {
      "content": "How to create a blob snapshot",
      "pos": [
        25542,
        25571
      ]
    },
    {
      "content": "To create a snaphot of a blob, first get a blob reference and then call the <ph id=\"ph1\">`ICloudBlob.CreateSnapshot`</ph> method on it.",
      "pos": [
        25572,
        25689
      ]
    },
    {
      "content": "The following example first sets variables for a storage account, and then creates a storage context.",
      "pos": [
        25690,
        25791
      ]
    },
    {
      "content": "Next, the example retrieves a blob reference using the <bpt id=\"p1\">[</bpt>Get-AzureStorageBlob<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806392.aspx)</ept> cmdlet and runs the <bpt id=\"p2\">[</bpt>ICloudBlob.CreateSnapshot<ept id=\"p2\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.icloudblob.aspx)</ept> method to create a snapshot.",
      "pos": [
        25792,
        26094
      ]
    },
    {
      "content": "How to list a blob's snapshots",
      "pos": [
        26658,
        26688
      ]
    },
    {
      "content": "You can create as many snapshots as you want for a blob.",
      "pos": [
        26689,
        26745
      ]
    },
    {
      "content": "You can list the snapshots associated with your blob to track your current snapshots.",
      "pos": [
        26746,
        26831
      ]
    },
    {
      "content": "The following example uses a predefined blob and calls the <bpt id=\"p1\">[</bpt>Get-AzureStorageBlob<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806392.aspx)</ept> cmdlet to list the snapshots of that blob.",
      "pos": [
        26832,
        27011
      ]
    },
    {
      "content": "How to copy a snapshot of a blob",
      "pos": [
        27270,
        27302
      ]
    },
    {
      "content": "You can copy a snapshot of a blob to restore the snapshot.",
      "pos": [
        27303,
        27361
      ]
    },
    {
      "content": "For detailed information and restrictions, see <bpt id=\"p1\">[</bpt>Creating a Snapshot of a Blob<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/hh488361.aspx)</ept>.",
      "pos": [
        27362,
        27496
      ]
    },
    {
      "content": "The following example first sets variables for a storage account, and then creates a storage context.",
      "pos": [
        27497,
        27598
      ]
    },
    {
      "content": "Next, the example defines the container and blob name variables.",
      "pos": [
        27599,
        27663
      ]
    },
    {
      "content": "The example retrieves a blob reference using the <bpt id=\"p1\">[</bpt>Get-AzureStorageBlob<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806392.aspx)</ept> cmdlet and runs the <bpt id=\"p2\">[</bpt>ICloudBlob.CreateSnapshot<ept id=\"p2\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.icloudblob.aspx)</ept> method to create a snapshot.",
      "pos": [
        27664,
        27960
      ]
    },
    {
      "content": "Then, the example runs the <bpt id=\"p1\">[</bpt>Start-AzureStorageBlobCopy<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806394.aspx)</ept> cmdlet to copy the snapshot of a blob using the ICloudBlob object for the source blob.",
      "pos": [
        27961,
        28158
      ]
    },
    {
      "content": "Be sure to update the variables based on your configuration before running the example.",
      "pos": [
        28159,
        28246
      ]
    },
    {
      "content": "Note that the following example assumes that the source and destination containers, and the source blob already exist.",
      "pos": [
        28247,
        28365
      ]
    },
    {
      "content": "Now that you have learned how to manage Azure blobs and blob snapshots with Azure PowerShell.",
      "pos": [
        29220,
        29313
      ]
    },
    {
      "content": "Go to the next section to learn how to manage tables, queues, and files.",
      "pos": [
        29314,
        29386
      ]
    },
    {
      "content": "How to manage Azure tables and table entities",
      "pos": [
        29391,
        29436
      ]
    },
    {
      "content": "Azure Table storage service is a NoSQL datastore, which you can use to store and query huge sets of structured, non-relational data.",
      "pos": [
        29437,
        29569
      ]
    },
    {
      "content": "The main components of the service are tables, entities, and properties.",
      "pos": [
        29570,
        29642
      ]
    },
    {
      "content": "A table is a collection of entities.",
      "pos": [
        29643,
        29679
      ]
    },
    {
      "content": "An entity is a set of properties.",
      "pos": [
        29680,
        29713
      ]
    },
    {
      "content": "Each entity can have up to 252 properties, which are all name-value pair.",
      "pos": [
        29714,
        29787
      ]
    },
    {
      "content": "This section assumes that you are already familiar with the Azure Table Storage Service concepts.",
      "pos": [
        29788,
        29885
      ]
    },
    {
      "content": "For detailed information, see <bpt id=\"p1\">[</bpt>Understanding the Table Service Data Model<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dd179338.aspx)</ept> and <bpt id=\"p2\">[</bpt>How to use Table Storage from .NET<ept id=\"p2\">](storage-dotnet-how-to-use-tables.md)</ept>.",
      "pos": [
        29886,
        30094
      ]
    },
    {
      "content": "In the following sub sections, you’ll learn how to manage Azure Table storage service using Azure PowerShell.",
      "pos": [
        30096,
        30205
      ]
    },
    {
      "content": "The scenarios covered include <bpt id=\"p1\">**</bpt>creating<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>deleting<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>retrieving<ept id=\"p3\">**</ept> <bpt id=\"p4\">**</bpt>tables<ept id=\"p4\">**</ept>, as well as <bpt id=\"p5\">**</bpt>adding<ept id=\"p5\">**</ept>, <bpt id=\"p6\">**</bpt>querying<ept id=\"p6\">**</ept>, and <bpt id=\"p7\">**</bpt>deleting table entities<ept id=\"p7\">**</ept>.",
      "pos": [
        30206,
        30364
      ]
    },
    {
      "content": "How to create a table",
      "pos": [
        30370,
        30391
      ]
    },
    {
      "content": "Every table must reside in an Azure storage account.",
      "pos": [
        30392,
        30444
      ]
    },
    {
      "content": "The following example demonstrates how to create a table in Azure Storage.",
      "pos": [
        30445,
        30519
      ]
    },
    {
      "content": "The example first establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its access key.",
      "pos": [
        30520,
        30674
      ]
    },
    {
      "content": "Next, it uses the <bpt id=\"p1\">[</bpt>New-AzureStorageTable<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806417.aspx)</ept> cmdlet to create a table in Azure Storage.",
      "pos": [
        30675,
        30814
      ]
    },
    {
      "content": "How to retrieve a table",
      "pos": [
        31193,
        31216
      ]
    },
    {
      "content": "You can query and retrieve one or all tables in a Storage account.",
      "pos": [
        31217,
        31283
      ]
    },
    {
      "content": "The following example demonstrates how to retrieve a given table using the <bpt id=\"p1\">[</bpt>Get-AzureStorageTable<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806411.aspx)</ept> cmdlet.",
      "pos": [
        31284,
        31445
      ]
    },
    {
      "content": "If you call the Get-AzureStorageTable cmdlet without any parameters, it gets all storage tables for a Storage account.",
      "pos": [
        31557,
        31675
      ]
    },
    {
      "content": "How to delete a table",
      "pos": [
        31681,
        31702
      ]
    },
    {
      "pos": [
        31703,
        31851
      ],
      "content": "You can delete a table from a storage account by using the <bpt id=\"p1\">[</bpt>Remove-AzureStorageTable<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806393.aspx)</ept> cmdlet."
    },
    {
      "content": "How to manage table entities",
      "pos": [
        31970,
        31998
      ]
    },
    {
      "content": "Currently, Azure PowerShell does not provide cmdlets to manage table entities directly.",
      "pos": [
        31999,
        32086
      ]
    },
    {
      "content": "To perform operations on table entities, you can use the classes given in the <bpt id=\"p1\">[</bpt>Azure Storage Client Library for .NET<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/wa_storage_30_reference_home.aspx)</ept>.",
      "pos": [
        32087,
        32280
      ]
    },
    {
      "content": "How to add table entities",
      "pos": [
        32287,
        32312
      ]
    },
    {
      "content": "To add an entity to a table, first create an object that defines your entity properties.",
      "pos": [
        32313,
        32401
      ]
    },
    {
      "content": "An entity can have up to 255 properties, including 3 system properties: <bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>RowKey<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Timestamp<ept id=\"p3\">**</ept>.",
      "pos": [
        32402,
        32522
      ]
    },
    {
      "content": "You are responsible for inserting and updating the values of <bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>RowKey<ept id=\"p2\">**</ept>.",
      "pos": [
        32523,
        32616
      ]
    },
    {
      "content": "The server manages the value of <bpt id=\"p1\">**</bpt>Timestamp<ept id=\"p1\">**</ept>, which cannot be modified.",
      "pos": [
        32617,
        32689
      ]
    },
    {
      "content": "Together the <bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>RowKey<ept id=\"p2\">**</ept> uniquely identify every entity within a table.",
      "pos": [
        32690,
        32781
      ]
    },
    {
      "pos": [
        32787,
        32859
      ],
      "content": "<bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept>: Determines the partition that the entity is stored in."
    },
    {
      "pos": [
        32864,
        32928
      ],
      "content": "<bpt id=\"p1\">**</bpt>RowKey<ept id=\"p1\">**</ept>: Uniquely identifies the entity within the partition."
    },
    {
      "content": "You may define up to 252 custom properties for an entity.",
      "pos": [
        32930,
        32987
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Understanding the Table Service Data Model<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dd179338.aspx)</ept>.",
      "pos": [
        32988,
        33114
      ]
    },
    {
      "content": "The following example demonstrates how to add entities to a table.",
      "pos": [
        33116,
        33182
      ]
    },
    {
      "content": "The example shows how to retrieve the employee table and add several entities into it.",
      "pos": [
        33183,
        33269
      ]
    },
    {
      "content": "First, it establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its access key.",
      "pos": [
        33270,
        33416
      ]
    },
    {
      "content": "Next, it retrieves the given table using the <bpt id=\"p1\">[</bpt>Get-AzureStorageTable<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806411.aspx)</ept> cmdlet.",
      "pos": [
        33417,
        33548
      ]
    },
    {
      "content": "If the table does not exist, the <bpt id=\"p1\">[</bpt>New-AzureStorageTable<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806417.aspx)</ept> cmdlet is used to create a table in Azure Storage.",
      "pos": [
        33549,
        33711
      ]
    },
    {
      "content": "Next, the example defines a custom function Add-Entity to add entities to the table by specifying each entity’s partition and row key.",
      "pos": [
        33712,
        33846
      ]
    },
    {
      "content": "The Add-Entity function calls the <bpt id=\"p1\">[</bpt>New-Object<ept id=\"p1\">](http://technet.microsoft.com/library/hh849885.aspx)</ept> cmdlet on the <bpt id=\"p2\">[</bpt>Microsoft.WindowsAzure.Storage.Table.DynamicTableEntity<ept id=\"p2\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.dynamictableentity.aspx)</ept> class to create an entity object.",
      "pos": [
        33847,
        34153
      ]
    },
    {
      "content": "Later, the example calls the <bpt id=\"p1\">[</bpt>Microsoft.WindowsAzure.Storage.Table.TableOperation.Insert<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.tableoperation.insert.aspx)</ept> method on this entity object to add it to a table.",
      "pos": [
        34154,
        34399
      ]
    },
    {
      "content": "How to query table entities",
      "pos": [
        35992,
        36019
      ]
    },
    {
      "content": "To query a table, use the <bpt id=\"p1\">[</bpt>Microsoft.WindowsAzure.Storage.Table.TableQuery<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.tablequery.aspx)</ept> class.",
      "pos": [
        36020,
        36196
      ]
    },
    {
      "content": "The following example assumes that you’ve already run the script given in the How to add entities section of this guide.",
      "pos": [
        36197,
        36317
      ]
    },
    {
      "content": "The example first establishes a connection to Azure Storage using the storage context, which includes the storage account name and its access key.",
      "pos": [
        36318,
        36464
      ]
    },
    {
      "content": "Next, it tries to retrieve the previously created “Employees” table using the <bpt id=\"p1\">[</bpt>Get-AzureStorageTable<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806411.aspx)</ept> cmdlet.",
      "pos": [
        36465,
        36629
      ]
    },
    {
      "content": "Calling the <bpt id=\"p1\">[</bpt>New-Object<ept id=\"p1\">](http://technet.microsoft.com/library/hh849885.aspx)</ept> cmdlet on the Microsoft.WindowsAzure.Storage.Table.TableQuery class creates a new query object.",
      "pos": [
        36630,
        36802
      ]
    },
    {
      "content": "The example looks for the entities that have an ‘ID’ column whose value is 1 as specified in a string filter.",
      "pos": [
        36803,
        36912
      ]
    },
    {
      "content": "For detailed information, see <bpt id=\"p1\">[</bpt>Querying Tables and Entities<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dd894031.aspx)</ept>.",
      "pos": [
        36913,
        37029
      ]
    },
    {
      "content": "When you run this query, it returns all entities that match the filter criteria.",
      "pos": [
        37030,
        37110
      ]
    },
    {
      "content": "How to delete table entities",
      "pos": [
        38254,
        38282
      ]
    },
    {
      "content": "You can delete an entity using its partition and row keys.",
      "pos": [
        38283,
        38341
      ]
    },
    {
      "content": "The following example assumes that you’ve already run the script given in the How to add entities section of this guide.",
      "pos": [
        38342,
        38462
      ]
    },
    {
      "content": "The example first establishes a connection to Azure Storage using the storage context, which includes the storage account name and its access key.",
      "pos": [
        38463,
        38609
      ]
    },
    {
      "content": "Next, it tries to retrieve the previously created “Employees” table using the <bpt id=\"p1\">[</bpt>Get-AzureStorageTable<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806411.aspx)</ept> cmdlet.",
      "pos": [
        38610,
        38774
      ]
    },
    {
      "content": "If the table exists, the example calls the <bpt id=\"p1\">[</bpt>Microsoft.WindowsAzure.Storage.Table.TableOperation.Retrieve<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.tableoperation.retrieve.aspx)</ept> method to retrieve an entity based on its partition and row key values.",
      "pos": [
        38775,
        39059
      ]
    },
    {
      "content": "Then, pass the entity to the  <bpt id=\"p1\">[</bpt>Microsoft.WindowsAzure.Storage.Table.TableOperation.Delete<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.tableoperation.delete.aspx)</ept> method to delete.",
      "pos": [
        39060,
        39273
      ]
    },
    {
      "content": "How to manage Azure queues and queue messages",
      "pos": [
        40246,
        40291
      ]
    },
    {
      "content": "Azure Queue storage is a service for storing large numbers of messages that can be accessed from anywhere in the world via authenticated calls using HTTP or HTTPS.",
      "pos": [
        40292,
        40455
      ]
    },
    {
      "content": "This section assumes that you are already familiar with the Azure Queue Storage Service concepts.",
      "pos": [
        40456,
        40553
      ]
    },
    {
      "content": "For detailed information, see <bpt id=\"p1\">[</bpt>How to use Queue Storage from .NET<ept id=\"p1\">](storage-dotnet-how-to-use-queues.md)</ept>.",
      "pos": [
        40554,
        40658
      ]
    },
    {
      "content": "This section will show you how to manage Azure Queue storage service using Azure PowerShell.",
      "pos": [
        40660,
        40752
      ]
    },
    {
      "content": "The scenarios covered include <bpt id=\"p1\">**</bpt>inserting<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>deleting<ept id=\"p2\">**</ept> queue messages, as well as <bpt id=\"p3\">**</bpt>creating<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>deleting<ept id=\"p4\">**</ept>, and <bpt id=\"p5\">**</bpt>retrieving queues<ept id=\"p5\">**</ept>.",
      "pos": [
        40753,
        40895
      ]
    },
    {
      "content": "How to create a queue",
      "pos": [
        40901,
        40922
      ]
    },
    {
      "content": "The following example first establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its access key.",
      "pos": [
        40923,
        41087
      ]
    },
    {
      "content": "Next, it calls <bpt id=\"p1\">[</bpt>New-AzureStorageQueue<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806382.aspx)</ept> cmdlet to create a queue named ‘queuename’.",
      "pos": [
        41088,
        41225
      ]
    },
    {
      "pos": [
        41621,
        41772
      ],
      "content": "For information on naming conventions for Azure Queue Service, see <bpt id=\"p1\">[</bpt>Naming Queues and Metadata<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dd179349.aspx)</ept>."
    },
    {
      "content": "How to retrieve a queue",
      "pos": [
        41778,
        41801
      ]
    },
    {
      "content": "You can query and retrieve a specific queue or a list of all the queues in a Storage account.",
      "pos": [
        41802,
        41895
      ]
    },
    {
      "content": "The following example demonstrates how to retrieve a specified queue using the <bpt id=\"p1\">[</bpt>Get-AzureStorageQueue<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806377.aspx)</ept> cmdlet.",
      "pos": [
        41896,
        42061
      ]
    },
    {
      "pos": [
        42182,
        42341
      ],
      "content": "If you call the <bpt id=\"p1\">[</bpt>Get-AzureStorageQueue<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806377.aspx)</ept> cmdlet without any parameters, it gets a list of all the queues."
    },
    {
      "content": "How to delete a queue",
      "pos": [
        42347,
        42368
      ]
    },
    {
      "content": "To delete a queue and all the messages contained in it, call the Remove-AzureStorageQueue cmdlet.",
      "pos": [
        42369,
        42466
      ]
    },
    {
      "content": "The following example shows how to delete a specified queue using the Remove-AzureStorageQueue cmdlet.",
      "pos": [
        42467,
        42569
      ]
    },
    {
      "content": "How to manage queue messages",
      "pos": [
        42690,
        42718
      ]
    },
    {
      "content": "Currently, Azure PowerShell does not provide cmdlets to manage queue messages directly.",
      "pos": [
        42719,
        42806
      ]
    },
    {
      "content": "To perform operations on queue messages, you can use the classes given in the <bpt id=\"p1\">[</bpt>Azure Storage Client Library for .NET<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/wa_storage_30_reference_home.aspx)</ept>.",
      "pos": [
        42807,
        43000
      ]
    },
    {
      "content": "How to insert a message into a queue",
      "pos": [
        43007,
        43043
      ]
    },
    {
      "content": "To insert a message into an existing queue, first create a new instance of the <bpt id=\"p1\">[</bpt>Microsoft.WindowsAzure.Storage.Queue.CloudQueueMessage<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/jj732474.aspx)</ept> class.",
      "pos": [
        43044,
        43241
      ]
    },
    {
      "content": "Next, call the <bpt id=\"p1\">[</bpt>AddMessage<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.addmessage.aspx)</ept> method.",
      "pos": [
        43242,
        43382
      ]
    },
    {
      "content": "A CloudQueueMessage can be created from either a string (in UTF-8 format) or a byte array.",
      "pos": [
        43383,
        43473
      ]
    },
    {
      "content": "The following example demonstrates how to add message to a queue.",
      "pos": [
        43475,
        43540
      ]
    },
    {
      "content": "The example first establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its access key.",
      "pos": [
        43541,
        43695
      ]
    },
    {
      "content": "Next, it retrieves the specified queue using the <bpt id=\"p1\">[</bpt>Get-AzureStorageQueue<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/dn806377.aspx)</ept> cmdlet.",
      "pos": [
        43696,
        43832
      ]
    },
    {
      "content": "If the queue exists, the <bpt id=\"p1\">[</bpt>New-Object<ept id=\"p1\">](http://technet.microsoft.com/library/hh849885.aspx)</ept> cmdlet is used to create an instance of the <bpt id=\"p2\">[</bpt>Microsoft.WindowsAzure.Storage.Queue.CloudQueueMessage<ept id=\"p2\">](http://msdn.microsoft.com/library/azure/jj732474.aspx)</ept> class.",
      "pos": [
        43833,
        44085
      ]
    },
    {
      "content": "Later, the example calls the <bpt id=\"p1\">[</bpt>AddMessage<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.addmessage.aspx)</ept> method on this message object to add it to a queue.",
      "pos": [
        44086,
        44284
      ]
    },
    {
      "content": "Here is code which retrieves a queue and inserts the message 'MessageInfo':",
      "pos": [
        44285,
        44360
      ]
    },
    {
      "content": "How to de-queue at the next message",
      "pos": [
        45167,
        45202
      ]
    },
    {
      "content": "Your code de-queues a message from a queue in two steps.",
      "pos": [
        45203,
        45259
      ]
    },
    {
      "content": "When you call the <bpt id=\"p1\">[</bpt>Microsoft.WindowsAzure.Storage.Queue.CloudQueue.GetMessage<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.getmessage.aspx)</ept> method, you get the next message in a queue.",
      "pos": [
        45260,
        45488
      ]
    },
    {
      "content": "A message returned from <bpt id=\"p1\">**</bpt>GetMessage<ept id=\"p1\">**</ept> becomes invisible to any other code reading messages from this queue.",
      "pos": [
        45489,
        45597
      ]
    },
    {
      "content": "To finish removing the message from the queue, you must also call the <bpt id=\"p1\">[</bpt>Microsoft.WindowsAzure.Storage.Queue.CloudQueue.DeleteMessage<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.deletemessage.aspx)</ept> method.",
      "pos": [
        45598,
        45847
      ]
    },
    {
      "content": "This two-step process of removing a message assures that if your code fails to process a message due to hardware or software failure, another instance of your code can get the same message and try again.",
      "pos": [
        45848,
        46051
      ]
    },
    {
      "content": "Your code calls <bpt id=\"p1\">**</bpt>DeleteMessage<ept id=\"p1\">**</ept> right after the message has been processed.",
      "pos": [
        46052,
        46129
      ]
    },
    {
      "content": "How to manage Azure file shares and files",
      "pos": [
        46803,
        46844
      ]
    },
    {
      "content": "Azure File storage offers shared storage for applications using the standard SMB 2.1 protocol.",
      "pos": [
        46845,
        46939
      ]
    },
    {
      "content": "Microsoft Azure virtual machines and cloud services can share file data across application components via mounted shares, and on-premises applications can access file data in a share via the File storage API or Azure PowerShell.",
      "pos": [
        46940,
        47168
      ]
    },
    {
      "pos": [
        47170,
        47369
      ],
      "content": "For more information on Azure File storage, see <bpt id=\"p1\">[</bpt>How to use Azure File storage<ept id=\"p1\">](storage-dotnet-how-to-use-files.md)</ept> and <bpt id=\"p2\">[</bpt>File Service REST API<ept id=\"p2\">](http://msdn.microsoft.com/library/azure/dn167006.aspx)</ept>."
    },
    {
      "content": "How to set and query storage analytics",
      "pos": [
        47374,
        47412
      ]
    },
    {
      "content": "You can use <bpt id=\"p1\">[</bpt>Azure Storage Analytics<ept id=\"p1\">](storage-analytics.md)</ept> to collect metrics for your Azure storage accounts and log data about requests sent to your storage account.",
      "pos": [
        47413,
        47581
      ]
    },
    {
      "content": "You can use storage metrics to monitor the health of a storage account, and storage logging to diagnose and troubleshoot issues with your storage account.",
      "pos": [
        47582,
        47736
      ]
    },
    {
      "content": "By default, storage metrics is not enabled for your storage services.",
      "pos": [
        47737,
        47806
      ]
    },
    {
      "content": "You can enable monitoring using either the Azure Management Portal, Windows PowerShell, or programmatically through a storage API.",
      "pos": [
        47807,
        47937
      ]
    },
    {
      "content": "Storage logging happens server-side and enables you to record details for both successful and failed requests in your storage account.",
      "pos": [
        47938,
        48072
      ]
    },
    {
      "content": "These logs enable you to see details of read, write, and delete operations against your tables, queues, and blobs as well as the reasons for failed requests.",
      "pos": [
        48073,
        48230
      ]
    },
    {
      "pos": [
        48232,
        48452
      ],
      "content": "To learn how to enable and view Storage Metrics data using PowerShell, see <bpt id=\"p1\">[</bpt>How to enable Storage Metrics using PowerShell<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn782843.aspx#HowtoenableStorageMetricsusingPowerShell)</ept>."
    },
    {
      "content": "To learn how to enable and retrieve Storage Logging data using PowerShell, see",
      "pos": [
        48454,
        48532
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>How to enable Storage Logging using PowerShell<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn782840.aspx#HowtoenableStorageLoggingusingPowerShell)</ept> and <bpt id=\"p2\">[</bpt>Finding your Storage Logging log data<ept id=\"p2\">](http://msdn.microsoft.com/library/azure/dn782840.aspx#FindingyourStorageLogginglogdata)</ept>.",
      "pos": [
        48533,
        48810
      ]
    },
    {
      "content": "For detailed information on using Storage Metrics and Storage Logging to troubleshoot storage issues, see <bpt id=\"p1\">[</bpt>Monitoring, Diagnosing, and Troubleshooting Microsoft Azure Storage<ept id=\"p1\">](storage-monitoring-diagnosing-troubleshooting.md)</ept>.",
      "pos": [
        48811,
        49037
      ]
    },
    {
      "content": "How to manage Shared Access Signature (SAS) and Stored Access Policy",
      "pos": [
        49042,
        49110
      ]
    },
    {
      "content": "Shared access signatures are an important part of the security model for any application using Azure Storage.",
      "pos": [
        49111,
        49220
      ]
    },
    {
      "content": "They are useful for providing limited permissions to your storage account to clients that should not have the account key.",
      "pos": [
        49221,
        49343
      ]
    },
    {
      "content": "By default, only the owner of the storage account may access blobs, tables, and queues within that account.",
      "pos": [
        49344,
        49451
      ]
    },
    {
      "content": "If your service or application needs to make these resources available to other clients without sharing your access key, you have three options:",
      "pos": [
        49452,
        49596
      ]
    },
    {
      "content": "Set a container's permissions to permit anonymous read access to the container and its blobs.",
      "pos": [
        49600,
        49693
      ]
    },
    {
      "content": "This is not allowed for tables or queues.",
      "pos": [
        49694,
        49735
      ]
    },
    {
      "content": "Use a shared access signature that grants restricted access rights to containers, blobs, queues, and tables for a specific time interval.",
      "pos": [
        49738,
        49875
      ]
    },
    {
      "content": "Use a stored access policy to obtain an additional level of control over shared access signatures for a container or its blobs, for a queue, or for a table.",
      "pos": [
        49878,
        50034
      ]
    },
    {
      "content": "The stored access policy allows you to change the start time, expiry time, or permissions for a signature, or to revoke it after it has been issued.",
      "pos": [
        50035,
        50183
      ]
    },
    {
      "content": "A shared access signature can be in one of two forms:",
      "pos": [
        50185,
        50238
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Ad hoc SAS<ept id=\"p1\">**</ept>: When you create an ad hoc SAS, the start time, expiry time, and permissions for the SAS are all specified on the SAS URI.",
      "pos": [
        50242,
        50379
      ]
    },
    {
      "content": "This type of SAS may be created on a container, blob, table, or queue and it is non-revokable.",
      "pos": [
        50380,
        50474
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>SAS with stored access policy<ept id=\"p1\">**</ept>: A stored access policy is defined on a resource container a blob container, table, or queue - and you can use it to manage constraints for one or more shared access signatures.",
      "pos": [
        50477,
        50688
      ]
    },
    {
      "content": "When you associate a SAS with a stored access policy, the SAS inherits the constraints - the start time, expiry time, and permissions - defined for the stored access policy.",
      "pos": [
        50689,
        50862
      ]
    },
    {
      "content": "This type of SAS is revokable.",
      "pos": [
        50863,
        50893
      ]
    },
    {
      "pos": [
        50895,
        51097
      ],
      "content": "For more information, see <bpt id=\"p1\">[</bpt>the Shared Access Signatures tutorial<ept id=\"p1\">](storage-dotnet-shared-access-signature-part-1.md)</ept> and <bpt id=\"p2\">[</bpt>Manage Access to Azure Storage Resources<ept id=\"p2\">](storage-manage-access-to-resources.md)</ept>."
    },
    {
      "content": "In the next sections, you will learn how to create a shared access signature token and stored access policy for Azure tables.",
      "pos": [
        51099,
        51224
      ]
    },
    {
      "content": "Azure PowerShell provides similar cmdlets for containers, blobs, and queues as well.",
      "pos": [
        51225,
        51309
      ]
    },
    {
      "content": "To run the scripts in this section, download the <bpt id=\"p1\">[</bpt>Azure PowerShell version 0.8.14<ept id=\"p1\">](http://go.microsoft.com/?linkid=9811175&amp;clcid=0x409)</ept> or later.",
      "pos": [
        51310,
        51455
      ]
    },
    {
      "content": "How to create a policy based Shared Access Signature token",
      "pos": [
        51461,
        51519
      ]
    },
    {
      "content": "Use the New-AzureStorageTableStoredAccessPolicy cmdlet to create a new stored access policy.",
      "pos": [
        51520,
        51612
      ]
    },
    {
      "content": "Then, call the <bpt id=\"p1\">[</bpt>New-AzureStorageTableSASToken<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806400.aspx)</ept> cmdlet to create a new policy-based shared access signature token for an Azure Storage table.",
      "pos": [
        51613,
        51808
      ]
    },
    {
      "content": "How to create an ad hoc (non-revokable) Shared Access Signature token",
      "pos": [
        52077,
        52146
      ]
    },
    {
      "pos": [
        52147,
        52345
      ],
      "content": "Use the <bpt id=\"p1\">[</bpt>New-AzureStorageTableSASToken<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806400.aspx)</ept> cmdlet to create a new ad hoc (non-revokable) Shared Access Signature token for an Azure Storage table:"
    },
    {
      "content": "How to create a stored access policy",
      "pos": [
        52485,
        52521
      ]
    },
    {
      "content": "Use the New-AzureStorageTableStoredAccessPolicy cmdlet to create a new stored access policy for an Azure Storage table:",
      "pos": [
        52522,
        52641
      ]
    },
    {
      "content": "How to update a stored access policy",
      "pos": [
        52829,
        52865
      ]
    },
    {
      "content": "Use the Set-AzureStorageTableStoredAccessPolicy cmdlet to update an existing stored access policy for an Azure Storage table:",
      "pos": [
        52866,
        52991
      ]
    },
    {
      "content": "How to delete a stored access policy",
      "pos": [
        53134,
        53170
      ]
    },
    {
      "content": "Use the Remove-AzureStorageTableStoredAccessPolicy cmdlet to delete a stored access policy on an Azure Storage table:",
      "pos": [
        53171,
        53288
      ]
    },
    {
      "content": "How to use Azure Storage for U.S.",
      "pos": [
        53390,
        53423
      ]
    },
    {
      "content": "government and Azure China",
      "pos": [
        53424,
        53450
      ]
    },
    {
      "content": "An Azure environment is an independent deployment of Microsoft Azure, such as <bpt id=\"p1\">[</bpt>Azure Government for U.S. government<ept id=\"p1\">](http://azure.microsoft.com/features/gov/)</ept>, <bpt id=\"p2\">[</bpt>AzureCloud for global Azure<ept id=\"p2\">](https://manage.windowsazure.com)</ept>, and <bpt id=\"p3\">[</bpt>AzureChinaCloud for Azure operated by 21Vianet in China<ept id=\"p3\">](http://www.windowsazure.cn/)</ept>.",
      "pos": [
        53451,
        53766
      ]
    },
    {
      "content": "You can deploy new Azure environments for U.S government and Azure China.",
      "pos": [
        53767,
        53840
      ]
    },
    {
      "content": "To use Azure Storage with AzureChinaCloud, you need to create a storage context that is associated with AzureChinaCloud.",
      "pos": [
        53842,
        53962
      ]
    },
    {
      "content": "Follow these steps to get you started:",
      "pos": [
        53963,
        54001
      ]
    },
    {
      "pos": [
        54007,
        54141
      ],
      "content": "Run the <bpt id=\"p1\">[</bpt>Get-AzureEnvironment<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/dn790368.aspx)</ept> cmdlet to see the available Azure environments:"
    },
    {
      "content": "Add an Azure China account to Windows PowerShell:",
      "pos": [
        54175,
        54224
      ]
    },
    {
      "content": "Create a storage context for an AzureChinaCloud account:",
      "pos": [
        54283,
        54339
      ]
    },
    {
      "pos": [
        54475,
        54664
      ],
      "content": "To use Azure Storage with <bpt id=\"p1\">[</bpt>U.S. Azure Government<ept id=\"p1\">](http://azure.microsoft.com/features/gov/)</ept>, you should define a new environment and then create a new storage context with this environment:"
    },
    {
      "pos": [
        54669,
        54825
      ],
      "content": "Call the <bpt id=\"p1\">[</bpt>Add-AzureEnvironment<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn790364.aspx)</ept> cmdlet to create a new Azure environment for your private datacenter."
    },
    {
      "pos": [
        55333,
        55501
      ],
      "content": "Run the <bpt id=\"p1\">[</bpt>New-AzureStorageContext<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn806380.aspx)</ept> cmdlet to create a new storage context for this new environment as shown below."
    },
    {
      "content": "For more information, see:",
      "pos": [
        55638,
        55664
      ]
    },
    {
      "pos": [
        55668,
        55753
      ],
      "content": "<bpt id=\"p1\">[</bpt>Microsoft Azure Government Developer Guide<ept id=\"p1\">](../azure-government-developer-guide.md)</ept>."
    },
    {
      "content": "Differences between AzureCloud for global Azure and AzureChinaCloud for Azure operated by 21Vianet in China",
      "pos": [
        55757,
        55864
      ]
    },
    {
      "content": "Next Steps",
      "pos": [
        55926,
        55936
      ]
    },
    {
      "content": "In this guide, you've learned how to manage Azure Storage with Azure PowerShell.",
      "pos": [
        55937,
        56017
      ]
    },
    {
      "content": "Here are some related articles and resources for learning more about them.",
      "pos": [
        56018,
        56092
      ]
    },
    {
      "content": "Azure Storage Documentation",
      "pos": [
        56097,
        56124
      ]
    },
    {
      "content": "Azure Storage MSDN Reference",
      "pos": [
        56189,
        56217
      ]
    },
    {
      "content": "Azure Storage PowerShell Cmdlets",
      "pos": [
        56277,
        56309
      ]
    },
    {
      "content": "Windows PowerShell Reference",
      "pos": [
        56369,
        56397
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Using Azure PowerShell with Azure Storage | Microsoft Azure\"\n    description=\"Learn how to use the Azure PowerShell cmdlets for Azure Storage to create and manage storage accounts; work with blobs, tables, queues, and files; configure and query storage analytics, and create shared access signatures.\"\n    services=\"storage\"\n    documentationCenter=\"na\"\n    authors=\"tamram\" \n    manager=\"adinah\"/>\n\n<tags\n    ms.service=\"storage\"\n    ms.workload=\"storage\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"05/27/2015\"\n    ms.author=\"selcint\"/>\n\n# Using Azure PowerShell with Azure Storage\n\n## Overview\n\nIn this guide, we’ll explore how to use the [Azure Service Management Cmdlets for Storage](https://msdn.microsoft.com/library/azure/dn806401.aspx) to perform a variety of development and administration tasks with Azure Storage.\n\nAzure PowerShell is a module that provides cmdlets to manage Azure through Windows PowerShell. It is a task-based command-line shell and scripting language designed especially for system administration. With PowerShell, you can easily control and automate the administration of your Azure services and applications. For example, you can use the cmdlets to perform the same tasks that you can perform through the Azure Management Portal.\n\nThis guide assumes that you have prior experience using [Azure Storage](http://azure.microsoft.com/documentation/services/storage/) and [Windows PowerShell](http://technet.microsoft.com/library/bb978526.aspx). The guide provides a number of scripts to demonstrate the usage of PowerShell with Azure Storage. You should update the script variables based on your configuration before running each script.\n\nThe first section in this guide provides a quick glance at Azure Storage and PowerShell. For detailed information and instructions, start from the [Prerequisites for using Azure PowerShell with Azure Storage](#prerequisites-for-using-azure-powershell-with-azure-storage).\n\n\n## Getting started with Azure Storage and PowerShell in 5 minutes\n\nThis section shows you how to access Azure Storage via PowerShell in 5 minutes.\n\n**New to Azure:** Get a Microsoft Azure subscription and a Microsoft account associated with that subscription. For information on Azure purchase options, see [Free Trial](http://azure.microsoft.com/pricing/free-trial/), [Purchase Options](http://azure.microsoft.com/pricing/purchase-options/), and [Member Offers](http://azure.microsoft.com/pricing/member-offers/) (for members of MSDN, Microsoft Partner Network, and BizSpark, and other Microsoft programs).\n\nSee [Manage Accounts, Subscriptions, and Administrative Roles](https://msdn.microsoft.com/library/azure/hh531793.aspx) for more information about Azure subscriptions.\n\n**After creating a Microsoft Azure subscription and account:**\n\n1.  Download and install [Azure PowerShell](http://go.microsoft.com/?linkid=9811175&clcid=0x409).\n2.  Start Windows PowerShell Integrated Scripting Environment (ISE): In your local computer, go to the **Start** menu. Type **Administrative Tools** and click to run it. In the **Administrative Tools** window, right-click **Windows PowerShell ISE**, click **Run as Administrator**.\n3.  In **Windows PowerShell ISE**, click **File** > **New** to create a new script file.\n4.  Now, we’ll give you a simple script that shows basic PowerShell commands to access Azure Storage. The script will first ask your Azure account credentials to add your Azure account to the local PowerShell environment. Then, the script will set the default Azure subscription and create a new storage account in Azure. Next, the script will create a new container in this new storage account and upload an existing image file (blob) to that container. After the script lists all blobs in that container, it will create a new destination directory in your local computer and download the image file.\n5.  In the following code section, select the script between the remarks **#begin** and **#end**. Press CTRL+C to copy it to the clipboard.\n\n        #begin\n        # Update with the name of your subscription.\n        $SubscriptionName=\"YourSubscriptionName\"\n\n        # Give a name to your new storage account. It must be lowercase!\n        $StorageAccountName=\"yourstorageaccountname\"\n\n        # Choose \"West US\" as an example.\n        $Location = \"West US\"\n\n        # Give a name to your new container.\n        $ContainerName = \"imagecontainer\"\n\n        # Have an image file and a source directory in your local computer.\n        $ImageToUpload = \"C:\\Images\\HelloWorld.png\"\n\n        # A destination directory in your local computer.\n        $DestinationFolder = \"C:\\DownloadImages\"\n\n        # Add your Azure account to the local PowerShell environment.\n        Add-AzureAccount\n\n        # Set a default Azure subscription.\n        Select-AzureSubscription -SubscriptionName $SubscriptionName –Default\n\n        # Create a new storage account.\n        New-AzureStorageAccount –StorageAccountName $StorageAccountName -Location $Location\n\n        # Set a default storage account.\n        Set-AzureSubscription -CurrentStorageAccountName $StorageAccountName -SubscriptionName $SubscriptionName\n\n        # Create a new container.\n        New-AzureStorageContainer -Name $ContainerName -Permission Off\n\n        # Upload a blob into a container.\n        Set-AzureStorageBlobContent -Container $ContainerName -File $ImageToUpload\n\n        # List all blobs in a container.\n        Get-AzureStorageBlob -Container $ContainerName\n\n        # Download blobs from the container:\n        # Get a reference to a list of all blobs in a container.\n        $blobs = Get-AzureStorageBlob -Container $ContainerName\n\n        # Create the destination directory.\n        New-Item -Path $DestinationFolder -ItemType Directory -Force  \n\n        # Download blobs into the local destination directory.\n        $blobs | Get-AzureStorageBlobContent –Destination $DestinationFolder\n        #end\n\n5.  In **Windows PowerShell ISE**, press CTRL+V to copy the script. Click **File** > **Save**. In the **Save As** dialog window, type the name of the script file, such as \"mystoragescript\". Click **Save**.\n\n6.  Now, you need to update the script variables based on your configuration settings. You must update the **$SubscriptionName** variable with your own subscription. You can keep the other variables as specified in the script or update them as you wish.\n\n    - **$SubscriptionName:** You must update this variable with your own subscription name. Follow one of the following three ways to locate the name of your subscription:\n\n        a. In **Windows PowerShell ISE**, click **File** > **New** to create a new script file. Copy the following script to the new script file and click **Debug** > **Run**. The following script will first ask your Azure account credentials to add your Azure account to the local PowerShell environment and then show all the subscriptions that are connected to the local PowerShell session. Take a note of the name of the subscription that you want to use while following this tutorial:\n\n            Add-AzureAccount\n            Get-AzureSubscription | Format-Table SubscriptionName, IsDefault, IsCurrent, CurrentStorageAccountName\n\n\n        b. Currently, Azure supports two portals: the [Azure Management Portal](https://manage.windowsazure.com/) and the [Azure Preview Portal](https://portal.azure.com/). If you sign in to the current [Azure Management Portal](https://portal.azure.com/), scroll down and click **Settings** on the left side of the portal. Click **Subscriptions**. Copy the name of subscription that you want to use while running the scripts given in this guide. See the following screenshot as an example.\n\n        ![Azure Management Portal][Image1]\n\n        c. If you sign in to the [Azure Preview Portal](https://portal.azure.com/), in the Hub menu on the left, click **BROWSE**. Then, click **Everything**, click **Subscriptions**. Copy the name of subscription that you want to use while running the scripts in this guide. See the following screenshot as an example.\n\n        ![Azure Preview Portal][Image2]\n\n\n    - **$StorageAccountName:** Use the given name in the script or enter a new name for your storage account. **Important:** The name of the storage account must be unique in Azure. It must be lowercase, too!\n\n    - **$Location:** Use the given \"West US\" in the script or choose other Azure locations, such as East US, North Europe, and so on.\n\n    - **$ContainerName:** Use the given name in the script or enter a new name for your container.\n\n    - **$ImageToUpload:** Enter a path to a picture on your local computer, such as: \"C:\\Images\\HelloWorld.png\".\n\n    - **$DestinationFolder:** Enter a path to a local directory to store files downloaded from Azure Storage, such as: “C:\\DownloadImages”.\n\n7.  After updating the script variables in the \"mystoragescript.ps1\" file, click **File** > **Save**. Then, click **Debug** > **Run** or press **F5** to run the script.  \n\nAfter the script runs, you should have a local destination folder that includes the downloaded image file. The following screenshot shows an example output:\n\n![Download Blobs][Image3]\n\n\n> [AZURE.NOTE] The \"Getting started with Azure Storage and PowerShell in 5 minutes\" section provided a quick introduction on how to use Azure PowerShell with Azure Storage. For detailed information and instructions, we encourage you to read the following sections.\n\n## Prerequisites for using Azure PowerShell with Azure Storage\nYou need an Azure subscription and account to run the PowerShell cmdlets given in this guide, as described above.\n\nAzure PowerShell is a module that provides cmdlets to manage Azure through Windows PowerShell. For information on installing and setting up Azure PowerShell, see [How to install and configure Azure PowerShell](../powershell-install-configure.md). We recommend that you download and install or upgrade to the latest Azure PowerShell module before using this guide.\n\nYou can run the cmdlets in the Azure PowerShell console, the standard Windows PowerShell console, or the Windows PowerShell Integrated Scripting Environment (ISE). For example, to open an **Azure PowerShell console**, go to the Start menu, type Microsoft Azure PowerShell, right-click and click Run as administrator. To open **Windows PowerShell ISE**, go to the Start menu, type Administrative Tools and click to run it. In the Administrative Tools window, right-click Windows PowerShell ISE, click Run as Administrator.\n\n## How to manage storage accounts in Azure\n\n### How to set a default Azure subscription\nTo manage Azure Storage using Azure PowerShell, you need to authenticate your client environment with Azure via Azure Active Directory Authentication or Certificate-based Authentication. For detailed information, see [How to install and configure Azure PowerShell](../powershell-install-configure.md) tutorial. This guide uses the Azure Active Directory authentication.\n\n1.  In the Azure PowerShell console or in Windows PowerShell ISE, type the following command to add your Azure account to the local PowerShell environment:\n\n    `Add-AzureAccount`\n\n2.  In the “Sign in to Microsoft Azure” window, type the email address and password associated with your account. Azure authenticates and saves the credential information, and then closes the window.\n\n3.  Next, run the following command to view the Azure accounts in your local PowerShell environment, and verify that your account is listed:\n\n    `Get-AzureAccount`\n\n4.  Then, run the following cmdlet to view all the subscriptions that are connected to the local PowerShell session, and verify that your subscription is listed:\n\n    `Get-AzureSubscription | Format-Table SubscriptionName, IsDefault, IsCurrent, CurrentStorageAccountName`\n\n5.  To set a default Azure subscription, run the Select-AzureSubscription cmdlet:\n\n        $SubscriptionName = 'Your subscription Name'\n        Select-AzureSubscription -SubscriptionName $SubscriptionName –Default\n\n6.  Verify the name of the default subscription by running the Get-AzureSubscription cmdlet:\n\n    `Get-AzureSubscription -Default`\n\n7.  To see all the available PowerShell cmdlets for Azure Storage, run:\n\n    `Get-Command -Module Azure -Noun *Storage*`\n\n### How to create a new Azure storage account\nTo use Azure storage, you will need a storage account. You can create a new Azure storage account after you have configured your computer to connect to your subscription.\n\n1.  Run the Get-AzureLocation cmdlet to find all the available datacenter locations:\n\n    `Get-AzureLocation | format-Table -Property Name, AvailableServices, StorageAccountTypes`\n\n2.  Next, run the New-AzureStorageAccount cmdlet to create a new storage account. The following example creates a new storage account in the \"West US\" datacenter.\n\n        $location = \"West US\"\n        $StorageAccountName = \"yourstorageaccount\"\n        New-AzureStorageAccount –StorageAccountName $StorageAccountName -Location $location\n\n> [AZURE.IMPORTANT] The name of your storage account must be unique within Azure and must be lowercase. For naming conventions and restrictions, see [About Azure Storage Accounts](storage-create-storage-account.md) and [Naming and Referencing Containers, Blobs, and Metadata](http://msdn.microsoft.com/library/azure/dd135715.aspx).\n\n### How to set a default Azure storage account\nYou can have multiple storage accounts in your subscription. You can choose one of them and set it as the default storage account for all the storage commands in the same PowerShell session. This enables you to run the Azure PowerShell storage commands without specifying the storage context explicitly.\n\n1.  To set a default storage account for your subscription, you can run the Set-AzureSubscription cmdlet.\n\n        $SubscriptionName = \"Your subscription name\"\n        $StorageAccountName = \"yourstorageaccount\"  \n        Set-AzureSubscription -CurrentStorageAccountName $StorageAccountName -SubscriptionName $SubscriptionName\n\n2.  Next, run the Get-AzureSubscription cmdlet to verify that the storage account is associated with your default subscription account. This command returns the subscription properties on the current subscription including its current storage account.\n\n        Get-AzureSubscription –Current\n\n### How to list all Azure storage accounts in a subscription\nEach Azure subscription can have up to 100 storage accounts. For the most up-to-date information on limits, see [Azure Subscription and Service Limits, Quotas, and Constraints](../azure-subscription-service-limits.md).\n\nRun the following cmdlet to find out the name and status of the storage accounts in the current subscription:\n\n    Get-AzureStorageAccount | Format-Table -Property StorageAccountName, Location, AccountType, StorageAccountStatus\n\n### How to create an Azure storage context\nAzure storage context is an object in PowerShell to encapsulate the storage credentials. Using a storage context while running any subsequent cmdlet enables you to authenticate your request without specifying the storage account and its access key explicitly. You can create a storage context in many ways, such as using storage account name and access key, shared access signature (SAS) token, connection string, or anonymous. For more information, see [New-AzureStorageContext](http://msdn.microsoft.com/library/azure/dn806380.aspx).  \n\nUse one of the following three ways to create a storage context:\n\n- Run the [Get-AzureStorageKey](http://msdn.microsoft.com/library/azure/dn495235.aspx) cmdlet to find out the primary storage access key for your Azure storage account. Next, call the [New-AzureStorageContext](http://msdn.microsoft.com/library/azure/dn806380.aspx) cmdlet to create a storage context:\n\n        $StorageAccountName = \"yourstorageaccount\"\n        $StorageAccountKey = Get-AzureStorageKey -StorageAccountName $StorageAccountName\n        $Ctx = New-AzureStorageContext $StorageAccountName -StorageAccountKey $StorageAccountKey.Primary\n\n\n- Generate a shared access signature token for an Azure storage container and use it to create a storage context:\n\n        $sasToken = New-AzureStorageContainerSASToken -Container abc -Permission rl\n        $Ctx = New-AzureStorageContext -StorageAccountName $StorageAccountName -SasToken $sasToken\n\n    For more information, see [New-AzureStorageContainerSASToken](http://msdn.microsoft.com/library/azure/dn806416.aspx) and [Shared Access Signatures, Part 1: Understanding the SAS Model ](storage-dotnet-shared-access-signature-part-1.md).\n\n- In some cases, you may want to specify the service endpoints when you create a new storage context. This might be necessary when you have registered a custom domain name for your storage account with the Blob service or you want to use a shared access signature for accessing storage resources. Set the service endpoints in a connection string and use it to create a new storage context as shown below:\n\n        $ConnectionString = \"DefaultEndpointsProtocol=http;BlobEndpoint=<blobEndpoint>;QueueEndpoint=<QueueEndpoint>;TableEndpoint=<TableEndpoint>;AccountName=<AccountName>;AccountKey=<AccountKey>\"\n        $Ctx = New-AzureStorageContext -ConnectionString $ConnectionString\n\nFor more information on how to configure a storage connection string, see [Configuring Connection Strings](storage-configure-connection-string.md).\n\nNow that you have set up your computer and learned how to manage subscriptions and storage accounts using Azure PowerShell. Go to the next section to learn how to manage Azure blobs and blob snapshots.\n\n## How to manage Azure blobs and blob snapshots\nAzure Blob storage is a service for storing large amounts of unstructured data, such as text or binary data, that can be accessed from anywhere in the world via HTTP or HTTPS. This section assumes that you are already familiar with the Azure Blob Storage Service concepts. For detailed information, see [How to use Blob Storage from .NET](storage-dotnet-how-to-use-blobs.md) and [Blob Service Concepts](http://msdn.microsoft.com/library/azure/dd179376.aspx).\n\n### How to create a container\nEvery blob in Azure storage must be in a container. You can create a private container using the New-AzureStorageContainer cmdlet:\n\n    $StorageContainerName = \"yourcontainername\"\n    New-AzureStorageContainer -Name $StorageContainerName -Permission Off\n\n> [AZURE.NOTE] There are three levels of anonymous read access: **Off**, **Blob**, and **Container**. To prevent anonymous access to blobs, set the Permission parameter to **Off**. By default, the new container is private and can be accessed only by the account owner. To allow anonymous public read access to blob resources, but not to container metadata or to the list of blobs in the container, set the Permission parameter to **Blob**. To allow full public read access to blob resources, container metadata, and the list of blobs in the container, set the Permission parameter to **Container**. For more information, see [Manage Access to Azure Storage Resources](storage-manage-access-to-resources.md).\n\n### How to upload a blob into a container\nAzure Blob Storage supports block blobs and page blobs. For more information, see [Understanding Block Blobs and Page Blobs](http://msdn.microsoft.com/library/azure/ee691964.aspx).\n\nTo upload blobs in to a container, you can use the [Set-AzureStorageBlobContent](http://msdn.microsoft.com/library/azure/dn806379.aspx) cmdlet. By default, this command uploads the local files to a block blob. To specify the type for the blob, you can use the -BlobType parameter.\n\nThe following example runs the [Get-ChildItem](http://technet.microsoft.com/library/hh849800.aspx) cmdlet to get all the files in the specified folder, and then passes them to the next cmdlet by using the pipeline operator. The [Set-AzureStorageBlobContent](http://msdn.microsoft.com/library/azure/dn806379.aspx) cmdlet uploads the local files to your container:\n\n    Get-ChildItem –Path C:\\Images\\* | Set-AzureStorageBlobContent -Container \"yourcontainername\"\n\n### How to download blobs from a container\nThe following example demonstrates how to download blobs from a container. The example first establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its primary access key. Then, the example retrieves a blob reference using the [Get-AzureStorageBlob](http://msdn.microsoft.com/library/azure/dn806392.aspx) cmdlet. Next, the example uses the [Get-AzureStorageBlobContent](http://msdn.microsoft.com/library/azure/dn806418.aspx) cmdlet to download blobs into the local destination folder.\n\n    #Define the variables.\n    $ContainerName = \"yourcontainername\"\n    $DestinationFolder = \"C:\\DownloadImages\"\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = \"Storage key for yourstorageaccount ends with ==\"\n    $Ctx = New-AzureStorageContext -StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey\n\n    #List all blobs in a container.\n    $blobs = Get-AzureStorageBlob -Container $ContainerName -Context $Ctx\n\n    #Download blobs from a container.\n    New-Item -Path $DestinationFolder -ItemType Directory -Force\n    $blobs | Get-AzureStorageBlobContent -Destination $DestinationFolder -Context $Ctx\n\n### How to copy blobs from one storage container to another\nYou can copy blobs across storage accounts and regions asynchronously. The following example demonstrates how to copy blobs from one storage container to another in two different storage accounts. The example first sets variables for source and destination storage accounts, and then creates a storage context for each account. Next, the example copies blobs from the source container to the destination container using the [Start-AzureStorageBlobCopy](http://msdn.microsoft.com/library/azure/dn806394.aspx) cmdlet. The example assumes that the source and destination storage accounts and containers already exist.\n\n    #Define the source storage account and context.\n    $SourceStorageAccountName = \"yoursourcestorageaccount\"\n    $SourceStorageAccountKey = \"Storage key for yoursourcestorageaccount\"\n    $SrcContainerName = \"yoursrccontainername\"\n    $SourceContext = New-AzureStorageContext -StorageAccountName $SourceStorageAccountName -StorageAccountKey $SourceStorageAccountKey\n\n    #Define the destination storage account and context.\n    $DestStorageAccountName = \"yourdeststorageaccount\"\n    $DestStorageAccountKey = \"Storage key for yourdeststorageaccount\"\n    $DestContainerName = \"destcontainername\"\n    $DestContext = New-AzureStorageContext -StorageAccountName $DestStorageAccountName -StorageAccountKey $DestStorageAccountKey\n\n    #Get a reference to blobs in the source container.\n    $blobs = Get-AzureStorageBlob -Container $SrcContainerName -Context $SourceContext\n\n    #Copy blobs from one container to another.\n    $blobs| Start-AzureStorageBlobCopy -DestContainer $DestContainerName -DestContext $DestContext\n\nNote that this example performs an asynchronous copy. You can monitor the status of each copy by running the [Get-AzureStorageBlobCopyState](http://msdn.microsoft.com/library/azure/dn806406.aspx) cmdlet.\n\n### How to copy blobs from a secondary location\nYou can copy blobs from the secondary locatioon of a RA-GRS enabled account. \n\n    #define secondary storage context using a connection string constructed from secondary endpoints. \n    $SrcContext = New-AzureStorageContext -ConnectionString \"DefaultEndpointsProtocol=https;AccountName=***;AccountKey=***;BlobEndpoint=http://***-secondary.blob.core.windows.net;FileEndpoint=http://***-secondary.file.core.windows.net;QueueEndpoint=http://***-secondary.queue.core.windows.net; TableEndpoint=http://***-secondary.table.core.windows.net;\"\n    Start-AzureStorageBlobCopy –Container *** -Blob *** -Context $SrcContext –DestContainer *** -DestBlob *** -DestContext $DestContext\n\n### How to delete a blob\nTo delete a blob, first get a blob reference and then call the Remove-AzureStorageBlob cmdlet on it. The following example deletes all the blobs in a given container. The example first sets variables for a storage account, and then creates a storage context. Next, the example retrieves a blob reference using the [Get-AzureStorageBlob](http://msdn.microsoft.com/library/azure/dn806392.aspx) cmdlet and runs the [Remove-AzureStorageBlob](http://msdn.microsoft.com/library/azure/dn806399.aspx) cmdlet to remove blobs from a container in Azure storage.\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = \"Storage key for yourstorageaccount ends with ==\"\n    $ContainerName = \"containername\"\n    $Ctx = New-AzureStorageContext -StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey\n\n    #Get a reference to all the blobs in the container.\n    $blobs = Get-AzureStorageBlob -Container $ContainerName -Context $Ctx\n\n    #Delete blobs in a specified container.\n    $blobs| Remove-AzureStorageBlob\n\n## How to manage Azure blob snapshots\nAzure lets you create a snapshot of a blob. A snapshot is a read-only version of a blob that's taken at a point in time. Once a snapshot has been created, it can be read, copied, or deleted, but not modified. Snapshots provide a way to back up a blob as it appears at a moment in time. For more information, see [Creating a Snapshot of a Blob](http://msdn.microsoft.com/library/azure/hh488361.aspx).\n\n### How to create a blob snapshot\nTo create a snaphot of a blob, first get a blob reference and then call the `ICloudBlob.CreateSnapshot` method on it. The following example first sets variables for a storage account, and then creates a storage context. Next, the example retrieves a blob reference using the [Get-AzureStorageBlob](http://msdn.microsoft.com/library/azure/dn806392.aspx) cmdlet and runs the [ICloudBlob.CreateSnapshot](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.icloudblob.aspx) method to create a snapshot.\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = \"Storage key for yourstorageaccount ends with ==\"\n    $ContainerName = \"yourcontainername\"\n    $BlobName = \"yourblobname\"\n    $Ctx = New-AzureStorageContext -StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey\n\n    #Get a reference to a blob.\n    $blob = Get-AzureStorageBlob -Context $Ctx -Container $ContainerName -Blob $BlobName\n\n    #Create a snapshot of the blob.\n    $snap = $blob.ICloudBlob.CreateSnapshot()\n\n### How to list a blob's snapshots\nYou can create as many snapshots as you want for a blob. You can list the snapshots associated with your blob to track your current snapshots. The following example uses a predefined blob and calls the [Get-AzureStorageBlob](http://msdn.microsoft.com/library/azure/dn806392.aspx) cmdlet to list the snapshots of that blob.  \n\n    #Define the blob name.\n    $BlobName = \"yourblobname\"\n\n    #List the snapshots of a blob.\n    Get-AzureStorageBlob –Context $Ctx -Prefix $BlobName -Container $ContainerName  | Where-Object  { $_.ICloudBlob.IsSnapshot -and $_.Name -eq $BlobName }\n\n### How to copy a snapshot of a blob\nYou can copy a snapshot of a blob to restore the snapshot. For detailed information and restrictions, see [Creating a Snapshot of a Blob](http://msdn.microsoft.com/library/azure/hh488361.aspx). The following example first sets variables for a storage account, and then creates a storage context. Next, the example defines the container and blob name variables. The example retrieves a blob reference using the [Get-AzureStorageBlob](http://msdn.microsoft.com/library/azure/dn806392.aspx) cmdlet and runs the [ICloudBlob.CreateSnapshot](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.icloudblob.aspx) method to create a snapshot. Then, the example runs the [Start-AzureStorageBlobCopy](http://msdn.microsoft.com/library/azure/dn806394.aspx) cmdlet to copy the snapshot of a blob using the ICloudBlob object for the source blob. Be sure to update the variables based on your configuration before running the example. Note that the following example assumes that the source and destination containers, and the source blob already exist.\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = \"Storage key for yourstorageaccount ends with ==\"\n    $Ctx = New-AzureStorageContext -StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey\n\n    #Define the variables.\n    $SrcContainerName = \"yoursourcecontainername\"\n    $DestContainerName = \"yourdestcontainername\"\n    $SrcBlobName = \"yourblobname\"\n    $DestBlobName = \"CopyBlobName\"\n\n    #Get a reference to a blob.\n    $blob = Get-AzureStorageBlob -Context $Ctx -Container $SrcContainerName -Blob $SrcBlobName\n\n    #Create a snapshot of a blob.\n    $snap = $blob.ICloudBlob.CreateSnapshot()\n\n    #Copy the snapshot to another container.\n    Start-AzureStorageBlobCopy –Context $Ctx -ICloudBlob $snap -DestBlob $DestBlobName -DestContainer $DestContainerName\n\nNow that you have learned how to manage Azure blobs and blob snapshots with Azure PowerShell. Go to the next section to learn how to manage tables, queues, and files.\n\n## How to manage Azure tables and table entities\nAzure Table storage service is a NoSQL datastore, which you can use to store and query huge sets of structured, non-relational data. The main components of the service are tables, entities, and properties. A table is a collection of entities. An entity is a set of properties. Each entity can have up to 252 properties, which are all name-value pair. This section assumes that you are already familiar with the Azure Table Storage Service concepts. For detailed information, see [Understanding the Table Service Data Model](http://msdn.microsoft.com/library/azure/dd179338.aspx) and [How to use Table Storage from .NET](storage-dotnet-how-to-use-tables.md).\n\nIn the following sub sections, you’ll learn how to manage Azure Table storage service using Azure PowerShell. The scenarios covered include **creating**, **deleting**, and **retrieving** **tables**, as well as **adding**, **querying**, and **deleting table entities**.\n\n### How to create a table\nEvery table must reside in an Azure storage account. The following example demonstrates how to create a table in Azure Storage. The example first establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its access key. Next, it uses the [New-AzureStorageTable](http://msdn.microsoft.com/library/azure/dn806417.aspx) cmdlet to create a table in Azure Storage.\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = \"Storage key for yourstorageaccount ends with ==\"\n    $Ctx = New-AzureStorageContext $StorageAccountName -StorageAccountKey $StorageAccountKey\n\n    #Create a new table.\n    $tabName = \"yourtablename\"\n    New-AzureStorageTable –Name $tabName –Context $Ctx\n\n### How to retrieve a table\nYou can query and retrieve one or all tables in a Storage account. The following example demonstrates how to retrieve a given table using the [Get-AzureStorageTable](http://msdn.microsoft.com/library/azure/dn806411.aspx) cmdlet.\n\n    #Retrieve a table.\n    $tabName = \"yourtablename\"\n    Get-AzureStorageTable –Name $tabName –Context $Ctx\n\nIf you call the Get-AzureStorageTable cmdlet without any parameters, it gets all storage tables for a Storage account.\n\n### How to delete a table\nYou can delete a table from a storage account by using the [Remove-AzureStorageTable](http://msdn.microsoft.com/library/azure/dn806393.aspx) cmdlet.  \n\n    #Delete a table.\n    $tabName = \"yourtablename\"\n    Remove-AzureStorageTable –Name $tabName –Context $Ctx\n\n### How to manage table entities\nCurrently, Azure PowerShell does not provide cmdlets to manage table entities directly. To perform operations on table entities, you can use the classes given in the [Azure Storage Client Library for .NET](http://msdn.microsoft.com/library/azure/wa_storage_30_reference_home.aspx).\n\n#### How to add table entities\nTo add an entity to a table, first create an object that defines your entity properties. An entity can have up to 255 properties, including 3 system properties: **PartitionKey**, **RowKey**, and **Timestamp**. You are responsible for inserting and updating the values of **PartitionKey** and **RowKey**. The server manages the value of **Timestamp**, which cannot be modified. Together the **PartitionKey** and **RowKey** uniquely identify every entity within a table.\n\n-   **PartitionKey**: Determines the partition that the entity is stored in.\n-   **RowKey**: Uniquely identifies the entity within the partition.\n\nYou may define up to 252 custom properties for an entity. For more information, see [Understanding the Table Service Data Model](http://msdn.microsoft.com/library/azure/dd179338.aspx).\n\nThe following example demonstrates how to add entities to a table. The example shows how to retrieve the employee table and add several entities into it. First, it establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its access key. Next, it retrieves the given table using the [Get-AzureStorageTable](http://msdn.microsoft.com/library/azure/dn806411.aspx) cmdlet. If the table does not exist, the [New-AzureStorageTable](http://msdn.microsoft.com/library/azure/dn806417.aspx) cmdlet is used to create a table in Azure Storage. Next, the example defines a custom function Add-Entity to add entities to the table by specifying each entity’s partition and row key. The Add-Entity function calls the [New-Object](http://technet.microsoft.com/library/hh849885.aspx) cmdlet on the [Microsoft.WindowsAzure.Storage.Table.DynamicTableEntity](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.dynamictableentity.aspx) class to create an entity object. Later, the example calls the [Microsoft.WindowsAzure.Storage.Table.TableOperation.Insert](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.tableoperation.insert.aspx) method on this entity object to add it to a table.\n\n    #Function Add-Entity: Adds an employee entity to a table.\n    function Add-Entity() {\n        [CmdletBinding()]\n        param(\n           $table,\n           [String]$partitionKey,\n           [String]$rowKey,\n           [String]$name,\n           [Int]$id\n        )\n\n      $entity = New-Object -TypeName Microsoft.WindowsAzure.Storage.Table.DynamicTableEntity -ArgumentList $partitionKey, $rowKey\n      $entity.Properties.Add(\"Name\", $name)\n      $entity.Properties.Add(\"ID\", $id)\n\n      $result = $table.CloudTable.Execute([Microsoft.WindowsAzure.Storage.Table.TableOperation]::Insert($entity))\n    }\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = Get-AzureStorageKey -StorageAccountName $StorageAccountName\n    $Ctx = New-AzureStorageContext $StorageAccountName -StorageAccountKey $StorageAccountKey.Primary\n    $TableName = \"Employees\"\n\n    #Retrieve the table if it already exists.\n    $table = Get-AzureStorageTable –Name $TableName -Context $Ctx -ErrorAction Ignore\n\n    #Create a new table if it does not exist.\n    if ($table -eq $null)\n    {\n       $table = New-AzureStorageTable –Name $TableName -Context $Ctx\n    }\n\n    #Add multiple entities to a table.\n    Add-Entity -Table $table -PartitionKey Partition1 -RowKey Row1 -Name Chris -Id 1\n    Add-Entity -Table $table -PartitionKey Partition1 -RowKey Row2 -Name Jessie -Id 2\n    Add-Entity -Table $table -PartitionKey Partition2 -RowKey Row1 -Name Christine -Id 3\n    Add-Entity -Table $table -PartitionKey Partition1 -RowKey Row2 -Name Steven -Id 4\n\n#### How to query table entities\nTo query a table, use the [Microsoft.WindowsAzure.Storage.Table.TableQuery](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.tablequery.aspx) class. The following example assumes that you’ve already run the script given in the How to add entities section of this guide. The example first establishes a connection to Azure Storage using the storage context, which includes the storage account name and its access key. Next, it tries to retrieve the previously created “Employees” table using the [Get-AzureStorageTable](http://msdn.microsoft.com/library/azure/dn806411.aspx) cmdlet. Calling the [New-Object](http://technet.microsoft.com/library/hh849885.aspx) cmdlet on the Microsoft.WindowsAzure.Storage.Table.TableQuery class creates a new query object. The example looks for the entities that have an ‘ID’ column whose value is 1 as specified in a string filter. For detailed information, see [Querying Tables and Entities](http://msdn.microsoft.com/library/azure/dd894031.aspx). When you run this query, it returns all entities that match the filter criteria.\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = Get-AzureStorageKey -StorageAccountName $StorageAccountName\n    $Ctx = New-AzureStorageContext –StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey.Primary;\n    $TableName = \"Employees\"\n\n    #Get a reference to a table.\n    $table = Get-AzureStorageTable –Name $TableName -Context $Ctx\n\n    #Create a table query.\n    $query = New-Object Microsoft.WindowsAzure.Storage.Table.TableQuery\n\n    #Define columns to select.\n    $list = New-Object System.Collections.Generic.List[string]\n    $list.Add(\"RowKey\")\n    $list.Add(\"ID\")\n    $list.Add(\"Name\")\n\n    #Set query details.\n    $query.FilterString = \"ID gt 0\"\n    $query.SelectColumns = $list\n    $query.TakeCount = 20\n\n    #Execute the query.\n    $entities = $table.CloudTable.ExecuteQuery($query)\n\n    #Display entity properties with the table format.\n    $entities  | Format-Table PartitionKey, RowKey, @{ Label = \"Name\"; Expression={$_.Properties[\"Name\"].StringValue}}, @{ Label = \"ID\"; Expression={$_.Properties[“ID”].Int32Value}} -AutoSize\n\n#### How to delete table entities\nYou can delete an entity using its partition and row keys. The following example assumes that you’ve already run the script given in the How to add entities section of this guide. The example first establishes a connection to Azure Storage using the storage context, which includes the storage account name and its access key. Next, it tries to retrieve the previously created “Employees” table using the [Get-AzureStorageTable](http://msdn.microsoft.com/library/azure/dn806411.aspx) cmdlet. If the table exists, the example calls the [Microsoft.WindowsAzure.Storage.Table.TableOperation.Retrieve](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.tableoperation.retrieve.aspx) method to retrieve an entity based on its partition and row key values. Then, pass the entity to the  [Microsoft.WindowsAzure.Storage.Table.TableOperation.Delete](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.table.tableoperation.delete.aspx) method to delete.\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = Get-AzureStorageKey -StorageAccountName $StorageAccountName\n    $Ctx = New-AzureStorageContext –StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey.Primary\n\n    #Retrieve the table.\n    $TableName = \"Employees\"\n    $table = Get-AzureStorageTable -Name $TableName -Context $Ctx -ErrorAction Ignore\n\n    #If the table exists, start deleting its entities.\n    if ($table -ne $null) {\n       #Together the PartitionKey and RowKey uniquely identify every  \n       #entity within a table.\n       $tableResult = $table.CloudTable.Execute([Microsoft.WindowsAzure.Storage.Table.TableOperation]::Retrieve(“Partition2”, \"Row1\"))\n       $entity = $tableResult.Result;\n    if ($entity -ne $null)\n    {\n       #Delete the entity.$table.CloudTable.Execute([Microsoft.WindowsAzure.Storage.Table.TableOperation]::Delete($entity))\n    }\n    }\n\n## How to manage Azure queues and queue messages\nAzure Queue storage is a service for storing large numbers of messages that can be accessed from anywhere in the world via authenticated calls using HTTP or HTTPS. This section assumes that you are already familiar with the Azure Queue Storage Service concepts. For detailed information, see [How to use Queue Storage from .NET](storage-dotnet-how-to-use-queues.md).\n\nThis section will show you how to manage Azure Queue storage service using Azure PowerShell. The scenarios covered include **inserting** and **deleting** queue messages, as well as **creating**, **deleting**, and **retrieving queues**.\n\n### How to create a queue\nThe following example first establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its access key. Next, it calls [New-AzureStorageQueue](http://msdn.microsoft.com/library/azure/dn806382.aspx) cmdlet to create a queue named ‘queuename’.\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = Get-AzureStorageKey -StorageAccountName $StorageAccountName\n    $Ctx = New-AzureStorageContext –StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey.Primary\n    $QueueName = \"queuename\"\n    $Queue = New-AzureStorageQueue –Name $QueueName -Context $Ctx\n\nFor information on naming conventions for Azure Queue Service, see [Naming Queues and Metadata](http://msdn.microsoft.com/library/azure/dd179349.aspx).\n\n### How to retrieve a queue\nYou can query and retrieve a specific queue or a list of all the queues in a Storage account. The following example demonstrates how to retrieve a specified queue using the [Get-AzureStorageQueue](http://msdn.microsoft.com/library/azure/dn806377.aspx) cmdlet.\n\n    #Retrieve a queue.\n    $QueueName = \"queuename\"\n    $Queue = Get-AzureStorageQueue –Name $QueueName –Context $Ctx\n\nIf you call the [Get-AzureStorageQueue](http://msdn.microsoft.com/library/azure/dn806377.aspx) cmdlet without any parameters, it gets a list of all the queues.\n\n### How to delete a queue\nTo delete a queue and all the messages contained in it, call the Remove-AzureStorageQueue cmdlet. The following example shows how to delete a specified queue using the Remove-AzureStorageQueue cmdlet.\n\n    #Delete a queue.\n    $QueueName = \"yourqueuename\"\n    Remove-AzureStorageQueue –Name $QueueName –Context $Ctx\n\n### How to manage queue messages\nCurrently, Azure PowerShell does not provide cmdlets to manage queue messages directly. To perform operations on queue messages, you can use the classes given in the [Azure Storage Client Library for .NET](http://msdn.microsoft.com/library/azure/wa_storage_30_reference_home.aspx).\n\n#### How to insert a message into a queue\nTo insert a message into an existing queue, first create a new instance of the [Microsoft.WindowsAzure.Storage.Queue.CloudQueueMessage](http://msdn.microsoft.com/library/azure/jj732474.aspx) class. Next, call the [AddMessage](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.addmessage.aspx) method. A CloudQueueMessage can be created from either a string (in UTF-8 format) or a byte array.\n\nThe following example demonstrates how to add message to a queue. The example first establishes a connection to Azure Storage using the storage account context, which includes the storage account name and its access key. Next, it retrieves the specified queue using the [Get-AzureStorageQueue](https://msdn.microsoft.com/library/azure/dn806377.aspx) cmdlet. If the queue exists, the [New-Object](http://technet.microsoft.com/library/hh849885.aspx) cmdlet is used to create an instance of the [Microsoft.WindowsAzure.Storage.Queue.CloudQueueMessage](http://msdn.microsoft.com/library/azure/jj732474.aspx) class. Later, the example calls the [AddMessage](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.addmessage.aspx) method on this message object to add it to a queue. Here is code which retrieves a queue and inserts the message 'MessageInfo':\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = Get-AzureStorageKey -StorageAccountName $StorageAccountName\n    $Ctx = New-AzureStorageContext –StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey.Primary\n\n    #Retrieve the queue.\n    $QueueName = \"queuename\"\n    $Queue = Get-AzureStorageQueue -Name $QueueName -Context $ctx\n\n    #If the queue exists, add a new message.\n    if ($Queue -ne $null) {\n       # Create a new message using a constructor of the CloudQueueMessage class.\n       $QueueMessage = New-Object -TypeName Microsoft.WindowsAzure.Storage.Queue.CloudQueueMessage -ArgumentList MessageInfo\n\n       #Add a new message to the queue.\n       $Queue.CloudQueue.AddMessage($QueueMessage)\n    }\n\n\n#### How to de-queue at the next message\nYour code de-queues a message from a queue in two steps. When you call the [Microsoft.WindowsAzure.Storage.Queue.CloudQueue.GetMessage](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.getmessage.aspx) method, you get the next message in a queue. A message returned from **GetMessage** becomes invisible to any other code reading messages from this queue. To finish removing the message from the queue, you must also call the [Microsoft.WindowsAzure.Storage.Queue.CloudQueue.DeleteMessage](http://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.deletemessage.aspx) method. This two-step process of removing a message assures that if your code fails to process a message due to hardware or software failure, another instance of your code can get the same message and try again. Your code calls **DeleteMessage** right after the message has been processed.\n\n    #Define the storage account and context.\n    $StorageAccountName = \"yourstorageaccount\"\n    $StorageAccountKey = Get-AzureStorageKey -StorageAccountName $StorageAccountName\n    $Ctx = New-AzureStorageContext –StorageAccountName $StorageAccountName -StorageAccountKey $StorageAccountKey.Primary\n\n    #Retrieve the queue.\n    $QueueName = \"queuename\"\n    $Queue = Get-AzureStorageQueue -Name $QueueName -Context $ctx\n\n    $InvisibleTimeout = [System.TimeSpan]::FromSeconds(10)\n\n    #Get the message object from the queue.\n    $QueueMessage = $Queue.CloudQueue.GetMessage($InvisibleTimeout)\n    #Delete the message.\n    $Queue.CloudQueue.DeleteMessage($QueueMessage)\n\n## How to manage Azure file shares and files\nAzure File storage offers shared storage for applications using the standard SMB 2.1 protocol. Microsoft Azure virtual machines and cloud services can share file data across application components via mounted shares, and on-premises applications can access file data in a share via the File storage API or Azure PowerShell.\n\nFor more information on Azure File storage, see [How to use Azure File storage](storage-dotnet-how-to-use-files.md) and [File Service REST API](http://msdn.microsoft.com/library/azure/dn167006.aspx).\n\n## How to set and query storage analytics\nYou can use [Azure Storage Analytics](storage-analytics.md) to collect metrics for your Azure storage accounts and log data about requests sent to your storage account. You can use storage metrics to monitor the health of a storage account, and storage logging to diagnose and troubleshoot issues with your storage account.\nBy default, storage metrics is not enabled for your storage services. You can enable monitoring using either the Azure Management Portal, Windows PowerShell, or programmatically through a storage API. Storage logging happens server-side and enables you to record details for both successful and failed requests in your storage account. These logs enable you to see details of read, write, and delete operations against your tables, queues, and blobs as well as the reasons for failed requests.\n\nTo learn how to enable and view Storage Metrics data using PowerShell, see [How to enable Storage Metrics using PowerShell](http://msdn.microsoft.com/library/azure/dn782843.aspx#HowtoenableStorageMetricsusingPowerShell).\n\nTo learn how to enable and retrieve Storage Logging data using PowerShell, see\n[How to enable Storage Logging using PowerShell](http://msdn.microsoft.com/library/azure/dn782840.aspx#HowtoenableStorageLoggingusingPowerShell) and [Finding your Storage Logging log data](http://msdn.microsoft.com/library/azure/dn782840.aspx#FindingyourStorageLogginglogdata).\nFor detailed information on using Storage Metrics and Storage Logging to troubleshoot storage issues, see [Monitoring, Diagnosing, and Troubleshooting Microsoft Azure Storage](storage-monitoring-diagnosing-troubleshooting.md).\n\n## How to manage Shared Access Signature (SAS) and Stored Access Policy\nShared access signatures are an important part of the security model for any application using Azure Storage. They are useful for providing limited permissions to your storage account to clients that should not have the account key. By default, only the owner of the storage account may access blobs, tables, and queues within that account. If your service or application needs to make these resources available to other clients without sharing your access key, you have three options:\n\n- Set a container's permissions to permit anonymous read access to the container and its blobs. This is not allowed for tables or queues.\n- Use a shared access signature that grants restricted access rights to containers, blobs, queues, and tables for a specific time interval.\n- Use a stored access policy to obtain an additional level of control over shared access signatures for a container or its blobs, for a queue, or for a table. The stored access policy allows you to change the start time, expiry time, or permissions for a signature, or to revoke it after it has been issued.\n\nA shared access signature can be in one of two forms:\n\n- **Ad hoc SAS**: When you create an ad hoc SAS, the start time, expiry time, and permissions for the SAS are all specified on the SAS URI. This type of SAS may be created on a container, blob, table, or queue and it is non-revokable.\n- **SAS with stored access policy**: A stored access policy is defined on a resource container a blob container, table, or queue - and you can use it to manage constraints for one or more shared access signatures. When you associate a SAS with a stored access policy, the SAS inherits the constraints - the start time, expiry time, and permissions - defined for the stored access policy. This type of SAS is revokable.\n\nFor more information, see [the Shared Access Signatures tutorial](storage-dotnet-shared-access-signature-part-1.md) and [Manage Access to Azure Storage Resources](storage-manage-access-to-resources.md).\n\nIn the next sections, you will learn how to create a shared access signature token and stored access policy for Azure tables. Azure PowerShell provides similar cmdlets for containers, blobs, and queues as well. To run the scripts in this section, download the [Azure PowerShell version 0.8.14](http://go.microsoft.com/?linkid=9811175&clcid=0x409) or later.\n\n### How to create a policy based Shared Access Signature token\nUse the New-AzureStorageTableStoredAccessPolicy cmdlet to create a new stored access policy. Then, call the [New-AzureStorageTableSASToken](http://msdn.microsoft.com/library/azure/dn806400.aspx) cmdlet to create a new policy-based shared access signature token for an Azure Storage table.\n\n    $policy = \"policy1\"\n    New-AzureStorageTableStoredAccessPolicy -Name $tableName -Policy $policy -Permission \"rd\" -StartTime \"2015-01-01\" -ExpiryTime \"2016-01-01\" -Context $Ctx\n    New-AzureStorageTableSASToken -Name $tableName -Policy $policy -Context $Ctx\n\n### How to create an ad hoc (non-revokable) Shared Access Signature token\nUse the [New-AzureStorageTableSASToken](http://msdn.microsoft.com/library/azure/dn806400.aspx) cmdlet to create a new ad hoc (non-revokable) Shared Access Signature token for an Azure Storage table:\n\n    New-AzureStorageTableSASToken -Name $tableName -Permission \"rqud\" -StartTime \"2015-01-01\" -ExpiryTime \"2015-02-01\" -Context $Ctx\n\n### How to create a stored access policy\nUse the New-AzureStorageTableStoredAccessPolicy cmdlet to create a new stored access policy for an Azure Storage table:\n\n    $policy = \"policy1\"\n    New-AzureStorageTableStoredAccessPolicy -Name $tableName -Policy $policy -Permission \"rd\" -StartTime \"2015-01-01\" -ExpiryTime \"2016-01-01\" -Context $Ctx\n\n### How to update a stored access policy\nUse the Set-AzureStorageTableStoredAccessPolicy cmdlet to update an existing stored access policy for an Azure Storage table:\n\n    Set-AzureStorageTableStoredAccessPolicy -Policy $policy -Table $tableName -Permission \"rd\" -NoExpiryTime -NoStartTime -Context $Ctx\n\n### How to delete a stored access policy\nUse the Remove-AzureStorageTableStoredAccessPolicy cmdlet to delete a stored access policy on an Azure Storage table:\n\n    Remove-AzureStorageTableStoredAccessPolicy -Policy $policy -Table $tableName -Context $Ctx\n\n\n## How to use Azure Storage for U.S. government and Azure China\nAn Azure environment is an independent deployment of Microsoft Azure, such as [Azure Government for U.S. government](http://azure.microsoft.com/features/gov/), [AzureCloud for global Azure](https://manage.windowsazure.com), and [AzureChinaCloud for Azure operated by 21Vianet in China](http://www.windowsazure.cn/). You can deploy new Azure environments for U.S government and Azure China.\n\nTo use Azure Storage with AzureChinaCloud, you need to create a storage context that is associated with AzureChinaCloud. Follow these steps to get you started:\n\n1.  Run the [Get-AzureEnvironment](https://msdn.microsoft.com/library/azure/dn790368.aspx) cmdlet to see the available Azure environments:\n\n    `Get-AzureEnvironment`\n\n2.  Add an Azure China account to Windows PowerShell:\n\n    `Add-AzureAccount –Environment AzureChinaCloud`\n\n3.  Create a storage context for an AzureChinaCloud account:\n\n        $Ctx = New-AzureStorageContext -StorageAccountName $AccountName -StorageAccountKey $AccountKey> -Environment AzureChinaCloud\n\nTo use Azure Storage with [U.S. Azure Government](http://azure.microsoft.com/features/gov/), you should define a new environment and then create a new storage context with this environment:\n\n1. Call the [Add-AzureEnvironment](http://msdn.microsoft.com/library/azure/dn790364.aspx) cmdlet to create a new Azure environment for your private datacenter.\n\n        Add-AzureEnvironment -Name $EnvironmentName -PublishSettingsFileUrl $publishSettingsFileUrl -ServiceEndpoint $serviceEndpoint -ManagementPortalUrl $managementPortalUrl -StorageEndpoint $storageEndpoint -ActiveDirectoryEndpoint $activeDirectoryEndpoint -ResourceManagerEndpoint $resourceManagerEndpoint -GalleryEndpoint $galleryEndpoint -ActiveDirectoryServiceEndpointResourceId $activeDirectoryServiceEndpointResourceId -GraphEndpoint $graphEndpoint -SubscriptionDataFile $subscriptionDataFile\n\n2. Run the [New-AzureStorageContext](http://msdn.microsoft.com/library/azure/dn806380.aspx) cmdlet to create a new storage context for this new environment as shown below.\n\n        $Ctx = New-AzureStorageContext -StorageAccountName $AccountName -StorageAccountKey $AccountKey> -Environment $EnvironmentName\n\nFor more information, see:\n\n- [Microsoft Azure Government Developer Guide](../azure-government-developer-guide.md).\n- [Differences between AzureCloud for global Azure and AzureChinaCloud for Azure operated by 21Vianet in China](https://msdn.microsoft.com/library/azure/dn578439.aspx)\n\n## Next Steps\nIn this guide, you've learned how to manage Azure Storage with Azure PowerShell. Here are some related articles and resources for learning more about them.\n\n- [Azure Storage Documentation](http://azure.microsoft.com/documentation/services/storage/)\n- [Azure Storage MSDN Reference](http://msdn.microsoft.com/library/azure/gg433040.aspx)\n- [Azure Storage PowerShell Cmdlets](http://msdn.microsoft.com/library/azure/dn806401.aspx)\n- [Windows PowerShell Reference](https://msdn.microsoft.com/library/ms714469.aspx)\n\n[Image1]: ./media/storage-powershell-guide-full/Subscription_currentportal.png\n[Image2]: ./media/storage-powershell-guide-full/Subscription_Previewportal.png\n[Image3]: ./media/storage-powershell-guide-full/Blobdownload.png\n\n\n[Getting started with Azure Storage and PowerShell in 5 minutes]: #getstart\n[Prerequisites for using Azure PowerShell with Azure Storage]: #pre\n[How to manage storage accounts in Azure]: #manageaccount\n[How to set a default Azure subscription]: #setdefsub\n[How to create a new Azure storage account]: #createaccount\n[How to set a default Azure storage account]: #defaultaccount\n[How to list all Azure storage accounts in a subscription]: #listaccounts\n[How to create an Azure storage context]: #createctx\n[How to manage Azure blobs and blob snapshots]: #manageblobs\n[How to create a container]: #container\n[How to upload a blob into a container]: #uploadblob\n[How to download blobs from a container]: #downblob\n[How to copy blobs from one storage container to another]: #copyblob\n[How to delete a blob]: #deleteblob\n[How to manage Azure blob snapshots]: #manageshots\n[How to create a blob snapshot]: #createshot\n[How to list snapshots of a blob]: #listshot\n[How to copy a snapshot of a blob]: #copyshot\n[How to manage Azure tables and table entities]: #managetables\n[How to create a table]: #createtable\n[How to retrieve a table]: #gettable\n[How to delete a table]: #remtable\n[How to manage table entities]: #mngentity\n[How to add table entities]: #addentity\n[How to query table entities]: #queryentity\n[How to delete table entities]: #deleteentity\n[How to manage Azure queues and queue messages]: #managequeues\n[How to create a queue]: #createqueue\n[How to retrieve a queue]: #getqueue\n[How to delete a queue]: #remqueue\n[How to manage queue messages]: #mngqueuemsg\n[How to insert a message into a queue]: #addqueuemsg\n[How to de-queue at the next message]: #dequeuemsg\n[How to manage Azure file shares and files]: #files\n[How to set and query storage analytics]: #stganalytics\n[How to manage Shared Access Signature (SAS) and Stored Access Policy]: #sas\n[How to use Azure Storage for U.S. government and Azure China]: #gov\n[Next Steps]: #next\n \n"
}