{
  "nodes": [
    {
      "content": "Continuous delivery with Visual Studio Online in Azure",
      "pos": [
        27,
        81
      ]
    },
    {
      "content": "Learn how to configure your Visual Studio Online team projects to automatically build and deploy to the Web App feature in Azure App Service or cloud services.",
      "pos": [
        100,
        259
      ]
    },
    {
      "content": "Continuous delivery to Azure using Visual Studio Online",
      "pos": [
        566,
        621
      ]
    },
    {
      "content": "You can configure your Visual Studio Online team projects to automatically build and deploy to Azure web apps or cloud services.",
      "pos": [
        623,
        751
      ]
    },
    {
      "content": "(For information on how to set up a continuous build and deploy system using an <bpt id=\"p1\">*</bpt>on-premises<ept id=\"p1\">*</ept> Team Foundation Server, see <bpt id=\"p2\">[</bpt>Continuous Delivery for Cloud Services in Azure<ept id=\"p2\">](cloud-services-dotnet-continuous-delivery.md)</ept>.)",
      "pos": [
        753,
        972
      ]
    },
    {
      "content": "This tutorial assumes you have Visual Studio 2013 and the Azure SDK installed.",
      "pos": [
        974,
        1052
      ]
    },
    {
      "content": "If you don't already have Visual Studio 2013, download it by choosing the <bpt id=\"p1\">**</bpt>Get started for free<ept id=\"p1\">**</ept> link at <bpt id=\"p2\">[</bpt>www.visualstudio.com<ept id=\"p2\">](http://www.visualstudio.com)</ept>.",
      "pos": [
        1053,
        1212
      ]
    },
    {
      "content": "Install the Azure SDK from <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=239540)</ept>.",
      "pos": [
        1213,
        1294
      ]
    },
    {
      "pos": [
        1298,
        1485
      ],
      "content": "[AZURE.NOTE] You need an Visual Studio online account to complete this tutorial:\nYou can [open a Visual Studio Online account for free](http://go.microsoft.com/fwlink/p/?LinkId=512979).",
      "leadings": [
        "",
        "> "
      ],
      "nodes": [
        {
          "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You need an Visual Studio online account to complete this tutorial:",
          "pos": [
            0,
            80
          ]
        },
        {
          "content": "You can <bpt id=\"p1\">[</bpt>open a Visual Studio Online account for free<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=512979)</ept>.",
          "pos": [
            81,
            185
          ]
        }
      ]
    },
    {
      "content": "To set up a cloud service to automatically build and deploy to Azure by using Visual Studio Online, follow these steps.",
      "pos": [
        1487,
        1606
      ]
    },
    {
      "content": "Step 1: Create a team project",
      "pos": [
        1611,
        1640
      ]
    },
    {
      "content": "Follow the instructions <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=512980)</ept> to create your team project and link it to Visual Studio.",
      "pos": [
        1642,
        1777
      ]
    },
    {
      "content": "This walkthrough assumes you are using Team Foundation Version Control (TFVC) as your source control solution.",
      "pos": [
        1778,
        1888
      ]
    },
    {
      "content": "If you want to use Git for version control, see <bpt id=\"p1\">[</bpt>the Git version of this walkthrough<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=397358)</ept>.",
      "pos": [
        1889,
        2024
      ]
    },
    {
      "content": "Step 2: Check in a project to source control",
      "pos": [
        2029,
        2073
      ]
    },
    {
      "content": "In Visual Studio, open the solution you want to deploy, or create a new one.",
      "pos": [
        2078,
        2154
      ]
    },
    {
      "content": "You can deploy a web app or a cloud service (Azure Application) by following the steps in this walkthrough.",
      "pos": [
        2155,
        2262
      ]
    },
    {
      "content": "If you want to create a new solution, create a new Azure Cloud Service project,",
      "pos": [
        2263,
        2342
      ]
    },
    {
      "content": "or a new ASP.NET MVC project.",
      "pos": [
        2343,
        2372
      ]
    },
    {
      "content": "Make sure that the project targets .NET Framework 4 or 4.5, and if you are creating a cloud service project, add an ASP.NET MVC web role and a worker role, and choose Internet application for the web role.",
      "pos": [
        2373,
        2578
      ]
    },
    {
      "content": "When prompted, choose <bpt id=\"p1\">**</bpt>Internet Application<ept id=\"p1\">**</ept>.",
      "pos": [
        2579,
        2626
      ]
    },
    {
      "content": "If you want to create a web app, choose the ASP.NET Web Application project template, and then choose MVC.",
      "pos": [
        2627,
        2733
      ]
    },
    {
      "content": "See <bpt id=\"p1\">[</bpt>Create an ASP.NET web app in Azure App Service<ept id=\"p1\">](../web-sites-dotnet-get-started.md)</ept>.",
      "pos": [
        2734,
        2823
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Visual Studio Online only support CI deployments of Visual Studio Web Applications at this time.",
      "pos": [
        2831,
        2940
      ]
    },
    {
      "content": "Web Site projects are out of scope.",
      "pos": [
        2941,
        2976
      ]
    },
    {
      "pos": [
        2981,
        3067
      ],
      "content": "Open the context menu for the solution, and choose <bpt id=\"p1\">**</bpt>Add Solution to Source Control<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Accept or change the defaults and choose the <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> button.",
      "pos": [
        3084,
        3143
      ]
    },
    {
      "content": "Once the process completes, source control icons appear in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>.",
      "pos": [
        3144,
        3225
      ]
    },
    {
      "pos": [
        3242,
        3307
      ],
      "content": "Open the shortcut menu for the solution, and choose <bpt id=\"p1\">**</bpt>Check In<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        3324,
        3445
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Pending Changes<ept id=\"p1\">**</ept> area of <bpt id=\"p2\">**</bpt>Team Explorer<ept id=\"p2\">**</ept>, type a comment for the check-in and choose the <bpt id=\"p3\">**</bpt>Check In<ept id=\"p3\">**</ept> button."
    },
    {
      "content": "Note the options to include or exclude specific changes when you check in.",
      "pos": [
        3463,
        3537
      ]
    },
    {
      "content": "If desired changes are excluded, choose the <bpt id=\"p1\">**</bpt>Include All<ept id=\"p1\">**</ept> link.",
      "pos": [
        3538,
        3603
      ]
    },
    {
      "content": "Step 3: Connect the project to Azure",
      "pos": [
        3620,
        3656
      ]
    },
    {
      "content": "Now that you have a VSO team project with some source code in it, you are ready to connect your team project to Azure.",
      "pos": [
        3661,
        3779
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">](http://manage.windowsazure.com)</ept>, select your cloud service or web app, or create a new one by choosing the <bpt id=\"p2\">**</bpt>+<ept id=\"p2\">**</ept> icon at the bottom left and choosing <bpt id=\"p3\">**</bpt>Cloud Service<ept id=\"p3\">**</ept> or <bpt id=\"p4\">**</bpt>Web App<ept id=\"p4\">**</ept> and then <bpt id=\"p5\">**</bpt>Quick Create<ept id=\"p5\">**</ept>.",
      "pos": [
        3781,
        4023
      ]
    },
    {
      "content": "Choose the <bpt id=\"p1\">**</bpt>Set up publishing with Visual Studio Online<ept id=\"p1\">**</ept> link.",
      "pos": [
        4024,
        4088
      ]
    },
    {
      "content": "In the wizard, type the name of your Visual Studio Online account in the textbox and click the <bpt id=\"p1\">**</bpt>Authorize Now<ept id=\"p1\">**</ept> link.",
      "pos": [
        4106,
        4224
      ]
    },
    {
      "content": "You might be asked to sign in.",
      "pos": [
        4225,
        4255
      ]
    },
    {
      "pos": [
        4273,
        4404
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Connection Request<ept id=\"p1\">**</ept> pop-up dialog, choose the <bpt id=\"p2\">**</bpt>Accept<ept id=\"p2\">**</ept> button to authorize Azure to configure your team project in VSO."
    },
    {
      "content": "When authorization succeeds, you see a dropdown containing a list of your Visual Studio Online team projects.",
      "pos": [
        4422,
        4531
      ]
    },
    {
      "content": "Choose  the name of team project that you created in the previous steps, and then choose the wizard's checkmark button.",
      "pos": [
        4532,
        4651
      ]
    },
    {
      "content": "After your project is linked, you will see some instructions for checking in changes to your Visual Studio Online team project.",
      "pos": [
        4669,
        4796
      ]
    },
    {
      "content": "On your next check-in, Visual Studio Online will build and deploy your project to Azure.",
      "pos": [
        4798,
        4886
      ]
    },
    {
      "content": "Try this now by clicking the <bpt id=\"p1\">**</bpt>Check In from Visual Studio<ept id=\"p1\">**</ept> link, and then the <bpt id=\"p2\">**</bpt>Launch Visual Studio<ept id=\"p2\">**</ept> link (or the equivalent <bpt id=\"p3\">**</bpt>Visual Studio<ept id=\"p3\">**</ept> button at the bottom of the portal screen).",
      "pos": [
        4888,
        5078
      ]
    },
    {
      "content": "Step 4: Trigger a rebuild and redeploy your project",
      "pos": [
        5096,
        5147
      ]
    },
    {
      "pos": [
        5152,
        5234
      ],
      "content": "In Visual Studio's <bpt id=\"p1\">**</bpt>Team Explorer<ept id=\"p1\">**</ept>, choose the <bpt id=\"p2\">**</bpt>Source Control Explorer<ept id=\"p2\">**</ept> link."
    },
    {
      "content": "Navigate to your solution file and open it.",
      "pos": [
        5252,
        5295
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open up a file and change it.",
      "pos": [
        5313,
        5368
      ]
    },
    {
      "content": "For example, change the file <ph id=\"ph1\">`_Layout.cshtml`</ph> under the Views\\\\Shared folder in an MVC web role.",
      "pos": [
        5369,
        5465
      ]
    },
    {
      "pos": [
        5483,
        5549
      ],
      "content": "Edit the logo for the site and choose <bpt id=\"p1\">**</bpt>Ctrl+S<ept id=\"p1\">**</ept> to save the file."
    },
    {
      "pos": [
        5567,
        5625
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Team Explorer<ept id=\"p1\">**</ept>, choose the <bpt id=\"p2\">**</bpt>Pending Changes<ept id=\"p2\">**</ept> link."
    },
    {
      "pos": [
        5643,
        5699
      ],
      "content": "Enter a comment and then choose the <bpt id=\"p1\">**</bpt>Check In<ept id=\"p1\">**</ept> button."
    },
    {
      "pos": [
        5717,
        5789
      ],
      "content": "Choose the <bpt id=\"p1\">**</bpt>Home<ept id=\"p1\">**</ept> button to return to the <bpt id=\"p2\">**</bpt>Team Explorer<ept id=\"p2\">**</ept> home page."
    },
    {
      "pos": [
        5807,
        5865
      ],
      "content": "Choose the <bpt id=\"p1\">**</bpt>Builds<ept id=\"p1\">**</ept> link to view the builds in progress."
    },
    {
      "pos": [
        5884,
        5958
      ],
      "content": "<bpt id=\"p1\">**</bpt>Team Explorer<ept id=\"p1\">**</ept> shows that a build has been triggered for your check-in."
    },
    {
      "content": "Double-click the name of the build in progress to view a detailed log as the build progresses.",
      "pos": [
        5976,
        6070
      ]
    },
    {
      "content": "While the build is in-progress, take a look at the build definition that was created when you linked TFS to Azure by using the wizard.",
      "pos": [
        6088,
        6222
      ]
    },
    {
      "content": "Open the shortcut menu for the build definition and choose <bpt id=\"p1\">**</bpt>Edit Build Definition<ept id=\"p1\">**</ept>.",
      "pos": [
        6224,
        6309
      ]
    },
    {
      "pos": [
        6328,
        6436
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Trigger<ept id=\"p1\">**</ept> tab, you will see that the build definition is set to build on every check-in by default."
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Process<ept id=\"p1\">**</ept> tab, you can see the deployment environment is set to the name of your cloud service or web app.",
      "pos": [
        6455,
        6570
      ]
    },
    {
      "content": "If you are working with web apps, the properties you see will be different from those shown here.",
      "pos": [
        6571,
        6668
      ]
    },
    {
      "content": "Specify values for the properties if you want different values than the defaults.",
      "pos": [
        6686,
        6767
      ]
    },
    {
      "content": "The properties for Azure publishing are in the <bpt id=\"p1\">**</bpt>Deployment<ept id=\"p1\">**</ept> section.",
      "pos": [
        6768,
        6838
      ]
    },
    {
      "pos": [
        6844,
        6925
      ],
      "content": "The following table shows the available properties in the <bpt id=\"p1\">**</bpt>Deployment<ept id=\"p1\">**</ept> section:"
    },
    {
      "content": "Property",
      "pos": [
        6932,
        6940
      ]
    },
    {
      "content": "Default Value",
      "pos": [
        6941,
        6954
      ]
    },
    {
      "content": "Allow Untrusted Certificates",
      "pos": [
        6975,
        7003
      ]
    },
    {
      "content": "If false, SSL certificates must be signed by a root authority.",
      "pos": [
        7004,
        7066
      ]
    },
    {
      "content": "Allow Upgrade",
      "pos": [
        7073,
        7086
      ]
    },
    {
      "content": "Allows the deployment to update an existing deployment instead of creating a new one.",
      "pos": [
        7087,
        7172
      ]
    },
    {
      "content": "Preserves the IP address.",
      "pos": [
        7173,
        7198
      ]
    },
    {
      "content": "Do Not Delete",
      "pos": [
        7205,
        7218
      ]
    },
    {
      "content": "If true, do not overwrite an existing unrelated deployment (upgrade is allowed).",
      "pos": [
        7219,
        7299
      ]
    },
    {
      "content": "Path to Deployment Settings",
      "pos": [
        7306,
        7333
      ]
    },
    {
      "content": "The path to your .pubxml file for a web app, relative to the root folder of the repo.",
      "pos": [
        7334,
        7419
      ]
    },
    {
      "content": "Ignored for cloud services.",
      "pos": [
        7420,
        7447
      ]
    },
    {
      "content": "Sharepoint Deployment Environment",
      "pos": [
        7454,
        7487
      ]
    },
    {
      "content": "The same as the service name.",
      "pos": [
        7488,
        7517
      ]
    },
    {
      "content": "Azure Deployment Environment",
      "pos": [
        7524,
        7552
      ]
    },
    {
      "content": "The web app or cloud service name.",
      "pos": [
        7553,
        7587
      ]
    },
    {
      "content": "If you are using multiple service configurations (.cscfg files), you can specify the desired service configuration in the <bpt id=\"p1\">**</bpt>Build, Advanced, MSBuild arguments<ept id=\"p1\">**</ept> setting.",
      "pos": [
        7593,
        7762
      ]
    },
    {
      "content": "For example, to use ServiceConfiguration.Test.cscfg, set MSBuild arguments line option <ph id=\"ph1\">`/p:TargetProfile=Test`</ph>.",
      "pos": [
        7763,
        7874
      ]
    },
    {
      "content": "By this time, your build should be completed successfully.",
      "pos": [
        7893,
        7951
      ]
    },
    {
      "pos": [
        7969,
        8108
      ],
      "content": "If you double-click the build name, Visual Studio shows a <bpt id=\"p1\">**</bpt>Build Summary<ept id=\"p1\">**</ept>, including any test results from associated unit test projects."
    },
    {
      "pos": [
        8126,
        8299
      ],
      "content": "In the <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">](http://manage.windowsazure.com)</ept>, you can view the associated deployment on the <bpt id=\"p2\">**</bpt>Deployments<ept id=\"p2\">**</ept> tab when the staging environment is selected."
    },
    {
      "content": "Browse to your site's URL.",
      "pos": [
        8318,
        8344
      ]
    },
    {
      "content": "For a web app, just click the <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept> button on the command bar.",
      "pos": [
        8345,
        8412
      ]
    },
    {
      "content": "For a cloud service, choose the URL in the <bpt id=\"p1\">**</bpt>Quick Glance<ept id=\"p1\">**</ept> section of the <bpt id=\"p2\">**</bpt>Dashboard<ept id=\"p2\">**</ept> page that shows the Staging environment for a cloud service.",
      "pos": [
        8413,
        8562
      ]
    },
    {
      "content": "Deployments from continuous integration for cloud services are published to the Staging environment by default.",
      "pos": [
        8563,
        8674
      ]
    },
    {
      "content": "You can change this by setting the <bpt id=\"p1\">**</bpt>Alternate Cloud Service Environment<ept id=\"p1\">**</ept> property to <bpt id=\"p2\">**</bpt>Production<ept id=\"p2\">**</ept>.",
      "pos": [
        8675,
        8777
      ]
    },
    {
      "content": "This screenshot shows where the site URL is on the cloud service's dashboard page.",
      "pos": [
        8778,
        8860
      ]
    },
    {
      "content": "A new browser tab will open to reveal your running site.",
      "pos": [
        8879,
        8935
      ]
    },
    {
      "content": "For cloud services, if you make other changes to your project, you trigger more builds, and you will accumulate multiple deployments.",
      "pos": [
        8954,
        9087
      ]
    },
    {
      "content": "The latest one marked as Active.",
      "pos": [
        9088,
        9120
      ]
    },
    {
      "content": "Step 5: Redeploy an earlier build",
      "pos": [
        9138,
        9171
      ]
    },
    {
      "content": "This step applies to cloud services and is optional.",
      "pos": [
        9173,
        9225
      ]
    },
    {
      "content": "In the Azure management portal, choose an earlier deployment and then choose the <bpt id=\"p1\">**</bpt>Redeploy<ept id=\"p1\">**</ept> button to rewind your site to an earlier check-in.",
      "pos": [
        9226,
        9370
      ]
    },
    {
      "content": "Note that this will trigger a new build in TFS and create a new entry in your deployment history.",
      "pos": [
        9372,
        9469
      ]
    },
    {
      "content": "Step 6: Change the Production deployment",
      "pos": [
        9483,
        9523
      ]
    },
    {
      "content": "This step applies only to cloud services, not web apps.",
      "pos": [
        9525,
        9580
      ]
    },
    {
      "content": "When you are ready, you can promote the Staging environment to the production environment by choosing the <bpt id=\"p1\">**</bpt>Swap<ept id=\"p1\">**</ept> button in the management portal.",
      "pos": [
        9581,
        9728
      ]
    },
    {
      "content": "The newly deployed Staging environment is promoted to Production, and the previous Production environment, if any, becomes a Staging environment.",
      "pos": [
        9729,
        9874
      ]
    },
    {
      "content": "The Active deployment may be different for the Production and Staging environments, but the deployment history of recent builds is the same regardless of environment.",
      "pos": [
        9875,
        10041
      ]
    },
    {
      "content": "Step 7: Run unit tests",
      "pos": [
        10055,
        10077
      ]
    },
    {
      "content": "This step applies only to web apps, not cloud services.",
      "pos": [
        10079,
        10134
      ]
    },
    {
      "content": "To put a quality gate on your deployment, you can run unit tests and if they fail, you can stop the deployment.",
      "pos": [
        10135,
        10246
      ]
    },
    {
      "content": "In Visual Studio, add a unit test project.",
      "pos": [
        10252,
        10294
      ]
    },
    {
      "content": "Add project references to the project you want to test.",
      "pos": [
        10313,
        10368
      ]
    },
    {
      "content": "Add some unit tests.",
      "pos": [
        10387,
        10407
      ]
    },
    {
      "content": "To get started, try a dummy test that will always pass.",
      "pos": [
        10408,
        10463
      ]
    },
    {
      "pos": [
        10952,
        11036
      ],
      "content": "Edit the build definition, choose the <bpt id=\"p1\">**</bpt>Process<ept id=\"p1\">**</ept> tab, and expand the <bpt id=\"p2\">**</bpt>Test<ept id=\"p2\">**</ept> node."
    },
    {
      "content": "Set the <bpt id=\"p1\">**</bpt>Fail build on test failure<ept id=\"p1\">**</ept> to True.",
      "pos": [
        11042,
        11089
      ]
    },
    {
      "content": "This means that the deployment won't occur unless the tests pass.",
      "pos": [
        11090,
        11155
      ]
    },
    {
      "content": "Queue a new build.",
      "pos": [
        11174,
        11192
      ]
    },
    {
      "content": "While the build is proceeding, check on its progress.",
      "pos": [
        11223,
        11276
      ]
    },
    {
      "content": "When the build is done, check the test results.",
      "pos": [
        11307,
        11354
      ]
    },
    {
      "content": "Try creating a test that will fail.",
      "pos": [
        11386,
        11421
      ]
    },
    {
      "content": "Add a new test by copying the first one, rename it, and comment out the line of code that states NotImplementedException is an expected exception.",
      "pos": [
        11422,
        11568
      ]
    },
    {
      "content": "Check in the change to queue a new build.",
      "pos": [
        11785,
        11826
      ]
    },
    {
      "content": "View the test results to see details about the failure.",
      "pos": [
        11844,
        11899
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        11930,
        11940
      ]
    },
    {
      "content": "For more about unit testing in Visual Studio Online, see <bpt id=\"p1\">[</bpt>Run unit tests in your build<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=510474)</ept>.",
      "pos": [
        11941,
        12078
      ]
    },
    {
      "content": "If you're using Git, see <bpt id=\"p1\">[</bpt>Share your code in Git<ept id=\"p1\">](http://www.visualstudio.com/get-started/share-your-code-in-git-vs.aspx)</ept> and <bpt id=\"p2\">[</bpt>Continuous deployment using GIT in Azure App Service<ept id=\"p2\">](../web-sites-publish-source-control.md)</ept>.",
      "pos": [
        12079,
        12300
      ]
    },
    {
      "content": "For more information about Visual Studio Online, see <bpt id=\"p1\">[</bpt>Visual Studio Online<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=253861)</ept>.",
      "pos": [
        12302,
        12425
      ]
    },
    {
      "content": "test",
      "pos": [
        15870,
        15874
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Continuous delivery with Visual Studio Online in Azure\"\n    description=\"Learn how to configure your Visual Studio Online team projects to automatically build and deploy to the Web App feature in Azure App Service or cloud services.\"\n    services=\"cloud-services\"\n    documentationCenter=\".net\"\n    authors=\"kempb\"\n    manager=\"douge\"\n    editor=\"tglee\"/>\n\n<tags\n    ms.service=\"cloud-services\"\n    ms.workload=\"tbd\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"dotnet\"\n    ms.topic=\"article\"\n    ms.date=\"09/02/2015\"\n    ms.author=\"kempb\"/>\n\n# Continuous delivery to Azure using Visual Studio Online\n\nYou can configure your Visual Studio Online team projects to automatically build and deploy to Azure web apps or cloud services.  (For information on how to set up a continuous build and deploy system using an *on-premises* Team Foundation Server, see [Continuous Delivery for Cloud Services in Azure](cloud-services-dotnet-continuous-delivery.md).)\n\nThis tutorial assumes you have Visual Studio 2013 and the Azure SDK installed. If you don't already have Visual Studio 2013, download it by choosing the **Get started for free** link at [www.visualstudio.com](http://www.visualstudio.com). Install the Azure SDK from [here](http://go.microsoft.com/fwlink/?LinkId=239540).\n\n> [AZURE.NOTE] You need an Visual Studio online account to complete this tutorial:\n> You can [open a Visual Studio Online account for free](http://go.microsoft.com/fwlink/p/?LinkId=512979).\n\nTo set up a cloud service to automatically build and deploy to Azure by using Visual Studio Online, follow these steps.\n\n## Step 1: Create a team project\n\nFollow the instructions [here](http://go.microsoft.com/fwlink/?LinkId=512980) to create your team project and link it to Visual Studio. This walkthrough assumes you are using Team Foundation Version Control (TFVC) as your source control solution. If you want to use Git for version control, see [the Git version of this walkthrough](http://go.microsoft.com/fwlink/p/?LinkId=397358).\n\n## Step 2: Check in a project to source control\n\n1. In Visual Studio, open the solution you want to deploy, or create a new one.\nYou can deploy a web app or a cloud service (Azure Application) by following the steps in this walkthrough.\nIf you want to create a new solution, create a new Azure Cloud Service project,\nor a new ASP.NET MVC project. Make sure that the project targets .NET Framework 4 or 4.5, and if you are creating a cloud service project, add an ASP.NET MVC web role and a worker role, and choose Internet application for the web role. When prompted, choose **Internet Application**.\nIf you want to create a web app, choose the ASP.NET Web Application project template, and then choose MVC. See [Create an ASP.NET web app in Azure App Service](../web-sites-dotnet-get-started.md).\n\n    > [AZURE.NOTE] Visual Studio Online only support CI deployments of Visual Studio Web Applications at this time. Web Site projects are out of scope.\n\n1. Open the context menu for the solution, and choose **Add Solution to Source Control**.\n\n    ![][5]\n\n1. Accept or change the defaults and choose the **OK** button. Once the process completes, source control icons appear in **Solution Explorer**.\n\n    ![][6]\n\n1. Open the shortcut menu for the solution, and choose **Check In**.\n\n    ![][7]\n\n1. In the **Pending Changes** area of **Team Explorer**, type a comment for the check-in and choose the **Check In** button.\n\n    ![][8]\n\n    Note the options to include or exclude specific changes when you check in. If desired changes are excluded, choose the **Include All** link.\n\n    ![][9]\n\n## Step 3: Connect the project to Azure\n\n1. Now that you have a VSO team project with some source code in it, you are ready to connect your team project to Azure.  In the [Azure Management Portal](http://manage.windowsazure.com), select your cloud service or web app, or create a new one by choosing the **+** icon at the bottom left and choosing **Cloud Service** or **Web App** and then **Quick Create**. Choose the **Set up publishing with Visual Studio Online** link.\n\n    ![][10]\n\n1. In the wizard, type the name of your Visual Studio Online account in the textbox and click the **Authorize Now** link. You might be asked to sign in.\n\n    ![][11]\n\n1. In the **Connection Request** pop-up dialog, choose the **Accept** button to authorize Azure to configure your team project in VSO.\n\n    ![][12]\n\n1. When authorization succeeds, you see a dropdown containing a list of your Visual Studio Online team projects. Choose  the name of team project that you created in the previous steps, and then choose the wizard's checkmark button.\n\n    ![][13]\n\n1. After your project is linked, you will see some instructions for checking in changes to your Visual Studio Online team project.  On your next check-in, Visual Studio Online will build and deploy your project to Azure.  Try this now by clicking the **Check In from Visual Studio** link, and then the **Launch Visual Studio** link (or the equivalent **Visual Studio** button at the bottom of the portal screen).\n\n    ![][14]\n\n## Step 4: Trigger a rebuild and redeploy your project\n\n1. In Visual Studio's **Team Explorer**, choose the **Source Control Explorer** link.\n\n    ![][15]\n\n1. Navigate to your solution file and open it.\n\n    ![][16]\n\n1. In **Solution Explorer**, open up a file and change it. For example, change the file `_Layout.cshtml` under the Views\\\\Shared folder in an MVC web role.\n\n    ![][17]\n\n1. Edit the logo for the site and choose **Ctrl+S** to save the file.\n\n    ![][18]\n\n1. In **Team Explorer**, choose the **Pending Changes** link.\n\n    ![][19]\n\n1. Enter a comment and then choose the **Check In** button.\n\n    ![][20]\n\n1. Choose the **Home** button to return to the **Team Explorer** home page.\n\n    ![][21]\n\n1. Choose the **Builds** link to view the builds in progress.\n\n    ![][22]\n\n    **Team Explorer** shows that a build has been triggered for your check-in.\n\n    ![][23]\n\n1. Double-click the name of the build in progress to view a detailed log as the build progresses.\n\n    ![][24]\n\n1. While the build is in-progress, take a look at the build definition that was created when you linked TFS to Azure by using the wizard.  Open the shortcut menu for the build definition and choose **Edit Build Definition**.\n\n    ![][25]\n\n    In the **Trigger** tab, you will see that the build definition is set to build on every check-in by default.\n\n    ![][26]\n\n    In the **Process** tab, you can see the deployment environment is set to the name of your cloud service or web app. If you are working with web apps, the properties you see will be different from those shown here.\n\n    ![][27]\n\n1. Specify values for the properties if you want different values than the defaults. The properties for Azure publishing are in the **Deployment** section.\n\n    The following table shows the available properties in the **Deployment** section:\n\n    |Property|Default Value|\n    |---|---|\n    |Allow Untrusted Certificates|If false, SSL certificates must be signed by a root authority.|\n    |Allow Upgrade|Allows the deployment to update an existing deployment instead of creating a new one. Preserves the IP address.|\n    |Do Not Delete|If true, do not overwrite an existing unrelated deployment (upgrade is allowed).|\n    |Path to Deployment Settings|The path to your .pubxml file for a web app, relative to the root folder of the repo. Ignored for cloud services.|\n    |Sharepoint Deployment Environment|The same as the service name.|\n    |Azure Deployment Environment|The web app or cloud service name.|\n\n1. If you are using multiple service configurations (.cscfg files), you can specify the desired service configuration in the **Build, Advanced, MSBuild arguments** setting. For example, to use ServiceConfiguration.Test.cscfg, set MSBuild arguments line option `/p:TargetProfile=Test`.\n\n    ![][38]\n\n    By this time, your build should be completed successfully.\n\n    ![][28]\n\n1. If you double-click the build name, Visual Studio shows a **Build Summary**, including any test results from associated unit test projects.\n\n    ![][29]\n\n1. In the [Azure Management Portal](http://manage.windowsazure.com), you can view the associated deployment on the **Deployments** tab when the staging environment is selected.\n\n    ![][30]\n\n1.  Browse to your site's URL. For a web app, just click the **Browse** button on the command bar. For a cloud service, choose the URL in the **Quick Glance** section of the **Dashboard** page that shows the Staging environment for a cloud service. Deployments from continuous integration for cloud services are published to the Staging environment by default. You can change this by setting the **Alternate Cloud Service Environment** property to **Production**. This screenshot shows where the site URL is on the cloud service's dashboard page.\n\n    ![][31]\n\n    A new browser tab will open to reveal your running site.\n\n    ![][32]\n\n    For cloud services, if you make other changes to your project, you trigger more builds, and you will accumulate multiple deployments. The latest one marked as Active.\n\n    ![][33]\n\n## Step 5: Redeploy an earlier build\n\nThis step applies to cloud services and is optional. In the Azure management portal, choose an earlier deployment and then choose the **Redeploy** button to rewind your site to an earlier check-in.  Note that this will trigger a new build in TFS and create a new entry in your deployment history.\n\n![][34]\n\n## Step 6: Change the Production deployment\n\nThis step applies only to cloud services, not web apps. When you are ready, you can promote the Staging environment to the production environment by choosing the **Swap** button in the management portal. The newly deployed Staging environment is promoted to Production, and the previous Production environment, if any, becomes a Staging environment. The Active deployment may be different for the Production and Staging environments, but the deployment history of recent builds is the same regardless of environment.\n\n![][35]\n\n## Step 7: Run unit tests\n\nThis step applies only to web apps, not cloud services. To put a quality gate on your deployment, you can run unit tests and if they fail, you can stop the deployment.\n\n1.  In Visual Studio, add a unit test project.\n\n    ![][39]\n\n1.  Add project references to the project you want to test.\n\n    ![][40]\n\n1.  Add some unit tests. To get started, try a dummy test that will always pass.\n\n        ```\n        using System;\n        using Microsoft.VisualStudio.TestTools.UnitTesting;\n\n        namespace UnitTestProject1\n        {\n            [TestClass]\n            public class UnitTest1\n            {\n                [TestMethod]\n                [ExpectedException(typeof(NotImplementedException))]\n                public void TestMethod1()\n                {\n                    throw new NotImplementedException();\n                }\n            }\n        }\n        ```\n\n1.  Edit the build definition, choose the **Process** tab, and expand the **Test** node.\n\n1.  Set the **Fail build on test failure** to True. This means that the deployment won't occur unless the tests pass.\n\n    ![][41]\n\n1.  Queue a new build.\n\n    ![][42]\n\n    ![][43]\n\n1. While the build is proceeding, check on its progress.\n\n    ![][44]\n\n    ![][45]\n\n1. When the build is done, check the test results.\n\n    ![][46]\n\n    ![][47]\n\n1.  Try creating a test that will fail. Add a new test by copying the first one, rename it, and comment out the line of code that states NotImplementedException is an expected exception.\n\n        ```\n        [TestMethod]\n        //[ExpectedException(typeof(NotImplementedException))]\n        public void TestMethod2()\n        {\n            throw new NotImplementedException();\n        }\n        ```\n\n1. Check in the change to queue a new build.\n\n    ![][48]\n\n1. View the test results to see details about the failure.\n\n    ![][49]\n\n    ![][50]\n\n## Next steps\nFor more about unit testing in Visual Studio Online, see [Run unit tests in your build](http://go.microsoft.com/fwlink/p/?LinkId=510474). If you're using Git, see [Share your code in Git](http://www.visualstudio.com/get-started/share-your-code-in-git-vs.aspx) and [Continuous deployment using GIT in Azure App Service](../web-sites-publish-source-control.md).  For more information about Visual Studio Online, see [Visual Studio Online](http://go.microsoft.com/fwlink/?LinkId=253861).\n\n[0]: ./media/cloud-services-continuous-delivery-use-vso/tfs0.PNG\n[1]: ./media/cloud-services-continuous-delivery-use-vso/tfs1.png\n[2]: ./media/cloud-services-continuous-delivery-use-vso/tfs2.png\n\n[5]: ./media/cloud-services-continuous-delivery-use-vso/tfs5.png\n[6]: ./media/cloud-services-continuous-delivery-use-vso/tfs6.png\n[7]: ./media/cloud-services-continuous-delivery-use-vso/tfs7.png\n[8]: ./media/cloud-services-continuous-delivery-use-vso/tfs8.png\n[9]: ./media/cloud-services-continuous-delivery-use-vso/tfs9.png\n[10]: ./media/cloud-services-continuous-delivery-use-vso/tfs10.png\n[11]: ./media/cloud-services-continuous-delivery-use-vso/tfs11.png\n[12]: ./media/cloud-services-continuous-delivery-use-vso/tfs12.png\n[13]: ./media/cloud-services-continuous-delivery-use-vso/tfs13.png\n[14]: ./media/cloud-services-continuous-delivery-use-vso/tfs14.png\n[15]: ./media/cloud-services-continuous-delivery-use-vso/tfs15.png\n[16]: ./media/cloud-services-continuous-delivery-use-vso/tfs16.png\n[17]: ./media/cloud-services-continuous-delivery-use-vso/tfs17.png\n[18]: ./media/cloud-services-continuous-delivery-use-vso/tfs18.png\n[19]: ./media/cloud-services-continuous-delivery-use-vso/tfs19.png\n[20]: ./media/cloud-services-continuous-delivery-use-vso/tfs20.png\n[21]: ./media/cloud-services-continuous-delivery-use-vso/tfs21.png\n[22]: ./media/cloud-services-continuous-delivery-use-vso/tfs22.png\n[23]: ./media/cloud-services-continuous-delivery-use-vso/tfs23.png\n[24]: ./media/cloud-services-continuous-delivery-use-vso/tfs24.png\n[25]: ./media/cloud-services-continuous-delivery-use-vso/tfs25.png\n[26]: ./media/cloud-services-continuous-delivery-use-vso/tfs26.png\n[27]: ./media/cloud-services-continuous-delivery-use-vso/tfs27.png\n[28]: ./media/cloud-services-continuous-delivery-use-vso/tfs28.png\n[29]: ./media/cloud-services-continuous-delivery-use-vso/tfs29.png\n[30]: ./media/cloud-services-continuous-delivery-use-vso/tfs30.png\n[31]: ./media/cloud-services-continuous-delivery-use-vso/tfs31.png\n[32]: ./media/cloud-services-continuous-delivery-use-vso/tfs32.png\n[33]: ./media/cloud-services-continuous-delivery-use-vso/tfs33.png\n[34]: ./media/cloud-services-continuous-delivery-use-vso/tfs34.png\n[35]: ./media/cloud-services-continuous-delivery-use-vso/tfs35.png\n[36]: ./media/cloud-services-continuous-delivery-use-vso/tfs36.PNG\n[37]: ./media/cloud-services-continuous-delivery-use-vso/tfs37.PNG\n[38]: ./media/cloud-services-continuous-delivery-use-vso/AdvancedMSBuildSettings.PNG\n[39]: ./media/cloud-services-continuous-delivery-use-vso/AddUnitTestProject.PNG\n[40]: ./media/cloud-services-continuous-delivery-use-vso/AddProjectReferences.PNG\n[41]: ./media/cloud-services-continuous-delivery-use-vso/EditBuildDefinitionForTest.PNG\n[42]: ./media/cloud-services-continuous-delivery-use-vso/QueueNewBuild.PNG\n[43]: ./media/cloud-services-continuous-delivery-use-vso/QueueBuildDialog.PNG\n[44]: ./media/cloud-services-continuous-delivery-use-vso/BuildInTeamExplorer.PNG\n[45]: ./media/cloud-services-continuous-delivery-use-vso/BuildRequestInfo.PNG\n[46]: ./media/cloud-services-continuous-delivery-use-vso/BuildSucceeded.PNG\n[47]: ./media/cloud-services-continuous-delivery-use-vso/TestResultsPassed.PNG\n[48]: ./media/cloud-services-continuous-delivery-use-vso/CheckInChangeToMakeTestsFail.PNG\n[49]: ./media/cloud-services-continuous-delivery-use-vso/TestsFailed.PNG\n[50]: ./media/cloud-services-continuous-delivery-use-vso/TestsResultsFailed.PNG\n\ntest\n"
}