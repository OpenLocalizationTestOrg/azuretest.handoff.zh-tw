{
  "nodes": [
    {
      "content": "Protect your API with Azure API Management | Microsoft Azure",
      "pos": [
        27,
        87
      ]
    },
    {
      "content": "Learn how to protect your API with quotas and throttling (rate-limiting) policies.",
      "pos": [
        106,
        188
      ]
    },
    {
      "content": "Protect your API with rate limits using Azure API Management",
      "pos": [
        502,
        562
      ]
    },
    {
      "content": "This guide shows you how easy it is to add protection for your backend API by configuring rate limit and quota policies with Azure API Management.",
      "pos": [
        564,
        710
      ]
    },
    {
      "content": "In this tutorial, you will create a \"Free Trial\" API product that allows developers to make up to 10 calls per minute and up to a maximum of 200 calls per week to your API.",
      "pos": [
        712,
        884
      ]
    },
    {
      "content": "You will then publish the API and test the rate limit policy.",
      "pos": [
        885,
        946
      ]
    },
    {
      "pos": [
        949,
        1201
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you already have a product configured and want to use it for this tutorial, you can jump ahead to <bpt id=\"p1\">[</bpt>Configure call rate limit and quota policies<ept id=\"p1\">][]</ept> and follow the tutorial from there using your product in place of the Free Trial product."
    },
    {
      "pos": [
        1206,
        1255
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"create-product\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>To create a product"
    },
    {
      "content": "In this step, you will create a Free Trial product that does not require subscription approval.",
      "pos": [
        1257,
        1352
      ]
    },
    {
      "content": "To get started, click <bpt id=\"p1\">**</bpt>Manage<ept id=\"p1\">**</ept> in the Azure portal for your API Management service.",
      "pos": [
        1354,
        1439
      ]
    },
    {
      "content": "This takes you to the API Management publisher portal.",
      "pos": [
        1440,
        1494
      ]
    },
    {
      "content": "Publisher portal",
      "pos": [
        1498,
        1514
      ]
    },
    {
      "pos": [
        1553,
        1725
      ],
      "content": "If you have not yet created an API Management service instance, see <bpt id=\"p1\">[</bpt>Create an API Management service instance<ept id=\"p1\">][]</ept> in the <bpt id=\"p2\">[</bpt>Get started with Azure API Management<ept id=\"p2\">][]</ept> tutorial."
    },
    {
      "pos": [
        1727,
        1822
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Products<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>API Management<ept id=\"p2\">**</ept> menu on the left to display the <bpt id=\"p3\">**</bpt>Products<ept id=\"p3\">**</ept> page."
    },
    {
      "content": "Add product",
      "pos": [
        1826,
        1837
      ]
    },
    {
      "pos": [
        1868,
        1936
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add product<ept id=\"p1\">**</ept> to display the <bpt id=\"p2\">**</bpt>Add new product<ept id=\"p2\">**</ept> dialog box."
    },
    {
      "content": "Add new product",
      "pos": [
        1940,
        1955
      ]
    },
    {
      "pos": [
        1993,
        2035
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Title<ept id=\"p1\">**</ept> box, type <bpt id=\"p2\">**</bpt>Free Trial<ept id=\"p2\">**</ept>."
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Description<ept id=\"p1\">**</ept> box, type the following text:",
      "pos": [
        2037,
        2089
      ]
    },
    {
      "content": "Subscribers will be able to run 10 calls/minute up to a maximum of 200 calls/week after which access is denied.",
      "pos": [
        2093,
        2204
      ]
    },
    {
      "content": "**",
      "pos": [
        2204,
        2206
      ]
    },
    {
      "content": "Products in API Management can be protected or open.",
      "pos": [
        2208,
        2260
      ]
    },
    {
      "content": "Protected products must be subscribed to before they can be used.",
      "pos": [
        2261,
        2326
      ]
    },
    {
      "content": "Open products can be used without a subscription.",
      "pos": [
        2327,
        2376
      ]
    },
    {
      "content": "Ensure that <bpt id=\"p1\">**</bpt>Require subscription<ept id=\"p1\">**</ept> is selected to create a protected product that requires a subscription.",
      "pos": [
        2377,
        2485
      ]
    },
    {
      "content": "This is the default setting.",
      "pos": [
        2486,
        2514
      ]
    },
    {
      "content": "If you want an administrator to review and accept or reject subscription attempts to this product, select <bpt id=\"p1\">**</bpt>Require subscription approval<ept id=\"p1\">**</ept>.",
      "pos": [
        2516,
        2656
      ]
    },
    {
      "content": "If the check box is not selected, subscription attempts will be auto-approved.",
      "pos": [
        2657,
        2735
      ]
    },
    {
      "content": "In this example, subscriptions are automatically approved, so do not select the box.",
      "pos": [
        2736,
        2820
      ]
    },
    {
      "content": "To allow developer accounts to subscribe multiple times to the new product, select the <bpt id=\"p1\">**</bpt>Allow multiple simultaneous subscriptions<ept id=\"p1\">**</ept> check box.",
      "pos": [
        2822,
        2965
      ]
    },
    {
      "content": "This tutorial does not utilize multiple simultaneous subscriptions, so leave it unchecked.",
      "pos": [
        2966,
        3056
      ]
    },
    {
      "pos": [
        3058,
        3125
      ],
      "content": "After all values are entered, click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept> to create the product."
    },
    {
      "content": "Product added",
      "pos": [
        3129,
        3142
      ]
    },
    {
      "content": "By default, new products are visible to users in the <bpt id=\"p1\">**</bpt>Administrators<ept id=\"p1\">**</ept> group.",
      "pos": [
        3175,
        3253
      ]
    },
    {
      "content": "We are going to add the <bpt id=\"p1\">**</bpt>Developers<ept id=\"p1\">**</ept> group.",
      "pos": [
        3254,
        3299
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Free Trial<ept id=\"p1\">**</ept>, and then click the <bpt id=\"p2\">**</bpt>Visibility<ept id=\"p2\">**</ept> tab.",
      "pos": [
        3300,
        3360
      ]
    },
    {
      "content": "In API Management, groups are used to manage the visibility of products to developers.",
      "pos": [
        3363,
        3449
      ]
    },
    {
      "content": "Products grant visibility to groups, and developers can view and subscribe to the products that are visible to the groups in which they belong.",
      "pos": [
        3450,
        3593
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>How to create and use groups in Azure API Management<ept id=\"p1\">][]</ept>.",
      "pos": [
        3594,
        3677
      ]
    },
    {
      "content": "Add developers group",
      "pos": [
        3681,
        3701
      ]
    },
    {
      "pos": [
        3741,
        3802
      ],
      "content": "Select the <bpt id=\"p1\">**</bpt>Developers<ept id=\"p1\">**</ept> check box, and then click <bpt id=\"p2\">**</bpt>Save<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        3807,
        3858
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"add-api\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>To add an API to the product"
    },
    {
      "content": "In this step of the tutorial, we will add the Echo API to the new Free Trial product.",
      "pos": [
        3860,
        3945
      ]
    },
    {
      "content": "Each API Management service instance comes pre-configured with an Echo API that can be used to experiment with and learn about API Management.",
      "pos": [
        3948,
        4090
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Get started with Azure API Management<ept id=\"p1\">][]</ept>.",
      "pos": [
        4091,
        4159
      ]
    },
    {
      "pos": [
        4161,
        4281
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Products<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>API Management<ept id=\"p2\">**</ept> menu on the left, and then click <bpt id=\"p3\">**</bpt>Free Trial<ept id=\"p3\">**</ept> to configure the product."
    },
    {
      "content": "Configure product",
      "pos": [
        4285,
        4302
      ]
    },
    {
      "pos": [
        4339,
        4368
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add API to product<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Add API to product",
      "pos": [
        4372,
        4390
      ]
    },
    {
      "pos": [
        4417,
        4462
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Echo API<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Save<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Add Echo API",
      "pos": [
        4466,
        4478
      ]
    },
    {
      "pos": [
        4513,
        4584
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"policies\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>To configure call rate limit and quota policies"
    },
    {
      "content": "Rate limits and quotas are configured in the policy editor.",
      "pos": [
        4586,
        4645
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Policies<ept id=\"p1\">**</ept> under the <bpt id=\"p2\">**</bpt>API Management<ept id=\"p2\">**</ept> menu on the left.",
      "pos": [
        4646,
        4711
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Product<ept id=\"p1\">**</ept> list, click <bpt id=\"p2\">**</bpt>Free Trial<ept id=\"p2\">**</ept>.",
      "pos": [
        4712,
        4758
      ]
    },
    {
      "content": "Product policy",
      "pos": [
        4762,
        4776
      ]
    },
    {
      "pos": [
        4810,
        4914
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add Policy<ept id=\"p1\">**</ept> to import the policy template and begin creating the rate limit and quota policies."
    },
    {
      "content": "Add policy",
      "pos": [
        4918,
        4928
      ]
    },
    {
      "content": "To insert policies, position the cursor into either the <bpt id=\"p1\">**</bpt>inbound<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>outbound<ept id=\"p2\">**</ept> section of the policy template.",
      "pos": [
        4958,
        5073
      ]
    },
    {
      "content": "Rate limit and quota policies are inbound policies, so position the cursor in the inbound element.",
      "pos": [
        5074,
        5172
      ]
    },
    {
      "content": "Policy editor",
      "pos": [
        5176,
        5189
      ]
    },
    {
      "pos": [
        5230,
        5339
      ],
      "content": "The two policies we are adding in this tutorial are the <bpt id=\"p1\">[</bpt>Limit call rate<ept id=\"p1\">][]</ept> and <bpt id=\"p2\">[</bpt>Set usage quota<ept id=\"p2\">][]</ept> policies."
    },
    {
      "content": "Policy statements",
      "pos": [
        5343,
        5360
      ]
    },
    {
      "pos": [
        5394,
        5533
      ],
      "content": "After the cursor is positioned in the <bpt id=\"p1\">**</bpt>inbound<ept id=\"p1\">**</ept> policy element, click the arrow beside <bpt id=\"p2\">**</bpt>Limit call rate<ept id=\"p2\">**</ept> to insert its policy template."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Limit call rate<ept id=\"p1\">**</ept> can be used at the product level and can also be used at the API and individual operation name levels.",
      "pos": [
        5704,
        5826
      ]
    },
    {
      "content": "In this tutorial, only product-level policies are used, so delete the <bpt id=\"p1\">**</bpt>api<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>operation<ept id=\"p2\">**</ept> elements from the <bpt id=\"p3\">**</bpt>rate-limit<ept id=\"p3\">**</ept> element, so only the outer <bpt id=\"p4\">**</bpt>rate-limit<ept id=\"p4\">**</ept> element remains, as shown in the following example.",
      "pos": [
        5827,
        6049
      ]
    },
    {
      "pos": [
        6127,
        6315
      ],
      "content": "In the Free Trial product, the maximum allowable call rate is 10 calls per minute, so type <bpt id=\"p1\">**</bpt>10<ept id=\"p1\">**</ept> as the value for the <bpt id=\"p2\">**</bpt>calls<ept id=\"p2\">**</ept> attribute, and <bpt id=\"p3\">**</bpt>60<ept id=\"p3\">**</ept> for the <bpt id=\"p4\">**</bpt>renewal-period<ept id=\"p4\">**</ept> attribute."
    },
    {
      "pos": [
        6384,
        6599
      ],
      "content": "To configure the <bpt id=\"p1\">**</bpt>Set usage quota<ept id=\"p1\">**</ept> policy, position your cursor immediately below the newly added <bpt id=\"p2\">**</bpt>rate-limit<ept id=\"p2\">**</ept> element within the <bpt id=\"p3\">**</bpt>inbound<ept id=\"p3\">**</ept> element, and then click the arrow to the left of <bpt id=\"p4\">**</bpt>Set usage quota<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        6826,
        6977
      ],
      "content": "Because this policy is also intended to be at the product level, delete the <bpt id=\"p1\">**</bpt>api<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>operation<ept id=\"p2\">**</ept> name elements, as shown in the following example."
    },
    {
      "content": "Quotas can be based on the number of calls per interval, bandwidth, or both.",
      "pos": [
        7067,
        7143
      ]
    },
    {
      "content": "In this tutorial, we are not throttling based on bandwidth, so delete the <bpt id=\"p1\">**</bpt>bandwidth<ept id=\"p1\">**</ept> attribute.",
      "pos": [
        7144,
        7242
      ]
    },
    {
      "content": "In the Free Trial product, the quota is 200 calls per week.",
      "pos": [
        7310,
        7369
      ]
    },
    {
      "content": "Specify <bpt id=\"p1\">**</bpt>200<ept id=\"p1\">**</ept> as the value for the <bpt id=\"p2\">**</bpt>calls<ept id=\"p2\">**</ept> attribute, and then specify <bpt id=\"p3\">**</bpt>604800<ept id=\"p3\">**</ept> as the value for the <bpt id=\"p4\">**</bpt>renewal-period<ept id=\"p4\">**</ept> attribute.",
      "pos": [
        7370,
        7506
      ]
    },
    {
      "content": "Policy intervals are specified in seconds.",
      "pos": [
        7571,
        7613
      ]
    },
    {
      "content": "To calculate the interval for a week, you can multiply the number of days (7) by the number of hours in a day (24) by the number of minutes in an hour (60) by the number of seconds in a minute (60): 7 * 24 * 60 * 60 = 604800.",
      "pos": [
        7614,
        7839
      ]
    },
    {
      "content": "When you have finished configuring the policy, it should match the following example.",
      "pos": [
        7841,
        7926
      ]
    },
    {
      "pos": [
        8228,
        8286
      ],
      "content": "After the desired policies are configured, click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Save policy",
      "pos": [
        8290,
        8301
      ]
    },
    {
      "pos": [
        8335,
        8389
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"publish-product\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph> To publish the product"
    },
    {
      "content": "Now that the the APIs are added and the policies are configured, the product must be published so that it can be used by developers.",
      "pos": [
        8391,
        8523
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Products<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>API Management<ept id=\"p2\">**</ept> menu on the left, and then click <bpt id=\"p3\">**</bpt>Free Trial<ept id=\"p3\">**</ept> to configure the product.",
      "pos": [
        8524,
        8644
      ]
    },
    {
      "content": "Configure product",
      "pos": [
        8648,
        8665
      ]
    },
    {
      "pos": [
        8702,
        8767
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Yes, publish it<ept id=\"p2\">**</ept> to confirm."
    },
    {
      "content": "Publish product",
      "pos": [
        8771,
        8786
      ]
    },
    {
      "pos": [
        8824,
        8904
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"subscribe-account\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>To subscribe a developer account to the product"
    },
    {
      "content": "Now that the product is published, it is available to be subscribed to and used by developers.",
      "pos": [
        8906,
        9000
      ]
    },
    {
      "content": "Administrators of an API Management instance are automatically subscribed to every product.",
      "pos": [
        9003,
        9094
      ]
    },
    {
      "content": "In this tutorial step, we will subscribe one of the non-administrator developer accounts to the Free Trial product.",
      "pos": [
        9095,
        9210
      ]
    },
    {
      "content": "If your developer account is part of the Administrators role, then you can follow along with this step, even though you are already subscribed.",
      "pos": [
        9211,
        9354
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Users<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>API Management<ept id=\"p2\">**</ept> menu on the left, and then click the name of your developer account.",
      "pos": [
        9356,
        9466
      ]
    },
    {
      "content": "In this example, we are using the <bpt id=\"p1\">**</bpt>Clayton Gragg<ept id=\"p1\">**</ept> developer account.",
      "pos": [
        9467,
        9537
      ]
    },
    {
      "content": "Configure developer",
      "pos": [
        9541,
        9560
      ]
    },
    {
      "pos": [
        9599,
        9626
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add Subscription<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Add subscription",
      "pos": [
        9630,
        9646
      ]
    },
    {
      "pos": [
        9687,
        9739
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Free Trial<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Subscribe<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Add subscription",
      "pos": [
        9743,
        9759
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> In this tutorial, multiple simultaneous subscriptions are not enabled for the Free Trial product.",
      "pos": [
        9796,
        9906
      ]
    },
    {
      "content": "If they were, you would be prompted to name the subscription, as shown in the following example.",
      "pos": [
        9907,
        10003
      ]
    },
    {
      "content": "Add subscription",
      "pos": [
        10007,
        10023
      ]
    },
    {
      "pos": [
        10068,
        10160
      ],
      "content": "After clicking <bpt id=\"p1\">**</bpt>Subscribe<ept id=\"p1\">**</ept>, the product appears in the <bpt id=\"p2\">**</bpt>Subscription<ept id=\"p2\">**</ept> list for the user."
    },
    {
      "content": "Subscription added",
      "pos": [
        10164,
        10182
      ]
    },
    {
      "pos": [
        10223,
        10298
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"test-rate-limit\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>To call an operation and test the rate limit"
    },
    {
      "content": "Now that the Free Trial product is configured and published, we can call some operations and test the rate limit policy.",
      "pos": [
        10300,
        10420
      ]
    },
    {
      "content": "Switch to the developer portal by clicking <bpt id=\"p1\">**</bpt>Developer portal<ept id=\"p1\">**</ept> in the upper-right menu.",
      "pos": [
        10421,
        10509
      ]
    },
    {
      "content": "Developer portal",
      "pos": [
        10513,
        10529
      ]
    },
    {
      "pos": [
        10570,
        10630
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>APIs<ept id=\"p1\">**</ept> in the top menu, and then click <bpt id=\"p2\">**</bpt>Echo API<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Developer portal",
      "pos": [
        10634,
        10650
      ]
    },
    {
      "pos": [
        10695,
        10751
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>GET Resource<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Open Console<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Open console",
      "pos": [
        10755,
        10767
      ]
    },
    {
      "content": "Keep the default parameter values, and then select your subscription key for the Free Trial product.",
      "pos": [
        10799,
        10899
      ]
    },
    {
      "content": "Subscription key",
      "pos": [
        10903,
        10919
      ]
    },
    {
      "pos": [
        10950,
        11128
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you have multiple subscriptions, be sure to select the key for <bpt id=\"p1\">**</bpt>Free Trial<ept id=\"p1\">**</ept>, or else the policies that were configured in the previous steps won't be in effect."
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>HTTP Get<ept id=\"p1\">**</ept>, and then view the response.",
      "pos": [
        11130,
        11177
      ]
    },
    {
      "content": "Note the <bpt id=\"p1\">**</bpt>Response status<ept id=\"p1\">**</ept> of <bpt id=\"p2\">**</bpt>200 OK<ept id=\"p2\">**</ept>.",
      "pos": [
        11178,
        11221
      ]
    },
    {
      "content": "Operation results",
      "pos": [
        11225,
        11242
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>HTTP Get<ept id=\"p1\">**</ept> at a rate greater than the rate limit policy of 10 calls per minute.",
      "pos": [
        11278,
        11365
      ]
    },
    {
      "content": "After the rate limit policy is exceeded, a response status of <bpt id=\"p1\">**</bpt>429 Too Many Requests<ept id=\"p1\">**</ept> is returned.",
      "pos": [
        11366,
        11466
      ]
    },
    {
      "content": "Operation results",
      "pos": [
        11470,
        11487
      ]
    },
    {
      "pos": [
        11519,
        11641
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Response Headers<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Response content<ept id=\"p2\">**</ept> areas indicate the remaining interval before retries will be successful."
    },
    {
      "content": "When the rate limit policy of 10 calls per minute is in effect, subsequent calls will fail until 60 seconds have elapsed from the first of the 10 successful calls to the product before the rate limit was exceeded.",
      "pos": [
        11643,
        11856
      ]
    },
    {
      "content": "In this example, the remaining interval is 43 seconds.",
      "pos": [
        11857,
        11911
      ]
    },
    {
      "pos": [
        11916,
        11952
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"next-steps\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>Next steps"
    },
    {
      "pos": [
        11958,
        12049
      ],
      "content": "Check out the other topics in the <bpt id=\"p1\">[</bpt>Get started with advanced API configuration<ept id=\"p1\">][]</ept> tutorial."
    },
    {
      "content": "Watch a demo of setting rate limits and quotas in the following video.",
      "pos": [
        12054,
        12124
      ]
    },
    {
      "content": "test",
      "pos": [
        16604,
        16608
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Protect your API with Azure API Management | Microsoft Azure\"\n    description=\"Learn how to protect your API with quotas and throttling (rate-limiting) policies.\"\n    services=\"api-management\"\n    documentationCenter=\"\"\n    authors=\"steved0x\"\n    manager=\"dwrede\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"api-management\"\n    ms.workload=\"mobile\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"get-started-article\"\n    ms.date=\"08/05/2015\"\n    ms.author=\"sdanie\"/>\n\n# Protect your API with rate limits using Azure API Management\n\nThis guide shows you how easy it is to add protection for your backend API by configuring rate limit and quota policies with Azure API Management.\n\nIn this tutorial, you will create a \"Free Trial\" API product that allows developers to make up to 10 calls per minute and up to a maximum of 200 calls per week to your API. You will then publish the API and test the rate limit policy.\n\n>[AZURE.NOTE] If you already have a product configured and want to use it for this tutorial, you can jump ahead to [Configure call rate limit and quota policies][] and follow the tutorial from there using your product in place of the Free Trial product.\n\n## <a name=\"create-product\"> </a>To create a product\n\nIn this step, you will create a Free Trial product that does not require subscription approval.\n\nTo get started, click **Manage** in the Azure portal for your API Management service. This takes you to the API Management publisher portal.\n\n![Publisher portal][api-management-management-console]\n\n>If you have not yet created an API Management service instance, see [Create an API Management service instance][] in the [Get started with Azure API Management][] tutorial.\n\nClick **Products** in the **API Management** menu on the left to display the **Products** page.\n\n![Add product][api-management-add-product]\n\nClick **Add product** to display the **Add new product** dialog box.\n\n![Add new product][api-management-new-product-window]\n\nIn the **Title** box, type **Free Trial**.\n\nIn the **Description** box, type the following text:\n **Subscribers will be able to run 10 calls/minute up to a maximum of 200 calls/week after which access is denied.**\n\nProducts in API Management can be protected or open. Protected products must be subscribed to before they can be used. Open products can be used without a subscription. Ensure that **Require subscription** is selected to create a protected product that requires a subscription. This is the default setting.\n\nIf you want an administrator to review and accept or reject subscription attempts to this product, select **Require subscription approval**. If the check box is not selected, subscription attempts will be auto-approved. In this example, subscriptions are automatically approved, so do not select the box.\n\nTo allow developer accounts to subscribe multiple times to the new product, select the **Allow multiple simultaneous subscriptions** check box. This tutorial does not utilize multiple simultaneous subscriptions, so leave it unchecked.\n\nAfter all values are entered, click **Save** to create the product.\n\n![Product added][api-management-product-added]\n\nBy default, new products are visible to users in the **Administrators** group. We are going to add the **Developers** group. Click **Free Trial**, and then click the **Visibility** tab.\n\n>In API Management, groups are used to manage the visibility of products to developers. Products grant visibility to groups, and developers can view and subscribe to the products that are visible to the groups in which they belong. For more information, see [How to create and use groups in Azure API Management][].\n\n![Add developers group][api-management-add-developers-group]\n\nSelect the **Developers** check box, and then click **Save**.\n\n## <a name=\"add-api\"> </a>To add an API to the product\n\nIn this step of the tutorial, we will add the Echo API to the new Free Trial product.\n\n>Each API Management service instance comes pre-configured with an Echo API that can be used to experiment with and learn about API Management. For more information, see [Get started with Azure API Management][].\n\nClick **Products** from the **API Management** menu on the left, and then click **Free Trial** to configure the product.\n\n![Configure product][api-management-configure-product]\n\nClick **Add API to product**.\n\n![Add API to product][api-management-add-api]\n\nSelect **Echo API**, and then click **Save**.\n\n![Add Echo API][api-management-add-echo-api]\n\n## <a name=\"policies\"> </a>To configure call rate limit and quota policies\n\nRate limits and quotas are configured in the policy editor. Click **Policies** under the **API Management** menu on the left. In the **Product** list, click **Free Trial**.\n\n![Product policy][api-management-product-policy]\n\nClick **Add Policy** to import the policy template and begin creating the rate limit and quota policies.\n\n![Add policy][api-management-add-policy]\n\nTo insert policies, position the cursor into either the **inbound** or **outbound** section of the policy template. Rate limit and quota policies are inbound policies, so position the cursor in the inbound element.\n\n![Policy editor][api-management-policy-editor-inbound]\n\nThe two policies we are adding in this tutorial are the [Limit call rate][] and [Set usage quota][] policies.\n\n![Policy statements][api-management-limit-policies]\n\nAfter the cursor is positioned in the **inbound** policy element, click the arrow beside **Limit call rate** to insert its policy template.\n\n    <rate-limit calls=\"number\" renewal-period=\"seconds\">\n    <api name=\"name\" calls=\"number\">\n    <operation name=\"name\" calls=\"number\" />\n    </api>\n    </rate-limit>\n\n**Limit call rate** can be used at the product level and can also be used at the API and individual operation name levels. In this tutorial, only product-level policies are used, so delete the **api** and **operation** elements from the **rate-limit** element, so only the outer **rate-limit** element remains, as shown in the following example.\n\n    <rate-limit calls=\"number\" renewal-period=\"seconds\">\n    </rate-limit>\n\nIn the Free Trial product, the maximum allowable call rate is 10 calls per minute, so type **10** as the value for the **calls** attribute, and **60** for the **renewal-period** attribute.\n\n    <rate-limit calls=\"10\" renewal-period=\"60\">\n    </rate-limit>\n\nTo configure the **Set usage quota** policy, position your cursor immediately below the newly added **rate-limit** element within the **inbound** element, and then click the arrow to the left of **Set usage quota**.\n\n    <quota calls=\"number\" bandwidth=\"kilobytes\" renewal-period=\"seconds\">\n    <api name=\"name\" calls=\"number\" bandwidth=\"kilobytes\">\n    <operation name=\"name\" calls=\"number\" bandwidth=\"kilobytes\" />\n    </api>\n    </quota>\n\nBecause this policy is also intended to be at the product level, delete the **api** and **operation** name elements, as shown in the following example.\n\n    <quota calls=\"number\" bandwidth=\"kilobytes\" renewal-period=\"seconds\">\n    </quota>\n\nQuotas can be based on the number of calls per interval, bandwidth, or both. In this tutorial, we are not throttling based on bandwidth, so delete the **bandwidth** attribute.\n\n    <quota calls=\"number\" renewal-period=\"seconds\">\n    </quota>\n\nIn the Free Trial product, the quota is 200 calls per week. Specify **200** as the value for the **calls** attribute, and then specify **604800** as the value for the **renewal-period** attribute.\n\n    <quota calls=\"200\" renewal-period=\"604800\">\n    </quota>\n\n>Policy intervals are specified in seconds. To calculate the interval for a week, you can multiply the number of days (7) by the number of hours in a day (24) by the number of minutes in an hour (60) by the number of seconds in a minute (60): 7 * 24 * 60 * 60 = 604800.\n\nWhen you have finished configuring the policy, it should match the following example.\n\n    <policies>\n        <inbound>\n            <rate-limit calls=\"10\" renewal-period=\"60\">\n            </rate-limit>\n            <quota calls=\"200\" renewal-period=\"604800\">\n            </quota>\n            <base />\n\n    </inbound>\n    <outbound>\n\n        <base />\n\n        </outbound>\n    </policies>\n\nAfter the desired policies are configured, click **Save**.\n\n![Save policy][api-management-policy-save]\n\n## <a name=\"publish-product\"> </a> To publish the product\n\nNow that the the APIs are added and the policies are configured, the product must be published so that it can be used by developers. Click **Products** from the **API Management** menu on the left, and then click **Free Trial** to configure the product.\n\n![Configure product][api-management-configure-product]\n\nClick **Publish**, and then click **Yes, publish it** to confirm.\n\n![Publish product][api-management-publish-product]\n\n## <a name=\"subscribe-account\"> </a>To subscribe a developer account to the product\n\nNow that the product is published, it is available to be subscribed to and used by developers.\n\n>Administrators of an API Management instance are automatically subscribed to every product. In this tutorial step, we will subscribe one of the non-administrator developer accounts to the Free Trial product. If your developer account is part of the Administrators role, then you can follow along with this step, even though you are already subscribed.\n\nClick **Users** on the **API Management** menu on the left, and then click the name of your developer account. In this example, we are using the **Clayton Gragg** developer account.\n\n![Configure developer][api-management-configure-developer]\n\nClick **Add Subscription**.\n\n![Add subscription][api-management-add-subscription-menu]\n\nSelect **Free Trial**, and then click **Subscribe**.\n\n![Add subscription][api-management-add-subscription]\n\n>[AZURE.NOTE] In this tutorial, multiple simultaneous subscriptions are not enabled for the Free Trial product. If they were, you would be prompted to name the subscription, as shown in the following example.\n\n![Add subscription][api-management-add-subscription-multiple]\n\nAfter clicking **Subscribe**, the product appears in the **Subscription** list for the user.\n\n![Subscription added][api-management-subscription-added]\n\n## <a name=\"test-rate-limit\"> </a>To call an operation and test the rate limit\n\nNow that the Free Trial product is configured and published, we can call some operations and test the rate limit policy.\nSwitch to the developer portal by clicking **Developer portal** in the upper-right menu.\n\n![Developer portal][api-management-developer-portal-menu]\n\nClick **APIs** in the top menu, and then click **Echo API**.\n\n![Developer portal][api-management-developer-portal-api-menu]\n\nClick **GET Resource**, and then click **Open Console**.\n\n![Open console][api-management-open-console]\n\nKeep the default parameter values, and then select your subscription key for the Free Trial product.\n\n![Subscription key][api-management-select-key]\n\n>[AZURE.NOTE] If you have multiple subscriptions, be sure to select the key for **Free Trial**, or else the policies that were configured in the previous steps won't be in effect.\n\nClick **HTTP Get**, and then view the response. Note the **Response status** of **200 OK**.\n\n![Operation results][api-management-http-get-results]\n\nClick **HTTP Get** at a rate greater than the rate limit policy of 10 calls per minute. After the rate limit policy is exceeded, a response status of **429 Too Many Requests** is returned.\n\n![Operation results][api-management-http-get-429]\n\nThe **Response Headers** and **Response content** areas indicate the remaining interval before retries will be successful.\n\nWhen the rate limit policy of 10 calls per minute is in effect, subsequent calls will fail until 60 seconds have elapsed from the first of the 10 successful calls to the product before the rate limit was exceeded. In this example, the remaining interval is 43 seconds.\n\n## <a name=\"next-steps\"> </a>Next steps\n\n-   Check out the other topics in the [Get started with advanced API configuration][] tutorial.\n-   Watch a demo of setting rate limits and quotas in the following video.\n\n> [AZURE.VIDEO rate-limits-and-quotas]\n\n\n[api-management-management-console]: ./media/api-management-howto-product-with-rules/api-management-management-console.png\n[api-management-add-product]: ./media/api-management-howto-product-with-rules/api-management-add-product.png\n[api-management-new-product-window]: ./media/api-management-howto-product-with-rules/api-management-new-product-window.png\n[api-management-product-added]: ./media/api-management-howto-product-with-rules/api-management-product-added.png\n[api-management-add-policy]: ./media/api-management-howto-product-with-rules/api-management-add-policy.png\n[api-management-policy-editor-inbound]: ./media/api-management-howto-product-with-rules/api-management-policy-editor-inbound.png\n[api-management-limit-policies]: ./media/api-management-howto-product-with-rules/api-management-limit-policies.png\n[api-management-policy-save]: ./media/api-management-howto-product-with-rules/api-management-policy-save.png\n[api-management-configure-product]: ./media/api-management-howto-product-with-rules/api-management-configure-product.png\n[api-management-add-api]: ./media/api-management-howto-product-with-rules/api-management-add-api.png\n[api-management-add-echo-api]: ./media/api-management-howto-product-with-rules/api-management-add-echo-api.png\n[api-management-developer-portal-menu]: ./media/api-management-howto-product-with-rules/api-management-developer-portal-menu.png\n[api-management-publish-product]: ./media/api-management-howto-product-with-rules/api-management-publish-product.png\n[api-management-configure-developer]: ./media/api-management-howto-product-with-rules/api-management-configure-developer.png\n[api-management-add-subscription-menu]: ./media/api-management-howto-product-with-rules/api-management-add-subscription-menu.png\n[api-management-add-subscription]: ./media/api-management-howto-product-with-rules/api-management-add-subscription.png\n[api-management-developer-portal-api-menu]: ./media/api-management-howto-product-with-rules/api-management-developer-portal-api-menu.png\n[api-management-open-console]: ./media/api-management-howto-product-with-rules/api-management-open-console.png\n[api-management-http-get]: ./media/api-management-howto-product-with-rules/api-management-http-get.png\n[api-management-http-get-results]: ./media/api-management-howto-product-with-rules/api-management-http-get-results.png\n[api-management-http-get-429]: ./media/api-management-howto-product-with-rules/api-management-http-get-429.png\n[api-management-product-policy]: ./media/api-management-howto-product-with-rules/api-management-product-policy.png\n[api-management-add-developers-group]: ./media/api-management-howto-product-with-rules/api-management-add-developers-group.png\n[api-management-select-key]: ./media/api-management-howto-product-with-rules/api-management-select-key.png\n[api-management-subscription-added]: ./media/api-management-howto-product-with-rules/api-management-subscription-added.png\n[api-management-add-subscription-multiple]: ./media/api-management-howto-product-with-rules/api-management-add-subscription-multiple.png\n\n[How to add operations to an API]: api-management-howto-add-operations.md\n[How to add and publish a product]: api-management-howto-add-products.md\n[Monitoring and analytics]: ../api-management-monitoring.md\n[Add APIs to a product]: api-management-howto-add-products.md#add-apis\n[Publish a product]: api-management-howto-add-products.md#publish-product\n[Get started with Azure API Management]: api-management-get-started.md\n[How to create and use groups in Azure API Management]: api-management-howto-create-groups.md\n[View subscribers to a product]: api-management-howto-add-products.md#view-subscribers\n[Get started with Azure API Management]: api-management-get-started.md\n[Create an API Management service instance]: api-management-get-started.md#create-service-instance\n[Next steps]: #next-steps\n\n[Create a product]: #create-product\n[Configure call rate limit and quota policies]: #policies\n[Add an API to the product]: #add-api\n[Publish the product]: #publish-product\n[Subscribe a developer account to the product]: #subscribe-account\n[Call an operation and test the rate limit]: #test-rate-limit\n[Get started with advanced API configuration]: api-management-get-started-advanced.md\n\n[Limit call rate]: https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate\n[Set usage quota]: https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota\n\ntest\n"
}