{
  "nodes": [
    {
      "content": "Steps to failback from Azure to VMware",
      "pos": [
        27,
        65
      ]
    },
    {
      "content": "This article describes how Azure Site Recovery and vContinuum tool can be used to failback a virtual machine back to VMware.",
      "pos": [
        84,
        208
      ]
    },
    {
      "content": "Steps to failback from Azure to VMware",
      "pos": [
        527,
        565
      ]
    },
    {
      "content": "This document will walk you through the steps you need to failback from Azure back to your VMware site.",
      "pos": [
        567,
        670
      ]
    },
    {
      "content": "You must have already followed the steps given in the tutorial for <bpt id=\"p1\">[</bpt>VMware to Azure protection and recovery<ept id=\"p1\">](site-recovery-vmware-to-azure.md)</ept>.",
      "pos": [
        671,
        814
      ]
    },
    {
      "content": "After a successful failover to Azure, the virtual machines will be",
      "pos": [
        816,
        882
      ]
    },
    {
      "content": "available in the virtual machines tab.",
      "pos": [
        883,
        921
      ]
    },
    {
      "content": "When you decide to failback –",
      "pos": [
        922,
        951
      ]
    },
    {
      "content": "below are the steps you need to follow.",
      "pos": [
        952,
        991
      ]
    },
    {
      "content": "Note that when you failback from Azure back to your VMware site, the recovery can only be to a virtual machine.",
      "pos": [
        993,
        1104
      ]
    },
    {
      "content": "Even if your initial source on VMware was a physical machine, failover to Azure followed by a failback to VMware will convert it into a virtual machine.",
      "pos": [
        1105,
        1257
      ]
    },
    {
      "content": "Overview",
      "pos": [
        1262,
        1270
      ]
    },
    {
      "content": "Install vContinuum server on-premises",
      "pos": [
        1276,
        1313
      ]
    },
    {
      "content": "a.",
      "pos": [
        1319,
        1321
      ]
    },
    {
      "content": "Configure it to point to the CS",
      "pos": [
        1323,
        1354
      ]
    },
    {
      "content": "Deploy a PS on Azure",
      "pos": [
        1360,
        1380
      ]
    },
    {
      "content": "Install a MT on-premises",
      "pos": [
        1386,
        1410
      ]
    },
    {
      "content": "Steps to protect the failed over VMs back to on-premises",
      "pos": [
        1416,
        1472
      ]
    },
    {
      "content": "a.",
      "pos": [
        1478,
        1480
      ]
    },
    {
      "content": "Configuration considerations",
      "pos": [
        1482,
        1510
      ]
    },
    {
      "content": "Monitoring protection of VMs back to on-premises",
      "pos": [
        1516,
        1564
      ]
    },
    {
      "content": "Failover the VMs back to on-premises",
      "pos": [
        1570,
        1606
      ]
    },
    {
      "content": "Below is the setup overview that we will achieve with the below steps.",
      "pos": [
        1608,
        1678
      ]
    },
    {
      "content": "Part of the setup has already been completed during failover.",
      "pos": [
        1679,
        1740
      ]
    },
    {
      "content": "The blue lines are the connections used during failover.",
      "pos": [
        1746,
        1802
      ]
    },
    {
      "content": "The red lines are the connections used during failback.",
      "pos": [
        1808,
        1863
      ]
    },
    {
      "content": "The lines with arrows go over the internet.",
      "pos": [
        1869,
        1912
      ]
    },
    {
      "content": "Install vContinuum on-premsies",
      "pos": [
        1984,
        2014
      ]
    },
    {
      "content": "The vContinuum setup will be at available at <bpt id=\"p1\">[</bpt>download location<ept id=\"p1\">](http://go.microsoft.com/fwlink/?linkid=526305)</ept>.",
      "pos": [
        2016,
        2128
      ]
    },
    {
      "content": "In addition install the patch given here on the vContinuum - available at <bpt id=\"p1\">[</bpt>download location<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkID=533813)</ept>.",
      "pos": [
        2129,
        2270
      ]
    },
    {
      "content": "Launch the setup to begin installation of vContinuum.",
      "pos": [
        2276,
        2329
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        2330,
        2345
      ]
    },
    {
      "content": "Specify the CX server IP address and the CX server port.",
      "pos": [
        2413,
        2469
      ]
    },
    {
      "content": "Select HTTPS.",
      "pos": [
        2470,
        2483
      ]
    },
    {
      "content": "To discover the CX IP address go to the CS deployment on Azure and view its dashboard.",
      "pos": [
        2557,
        2643
      ]
    },
    {
      "content": "To discover the CX public port go to the endpoints tab in the VM page and identify the HTTPs endpoints public port.",
      "pos": [
        2718,
        2833
      ]
    },
    {
      "content": "Specify the CS Passphrase.",
      "pos": [
        2907,
        2933
      ]
    },
    {
      "content": "You need to have noted down the passphrase during the CS registration.",
      "pos": [
        2934,
        3004
      ]
    },
    {
      "content": "You would have used the passphrase during MT and PS deployments also.",
      "pos": [
        3005,
        3074
      ]
    },
    {
      "content": "In case you do not remember the passphrase you can go in to the CS server on Azure and find the passphrase stored under C:\\\\Program Files (x86)\\\\InMage Systems\\\\private\\\\connection.passphrase",
      "pos": [
        3075,
        3266
      ]
    },
    {
      "content": "Specify the location to install the vContinuum server and begin installation.",
      "pos": [
        3340,
        3417
      ]
    },
    {
      "pos": [
        3491,
        3648
      ],
      "content": "Once you see that installation completes, you can launch the vContinuum to see it working.\n![](./media/site-recovery-failback-azure-to-vmware/image8.png)",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Once you see that installation completes, you can launch the vContinuum to see it working.",
          "pos": [
            0,
            90
          ]
        }
      ]
    },
    {
      "content": "Install PS server on Azure",
      "pos": [
        3654,
        3680
      ]
    },
    {
      "content": "A Process Server needs to be installed on Azure so that the VMs in Azure can send the data back to on-premises MT.",
      "pos": [
        3682,
        3796
      ]
    },
    {
      "content": "You need to deploy the PS on Azure in the same network as the Configuration Server.",
      "pos": [
        3797,
        3880
      ]
    },
    {
      "pos": [
        3886,
        3969
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Configuration Servers<ept id=\"p1\">**</ept> page in Azure, select to add a new process server."
    },
    {
      "content": "Specify a process server name, and enter a name and password to connect to the virtual machine as an admin.",
      "pos": [
        4043,
        4150
      ]
    },
    {
      "content": "Select the configuration server to which you're registering the process server.",
      "pos": [
        4151,
        4230
      ]
    },
    {
      "content": "This should be the same server you're using to protect and fail over your virtual machines.",
      "pos": [
        4231,
        4322
      ]
    },
    {
      "content": "Specify the Azure ntwork in which the process server should be deployment.",
      "pos": [
        4323,
        4397
      ]
    },
    {
      "content": "It should be the same network as the configuration server.",
      "pos": [
        4398,
        4456
      ]
    },
    {
      "content": "Specify a unique IP address from the select subnet and begin deployment.",
      "pos": [
        4457,
        4529
      ]
    },
    {
      "content": "A job to deploy the process server will be triggered.",
      "pos": [
        4601,
        4654
      ]
    },
    {
      "content": "Once the process server is deployed on Azure you can log into the server",
      "pos": [
        4721,
        4793
      ]
    },
    {
      "content": "using the credentials you specified.",
      "pos": [
        4794,
        4830
      ]
    },
    {
      "content": "Use the same steps you used during",
      "pos": [
        4831,
        4865
      ]
    },
    {
      "content": "forward direction of protection to register the PS.",
      "pos": [
        4866,
        4917
      ]
    },
    {
      "content": "The servers registered during failback will not be visible under VM properties.",
      "pos": [
        4984,
        5063
      ]
    },
    {
      "content": "They will be only visible under the Servers tab under the Configuration server to which they have been registered.",
      "pos": [
        5064,
        5178
      ]
    },
    {
      "content": "It can take about 10-15 mins for the PS to be listed under the CS.",
      "pos": [
        5179,
        5245
      ]
    },
    {
      "content": "Install an MT server on-premises",
      "pos": [
        5250,
        5282
      ]
    },
    {
      "content": "Depending on the source side virtual machines you need to install a Linux or a Windows Master Target server on-premises.",
      "pos": [
        5284,
        5404
      ]
    },
    {
      "content": "Deploy Windows MT",
      "pos": [
        5410,
        5427
      ]
    },
    {
      "content": "A windows MT is already bundled with vContinuum setup.",
      "pos": [
        5429,
        5483
      ]
    },
    {
      "content": "When you install",
      "pos": [
        5484,
        5500
      ]
    },
    {
      "content": "the vContinuum, an MT is also deployed on the same machine and",
      "pos": [
        5501,
        5563
      ]
    },
    {
      "content": "registered to the Configuration server.",
      "pos": [
        5564,
        5603
      ]
    },
    {
      "pos": [
        5609,
        5736
      ],
      "content": "To begin deployment, create an empty machine on-premises on the ESX\nhost onto which you want to recover the VMs from Auzre.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "To begin deployment, create an empty machine on-premises on the ESX",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "host onto which you want to recover the VMs from Auzre.",
          "pos": [
            68,
            123
          ]
        }
      ]
    },
    {
      "pos": [
        5742,
        5878
      ],
      "content": "Ensure that there are at least two disks attached to the VM – one is\nused for the OS and the second one is used for Retention Drive.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Ensure that there are at least two disks attached to the VM – one is",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "used for the OS and the second one is used for Retention Drive.",
          "pos": [
            69,
            132
          ]
        }
      ]
    },
    {
      "content": "Install the operating system.",
      "pos": [
        5884,
        5913
      ]
    },
    {
      "pos": [
        5919,
        6009
      ],
      "content": "Install the vContinuum on the server. This would also complete\ninstallation of the MT.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Install the vContinuum on the server. This would also complete",
          "pos": [
            0,
            62
          ],
          "nodes": [
            {
              "content": "Install the vContinuum on the server.",
              "pos": [
                0,
                37
              ]
            },
            {
              "content": "This would also complete",
              "pos": [
                38,
                62
              ]
            }
          ]
        },
        {
          "content": "installation of the MT.",
          "pos": [
            63,
            86
          ]
        }
      ]
    },
    {
      "content": "Deploy Linux MT",
      "pos": [
        6015,
        6030
      ]
    },
    {
      "pos": [
        6036,
        6163
      ],
      "content": "To begin deployment, create an empty machine on-premises on the ESX\nhost onto which you want to recover the VMs from Auzre.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "To begin deployment, create an empty machine on-premises on the ESX",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "host onto which you want to recover the VMs from Auzre.",
          "pos": [
            68,
            123
          ]
        }
      ]
    },
    {
      "pos": [
        6169,
        6305
      ],
      "content": "Ensure that there are at least two disks attached to the VM – one is\nused for the OS and the second one is used for Retention Drive.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Ensure that there are at least two disks attached to the VM – one is",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "used for the OS and the second one is used for Retention Drive.",
          "pos": [
            69,
            132
          ]
        }
      ]
    },
    {
      "content": "Install the linux operating system.",
      "pos": [
        6311,
        6346
      ]
    },
    {
      "content": "NLinux Master Target (MT) system should not use LVM for root or retention storage spaces.",
      "pos": [
        6347,
        6436
      ]
    },
    {
      "content": "Linux MT configured to avoid LVM partitions/disks discovery by default.",
      "pos": [
        6437,
        6508
      ]
    },
    {
      "content": "Partitions that you can create are",
      "pos": [
        6513,
        6547
      ]
    },
    {
      "content": "Carry out the below post installation steps before beginning MT installation.",
      "pos": [
        6622,
        6699
      ]
    },
    {
      "content": "Post OS Installation Steps",
      "pos": [
        6707,
        6733
      ]
    },
    {
      "content": "To get SCSI ID’s for each of SCSI hard disk in a Linux virtual machine,",
      "pos": [
        6735,
        6806
      ]
    },
    {
      "content": "you should enable the parameter “disk.EnableUUID = TRUE”.",
      "pos": [
        6807,
        6864
      ]
    },
    {
      "content": "To enable this parameter, follow the steps as given below:",
      "pos": [
        6865,
        6923
      ]
    },
    {
      "content": "Shut down your virtual machine.",
      "pos": [
        6928,
        6959
      ]
    },
    {
      "pos": [
        6963,
        7033
      ],
      "content": "Right-click the VM’s entry in the left-hand panel &gt; <bpt id=\"p1\">**</bpt>Edit Settings<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Options<ept id=\"p1\">**</ept> tab.",
      "pos": [
        7037,
        7063
      ]
    },
    {
      "content": "Select the <bpt id=\"p1\">**</bpt>Advanced\\&gt;General item<ept id=\"p1\">**</ept> on the left and click the <bpt id=\"p2\">**</bpt>Configuration Parameters<ept id=\"p2\">**</ept> that you see on the right.",
      "pos": [
        7064,
        7183
      ]
    },
    {
      "content": "“Configuration Parameters” option will be in de-active state when the machine is running”.",
      "pos": [
        7184,
        7274
      ]
    },
    {
      "content": "In order to make this tab active, shutdown machine.",
      "pos": [
        7275,
        7326
      ]
    },
    {
      "content": "See whether already a row with <bpt id=\"p1\">**</bpt>disk.EnableUUID<ept id=\"p1\">**</ept> exists?",
      "pos": [
        7400,
        7458
      ]
    },
    {
      "content": "If exists and if the value is set to False over write the value with True (True and False values are case in-sensitive).",
      "pos": [
        7459,
        7579
      ]
    },
    {
      "content": "If exists and is set to true, click on cancel and test the SCSI command inside guest operating system after it is boot-up.",
      "pos": [
        7580,
        7702
      ]
    },
    {
      "content": "If does not exist click <bpt id=\"p1\">**</bpt>Add Row.<ept id=\"p1\">**</ept>",
      "pos": [
        7703,
        7739
      ]
    },
    {
      "content": "Add disk.EnableUUID in the Name column.",
      "pos": [
        7743,
        7782
      ]
    },
    {
      "content": "Set its value as TRUE.",
      "pos": [
        7783,
        7805
      ]
    },
    {
      "content": "Do not add the above values along with double-quotes.",
      "pos": [
        7806,
        7859
      ]
    },
    {
      "content": "Download and Install the Additional Packages",
      "pos": [
        7935,
        7979
      ]
    },
    {
      "content": "NOTE: Make sure system has Internet connectivity before download and",
      "pos": [
        7981,
        8049
      ]
    },
    {
      "content": "installing additional packages.",
      "pos": [
        8050,
        8081
      ]
    },
    {
      "content": "\\# yum install -y xfsprogs perl lsscsi rsync wget kexec-tools",
      "pos": [
        8083,
        8144
      ]
    },
    {
      "content": "Above command will download below mentioned 15 packages from CentOS 6.6",
      "pos": [
        8146,
        8217
      ]
    },
    {
      "content": "repository and install.",
      "pos": [
        8218,
        8241
      ]
    },
    {
      "content": "bc-1.06.95-1.el6.x86\\_64.rpm",
      "pos": [
        8243,
        8271
      ]
    },
    {
      "content": "busybox-1.15.1-20.el6.x86\\_64.rpm",
      "pos": [
        8273,
        8306
      ]
    },
    {
      "content": "elfutils-libs-0.158-3.2.el6.x86\\_64.rpm",
      "pos": [
        8308,
        8347
      ]
    },
    {
      "content": "kexec-tools-2.0.0-280.el6.x86\\_64.rpm",
      "pos": [
        8349,
        8386
      ]
    },
    {
      "content": "lsscsi-0.23-2.el6.x86\\_64.rpm",
      "pos": [
        8388,
        8417
      ]
    },
    {
      "content": "lzo-2.03-3.1.el6\\_5.1.x86\\_64.rpm",
      "pos": [
        8419,
        8452
      ]
    },
    {
      "content": "perl-5.10.1-136.el6\\_6.1.x86\\_64.rpm",
      "pos": [
        8454,
        8490
      ]
    },
    {
      "content": "perl-Module-Pluggable-3.90-136.el6\\_6.1.x86\\_64.rpm",
      "pos": [
        8492,
        8543
      ]
    },
    {
      "content": "perl-Pod-Escapes-1.04-136.el6\\_6.1.x86\\_64.rpm",
      "pos": [
        8545,
        8591
      ]
    },
    {
      "content": "perl-Pod-Simple-3.13-136.el6\\_6.1.x86\\_64.rpm",
      "pos": [
        8593,
        8638
      ]
    },
    {
      "content": "perl-libs-5.10.1-136.el6\\_6.1.x86\\_64.rpm",
      "pos": [
        8640,
        8681
      ]
    },
    {
      "content": "perl-version-0.77-136.el6\\_6.1.x86\\_64.rpm",
      "pos": [
        8683,
        8725
      ]
    },
    {
      "content": "rsync-3.0.6-12.el6.x86\\_64.rpm",
      "pos": [
        8727,
        8757
      ]
    },
    {
      "content": "snappy-1.1.0-1.el6.x86\\_64.rpm",
      "pos": [
        8759,
        8789
      ]
    },
    {
      "content": "wget-1.12-5.el6\\_6.1.x86\\_64.rpm",
      "pos": [
        8791,
        8823
      ]
    },
    {
      "content": "NOTE: If source machine uses Reiser or XFS filesystem for root or boot",
      "pos": [
        8825,
        8895
      ]
    },
    {
      "content": "device, then following packages should be download and installed on",
      "pos": [
        8896,
        8963
      ]
    },
    {
      "content": "Linux Master Target prior to the protection.",
      "pos": [
        8964,
        9008
      ]
    },
    {
      "content": "\\# cd /usr/local",
      "pos": [
        9010,
        9026
      ]
    },
    {
      "content": "\\# wget",
      "pos": [
        9028,
        9035
      ]
    },
    {
      "content": "\\# wget",
      "pos": [
        9128,
        9135
      ]
    },
    {
      "content": "\\# rpm -ivh kmod-reiserfs-0.0-1.el6.elrepo.x86\\_64.rpm",
      "pos": [
        9232,
        9286
      ]
    },
    {
      "content": "reiserfs-utils-3.6.21-1.el6.elrepo.x86\\_64.rpm",
      "pos": [
        9287,
        9333
      ]
    },
    {
      "content": "\\# wget",
      "pos": [
        9335,
        9342
      ]
    },
    {
      "content": "\\# rpm -ivh xfsprogs-3.1.1-16.el6.x86\\_64.rpm",
      "pos": [
        9434,
        9479
      ]
    },
    {
      "content": "Apply Custom Configuration Changes",
      "pos": [
        9486,
        9520
      ]
    },
    {
      "content": "Before applying custom configuration changes make sure you have",
      "pos": [
        9522,
        9585
      ]
    },
    {
      "content": "completed Post Installation Steps",
      "pos": [
        9586,
        9619
      ]
    },
    {
      "content": "To apply custom configuration changes, follow the below mentioned steps:",
      "pos": [
        9621,
        9693
      ]
    },
    {
      "content": "Copy the RHEL 6-64 Unified Agent binary to the newly created OS.",
      "pos": [
        9698,
        9762
      ]
    },
    {
      "content": "Run the below command to untar the binary.",
      "pos": [
        9767,
        9809
      ]
    },
    {
      "content": "tar -zxvf \\&lt;File name\\&gt;",
      "pos": [
        9813,
        9836
      ]
    },
    {
      "content": "Execute below command to give permission.",
      "pos": [
        9843,
        9884
      ]
    },
    {
      "pos": [
        9886,
        9926
      ],
      "content": "\\# <bpt id=\"p1\">**</bpt>chmod 755 ./ApplyCustomChanges.sh<ept id=\"p1\">**</ept>"
    },
    {
      "content": "Execute the below command to run the script.",
      "pos": [
        9931,
        9975
      ]
    },
    {
      "content": "\\# ./ApplyCustomChanges.sh",
      "pos": [
        9979,
        10005
      ]
    },
    {
      "content": "NOTE: Execute the script only once on the server.",
      "pos": [
        10009,
        10058
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>REBOOT<ept id=\"p1\">**</ept> the server",
      "pos": [
        10059,
        10080
      ]
    },
    {
      "content": "after successful execution of the above script.",
      "pos": [
        10081,
        10128
      ]
    },
    {
      "content": "Begin MT Installation",
      "pos": [
        10134,
        10155
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Download<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkID=529757)</ept> the Linux",
      "pos": [
        10157,
        10224
      ]
    },
    {
      "content": "Master Target Server installation file.",
      "pos": [
        10225,
        10264
      ]
    },
    {
      "content": "Copy the downloaded Linux Master Target Server installer to the Linux",
      "pos": [
        10266,
        10335
      ]
    },
    {
      "content": "Master Target virtual machine using an sftp client utility of your",
      "pos": [
        10336,
        10402
      ]
    },
    {
      "content": "choice.",
      "pos": [
        10403,
        10410
      ]
    },
    {
      "content": "Alternately you can log into the Linux Master Target virtual",
      "pos": [
        10411,
        10471
      ]
    },
    {
      "content": "machine and use wget to download the installation package from the",
      "pos": [
        10472,
        10538
      ]
    },
    {
      "content": "provided link.",
      "pos": [
        10539,
        10553
      ]
    },
    {
      "content": "Log in to the Linux Master Target server virtual machine using an ssh",
      "pos": [
        10555,
        10624
      ]
    },
    {
      "content": "client of your choice.",
      "pos": [
        10625,
        10647
      ]
    },
    {
      "content": "If you are connected to the Azure network on which you deployed your",
      "pos": [
        10649,
        10717
      ]
    },
    {
      "content": "Linux Master Target server through a VPN connection then use the",
      "pos": [
        10718,
        10782
      ]
    },
    {
      "content": "internal IP address for the Linux Master Target Server obtained from the",
      "pos": [
        10783,
        10855
      ]
    },
    {
      "content": "virtual machine dashboard and port 22 to connect to the Linux Master",
      "pos": [
        10856,
        10924
      ]
    },
    {
      "content": "Target Server using Secure Shell.",
      "pos": [
        10925,
        10958
      ]
    },
    {
      "content": "If you are connecting to the Linux Master Target Server over a public",
      "pos": [
        10960,
        11029
      ]
    },
    {
      "content": "internet connection use the Linux Master Target Server’s public virtual",
      "pos": [
        11030,
        11101
      ]
    },
    {
      "content": "IP address (from the virtual machines dashboard page) and the public",
      "pos": [
        11102,
        11170
      ]
    },
    {
      "content": "endpoint created for ssh to login to the Linux Master Target Server.",
      "pos": [
        11171,
        11239
      ]
    },
    {
      "content": "Extract the files from the gzipped Linux Master Target Server installer",
      "pos": [
        11241,
        11312
      ]
    },
    {
      "content": "tar archive by executing",
      "pos": [
        11313,
        11337
      ]
    },
    {
      "content": "<bpt id=\"p1\">*</bpt>“tar –xvzf Microsoft-ASR\\_UA\\_8.2.0.0\\_RHEL6-64\\*”<ept id=\"p1\">*</ept> from the directory",
      "pos": [
        11339,
        11410
      ]
    },
    {
      "content": "where you had copied the Linux Master Target Server installer to.",
      "pos": [
        11411,
        11476
      ]
    },
    {
      "content": "If you extracted the installer files to a different directory change",
      "pos": [
        11543,
        11611
      ]
    },
    {
      "content": "directory to the directory to which the contents of the tar archive were",
      "pos": [
        11612,
        11684
      ]
    },
    {
      "content": "extracted.",
      "pos": [
        11685,
        11695
      ]
    },
    {
      "content": "From this directory path execute “sudo ./install.sh”",
      "pos": [
        11696,
        11748
      ]
    },
    {
      "content": "When prompted to make choice of Primary Role of this Agent select 2",
      "pos": [
        11815,
        11882
      ]
    },
    {
      "content": "(Master Target)",
      "pos": [
        11883,
        11898
      ]
    },
    {
      "content": "Leave the other interactive install options at their default values.",
      "pos": [
        11900,
        11968
      ]
    },
    {
      "content": "Wait for the rest of the installation to proceed and the Host Config",
      "pos": [
        11970,
        12038
      ]
    },
    {
      "content": "Interface to appear.",
      "pos": [
        12039,
        12059
      ]
    },
    {
      "content": "The Host Configuration utility for the Linux Master",
      "pos": [
        12060,
        12111
      ]
    },
    {
      "content": "Target Server is a command line utility.",
      "pos": [
        12112,
        12152
      ]
    },
    {
      "content": "Don’t resize your ssh client",
      "pos": [
        12153,
        12181
      ]
    },
    {
      "content": "utility window.",
      "pos": [
        12182,
        12197
      ]
    },
    {
      "content": "Use the arrow keys to select the Global option and press",
      "pos": [
        12198,
        12254
      ]
    },
    {
      "content": "enter on your keyboard.",
      "pos": [
        12255,
        12278
      ]
    },
    {
      "pos": [
        12414,
        12567
      ],
      "content": "Against the field IP enter the Internal IP address of the\nConfiguration Server obtained from the virtual machines dashboard\npage and press enter.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "Against the field IP enter the Internal IP address of the",
          "pos": [
            0,
            57
          ]
        },
        {
          "content": "Configuration Server obtained from the virtual machines dashboard",
          "pos": [
            58,
            123
          ]
        },
        {
          "content": "page and press enter.",
          "pos": [
            124,
            145
          ]
        }
      ]
    },
    {
      "content": "Against the field Port enter 22 and press enter.",
      "pos": [
        12573,
        12621
      ]
    },
    {
      "content": "Leave Use https: as Yes.",
      "pos": [
        12627,
        12651
      ]
    },
    {
      "content": "Press enter one more time.",
      "pos": [
        12652,
        12678
      ]
    },
    {
      "pos": [
        12684,
        13049
      ],
      "content": "Enter the Passphrase that was generated on the Configuration Server.\nIf you are using PuTTY client from a Windows machine to ssh to the\nLinux Master Target Server virtual machine you can use Shift+Insert\nto paste the contents of the clipboard. Copy the Passphrase to the\nlocal clipboard using Ctrl-C and use Shift+Insert to paste it. Press\nenter",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "Enter the Passphrase that was generated on the Configuration Server.",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "If you are using PuTTY client from a Windows machine to ssh to the",
          "pos": [
            69,
            135
          ]
        },
        {
          "content": "Linux Master Target Server virtual machine you can use Shift+Insert",
          "pos": [
            136,
            203
          ]
        },
        {
          "content": "to paste the contents of the clipboard. Copy the Passphrase to the",
          "pos": [
            204,
            270
          ],
          "nodes": [
            {
              "content": "to paste the contents of the clipboard.",
              "pos": [
                0,
                39
              ]
            },
            {
              "content": "Copy the Passphrase to the",
              "pos": [
                40,
                66
              ]
            }
          ]
        },
        {
          "content": "local clipboard using Ctrl-C and use Shift+Insert to paste it. Press",
          "pos": [
            271,
            339
          ],
          "nodes": [
            {
              "content": "local clipboard using Ctrl-C and use Shift+Insert to paste it.",
              "pos": [
                0,
                62
              ]
            },
            {
              "content": "Press",
              "pos": [
                63,
                68
              ]
            }
          ]
        },
        {
          "content": "enter",
          "pos": [
            340,
            345
          ]
        }
      ]
    },
    {
      "content": "Use the right arrow key to navigate to quit and press enter.",
      "pos": [
        13055,
        13115
      ]
    },
    {
      "content": "Wait for the installation to complete",
      "pos": [
        13117,
        13154
      ]
    },
    {
      "content": "If for some reason you failed to register your Linux Master Target",
      "pos": [
        13221,
        13287
      ]
    },
    {
      "content": "Server to the Configuration Server you could do so again by running the",
      "pos": [
        13288,
        13359
      ]
    },
    {
      "content": "host configuration utility from /usr/local/ASR/Vx/bin/hostconfigcli (you",
      "pos": [
        13360,
        13432
      ]
    },
    {
      "content": "will first need to set access permissions to this directory by executing",
      "pos": [
        13433,
        13505
      ]
    },
    {
      "content": "chmod as a super user)",
      "pos": [
        13506,
        13528
      ]
    },
    {
      "content": "Validate Master Target Server registration to the Configuration Server.",
      "pos": [
        13536,
        13607
      ]
    },
    {
      "content": "You can validate that the Master Target Server registered successfully",
      "pos": [
        13609,
        13679
      ]
    },
    {
      "content": "with the Configuration Server by visiting the Server Details page under",
      "pos": [
        13680,
        13751
      ]
    },
    {
      "content": "the Configuration Server page on the Azure Site Recovery vault",
      "pos": [
        13752,
        13814
      ]
    },
    {
      "content": "Begin protecting the virtual machines back to on-premises",
      "pos": [
        13820,
        13877
      ]
    },
    {
      "content": "Before failback of the VMs back to on-premises, first you need to",
      "pos": [
        13879,
        13944
      ]
    },
    {
      "content": "protect the virtual machines back to on-premises.",
      "pos": [
        13945,
        13994
      ]
    },
    {
      "content": "Follow the below steps",
      "pos": [
        13995,
        14017
      ]
    },
    {
      "content": "to protect VMs of an application.",
      "pos": [
        14018,
        14051
      ]
    },
    {
      "content": "Note on temp drive",
      "pos": [
        14057,
        14075
      ]
    },
    {
      "content": "When a VM is failed over to Azure, it adds an extra temp drive for page",
      "pos": [
        14077,
        14148
      ]
    },
    {
      "content": "file.",
      "pos": [
        14149,
        14154
      ]
    },
    {
      "content": "This is an extra drive that is typically not required by your",
      "pos": [
        14155,
        14216
      ]
    },
    {
      "content": "failed over VM since it might already have a drive dedicated for the",
      "pos": [
        14217,
        14285
      ]
    },
    {
      "content": "page file.",
      "pos": [
        14286,
        14296
      ]
    },
    {
      "content": "Before you begin reverse protection of the virtual machines, you need to",
      "pos": [
        14298,
        14370
      ]
    },
    {
      "content": "ensure that the drive is taken offline so that it does not get",
      "pos": [
        14371,
        14433
      ]
    },
    {
      "content": "protected.",
      "pos": [
        14434,
        14444
      ]
    },
    {
      "content": "To do this,",
      "pos": [
        14446,
        14457
      ]
    },
    {
      "pos": [
        14463,
        14610
      ],
      "content": "Open Computer Management (via control panel administrative tool, or\nby right click on This PC in the explorer window and selecting\nmanage.)",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "Open Computer Management (via control panel administrative tool, or",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "by right click on This PC in the explorer window and selecting",
          "pos": [
            68,
            130
          ]
        },
        {
          "content": "manage.)",
          "pos": [
            131,
            139
          ]
        }
      ]
    },
    {
      "pos": [
        14616,
        14708
      ],
      "content": "Select Storage Management so that it lists the disks online and\nattached to the machine.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Select Storage Management so that it lists the disks online and",
          "pos": [
            0,
            63
          ]
        },
        {
          "content": "attached to the machine.",
          "pos": [
            64,
            88
          ]
        }
      ]
    },
    {
      "pos": [
        14714,
        14799
      ],
      "content": "Select the temporary disk attached to the machine and choose to\nbring it offline.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Select the temporary disk attached to the machine and choose to",
          "pos": [
            0,
            63
          ]
        },
        {
          "content": "bring it offline.",
          "pos": [
            64,
            81
          ]
        }
      ]
    },
    {
      "pos": [
        14805,
        14930
      ],
      "content": "Once it has been successfully taken offline you can proceed with\nprotecting the virtual machine in the reverse direction.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Once it has been successfully taken offline you can proceed with",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "protecting the virtual machine in the reverse direction.",
          "pos": [
            65,
            121
          ]
        }
      ]
    },
    {
      "content": "Protection plan for VMs",
      "pos": [
        14936,
        14959
      ]
    },
    {
      "content": "On the Azure portal, look at the states of the virtual machine and",
      "pos": [
        14961,
        15027
      ]
    },
    {
      "content": "ensure that they are failed over.",
      "pos": [
        15028,
        15061
      ]
    },
    {
      "content": "Note : during failover from Azure back to on-premises, the Azure VM is",
      "pos": [
        15128,
        15198
      ]
    },
    {
      "content": "considered similar to a Physical VM.",
      "pos": [
        15199,
        15235
      ]
    },
    {
      "content": "The failover to on-premises is to a",
      "pos": [
        15236,
        15271
      ]
    },
    {
      "content": "virtual machine.",
      "pos": [
        15272,
        15288
      ]
    },
    {
      "content": "Launch the vContinuum on your machine",
      "pos": [
        15294,
        15331
      ]
    },
    {
      "pos": [
        15401,
        15454
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Choose Application<ept id=\"p1\">**</ept> setting, select <bpt id=\"p2\">**</bpt>P2V<ept id=\"p2\">**</ept>"
    },
    {
      "pos": [
        15460,
        15507
      ],
      "content": "Click on the <bpt id=\"p1\">**</bpt>New Protection<ept id=\"p1\">**</ept> option to begin"
    },
    {
      "pos": [
        15513,
        15613
      ],
      "content": "In the new window that opens you will begin protecting the virtual\nmachines back to on-premises.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "In the new window that opens you will begin protecting the virtual",
          "pos": [
            0,
            66
          ]
        },
        {
          "content": "machines back to on-premises.",
          "pos": [
            67,
            96
          ]
        }
      ]
    },
    {
      "pos": [
        15619,
        15715
      ],
      "content": "a.  Select the **OS type** according to the VMs you want to failback\n    and **Get Details**",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "a.  Select the **OS type** according to the VMs you want to failback",
          "pos": [
            0,
            68
          ],
          "nodes": [
            {
              "content": "a.",
              "pos": [
                0,
                2
              ]
            },
            {
              "content": "Select the <bpt id=\"p1\">**</bpt>OS type<ept id=\"p1\">**</ept> according to the VMs you want to failback",
              "pos": [
                4,
                68
              ]
            }
          ]
        },
        {
          "content": "and <bpt id=\"p1\">**</bpt>Get Details<ept id=\"p1\">**</ept>",
          "pos": [
            73,
            92
          ]
        }
      ]
    },
    {
      "pos": [
        15721,
        15835
      ],
      "content": "b.  In the **Primary server details**, you need to identify the\n    virtual machines that you want to protect.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "b.  In the **Primary server details**, you need to identify the",
          "pos": [
            0,
            63
          ],
          "nodes": [
            {
              "content": "b.",
              "pos": [
                0,
                2
              ]
            },
            {
              "content": "In the <bpt id=\"p1\">**</bpt>Primary server details<ept id=\"p1\">**</ept>, you need to identify the",
              "pos": [
                4,
                63
              ]
            }
          ]
        },
        {
          "content": "virtual machines that you want to protect.",
          "pos": [
            68,
            110
          ]
        }
      ]
    },
    {
      "pos": [
        15841,
        15960
      ],
      "content": "c.  The virtual machines are listed by their Computer Hostnames and\n    not as they are visible on vCenter or Azure",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "c.  The virtual machines are listed by their Computer Hostnames and",
          "pos": [
            0,
            67
          ],
          "nodes": [
            {
              "content": "c.",
              "pos": [
                0,
                2
              ]
            },
            {
              "content": "The virtual machines are listed by their Computer Hostnames and",
              "pos": [
                4,
                67
              ]
            }
          ]
        },
        {
          "content": "not as they are visible on vCenter or Azure",
          "pos": [
            72,
            115
          ]
        }
      ]
    },
    {
      "pos": [
        15966,
        16088
      ],
      "content": "d.  The virtual machines are listed under the vCenter Hostname that\n    the virtual machines were on, before failover.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "d.  The virtual machines are listed under the vCenter Hostname that",
          "pos": [
            0,
            67
          ],
          "nodes": [
            {
              "content": "d.",
              "pos": [
                0,
                2
              ]
            },
            {
              "content": "The virtual machines are listed under the vCenter Hostname that",
              "pos": [
                4,
                67
              ]
            }
          ]
        },
        {
          "content": "the virtual machines were on, before failover.",
          "pos": [
            72,
            118
          ]
        }
      ]
    },
    {
      "pos": [
        16094,
        16183
      ],
      "content": "e.  Once you have identified the VMs you want to protect, select\n    them one by one.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "e.  Once you have identified the VMs you want to protect, select",
          "pos": [
            0,
            64
          ],
          "nodes": [
            {
              "content": "e.",
              "pos": [
                0,
                2
              ]
            },
            {
              "content": "Once you have identified the VMs you want to protect, select",
              "pos": [
                4,
                64
              ]
            }
          ]
        },
        {
          "content": "them one by one.",
          "pos": [
            69,
            85
          ]
        }
      ]
    },
    {
      "content": "When you select a virtual machine to protect (and it has already failed over to Azure) you will get a popup window that gives two entries for the virtual machine.",
      "pos": [
        16189,
        16351
      ]
    },
    {
      "content": "This is because the CS has detected two instances of the virtual machines registered to it.",
      "pos": [
        16352,
        16443
      ]
    },
    {
      "content": "You need to remove the entry for the on-premises VM so that you can protect the correct VM.",
      "pos": [
        16444,
        16535
      ]
    },
    {
      "content": "Note that you will see the entries by its computer hostname.",
      "pos": [
        16536,
        16596
      ]
    },
    {
      "content": "To identify the correct Azure VM entry here, you can log into the Azure VM and go to C:\\Program Files (x86)\\Microsoft Azure Site Recovery\\Application Data\\etc. In the file drscout.conf , identify the Host ID.",
      "pos": [
        16597,
        16805
      ]
    },
    {
      "content": "In the vContinuum dialog, keep the entry for which the hostID is found in the VM.",
      "pos": [
        16806,
        16887
      ]
    },
    {
      "content": "Delete all other entries.",
      "pos": [
        16888,
        16913
      ]
    },
    {
      "content": "To select the correct VM you can refer to its IP address.",
      "pos": [
        16984,
        17041
      ]
    },
    {
      "content": "The IP address range on-premises will be the on-premises VM.",
      "pos": [
        17042,
        17102
      ]
    },
    {
      "pos": [
        17107,
        17144
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Remove<ept id=\"p1\">**</ept> to delete the entry."
    },
    {
      "content": "Go to the vCenter and stop the virtual machine on the vCenter",
      "pos": [
        17215,
        17276
      ]
    },
    {
      "content": "Next you can also delete the virtual machines on-premises",
      "pos": [
        17281,
        17338
      ]
    },
    {
      "content": "Next you need to specify the on-premises MT server to which you want to protect the VMs.",
      "pos": [
        17344,
        17432
      ]
    },
    {
      "content": "To do this, connect to the vCenter to which you want to failback to",
      "pos": [
        17438,
        17505
      ]
    },
    {
      "pos": [
        17577,
        17671
      ],
      "content": "Select the MT server based on the host into which you want to\nrecover the virtual machines",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Select the MT server based on the host into which you want to",
          "pos": [
            0,
            61
          ]
        },
        {
          "content": "recover the virtual machines",
          "pos": [
            62,
            90
          ]
        }
      ]
    },
    {
      "content": "Next provide the replication option for each of the virtual machines",
      "pos": [
        17743,
        17811
      ]
    },
    {
      "pos": [
        17883,
        18010
      ],
      "content": "To do this you need to select the recovery side **Datastore** – this is the\ndatastore to which the VMs will be recovered to",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "To do this you need to select the recovery side <bpt id=\"p1\">**</bpt>Datastore<ept id=\"p1\">**</ept> – this is the",
          "pos": [
            0,
            75
          ]
        },
        {
          "content": "datastore to which the VMs will be recovered to",
          "pos": [
            76,
            123
          ]
        }
      ]
    },
    {
      "content": "The different options you need to provide per VM are",
      "pos": [
        18012,
        18064
      ]
    },
    {
      "content": "Option",
      "pos": [
        18068,
        18074
      ]
    },
    {
      "content": "Option recommended value",
      "pos": [
        18081,
        18105
      ]
    },
    {
      "content": "Process Server IP",
      "pos": [
        18116,
        18133
      ]
    },
    {
      "content": "Select the PS which you have deployed on Azure",
      "pos": [
        18136,
        18182
      ]
    },
    {
      "content": "Retention size in MB",
      "pos": [
        18183,
        18203
      ]
    },
    {
      "content": "Retention value",
      "pos": [
        18206,
        18221
      ]
    },
    {
      "content": "1",
      "pos": [
        18224,
        18225
      ]
    },
    {
      "content": "Days/Hours",
      "pos": [
        18226,
        18236
      ]
    },
    {
      "content": "Days",
      "pos": [
        18239,
        18243
      ]
    },
    {
      "content": "Consistency Interval",
      "pos": [
        18244,
        18264
      ]
    },
    {
      "content": "1",
      "pos": [
        18267,
        18268
      ]
    },
    {
      "content": "Select Target Datastore",
      "pos": [
        18269,
        18292
      ]
    },
    {
      "content": "The datastore available on the recovery side.",
      "pos": [
        18295,
        18340
      ]
    },
    {
      "content": "This data store should have enough space and also be available to the ESX host on which you want to realise the virtual machine.",
      "pos": [
        18341,
        18469
      ]
    },
    {
      "pos": [
        18475,
        18650
      ],
      "content": "Next you can configure the properties that the virtual machine will\nacquire after failover to on-premises site. The different properties\nyou can configure are as below",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "Next you can configure the properties that the virtual machine will",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "acquire after failover to on-premises site. The different properties",
          "pos": [
            68,
            136
          ],
          "nodes": [
            {
              "content": "acquire after failover to on-premises site.",
              "pos": [
                0,
                43
              ]
            },
            {
              "content": "The different properties",
              "pos": [
                44,
                68
              ]
            }
          ]
        },
        {
          "content": "you can configure are as below",
          "pos": [
            137,
            167
          ]
        }
      ]
    },
    {
      "content": "Property",
      "pos": [
        18720,
        18728
      ]
    },
    {
      "content": "How to configure",
      "pos": [
        18735,
        18751
      ]
    },
    {
      "content": "Network Configuration",
      "pos": [
        18762,
        18783
      ]
    },
    {
      "content": "For each NIC detected, configure the failback IP address for the virtual machine.",
      "pos": [
        18784,
        18865
      ]
    },
    {
      "content": "Select the NIC and click <bpt id=\"p1\">**</bpt>Change<ept id=\"p1\">**</ept> to specify the IP address details.",
      "pos": [
        18866,
        18936
      ]
    },
    {
      "content": "Hardware Configuration",
      "pos": [
        18937,
        18959
      ]
    },
    {
      "content": "You can specify the CPU and the Memory values for the VM.",
      "pos": [
        18960,
        19017
      ]
    },
    {
      "content": "This setting can be applied to all the VMs you are trying to protect.",
      "pos": [
        19018,
        19087
      ]
    },
    {
      "content": "Display Name",
      "pos": [
        19088,
        19100
      ]
    },
    {
      "content": "To identify the correct values for the CPU and Memory, you can refer to the IAAS VMs role size and see the number of cores and Memory assigned.",
      "pos": [
        19101,
        19244
      ]
    },
    {
      "content": "Display Name",
      "pos": [
        19245,
        19257
      ]
    },
    {
      "content": "After failover back to on-premises, you can choose to rename the virtual machines as it will be seen in the inventory of vCenter.",
      "pos": [
        19258,
        19387
      ]
    },
    {
      "content": "Note that the default value seen here is the virtual machine computer host name.",
      "pos": [
        19388,
        19468
      ]
    },
    {
      "content": "To identify the VM name, you can refer to the VM list in the Protection group.",
      "pos": [
        19469,
        19547
      ]
    },
    {
      "content": "NAT Configuration",
      "pos": [
        19548,
        19565
      ]
    },
    {
      "content": "Discussed in detail below",
      "pos": [
        19566,
        19591
      ]
    },
    {
      "content": "PS NAT settings choices",
      "pos": [
        19664,
        19687
      ]
    },
    {
      "pos": [
        19694,
        19792
      ],
      "content": "To enable protection of the virtual machines, two communication\nchannels need to be established.",
      "leadings": [
        "",
        "> "
      ],
      "nodes": [
        {
          "content": "To enable protection of the virtual machines, two communication",
          "pos": [
            0,
            63
          ]
        },
        {
          "content": "channels need to be established.",
          "pos": [
            64,
            96
          ]
        }
      ]
    },
    {
      "pos": [
        19797,
        20293
      ],
      "content": "The first channel is between the virtual machine and the Process\nServer. This channel collects the data from the VM and sends it to the\nPS. PS will then send this data to the Master Target. If the process\nserver and the virtual machine to be protected are on the same Azure\nvNet, then you do not need to use the NAT settings. If the PS and the\nvirtual machine to be protected is in two different vNet, then you\nneed to specify the NAT settings for the PS and check the first\noption.",
      "leadings": [
        "",
        "> ",
        "> ",
        "> ",
        "> ",
        "> ",
        "> ",
        "> "
      ],
      "nodes": [
        {
          "content": "The first channel is between the virtual machine and the Process",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "Server. This channel collects the data from the VM and sends it to the",
          "pos": [
            65,
            135
          ],
          "nodes": [
            {
              "content": "Server.",
              "pos": [
                0,
                7
              ]
            },
            {
              "content": "This channel collects the data from the VM and sends it to the",
              "pos": [
                8,
                70
              ]
            }
          ]
        },
        {
          "content": "PS. PS will then send this data to the Master Target. If the process",
          "pos": [
            136,
            204
          ],
          "nodes": [
            {
              "content": "PS.",
              "pos": [
                0,
                3
              ]
            },
            {
              "content": "PS will then send this data to the Master Target.",
              "pos": [
                4,
                53
              ]
            },
            {
              "content": "If the process",
              "pos": [
                54,
                68
              ]
            }
          ]
        },
        {
          "content": "server and the virtual machine to be protected are on the same Azure",
          "pos": [
            205,
            273
          ]
        },
        {
          "content": "vNet, then you do not need to use the NAT settings. If the PS and the",
          "pos": [
            274,
            343
          ],
          "nodes": [
            {
              "content": "vNet, then you do not need to use the NAT settings.",
              "pos": [
                0,
                51
              ]
            },
            {
              "content": "If the PS and the",
              "pos": [
                52,
                69
              ]
            }
          ]
        },
        {
          "content": "virtual machine to be protected is in two different vNet, then you",
          "pos": [
            344,
            410
          ]
        },
        {
          "content": "need to specify the NAT settings for the PS and check the first",
          "pos": [
            411,
            474
          ]
        },
        {
          "content": "option.",
          "pos": [
            475,
            482
          ]
        }
      ]
    },
    {
      "pos": [
        20366,
        20481
      ],
      "content": "To identify the Process server Public IP, you can go to the PS\ndeployment in Azure and see its Public IP address.",
      "leadings": [
        "",
        "> "
      ],
      "nodes": [
        {
          "content": "To identify the Process server Public IP, you can go to the PS",
          "pos": [
            0,
            62
          ]
        },
        {
          "content": "deployment in Azure and see its Public IP address.",
          "pos": [
            63,
            113
          ]
        }
      ]
    },
    {
      "pos": [
        20486,
        20913
      ],
      "content": "The second channel is between the Process server and the Master\ntarget. The option to use NAT or not depends on whether you are using\nVPN based connection between MT and PS or protecting over the\ninternet. If the PS communicates to the MT over a VPN, then you should\nnot select this option. If the Master Target needs to communicate to\nthe Process server over the internet, then specify the NAT settings\nfor the PS.",
      "leadings": [
        "",
        "> ",
        "> ",
        "> ",
        "> ",
        "> ",
        "> "
      ],
      "nodes": [
        {
          "content": "The second channel is between the Process server and the Master",
          "pos": [
            0,
            63
          ]
        },
        {
          "content": "target. The option to use NAT or not depends on whether you are using",
          "pos": [
            64,
            133
          ],
          "nodes": [
            {
              "content": "target.",
              "pos": [
                0,
                7
              ]
            },
            {
              "content": "The option to use NAT or not depends on whether you are using",
              "pos": [
                8,
                69
              ]
            }
          ]
        },
        {
          "content": "VPN based connection between MT and PS or protecting over the",
          "pos": [
            134,
            195
          ]
        },
        {
          "content": "internet. If the PS communicates to the MT over a VPN, then you should",
          "pos": [
            196,
            266
          ],
          "nodes": [
            {
              "content": "internet.",
              "pos": [
                0,
                9
              ]
            },
            {
              "content": "If the PS communicates to the MT over a VPN, then you should",
              "pos": [
                10,
                70
              ]
            }
          ]
        },
        {
          "content": "not select this option. If the Master Target needs to communicate to",
          "pos": [
            267,
            335
          ],
          "nodes": [
            {
              "content": "not select this option.",
              "pos": [
                0,
                23
              ]
            },
            {
              "content": "If the Master Target needs to communicate to",
              "pos": [
                24,
                68
              ]
            }
          ]
        },
        {
          "content": "the Process server over the internet, then specify the NAT settings",
          "pos": [
            336,
            403
          ]
        },
        {
          "content": "for the PS.",
          "pos": [
            404,
            415
          ]
        }
      ]
    },
    {
      "pos": [
        20986,
        21101
      ],
      "content": "To identify the Process server Public IP, you can go to the PS\ndeployment in Azure and see its Public IP address.",
      "leadings": [
        "",
        "> "
      ],
      "nodes": [
        {
          "content": "To identify the Process server Public IP, you can go to the PS",
          "pos": [
            0,
            62
          ]
        },
        {
          "content": "deployment in Azure and see its Public IP address.",
          "pos": [
            63,
            113
          ]
        }
      ]
    },
    {
      "pos": [
        21175,
        21623
      ],
      "content": "If you have not deleted the on-premises virtual machines as specified\nin Step 5.d, and if the datastore you are failing back to, as\nselected in step 7.a still contains the old VMDK’s then you will\nalso need to ensure that the failback VM gets created in a new\nplace. For this you can select the Advanced settings and specify an\nalternate Folder to restore to in the **Folder Name Settings**\nsection of the Advanced Settings.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "If you have not deleted the on-premises virtual machines as specified",
          "pos": [
            0,
            69
          ]
        },
        {
          "content": "in Step 5.d, and if the datastore you are failing back to, as",
          "pos": [
            70,
            131
          ]
        },
        {
          "content": "selected in step 7.a still contains the old VMDK’s then you will",
          "pos": [
            132,
            196
          ]
        },
        {
          "content": "also need to ensure that the failback VM gets created in a new",
          "pos": [
            197,
            259
          ]
        },
        {
          "content": "place. For this you can select the Advanced settings and specify an",
          "pos": [
            260,
            327
          ],
          "nodes": [
            {
              "content": "place.",
              "pos": [
                0,
                6
              ]
            },
            {
              "content": "For this you can select the Advanced settings and specify an",
              "pos": [
                7,
                67
              ]
            }
          ]
        },
        {
          "content": "alternate Folder to restore to in the <bpt id=\"p1\">**</bpt>Folder Name Settings<ept id=\"p1\">**</ept>",
          "pos": [
            328,
            390
          ]
        },
        {
          "content": "section of the Advanced Settings.",
          "pos": [
            391,
            424
          ]
        }
      ]
    },
    {
      "content": "The other options in the Advanced settings can be left as default.",
      "pos": [
        21690,
        21756
      ]
    },
    {
      "content": "Make sure you apply the folder name settings to all the servers.",
      "pos": [
        21757,
        21821
      ]
    },
    {
      "pos": [
        21827,
        22004
      ],
      "content": "Next move to the final stage of the Protection. Here you need to run\na Readiness Check to ensure that the virtual machines are ready to\nbe protected back to on-premises.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "Next move to the final stage of the Protection. Here you need to run",
          "pos": [
            0,
            68
          ],
          "nodes": [
            {
              "content": "Next move to the final stage of the Protection.",
              "pos": [
                0,
                47
              ]
            },
            {
              "content": "Here you need to run",
              "pos": [
                48,
                68
              ]
            }
          ]
        },
        {
          "content": "a Readiness Check to ensure that the virtual machines are ready to",
          "pos": [
            69,
            135
          ]
        },
        {
          "content": "be protected back to on-premises.",
          "pos": [
            136,
            169
          ]
        }
      ]
    },
    {
      "content": "The Protection will now begin.",
      "pos": [
        22535,
        22565
      ]
    },
    {
      "content": "a.",
      "pos": [
        22571,
        22573
      ]
    },
    {
      "content": "You can see the progress of the protection on the vContinuum",
      "pos": [
        22575,
        22635
      ]
    },
    {
      "content": "You can also see the exact status of the pairs by clicking into the",
      "pos": [
        22984,
        23051
      ]
    },
    {
      "content": "virtual machine and monitoring its progress under the volume replication",
      "pos": [
        23052,
        23124
      ]
    },
    {
      "content": "section.",
      "pos": [
        23125,
        23133
      ]
    },
    {
      "content": "Prepare the Failback plan",
      "pos": [
        23203,
        23228
      ]
    },
    {
      "content": "You can prepare a failback plan using vContinuum so that the application",
      "pos": [
        23230,
        23302
      ]
    },
    {
      "content": "can be failed over back to on-premises at any time.",
      "pos": [
        23303,
        23354
      ]
    },
    {
      "content": "These recovery plans",
      "pos": [
        23355,
        23375
      ]
    },
    {
      "content": "are very similar to the ASR Recovery plans.",
      "pos": [
        23376,
        23419
      ]
    },
    {
      "pos": [
        23425,
        23489
      ],
      "content": "Launch the vContinuum and select the option to <bpt id=\"p1\">**</bpt>Manage plans<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        23495,
        23535
      ],
      "content": "User the sub-options select <bpt id=\"p1\">**</bpt>Recover.<ept id=\"p1\">**</ept>"
    },
    {
      "content": "You can see the list of all the Plans that have been used to protect the virtual machines.",
      "pos": [
        23606,
        23696
      ]
    },
    {
      "content": "These are the same plans you can use to recover.",
      "pos": [
        23697,
        23745
      ]
    },
    {
      "content": "Select the Protection Plan and select all the VMs you want to recover within it.",
      "pos": [
        23751,
        23831
      ]
    },
    {
      "pos": [
        23837,
        23998
      ],
      "content": "a.  On selecting each VM you can see more details about the source\n    VM, target ESX server where the VM will be recovered to and the\n    source VM disk",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "a.  On selecting each VM you can see more details about the source",
          "pos": [
            0,
            66
          ],
          "nodes": [
            {
              "content": "a.",
              "pos": [
                0,
                2
              ]
            },
            {
              "content": "On selecting each VM you can see more details about the source",
              "pos": [
                4,
                66
              ]
            }
          ]
        },
        {
          "content": "VM, target ESX server where the VM will be recovered to and the",
          "pos": [
            71,
            134
          ]
        },
        {
          "content": "source VM disk",
          "pos": [
            139,
            153
          ]
        }
      ]
    },
    {
      "pos": [
        24004,
        24046
      ],
      "content": "Click Next to begin the <bpt id=\"p1\">**</bpt>Recover<ept id=\"p1\">**</ept> Wizard"
    },
    {
      "content": "Select the Virtual Machines you want to recover",
      "pos": [
        24052,
        24099
      ]
    },
    {
      "content": "a.",
      "pos": [
        24105,
        24107
      ]
    },
    {
      "content": "See the list of all the virtual machines that you can recover",
      "pos": [
        24109,
        24170
      ]
    },
    {
      "pos": [
        24540,
        24783
      ],
      "content": "Run the **Readiness Check.** This will inform if the right\nparameters are configured to enable the latest tag recovery of the\nvirtual machine. Click Next if all the checks are successful else\nlook at the log and resolve the errors.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "Run the <bpt id=\"p1\">**</bpt>Readiness Check.<ept id=\"p1\">**</ept> This will inform if the right",
          "pos": [
            0,
            58
          ]
        },
        {
          "content": "parameters are configured to enable the latest tag recovery of the",
          "pos": [
            59,
            125
          ]
        },
        {
          "content": "virtual machine. Click Next if all the checks are successful else",
          "pos": [
            126,
            191
          ],
          "nodes": [
            {
              "content": "virtual machine.",
              "pos": [
                0,
                16
              ]
            },
            {
              "content": "Click Next if all the checks are successful else",
              "pos": [
                17,
                65
              ]
            }
          ]
        },
        {
          "content": "look at the log and resolve the errors.",
          "pos": [
            192,
            231
          ]
        }
      ]
    },
    {
      "pos": [
        24854,
        25167
      ],
      "content": "In the VM Configuration step of the wizard, ensure that the recovery\nsettings are correctly set. In case the VM settings are different\nfrom the one you require, you can choose to change them. Since we\nhave already completed this action during the protection, you may\nchoose to ignore it this time.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "In the VM Configuration step of the wizard, ensure that the recovery",
          "pos": [
            0,
            68
          ]
        },
        {
          "content": "settings are correctly set. In case the VM settings are different",
          "pos": [
            69,
            134
          ],
          "nodes": [
            {
              "content": "settings are correctly set.",
              "pos": [
                0,
                27
              ]
            },
            {
              "content": "In case the VM settings are different",
              "pos": [
                28,
                65
              ]
            }
          ]
        },
        {
          "content": "from the one you require, you can choose to change them. Since we",
          "pos": [
            135,
            200
          ],
          "nodes": [
            {
              "content": "from the one you require, you can choose to change them.",
              "pos": [
                0,
                56
              ]
            },
            {
              "content": "Since we",
              "pos": [
                57,
                65
              ]
            }
          ]
        },
        {
          "content": "have already completed this action during the protection, you may",
          "pos": [
            201,
            266
          ]
        },
        {
          "content": "choose to ignore it this time.",
          "pos": [
            267,
            297
          ]
        }
      ]
    },
    {
      "content": "Finally review the list of virtual machines that will be recovered.",
      "pos": [
        25238,
        25305
      ]
    },
    {
      "content": "a.",
      "pos": [
        25311,
        25313
      ]
    },
    {
      "content": "Specify a recovery order to the virtual machines.",
      "pos": [
        25315,
        25364
      ]
    },
    {
      "content": "Note: The virtual machines are listed using the Computer Hostname.",
      "pos": [
        25366,
        25432
      ]
    },
    {
      "content": "It",
      "pos": [
        25433,
        25435
      ]
    },
    {
      "content": "might be difficult to map the computer hostname to the virtual machine.",
      "pos": [
        25436,
        25507
      ]
    },
    {
      "content": "To map the names, you can go to the virtual machines dashboard in Azure",
      "pos": [
        25508,
        25579
      ]
    },
    {
      "content": "IAAS and look at the hostname of the virtual machine.",
      "pos": [
        25580,
        25633
      ]
    },
    {
      "pos": [
        25705,
        25794
      ],
      "content": "Give the **recovery plan name** and select **Recover later** in\n**Recovery options.**",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Give the <bpt id=\"p1\">**</bpt>recovery plan name<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Recover later<ept id=\"p2\">**</ept> in",
          "pos": [
            0,
            63
          ]
        },
        {
          "content": "**Recovery options.**",
          "pos": [
            64,
            85
          ],
          "nodes": [
            {
              "content": "Recovery options.",
              "pos": [
                2,
                19
              ]
            },
            {
              "content": "**",
              "pos": [
                19,
                21
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        26176,
        26257
      ],
      "content": "You can see the Recovery Status and see if it the plan is\nsuccessfully saved.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "You can see the Recovery Status and see if it the plan is",
          "pos": [
            0,
            57
          ]
        },
        {
          "content": "successfully saved.",
          "pos": [
            58,
            77
          ]
        }
      ]
    },
    {
      "pos": [
        26329,
        26442
      ],
      "content": "If you have chosen to recover later, you will be informed that the\nplan is created and you can recover later.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "If you have chosen to recover later, you will be informed that the",
          "pos": [
            0,
            66
          ]
        },
        {
          "content": "plan is created and you can recover later.",
          "pos": [
            67,
            109
          ]
        }
      ]
    },
    {
      "content": "Recover Virtual Machines",
      "pos": [
        26512,
        26536
      ]
    },
    {
      "content": "After the plan is created, you can choose to recover the virtual",
      "pos": [
        26538,
        26602
      ]
    },
    {
      "content": "machines.",
      "pos": [
        26603,
        26612
      ]
    },
    {
      "content": "As a pre-requisite, you need to ensure that the virtual",
      "pos": [
        26613,
        26668
      ]
    },
    {
      "content": "machines have completed synchronization.",
      "pos": [
        26669,
        26709
      ]
    },
    {
      "content": "If Replication Status shows OK then the protection is completed and the",
      "pos": [
        26776,
        26847
      ]
    },
    {
      "content": "RPO threshold has been met.",
      "pos": [
        26848,
        26875
      ]
    },
    {
      "content": "To confirm the replication pair’s health,",
      "pos": [
        26876,
        26917
      ]
    },
    {
      "content": "you can go to the virtual machine properties and see the health of the",
      "pos": [
        26918,
        26988
      ]
    },
    {
      "content": "replication.",
      "pos": [
        26989,
        27001
      ]
    },
    {
      "content": "Turn off the Azure virtual machines before you initiate the recovery.",
      "pos": [
        27005,
        27074
      ]
    },
    {
      "content": "This will ensure that there is no split brain and your end customers",
      "pos": [
        27075,
        27143
      ]
    },
    {
      "content": "will be served by one copy of the application.",
      "pos": [
        27144,
        27190
      ]
    },
    {
      "content": "Only when you have",
      "pos": [
        27191,
        27209
      ]
    },
    {
      "content": "successfully ensured that the Azure VMs are turned off continue to the",
      "pos": [
        27210,
        27280
      ]
    },
    {
      "content": "steps below.",
      "pos": [
        27281,
        27293
      ]
    },
    {
      "content": "To begin recovering the virtual machines back to on-premise, you need to",
      "pos": [
        27297,
        27369
      ]
    },
    {
      "content": "start the plan that is saved.",
      "pos": [
        27370,
        27399
      ]
    },
    {
      "pos": [
        27405,
        27455
      ],
      "content": "On the vContinuum select to <bpt id=\"p1\">**</bpt>Monitor<ept id=\"p1\">**</ept> the plans."
    },
    {
      "content": "The wizard will list the plans that have been executed till now.",
      "pos": [
        27461,
        27525
      ]
    },
    {
      "pos": [
        27596,
        27674
      ],
      "content": "Select the **Recovery** node and select the plan that you want to\nrecover.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Select the <bpt id=\"p1\">**</bpt>Recovery<ept id=\"p1\">**</ept> node and select the plan that you want to",
          "pos": [
            0,
            65
          ]
        },
        {
          "content": "recover.",
          "pos": [
            66,
            74
          ]
        }
      ]
    },
    {
      "content": "a.",
      "pos": [
        27680,
        27682
      ]
    },
    {
      "content": "It will inform you that the plan has not yet started.",
      "pos": [
        27684,
        27737
      ]
    },
    {
      "pos": [
        27743,
        27781
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> to begin the recovery."
    },
    {
      "content": "You can monitor the recovery of the virtual machines",
      "pos": [
        27787,
        27839
      ]
    },
    {
      "pos": [
        27910,
        28005
      ],
      "content": "Once the VMs have been powered ON, you can connect to the virtual\n machines on your vCenter.",
      "leadings": [
        "",
        "   "
      ],
      "nodes": [
        {
          "content": "Once the VMs have been powered ON, you can connect to the virtual",
          "pos": [
            0,
            65
          ]
        },
        {
          "content": "machines on your vCenter.",
          "pos": [
            67,
            92
          ]
        }
      ]
    },
    {
      "content": "Re-protect to Azure after failback",
      "pos": [
        28010,
        28044
      ]
    },
    {
      "content": "After failback has been completed you may want to protect the virtual",
      "pos": [
        28046,
        28115
      ]
    },
    {
      "content": "machines once again.",
      "pos": [
        28116,
        28136
      ]
    },
    {
      "content": "The below steps will help you re-configure the",
      "pos": [
        28137,
        28183
      ]
    },
    {
      "content": "protection",
      "pos": [
        28184,
        28194
      ]
    },
    {
      "pos": [
        28200,
        28312
      ],
      "content": "Check that the virtual machines on-premises are working and\napplication is able to reach your end customers.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Check that the virtual machines on-premises are working and",
          "pos": [
            0,
            59
          ]
        },
        {
          "content": "application is able to reach your end customers.",
          "pos": [
            60,
            108
          ]
        }
      ]
    },
    {
      "pos": [
        28318,
        28401
      ],
      "content": "On the Azure Site Recovery portal, select the virtual machines and\ndelete them.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "On the Azure Site Recovery portal, select the virtual machines and",
          "pos": [
            0,
            66
          ]
        },
        {
          "content": "delete them.",
          "pos": [
            67,
            79
          ]
        }
      ]
    },
    {
      "pos": [
        28407,
        28529
      ],
      "content": "a.  Select to disable the protection of the virtual machines. This\n    will ensure that the VMs are no more protected.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "a.  Select to disable the protection of the virtual machines. This",
          "pos": [
            0,
            66
          ],
          "nodes": [
            {
              "content": "a.",
              "pos": [
                0,
                2
              ]
            },
            {
              "content": "Select to disable the protection of the virtual machines.",
              "pos": [
                4,
                61
              ]
            },
            {
              "content": "This",
              "pos": [
                62,
                66
              ]
            }
          ]
        },
        {
          "content": "will ensure that the VMs are no more protected.",
          "pos": [
            71,
            118
          ]
        }
      ]
    },
    {
      "pos": [
        28535,
        28608
      ],
      "content": "Go to the Azure IAAS virtual machines and delete the failed over\nVMs.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Go to the Azure IAAS virtual machines and delete the failed over",
          "pos": [
            0,
            64
          ]
        },
        {
          "content": "VMs.",
          "pos": [
            65,
            69
          ]
        }
      ]
    },
    {
      "pos": [
        28614,
        28710
      ],
      "content": "Delete the old VMs on vSpehere – these are the VMs that you\npreviously failed over to Azure.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Delete the old VMs on vSpehere – these are the VMs that you",
          "pos": [
            0,
            59
          ]
        },
        {
          "content": "previously failed over to Azure.",
          "pos": [
            60,
            92
          ]
        }
      ]
    },
    {
      "pos": [
        28716,
        28798
      ],
      "content": "On the ASR portal select to protect the virtual machines recently\nfailed over.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "On the ASR portal select to protect the virtual machines recently",
          "pos": [
            0,
            65
          ]
        },
        {
          "content": "failed over.",
          "pos": [
            66,
            78
          ]
        }
      ]
    },
    {
      "pos": [
        28804,
        28902
      ],
      "content": "Once the VMs are protected, you can add them to a recovery plan and\nbe continuously protected.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Once the VMs are protected, you can add them to a recovery plan and",
          "pos": [
            0,
            67
          ]
        },
        {
          "content": "be continuously protected.",
          "pos": [
            68,
            94
          ]
        }
      ]
    }
  ],
  "content": "<properties \n   pageTitle=\"Steps to failback from Azure to VMware\" \n   description=\"This article describes how Azure Site Recovery and vContinuum tool can be used to failback a virtual machine back to VMware.\" \n   services=\"site-recovery\" \n   documentationCenter=\"\" \n   authors=\"ruturaj\" \n   manager=\"mkjain\" \n   editor=\"\"/>\n\n<tags\n   ms.service=\"site-recovery\"\n   ms.devlang=\"powershell\"\n   ms.tgt_pltfrm=\"na\"\n   ms.topic=\"article\"\n   ms.workload=\"required\" \n   ms.date=\"08/05/2015\"\n   ms.author=\"ruturajd@microsoft.com\"/>\n\n# Steps to failback from Azure to VMware\n\nThis document will walk you through the steps you need to failback from Azure back to your VMware site. You must have already followed the steps given in the tutorial for [VMware to Azure protection and recovery](site-recovery-vmware-to-azure.md).\n\nAfter a successful failover to Azure, the virtual machines will be\navailable in the virtual machines tab. When you decide to failback –\nbelow are the steps you need to follow.\n\nNote that when you failback from Azure back to your VMware site, the recovery can only be to a virtual machine. Even if your initial source on VMware was a physical machine, failover to Azure followed by a failback to VMware will convert it into a virtual machine.\n\n## Overview\n\n1.  Install vContinuum server on-premises\n\n    a.  Configure it to point to the CS\n\n2.  Deploy a PS on Azure\n\n3.  Install a MT on-premises\n\n4.  Steps to protect the failed over VMs back to on-premises\n\n    a.  Configuration considerations\n\n5.  Monitoring protection of VMs back to on-premises\n\n6.  Failover the VMs back to on-premises\n\nBelow is the setup overview that we will achieve with the below steps.\nPart of the setup has already been completed during failover.\n\n-   The blue lines are the connections used during failover.\n\n-   The red lines are the connections used during failback.\n\n-   The lines with arrows go over the internet.\n\n![](./media/site-recovery-failback-azure-to-vmware/vconports.png)\n\n## Install vContinuum on-premsies\n\nThe vContinuum setup will be at available at [download location](http://go.microsoft.com/fwlink/?linkid=526305). In addition install the patch given here on the vContinuum - available at [download location](http://go.microsoft.com/fwlink/?LinkID=533813).\n\n1.  Launch the setup to begin installation of vContinuum. Click **Next**.\n![](./media/site-recovery-failback-azure-to-vmware/image2.png)\n2.  Specify the CX server IP address and the CX server port. Select HTTPS.\n\n    ![](./media/site-recovery-failback-azure-to-vmware/image3.png)\n\n3.  To discover the CX IP address go to the CS deployment on Azure and view its dashboard. \n\n    ![](./media/site-recovery-failback-azure-to-vmware/image4.png)\n\n4.  To discover the CX public port go to the endpoints tab in the VM page and identify the HTTPs endpoints public port.\n\n    ![](./media/site-recovery-failback-azure-to-vmware/image5.png)\n\n5.  Specify the CS Passphrase. You need to have noted down the passphrase during the CS registration. You would have used the passphrase during MT and PS deployments also. In case you do not remember the passphrase you can go in to the CS server on Azure and find the passphrase stored under C:\\\\Program Files (x86)\\\\InMage Systems\\\\private\\\\connection.passphrase\n\n    ![](./media/site-recovery-failback-azure-to-vmware/image6.png)\n\n6.  Specify the location to install the vContinuum server and begin installation.\n\n    ![](./media/site-recovery-failback-azure-to-vmware/image7.png)\n\n7.  Once you see that installation completes, you can launch the vContinuum to see it working.\n    ![](./media/site-recovery-failback-azure-to-vmware/image8.png)\n\n\n## Install PS server on Azure\n\nA Process Server needs to be installed on Azure so that the VMs in Azure can send the data back to on-premises MT. You need to deploy the PS on Azure in the same network as the Configuration Server.\n\n1.  On the **Configuration Servers** page in Azure, select to add a new process server.\n\n    ![](./media/site-recovery-failback-azure-to-vmware/image9.png)\n\n2.  Specify a process server name, and enter a name and password to connect to the virtual machine as an admin. Select the configuration server to which you're registering the process server. This should be the same server you're using to protect and fail over your virtual machines. Specify the Azure ntwork in which the process server should be deployment. It should be the same network as the configuration server. Specify a unique IP address from the select subnet and begin deployment.\n\n    ![](./media/site-recovery-failback-azure-to-vmware/image10.png)\n\n\nA job to deploy the process server will be triggered.\n\n![](./media/site-recovery-failback-azure-to-vmware/image11.png)\n\nOnce the process server is deployed on Azure you can log into the server\nusing the credentials you specified. Use the same steps you used during\nforward direction of protection to register the PS.\n\n![](./media/site-recovery-failback-azure-to-vmware/image12.png)\n\nThe servers registered during failback will not be visible under VM properties. They will be only visible under the Servers tab under the Configuration server to which they have been registered. It can take about 10-15 mins for the PS to be listed under the CS.\n\n## Install an MT server on-premises\n\nDepending on the source side virtual machines you need to install a Linux or a Windows Master Target server on-premises.\n\n### Deploy Windows MT\n\nA windows MT is already bundled with vContinuum setup. When you install\nthe vContinuum, an MT is also deployed on the same machine and\nregistered to the Configuration server.\n\n1.  To begin deployment, create an empty machine on-premises on the ESX\n    host onto which you want to recover the VMs from Auzre.\n\n2.  Ensure that there are at least two disks attached to the VM – one is\n    used for the OS and the second one is used for Retention Drive.\n\n3.  Install the operating system.\n\n4.  Install the vContinuum on the server. This would also complete\n    installation of the MT.\n\n### Deploy Linux MT\n\n1.  To begin deployment, create an empty machine on-premises on the ESX\n    host onto which you want to recover the VMs from Auzre.\n\n2.  Ensure that there are at least two disks attached to the VM – one is\n    used for the OS and the second one is used for Retention Drive.\n\n3.  Install the linux operating system. NLinux Master Target (MT) system should not use LVM for root or retention storage spaces. Linux MT configured to avoid LVM partitions/disks discovery by default.\n4.  Partitions that you can create are\n\n    ![](./media/site-recovery-failback-azure-to-vmware/image13.png)\n\n5.  Carry out the below post installation steps before beginning MT installation.\n\n\n#### Post OS Installation Steps\n\nTo get SCSI ID’s for each of SCSI hard disk in a Linux virtual machine,\nyou should enable the parameter “disk.EnableUUID = TRUE”. To enable this parameter, follow the steps as given below:\n\n1. Shut down your virtual machine.\n2. Right-click the VM’s entry in the left-hand panel > **Edit Settings**.\n3. Click the **Options** tab. Select the **Advanced\\>General item** on the left and click the **Configuration Parameters** that you see on the right. “Configuration Parameters” option will be in de-active state when the machine is running”. In order to make this tab active, shutdown machine.\n\n    ![](./media/site-recovery-failback-azure-to-vmware/image14.png)\n\n4. See whether already a row with **disk.EnableUUID** exists? If exists and if the value is set to False over write the value with True (True and False values are case in-sensitive). If exists and is set to true, click on cancel and test the SCSI command inside guest operating system after it is boot-up. If does not exist click **Add Row.**\n5. Add disk.EnableUUID in the Name column. Set its value as TRUE. Do not add the above values along with double-quotes.\n\n    ![](./media/site-recovery-failback-azure-to-vmware/image15.png)\n\n#### Download and Install the Additional Packages\n\nNOTE: Make sure system has Internet connectivity before download and\ninstalling additional packages.\n\n\\# yum install -y xfsprogs perl lsscsi rsync wget kexec-tools\n\nAbove command will download below mentioned 15 packages from CentOS 6.6\nrepository and install.\n\nbc-1.06.95-1.el6.x86\\_64.rpm\n\nbusybox-1.15.1-20.el6.x86\\_64.rpm\n\nelfutils-libs-0.158-3.2.el6.x86\\_64.rpm\n\nkexec-tools-2.0.0-280.el6.x86\\_64.rpm\n\nlsscsi-0.23-2.el6.x86\\_64.rpm\n\nlzo-2.03-3.1.el6\\_5.1.x86\\_64.rpm\n\nperl-5.10.1-136.el6\\_6.1.x86\\_64.rpm\n\nperl-Module-Pluggable-3.90-136.el6\\_6.1.x86\\_64.rpm\n\nperl-Pod-Escapes-1.04-136.el6\\_6.1.x86\\_64.rpm\n\nperl-Pod-Simple-3.13-136.el6\\_6.1.x86\\_64.rpm\n\nperl-libs-5.10.1-136.el6\\_6.1.x86\\_64.rpm\n\nperl-version-0.77-136.el6\\_6.1.x86\\_64.rpm\n\nrsync-3.0.6-12.el6.x86\\_64.rpm\n\nsnappy-1.1.0-1.el6.x86\\_64.rpm\n\nwget-1.12-5.el6\\_6.1.x86\\_64.rpm\n\nNOTE: If source machine uses Reiser or XFS filesystem for root or boot\ndevice, then following packages should be download and installed on\nLinux Master Target prior to the protection.\n\n\\# cd /usr/local\n\n\\# wget\n<http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/kmod-reiserfs-0.0-1.el6.elrepo.x86_64.rpm>\n\n\\# wget\n<http://elrepo.org/linux/elrepo/el6/x86_64/RPMS/reiserfs-utils-3.6.21-1.el6.elrepo.x86_64.rpm>\n\n\\# rpm -ivh kmod-reiserfs-0.0-1.el6.elrepo.x86\\_64.rpm\nreiserfs-utils-3.6.21-1.el6.elrepo.x86\\_64.rpm\n\n\\# wget\n<http://mirror.centos.org/centos/6.6/os/x86_64/Packages/xfsprogs-3.1.1-16.el6.x86_64.rpm>\n\n\\# rpm -ivh xfsprogs-3.1.1-16.el6.x86\\_64.rpm\n\n#### Apply Custom Configuration Changes\n\nBefore applying custom configuration changes make sure you have\ncompleted Post Installation Steps\n\nTo apply custom configuration changes, follow the below mentioned steps:\n\n1. Copy the RHEL 6-64 Unified Agent binary to the newly created OS.\n\n2. Run the below command to untar the binary.\n\n**tar -zxvf \\<File name\\>**\n\n3. Execute below command to give permission.\n\n\\# **chmod 755 ./ApplyCustomChanges.sh**\n\n4. Execute the below command to run the script.\n\n**\\# ./ApplyCustomChanges.sh**\n\nNOTE: Execute the script only once on the server. **REBOOT** the server\nafter successful execution of the above script.\n\n### Begin MT Installation\n\n[Download](http://go.microsoft.com/fwlink/?LinkID=529757) the Linux\nMaster Target Server installation file.\n\nCopy the downloaded Linux Master Target Server installer to the Linux\nMaster Target virtual machine using an sftp client utility of your\nchoice. Alternately you can log into the Linux Master Target virtual\nmachine and use wget to download the installation package from the\nprovided link.\n\nLog in to the Linux Master Target server virtual machine using an ssh\nclient of your choice.\n\nIf you are connected to the Azure network on which you deployed your\nLinux Master Target server through a VPN connection then use the\ninternal IP address for the Linux Master Target Server obtained from the\nvirtual machine dashboard and port 22 to connect to the Linux Master\nTarget Server using Secure Shell.\n\nIf you are connecting to the Linux Master Target Server over a public\ninternet connection use the Linux Master Target Server’s public virtual\nIP address (from the virtual machines dashboard page) and the public\nendpoint created for ssh to login to the Linux Master Target Server.\n\nExtract the files from the gzipped Linux Master Target Server installer\ntar archive by executing\n\n*“tar –xvzf Microsoft-ASR\\_UA\\_8.2.0.0\\_RHEL6-64\\*”* from the directory\nwhere you had copied the Linux Master Target Server installer to.\n\n![](./media/site-recovery-failback-azure-to-vmware/image16.png)\n\nIf you extracted the installer files to a different directory change\ndirectory to the directory to which the contents of the tar archive were\nextracted. From this directory path execute “sudo ./install.sh”\n\n![](./media/site-recovery-failback-azure-to-vmware/image17.png)\n\nWhen prompted to make choice of Primary Role of this Agent select 2\n(Master Target)\n\nLeave the other interactive install options at their default values.\n\nWait for the rest of the installation to proceed and the Host Config\nInterface to appear. The Host Configuration utility for the Linux Master\nTarget Server is a command line utility. Don’t resize your ssh client\nutility window. Use the arrow keys to select the Global option and press\nenter on your keyboard.\n\n![](./media/site-recovery-failback-azure-to-vmware/image18.png)\n\n![](./media/site-recovery-failback-azure-to-vmware/image19.png)\n\n1.  Against the field IP enter the Internal IP address of the\n    Configuration Server obtained from the virtual machines dashboard\n    page and press enter.\n\n2.  Against the field Port enter 22 and press enter.\n\n3.  Leave Use https: as Yes. Press enter one more time.\n\n4.  Enter the Passphrase that was generated on the Configuration Server.\n    If you are using PuTTY client from a Windows machine to ssh to the\n    Linux Master Target Server virtual machine you can use Shift+Insert\n    to paste the contents of the clipboard. Copy the Passphrase to the\n    local clipboard using Ctrl-C and use Shift+Insert to paste it. Press\n    enter\n\n5.  Use the right arrow key to navigate to quit and press enter.\n\nWait for the installation to complete\n\n![](./media/site-recovery-failback-azure-to-vmware/image20.png)\n\nIf for some reason you failed to register your Linux Master Target\nServer to the Configuration Server you could do so again by running the\nhost configuration utility from /usr/local/ASR/Vx/bin/hostconfigcli (you\nwill first need to set access permissions to this directory by executing\nchmod as a super user)\n\n\n#### Validate Master Target Server registration to the Configuration Server.\n\nYou can validate that the Master Target Server registered successfully\nwith the Configuration Server by visiting the Server Details page under\nthe Configuration Server page on the Azure Site Recovery vault\n\n\n## Begin protecting the virtual machines back to on-premises\n\nBefore failback of the VMs back to on-premises, first you need to\nprotect the virtual machines back to on-premises. Follow the below steps\nto protect VMs of an application.\n\n### Note on temp drive\n\nWhen a VM is failed over to Azure, it adds an extra temp drive for page\nfile. This is an extra drive that is typically not required by your\nfailed over VM since it might already have a drive dedicated for the\npage file.\n\nBefore you begin reverse protection of the virtual machines, you need to\nensure that the drive is taken offline so that it does not get\nprotected.\n\nTo do this,\n\n1.  Open Computer Management (via control panel administrative tool, or\n    by right click on This PC in the explorer window and selecting\n    manage.)\n\n2.  Select Storage Management so that it lists the disks online and\n    attached to the machine.\n\n3.  Select the temporary disk attached to the machine and choose to\n    bring it offline.\n\n4.  Once it has been successfully taken offline you can proceed with\n    protecting the virtual machine in the reverse direction.\n\n### Protection plan for VMs\n\nOn the Azure portal, look at the states of the virtual machine and\nensure that they are failed over.\n\n![](./media/site-recovery-failback-azure-to-vmware/image21.png)\n\nNote : during failover from Azure back to on-premises, the Azure VM is\nconsidered similar to a Physical VM. The failover to on-premises is to a\nvirtual machine.\n\n1.  Launch the vContinuum on your machine\n\n![](./media/site-recovery-failback-azure-to-vmware/image8.png)\n\n2.  In the **Choose Application** setting, select **P2V**\n\n3.  Click on the **New Protection** option to begin\n\n4.  In the new window that opens you will begin protecting the virtual\n    machines back to on-premises.\n\n    a.  Select the **OS type** according to the VMs you want to failback\n        and **Get Details**\n\n    b.  In the **Primary server details**, you need to identify the\n        virtual machines that you want to protect.\n\n    c.  The virtual machines are listed by their Computer Hostnames and\n        not as they are visible on vCenter or Azure\n\n    d.  The virtual machines are listed under the vCenter Hostname that\n        the virtual machines were on, before failover.\n\n    e.  Once you have identified the VMs you want to protect, select\n        them one by one.\n\n5.  When you select a virtual machine to protect (and it has already failed over to Azure) you will get a popup window that gives two entries for the virtual machine. This is because the CS has detected two instances of the virtual machines registered to it. You need to remove the entry for the on-premises VM so that you can protect the correct VM. Note that you will see the entries by its computer hostname. To identify the correct Azure VM entry here, you can log into the Azure VM and go to C:\\Program Files (x86)\\Microsoft Azure Site Recovery\\Application Data\\etc. In the file drscout.conf , identify the Host ID. In the vContinuum dialog, keep the entry for which the hostID is found in the VM. Delete all other entries.\n\n![](./media/site-recovery-failback-azure-to-vmware/image22.png)\n\n6.  To select the correct VM you can refer to its IP address. The IP address range on-premises will be the on-premises VM.\n7.  Click **Remove** to delete the entry.\n\n![](./media/site-recovery-failback-azure-to-vmware/image23.png)\n\n8.  Go to the vCenter and stop the virtual machine on the vCenter\n9.  Next you can also delete the virtual machines on-premises\n10.  Next you need to specify the on-premises MT server to which you want to protect the VMs.\n11.  To do this, connect to the vCenter to which you want to failback to\n\n![](./media/site-recovery-failback-azure-to-vmware/image24.png)\n\n12.  Select the MT server based on the host into which you want to\n    recover the virtual machines\n\n![](./media/site-recovery-failback-azure-to-vmware/image24.png)\n\n13.  Next provide the replication option for each of the virtual machines\n\n![](./media/site-recovery-failback-azure-to-vmware/image25.png)\n\n14.  To do this you need to select the recovery side **Datastore** – this is the\n    datastore to which the VMs will be recovered to\n\nThe different options you need to provide per VM are\n\n**Option** | **Option recommended value**\n---|---\nProcess Server IP | Select the PS which you have deployed on Azure\nRetention size in MB| \nRetention value | 1\nDays/Hours | Days\nConsistency Interval | 1\nSelect Target Datastore | The datastore available on the recovery side. This data store should have enough space and also be available to the ESX host on which you want to realise the virtual machine.\n15.  Next you can configure the properties that the virtual machine will\n    acquire after failover to on-premises site. The different properties\n    you can configure are as below\n\n![](./media/site-recovery-failback-azure-to-vmware/image26.png)\n\n\n**Property** | **How to configure**\n---|---\nNetwork Configuration|For each NIC detected, configure the failback IP address for the virtual machine. Select the NIC and click **Change** to specify the IP address details.\nHardware Configuration|You can specify the CPU and the Memory values for the VM. This setting can be applied to all the VMs you are trying to protect.\nDisplay Name|To identify the correct values for the CPU and Memory, you can refer to the IAAS VMs role size and see the number of cores and Memory assigned.\nDisplay Name|After failover back to on-premises, you can choose to rename the virtual machines as it will be seen in the inventory of vCenter. Note that the default value seen here is the virtual machine computer host name. To identify the VM name, you can refer to the VM list in the Protection group.\nNAT Configuration|Discussed in detail below\n\n![](./media/site-recovery-failback-azure-to-vmware/image27.png)\n\n\n\n> **PS NAT settings choices**\n>\n> To enable protection of the virtual machines, two communication\n> channels need to be established.\n>\n> The first channel is between the virtual machine and the Process\n> Server. This channel collects the data from the VM and sends it to the\n> PS. PS will then send this data to the Master Target. If the process\n> server and the virtual machine to be protected are on the same Azure\n> vNet, then you do not need to use the NAT settings. If the PS and the\n> virtual machine to be protected is in two different vNet, then you\n> need to specify the NAT settings for the PS and check the first\n> option.\n>\n> ![](./media/site-recovery-failback-azure-to-vmware/image28.png)\n>\n> To identify the Process server Public IP, you can go to the PS\n> deployment in Azure and see its Public IP address.\n>\n> The second channel is between the Process server and the Master\n> target. The option to use NAT or not depends on whether you are using\n> VPN based connection between MT and PS or protecting over the\n> internet. If the PS communicates to the MT over a VPN, then you should\n> not select this option. If the Master Target needs to communicate to\n> the Process server over the internet, then specify the NAT settings\n> for the PS.\n>\n> ![](./media/site-recovery-failback-azure-to-vmware/image29.png)\n>\n> To identify the Process server Public IP, you can go to the PS\n> deployment in Azure and see its Public IP address.\n>\n> ![](./media/site-recovery-failback-azure-to-vmware/image30.png)\n\n1.  If you have not deleted the on-premises virtual machines as specified\n    in Step 5.d, and if the datastore you are failing back to, as\n    selected in step 7.a still contains the old VMDK’s then you will\n    also need to ensure that the failback VM gets created in a new\n    place. For this you can select the Advanced settings and specify an\n    alternate Folder to restore to in the **Folder Name Settings**\n    section of the Advanced Settings.\n\n![](./media/site-recovery-failback-azure-to-vmware/image31.png)\n\nThe other options in the Advanced settings can be left as default.\nMake sure you apply the folder name settings to all the servers.\n\n2.  Next move to the final stage of the Protection. Here you need to run\n    a Readiness Check to ensure that the virtual machines are ready to\n    be protected back to on-premises.\n\n![](./media/site-recovery-failback-azure-to-vmware/image32.png)\n\n    a.  Click on the readiness check and wait for it to complete.\n\n    b.  The Readiness Report tab will give the information if all the\n    virtual machines are ready.\n\n    c.  If the Readiness Report is successful on all the virtual machines it\n    will allow you to specify a name to the Protection plan\n\n![](./media/site-recovery-failback-azure-to-vmware/image33.png)\n\n    d.  Give the plan a new Name and begin Protect by clicking the button\n    below.\n\n\n3.  The Protection will now begin.\n\n    a.  You can see the progress of the protection on the vContinuum\n\n![](./media/site-recovery-failback-azure-to-vmware/image34.png)\n\n    b.  Once the step **Activating Protection Plan** is completed, you can\n    monitor the protection of the virtual machines via the ASR Portal.\n\n    c.  You can also monitor the protection via Azure Site Recovery.\n\n![](./media/site-recovery-failback-azure-to-vmware/image35.png)\n\nYou can also see the exact status of the pairs by clicking into the\nvirtual machine and monitoring its progress under the volume replication\nsection.\n\n![](./media/site-recovery-failback-azure-to-vmware/image36.png)\n\n## Prepare the Failback plan\n\nYou can prepare a failback plan using vContinuum so that the application\ncan be failed over back to on-premises at any time. These recovery plans\nare very similar to the ASR Recovery plans.\n\n1.  Launch the vContinuum and select the option to **Manage plans**.\n\n2.  User the sub-options select **Recover.**\n\n![](./media/site-recovery-failback-azure-to-vmware/image37.png)\n\n3.  You can see the list of all the Plans that have been used to protect the virtual machines. These are the same plans you can use to recover.\n\n4.  Select the Protection Plan and select all the VMs you want to recover within it.\n\n    a.  On selecting each VM you can see more details about the source\n        VM, target ESX server where the VM will be recovered to and the\n        source VM disk\n\n5.  Click Next to begin the **Recover** Wizard\n\n6.  Select the Virtual Machines you want to recover\n\n    a.  See the list of all the virtual machines that you can recover\n\n![](./media/site-recovery-failback-azure-to-vmware/image38.png)\n\n    b.  You can **recover based on** multiple options however we recommend\n    the **Latest Tag.** This will ensure that the latest data from the\n    virtual machine will be used.\n\n    c.  Select **Apply for All VMs** to ensure that the latest tag will be\n    chosen for all the virtual machines.\n\n\n7.  Run the **Readiness Check.** This will inform if the right\n    parameters are configured to enable the latest tag recovery of the\n    virtual machine. Click Next if all the checks are successful else\n    look at the log and resolve the errors.\n\n![](./media/site-recovery-failback-azure-to-vmware/image39.png)\n\n8.  In the VM Configuration step of the wizard, ensure that the recovery\n    settings are correctly set. In case the VM settings are different\n    from the one you require, you can choose to change them. Since we\n    have already completed this action during the protection, you may\n    choose to ignore it this time.\n\n![](./media/site-recovery-failback-azure-to-vmware/image40.png)\n\n9.  Finally review the list of virtual machines that will be recovered.\n\n    a.  Specify a recovery order to the virtual machines.\n\nNote: The virtual machines are listed using the Computer Hostname. It\nmight be difficult to map the computer hostname to the virtual machine.\nTo map the names, you can go to the virtual machines dashboard in Azure\nIAAS and look at the hostname of the virtual machine.\n\n![](./media/site-recovery-failback-azure-to-vmware/image41.png)\n\n10.  Give the **recovery plan name** and select **Recover later** in\n    **Recovery options.**\n\n    a.  In case you want to recover right away you can choose to\n        **Recover now** in the **Recovery options**.\n\n    b.  It is recommended to Recover later since the protection initial\n        replication may not have completed\n\n    c.  Finally click on **Recover** button to either save the plan or\n        to trigger the recovery based on your **Recovery options**.\n\n11.  You can see the Recovery Status and see if it the plan is\n    successfully saved.\n\n![](./media/site-recovery-failback-azure-to-vmware/image42.png)\n\n12.  If you have chosen to recover later, you will be informed that the\n    plan is created and you can recover later.\n\n![](./media/site-recovery-failback-azure-to-vmware/image43.png)\n\n## Recover Virtual Machines\n\nAfter the plan is created, you can choose to recover the virtual\nmachines. As a pre-requisite, you need to ensure that the virtual\nmachines have completed synchronization.\n\n![](./media/site-recovery-failback-azure-to-vmware/image44.png)\n\nIf Replication Status shows OK then the protection is completed and the\nRPO threshold has been met. To confirm the replication pair’s health,\nyou can go to the virtual machine properties and see the health of the\nreplication.\n\n**Turn off the Azure virtual machines before you initiate the recovery.\nThis will ensure that there is no split brain and your end customers\nwill be served by one copy of the application. Only when you have\nsuccessfully ensured that the Azure VMs are turned off continue to the\nsteps below.**\n\nTo begin recovering the virtual machines back to on-premise, you need to\nstart the plan that is saved.\n\n1.  On the vContinuum select to **Monitor** the plans.\n\n2.  The wizard will list the plans that have been executed till now.\n\n![](./media/site-recovery-failback-azure-to-vmware/image45.png)\n\n3.  Select the **Recovery** node and select the plan that you want to\n    recover.\n\n    a.  It will inform you that the plan has not yet started.\n\n4.  Click **Start** to begin the recovery.\n\n5.  You can monitor the recovery of the virtual machines\n\n\n![](./media/site-recovery-failback-azure-to-vmware/image46.png)\n\n6. Once the VMs have been powered ON, you can connect to the virtual\n    machines on your vCenter.\n\n## Re-protect to Azure after failback\n\nAfter failback has been completed you may want to protect the virtual\nmachines once again. The below steps will help you re-configure the\nprotection\n\n1.  Check that the virtual machines on-premises are working and\n    application is able to reach your end customers.\n\n2.  On the Azure Site Recovery portal, select the virtual machines and\n    delete them.\n\n    a.  Select to disable the protection of the virtual machines. This\n        will ensure that the VMs are no more protected.\n\n3.  Go to the Azure IAAS virtual machines and delete the failed over\n    VMs.\n\n4.  Delete the old VMs on vSpehere – these are the VMs that you\n    previously failed over to Azure.\n\n5.  On the ASR portal select to protect the virtual machines recently\n    failed over.\n\n6.  Once the VMs are protected, you can add them to a recovery plan and\n    be continuously protected.\n\n\n \n"
}