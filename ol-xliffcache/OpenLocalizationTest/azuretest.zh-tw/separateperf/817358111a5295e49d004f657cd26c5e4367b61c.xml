{
  "nodes": [
    {
      "content": "How to use Table storage from Node.js | Microsoft Azure",
      "pos": [
        28,
        83
      ]
    },
    {
      "content": "Learn how to use the table storage service in Azure.",
      "pos": [
        103,
        155
      ]
    },
    {
      "content": "Code samples are written using the Node.js API.",
      "pos": [
        156,
        203
      ]
    },
    {
      "content": "How to use Table storage from Node.js",
      "pos": [
        520,
        557
      ]
    },
    {
      "content": "Overview",
      "pos": [
        663,
        671
      ]
    },
    {
      "content": "This topic shows how to perform common scenarios using the",
      "pos": [
        673,
        731
      ]
    },
    {
      "content": "Azure Table service in a Node.js application.",
      "pos": [
        733,
        778
      ]
    },
    {
      "content": "The code examples in this topic assume you already have a Node.js application.",
      "pos": [
        781,
        859
      ]
    },
    {
      "content": "For instructions on creating a Node.js application in Azure, see any of these topics:",
      "pos": [
        860,
        945
      ]
    },
    {
      "content": "Build and deploy a Node.js website to Azure",
      "pos": [
        950,
        993
      ]
    },
    {
      "pos": [
        1059,
        1146
      ],
      "content": "<bpt id=\"p1\">[</bpt>Build and deploy a Node.js website to Azure using WebMatrix<ept id=\"p1\">][Web Site with WebMatrix]</ept>."
    },
    {
      "pos": [
        1149,
        1265
      ],
      "content": "<bpt id=\"p1\">[</bpt>Build and deploy a Node.js application to an Azure Cloud Service<ept id=\"p1\">][Node.js Cloud Service]</ept> (using Windows PowerShell)"
    },
    {
      "content": "Configure your application to access Azure Storage",
      "pos": [
        1472,
        1522
      ]
    },
    {
      "content": "To use Azure storage, you need the Azure Storage SDK for Node.js, which includes a set of convenience libraries that",
      "pos": [
        1524,
        1640
      ]
    },
    {
      "content": "communicate with the storage REST services.",
      "pos": [
        1641,
        1684
      ]
    },
    {
      "content": "Use Node Package Manager (NPM) to install the package",
      "pos": [
        1690,
        1743
      ]
    },
    {
      "pos": [
        1749,
        1912
      ],
      "content": "Use a command-line interface such as <bpt id=\"p1\">**</bpt>PowerShell<ept id=\"p1\">**</ept> (Windows) <bpt id=\"p2\">**</bpt>Terminal<ept id=\"p2\">**</ept> (Mac) or <bpt id=\"p3\">**</bpt>Bash<ept id=\"p3\">**</ept> (Unix), and navigate to the folder where you created your application."
    },
    {
      "content": "Type <bpt id=\"p1\">**</bpt>npm install azure-storage<ept id=\"p1\">**</ept> in the command window.",
      "pos": [
        1918,
        1975
      ]
    },
    {
      "content": "Output from the command is similar to the following example.",
      "pos": [
        1976,
        2036
      ]
    },
    {
      "pos": [
        2749,
        2976
      ],
      "content": "You can manually run the **ls** command to verify that a\n**node\\_modules** folder was created. Inside that folder you will\nfind the **azure-storage** package, which contains the libraries you need to\naccess storage.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "You can manually run the <bpt id=\"p1\">**</bpt>ls<ept id=\"p1\">**</ept> command to verify that a",
          "pos": [
            0,
            56
          ]
        },
        {
          "content": "**node\\_modules** folder was created. Inside that folder you will",
          "pos": [
            57,
            122
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>node\\_modules<ept id=\"p1\">**</ept> folder was created.",
              "pos": [
                0,
                37
              ]
            },
            {
              "content": "Inside that folder you will",
              "pos": [
                38,
                65
              ]
            }
          ]
        },
        {
          "content": "find the <bpt id=\"p1\">**</bpt>azure-storage<ept id=\"p1\">**</ept> package, which contains the libraries you need to",
          "pos": [
            123,
            199
          ]
        },
        {
          "content": "access storage.",
          "pos": [
            200,
            215
          ]
        }
      ]
    },
    {
      "content": "Import the package",
      "pos": [
        2982,
        3000
      ]
    },
    {
      "pos": [
        3002,
        3082
      ],
      "content": "Add the following code to the top of the <bpt id=\"p1\">**</bpt>server.js<ept id=\"p1\">**</ept> file in your application:"
    },
    {
      "content": "Setup an Azure Storage Connection",
      "pos": [
        3130,
        3163
      ]
    },
    {
      "content": "The azure module will read the environment variables AZURE\\_STORAGE\\_ACCOUNT and AZURE\\_STORAGE\\_ACCESS\\_KEY, or AZURE\\_STORAGE\\_CONNECTION\\_STRING for information required to connect to your Azure storage account.",
      "pos": [
        3165,
        3379
      ]
    },
    {
      "content": "If these environment variables are not set, you must specify the account information when calling <bpt id=\"p1\">**</bpt>TableService<ept id=\"p1\">**</ept>.",
      "pos": [
        3380,
        3495
      ]
    },
    {
      "pos": [
        3497,
        3638
      ],
      "content": "For an example of setting the environment variables in the management portal for an Azure Website, see <bpt id=\"p1\">[</bpt><ept id=\"p1\">Node.js Web Application with Storage]</ept>"
    },
    {
      "content": "Create a table",
      "pos": [
        3643,
        3657
      ]
    },
    {
      "content": "The following code creates a <bpt id=\"p1\">**</bpt>TableService<ept id=\"p1\">**</ept> object and uses it to",
      "pos": [
        3659,
        3726
      ]
    },
    {
      "content": "create a new table.",
      "pos": [
        3727,
        3746
      ]
    },
    {
      "content": "Add the following near the top of <bpt id=\"p1\">**</bpt>server.js<ept id=\"p1\">**</ept>.",
      "pos": [
        3747,
        3795
      ]
    },
    {
      "content": "The call to <bpt id=\"p1\">**</bpt>createTableIfNotExists<ept id=\"p1\">**</ept> will create a new table with the specified name if it does",
      "pos": [
        3845,
        3942
      ]
    },
    {
      "content": "not already exist.",
      "pos": [
        3943,
        3961
      ]
    },
    {
      "content": "The following example creates a new table named 'mytable' if it does not already exist:",
      "pos": [
        3962,
        4049
      ]
    },
    {
      "content": "The <ph id=\"ph1\">`result`</ph> will be <ph id=\"ph2\">`true`</ph> if a new table is created, and <ph id=\"ph3\">`false`</ph> if the table already exists.",
      "pos": [
        4211,
        4306
      ]
    },
    {
      "content": "<ph id=\"ph1\">`response`</ph> will contain information about the request.",
      "pos": [
        4307,
        4361
      ]
    },
    {
      "content": "Filters",
      "pos": [
        4367,
        4374
      ]
    },
    {
      "content": "Optional filtering operations can be applied to operations performed using <bpt id=\"p1\">**</bpt>TableService<ept id=\"p1\">**</ept>.",
      "pos": [
        4376,
        4468
      ]
    },
    {
      "content": "Filtering operations can include logging, automatically retrying, etc. Filters are objects that implement a method with the signature:",
      "pos": [
        4469,
        4603
      ]
    },
    {
      "content": "After doing its preprocessing on the request options, the method needs to call \"next\" passing a callback with the following signature:",
      "pos": [
        4653,
        4787
      ]
    },
    {
      "content": "In this callback, and after processing the returnObject (the response from the request to the server), the callback needs to either invoke next if it exists to continue processing other filters or simply invoke finalCallback otherwise to end up the service invocation.",
      "pos": [
        4843,
        5111
      ]
    },
    {
      "content": "Two filters that implement retry logic are included with the Azure SDK for Node.js, <bpt id=\"p1\">**</bpt>ExponentialRetryPolicyFilter<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>LinearRetryPolicyFilter<ept id=\"p2\">**</ept>.",
      "pos": [
        5113,
        5262
      ]
    },
    {
      "content": "The following creates a <bpt id=\"p1\">**</bpt>TableService<ept id=\"p1\">**</ept> object that uses the <bpt id=\"p2\">**</bpt>ExponentialRetryPolicyFilter<ept id=\"p2\">**</ept>:",
      "pos": [
        5263,
        5358
      ]
    },
    {
      "content": "Add an entity to a table",
      "pos": [
        5507,
        5531
      ]
    },
    {
      "content": "To add an entity, first create an object that defines your entity",
      "pos": [
        5533,
        5598
      ]
    },
    {
      "content": "properties.",
      "pos": [
        5599,
        5610
      ]
    },
    {
      "content": "All entities must contain a <bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>RowKey<ept id=\"p2\">**</ept>, which are unique identifiers for the entity.",
      "pos": [
        5611,
        5716
      ]
    },
    {
      "pos": [
        5720,
        5793
      ],
      "content": "<bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept> - Determines the partition that the entity is stored in."
    },
    {
      "pos": [
        5797,
        5862
      ],
      "content": "<bpt id=\"p1\">**</bpt>RowKey<ept id=\"p1\">**</ept> - Uniquely identifies the entity within the partition."
    },
    {
      "content": "Both <bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>RowKey<ept id=\"p2\">**</ept> must be string values.",
      "pos": [
        5864,
        5923
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Understanding the Table Service data model<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dd179338.aspx)</ept>.",
      "pos": [
        5924,
        6050
      ]
    },
    {
      "content": "The following is an example of defining an entity.",
      "pos": [
        6052,
        6102
      ]
    },
    {
      "content": "Note that <bpt id=\"p1\">**</bpt>dueDate<ept id=\"p1\">**</ept> is defined as a type of <bpt id=\"p2\">**</bpt>Edm.DateTime<ept id=\"p2\">**</ept>.",
      "pos": [
        6103,
        6166
      ]
    },
    {
      "content": "Specifying the type is optional, and types will be inferred if not specified.",
      "pos": [
        6167,
        6244
      ]
    },
    {
      "pos": [
        6449,
        6575
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> There is also a <bpt id=\"p1\">**</bpt>Timestamp<ept id=\"p1\">**</ept> field for each record, which is set by Azure when an entity is inserted or updated."
    },
    {
      "content": "You can also use the <bpt id=\"p1\">**</bpt>entityGenerator<ept id=\"p1\">**</ept> to create entities.",
      "pos": [
        6577,
        6637
      ]
    },
    {
      "content": "The following example creates the same task entity using the <bpt id=\"p1\">**</bpt>entityGenerator<ept id=\"p1\">**</ept>.",
      "pos": [
        6638,
        6719
      ]
    },
    {
      "content": "To add an entity to your table, pass the entity object to",
      "pos": [
        7004,
        7061
      ]
    },
    {
      "content": "the <bpt id=\"p1\">**</bpt>insertEntity<ept id=\"p1\">**</ept> method.",
      "pos": [
        7062,
        7090
      ]
    },
    {
      "pos": [
        7241,
        7429
      ],
      "content": "If the operation is successful, <ph id=\"ph1\">`result`</ph> will contain the <bpt id=\"p1\">[</bpt>ETag<ept id=\"p1\">](http://en.wikipedia.org/wiki/HTTP_ETag)</ept> of the inserted record and <ph id=\"ph2\">`response`</ph> will contain information about the operation."
    },
    {
      "content": "Example response:",
      "pos": [
        7431,
        7448
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> By default, <bpt id=\"p1\">**</bpt>insertEntity<ept id=\"p1\">**</ept> does not return the inserted entity as part of the <ph id=\"ph2\">`response`</ph> information.",
      "pos": [
        7529,
        7645
      ]
    },
    {
      "content": "If you plan on performing other operations on this entity, or wish to cache the information, it can be useful to have it returned as part of the <ph id=\"ph1\">`result`</ph>.",
      "pos": [
        7646,
        7800
      ]
    },
    {
      "content": "You can do this by enabling <bpt id=\"p1\">**</bpt>echoContent<ept id=\"p1\">**</ept> as follows:",
      "pos": [
        7801,
        7856
      ]
    },
    {
      "content": "Update an entity",
      "pos": [
        7968,
        7984
      ]
    },
    {
      "content": "There are multiple methods available to update an existing entity:",
      "pos": [
        7986,
        8052
      ]
    },
    {
      "pos": [
        8056,
        8118
      ],
      "content": "<bpt id=\"p1\">**</bpt>updateEntity<ept id=\"p1\">**</ept> - Updates an existing entity by replacing it."
    },
    {
      "pos": [
        8122,
        8223
      ],
      "content": "<bpt id=\"p1\">**</bpt>mergeEntity<ept id=\"p1\">**</ept> - Updates an existing entity by merging new property values into the existing entity."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>insertOrReplaceEntity<ept id=\"p1\">**</ept> - Updates an existing entity by replacing it.",
      "pos": [
        8227,
        8298
      ]
    },
    {
      "content": "If no entity exists, a new one will be inserted.",
      "pos": [
        8299,
        8347
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>insertOrMergeEntity<ept id=\"p1\">**</ept> - Updates an existing entity by merging new property values into the existing.",
      "pos": [
        8351,
        8453
      ]
    },
    {
      "content": "If no entity exists, a new one will be inserted.",
      "pos": [
        8454,
        8502
      ]
    },
    {
      "pos": [
        8504,
        8581
      ],
      "content": "The following example demonstrates updating an entity using <bpt id=\"p1\">**</bpt>updateEntity<ept id=\"p1\">**</ept>:"
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> By default, updating an entity does not check to see if the data being updated has previously been modified by another process.",
      "pos": [
        8732,
        8872
      ]
    },
    {
      "content": "To support concurrent updates:",
      "pos": [
        8873,
        8903
      ]
    },
    {
      "content": "Get the ETag of the object being updated.",
      "pos": [
        8912,
        8953
      ]
    },
    {
      "content": "This is returned as part of the <ph id=\"ph1\">`response`</ph> for any entity related operation and can be retrieved through <ph id=\"ph2\">`response['.metadata'].etag`</ph>.",
      "pos": [
        8954,
        9088
      ]
    },
    {
      "content": "When performing an update operation on an entity, add the ETag information previously retrieved to the new entity.",
      "pos": [
        9097,
        9211
      ]
    },
    {
      "content": "For example:",
      "pos": [
        9212,
        9224
      ]
    },
    {
      "content": "Perform the update operation.",
      "pos": [
        9288,
        9317
      ]
    },
    {
      "content": "If the entity has been modified since you retrieved the ETag value, such as another instance of your application, an <ph id=\"ph1\">`error`</ph> will be returned stating that the update condition specified in the request was not satisfied.",
      "pos": [
        9318,
        9537
      ]
    },
    {
      "content": "With <bpt id=\"p1\">**</bpt>updateEntity<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>mergeEntity<ept id=\"p2\">**</ept>, if the entity that is being updated doesn't exist then the update operation will fail.",
      "pos": [
        9543,
        9672
      ]
    },
    {
      "content": "Therefore if you wish to store an entity regardless of whether it already exists, use <bpt id=\"p1\">**</bpt>insertOrReplaceEntity<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>insertOrMergeEntity<ept id=\"p2\">**</ept>.",
      "pos": [
        9673,
        9812
      ]
    },
    {
      "pos": [
        9814,
        9908
      ],
      "content": "The <ph id=\"ph1\">`result`</ph> for successful update operations will contain the <bpt id=\"p1\">**</bpt>Etag<ept id=\"p1\">**</ept> of the updated entity."
    },
    {
      "content": "Work with groups of entities",
      "pos": [
        9913,
        9941
      ]
    },
    {
      "content": "Sometimes it makes sense to submit multiple operations together in a",
      "pos": [
        9943,
        10011
      ]
    },
    {
      "content": "batch to ensure atomic processing by the server.",
      "pos": [
        10012,
        10060
      ]
    },
    {
      "content": "To accomplish that, use the <bpt id=\"p1\">**</bpt>TableBatch<ept id=\"p1\">**</ept> class to create a batch, and then use the <bpt id=\"p2\">**</bpt>executeBatch<ept id=\"p2\">**</ept> method of <bpt id=\"p3\">**</bpt>TableService<ept id=\"p3\">**</ept> to perform the batched operations.",
      "pos": [
        10061,
        10224
      ]
    },
    {
      "content": "The following example demonstrates submitting two entities in a batch:",
      "pos": [
        10227,
        10297
      ]
    },
    {
      "pos": [
        10953,
        11052
      ],
      "content": "For successful batch operations, <ph id=\"ph1\">`result`</ph> will contain information for each operation in the batch."
    },
    {
      "content": "Work with batched operations",
      "pos": [
        11058,
        11086
      ]
    },
    {
      "content": "Operations added to a batch can be inspected by viewing the <ph id=\"ph1\">`operations`</ph> property.",
      "pos": [
        11088,
        11170
      ]
    },
    {
      "content": "You can also use the following methods to work with operations.",
      "pos": [
        11171,
        11234
      ]
    },
    {
      "pos": [
        11238,
        11285
      ],
      "content": "<bpt id=\"p1\">**</bpt>clear<ept id=\"p1\">**</ept> - clears all operations from a batch."
    },
    {
      "pos": [
        11289,
        11342
      ],
      "content": "<bpt id=\"p1\">**</bpt>getOperations<ept id=\"p1\">**</ept> - gets an operation from the batch."
    },
    {
      "pos": [
        11346,
        11412
      ],
      "content": "<bpt id=\"p1\">**</bpt>hasOperations<ept id=\"p1\">**</ept> - returns true if the batch contains operations."
    },
    {
      "pos": [
        11416,
        11460
      ],
      "content": "<bpt id=\"p1\">**</bpt>removeOperations<ept id=\"p1\">**</ept> - removes an operation."
    },
    {
      "pos": [
        11464,
        11521
      ],
      "content": "<bpt id=\"p1\">**</bpt>size<ept id=\"p1\">**</ept> - returns the number of operations in the batch."
    },
    {
      "content": "Retrieve an entity by key",
      "pos": [
        11526,
        11551
      ]
    },
    {
      "pos": [
        11553,
        11661
      ],
      "content": "To return a specific entity based on the <bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>RowKey<ept id=\"p2\">**</ept>, use the <bpt id=\"p3\">**</bpt>retrieveEntity<ept id=\"p3\">**</ept> method."
    },
    {
      "pos": [
        11828,
        11892
      ],
      "content": "Once this operation completes, <ph id=\"ph1\">`result`</ph> will contain the entity."
    },
    {
      "content": "Query a set of Entities",
      "pos": [
        11897,
        11920
      ]
    },
    {
      "content": "To query a table, use the <bpt id=\"p1\">**</bpt>TableQuery<ept id=\"p1\">**</ept> object to build up a query",
      "pos": [
        11922,
        11989
      ]
    },
    {
      "content": "expression using the following clauses:",
      "pos": [
        11990,
        12029
      ]
    },
    {
      "pos": [
        12033,
        12087
      ],
      "content": "<bpt id=\"p1\">**</bpt>select<ept id=\"p1\">**</ept> - The fields to be returned from the query."
    },
    {
      "pos": [
        12091,
        12120
      ],
      "content": "<bpt id=\"p1\">**</bpt>where<ept id=\"p1\">**</ept> - The where clause."
    },
    {
      "pos": [
        12128,
        12163
      ],
      "content": "<bpt id=\"p1\">**</bpt>and<ept id=\"p1\">**</ept> - An <ph id=\"ph1\">`and`</ph> where condition."
    },
    {
      "pos": [
        12171,
        12204
      ],
      "content": "<bpt id=\"p1\">**</bpt>or<ept id=\"p1\">**</ept> - An <ph id=\"ph1\">`or`</ph> where condition."
    },
    {
      "pos": [
        12208,
        12247
      ],
      "content": "<bpt id=\"p1\">**</bpt>top<ept id=\"p1\">**</ept> - The number of items to fetch."
    },
    {
      "content": "The following example builds a query that will return the top 5 items with a PartitionKey of 'hometasks'.",
      "pos": [
        12250,
        12355
      ]
    },
    {
      "content": "Since <bpt id=\"p1\">**</bpt>select<ept id=\"p1\">**</ept> is not used, all fields will be returned.",
      "pos": [
        12459,
        12517
      ]
    },
    {
      "content": "To perform the query against a table, use <bpt id=\"p1\">**</bpt>queryEntities<ept id=\"p1\">**</ept>.",
      "pos": [
        12518,
        12578
      ]
    },
    {
      "content": "The following example uses this query to return entities from 'mytable'.",
      "pos": [
        12579,
        12651
      ]
    },
    {
      "content": "If successful, <ph id=\"ph1\">`result.entries`</ph> will contain an array of entities that match the query.",
      "pos": [
        12807,
        12894
      ]
    },
    {
      "content": "If the query was unable to return all entities, <ph id=\"ph1\">`result.continuationToken`</ph> will be non-<bpt id=\"p1\">*</bpt>null<ept id=\"p1\">*</ept> and can be used as the third parameter of <bpt id=\"p2\">**</bpt>queryEntities<ept id=\"p2\">**</ept> to retrieve more results.",
      "pos": [
        12895,
        13074
      ]
    },
    {
      "content": "For the initial query, use <bpt id=\"p1\">*</bpt>null<ept id=\"p1\">*</ept> for the third parameter.",
      "pos": [
        13075,
        13133
      ]
    },
    {
      "content": "Query a Subset of Entity Properties",
      "pos": [
        13139,
        13174
      ]
    },
    {
      "content": "A query to a table can retrieve just a few fields from an entity.",
      "pos": [
        13176,
        13241
      ]
    },
    {
      "content": "This reduces bandwidth and can improve query performance, especially for large entities.",
      "pos": [
        13242,
        13330
      ]
    },
    {
      "content": "Use the <bpt id=\"p1\">**</bpt>select<ept id=\"p1\">**</ept> clause and pass the names of the fields to be returned.",
      "pos": [
        13331,
        13405
      ]
    },
    {
      "content": "For example, the following query will only return the <bpt id=\"p1\">**</bpt>description<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>dueDate<ept id=\"p2\">**</ept> fields.",
      "pos": [
        13406,
        13499
      ]
    },
    {
      "content": "Delete an Entity",
      "pos": [
        13648,
        13664
      ]
    },
    {
      "content": "You can delete an entity using its partition and row keys.",
      "pos": [
        13666,
        13724
      ]
    },
    {
      "content": "In this",
      "pos": [
        13725,
        13732
      ]
    },
    {
      "content": "example, the <bpt id=\"p1\">**</bpt>task1<ept id=\"p1\">**</ept> object contains the <bpt id=\"p2\">**</bpt>RowKey<ept id=\"p2\">**</ept> and",
      "pos": [
        13733,
        13790
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept> values of the entity to be deleted.",
      "pos": [
        13791,
        13843
      ]
    },
    {
      "content": "Then the object is",
      "pos": [
        13844,
        13862
      ]
    },
    {
      "content": "passed to the <bpt id=\"p1\">**</bpt>deleteEntity<ept id=\"p1\">**</ept> method.",
      "pos": [
        13863,
        13901
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Consider using ETags when deleting items, to ensure that the item hasn't been modified by another process.",
      "pos": [
        14127,
        14246
      ]
    },
    {
      "content": "See <bpt id=\"p1\">[</bpt>Update an Entity<ept id=\"p1\">](#update-an-entity)</ept> for information in using ETags.",
      "pos": [
        14247,
        14320
      ]
    },
    {
      "content": "Delete a Table",
      "pos": [
        14325,
        14339
      ]
    },
    {
      "content": "The following code deletes a table from a storage account.",
      "pos": [
        14341,
        14399
      ]
    },
    {
      "pos": [
        14532,
        14607
      ],
      "content": "If you are uncertain whether the table exists, use <bpt id=\"p1\">**</bpt>deleteTableIfExists<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Use continuation tokens",
      "pos": [
        14612,
        14635
      ]
    },
    {
      "content": "When you are querying tables for large amounts of results, look for",
      "pos": [
        14637,
        14704
      ]
    },
    {
      "content": "continuation tokens.",
      "pos": [
        14706,
        14726
      ]
    },
    {
      "content": "There may be large amounts of data available for your",
      "pos": [
        14727,
        14780
      ]
    },
    {
      "content": "query that you might not realize if you do not build to recognize when a",
      "pos": [
        14782,
        14854
      ]
    },
    {
      "content": "continuation token is present.",
      "pos": [
        14856,
        14886
      ]
    },
    {
      "content": "The results object returned when querying entities sets a <ph id=\"ph1\">`continuationToken`</ph>",
      "pos": [
        14888,
        14965
      ]
    },
    {
      "content": "property when such a token is present.",
      "pos": [
        14967,
        15005
      ]
    },
    {
      "content": "You can then use this when performing",
      "pos": [
        15006,
        15043
      ]
    },
    {
      "content": "a query to continue to move across the partition and table entities.",
      "pos": [
        15045,
        15113
      ]
    },
    {
      "content": "When querying, a continuationToken parameter may be provided between the",
      "pos": [
        15115,
        15187
      ]
    },
    {
      "content": "query object instance and the callback function:",
      "pos": [
        15189,
        15237
      ]
    },
    {
      "content": "If you inspect the <ph id=\"ph1\">`continuationToken`</ph> object, you will find properties such as",
      "pos": [
        15599,
        15678
      ]
    },
    {
      "content": "<ph id=\"ph1\">`nextPartitionKey`</ph>, <ph id=\"ph2\">`nextRowKey`</ph> and <ph id=\"ph3\">`targetLocation`</ph> which can be used to",
      "pos": [
        15680,
        15754
      ]
    },
    {
      "content": "iterate through all the results.",
      "pos": [
        15756,
        15788
      ]
    },
    {
      "content": "There is also a continuation sample within the Azure Storage Node.js repo on",
      "pos": [
        15790,
        15866
      ]
    },
    {
      "content": "GitHub, look for <ph id=\"ph1\">`examples/samples/continuationsample.js`</ph>.",
      "pos": [
        15868,
        15926
      ]
    },
    {
      "content": "Work with Shared Access Signatures",
      "pos": [
        15931,
        15965
      ]
    },
    {
      "content": "Shared Access Signatures (SAS) are a secure way to provide granular access to tables without providing your storage account name or keys.",
      "pos": [
        15967,
        16104
      ]
    },
    {
      "content": "SAS are often used to provide limited access to your data, such as allowing a mobile app to query records.",
      "pos": [
        16105,
        16211
      ]
    },
    {
      "content": "A trusted application such as a cloud-based service generates a SAS using the <bpt id=\"p1\">**</bpt>generateSharedAccessSignature<ept id=\"p1\">**</ept> of the <bpt id=\"p2\">**</bpt>TableService<ept id=\"p2\">**</ept>, and provides it to an untrusted or semi-trusted application.",
      "pos": [
        16213,
        16410
      ]
    },
    {
      "content": "For example, a mobile app.",
      "pos": [
        16411,
        16437
      ]
    },
    {
      "content": "The SAS is generated using a policy, which describes the start and end dates during which the SAS is valid, as well as the access level granted to the SAS holder.",
      "pos": [
        16438,
        16600
      ]
    },
    {
      "content": "The following example generates a new shared access policy that will allow the SAS holder to query ('r') the table, and expires 100 minutes after the time it is created.",
      "pos": [
        16602,
        16771
      ]
    },
    {
      "content": "Note that the host information must be provided also, as it is required when the SAS holder attempts to access the table.",
      "pos": [
        17286,
        17407
      ]
    },
    {
      "content": "The client application then uses the SAS with <bpt id=\"p1\">**</bpt>TableServiceWithSAS<ept id=\"p1\">**</ept> to perform operations against the table.",
      "pos": [
        17409,
        17519
      ]
    },
    {
      "content": "The following example connects to the table and performs a query.",
      "pos": [
        17520,
        17585
      ]
    },
    {
      "content": "Since the SAS was generated with only query access, if an attempt were made to insert, update, or delete entities, an error would be returned.",
      "pos": [
        17919,
        18061
      ]
    },
    {
      "content": "Access control lists",
      "pos": [
        18067,
        18087
      ]
    },
    {
      "content": "You can also use an Access Control List (ACL) to set the access policy for a SAS.",
      "pos": [
        18089,
        18170
      ]
    },
    {
      "content": "This is useful if you wish to allow multiple clients to access the table, but provide different access policies for each client.",
      "pos": [
        18171,
        18299
      ]
    },
    {
      "content": "An ACL is implemented using an array of access policies, with an ID associated with each policy.",
      "pos": [
        18301,
        18397
      ]
    },
    {
      "content": "The  following example defines two policies; one for 'user1' and one for 'user2':",
      "pos": [
        18398,
        18479
      ]
    },
    {
      "content": "The following example gets the current ACL for the <bpt id=\"p1\">**</bpt>hometasks<ept id=\"p1\">**</ept> table, then adds the new policies using <bpt id=\"p2\">**</bpt>setTableAcl<ept id=\"p2\">**</ept>.",
      "pos": [
        18925,
        19046
      ]
    },
    {
      "content": "This approach allows:",
      "pos": [
        19047,
        19068
      ]
    },
    {
      "content": "Once the ACL has been set, you can then create a SAS based on the ID for a policy.",
      "pos": [
        19445,
        19527
      ]
    },
    {
      "content": "The following example creates a new SAS for 'user2':",
      "pos": [
        19528,
        19580
      ]
    },
    {
      "content": "Next Steps",
      "pos": [
        19671,
        19681
      ]
    },
    {
      "content": "Now that you've learned the basics of table storage, follow these links",
      "pos": [
        19683,
        19754
      ]
    },
    {
      "content": "to learn how to do more complex storage tasks.",
      "pos": [
        19755,
        19801
      ]
    },
    {
      "pos": [
        19807,
        19871
      ],
      "content": "See the MSDN Reference: <bpt id=\"p1\">[</bpt>Storing and Accessing Data in Azure<ept id=\"p1\">][]</ept>."
    },
    {
      "pos": [
        19876,
        19914
      ],
      "content": "<bpt id=\"p1\">[</bpt>Visit the Azure Storage Team Blog<ept id=\"p1\">][]</ept>."
    },
    {
      "pos": [
        19919,
        19981
      ],
      "content": "Visit the <bpt id=\"p1\">[</bpt>Azure Storage SDK for Node<ept id=\"p1\">][]</ept> repository on GitHub."
    }
  ],
  "content": "<properties \n    pageTitle=\"How to use Table storage from Node.js | Microsoft Azure\" \n    description=\"Learn how to use the table storage service in Azure. Code samples are written using the Node.js API.\" \n    services=\"storage\" \n    documentationCenter=\"nodejs\" \n    authors=\"MikeWasson\" \n    manager=\"wpickett\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"storage\" \n    ms.workload=\"storage\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"nodejs\" \n    ms.topic=\"article\" \n    ms.date=\"09/01/2015\" \n    ms.author=\"mwasson\"/>\n\n\n# How to use Table storage from Node.js\n\n[AZURE.INCLUDE [storage-selector-table-include](../../includes/storage-selector-table-include.md)]\n\n\n## Overview\n\nThis topic shows how to perform common scenarios using the \nAzure Table service in a Node.js application. \n\nThe code examples in this topic assume you already have a Node.js application. For instructions on creating a Node.js application in Azure, see any of these topics:\n\n- [Build and deploy a Node.js website to Azure][Create and deploy a Node.js application to an Azure Web Site]\n- [Build and deploy a Node.js website to Azure using WebMatrix][Web Site with WebMatrix].\n- [Build and deploy a Node.js application to an Azure Cloud Service][Node.js Cloud Service] (using Windows PowerShell)\n\n\n[AZURE.INCLUDE [storage-table-concepts-include](../../includes/storage-table-concepts-include.md)]\n\n[AZURE.INCLUDE [storage-create-account-include](../../includes/storage-create-account-include.md)]\n\n\n## Configure your application to access Azure Storage\n\nTo use Azure storage, you need the Azure Storage SDK for Node.js, which includes a set of convenience libraries that\ncommunicate with the storage REST services.\n\n### Use Node Package Manager (NPM) to install the package\n\n1.  Use a command-line interface such as **PowerShell** (Windows) **Terminal** (Mac) or **Bash** (Unix), and navigate to the folder where you created your application.\n\n2.  Type **npm install azure-storage** in the command window. Output from the command is similar to the following example.\n\n        azure-storage@0.5.0 node_modules\\azure-storage\n        +-- extend@1.2.1\n        +-- xmlbuilder@0.4.3\n        +-- mime@1.2.11\n        +-- node-uuid@1.4.3\n        +-- validator@3.22.2\n        +-- underscore@1.4.4\n        +-- readable-stream@1.0.33 (string_decoder@0.10.31, isarray@0.0.1, inherits@2.0.1, core-util-is@1.0.1)\n        +-- xml2js@0.2.7 (sax@0.5.2)\n        +-- request@2.57.0 (caseless@0.10.0, aws-sign2@0.5.0, forever-agent@0.6.1, stringstream@0.0.4, oauth-sign@0.8.0, tunnel-agent@0.4.1, isstream@0.1.2, json-stringify-safe@5.0.1, bl@0.9.4, combined-stream@1.0.5, qs@3.1.0, mime-types@2.0.14, form-data@0.2.0, http-signature@0.11.0, tough-cookie@2.0.0, hawk@2.3.1, har-validator@1.8.0)\n\n3.  You can manually run the **ls** command to verify that a\n    **node\\_modules** folder was created. Inside that folder you will\n    find the **azure-storage** package, which contains the libraries you need to\n    access storage.\n\n### Import the package\n\nAdd the following code to the top of the **server.js** file in your application:\n\n    var azure = require('azure-storage');\n\n## Setup an Azure Storage Connection\n\nThe azure module will read the environment variables AZURE\\_STORAGE\\_ACCOUNT and AZURE\\_STORAGE\\_ACCESS\\_KEY, or AZURE\\_STORAGE\\_CONNECTION\\_STRING for information required to connect to your Azure storage account. If these environment variables are not set, you must specify the account information when calling **TableService**.\n\nFor an example of setting the environment variables in the management portal for an Azure Website, see [Node.js Web Application with Storage]\n\n## Create a table\n\nThe following code creates a **TableService** object and uses it to\ncreate a new table. Add the following near the top of **server.js**.\n\n    var tableSvc = azure.createTableService();\n\nThe call to **createTableIfNotExists** will create a new table with the specified name if it does\nnot already exist. The following example creates a new table named 'mytable' if it does not already exist:\n\n    tableSvc.createTableIfNotExists('mytable', function(error, result, response){\n        if(!error){\n            // Table exists or created\n        }\n    });\n\nThe `result` will be `true` if a new table is created, and `false` if the table already exists. `response` will contain information about the request.\n\n### Filters\n\nOptional filtering operations can be applied to operations performed using **TableService**. Filtering operations can include logging, automatically retrying, etc. Filters are objects that implement a method with the signature:\n\n        function handle (requestOptions, next)\n\nAfter doing its preprocessing on the request options, the method needs to call \"next\" passing a callback with the following signature:\n\n        function (returnObject, finalCallback, next)\n\nIn this callback, and after processing the returnObject (the response from the request to the server), the callback needs to either invoke next if it exists to continue processing other filters or simply invoke finalCallback otherwise to end up the service invocation.\n\nTwo filters that implement retry logic are included with the Azure SDK for Node.js, **ExponentialRetryPolicyFilter** and **LinearRetryPolicyFilter**. The following creates a **TableService** object that uses the **ExponentialRetryPolicyFilter**:\n\n    var retryOperations = new azure.ExponentialRetryPolicyFilter();\n    var tableSvc = azure.createTableService().withFilter(retryOperations);\n\n## Add an entity to a table\n\nTo add an entity, first create an object that defines your entity\nproperties. All entities must contain a **PartitionKey** and **RowKey**, which are unique identifiers for the entity.\n\n* **PartitionKey** - Determines the partition that the entity is stored in.\n\n* **RowKey** - Uniquely identifies the entity within the partition.\n\nBoth **PartitionKey** and **RowKey** must be string values. For more information, see [Understanding the Table Service data model](http://msdn.microsoft.com/library/azure/dd179338.aspx).\n\nThe following is an example of defining an entity. Note that **dueDate** is defined as a type of **Edm.DateTime**. Specifying the type is optional, and types will be inferred if not specified.\n\n    var task = { \n      PartitionKey: {'_':'hometasks'},\n      RowKey: {'_': '1'},\n      description: {'_':'take out the trash'},\n      dueDate: {'_':new Date(2015, 6, 20), '$':'Edm.DateTime'}\n    };\n\n> [AZURE.NOTE] There is also a **Timestamp** field for each record, which is set by Azure when an entity is inserted or updated.\n\nYou can also use the **entityGenerator** to create entities. The following example creates the same task entity using the **entityGenerator**.\n\n    var entGen = azure.TableUtilities.entityGenerator;\n    var task = {\n      PartitionKey: entGen.String('hometasks'),\n      RowKey: entGen.String('1'),\n      description: entGen.String('take out the trash'),\n      dueDate: entGen.DateTime(new Date(Date.UTC(2015, 6, 20))),\n    };\n\nTo add an entity to your table, pass the entity object to\nthe **insertEntity** method.\n\n    tableSvc.insertEntity('mytable',task, function (error, result, response) {\n        if(!error){\n            // Entity inserted\n        }\n    });\n\nIf the operation is successful, `result` will contain the [ETag](http://en.wikipedia.org/wiki/HTTP_ETag) of the inserted record and `response` will contain information about the operation.\n\nExample response:\n\n    { '.metadata': { etag: 'W/\"datetime\\'2015-02-25T01%3A22%3A22.5Z\\'\"' } }\n\n> [AZURE.NOTE] By default, **insertEntity** does not return the inserted entity as part of the `response` information. If you plan on performing other operations on this entity, or wish to cache the information, it can be useful to have it returned as part of the `result`. You can do this by enabling **echoContent** as follows:\n>\n> `tableSvc.insertEntity('mytable', task, {echoContent: true}, function (error, result, response) {...}`\n\n## Update an entity\n\nThere are multiple methods available to update an existing entity:\n\n* **updateEntity** - Updates an existing entity by replacing it.\n\n* **mergeEntity** - Updates an existing entity by merging new property values into the existing entity.\n\n* **insertOrReplaceEntity** - Updates an existing entity by replacing it. If no entity exists, a new one will be inserted.\n\n* **insertOrMergeEntity** - Updates an existing entity by merging new property values into the existing. If no entity exists, a new one will be inserted.\n\nThe following example demonstrates updating an entity using **updateEntity**:\n\n    tableSvc.updateEntity('mytable', updatedTask, function(error, result, response){\n      if(!error) {\n        // Entity updated\n      }\n    });\n\n> [AZURE.NOTE] By default, updating an entity does not check to see if the data being updated has previously been modified by another process. To support concurrent updates:\n> \n> 1. Get the ETag of the object being updated. This is returned as part of the `response` for any entity related operation and can be retrieved through `response['.metadata'].etag`.\n> \n> 2. When performing an update operation on an entity, add the ETag information previously retrieved to the new entity. For example:\n> \n>     `entity2['.metadata'].etag = currentEtag;`\n>    \n> 3. Perform the update operation. If the entity has been modified since you retrieved the ETag value, such as another instance of your application, an `error` will be returned stating that the update condition specified in the request was not satisfied.\n    \nWith **updateEntity** and **mergeEntity**, if the entity that is being updated doesn't exist then the update operation will fail. Therefore if you wish to store an entity regardless of whether it already exists, use **insertOrReplaceEntity** or **insertOrMergeEntity**.\n\nThe `result` for successful update operations will contain the **Etag** of the updated entity.\n\n## Work with groups of entities\n\nSometimes it makes sense to submit multiple operations together in a\nbatch to ensure atomic processing by the server. To accomplish that, use the **TableBatch** class to create a batch, and then use the **executeBatch** method of **TableService** to perform the batched operations.\n\n The following example demonstrates submitting two entities in a batch:\n\n    var task1 = { \n      PartitionKey: {'_':'hometasks'},\n      RowKey: {'_': '1'},\n      description: {'_':'Take out the trash'},\n      dueDate: {'_':new Date(2015, 6, 20)}\n    };\n    var task2 = { \n      PartitionKey: {'_':'hometasks'},\n      RowKey: {'_': '2'},\n      description: {'_':'Wash the dishes'},\n      dueDate: {'_':new Date(2015, 6, 20)}\n    };\n\n    var batch = new azure.TableBatch();\n    \n    batch.insertEntity(task1, {echoContent: true});\n    batch.insertEntity(task2, {echoContent: true});\n\n    tableSvc.executeBatch('mytable', batch, function (error, result, response) {\n      if(!error) {\n        // Batch completed\n      }\n    });\n\nFor successful batch operations, `result` will contain information for each operation in the batch.\n\n### Work with batched operations\n\nOperations added to a batch can be inspected by viewing the `operations` property. You can also use the following methods to work with operations.\n\n* **clear** - clears all operations from a batch.\n\n* **getOperations** - gets an operation from the batch.\n\n* **hasOperations** - returns true if the batch contains operations.\n\n* **removeOperations** - removes an operation.\n\n* **size** - returns the number of operations in the batch.\n\n## Retrieve an entity by key\n\nTo return a specific entity based on the **PartitionKey** and **RowKey**, use the **retrieveEntity** method.\n\n    tableSvc.retrieveEntity('mytable', 'hometasks', '1', function(error, result, response){\n      if(!error){\n        // result contains the entity\n      }\n    });\n\nOnce this operation completes, `result` will contain the entity.\n\n## Query a set of Entities\n\nTo query a table, use the **TableQuery** object to build up a query\nexpression using the following clauses:\n\n* **select** - The fields to be returned from the query.\n\n* **where** - The where clause.\n\n    * **and** - An `and` where condition.\n\n    * **or** - An `or` where condition.\n\n* **top** - The number of items to fetch.\n\n\nThe following example builds a query that will return the top 5 items with a PartitionKey of 'hometasks'.\n\n    var query = new azure.TableQuery()\n      .top(5)\n      .where('PartitionKey eq ?', 'hometasks');\n\nSince **select** is not used, all fields will be returned. To perform the query against a table, use **queryEntities**. The following example uses this query to return entities from 'mytable'.\n\n    tableSvc.queryEntities('mytable',query, null, function(error, result, response) {\n      if(!error) {\n        // query was successful\n      }\n    });\n\nIf successful, `result.entries` will contain an array of entities that match the query. If the query was unable to return all entities, `result.continuationToken` will be non-*null* and can be used as the third parameter of **queryEntities** to retrieve more results. For the initial query, use *null* for the third parameter.\n\n### Query a Subset of Entity Properties\n\nA query to a table can retrieve just a few fields from an entity.\nThis reduces bandwidth and can improve query performance, especially for large entities. Use the **select** clause and pass the names of the fields to be returned. For example, the following query will only return the **description** and **dueDate** fields.\n\n    var query = new azure.TableQuery()\n      .select(['description', 'dueDate'])\n      .top(5)\n      .where('PartitionKey eq ?', 'hometasks');\n\n## Delete an Entity\n\nYou can delete an entity using its partition and row keys. In this\nexample, the **task1** object contains the **RowKey** and\n**PartitionKey** values of the entity to be deleted. Then the object is\npassed to the **deleteEntity** method.\n\n    var task = { \n      PartitionKey: {'_':'hometasks'},\n      RowKey: {'_': '1'}\n    };\n\n    tableSvc.deleteEntity('mytable', task, function(error, response){\n      if(!error) {\n        // Entity deleted\n      }\n    });\n\n> [AZURE.NOTE] Consider using ETags when deleting items, to ensure that the item hasn't been modified by another process. See [Update an Entity](#update-an-entity) for information in using ETags.\n\n## Delete a Table\n\nThe following code deletes a table from a storage account.\n\n    tableSvc.deleteTable('mytable', function(error, response){\n        if(!error){\n            // Table deleted\n        }\n    });\n\nIf you are uncertain whether the table exists, use **deleteTableIfExists**.\n\n## Use continuation tokens\n\nWhen you are querying tables for large amounts of results, look for \ncontinuation tokens. There may be large amounts of data available for your \nquery that you might not realize if you do not build to recognize when a \ncontinuation token is present.\n\nThe results object returned when querying entities sets a `continuationToken` \nproperty when such a token is present. You can then use this when performing \na query to continue to move across the partition and table entities.\n\nWhen querying, a continuationToken parameter may be provided between the \nquery object instance and the callback function:\n\n```\nvar nextContinuationToken = null;\ndc.table.queryEntities(tableName,\n    query,\n    nextContinuationToken,\n    function (error, results) {\n        if (error) throw error;\n\n        // iterate through results.entries with results\n\n        if (results.continuationToken) {\n            nextContinuationToken = results.continuationToken;\n        }\n\n    });\n```\n\nIf you inspect the `continuationToken` object, you will find properties such as \n`nextPartitionKey`, `nextRowKey` and `targetLocation` which can be used to \niterate through all the results.\n\nThere is also a continuation sample within the Azure Storage Node.js repo on \nGitHub, look for `examples/samples/continuationsample.js`.\n\n## Work with Shared Access Signatures\n\nShared Access Signatures (SAS) are a secure way to provide granular access to tables without providing your storage account name or keys. SAS are often used to provide limited access to your data, such as allowing a mobile app to query records.\n\nA trusted application such as a cloud-based service generates a SAS using the **generateSharedAccessSignature** of the **TableService**, and provides it to an untrusted or semi-trusted application. For example, a mobile app. The SAS is generated using a policy, which describes the start and end dates during which the SAS is valid, as well as the access level granted to the SAS holder.\n\nThe following example generates a new shared access policy that will allow the SAS holder to query ('r') the table, and expires 100 minutes after the time it is created.\n\n    var startDate = new Date();\n    var expiryDate = new Date(startDate);\n    expiryDate.setMinutes(startDate.getMinutes() + 100);\n    startDate.setMinutes(startDate.getMinutes() - 100);\n        \n    var sharedAccessPolicy = {\n      AccessPolicy: {\n        Permissions: azure.TableUtilities.SharedAccessPermissions.QUERY,\n        Start: startDate,\n        Expiry: expiryDate\n      },\n    };\n\n    var tableSAS = tableSvc.generateSharedAccessSignature('mytable', sharedAccessPolicy);\n    var host = tableSvc.host;\n\nNote that the host information must be provided also, as it is required when the SAS holder attempts to access the table.\n\nThe client application then uses the SAS with **TableServiceWithSAS** to perform operations against the table. The following example connects to the table and performs a query.\n\n    var sharedTableService = azure.createTableServiceWithSas(host, tableSAS);\n    var query = azure.TableQuery()\n      .where('PartitionKey eq ?', 'hometasks');\n        \n    sharedTableService.queryEntities(query, null, function(error, result, response) {\n      if(!error) {\n        // result contains the entities\n      }\n    });\n\nSince the SAS was generated with only query access, if an attempt were made to insert, update, or delete entities, an error would be returned.\n\n### Access control lists\n\nYou can also use an Access Control List (ACL) to set the access policy for a SAS. This is useful if you wish to allow multiple clients to access the table, but provide different access policies for each client.\n\nAn ACL is implemented using an array of access policies, with an ID associated with each policy. The  following example defines two policies; one for 'user1' and one for 'user2':\n\n    var sharedAccessPolicy = [\n      {\n        AccessPolicy: {\n          Permissions: azure.TableUtilities.SharedAccessPermissions.QUERY,\n          Start: startDate,\n          Expiry: expiryDate\n        },\n        Id: 'user1'\n      },\n      {\n        AccessPolicy: {\n          Permissions: azure.TableUtilities.SharedAccessPermissions.ADD,\n          Start: startDate,\n          Expiry: expiryDate\n        },\n        Id: 'user2'\n      }\n    ];\n\nThe following example gets the current ACL for the **hometasks** table, then adds the new policies using **setTableAcl**. This approach allows:\n\n    tableSvc.getTableAcl('hometasks', function(error, result, response) {\n      if(!error){\n        //push the new policy into signedIdentifiers\n        result.signedIdentifiers.push(sharedAccessPolicy);\n        tableSvc.setTableAcl('hometasks', result, function(error, result, response){\n          if(!error){\n            // ACL set\n          }\n        });\n      }\n    });\n\nOnce the ACL has been set, you can then create a SAS based on the ID for a policy. The following example creates a new SAS for 'user2':\n\n    tableSAS = tableSvc.generateSharedAccessSignature('hometasks', { Id: 'user2' });\n\n## Next Steps\n\nNow that you've learned the basics of table storage, follow these links\nto learn how to do more complex storage tasks.\n\n-   See the MSDN Reference: [Storing and Accessing Data in Azure][].\n-   [Visit the Azure Storage Team Blog][].\n-   Visit the [Azure Storage SDK for Node][] repository on GitHub.\n\n  [Azure Storage SDK for Node]: https://github.com/Azure/azure-storage-node\n  [OData.org]: http://www.odata.org/\n  [using the REST API]: http://msdn.microsoft.com/library/azure/hh264518.aspx\n  [Azure Management Portal]: http://manage.windowsazure.com\n\n  [Node.js Cloud Service]: ../cloud-services-nodejs-develop-deploy-app.md\n  [Storing and Accessing Data in Azure]: http://msdn.microsoft.com/library/azure/gg433040.aspx\n  [Visit the Azure Storage Team Blog]: http://blogs.msdn.com/b/windowsazurestorage/\n  [Web Site with WebMatrix]: ../web-sites-nodejs-use-webmatrix.md\n  [Node.js Cloud Service with Storage]: ../storage-nodejs-use-table-storage-cloud-service-app.md\n  [Node.js Web Application with Storage]: ../storage-nodejs-use-table-storage-web-site.md\n  [Create and deploy a Node.js application to an Azure Web Site]: ../web-sites-nodejs-develop-deploy-mac.md\n "
}