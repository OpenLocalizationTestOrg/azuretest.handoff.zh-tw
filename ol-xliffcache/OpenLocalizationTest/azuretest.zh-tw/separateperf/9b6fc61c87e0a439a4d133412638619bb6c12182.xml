{
  "nodes": [
    {
      "content": "How to Set Up Tomcat7 on a Linux Virtual Machine with Microsoft Azure",
      "pos": [
        28,
        97
      ]
    },
    {
      "content": "Learn how to set up Tomcat7 with Microsoft Azure using an Azure virtual machine (VM) running Linux.",
      "pos": [
        117,
        216
      ]
    },
    {
      "content": "How to Set Up Tomcat7 on a Linux Virtual Machine with Microsoft Azure",
      "pos": [
        561,
        630
      ]
    },
    {
      "content": "Apache Tomcat (or simply Tomcat, formerly also Jakarta Tomcat) is an open source web server and servlet container developed by the Apache Software Foundation (ASF).",
      "pos": [
        633,
        797
      ]
    },
    {
      "content": "Tomcat implements the Java Servlet and the JavaServer Pages (JSP) specifications from Sun Microsystems, and provides a pure Java HTTP web server environment in which to run Java code.",
      "pos": [
        798,
        981
      ]
    },
    {
      "content": "In the simplest configuration, Tomcat runs in a single operating system process.",
      "pos": [
        982,
        1062
      ]
    },
    {
      "content": "This process runs a Java virtual machine (JVM).",
      "pos": [
        1063,
        1110
      ]
    },
    {
      "content": "Every HTTP request from a browser to Tomcat is processed as a separate thread in the Tomcat process.",
      "pos": [
        1111,
        1211
      ]
    },
    {
      "content": "In this guide, you will install tomcat7 on a Linux image and deploy it in Microsoft Azure.",
      "pos": [
        1215,
        1305
      ]
    },
    {
      "content": "You will learn:",
      "pos": [
        1309,
        1324
      ]
    },
    {
      "content": "How to create a virtual machine in Azure.",
      "pos": [
        1332,
        1373
      ]
    },
    {
      "content": "How to prepare the virtual machine for tomcat7.",
      "pos": [
        1378,
        1425
      ]
    },
    {
      "content": "How to install tomcat7.",
      "pos": [
        1430,
        1453
      ]
    },
    {
      "content": "It is assumed that the reader already has an Azure subscription.",
      "pos": [
        1455,
        1519
      ]
    },
    {
      "content": "If not you can sign up for a free trial at <bpt id=\"p1\">[</bpt>http://azure.microsoft.com<ept id=\"p1\">](http://azure.microsoft.com)</ept>.",
      "pos": [
        1521,
        1621
      ]
    },
    {
      "content": "If you have an MSDN subscription, see <bpt id=\"p1\">[</bpt>Microsoft Azure Special Pricing: MSDN, MPN, and Bizspark Benefits<ept id=\"p1\">](http://azure.microsoft.com/pricing/member-offers/msdn-benefits/?c=14-39)</ept>.",
      "pos": [
        1622,
        1801
      ]
    },
    {
      "content": "To learn more about Azure, see <bpt id=\"p1\">[</bpt>What is Azure?<ept id=\"p1\">](http://azure.microsoft.com/overview/what-is-azure/)</ept>.",
      "pos": [
        1802,
        1902
      ]
    },
    {
      "content": "This topic assumes that you have basic working knowledge of tomcat and Linux.",
      "pos": [
        1904,
        1981
      ]
    },
    {
      "content": "Phase 1: Create an image",
      "pos": [
        1987,
        2011
      ]
    },
    {
      "content": "In this phase, you will create a virtual machine using a Linux image in Azure.",
      "pos": [
        2012,
        2090
      ]
    },
    {
      "content": "Step 1: Generate an SSH Authentication Key",
      "pos": [
        2097,
        2139
      ]
    },
    {
      "content": "SSH is an important tool for system administrators.",
      "pos": [
        2140,
        2191
      ]
    },
    {
      "content": "However, configuring access security based on a human-determined password is not a best practice.",
      "pos": [
        2192,
        2289
      ]
    },
    {
      "content": "Malicious users can break into your system based on a user name and a weak password.",
      "pos": [
        2290,
        2374
      ]
    },
    {
      "content": "The good news is that there is a way to leave remote access open and have not to worry about passwords.",
      "pos": [
        2376,
        2479
      ]
    },
    {
      "content": "The method consists of authentication with asymmetric cryptography.",
      "pos": [
        2480,
        2547
      ]
    },
    {
      "content": "The user’s private key is the one that grants the authentication.",
      "pos": [
        2548,
        2613
      ]
    },
    {
      "content": "You can even lock the user’s account to disallow password authentication completely.",
      "pos": [
        2614,
        2698
      ]
    },
    {
      "content": "Another advantage of this method is that you do not need different passwords to log on to different servers.",
      "pos": [
        2701,
        2809
      ]
    },
    {
      "content": "You can authenticate using the personal private key on all servers, which prevents you from having to remember several passwords.",
      "pos": [
        2810,
        2939
      ]
    },
    {
      "content": "It is also possible to login with requiring a password with this method.",
      "pos": [
        2942,
        3014
      ]
    },
    {
      "content": "Follow these steps to generate the SSH authentication key.",
      "pos": [
        3016,
        3074
      ]
    },
    {
      "pos": [
        3080,
        3269
      ],
      "content": "Download and install puttygen from the following location: <bpt id=\"p1\">[</bpt>http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html<ept id=\"p1\">](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html)</ept>"
    },
    {
      "content": "Run PUTTYGEN.EXE.",
      "pos": [
        3275,
        3292
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Generate<ept id=\"p1\">**</ept> to generate the keys.",
      "pos": [
        3297,
        3337
      ]
    },
    {
      "content": "In the process you can increase randomness by moving the mouse over the blank area in the window.",
      "pos": [
        3338,
        3435
      ]
    },
    {
      "content": "After the generate process, Puttygen.exe will show your generated key.",
      "pos": [
        3449,
        3519
      ]
    },
    {
      "content": "For example:",
      "pos": [
        3520,
        3532
      ]
    },
    {
      "content": "Select and copy the public key in <bpt id=\"p1\">**</bpt>Key<ept id=\"p1\">**</ept> and save it in a file named publicKey.pem.",
      "pos": [
        3546,
        3630
      ]
    },
    {
      "content": "Don’t click <bpt id=\"p1\">**</bpt>Save public key<ept id=\"p1\">**</ept>, because the saved public key’s file format is different from the public key we want.",
      "pos": [
        3631,
        3748
      ]
    },
    {
      "pos": [
        3753,
        3823
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Save private key<ept id=\"p1\">**</ept> and save it in a file named privateKey.ppk."
    },
    {
      "content": "Step 2: Create the image in the Azure Preview Portal.",
      "pos": [
        3829,
        3882
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">[</bpt>Azure Preview Portal<ept id=\"p1\">](https://portal.azure.com/)</ept>, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept> in the task bar to create an image, choosing the Linux image based on your needs.",
      "pos": [
        3883,
        4036
      ]
    },
    {
      "content": "The following example uses the Ubuntu 14.04 image.",
      "pos": [
        4037,
        4087
      ]
    },
    {
      "content": "For <bpt id=\"p1\">**</bpt>Host Name<ept id=\"p1\">**</ept> specify the name for the URL that you and Internet clients will use to access this virtual machine.",
      "pos": [
        4098,
        4215
      ]
    },
    {
      "content": "Define the last part of the DNS name, for example tomcatdemo, and Azure will generate the URL as tomcatdemo.cloudapp.net.",
      "pos": [
        4216,
        4337
      ]
    },
    {
      "content": "For <bpt id=\"p1\">**</bpt>SSH Authentication Key<ept id=\"p1\">**</ept>, copy the key value from the <bpt id=\"p2\">**</bpt>publicKey.pem<ept id=\"p2\">**</ept> file, which contains the public key generated by puttygen.",
      "pos": [
        4341,
        4477
      ]
    },
    {
      "content": "Configure other settings as needed, and then click Create.",
      "pos": [
        4490,
        4548
      ]
    },
    {
      "content": "Phase 2: Prepare your virtual machine for Tomcat7",
      "pos": [
        4554,
        4603
      ]
    },
    {
      "content": "In this phase, you will configure an endpoint for tomcat traffic and then connect to your new virtual machine.",
      "pos": [
        4604,
        4714
      ]
    },
    {
      "content": "Step 1: Open the HTTP port to allow web access",
      "pos": [
        4718,
        4764
      ]
    },
    {
      "content": "Endpoints in Azure consist of a protocol (TCP or UDP), along with a public and private port.",
      "pos": [
        4765,
        4857
      ]
    },
    {
      "content": "The private port is the port that the service is listening on the virtual machine.",
      "pos": [
        4858,
        4940
      ]
    },
    {
      "content": "The public port is the port that the Azure cloud service is listening on externally for incoming, Internet-based traffic.",
      "pos": [
        4941,
        5062
      ]
    },
    {
      "content": "TCP port 8080 is the default port number on which tomcat listens.",
      "pos": [
        5066,
        5131
      ]
    },
    {
      "content": "Opening this port with an Azure endpoint will allow you and other Internet clients access to tomcat pages.",
      "pos": [
        5132,
        5238
      ]
    },
    {
      "content": "In the Azure Preview Portal, click <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept> -&gt; <bpt id=\"p2\">**</bpt>Virtual Machine<ept id=\"p2\">**</ept>, and then click the virtual machine that you created.",
      "pos": [
        5246,
        5368
      ]
    },
    {
      "content": "To add an endpoint to your virtual machine, click the <bpt id=\"p1\">**</bpt>Endpoints<ept id=\"p1\">**</ept> box.",
      "pos": [
        5382,
        5454
      ]
    },
    {
      "pos": [
        5467,
        5481
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        5492,
        5592
      ],
      "content": "For the <bpt id=\"p1\">**</bpt>endpoint<ept id=\"p1\">**</ept>, type a name for the endpoint in Endpoint, and then type 80 in <bpt id=\"p2\">**</bpt>Public Port<ept id=\"p2\">**</ept>."
    },
    {
      "content": "If you set it to 80, don’t need to include the port number in the URL that allows you to access tomcat.",
      "pos": [
        5610,
        5713
      ]
    },
    {
      "content": "For example, http://tomcatdemo.cloudapp.net.",
      "pos": [
        5714,
        5758
      ]
    },
    {
      "content": "If you set it to another value, such as 81, you need to add the port number to the URL to access tomcat.",
      "pos": [
        5772,
        5876
      ]
    },
    {
      "content": "For example,  http://tomcatdemo.cloudapp.net:81/.",
      "pos": [
        5877,
        5926
      ]
    },
    {
      "pos": [
        5935,
        6142
      ],
      "content": "Type 8080 in Private Port. By default, tomcat listens on TCP port 8080. If you changed the default listen port of tomcat, you should update Private Port to be the same as the tomcat listen port.  \n![][7]",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Type 8080 in Private Port. By default, tomcat listens on TCP port 8080. If you changed the default listen port of tomcat, you should update Private Port to be the same as the tomcat listen port.",
          "pos": [
            0,
            194
          ],
          "nodes": [
            {
              "content": "Type 8080 in Private Port.",
              "pos": [
                0,
                26
              ]
            },
            {
              "content": "By default, tomcat listens on TCP port 8080.",
              "pos": [
                27,
                71
              ]
            },
            {
              "content": "If you changed the default listen port of tomcat, you should update Private Port to be the same as the tomcat listen port.",
              "pos": [
                72,
                194
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        6149,
        6206
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to add the endpoint to your virtual machine."
    },
    {
      "content": "Step 2: Connect to the image you created.",
      "pos": [
        6213,
        6254
      ]
    },
    {
      "content": "You can choose any SSH tool to connect to your virtual machine.",
      "pos": [
        6255,
        6318
      ]
    },
    {
      "content": "In this example, we use Putty.",
      "pos": [
        6319,
        6349
      ]
    },
    {
      "content": "First, get the DNS name of your virtual machine from the Azure Preview Portal.",
      "pos": [
        6353,
        6431
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Click Browse<ept id=\"p1\">**</ept> -&gt; <bpt id=\"p2\">**</bpt>Virtual machines<ept id=\"p2\">**</ept> -&gt; the name of your virtual machine -&gt; <bpt id=\"p3\">**</bpt>Properties<ept id=\"p3\">**</ept>, and then look in the <bpt id=\"p4\">**</bpt>Domain Name<ept id=\"p4\">**</ept> field of the <bpt id=\"p5\">**</bpt>Properties<ept id=\"p5\">**</ept> tile.",
      "pos": [
        6432,
        6598
      ]
    },
    {
      "content": "Get the port number for SSH connections from the <bpt id=\"p1\">**</bpt>SSH<ept id=\"p1\">**</ept> field.",
      "pos": [
        6602,
        6665
      ]
    },
    {
      "content": "Here is an example.",
      "pos": [
        6666,
        6685
      ]
    },
    {
      "pos": [
        6697,
        6748
      ],
      "content": "Download Putty from <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](http://www.putty.org/)</ept> ."
    },
    {
      "content": "After downloading, click the executable file PUTTY.EXE.",
      "pos": [
        6752,
        6807
      ]
    },
    {
      "content": "Configure the basic options with the host name and port number obtained from the properties of your virtual machine.",
      "pos": [
        6808,
        6924
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        6925,
        6944
      ]
    },
    {
      "content": "In the left pane, click <bpt id=\"p1\">**</bpt>Connection<ept id=\"p1\">**</ept> -&gt; <bpt id=\"p2\">**</bpt>SSH<ept id=\"p2\">**</ept> -&gt; <bpt id=\"p3\">**</bpt>Auth<ept id=\"p3\">**</ept> and then click <bpt id=\"p4\">**</bpt>Browse<ept id=\"p4\">**</ept> to specify the location of the <bpt id=\"p5\">**</bpt>privateKey.ppk<ept id=\"p5\">**</ept> file, which contains the private key generated by puttygen in Phase 1: Create an Image.",
      "pos": [
        6956,
        7181
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        7182,
        7201
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>.",
      "pos": [
        7214,
        7229
      ]
    },
    {
      "content": "You might be alerted by a message box.",
      "pos": [
        7230,
        7268
      ]
    },
    {
      "content": "If you have configured the DNS name and port number correctly, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>.",
      "pos": [
        7269,
        7346
      ]
    },
    {
      "content": "You should see the following:",
      "pos": [
        7359,
        7388
      ]
    },
    {
      "content": "Enter the user name specified when you created the virtual machine in Phase 1: Create an Image.",
      "pos": [
        7400,
        7495
      ]
    },
    {
      "content": "You will see something like the following:",
      "pos": [
        7496,
        7538
      ]
    },
    {
      "content": "Phase 3: Install software",
      "pos": [
        7557,
        7582
      ]
    },
    {
      "content": "In this phase, you install the Java runtime environment, tomcat, and other tomcat components.",
      "pos": [
        7583,
        7676
      ]
    },
    {
      "content": "Java runtime environment",
      "pos": [
        7683,
        7707
      ]
    },
    {
      "content": "Tomcat is written in Java.",
      "pos": [
        7708,
        7734
      ]
    },
    {
      "content": "There are two kinds of Java Development Kits (JDKs) (OpenJDK and Oracle JDK), and you can choose the one you want.",
      "pos": [
        7735,
        7849
      ]
    },
    {
      "content": "AZURE.NOTE: Both JDKs have almost the same code for the classes in the Java API, but the code for the virtual machine is actually different.",
      "pos": [
        7854,
        7994
      ]
    },
    {
      "content": "When it comes to libraries, OpenJDK tends to use open libraries while Oracle tends to use closed ones.",
      "pos": [
        7995,
        8097
      ]
    },
    {
      "content": "But Oracle JDK has more classes and some fixed bugs, and Oracle JDK is more stable than OpenJDK.",
      "pos": [
        8098,
        8194
      ]
    },
    {
      "content": "The following commands download the different JDKs.",
      "pos": [
        8197,
        8248
      ]
    },
    {
      "content": "open-jdk",
      "pos": [
        8252,
        8260
      ]
    },
    {
      "content": "oracle-jdk",
      "pos": [
        8333,
        8343
      ]
    },
    {
      "content": "To download the JDK from the Oracle website:",
      "pos": [
        8351,
        8395
      ]
    },
    {
      "content": "To create a directory to contain the JDK files:",
      "pos": [
        8556,
        8603
      ]
    },
    {
      "content": "To extract the JDK files into the /usr/lib/jvm/ directory:",
      "pos": [
        8646,
        8704
      ]
    },
    {
      "content": "To set Oracle JDK as the default JVM:",
      "pos": [
        8780,
        8817
      ]
    },
    {
      "content": "Test:",
      "pos": [
        9033,
        9038
      ]
    },
    {
      "content": "You can use a command like the following to test if the Java runtime environment is installed correctly:",
      "pos": [
        9039,
        9143
      ]
    },
    {
      "content": "If you installed open-jdk, you should see a message like the following:",
      "pos": [
        9168,
        9239
      ]
    },
    {
      "content": "If you installed oracle-jdk, you should see a message like the following:",
      "pos": [
        9250,
        9323
      ]
    },
    {
      "content": "Tomcat7",
      "pos": [
        9337,
        9344
      ]
    },
    {
      "content": "Using the following command to install tomcat7:",
      "pos": [
        9345,
        9392
      ]
    },
    {
      "content": "If you are not using tomcat7, use the appropriate variation of this command.",
      "pos": [
        9432,
        9508
      ]
    },
    {
      "content": "Test:",
      "pos": [
        9516,
        9521
      ]
    },
    {
      "content": "To check if tomcat7 is successfully installed, browse to your tomcat server’s DNS name (http://tomcatexample.cloudapp.net/ is the example URL in this article).",
      "pos": [
        9523,
        9682
      ]
    },
    {
      "content": "If you see a page like the following, you have tomcat7 installed correct.",
      "pos": [
        9683,
        9756
      ]
    },
    {
      "content": "Install other Tomcat components",
      "pos": [
        9771,
        9802
      ]
    },
    {
      "content": "There are other optional tomcat components that you can also install.",
      "pos": [
        9803,
        9872
      ]
    },
    {
      "content": "Use the <bpt id=\"p1\">**</bpt>sudo apt-cache search tomcat7<ept id=\"p1\">**</ept> command to see all the available components.",
      "pos": [
        9876,
        9962
      ]
    },
    {
      "content": "The following commands are examples to install some useful parts.",
      "pos": [
        9963,
        10028
      ]
    },
    {
      "content": "Phase 4: Configure Tomcat",
      "pos": [
        10183,
        10208
      ]
    },
    {
      "content": "In this phase, you administer tomcat.",
      "pos": [
        10209,
        10246
      ]
    },
    {
      "content": "Start and stop tomcat7",
      "pos": [
        10250,
        10272
      ]
    },
    {
      "content": "The tomcat7 server will automatically start when you install it.",
      "pos": [
        10273,
        10337
      ]
    },
    {
      "content": "You can also start it yourself with the following command:",
      "pos": [
        10338,
        10396
      ]
    },
    {
      "content": "To stop tomcat7：",
      "pos": [
        10437,
        10453
      ]
    },
    {
      "content": "To view the status of tomcat7：",
      "pos": [
        10493,
        10523
      ]
    },
    {
      "content": "To restart tomcat services：",
      "pos": [
        10564,
        10591
      ]
    },
    {
      "content": "Tomcat administration",
      "pos": [
        10636,
        10657
      ]
    },
    {
      "content": "You can edit the Tomcat user configuration file to setup your admin credentials with the following command:",
      "pos": [
        10658,
        10765
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        10816,
        10835
      ]
    },
    {
      "content": "AZURE.NOTE: Create a strong password for the admin user name.",
      "pos": [
        10850,
        10911
      ]
    },
    {
      "content": "After editing this file, you should restart tomcat7 services with the following command to ensure that the changes take effect:",
      "pos": [
        10915,
        11042
      ]
    },
    {
      "content": "Open your browser, and enter the URL <bpt id=\"p1\">**</bpt>http://<ph id=\"ph1\">&lt;your tomcat server DNS name&gt;</ph>/manager/html<ept id=\"p1\">**</ept>.",
      "pos": [
        11086,
        11177
      ]
    },
    {
      "content": "For the example in this article, the URL is http://tomcatexample.cloudapp.net/manager/html.",
      "pos": [
        11178,
        11269
      ]
    },
    {
      "content": "After connecting, you should see something similar to the following:",
      "pos": [
        11273,
        11341
      ]
    },
    {
      "content": "Common issues",
      "pos": [
        11356,
        11369
      ]
    },
    {
      "content": "Can't access the virtual machine with Tomcat and Moodle from the Internet",
      "pos": [
        11374,
        11447
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Symptom<ept id=\"p1\">**</ept>",
      "pos": [
        11453,
        11464
      ]
    },
    {
      "content": "Tomcat is running but you can’t see the Tomcat default page with your browser.",
      "pos": [
        11467,
        11545
      ]
    },
    {
      "content": "Possible root case",
      "pos": [
        11552,
        11570
      ]
    },
    {
      "content": "The tomcat listen port is not same as the Private Port of your virtual machine's endpoint for tomcat traffic.",
      "pos": [
        11584,
        11693
      ]
    },
    {
      "content": "Check your Public Port and Private Port endpoint settings and make sure the Private Port is same as the tomcat listen port.",
      "pos": [
        11709,
        11832
      ]
    },
    {
      "content": "See Phase 1: Create an Image for instructions on configuring endpoints for your virtual machine.",
      "pos": [
        11833,
        11929
      ]
    },
    {
      "content": "To determine the tomcat listen port, open /etc/httpd/conf/httpd.conf (Red Hat release) or /etc/tomcat7/server.xml (Debian release).",
      "pos": [
        11941,
        12072
      ]
    },
    {
      "content": "By default, the tomcat listen port is 8080.",
      "pos": [
        12073,
        12116
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        12117,
        12136
      ]
    },
    {
      "content": "If you are using a virtual machine like Debian or Ubuntu and you want to change the default port of Tomcat Listen (for example 8081), you should also open the port for the OS.",
      "pos": [
        12288,
        12463
      ]
    },
    {
      "content": "First, open the Profile:",
      "pos": [
        12464,
        12488
      ]
    },
    {
      "content": "Then uncomment the last line and change “no” to “yes”.",
      "pos": [
        12544,
        12598
      ]
    },
    {
      "content": "The firewall has disabled the listen port of tomcat.",
      "pos": [
        12636,
        12688
      ]
    },
    {
      "content": "If you can only see the Tomcat default page from the local host, then the problem is most likely that the port which is listened by tomcat is blocked by the firewall.",
      "pos": [
        12698,
        12864
      ]
    },
    {
      "content": "You can use the w3m tool to browse the web page.",
      "pos": [
        12865,
        12913
      ]
    },
    {
      "content": "The following commands install w3m and browse to the Tomcat default page:",
      "pos": [
        12914,
        12987
      ]
    },
    {
      "content": "Solution",
      "pos": [
        13080,
        13088
      ]
    },
    {
      "content": "If the tomcat listen port is not same as the Private Port of the endpoint for traffic to the virtual machine, you need change the Private Port to be the same as the tomcat listen port.",
      "pos": [
        13099,
        13283
      ]
    },
    {
      "content": "If the issue is caused by the firewall/iptables, add the following lines to /etc/sysconfig/iptables:",
      "pos": [
        13300,
        13400
      ]
    },
    {
      "content": "Note that the second line is only needed for https traffic.",
      "pos": [
        13532,
        13591
      ]
    },
    {
      "content": "Make sure this is above any lines that would globally restrict access, such as the following:",
      "pos": [
        13603,
        13696
      ]
    },
    {
      "content": "To reload the iptables, run the following command:",
      "pos": [
        13777,
        13827
      ]
    },
    {
      "content": "This has been tested on CentOS 6.3.",
      "pos": [
        13879,
        13914
      ]
    },
    {
      "content": "Permission denied when upload you project files to /var/lib/tomcat7/webapps/",
      "pos": [
        13919,
        13995
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Symptom<ept id=\"p1\">**</ept>",
      "pos": [
        14003,
        14014
      ]
    },
    {
      "content": "When you use any SFTP client (such as FileZilla) to connect to your virtual machine and navigate to /var/lib/tomcat7/webapps/ to publish your site, you get an error message similar to the following:",
      "pos": [
        14017,
        14215
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Possible root case<ept id=\"p1\">**</ept>",
      "pos": [
        14474,
        14496
      ]
    },
    {
      "content": "You have no permissions to access the /var/lib/tomcat7/webapps folder.",
      "pos": [
        14498,
        14568
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Solution<ept id=\"p1\">**</ept>",
      "pos": [
        14575,
        14587
      ]
    },
    {
      "content": "You need get permission from the root account.",
      "pos": [
        14590,
        14636
      ]
    },
    {
      "content": "You can change the ownership of that folder from root to the username you used when provisioning the machine.",
      "pos": [
        14637,
        14746
      ]
    },
    {
      "content": "Here is an example with the azureuser account name:",
      "pos": [
        14747,
        14798
      ]
    },
    {
      "content": "Use the -R option to apply the permissions for all files inside of a directory too.",
      "pos": [
        14864,
        14947
      ]
    },
    {
      "content": "Note that this command also works for directories.",
      "pos": [
        14955,
        15005
      ]
    },
    {
      "content": "The -R option changes the permissions for all files and directories inside of the directory.",
      "pos": [
        15006,
        15098
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        15099,
        15118
      ]
    },
    {
      "content": "This command changes ownership (both user and group) for all files and directories inside of directory and directory itself.",
      "pos": [
        15176,
        15300
      ]
    },
    {
      "content": "The following command only changes the permission of the folder directory but leaves the files and folders inside the directory alone.",
      "pos": [
        15308,
        15442
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"How to Set Up Tomcat7 on a Linux Virtual Machine with Microsoft Azure\" \n    description=\"Learn how to set up Tomcat7 with Microsoft Azure using an Azure virtual machine (VM) running Linux.\" \n    services=\"virtual-machines\" \n    documentationCenter=\"\" \n    authors=\"NingKuang\" \n    manager=\"timlt\" \n    editor=\"tysonn\"/>\n\n<tags \n    ms.service=\"virtual-machines\" \n    ms.workload=\"infrastructure-services\" \n    ms.tgt_pltfrm=\"vm-linux\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"05/21/2015\" \n    ms.author=\"ningk\"/>\n\n#How to Set Up Tomcat7 on a Linux Virtual Machine with Microsoft Azure \n\nApache Tomcat (or simply Tomcat, formerly also Jakarta Tomcat) is an open source web server and servlet container developed by the Apache Software Foundation (ASF). Tomcat implements the Java Servlet and the JavaServer Pages (JSP) specifications from Sun Microsystems, and provides a pure Java HTTP web server environment in which to run Java code. In the simplest configuration, Tomcat runs in a single operating system process. This process runs a Java virtual machine (JVM). Every HTTP request from a browser to Tomcat is processed as a separate thread in the Tomcat process.  \n\nIn this guide, you will install tomcat7 on a Linux image and deploy it in Microsoft Azure.  \n\nYou will learn:  \n\n-   How to create a virtual machine in Azure.\n-   How to prepare the virtual machine for tomcat7.\n-   How to install tomcat7.\n\nIt is assumed that the reader already has an Azure subscription.  If not you can sign up for a free trial at [http://azure.microsoft.com](http://azure.microsoft.com). If you have an MSDN subscription, see [Microsoft Azure Special Pricing: MSDN, MPN, and Bizspark Benefits](http://azure.microsoft.com/pricing/member-offers/msdn-benefits/?c=14-39). To learn more about Azure, see [What is Azure?](http://azure.microsoft.com/overview/what-is-azure/).\n\nThis topic assumes that you have basic working knowledge of tomcat and Linux.  \n\n##Phase 1: Create an image\nIn this phase, you will create a virtual machine using a Linux image in Azure.  \n\n###Step 1: Generate an SSH Authentication Key\nSSH is an important tool for system administrators. However, configuring access security based on a human-determined password is not a best practice. Malicious users can break into your system based on a user name and a weak password.\n\nThe good news is that there is a way to leave remote access open and have not to worry about passwords. The method consists of authentication with asymmetric cryptography. The user’s private key is the one that grants the authentication. You can even lock the user’s account to disallow password authentication completely. \n\nAnother advantage of this method is that you do not need different passwords to log on to different servers. You can authenticate using the personal private key on all servers, which prevents you from having to remember several passwords. \n\nIt is also possible to login with requiring a password with this method.\n\nFollow these steps to generate the SSH authentication key.\n\n1.  Download and install puttygen from the following location: [http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html](http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html) \n2.  Run PUTTYGEN.EXE.\n3.  Click **Generate** to generate the keys. In the process you can increase randomness by moving the mouse over the blank area in the window.  \n![][1]\n4.  After the generate process, Puttygen.exe will show your generated key. For example:  \n![][2]\n5.  Select and copy the public key in **Key** and save it in a file named publicKey.pem. Don’t click **Save public key**, because the saved public key’s file format is different from the public key we want.\n6.  Click **Save private key** and save it in a file named privateKey.ppk. \n\n###Step 2: Create the image in the Azure Preview Portal.\nIn the [Azure Preview Portal](https://portal.azure.com/), click **New** in the task bar to create an image, choosing the Linux image based on your needs. The following example uses the Ubuntu 14.04 image. \n![][3]\n \nFor **Host Name** specify the name for the URL that you and Internet clients will use to access this virtual machine. Define the last part of the DNS name, for example tomcatdemo, and Azure will generate the URL as tomcatdemo.cloudapp.net.  \n\nFor **SSH Authentication Key**, copy the key value from the **publicKey.pem** file, which contains the public key generated by puttygen.  \n![][4]\n  \nConfigure other settings as needed, and then click Create.  \n\n##Phase 2: Prepare your virtual machine for Tomcat7\nIn this phase, you will configure an endpoint for tomcat traffic and then connect to your new virtual machine.\n###Step 1: Open the HTTP port to allow web access\nEndpoints in Azure consist of a protocol (TCP or UDP), along with a public and private port. The private port is the port that the service is listening on the virtual machine. The public port is the port that the Azure cloud service is listening on externally for incoming, Internet-based traffic.  \n\nTCP port 8080 is the default port number on which tomcat listens. Opening this port with an Azure endpoint will allow you and other Internet clients access to tomcat pages.  \n\n1.  In the Azure Preview Portal, click **Browse** -> **Virtual Machine**, and then click the virtual machine that you created.  \n![][5]\n2.  To add an endpoint to your virtual machine, click the **Endpoints** box.\n![][6] \n3.  Click **Add**.  \n    1.  For the **endpoint**, type a name for the endpoint in Endpoint, and then type 80 in **Public Port**.  \n      \n        If you set it to 80, don’t need to include the port number in the URL that allows you to access tomcat. For example, http://tomcatdemo.cloudapp.net.    \n\n        If you set it to another value, such as 81, you need to add the port number to the URL to access tomcat. For example,  http://tomcatdemo.cloudapp.net:81/.\n    2.  Type 8080 in Private Port. By default, tomcat listens on TCP port 8080. If you changed the default listen port of tomcat, you should update Private Port to be the same as the tomcat listen port.  \n    ![][7]\n \n4.  Click **OK** to add the endpoint to your virtual machine.\n\n\n\n###Step 2: Connect to the image you created.\nYou can choose any SSH tool to connect to your virtual machine. In this example, we use Putty.  \n\nFirst, get the DNS name of your virtual machine from the Azure Preview Portal. **Click Browse** -> **Virtual machines** -> the name of your virtual machine -> **Properties**, and then look in the **Domain Name** field of the **Properties** tile.  \n\nGet the port number for SSH connections from the **SSH** field. Here is an example.  \n![][8]\n \nDownload Putty from [here](http://www.putty.org/) .  \n\nAfter downloading, click the executable file PUTTY.EXE. Configure the basic options with the host name and port number obtained from the properties of your virtual machine. Here is an example:  \n![][9]\n \nIn the left pane, click **Connection** -> **SSH** -> **Auth** and then click **Browse** to specify the location of the **privateKey.ppk** file, which contains the private key generated by puttygen in Phase 1: Create an Image. Here is an example:  \n![][10]\n \nClick **Open**. You might be alerted by a message box. If you have configured the DNS name and port number correctly, click **Yes**.\n![][11]  \n\n\nYou should see the following:  \n![][12]\n\nEnter the user name specified when you created the virtual machine in Phase 1: Create an Image. You will see something like the following:  \n![][13] \n\n\n\n\n\n##Phase 3: Install software\nIn this phase, you install the Java runtime environment, tomcat, and other tomcat components.  \n\n###Java runtime environment\nTomcat is written in Java. There are two kinds of Java Development Kits (JDKs) (OpenJDK and Oracle JDK), and you can choose the one you want.  \n\n>AZURE.NOTE: Both JDKs have almost the same code for the classes in the Java API, but the code for the virtual machine is actually different. When it comes to libraries, OpenJDK tends to use open libraries while Oracle tends to use closed ones. But Oracle JDK has more classes and some fixed bugs, and Oracle JDK is more stable than OpenJDK. \n\nThe following commands download the different JDKs.  \n\nopen-jdk   \n\n    sudo apt-get update  \n    sudo apt-get install openjdk-7-jre  \n\noracle-jdk  \n\n-   To download the JDK from the Oracle website:  \n\n        wget --header \"Cookie: oraclelicense=accept-securebackup-cookie\" http://download.oracle.com/otn-pub/java/jdk/8u5-b13/jdk-8u5-linux-x64.tar.gz  \n\n-   To create a directory to contain the JDK files:  \n\n        sudo mkdir /usr/lib/jvm  \n\n-   To extract the JDK files into the /usr/lib/jvm/ directory:  \n\n        sudo tar -zxf jdk-8u5-linux-x64.tar.gz  -C /usr/lib/jvm/  \n\n-   To set Oracle JDK as the default JVM:  \n\n        sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/jdk1.8.0_05/bin/java 100  \n        sudo update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/jdk1.8.0_05/bin/javac 100  \n\n####Test:\nYou can use a command like the following to test if the Java runtime environment is installed correctly:  \n\n    java -version  \n\nIf you installed open-jdk, you should see a message like the following:\n![][14] \n\nIf you installed oracle-jdk, you should see a message like the following:\n![][15] \n\n###Tomcat7\nUsing the following command to install tomcat7:  \n\n    sudo apt-get install tomcat7  \n\nIf you are not using tomcat7, use the appropriate variation of this command.  \n\n####Test:\n\nTo check if tomcat7 is successfully installed, browse to your tomcat server’s DNS name (http://tomcatexample.cloudapp.net/ is the example URL in this article). If you see a page like the following, you have tomcat7 installed correct.\n![][16] \n\n\n###Install other Tomcat components\nThere are other optional tomcat components that you can also install.  \n\nUse the **sudo apt-cache search tomcat7** command to see all the available components. The following commands are examples to install some useful parts.  \n\n    sudo apt-get install tomcat7-admin      #admin web applications\n    sudo apt-get install tomcat7-user         #tools to create user instances  \n\n##Phase 4: Configure Tomcat\nIn this phase, you administer tomcat.\n###Start and stop tomcat7\nThe tomcat7 server will automatically start when you install it. You can also start it yourself with the following command:   \n\n    sudo /etc/init.d/tomcat7 start\n\nTo stop tomcat7：  \n\n    sudo /etc/init.d/tomcat7 stop \n\nTo view the status of tomcat7：  \n\n    sudo /etc/init.d/tomcat7 status\n\nTo restart tomcat services：  \n\n    sudo /etc/init.d/tomcat7 restart\n\n###Tomcat administration\nYou can edit the Tomcat user configuration file to setup your admin credentials with the following command:  \n\n    sudo vi  /etc/tomcat7/tomcat-users.xml   \n\nHere is an example:  \n![][17]  \n\n>AZURE.NOTE: Create a strong password for the admin user name.  \n\nAfter editing this file, you should restart tomcat7 services with the following command to ensure that the changes take effect:  \n\n    sudo /etc/init.d/tomcat7 restart  \n\nOpen your browser, and enter the URL **http://<your tomcat server DNS name>/manager/html**. For the example in this article, the URL is http://tomcatexample.cloudapp.net/manager/html.  \n\nAfter connecting, you should see something similar to the following:  \n![][18]\n \n##Common issues\n\n###Can't access the virtual machine with Tomcat and Moodle from the Internet\n\n-   **Symptom**  \nTomcat is running but you can’t see the Tomcat default page with your browser.\n-   **Possible root case**   \n    1.  The tomcat listen port is not same as the Private Port of your virtual machine's endpoint for tomcat traffic.  \n    \n        Check your Public Port and Private Port endpoint settings and make sure the Private Port is same as the tomcat listen port. See Phase 1: Create an Image for instructions on configuring endpoints for your virtual machine.  \n\n        To determine the tomcat listen port, open /etc/httpd/conf/httpd.conf (Red Hat release) or /etc/tomcat7/server.xml (Debian release). By default, the tomcat listen port is 8080. Here is an example:  \n\n            <Connector port=\"8080\" protocol=\"HTTP/1.1\"  connectionTimeout=\"20000\"  URIEncoding=\"UTF-8\"            redirectPort=\"8443\" />  \n\n        If you are using a virtual machine like Debian or Ubuntu and you want to change the default port of Tomcat Listen (for example 8081), you should also open the port for the OS. First, open the Profile:  \n\n            sudo vi /etc/default/tomcat7  \n\n        Then uncomment the last line and change “no” to “yes”.  \n\n            AUTHBIND=yes\n\n    2.  The firewall has disabled the listen port of tomcat.\n\n        If you can only see the Tomcat default page from the local host, then the problem is most likely that the port which is listened by tomcat is blocked by the firewall. You can use the w3m tool to browse the web page. The following commands install w3m and browse to the Tomcat default page:  \n\n            sudo yum  install w3m w3m-img\n            w3m http://localhost:8080  \n\n-   **Solution** \n    1. If the tomcat listen port is not same as the Private Port of the endpoint for traffic to the virtual machine, you need change the Private Port to be the same as the tomcat listen port.   \n    \n    2.  If the issue is caused by the firewall/iptables, add the following lines to /etc/sysconfig/iptables:  \n    \n            -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT\n            -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT  \n\n        Note that the second line is only needed for https traffic.  \n\n        Make sure this is above any lines that would globally restrict access, such as the following:  \n\n            -A INPUT -j REJECT --reject-with icmp-host-prohibited  \n\n        To reload the iptables, run the following command:  \n\n            service iptables restart  \n\n        This has been tested on CentOS 6.3.\n\n###Permission denied when upload you project files to /var/lib/tomcat7/webapps/  \n\n-   **Symptom**  \nWhen you use any SFTP client (such as FileZilla) to connect to your virtual machine and navigate to /var/lib/tomcat7/webapps/ to publish your site, you get an error message similar to the following:  \n\n        status: Listing directory /var/lib/tomcat7/webapps\n        Command:    put \"C:\\Users\\liang\\Desktop\\info.jsp\" \"info.jsp\"\n        Error:  /var/lib/tomcat7/webapps/info.jsp: open for write: permission denied\n        Error:  File transfer failed\n\n-   **Possible root case** \nYou have no permissions to access the /var/lib/tomcat7/webapps folder.  \n-   **Solution**  \nYou need get permission from the root account. You can change the ownership of that folder from root to the username you used when provisioning the machine. Here is an example with the azureuser account name:  \n\n        sudo chown azureuser -R /var/lib/tomcat7/webapps\n\n    Use the -R option to apply the permissions for all files inside of a directory too.  \n\n    Note that this command also works for directories. The -R option changes the permissions for all files and directories inside of the directory. Here is an example:  \n\n        sudo chown -R username:group directory  \n\n    This command changes ownership (both user and group) for all files and directories inside of directory and directory itself.  \n\n    The following command only changes the permission of the folder directory but leaves the files and folders inside the directory alone.  \n\n        sudo chown username:group directory\n\n\n\n[1]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-01.png\n[2]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-02.png\n[3]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-03.png\n[4]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-04.png\n[5]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-05.png\n[6]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-06.png\n[7]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-07.png\n[8]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-08.png\n[9]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-09.png\n[10]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-10.png\n[11]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-11.png\n[12]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-12.png\n[13]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-13.png\n[14]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-14.png\n[15]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-15.png\n[16]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-16.png\n[17]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-17.png\n[18]: ./media/virtual-machines-linux-setup-tomcat7-linux/virtual-machines-linux-setup-tomcat7-linux-18.png\n "
}