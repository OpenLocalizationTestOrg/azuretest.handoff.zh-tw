{
  "nodes": [
    {
      "content": "Get started configuring your Internet-facing load balancer | Microsoft Azure",
      "pos": [
        27,
        103
      ]
    },
    {
      "content": "Set up your first Internet-facing load balancer for your virtual machines or cloud services.",
      "pos": [
        121,
        213
      ]
    },
    {
      "content": "Get started configuring your Internet-facing load balancer",
      "pos": [
        531,
        589
      ]
    },
    {
      "content": "[AZURE.SELECTOR]",
      "pos": [
        593,
        609
      ]
    },
    {
      "content": "Azure classic steps",
      "pos": [
        613,
        632
      ]
    },
    {
      "content": "Resource Manager Powershell steps",
      "pos": [
        675,
        708
      ]
    },
    {
      "content": "Load balancing services in Microsoft Azure work with all the tenant types (IaaS or PaaS) and all supported operating systems (Windows or any supported Linux-based operating system).",
      "pos": [
        744,
        925
      ]
    },
    {
      "content": "Set up an Internet-facing load balancer for virtual machines",
      "pos": [
        931,
        991
      ]
    },
    {
      "content": "In order to load balance network traffic from the Internet across the virtual machines of a cloud service, you must create a load-balanced set.",
      "pos": [
        993,
        1136
      ]
    },
    {
      "content": "This procedure assumes that you have already created the virtual machines and that they are all within the same cloud service.",
      "pos": [
        1137,
        1263
      ]
    },
    {
      "content": "To configure a load-balanced set for virtual machines",
      "pos": [
        1267,
        1320
      ]
    },
    {
      "pos": [
        1327,
        1446
      ],
      "content": "In the Azure portal, click <bpt id=\"p1\">**</bpt>Virtual Machines<ept id=\"p1\">**</ept>, and then click the name of a virtual machine in the load-balanced set."
    },
    {
      "pos": [
        1451,
        1495
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Endpoints<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        1501,
        1577
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Add an endpoint to a virtual machine<ept id=\"p1\">**</ept> page, click the right arrow."
    },
    {
      "pos": [
        1583,
        1635
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Specify the details of the endpoint<ept id=\"p1\">**</ept> page:"
    },
    {
      "pos": [
        1642,
        1762
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept>, type a name for the endpoint or select the name from the list of predefined endpoints for common protocols."
    },
    {
      "pos": [
        1770,
        1870
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Protocol<ept id=\"p1\">**</ept>, select the protocol required by the type of endpoint, either TCP or UDP, as needed."
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Public Port and Private Port<ept id=\"p1\">**</ept>, type the port numbers that you want the virtual machine to use, as needed.",
      "pos": [
        1878,
        1989
      ]
    },
    {
      "content": "You can use the private port and firewall rules on the virtual machine to redirect traffic in a way that is appropriate for your application.",
      "pos": [
        1990,
        2131
      ]
    },
    {
      "content": "The private port can be the same as the public port.",
      "pos": [
        2132,
        2184
      ]
    },
    {
      "content": "For example, for an endpoint for web (HTTP) traffic, you could assign port 80 to both the public and private port.",
      "pos": [
        2185,
        2299
      ]
    },
    {
      "pos": [
        2305,
        2375
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Create a load-balanced set<ept id=\"p1\">**</ept>, and then click the right arrow."
    },
    {
      "content": "On the <bpt id=\"p1\">**</bpt>Configure the load-balanced set<ept id=\"p1\">**</ept> page, type a name for the load-balanced set, and then assign the values for probe behavior of the Azure Load Balancer.",
      "pos": [
        2381,
        2542
      ]
    },
    {
      "content": "The Load Balancer uses probes to determine if the virtual machines in the load-balanced set are available to receive incoming traffic.",
      "pos": [
        2543,
        2677
      ]
    },
    {
      "content": "Click the check mark to create the load-balanced endpoint.",
      "pos": [
        2683,
        2741
      ]
    },
    {
      "content": "You will see <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Load-balanced set name<ept id=\"p2\">**</ept> column of the <bpt id=\"p3\">**</bpt>Endpoints<ept id=\"p3\">**</ept> page for the virtual machine.",
      "pos": [
        2742,
        2854
      ]
    },
    {
      "pos": [
        2860,
        3021
      ],
      "content": "In the portal, click <bpt id=\"p1\">**</bpt>Virtual Machines<ept id=\"p1\">**</ept>, click the name of an additional virtual machine in the load-balanced set, click <bpt id=\"p2\">**</bpt>Endpoints<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        3027,
        3211
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Add an endpoint to a virtual machine<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Add endpoint to an existing load-balanced set<ept id=\"p2\">**</ept>, select the name of the load-balanced set, and then click the right arrow."
    },
    {
      "content": "On the <bpt id=\"p1\">**</bpt>Specify the details of the endpoint<ept id=\"p1\">**</ept> page, type a name for the endpoint, and then click the check mark.",
      "pos": [
        3217,
        3330
      ]
    },
    {
      "content": "For the additional virtual machines in the load-balanced set, repeat steps 8-10.",
      "pos": [
        3331,
        3411
      ]
    },
    {
      "content": "You can also configure endpoints with the following Windows PowerShell cmdlets:",
      "pos": [
        3413,
        3492
      ]
    },
    {
      "content": "Add-AzureEndpoint",
      "pos": [
        3496,
        3513
      ]
    },
    {
      "content": "Add-AzureEndpoint",
      "pos": [
        3516,
        3533
      ]
    },
    {
      "content": "Get-AzureEndpoint",
      "pos": [
        3596,
        3613
      ]
    },
    {
      "content": "Get-AzureEndpoint",
      "pos": [
        3616,
        3633
      ]
    },
    {
      "content": "Remove-AzureEndpoint",
      "pos": [
        3696,
        3716
      ]
    },
    {
      "content": "Remove-AzureEndpoint",
      "pos": [
        3719,
        3739
      ]
    },
    {
      "content": "Set up an Internet-facing load balancer for cloud services",
      "pos": [
        3804,
        3862
      ]
    },
    {
      "content": "Cloud services are automatically configured with a load balancer and can be customized via the service model.",
      "pos": [
        3865,
        3974
      ]
    },
    {
      "content": "You can leverage the Azure SDK for .NET 2.5 to update your cloud service.",
      "pos": [
        3976,
        4049
      ]
    },
    {
      "content": "Endpoint settings for cloud services are made in the <bpt id=\"p1\">[</bpt>service definition<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/gg557553.aspx)</ept>.csdef file.",
      "pos": [
        4050,
        4191
      ]
    },
    {
      "content": "The following example shows how a servicedefinition.csdef file for a cloud deployment is configured:",
      "pos": [
        4193,
        4293
      ]
    },
    {
      "content": "Checking the snipet for the .csdef file generated by a cloud deployment, you can see the external endpoint configured to use ports HTTP on port 10000, 10001, and 10002.",
      "pos": [
        4295,
        4463
      ]
    },
    {
      "content": "Check load balancer health status for cloud services",
      "pos": [
        5283,
        5335
      ]
    },
    {
      "content": "The following is an example of a health probe:",
      "pos": [
        5338,
        5384
      ]
    },
    {
      "content": "The load balancer combines the information of the endpoint and the information of the probe to create a URL in the form of http://{DIP of VM}:80/Probe.aspx that can be used to query the health of the service.",
      "pos": [
        5570,
        5778
      ]
    },
    {
      "content": "The service detects periodic probes from the same IP address.",
      "pos": [
        5780,
        5841
      ]
    },
    {
      "content": "This is the health probe request coming from the host of the node where the virtual machine is running.",
      "pos": [
        5842,
        5945
      ]
    },
    {
      "content": "The service has to respond with a HTTP 200 status code for the load balancer to assume that the service is healthy.",
      "pos": [
        5946,
        6061
      ]
    },
    {
      "content": "Any other HTTP status code (for example 503) directly takes the virtual machine out of rotation.",
      "pos": [
        6062,
        6158
      ]
    },
    {
      "content": "The probe definition also controls the frequency of the probe.",
      "pos": [
        6160,
        6222
      ]
    },
    {
      "content": "In our case above, the load balancer is probing the endpoint every 5 secs.",
      "pos": [
        6223,
        6297
      ]
    },
    {
      "content": "If no positive answer is received for 10 secs (two probe intervals), the probe is assumed down, and the virtual machine is taken out of rotation.",
      "pos": [
        6298,
        6443
      ]
    },
    {
      "content": "Similarly, if the service is out of rotation and a positive answer is received, the service is put back to rotation right away.",
      "pos": [
        6444,
        6571
      ]
    },
    {
      "content": "If the service is fluctuating between healthy and unhealthy, the load balancer can decide to delay the re-introduction of the service back to rotation until it has been healthy for a number of probes.",
      "pos": [
        6572,
        6772
      ]
    },
    {
      "pos": [
        6774,
        6910
      ],
      "content": "Check the service definition schema for the <bpt id=\"p1\">[</bpt>health probe<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/jj151530.aspx)</ept> for more information."
    },
    {
      "content": "Set up load balancer using PowerShell",
      "pos": [
        6915,
        6952
      ]
    },
    {
      "content": "After creating a virtual machine, you can use PowerShell cmdlets to add a load balancer to a virtual machine within the same cloud service.",
      "pos": [
        6954,
        7093
      ]
    },
    {
      "content": "In the example below, you will add a load balancer called \"webfarm\" to cloud service endpoint \"mycloudservice\" (or mycloudservice.cloudapp.net) and a virtual machine named myVM.",
      "pos": [
        7095,
        7272
      ]
    },
    {
      "content": "The load balancer receives traffic on port 80 and load balances the network traffic between the virtual machines on port 8080 using HTTP.",
      "pos": [
        7273,
        7410
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        7647,
        7657
      ]
    },
    {
      "content": "Get started configuring an internal load balancer",
      "pos": [
        7660,
        7709
      ]
    },
    {
      "content": "Configure a load balancer distribution mode",
      "pos": [
        7751,
        7794
      ]
    },
    {
      "content": "Configure idle TCP timeout settings for your load balancer",
      "pos": [
        7834,
        7892
      ]
    },
    {
      "content": "test",
      "pos": [
        7930,
        7934
      ]
    }
  ],
  "content": "\n<properties\n   pageTitle=\"Get started configuring your Internet-facing load balancer | Microsoft Azure\"\n   description=\"Set up your first Internet-facing load balancer for your virtual machines or cloud services. \"\n   services=\"load-balancer\"\n   documentationCenter=\"na\"\n   authors=\"joaoma\"\n   manager=\"adinah\"\n   editor=\"tysonn\" />\n<tags\n   ms.service=\"load-balancer\"\n   ms.devlang=\"na\"\n   ms.topic=\"hero-article\"\n   ms.tgt_pltfrm=\"na\"\n   ms.workload=\"infrastructure-services\"\n   ms.date=\"08/12/2015\"\n   ms.author=\"joaoma\" />\n\n# Get started configuring your Internet-facing load balancer\n\n> [AZURE.SELECTOR]\n- [Azure classic steps](load-balancer-internet-getstarted.md)\n- [Resource Manager Powershell steps](load-balancer-arm-powershell.md)\n\nLoad balancing services in Microsoft Azure work with all the tenant types (IaaS or PaaS) and all supported operating systems (Windows or any supported Linux-based operating system).\n\n\n## Set up an Internet-facing load balancer for virtual machines\n\nIn order to load balance network traffic from the Internet across the virtual machines of a cloud service, you must create a load-balanced set. This procedure assumes that you have already created the virtual machines and that they are all within the same cloud service.\n\n**To configure a load-balanced set for virtual machines**\n\n1. In the Azure portal, click **Virtual Machines**, and then click the name of a virtual machine in the load-balanced set.\n2.  Click **Endpoints**, and then click **Add**.\n\n4.  On the **Add an endpoint to a virtual machine** page, click the right arrow.\n\n4.  On the **Specify the details of the endpoint** page:\n    - In **Name**, type a name for the endpoint or select the name from the list of predefined endpoints for common protocols.\n    -  In **Protocol**, select the protocol required by the type of endpoint, either TCP or UDP, as needed.\n    -  In **Public Port and Private Port**, type the port numbers that you want the virtual machine to use, as needed. You can use the private port and firewall rules on the virtual machine to redirect traffic in a way that is appropriate for your application. The private port can be the same as the public port. For example, for an endpoint for web (HTTP) traffic, you could assign port 80 to both the public and private port.\n\n5.  Select **Create a load-balanced set**, and then click the right arrow.\n\n6.  On the **Configure the load-balanced set** page, type a name for the load-balanced set, and then assign the values for probe behavior of the Azure Load Balancer.\nThe Load Balancer uses probes to determine if the virtual machines in the load-balanced set are available to receive incoming traffic.\n\n7.  Click the check mark to create the load-balanced endpoint. You will see **Yes** in the **Load-balanced set name** column of the **Endpoints** page for the virtual machine.\n\n8.  In the portal, click **Virtual Machines**, click the name of an additional virtual machine in the load-balanced set, click **Endpoints**, and then click **Add**.\n\n9.  On the **Add an endpoint to a virtual machine** page, click **Add endpoint to an existing load-balanced set**, select the name of the load-balanced set, and then click the right arrow.\n\n10. On the **Specify the details of the endpoint** page, type a name for the endpoint, and then click the check mark.\nFor the additional virtual machines in the load-balanced set, repeat steps 8-10.\n\nYou can also configure endpoints with the following Windows PowerShell cmdlets:\n\n- Add-AzureEndpoint\n\n[Add-AzureEndpoint](https://msdn.microsoft.com/library/windowsazure/dn495300)\n\n- Get-AzureEndpoint\n\n[Get-AzureEndpoint](https://msdn.microsoft.com/library/windowsazure/dn495158)\n\n- Remove-AzureEndpoint\n\n[Remove-AzureEndpoint](https://msdn.microsoft.com/library/windowsazure/dn495161)\n\n\n## Set up an Internet-facing load balancer for cloud services\n\n\nCloud services are automatically configured with a load balancer and can be customized via the service model.\n\nYou can leverage the Azure SDK for .NET 2.5 to update your cloud service. Endpoint settings for cloud services are made in the [service definition](https://msdn.microsoft.com/library/azure/gg557553.aspx).csdef file.\n\nThe following example shows how a servicedefinition.csdef file for a cloud deployment is configured:\n\nChecking the snipet for the .csdef file generated by a cloud deployment, you can see the external endpoint configured to use ports HTTP on port 10000, 10001, and 10002.\n\n\n    <ServiceDefinition name=“Tenant“>\n    <WorkerRole name=“FERole” vmsize=“Small“>\n    <Endpoints>\n        <InputEndpoint name=“FE_External_Http” protocol=“http” port=“10000“ />\n        <InputEndpoint name=“FE_External_Tcp“  protocol=“tcp“  port=“10001“ />\n        <InputEndpoint name=“FE_External_Udp“  protocol=“udp“  port=“10002“ />\n\n        <InputEndpointname=“HTTP_Probe” protocol=“http” port=“80” loadBalancerProbe=“MyProbe“ />\n\n        <InstanceInputEndpoint name=“InstanceEP” protocol=“tcp” localPort=“80“>\n           <AllocatePublicPortFrom>\n              <FixedPortRange min=“10110” max=“10120“  />\n           </AllocatePublicPortFrom>\n        </InstanceInputEndpoint>\n        <InternalEndpoint name=“FE_InternalEP_Tcp” protocol=“tcp“ />\n    </Endpoints>\n    </WorkerRole>\n    </ServiceDefinition>\n\n\n\n\n### Check load balancer health status for cloud services\n\n\nThe following is an example of a health probe:\n\n        <LoadBalancerProbes>\n        <LoadBalancerProbe name=“MyProbe” protocol=“http” path=“Probe.aspx” intervalInSeconds=“5” timeoutInSeconds=“100“ />\n        </LoadBalancerProbes>\n\nThe load balancer combines the information of the endpoint and the information of the probe to create a URL in the form of http://{DIP of VM}:80/Probe.aspx that can be used to query the health of the service.\n\nThe service detects periodic probes from the same IP address. This is the health probe request coming from the host of the node where the virtual machine is running.\nThe service has to respond with a HTTP 200 status code for the load balancer to assume that the service is healthy. Any other HTTP status code (for example 503) directly takes the virtual machine out of rotation.\n\nThe probe definition also controls the frequency of the probe. In our case above, the load balancer is probing the endpoint every 5 secs. If no positive answer is received for 10 secs (two probe intervals), the probe is assumed down, and the virtual machine is taken out of rotation. Similarly, if the service is out of rotation and a positive answer is received, the service is put back to rotation right away. If the service is fluctuating between healthy and unhealthy, the load balancer can decide to delay the re-introduction of the service back to rotation until it has been healthy for a number of probes.\n\nCheck the service definition schema for the [health probe](https://msdn.microsoft.com/library/azure/jj151530.aspx) for more information.\n\n## Set up load balancer using PowerShell\n\nAfter creating a virtual machine, you can use PowerShell cmdlets to add a load balancer to a virtual machine within the same cloud service.\n\nIn the example below, you will add a load balancer called \"webfarm\" to cloud service endpoint \"mycloudservice\" (or mycloudservice.cloudapp.net) and a virtual machine named myVM. The load balancer receives traffic on port 80 and load balances the network traffic between the virtual machines on port 8080 using HTTP.\n\n    Get-AzureVM -ServiceName \"mycloudservice\" -Name \"MyVM\" | Add-AzureEndpoint -Name \"HttpIn\" -Protocol \"tcp\" -PublicPort 80 -LocalPort 8080 -LBSetName \"WebFarm\" -ProbePort 80 -ProbeProtocol \"http\" -ProbePath '/' | Update-AzureVM\n\n\n## Next steps\n\n[Get started configuring an internal load balancer](load-balancer-internal-getstarted.md)\n\n[Configure a load balancer distribution mode](load-balancer-distribution-mode.md)\n\n[Configure idle TCP timeout settings for your load balancer](load-balancer-tcp-idle-timeout.md)\n\ntest\n"
}