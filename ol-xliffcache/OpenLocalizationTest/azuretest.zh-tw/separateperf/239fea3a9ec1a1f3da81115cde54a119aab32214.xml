{
  "nodes": [
    {
      "content": "Forecasting - ETS + STL  | Microsoft Azure",
      "pos": [
        28,
        70
      ]
    },
    {
      "content": "Forecasting - ETS + STL",
      "pos": [
        90,
        113
      ]
    },
    {
      "content": "Forecasting - ETS + STL",
      "pos": [
        450,
        473
      ]
    },
    {
      "content": "This <bpt id=\"p1\">[</bpt>web service<ept id=\"p1\">]( https://datamarket.azure.com/dataset/aml_labs/demand_forecast)</ept> implements Seasonal Trend Decomposition (STL) and Exponential Smoothing (ETS) models to produce predictions based on the historical data provided by the user.",
      "pos": [
        477,
        718
      ]
    },
    {
      "content": "Will the demand for a specific product increase this year?",
      "pos": [
        719,
        777
      ]
    },
    {
      "content": "Can I predict my product sales for the Christmas season, so that I can effectively plan my inventory?",
      "pos": [
        778,
        879
      ]
    },
    {
      "content": "Forecasting models are apt to address such questions.",
      "pos": [
        880,
        933
      ]
    },
    {
      "content": "Given the past data, these models examine hidden trends and seasonality to predict future trends.",
      "pos": [
        934,
        1031
      ]
    },
    {
      "content": "This web service could be consumed by users – potentially through a mobile app, through a website, or even on a local computer, for example.",
      "pos": [
        1132,
        1272
      ]
    },
    {
      "content": "But the purpose of the web service is also to serve as an example of how Azure Machine Learning can be used to create web services on top of R code.",
      "pos": [
        1273,
        1421
      ]
    },
    {
      "content": "With just a few lines of R code and clicks of a button within Azure Machine Learning Studio, an experiment can be created with R code and published as a web service.",
      "pos": [
        1422,
        1587
      ]
    },
    {
      "content": "The web service can then be published to the Azure Marketplace and consumed by users and devices across the world with no infrastructure setup by the author of the web service.",
      "pos": [
        1588,
        1764
      ]
    },
    {
      "content": "Consumption of web service",
      "pos": [
        1771,
        1797
      ]
    },
    {
      "content": "This service accepts 4 arguments and calculates the forecasts.",
      "pos": [
        1800,
        1862
      ]
    },
    {
      "content": "The input arguments are:",
      "pos": [
        1863,
        1887
      ]
    },
    {
      "content": "Frequency - Indicates the frequency of the raw data (daily/weekly/monthly/quarterly/yearly).",
      "pos": [
        1891,
        1983
      ]
    },
    {
      "content": "Horizon - Future forecast time-frame.",
      "pos": [
        1986,
        2023
      ]
    },
    {
      "content": "Date - Add in the new time series data for time.",
      "pos": [
        2026,
        2074
      ]
    },
    {
      "content": "Value - Add in the new time series data values.",
      "pos": [
        2077,
        2124
      ]
    },
    {
      "content": "The output of the service is the calculated forecast values.",
      "pos": [
        2126,
        2186
      ]
    },
    {
      "content": "Sample input could be:",
      "pos": [
        2189,
        2211
      ]
    },
    {
      "content": "Frequency - 12",
      "pos": [
        2216,
        2230
      ]
    },
    {
      "content": "Horizon - 12",
      "pos": [
        2233,
        2245
      ]
    },
    {
      "content": "Date - 1/15/2012;2/15/2012;3/15/2012;4/15/2012;5/15/2012;6/15/2012;7/15/2012;8/15/2012;9/15/2012;10/15/2012;11/15/2012;12/15/2012;",
      "pos": [
        2248,
        2378
      ]
    },
    {
      "content": "1/15/2013;2/15/2013;3/15/2013;4/15/2013;5/15/2013;6/15/2013;7/15/2013;8/15/2013;9/15/2013;10/15/2013;11/15/2013;12/15/2013;",
      "pos": [
        2379,
        2502
      ]
    },
    {
      "content": "1/15/2014;2/15/2014;3/15/2014;4/15/2014;5/15/2014;6/15/2014;7/15/2014;8/15/2014;9/15/2014",
      "pos": [
        2503,
        2592
      ]
    },
    {
      "content": "Value - 3.479;3.68;3.832;3.941;3.797;3.586;3.508;3.731;3.915;3.844;3.634;3.549;3.557;3.785;3.782;3.601;3.544;3.556;3.65;3.709;3.682;3.511;",
      "pos": [
        2595,
        2733
      ]
    },
    {
      "content": "3.429;3.51;3.523;3.525;3.626;3.695;3.711;3.711;3.693;3.571;3.509",
      "pos": [
        2734,
        2798
      ]
    },
    {
      "content": "This service, as hosted on the Azure Marketplace, is an OData service; these may be called through POST or GET methods.",
      "pos": [
        2801,
        2920
      ]
    },
    {
      "pos": [
        2923,
        3103
      ],
      "content": "There are multiple ways of consuming the service in an automated fashion (an example app is <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](http://microsoftazuremachinelearning.azurewebsites.net/StlEtsForecasting.aspx )</ept>)."
    },
    {
      "content": "Starting C# code for web service consumption:",
      "pos": [
        3108,
        3153
      ]
    },
    {
      "content": "Creation of web service",
      "pos": [
        4440,
        4463
      ]
    },
    {
      "content": "This web service was created using Azure Machine Learning.",
      "pos": [
        4467,
        4525
      ]
    },
    {
      "content": "For a free trial, as well as introductory videos on creating experiments and <bpt id=\"p1\">[</bpt>publishing web services<ept id=\"p1\">](machine-learning-publish-a-machine-learning-web-service.md)</ept>, please see <bpt id=\"p2\">[</bpt>azure.com/ml<ept id=\"p2\">](http://azure.com/ml)</ept>.",
      "pos": [
        4526,
        4737
      ]
    },
    {
      "content": "Below is a screenshot of the experiment that created the web service and example code for each of the modules within the experiment.",
      "pos": [
        4738,
        4870
      ]
    },
    {
      "content": "From within Azure Machine Learning, a new blank experiment was created.",
      "pos": [
        4872,
        4943
      ]
    },
    {
      "content": "Sample input data was uploaded with a predefined data schema.",
      "pos": [
        4944,
        5005
      ]
    },
    {
      "content": "Linked to the data schema is an [Execute R Script][execute-r-script] module, which generates STL and ETS forecasting models by using ‘stl’, ‘ets’, and ‘forecast’ functions from R.",
      "pos": [
        5006,
        5185
      ]
    },
    {
      "content": "Experiment flow:",
      "pos": [
        5191,
        5207
      ]
    },
    {
      "content": "Experiment flow",
      "pos": [
        5211,
        5226
      ]
    },
    {
      "content": "Module 1:",
      "pos": [
        5236,
        5245
      ]
    },
    {
      "content": "Sample data",
      "pos": [
        5317,
        5328
      ]
    },
    {
      "content": "Module 2:",
      "pos": [
        5341,
        5350
      ]
    },
    {
      "content": "Limitations",
      "pos": [
        6202,
        6213
      ]
    },
    {
      "content": "This is a very simple example for ETS + STL forecasting.",
      "pos": [
        6216,
        6272
      ]
    },
    {
      "content": "As can be seen from the example code above, no error catching is implemented, and the service assumes that all the variables are continuous/positive values and the frequency should be an integer greater than 1.",
      "pos": [
        6273,
        6483
      ]
    },
    {
      "content": "The length of the date and value vectors should be the same, and the length of the time series should be greater than 2*frequency.",
      "pos": [
        6484,
        6614
      ]
    },
    {
      "content": "The date variable should adhere to the format ‘mm/dd/yyyy’.",
      "pos": [
        6615,
        6674
      ]
    },
    {
      "content": "FAQ",
      "pos": [
        6678,
        6681
      ]
    },
    {
      "content": "For frequently asked questions on consumption of the web service or publishing to the Azure Marketplace, see <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](machine-learning-marketplace-faq.md)</ept>.",
      "pos": [
        6682,
        6835
      ]
    },
    {
      "content": "test",
      "pos": [
        7211,
        7215
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Forecasting - ETS + STL  | Microsoft Azure\" \n    description=\"Forecasting - ETS + STL\" \n    services=\"machine-learning\" \n    documentationCenter=\"\" \n    authors=\"jaymathe\" \n    manager=\"paulettm\" \n    editor=\"cgronlun\"/>\n\n<tags \n    ms.service=\"machine-learning\" \n    ms.workload=\"data-services\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"09/02/2015\" \n    ms.author=\"jaymathe\"/> \n\n#Forecasting - ETS + STL  \n\nThis [web service]( https://datamarket.azure.com/dataset/aml_labs/demand_forecast) implements Seasonal Trend Decomposition (STL) and Exponential Smoothing (ETS) models to produce predictions based on the historical data provided by the user. Will the demand for a specific product increase this year? Can I predict my product sales for the Christmas season, so that I can effectively plan my inventory? Forecasting models are apt to address such questions. Given the past data, these models examine hidden trends and seasonality to predict future trends. \n\n\n[AZURE.INCLUDE [machine-learning-free-trial](../../includes/machine-learning-free-trial.md)] \n \n>This web service could be consumed by users – potentially through a mobile app, through a website, or even on a local computer, for example. But the purpose of the web service is also to serve as an example of how Azure Machine Learning can be used to create web services on top of R code. With just a few lines of R code and clicks of a button within Azure Machine Learning Studio, an experiment can be created with R code and published as a web service. The web service can then be published to the Azure Marketplace and consumed by users and devices across the world with no infrastructure setup by the author of the web service.  \n \n##Consumption of web service \n\nThis service accepts 4 arguments and calculates the forecasts.\nThe input arguments are:\n\n* Frequency - Indicates the frequency of the raw data (daily/weekly/monthly/quarterly/yearly).\n* Horizon - Future forecast time-frame.\n* Date - Add in the new time series data for time.\n* Value - Add in the new time series data values.\n\nThe output of the service is the calculated forecast values.\n \nSample input could be: \n\n* Frequency - 12\n* Horizon - 12\n* Date - 1/15/2012;2/15/2012;3/15/2012;4/15/2012;5/15/2012;6/15/2012;7/15/2012;8/15/2012;9/15/2012;10/15/2012;11/15/2012;12/15/2012;\n1/15/2013;2/15/2013;3/15/2013;4/15/2013;5/15/2013;6/15/2013;7/15/2013;8/15/2013;9/15/2013;10/15/2013;11/15/2013;12/15/2013;\n1/15/2014;2/15/2014;3/15/2014;4/15/2014;5/15/2014;6/15/2014;7/15/2014;8/15/2014;9/15/2014\n* Value - 3.479;3.68;3.832;3.941;3.797;3.586;3.508;3.731;3.915;3.844;3.634;3.549;3.557;3.785;3.782;3.601;3.544;3.556;3.65;3.709;3.682;3.511;\n3.429;3.51;3.523;3.525;3.626;3.695;3.711;3.711;3.693;3.571;3.509\n\n>This service, as hosted on the Azure Marketplace, is an OData service; these may be called through POST or GET methods. \n\nThere are multiple ways of consuming the service in an automated fashion (an example app is [here](http://microsoftazuremachinelearning.azurewebsites.net/StlEtsForecasting.aspx )).\n\n###Starting C# code for web service consumption:\n\n    public class Input\n    {\n            public string frequency;\n            public string horizon;\n            public string date;\n            public string value;\n    }\n    \n    public AuthenticationHeaderValue CreateBasicHeader(string username, string password)\n    {\n            byte[] byteArray = System.Text.Encoding.UTF8.GetBytes(username + \":\" + password);\n            return new AuthenticationHeaderValue(\"Basic\", Convert.ToBase64String(byteArray));\n    }\n    \n    void Main()\n    {\n            var input = new Input() { frequency = TextBox1.Text, horizon = TextBox2.Text, date = TextBox3.Text, value = TextBox4.Text };         var json = JsonConvert.SerializeObject(input);\n            var acitionUri = \"PutAPIURLHere,e.g.https://api.datamarket.azure.com/..../v1/Score\";\n            var httpClient = new HttpClient();\n    \n            httpClient.DefaultRequestHeaders.Authorization = CreateBasicHeader(\"PutEmailAddressHere\", \"ChangeToAPIKey\");\n            httpClient.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue(\"application/json\"));\n    \n            var response = httpClient.PostAsync(acitionUri, new StringContent(json));\n            var result = response.Result.Content;\n            var scoreResult = result.ReadAsStringAsync().Result;\n    }\n\n\n##Creation of web service \n\n>This web service was created using Azure Machine Learning. For a free trial, as well as introductory videos on creating experiments and [publishing web services](machine-learning-publish-a-machine-learning-web-service.md), please see [azure.com/ml](http://azure.com/ml). Below is a screenshot of the experiment that created the web service and example code for each of the modules within the experiment.\n\nFrom within Azure Machine Learning, a new blank experiment was created. Sample input data was uploaded with a predefined data schema. Linked to the data schema is an [Execute R Script][execute-r-script] module, which generates STL and ETS forecasting models by using ‘stl’, ‘ets’, and ‘forecast’ functions from R. \n\n###Experiment flow:\n\n![Experiment flow][2]\n\n####Module 1:\n \n    # Add in the CSV file with the data in the format shown below \n![Sample data][3]   \n\n####Module 2:\n\n    # Data input\n    data <- maml.mapInputPort(1) # class: data.frame\n    library(forecast)\n    \n    # Preprocessing\n    colnames(data) <- c(\"frequency\", \"horizon\", \"dates\", \"values\")\n    dates <- strsplit(data$dates, \";\")[[1]]\n    values <- strsplit(data$values, \";\")[[1]]\n    \n    dates <- as.Date(dates, format = '%m/%d/%Y')\n    values <- as.numeric(values)\n    \n    # Fit a time series model\n    train_ts<- ts(values, frequency=data$frequency)\n    fit1 <- stl(train_ts,  s.window=\"periodic\")\n    train_model <- forecast(fit1, h = data$horizon, method = 'ets')\n    plot(train_model)\n    \n    # Produce forcasting\n    train_pred <- round(train_model$mean,2)\n    data.forecast <- as.data.frame(t(train_pred))\n    colnames(data.forecast) <- paste(\"Forecast\", 1:data$horizon, sep=\"\")\n    \n    # Data output\n    maml.mapOutputPort(\"data.forecast\");\n\n##Limitations \n\nThis is a very simple example for ETS + STL forecasting. As can be seen from the example code above, no error catching is implemented, and the service assumes that all the variables are continuous/positive values and the frequency should be an integer greater than 1. The length of the date and value vectors should be the same, and the length of the time series should be greater than 2*frequency. The date variable should adhere to the format ‘mm/dd/yyyy’.\n\n##FAQ\nFor frequently asked questions on consumption of the web service or publishing to the Azure Marketplace, see [here](machine-learning-marketplace-faq.md).\n\n[1]: ./media/machine-learning-r-csharp-retail-demand-forecasting/retail-img1.png\n[2]: ./media/machine-learning-r-csharp-retail-demand-forecasting/retail-img2.png\n[3]: ./media/machine-learning-r-csharp-retail-demand-forecasting/retail-img3.png\n\n\n<!-- Module References -->\n[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/\n \n\ntest\n"
}