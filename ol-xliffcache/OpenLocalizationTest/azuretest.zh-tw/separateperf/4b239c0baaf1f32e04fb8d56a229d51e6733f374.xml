{
  "nodes": [
    {
      "content": "Elastic Scale Security Configurations",
      "pos": [
        79,
        116
      ]
    },
    {
      "content": "Set up x409 certificates for encryption",
      "pos": [
        136,
        175
      ]
    },
    {
      "content": "Split-Merge security configuration",
      "pos": [
        533,
        567
      ]
    },
    {
      "content": "To use the Split/Merge service, you must correctly configure security.",
      "pos": [
        571,
        641
      ]
    },
    {
      "content": "The service is part of the Elastic Scale feature of Microsoft Azure SQL Database.",
      "pos": [
        642,
        723
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Elastic Scale Split and Merge Service Tutorial<ept id=\"p1\">](sql-database-elastic-scale-configure-deploy-split-and-merge.md)</ept>",
      "pos": [
        724,
        862
      ]
    },
    {
      "content": "Configuring certificates",
      "pos": [
        867,
        891
      ]
    },
    {
      "content": "Certificates are configured in two ways.",
      "pos": [
        893,
        933
      ]
    },
    {
      "content": "To Configure the SSL Certificate",
      "pos": [
        940,
        972
      ]
    },
    {
      "content": "To Configure Client Certificates",
      "pos": [
        1012,
        1044
      ]
    },
    {
      "content": "To obtain certificates",
      "pos": [
        1085,
        1107
      ]
    },
    {
      "content": "Certificates can be obtained from public Certificate Authorities (CAs) or from the <bpt id=\"p1\">[</bpt>Windows Certificate Service<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/aa376539.aspx)</ept>.",
      "pos": [
        1109,
        1287
      ]
    },
    {
      "content": "These are the preferred methods to obtain certificates.",
      "pos": [
        1288,
        1343
      ]
    },
    {
      "pos": [
        1345,
        1427
      ],
      "content": "If those options are not available, you can generate <bpt id=\"p1\">**</bpt>self-signed certificates<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Tools to generate certificates",
      "pos": [
        1433,
        1463
      ]
    },
    {
      "content": "makecert.exe",
      "pos": [
        1468,
        1480
      ]
    },
    {
      "content": "pvk2pfx.exe",
      "pos": [
        1534,
        1545
      ]
    },
    {
      "content": "To run the tools",
      "pos": [
        1618,
        1634
      ]
    },
    {
      "pos": [
        1638,
        1773
      ],
      "content": "From a Developer Command Prompt for Visual Studios, see <bpt id=\"p1\">[</bpt>Visual Studio Command Prompt<ept id=\"p1\">](http://msdn.microsoft.com/library/ms229859.aspx)</ept>"
    },
    {
      "content": "If installed, go to:",
      "pos": [
        1780,
        1800
      ]
    },
    {
      "pos": [
        1859,
        1975
      ],
      "content": "Get the WDK from <bpt id=\"p1\">[</bpt>Windows 8.1: Download kits and tools<ept id=\"p1\">](http://msdn.microsoft.com/windows/hardware/gg454513#drivers)</ept>"
    },
    {
      "content": "To configure the SSL certificate",
      "pos": [
        1980,
        2012
      ]
    },
    {
      "content": "A SSL certificate is required to encrypt the communication and authenticate the server.",
      "pos": [
        2013,
        2100
      ]
    },
    {
      "content": "Choose the most applicable of the three scenarios below, and execute all its steps:",
      "pos": [
        2101,
        2184
      ]
    },
    {
      "content": "Create a new self-signed certificate",
      "pos": [
        2190,
        2226
      ]
    },
    {
      "content": "Create a Self-Signed Certificate",
      "pos": [
        2235,
        2267
      ]
    },
    {
      "content": "Create PFX file for Self-Signed SSL Certificate",
      "pos": [
        2310,
        2357
      ]
    },
    {
      "content": "Upload SSL Certificate to Cloud Service",
      "pos": [
        2415,
        2454
      ]
    },
    {
      "content": "Update SSL Certificate in Service Configuration File",
      "pos": [
        2504,
        2556
      ]
    },
    {
      "content": "Import SSL Certification Authority",
      "pos": [
        2619,
        2653
      ]
    },
    {
      "content": "To Use an existing certificate from the certificate store",
      "pos": [
        2696,
        2753
      ]
    },
    {
      "content": "Export SSL Certificate From Certificate Store",
      "pos": [
        2758,
        2803
      ]
    },
    {
      "content": "Upload SSL Certificate to Cloud Service",
      "pos": [
        2856,
        2895
      ]
    },
    {
      "content": "Update SSL Certificate in Service Configuration File",
      "pos": [
        2942,
        2994
      ]
    },
    {
      "content": "To Use an existing certificate in a PFX file",
      "pos": [
        3055,
        3099
      ]
    },
    {
      "content": "Upload SSL Certificate to Cloud Service",
      "pos": [
        3105,
        3144
      ]
    },
    {
      "content": "Update SSL Certificate in Service Configuration File",
      "pos": [
        3191,
        3243
      ]
    },
    {
      "content": "To configure client certificates",
      "pos": [
        3303,
        3335
      ]
    },
    {
      "content": "Client certificates are required in order to authenticate requests to the service.",
      "pos": [
        3336,
        3418
      ]
    },
    {
      "content": "Choose the most applicable of the three scenarios below, and execute all its steps:",
      "pos": [
        3419,
        3502
      ]
    },
    {
      "content": "Turn off client certificates",
      "pos": [
        3508,
        3536
      ]
    },
    {
      "content": "Turn Off Client Certificate-Based Authentication",
      "pos": [
        3544,
        3592
      ]
    },
    {
      "content": "Issue new self-signed client certificates",
      "pos": [
        3649,
        3690
      ]
    },
    {
      "content": "Create a Self-Signed Certification Authority",
      "pos": [
        3698,
        3742
      ]
    },
    {
      "content": "Upload CA Certificate to Cloud Service",
      "pos": [
        3797,
        3835
      ]
    },
    {
      "content": "Update CA Certificate in Service Configuration File",
      "pos": [
        3884,
        3935
      ]
    },
    {
      "content": "Issue Client Certificates",
      "pos": [
        3997,
        4022
      ]
    },
    {
      "content": "Create PFX files for Client Certificates",
      "pos": [
        4058,
        4098
      ]
    },
    {
      "content": "Import Client Certificate",
      "pos": [
        4149,
        4174
      ]
    },
    {
      "content": "Copy Client Certificate Thumbprints",
      "pos": [
        4210,
        4245
      ]
    },
    {
      "content": "Configure Allowed Clients in the Service Configuration File",
      "pos": [
        4291,
        4350
      ]
    },
    {
      "content": "Use existing client certificates",
      "pos": [
        4418,
        4450
      ]
    },
    {
      "content": "[Find CA Public Key](Find#CA#Public Key)",
      "pos": [
        4457,
        4497
      ]
    },
    {
      "content": "Upload CA Certificate to Cloud Service",
      "pos": [
        4505,
        4543
      ]
    },
    {
      "content": "Update CA Certificate in Service Configuration File",
      "pos": [
        4592,
        4643
      ]
    },
    {
      "content": "Copy Client Certificate Thumbprints",
      "pos": [
        4705,
        4740
      ]
    },
    {
      "content": "[Configure Allowed Clients in the Service Configuration File](Configure#Allowed#Clients#in#the#Service#Configuration File)",
      "pos": [
        4785,
        4907
      ]
    },
    {
      "content": "Configure Client Certificate Revocation Check",
      "pos": [
        4915,
        4960
      ]
    },
    {
      "content": "Allowed IP addresses",
      "pos": [
        5013,
        5033
      ]
    },
    {
      "content": "Access to the service endpoints can be restricted to specific ranges of IP addresses.",
      "pos": [
        5035,
        5120
      ]
    },
    {
      "content": "To configure encryption for the store",
      "pos": [
        5125,
        5162
      ]
    },
    {
      "content": "A certificate is required to encrypt the credentials that are stored in the metadata store.",
      "pos": [
        5164,
        5255
      ]
    },
    {
      "content": "Choose the most applicable of the three scenarios below, and execute all its steps:",
      "pos": [
        5256,
        5339
      ]
    },
    {
      "content": "Use a new self-signed certificate",
      "pos": [
        5345,
        5378
      ]
    },
    {
      "content": "Create a Self-Signed Certificate",
      "pos": [
        5388,
        5420
      ]
    },
    {
      "content": "Create PFX file for Self-Signed Encryption Certificate",
      "pos": [
        5464,
        5518
      ]
    },
    {
      "content": "Upload Encryption Certificate to Cloud Service",
      "pos": [
        5584,
        5630
      ]
    },
    {
      "content": "Update Encryption Certificate in Service Configuration File",
      "pos": [
        5688,
        5747
      ]
    },
    {
      "content": "Use an existing certificate from the certificate store",
      "pos": [
        5815,
        5869
      ]
    },
    {
      "content": "Export Encryption Certificate From Certificate Store",
      "pos": [
        5879,
        5931
      ]
    },
    {
      "content": "Upload Encryption Certificate to Cloud Service",
      "pos": [
        5995,
        6041
      ]
    },
    {
      "content": "Update Encryption Certificate in Service Configuration File",
      "pos": [
        6099,
        6158
      ]
    },
    {
      "content": "Use an existing certificate in a PFX file",
      "pos": [
        6226,
        6267
      ]
    },
    {
      "content": "Upload Encryption Certificate to Cloud Service",
      "pos": [
        6277,
        6323
      ]
    },
    {
      "content": "Update Encryption Certificate in Service Configuration File",
      "pos": [
        6381,
        6440
      ]
    },
    {
      "content": "The default configuration",
      "pos": [
        6507,
        6532
      ]
    },
    {
      "content": "The default configuration denies all access to the HTTP endpoint.",
      "pos": [
        6534,
        6599
      ]
    },
    {
      "content": "This is the recommended setting, since the requests to these endpoints may carry sensitive information like database credentials.",
      "pos": [
        6600,
        6729
      ]
    },
    {
      "content": "The default configuration allows all access to the HTTPS endpoint.",
      "pos": [
        6730,
        6796
      ]
    },
    {
      "content": "This setting may be restricted further.",
      "pos": [
        6797,
        6836
      ]
    },
    {
      "content": "Changing the Configuration",
      "pos": [
        6842,
        6868
      ]
    },
    {
      "pos": [
        6870,
        7018
      ],
      "content": "The group of access control rules that apply to and endpoint are configured in the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&lt;EndpointAcls&gt;</ph><ept id=\"p1\">**</ept> section in the <bpt id=\"p2\">**</bpt>service configuration file<ept id=\"p2\">**</ept>."
    },
    {
      "content": "The rules in an access control group are configured in a",
      "pos": [
        7232,
        7288
      ]
    },
    {
      "content": "section of the service configuration file.",
      "pos": [
        7313,
        7355
      ]
    },
    {
      "content": "The format is explained in Network Access Control Lists documentation.",
      "pos": [
        7358,
        7428
      ]
    },
    {
      "content": "For example, to allow only IPs in the range 100.100.0.0 to 100.100.255.255 to access the HTTPS endpoint, the rules would look like this:",
      "pos": [
        7429,
        7565
      ]
    },
    {
      "content": "Denial of service prevention",
      "pos": [
        7907,
        7935
      ]
    },
    {
      "content": "There are two different mechanisms supported to detect and prevent Denial of Service attacks:",
      "pos": [
        7937,
        8030
      ]
    },
    {
      "content": "Restrict number of concurrent requests per remote host (off by default)",
      "pos": [
        8037,
        8108
      ]
    },
    {
      "content": "Restrict rate of access per remote host (on by default)",
      "pos": [
        8114,
        8169
      ]
    },
    {
      "content": "These are based on the features further documented in Dynamic IP Security in IIS.",
      "pos": [
        8171,
        8252
      ]
    },
    {
      "content": "When changing this configuration beware of the following factors:",
      "pos": [
        8253,
        8318
      ]
    },
    {
      "content": "The behavior of proxies and Network Address Translation devices over the remote host information",
      "pos": [
        8322,
        8418
      ]
    },
    {
      "content": "Each request to any resource in the web role is considered (e.g. loading scripts, images, etc)",
      "pos": [
        8421,
        8515
      ]
    },
    {
      "content": "Restricting number of concurrent accesses",
      "pos": [
        8520,
        8561
      ]
    },
    {
      "content": "The settings that configure this behavior are:",
      "pos": [
        8563,
        8609
      ]
    },
    {
      "content": "Change DynamicIpRestrictionDenyByConcurrentRequests to true to enable this protection.",
      "pos": [
        8770,
        8856
      ]
    },
    {
      "content": "Restricting rate of access",
      "pos": [
        8861,
        8887
      ]
    },
    {
      "content": "The settings that configure this behavior are:",
      "pos": [
        8889,
        8935
      ]
    },
    {
      "content": "Configuring the response to a denied request",
      "pos": [
        9168,
        9212
      ]
    },
    {
      "content": "The following setting configures the response to a denied request:",
      "pos": [
        9214,
        9280
      ]
    },
    {
      "content": "Refer to the documentation for Dynamic IP Security in IIS for other supported values.",
      "pos": [
        9357,
        9442
      ]
    },
    {
      "content": "Operations for configuring service certificates",
      "pos": [
        9447,
        9494
      ]
    },
    {
      "content": "This topic is for reference only.",
      "pos": [
        9495,
        9528
      ]
    },
    {
      "content": "Please follow the configuration steps outlined in:",
      "pos": [
        9529,
        9579
      ]
    },
    {
      "content": "Configure the SSL certificate",
      "pos": [
        9583,
        9612
      ]
    },
    {
      "content": "Configure client certificates",
      "pos": [
        9615,
        9644
      ]
    },
    {
      "content": "Create a self-signed certificate",
      "pos": [
        9649,
        9681
      ]
    },
    {
      "content": "Execute:",
      "pos": [
        9682,
        9690
      ]
    },
    {
      "content": "To customize:",
      "pos": [
        9883,
        9896
      ]
    },
    {
      "content": "-n with the service URL.",
      "pos": [
        9903,
        9927
      ]
    },
    {
      "content": "Wildcards (\"CN=*.cloudapp.net\") and alternative names (\"CN=myservice1.cloudapp.net, CN=myservice2.cloudapp.net\") are supported.",
      "pos": [
        9928,
        10055
      ]
    },
    {
      "content": "-e with the certificate expiration date",
      "pos": [
        10061,
        10100
      ]
    },
    {
      "content": "Create a strong password and specify it when prompted.",
      "pos": [
        10101,
        10155
      ]
    },
    {
      "content": "Create PFX file for self-signed SSL certificate",
      "pos": [
        10160,
        10207
      ]
    },
    {
      "content": "Execute:",
      "pos": [
        10209,
        10217
      ]
    },
    {
      "content": "Enter password and then export certificate with these options:",
      "pos": [
        10266,
        10328
      ]
    },
    {
      "content": "Yes, export the private key",
      "pos": [
        10331,
        10358
      ]
    },
    {
      "content": "Export all extended properties",
      "pos": [
        10361,
        10391
      ]
    },
    {
      "content": "Export SSL certificate from certificate store",
      "pos": [
        10396,
        10441
      ]
    },
    {
      "content": "Find certificate",
      "pos": [
        10445,
        10461
      ]
    },
    {
      "content": "Click Actions -&gt; All tasks -&gt; Export…",
      "pos": [
        10464,
        10501
      ]
    },
    {
      "content": "Export certificate into a .PFX file with these options:",
      "pos": [
        10504,
        10559
      ]
    },
    {
      "content": "Yes, export the private key",
      "pos": [
        10566,
        10593
      ]
    },
    {
      "pos": [
        10600,
        10698
      ],
      "content": "Include all certificates in the certification path if possible\n*Export all extended properties",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "Include all certificates in the certification path if possible",
          "pos": [
            0,
            62
          ]
        },
        {
          "content": "*Export all extended properties",
          "pos": [
            63,
            94
          ]
        }
      ]
    },
    {
      "content": "Upload SSL certificate to cloud service",
      "pos": [
        10703,
        10742
      ]
    },
    {
      "content": "Upload certificate with the existing or generated .PFX file with the SSL key pair:",
      "pos": [
        10744,
        10826
      ]
    },
    {
      "content": "Enter the password protecting the private key information",
      "pos": [
        10830,
        10887
      ]
    },
    {
      "content": "Update SSL certificate in service configuration file",
      "pos": [
        10892,
        10944
      ]
    },
    {
      "content": "Update the thumbprint value of the following setting in the service configuration file with the thumbprint of the certificate uploaded to the cloud service:",
      "pos": [
        10946,
        11102
      ]
    },
    {
      "content": "Import SSL certification authority",
      "pos": [
        11180,
        11214
      ]
    },
    {
      "content": "Follow these steps in all account/machine that will communicate with the service:",
      "pos": [
        11216,
        11297
      ]
    },
    {
      "content": "Double-click the .CER file in Windows Explorer",
      "pos": [
        11301,
        11347
      ]
    },
    {
      "content": "In the Certificate dialog, click Install Certificate…",
      "pos": [
        11350,
        11403
      ]
    },
    {
      "content": "Import certificate into the Trusted Root Certification Authorities store",
      "pos": [
        11406,
        11478
      ]
    },
    {
      "content": "Turn off client certificate-based authentication",
      "pos": [
        11483,
        11531
      ]
    },
    {
      "content": "Only client certificate-based authentication is supported and disabling it will allow for public access to the service endpoints, unless other mechanisms are in place (e.g. Microsoft Azure Virtual Network).",
      "pos": [
        11533,
        11739
      ]
    },
    {
      "content": "Change these settings to false in the service configuration file to turn the feature off:",
      "pos": [
        11741,
        11830
      ]
    },
    {
      "content": "Then, copy the same thumbprint as the SSL certificate in the CA certificate setting:",
      "pos": [
        11976,
        12060
      ]
    },
    {
      "content": "Create a self-signed certification authority",
      "pos": [
        12137,
        12181
      ]
    },
    {
      "content": "Execute the following steps to create a self-signed certificate to act as a Certification Authority:",
      "pos": [
        12182,
        12282
      ]
    },
    {
      "content": "To customize it",
      "pos": [
        12440,
        12455
      ]
    },
    {
      "content": "-e with the certification expiration date",
      "pos": [
        12462,
        12503
      ]
    },
    {
      "content": "Find CA public key",
      "pos": [
        12509,
        12527
      ]
    },
    {
      "content": "All client certificates must have been issued by a Certification Authority trusted by the service.",
      "pos": [
        12529,
        12627
      ]
    },
    {
      "content": "Find the public key to the Certification Authority that issued the client certificates that are going to be used for authentication in order to upload it to the cloud service.",
      "pos": [
        12628,
        12803
      ]
    },
    {
      "content": "If the file with the public key is not available, export it from the certificate store:",
      "pos": [
        12805,
        12892
      ]
    },
    {
      "content": "Find certificate",
      "pos": [
        12896,
        12912
      ]
    },
    {
      "content": "Search for a client certificate issued by the same Certification Authority",
      "pos": [
        12919,
        12993
      ]
    },
    {
      "content": "Double-click the certificate.",
      "pos": [
        12996,
        13025
      ]
    },
    {
      "content": "Select the Certification Path tab in the Certificate dialog.",
      "pos": [
        13028,
        13088
      ]
    },
    {
      "content": "Double-click the CA entry in the path.",
      "pos": [
        13091,
        13129
      ]
    },
    {
      "content": "Take notes of the certificate properties.",
      "pos": [
        13132,
        13173
      ]
    },
    {
      "pos": [
        13176,
        13209
      ],
      "content": "Close the <bpt id=\"p1\">**</bpt>Certificate<ept id=\"p1\">**</ept> dialog."
    },
    {
      "content": "Find certificate",
      "pos": [
        13212,
        13228
      ]
    },
    {
      "content": "Search for the CA noted above.",
      "pos": [
        13235,
        13265
      ]
    },
    {
      "content": "Click Actions -&gt; All tasks -&gt; Export…",
      "pos": [
        13268,
        13305
      ]
    },
    {
      "content": "Export certificate into a .CER with these options:",
      "pos": [
        13308,
        13358
      ]
    },
    {
      "content": "No, do not export the private key",
      "pos": [
        13367,
        13400
      ]
    },
    {
      "content": "Include all certificates in the certification path if possible.",
      "pos": [
        13409,
        13472
      ]
    },
    {
      "content": "Export all extended properties.",
      "pos": [
        13479,
        13510
      ]
    },
    {
      "content": "Upload CA certificate to cloud service",
      "pos": [
        13515,
        13553
      ]
    },
    {
      "content": "Upload certificate with the existing or generated .CER file with the CA public key.",
      "pos": [
        13555,
        13638
      ]
    },
    {
      "content": "Update CA certificate in service configuration file",
      "pos": [
        13643,
        13694
      ]
    },
    {
      "content": "Update the thumbprint value of the following setting in the service configuration file with the thumbprint of the certificate uploaded to the cloud service:",
      "pos": [
        13696,
        13852
      ]
    },
    {
      "content": "Update the value of the following setting with the same thumbprint:",
      "pos": [
        13926,
        13993
      ]
    },
    {
      "content": "Issue client certificates",
      "pos": [
        14077,
        14102
      ]
    },
    {
      "content": "Each individual authorized to access the service should have a client certificate issued for his/hers exclusive use and should choose his/hers own strong password to protect its private key.",
      "pos": [
        14104,
        14294
      ]
    },
    {
      "content": "The following steps must be executed in the same machine where the self-signed CA certificate was generated and stored:",
      "pos": [
        14297,
        14416
      ]
    },
    {
      "content": "Customizing:",
      "pos": [
        14630,
        14642
      ]
    },
    {
      "content": "-n with an ID for to the client that will be authenticated with this certificate",
      "pos": [
        14646,
        14726
      ]
    },
    {
      "content": "-e with the certificate expiration date",
      "pos": [
        14729,
        14768
      ]
    },
    {
      "content": "MyID.pvk and MyID.cer with unique filenames for this client certificate",
      "pos": [
        14771,
        14842
      ]
    },
    {
      "content": "This command will prompt for a password to be created and then used once.",
      "pos": [
        14844,
        14917
      ]
    },
    {
      "content": "Use a strong password.",
      "pos": [
        14918,
        14940
      ]
    },
    {
      "content": "Create PFX files for client certificates",
      "pos": [
        14945,
        14985
      ]
    },
    {
      "content": "For each generated client certificate, execute:",
      "pos": [
        14987,
        15034
      ]
    },
    {
      "content": "Customizing:",
      "pos": [
        15077,
        15089
      ]
    },
    {
      "content": "Enter password and then export certificate with these options:",
      "pos": [
        15163,
        15225
      ]
    },
    {
      "content": "Yes, export the private key",
      "pos": [
        15229,
        15256
      ]
    },
    {
      "content": "Export all extended properties",
      "pos": [
        15259,
        15289
      ]
    },
    {
      "content": "The individual to whom this certificate is being issued should choose the export password",
      "pos": [
        15292,
        15381
      ]
    },
    {
      "content": "Import client certificate",
      "pos": [
        15386,
        15411
      ]
    },
    {
      "content": "Each individual for whom a client certificate has been issued should import the key pair in the machines he/she will use to communicate with the service:",
      "pos": [
        15413,
        15566
      ]
    },
    {
      "content": "Double-click the .PFX file in Windows Explorer",
      "pos": [
        15570,
        15616
      ]
    },
    {
      "content": "Import certificate into the Personal store with at least this option:",
      "pos": [
        15619,
        15688
      ]
    },
    {
      "content": "Include all extended properties checked",
      "pos": [
        15695,
        15734
      ]
    },
    {
      "content": "Copy client certificate thumbprints",
      "pos": [
        15739,
        15774
      ]
    },
    {
      "content": "Each individual for whom a client certificate has been issued must follow these steps in order to obtain the thumbprint of his/hers certificate which will be added to the service configuration file:",
      "pos": [
        15775,
        15973
      ]
    },
    {
      "content": "Run certmgr.exe",
      "pos": [
        15976,
        15991
      ]
    },
    {
      "content": "Select the Personal tab",
      "pos": [
        15994,
        16017
      ]
    },
    {
      "content": "Double-click the client certificate to be used for authentication",
      "pos": [
        16020,
        16085
      ]
    },
    {
      "content": "In the Certificate dialog that opens, select the Details tab",
      "pos": [
        16088,
        16148
      ]
    },
    {
      "content": "Make sure Show is displaying All",
      "pos": [
        16151,
        16183
      ]
    },
    {
      "content": "Select the field named Thumbprint in the list",
      "pos": [
        16186,
        16231
      ]
    },
    {
      "content": "Copy the value of the thumbprint",
      "pos": [
        16234,
        16266
      ]
    },
    {
      "content": "** Delete non-visible Unicode characters in front of the first digit",
      "pos": [
        16267,
        16335
      ]
    },
    {
      "content": "** Delete all spaces",
      "pos": [
        16336,
        16356
      ]
    },
    {
      "content": "Configure Allowed clients in the service configuration file",
      "pos": [
        16361,
        16420
      ]
    },
    {
      "content": "Update the value of the following setting in the service configuration file with a comma-separated list of the thumbprints of the client certificates allowed access to the service:",
      "pos": [
        16422,
        16602
      ]
    },
    {
      "content": "Configure client certificate revocation check",
      "pos": [
        16676,
        16721
      ]
    },
    {
      "content": "The default setting does not check with the Certification Authority for client certificate revocation status.",
      "pos": [
        16723,
        16832
      ]
    },
    {
      "content": "To turn on the checks, if the Certification Authority which issued the client certificates supports such checks, change the following setting with one of the values defined in the X509RevocationMode Enumeration:",
      "pos": [
        16833,
        17044
      ]
    },
    {
      "content": "Create PFX file for self-signed encryption certificates",
      "pos": [
        17122,
        17177
      ]
    },
    {
      "content": "For an encryption certificate, execute:",
      "pos": [
        17179,
        17218
      ]
    },
    {
      "content": "Customizing:",
      "pos": [
        17261,
        17273
      ]
    },
    {
      "content": "Enter password and then export certificate with these options:",
      "pos": [
        17351,
        17413
      ]
    },
    {
      "content": "Yes, export the private key",
      "pos": [
        17419,
        17446
      ]
    },
    {
      "content": "Export all extended properties",
      "pos": [
        17452,
        17482
      ]
    },
    {
      "content": "You will need the password when uploading the certificate to the cloud service.",
      "pos": [
        17488,
        17567
      ]
    },
    {
      "content": "Export encryption certificate from certificate store",
      "pos": [
        17572,
        17624
      ]
    },
    {
      "content": "Find certificate",
      "pos": [
        17631,
        17647
      ]
    },
    {
      "content": "Click Actions -&gt; All tasks -&gt; Export…",
      "pos": [
        17653,
        17690
      ]
    },
    {
      "content": "Export certificate into a .PFX file with these options:",
      "pos": [
        17696,
        17751
      ]
    },
    {
      "content": "Yes, export the private key",
      "pos": [
        17760,
        17787
      ]
    },
    {
      "content": "Include all certificates in the certification path if possible",
      "pos": [
        17795,
        17857
      ]
    },
    {
      "content": "Export all extended properties",
      "pos": [
        17864,
        17894
      ]
    },
    {
      "content": "Upload encryption certificate to cloud service",
      "pos": [
        17899,
        17945
      ]
    },
    {
      "content": "Upload certificate with the existing or generated .PFX file with the encryption key pair:",
      "pos": [
        17947,
        18036
      ]
    },
    {
      "content": "Enter the password protecting the private key information",
      "pos": [
        18040,
        18097
      ]
    },
    {
      "content": "Update encryption certificate in service configuration file",
      "pos": [
        18102,
        18161
      ]
    },
    {
      "content": "Update the thumbprint value of the following settings in the service configuration file with the thumbprint of the certificate uploaded to the cloud service:",
      "pos": [
        18163,
        18320
      ]
    },
    {
      "content": "Common certificate operations",
      "pos": [
        18416,
        18445
      ]
    },
    {
      "content": "Configure the SSL certificate",
      "pos": [
        18449,
        18478
      ]
    },
    {
      "content": "Configure client certificates",
      "pos": [
        18481,
        18510
      ]
    },
    {
      "content": "Find certificate",
      "pos": [
        18515,
        18531
      ]
    },
    {
      "content": "Follow these steps:",
      "pos": [
        18533,
        18552
      ]
    },
    {
      "content": "Run mmc.exe.",
      "pos": [
        18557,
        18569
      ]
    },
    {
      "content": "File -&gt; Add/Remove Snap-in…",
      "pos": [
        18573,
        18600
      ]
    },
    {
      "pos": [
        18604,
        18628
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Certificates<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        18632,
        18646
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Choose the certificate store location.",
      "pos": [
        18650,
        18688
      ]
    },
    {
      "pos": [
        18692,
        18709
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        18713,
        18726
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        18730,
        18754
      ],
      "content": "Expand <bpt id=\"p1\">**</bpt>Certificates<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Expand the certificate store node.",
      "pos": [
        18758,
        18792
      ]
    },
    {
      "content": "Expand the Certificate child node.",
      "pos": [
        18797,
        18831
      ]
    },
    {
      "content": "Select a certificate in the list.",
      "pos": [
        18836,
        18869
      ]
    },
    {
      "content": "Export certificate",
      "pos": [
        18874,
        18892
      ]
    },
    {
      "pos": [
        18893,
        18930
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Certificate Export Wizard<ept id=\"p1\">**</ept>:"
    },
    {
      "pos": [
        18935,
        18950
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        18954,
        19002
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>, then <bpt id=\"p2\">**</bpt>Export the private key<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        19006,
        19021
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Select the desired output file format.",
      "pos": [
        19025,
        19063
      ]
    },
    {
      "content": "Check the desired options.",
      "pos": [
        19067,
        19093
      ]
    },
    {
      "pos": [
        19097,
        19116
      ],
      "content": "Check <bpt id=\"p1\">**</bpt>Password<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Enter a strong password and confirm it.",
      "pos": [
        19120,
        19159
      ]
    },
    {
      "pos": [
        19163,
        19178
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Type or browse a filename where to store the certificate (use a .PFX extension).",
      "pos": [
        19182,
        19262
      ]
    },
    {
      "pos": [
        19267,
        19282
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        19287,
        19304
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        19309,
        19322
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Import certificate",
      "pos": [
        19327,
        19345
      ]
    },
    {
      "content": "In the Certificate Import Wizard:",
      "pos": [
        19347,
        19380
      ]
    },
    {
      "content": "Select the store location.",
      "pos": [
        19385,
        19411
      ]
    },
    {
      "pos": [
        19419,
        19511
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Current User<ept id=\"p1\">**</ept> if only processes running under current user will access the service"
    },
    {
      "pos": [
        19518,
        19602
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Local Machine<ept id=\"p1\">**</ept> if other processes in this computer will access the service"
    },
    {
      "pos": [
        19606,
        19621
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "content": "If importing from a file, confirm the file path.",
      "pos": [
        19625,
        19673
      ]
    },
    {
      "content": "If importing a .PFX file:",
      "pos": [
        19677,
        19702
      ]
    },
    {
      "content": "Enter the password protecting the private key",
      "pos": [
        19714,
        19759
      ]
    },
    {
      "content": "Select import options",
      "pos": [
        19771,
        19792
      ]
    },
    {
      "content": "Select \"Place\" certificates in the following store",
      "pos": [
        19800,
        19850
      ]
    },
    {
      "pos": [
        19858,
        19875
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Select the desired store.",
      "pos": [
        19883,
        19908
      ]
    },
    {
      "pos": [
        19916,
        19933
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        19948,
        20024
      ],
      "content": "If the Trusted Root Certification Authority store was chosen, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        20032,
        20067
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> on all dialog windows."
    },
    {
      "content": "Upload certificate",
      "pos": [
        20072,
        20090
      ]
    },
    {
      "pos": [
        20092,
        20150
      ],
      "content": "In the <bpt id=\"p1\">[</bpt>Azure Management Portal<ept id=\"p1\">](http://portal.azure.com/)</ept>"
    },
    {
      "pos": [
        20155,
        20181
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Cloud Services<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Select the cloud service.",
      "pos": [
        20185,
        20210
      ]
    },
    {
      "pos": [
        20214,
        20254
      ],
      "content": "On the top menu, click <bpt id=\"p1\">**</bpt>Certificates<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        20258,
        20294
      ],
      "content": "On the bottom bar, click <bpt id=\"p1\">**</bpt>Upload<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Select the certificate file.",
      "pos": [
        20298,
        20326
      ]
    },
    {
      "content": "If it is a .PFX file, enter the password for the private key.",
      "pos": [
        20330,
        20391
      ]
    },
    {
      "content": "Once completed, copy the certificate thumbprint from the new entry in the list.",
      "pos": [
        20395,
        20474
      ]
    },
    {
      "content": "Other security considerations",
      "pos": [
        20479,
        20508
      ]
    },
    {
      "content": "The SSL settings described in this document encrypt communication between the service and its clients when the HTTPS endpoint is used.",
      "pos": [
        20511,
        20645
      ]
    },
    {
      "content": "This is important since credentials for database access and potentially other sensitive information are contained in the communication.",
      "pos": [
        20646,
        20781
      ]
    },
    {
      "content": "Note, however, that the service persists internal status, including credentials, in its internal tables in the Microsoft Azure SQL database that you have provided for metadata storage in your Microsoft Azure subscription.",
      "pos": [
        20782,
        21003
      ]
    },
    {
      "content": "That database was defined as part of the following setting in your service configuration file (.CSCFG file):",
      "pos": [
        21004,
        21112
      ]
    },
    {
      "content": "Credentials stored in this database are encrypted.",
      "pos": [
        21177,
        21227
      ]
    },
    {
      "content": "However, as a best practice, ensure that both web and worker roles of your service deployments are kept up to date and secure as they both have access to the metadata database and the certificate used for encryption and decryption of stored credentials.",
      "pos": [
        21228,
        21481
      ]
    }
  ],
  "content": "<properties \n    title=\"Elastic Scale Security Configurations\" \n    pageTitle=\"Elastic Scale Security Configurations\" \n    description=\"Set up x409 certificates for encryption\" \n    metaKeywords=\"Elastic Database certificates security\" \n    services=\"sql-database\" documentationCenter=\"\" \n    manager=\"jhubbard\" \n    authors=\"sidneyh\"/>\n\n<tags \n    ms.service=\"sql-database\" \n    ms.workload=\"sql-database\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"07/07/2015\" \n    ms.author=\"sidneyh\" />\n\n# Split-Merge security configuration  \n\nTo use the Split/Merge service, you must correctly configure security. The service is part of the Elastic Scale feature of Microsoft Azure SQL Database. For more information, see [Elastic Scale Split and Merge Service Tutorial](sql-database-elastic-scale-configure-deploy-split-and-merge.md)\n\n## Configuring certificates\n\nCertificates are configured in two ways. \n\n1. [To Configure the SSL Certificate](To#Configure#the#SSL#Certificate)\n2. [To Configure Client Certificates](To#Configure#Client#Certificates) \n\n## To obtain certificates\n\nCertificates can be obtained from public Certificate Authorities (CAs) or from the [Windows Certificate Service](http://msdn.microsoft.com/library/windows/desktop/aa376539.aspx). These are the preferred methods to obtain certificates.\n\nIf those options are not available, you can generate **self-signed certificates**.\n \n## Tools to generate certificates\n\n* [makecert.exe](http://msdn.microsoft.com/library/bfsktky3.aspx)\n* [pvk2pfx.exe](http://msdn.microsoft.com/library/windows/hardware/ff550672.aspx)\n\n### To run the tools\n\n* From a Developer Command Prompt for Visual Studios, see [Visual Studio Command Prompt](http://msdn.microsoft.com/library/ms229859.aspx) \n\n    If installed, go to:\n\n        %ProgramFiles(x86)%\\Windows Kits\\x.y\\bin\\x86 \n\n* Get the WDK from [Windows 8.1: Download kits and tools](http://msdn.microsoft.com/windows/hardware/gg454513#drivers)\n\n## To configure the SSL certificate\nA SSL certificate is required to encrypt the communication and authenticate the server. Choose the most applicable of the three scenarios below, and execute all its steps:\n\n### Create a new self-signed certificate\n\n1.    [Create a Self-Signed Certificate](Create#a#Self-Signed#Certificate)\n2.    [Create PFX file for Self-Signed SSL Certificate](Create#PFX#file#for#Self-Signed#SSL#Certificate)\n3.    [Upload SSL Certificate to Cloud Service](Upload#SSL#Certificate#to#Cloud#Service)\n4.    [Update SSL Certificate in Service Configuration File](Update#SSL#Certificate#in#Service#Configuration#File)\n5.    [Import SSL Certification Authority](Import#SSL#Certification#Authority)\n\n### To Use an existing certificate from the certificate store\n1. [Export SSL Certificate From Certificate Store](Export#SSL#Certificate#From#Certificate#Store)\n2. [Upload SSL Certificate to Cloud Service](Upload#SSL#Certificate#to#Cloud#Service)\n3. [Update SSL Certificate in Service Configuration File](Update#SSL#Certificate#in#Service#Configuration#File)\n\n### To Use an existing certificate in a PFX file\n\n1. [Upload SSL Certificate to Cloud Service](Upload#SSL#Certificate#to#Cloud#Service)\n2. [Update SSL Certificate in Service Configuration File](Update#SSL#Certificate#in#Service#Configuration#File)\n\n## To configure client certificates\nClient certificates are required in order to authenticate requests to the service. Choose the most applicable of the three scenarios below, and execute all its steps:\n\n### Turn off client certificates\n1.    [Turn Off Client Certificate-Based Authentication](Turn#Off#Client#Certificate-Based#Authentication)\n\n### Issue new self-signed client certificates\n1.    [Create a Self-Signed Certification Authority](Create#a#Self-Signed#Certification#Authority)\n2.    [Upload CA Certificate to Cloud Service](Upload#CA#Certificate#to#Cloud#Service)\n3.    [Update CA Certificate in Service Configuration File](Update#CA#Certificate#in#Service#Configuration#File)\n4.    [Issue Client Certificates](Issue#Client#Certificates)\n5.    [Create PFX files for Client Certificates](Create#PFX#files#for#Client#Certificates)\n6.    [Import Client Certificate](Import#Client#Certificate)\n7.    [Copy Client Certificate Thumbprints](Copy#Client#Certificate#Thumbprints)\n8.    [Configure Allowed Clients in the Service Configuration File](Configure#Allowed#Clients#in#the#Service#Configuration#File)\n\n### Use existing client certificates\n1.    [Find CA Public Key](Find#CA#Public Key)\n2.    [Upload CA Certificate to Cloud Service](Upload#CA#certificate#to#cloud#service)\n3.    [Update CA Certificate in Service Configuration File](Update#CA#Certificate#in#Service#Configuration#File)\n4.    [Copy Client Certificate Thumbprints](Copy#Client#Certificate#Thumbprints)\n5.    [Configure Allowed Clients in the Service Configuration File](Configure#Allowed#Clients#in#the#Service#Configuration File)\n6.    [Configure Client Certificate Revocation Check](Configure#Client#Certificate#Revocation#Check)\n\n## Allowed IP addresses\n\nAccess to the service endpoints can be restricted to specific ranges of IP addresses.\n\n## To configure encryption for the store\n\nA certificate is required to encrypt the credentials that are stored in the metadata store. Choose the most applicable of the three scenarios below, and execute all its steps:\n\n### Use a new self-signed certificate\n\n1.     [Create a Self-Signed Certificate](Create#a#Self-Signed#Certificate)\n2.     [Create PFX file for Self-Signed Encryption Certificate](Create#PFX#file#for#Self-Signed#Encryption#Certificate)\n3.     [Upload Encryption Certificate to Cloud Service](Upload#Encryption#Certificate#to#Cloud#Service)\n4.     [Update Encryption Certificate in Service Configuration File](Update#Encryption#Certificate#in#Service#Configuration#File)\n\n### Use an existing certificate from the certificate store\n\n1.     [Export Encryption Certificate From Certificate Store](Export#Encryption#Certificate#From#Certificate#Store)\n2.     [Upload Encryption Certificate to Cloud Service](Upload#Encryption#Certificate#to#Cloud#Service)\n3.     [Update Encryption Certificate in Service Configuration File](Update#Encryption#Certificate#in#Service#Configuration#File)\n\n### Use an existing certificate in a PFX file\n\n1.     [Upload Encryption Certificate to Cloud Service](Upload#Encryption#Certificate#to#Cloud#Service)\n2.     [Update Encryption Certificate in Service Configuration File](Update#Encryption#Certificate#in#Service#Configuration#File)\n\n## The default configuration\n\nThe default configuration denies all access to the HTTP endpoint. This is the recommended setting, since the requests to these endpoints may carry sensitive information like database credentials.\nThe default configuration allows all access to the HTTPS endpoint. This setting may be restricted further.\n\n### Changing the Configuration\n\nThe group of access control rules that apply to and endpoint are configured in the **<EndpointAcls>** section in the **service configuration file**.\n\n    <EndpointAcls>\n      <EndpointAcl role=\"SplitMergeWeb\" endPoint=\"HttpIn\" accessControl=\"DenyAll\" />\n      <EndpointAcl role=\"SplitMergeWeb\" endPoint=\"HttpsIn\" accessControl=\"AllowAll\" />\n    </EndpointAcls>\n\nThe rules in an access control group are configured in a <AccessControl name=\"\"> section of the service configuration file. \n\nThe format is explained in Network Access Control Lists documentation.\nFor example, to allow only IPs in the range 100.100.0.0 to 100.100.255.255 to access the HTTPS endpoint, the rules would look like this:\n\n    <AccessControl name=\"Retricted\">\n      <Rule action=\"permit\" description=\"Some\" order=\"1\" remoteSubnet=\"100.100.0.0/16\"/>\n      <Rule action=\"deny\" description=\"None\" order=\"2\" remoteSubnet=\"0.0.0.0/0\" />\n    </AccessControl>\n    <EndpointAcls>\n    <EndpointAcl role=\"SplitMergeWeb\" endPoint=\"HttpsIn\" accessControl=\"Restricted\" />\n\n## Denial of service prevention\n\nThere are two different mechanisms supported to detect and prevent Denial of Service attacks:\n\n*    Restrict number of concurrent requests per remote host (off by default)\n*    Restrict rate of access per remote host (on by default)\n\nThese are based on the features further documented in Dynamic IP Security in IIS. When changing this configuration beware of the following factors:\n\n* The behavior of proxies and Network Address Translation devices over the remote host information\n* Each request to any resource in the web role is considered (e.g. loading scripts, images, etc)\n\n## Restricting number of concurrent accesses\n\nThe settings that configure this behavior are:\n\n    <Setting name=\"DynamicIpRestrictionDenyByConcurrentRequests\" value=\"false\" />\n    <Setting name=\"DynamicIpRestrictionMaxConcurrentRequests\" value=\"20\" />\n\nChange DynamicIpRestrictionDenyByConcurrentRequests to true to enable this protection.\n\n## Restricting rate of access\n\nThe settings that configure this behavior are:\n\n    <Setting name=\"DynamicIpRestrictionDenyByRequestRate\" value=\"true\" />\n    <Setting name=\"DynamicIpRestrictionMaxRequests\" value=\"100\" />\n    <Setting name=\"DynamicIpRestrictionRequestIntervalInMilliseconds\" value=\"2000\" />\n\n## Configuring the response to a denied request\n\nThe following setting configures the response to a denied request:\n\n    <Setting name=\"DynamicIpRestrictionDenyAction\" value=\"AbortRequest\" />\nRefer to the documentation for Dynamic IP Security in IIS for other supported values.\n\n## Operations for configuring service certificates\nThis topic is for reference only. Please follow the configuration steps outlined in:\n\n* Configure the SSL certificate\n* Configure client certificates\n\n## Create a self-signed certificate\nExecute:\n\n    makecert ^\n      -n \"CN=myservice.cloudapp.net\" ^\n      -e MM/DD/YYYY ^\n      -r -cy end -sky exchange -eku \"1.3.6.1.5.5.7.3.1\" ^\n      -a sha1 -len 2048 ^\n      -sv MySSL.pvk MySSL.cer\n\nTo customize:\n\n*    -n with the service URL. Wildcards (\"CN=*.cloudapp.net\") and alternative names (\"CN=myservice1.cloudapp.net, CN=myservice2.cloudapp.net\") are supported.\n*    -e with the certificate expiration date\nCreate a strong password and specify it when prompted.\n\n## Create PFX file for self-signed SSL certificate\n\nExecute:\n\n        pvk2pfx -pvk MySSL.pvk -spc MySSL.cer\n\nEnter password and then export certificate with these options:\n* Yes, export the private key\n* Export all extended properties\n\n## Export SSL certificate from certificate store\n\n* Find certificate\n* Click Actions -> All tasks -> Export…\n* Export certificate into a .PFX file with these options:\n    * Yes, export the private key\n    * Include all certificates in the certification path if possible\n    *Export all extended properties\n\n## Upload SSL certificate to cloud service\n\nUpload certificate with the existing or generated .PFX file with the SSL key pair:\n\n* Enter the password protecting the private key information\n\n## Update SSL certificate in service configuration file\n\nUpdate the thumbprint value of the following setting in the service configuration file with the thumbprint of the certificate uploaded to the cloud service:\n\n    <Certificate name=\"SSL\" thumbprint=\"\" thumbprintAlgorithm=\"sha1\" />\n\n## Import SSL certification authority\n\nFollow these steps in all account/machine that will communicate with the service:\n\n* Double-click the .CER file in Windows Explorer\n* In the Certificate dialog, click Install Certificate…\n* Import certificate into the Trusted Root Certification Authorities store\n\n## Turn off client certificate-based authentication\n\nOnly client certificate-based authentication is supported and disabling it will allow for public access to the service endpoints, unless other mechanisms are in place (e.g. Microsoft Azure Virtual Network).\n\nChange these settings to false in the service configuration file to turn the feature off:\n\n    <Setting name=\"SetupWebAppForClientCertificates\" value=\"false\" />\n    <Setting name=\"SetupWebserverForClientCertificates\" value=\"false\" />\n\nThen, copy the same thumbprint as the SSL certificate in the CA certificate setting:\n\n    <Certificate name=\"CA\" thumbprint=\"\" thumbprintAlgorithm=\"sha1\" />\n\n## Create a self-signed certification authority\nExecute the following steps to create a self-signed certificate to act as a Certification Authority:\n\n    makecert ^\n    -n \"CN=MyCA\" ^\n    -e MM/DD/YYYY ^\n     -r -cy authority -h 1 ^\n     -a sha1 -len 2048 ^\n      -sr localmachine -ss my ^\n      MyCA.cer\n\nTo customize it\n\n*    -e with the certification expiration date\n\n\n## Find CA public key\n\nAll client certificates must have been issued by a Certification Authority trusted by the service. Find the public key to the Certification Authority that issued the client certificates that are going to be used for authentication in order to upload it to the cloud service.\n\nIf the file with the public key is not available, export it from the certificate store:\n\n* Find certificate\n    * Search for a client certificate issued by the same Certification Authority\n* Double-click the certificate.\n* Select the Certification Path tab in the Certificate dialog.\n* Double-click the CA entry in the path.\n* Take notes of the certificate properties.\n* Close the **Certificate** dialog.\n* Find certificate\n    * Search for the CA noted above.\n* Click Actions -> All tasks -> Export…\n* Export certificate into a .CER with these options:\n    * **No, do not export the private key**\n    * Include all certificates in the certification path if possible.\n    * Export all extended properties.\n\n## Upload CA certificate to cloud service\n\nUpload certificate with the existing or generated .CER file with the CA public key.\n\n## Update CA certificate in service configuration file\n\nUpdate the thumbprint value of the following setting in the service configuration file with the thumbprint of the certificate uploaded to the cloud service:\n\n    <Certificate name=\"CA\" thumbprint=\"\" thumbprintAlgorithm=\"sha1\" />\n\nUpdate the value of the following setting with the same thumbprint:\n\n    <Setting name=\"AdditionalTrustedRootCertificationAuthorities\" value=\"\" />\n\n## Issue client certificates\n\nEach individual authorized to access the service should have a client certificate issued for his/hers exclusive use and should choose his/hers own strong password to protect its private key. \n\nThe following steps must be executed in the same machine where the self-signed CA certificate was generated and stored:\n\n    makecert ^\n      -n \"CN=My ID\" ^\n      -e MM/DD/YYYY ^\n      -cy end -sky exchange -eku \"1.3.6.1.5.5.7.3.2\" ^\n      -a sha1 -len 2048 ^\n      -in \"MyCA\" -ir localmachine -is my ^\n      -sv MyID.pvk MyID.cer\n\nCustomizing:\n\n* -n with an ID for to the client that will be authenticated with this certificate\n* -e with the certificate expiration date\n* MyID.pvk and MyID.cer with unique filenames for this client certificate\n\nThis command will prompt for a password to be created and then used once. Use a strong password.\n\n## Create PFX files for client certificates\n\nFor each generated client certificate, execute:\n\n    pvk2pfx -pvk MyID.pvk -spc MyID.cer\n\nCustomizing:\n\n    MyID.pvk and MyID.cer with the filename for the client certificate\n\nEnter password and then export certificate with these options:\n\n* Yes, export the private key\n* Export all extended properties\n* The individual to whom this certificate is being issued should choose the export password\n\n## Import client certificate\n\nEach individual for whom a client certificate has been issued should import the key pair in the machines he/she will use to communicate with the service:\n\n* Double-click the .PFX file in Windows Explorer\n* Import certificate into the Personal store with at least this option:\n    * Include all extended properties checked\n\n## Copy client certificate thumbprints\nEach individual for whom a client certificate has been issued must follow these steps in order to obtain the thumbprint of his/hers certificate which will be added to the service configuration file:\n* Run certmgr.exe\n* Select the Personal tab\n* Double-click the client certificate to be used for authentication\n* In the Certificate dialog that opens, select the Details tab\n* Make sure Show is displaying All\n* Select the field named Thumbprint in the list\n* Copy the value of the thumbprint\n** Delete non-visible Unicode characters in front of the first digit\n** Delete all spaces\n\n## Configure Allowed clients in the service configuration file\n\nUpdate the value of the following setting in the service configuration file with a comma-separated list of the thumbprints of the client certificates allowed access to the service:\n\n    <Setting name=\"AllowedClientCertificateThumbprints\" value=\"\" />\n\n## Configure client certificate revocation check\n\nThe default setting does not check with the Certification Authority for client certificate revocation status. To turn on the checks, if the Certification Authority which issued the client certificates supports such checks, change the following setting with one of the values defined in the X509RevocationMode Enumeration:\n\n    <Setting name=\"ClientCertificateRevocationCheck\" value=\"NoCheck\" />\n\n## Create PFX file for self-signed encryption certificates\n\nFor an encryption certificate, execute:\n\n    pvk2pfx -pvk MyID.pvk -spc MyID.cer\n\nCustomizing:\n\n    MyID.pvk and MyID.cer with the filename for the encryption certificate\n\nEnter password and then export certificate with these options:\n*    Yes, export the private key\n*    Export all extended properties\n*    You will need the password when uploading the certificate to the cloud service.\n\n## Export encryption certificate from certificate store\n\n*    Find certificate\n*    Click Actions -> All tasks -> Export…\n*    Export certificate into a .PFX file with these options: \n  *    Yes, export the private key\n  *    Include all certificates in the certification path if possible \n*    Export all extended properties\n\n## Upload encryption certificate to cloud service\n\nUpload certificate with the existing or generated .PFX file with the encryption key pair:\n\n* Enter the password protecting the private key information\n\n## Update encryption certificate in service configuration file\n\nUpdate the thumbprint value of the following settings in the service configuration file with the thumbprint of the certificate uploaded to the cloud service:\n\n    <Certificate name=\"DataEncryptionPrimary\" thumbprint=\"\" thumbprintAlgorithm=\"sha1\" />\n\n## Common certificate operations\n\n* Configure the SSL certificate\n* Configure client certificates\n\n## Find certificate\n\nFollow these steps:\n\n1. Run mmc.exe.\n2. File -> Add/Remove Snap-in…\n3. Select **Certificates**.\n4. Click **Add**.\n5. Choose the certificate store location.\n6. Click **Finish**.\n7. Click **OK**.\n8. Expand **Certificates**.\n9. Expand the certificate store node.\n10. Expand the Certificate child node.\n11. Select a certificate in the list.\n\n## Export certificate\nIn the **Certificate Export Wizard**:\n\n1. Click **Next**.\n2. Select **Yes**, then **Export the private key**.\n3. Click **Next**.\n4. Select the desired output file format.\n5. Check the desired options.\n6. Check **Password**.\n7. Enter a strong password and confirm it.\n8. Click **Next**.\n9. Type or browse a filename where to store the certificate (use a .PFX extension).\n10. Click **Next**.\n11. Click **Finish**.\n12. Click **OK**.\n\n## Import certificate\n\nIn the Certificate Import Wizard:\n\n1. Select the store location.\n\n    * Select **Current User** if only processes running under current user will access the service\n    * Select **Local Machine** if other processes in this computer will access the service\n2. Click **Next**.\n3. If importing from a file, confirm the file path.\n4. If importing a .PFX file:\n    1.     Enter the password protecting the private key\n    2.     Select import options\n5.     Select \"Place\" certificates in the following store\n6.     Click **Browse**.\n7.     Select the desired store.\n8.     Click **Finish**.\n       \n    * If the Trusted Root Certification Authority store was chosen, click **Yes**.\n9.     Click **OK** on all dialog windows.\n\n## Upload certificate\n\nIn the [Azure Management Portal](http://portal.azure.com/)\n\n1. Select **Cloud Services**.\n2. Select the cloud service.\n3. On the top menu, click **Certificates**.\n4. On the bottom bar, click **Upload**.\n5. Select the certificate file.\n6. If it is a .PFX file, enter the password for the private key.\n7. Once completed, copy the certificate thumbprint from the new entry in the list.\n\n## Other security considerations\n \nThe SSL settings described in this document encrypt communication between the service and its clients when the HTTPS endpoint is used. This is important since credentials for database access and potentially other sensitive information are contained in the communication. Note, however, that the service persists internal status, including credentials, in its internal tables in the Microsoft Azure SQL database that you have provided for metadata storage in your Microsoft Azure subscription. That database was defined as part of the following setting in your service configuration file (.CSCFG file): \n\n    <Setting name=\"ElasticScaleMetadata\" value=\"Server=…\" />\n\nCredentials stored in this database are encrypted. However, as a best practice, ensure that both web and worker roles of your service deployments are kept up to date and secure as they both have access to the metadata database and the certificate used for encryption and decryption of stored credentials. \n\n[AZURE.INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]"
}