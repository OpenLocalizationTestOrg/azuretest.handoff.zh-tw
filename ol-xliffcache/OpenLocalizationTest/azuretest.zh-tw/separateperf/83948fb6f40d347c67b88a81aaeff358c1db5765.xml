{
  "nodes": [
    {
      "content": "Set up staging environments for web apps in Azure App Service",
      "pos": [
        27,
        88
      ]
    },
    {
      "content": "Learn how to use staged publishing for web apps in Azure App Service.",
      "pos": [
        107,
        176
      ]
    },
    {
      "content": "Set up staging environments for web apps in Azure App Service",
      "pos": [
        511,
        572
      ]
    },
    {
      "content": "When you deploy your web app to <bpt id=\"p1\">[</bpt>App Service<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529714)</ept>, you can deploy to a separate deployment slot instead of the default production slot when running in the <bpt id=\"p2\">**</bpt>Standard<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Premium<ept id=\"p3\">**</ept> App Service plan mode.",
      "pos": [
        598,
        846
      ]
    },
    {
      "content": "Deployment slots are actually live web apps with their own hostnames.",
      "pos": [
        847,
        916
      ]
    },
    {
      "content": "Web app content and configurations elements can be swapped between two deployment slots, including the production slot.",
      "pos": [
        917,
        1036
      ]
    },
    {
      "content": "Deploying your application to a deployment slot has the following benefits:",
      "pos": [
        1037,
        1112
      ]
    },
    {
      "content": "You can validate web app changes in a staging deployment slot before swapping it with the production slot.",
      "pos": [
        1116,
        1222
      ]
    },
    {
      "content": "Deploying a web app to a slot first and swapping it into production ensures that all instances of the slot are warmed up before being swapped into production.",
      "pos": [
        1226,
        1384
      ]
    },
    {
      "content": "This eliminates downtime when you deploy your web app.",
      "pos": [
        1385,
        1439
      ]
    },
    {
      "content": "The traffic redirection is seamless, and no requests are dropped as a result of swap operations.",
      "pos": [
        1440,
        1536
      ]
    },
    {
      "content": "This entire workflow can be automated by configuring <bpt id=\"p1\">[</bpt>Auto Swap<ept id=\"p1\">](#configure-auto-swap-for-your-web-app)</ept> when pre-swap validation is not needed.",
      "pos": [
        1537,
        1680
      ]
    },
    {
      "content": "After a swap, the slot with previously staged web app now has the previous production web app.",
      "pos": [
        1684,
        1778
      ]
    },
    {
      "content": "If the changes swapped into the production slot are not as you expected, you can perform the same swap immediately to get your \"last known good site\" back.",
      "pos": [
        1779,
        1934
      ]
    },
    {
      "content": "Each App Service plan mode supports a different number of deployment slots.",
      "pos": [
        1936,
        2011
      ]
    },
    {
      "content": "To find out the number of slots your web app's mode supports, see <bpt id=\"p1\">[</bpt>App Service Pricing<ept id=\"p1\">](/pricing/details/app-service/)</ept>.",
      "pos": [
        2012,
        2131
      ]
    },
    {
      "content": "When your web app has multiple slots, you cannot change the mode.",
      "pos": [
        2135,
        2200
      ]
    },
    {
      "content": "Scaling is not available for non-production slots.",
      "pos": [
        2204,
        2254
      ]
    },
    {
      "content": "Linked resource management is not supported for non-production slots.",
      "pos": [
        2258,
        2327
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> In the <bpt id=\"p1\">[</bpt>Azure preview portal<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529715)</ept> only, you can avoid this potential impact on a production slot by temporarily moving the non-production slot to a different App Service plan mode.",
      "pos": [
        2335,
        2571
      ]
    },
    {
      "content": "Note that the non-production slot must once again share the same mode with the production slot before you can swap the two slots.",
      "pos": [
        2572,
        2701
      ]
    },
    {
      "content": "Add a deployment slot to a web app",
      "pos": [
        2725,
        2759
      ]
    },
    {
      "pos": [
        2764,
        2885
      ],
      "content": "The web app must be running in the <bpt id=\"p1\">**</bpt>Standard<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Premium<ept id=\"p2\">**</ept> mode in order for you to enable multiple deployment slots."
    },
    {
      "pos": [
        2890,
        2974
      ],
      "content": "In the <bpt id=\"p1\">[</bpt>Azure Preview Portal<ept id=\"p1\">](https://portal.azure.com/)</ept>, open your web app's blade."
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Deployment slots<ept id=\"p1\">**</ept>.",
      "pos": [
        2978,
        3005
      ]
    },
    {
      "content": "Then, in the <bpt id=\"p1\">**</bpt>Deployment slots<ept id=\"p1\">**</ept> blade, click <bpt id=\"p2\">**</bpt>Add Slot<ept id=\"p2\">**</ept>.",
      "pos": [
        3006,
        3066
      ]
    },
    {
      "content": "![Add a new deployment slot][QGAddNewDeploymentSlot]",
      "pos": [
        3072,
        3124
      ]
    },
    {
      "pos": [
        3132,
        3437
      ],
      "content": "[AZURE.NOTE]\nIf the web app is not already in the **Standard** or **Premium** mode, you will receive a message indicating the supported modes for enabling staged publishing. At this point, you have the option to select **Upgrade** and navigate to the **Scale** tab of your web app before continuing.",
      "leadings": [
        "",
        "    > "
      ],
      "nodes": [
        {
          "content": "If the web app is not already in the **Standard** or **Premium** mode, you will receive a message indicating the supported modes for enabling staged publishing. At this point, you have the option to select **Upgrade** and navigate to the **Scale** tab of your web app before continuing.",
          "pos": [
            13,
            299
          ],
          "nodes": [
            {
              "content": "If the web app is not already in the <bpt id=\"p1\">**</bpt>Standard<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Premium<ept id=\"p2\">**</ept> mode, you will receive a message indicating the supported modes for enabling staged publishing.",
              "pos": [
                0,
                160
              ]
            },
            {
              "content": "At this point, you have the option to select <bpt id=\"p1\">**</bpt>Upgrade<ept id=\"p1\">**</ept> and navigate to the <bpt id=\"p2\">**</bpt>Scale<ept id=\"p2\">**</ept> tab of your web app before continuing.",
              "pos": [
                161,
                286
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Add a slot<ept id=\"p1\">**</ept> blade, give the slot a name, and select whether to clone web app configuration from another existing deployment slot.",
      "pos": [
        3442,
        3581
      ]
    },
    {
      "content": "Click the check mark to continue.",
      "pos": [
        3582,
        3615
      ]
    },
    {
      "content": "![Configuration Source][ConfigurationSource1]",
      "pos": [
        3621,
        3666
      ]
    },
    {
      "content": "The first time you add a slot, you will only have two choices: clone configuration from the default slot in production or not at all.",
      "pos": [
        3672,
        3805
      ]
    },
    {
      "content": "After you have created several slots, you will be able to clone configuration from a slot other than the one in production:",
      "pos": [
        3811,
        3934
      ]
    },
    {
      "content": "![Configuration sources][MultipleConfigurationSources]",
      "pos": [
        3940,
        3994
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Deployment slots<ept id=\"p1\">**</ept> blade, click the deployment slot to open a blade for the slot, with a set of metrics and configuration just like any other web app.",
      "pos": [
        3999,
        4158
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>your-web-app-name-deployment-slot-name<ept id=\"p1\">**</ept> will appear at the top of blade to remind you that you are viewing the deployment slot.",
      "pos": [
        4159,
        4289
      ]
    },
    {
      "content": "![Deployment Slot Title][StagingTitle]",
      "pos": [
        4295,
        4333
      ]
    },
    {
      "content": "Click the app URL in the slot's blade.",
      "pos": [
        4338,
        4376
      ]
    },
    {
      "content": "Notice the the deployment slot has its own hostname and is also a live app.",
      "pos": [
        4377,
        4452
      ]
    },
    {
      "content": "To limit public access to the deployment slot, see <bpt id=\"p1\">[</bpt>App Service Web App – block web access to non-production deployment slots<ept id=\"p1\">](http://ruslany.net/2014/04/azure-web-sites-block-web-access-to-non-production-deployment-slots/)</ept>.",
      "pos": [
        4453,
        4677
      ]
    },
    {
      "content": "There is no content after deployment slot creation.",
      "pos": [
        4679,
        4730
      ]
    },
    {
      "content": "You can deploy to the slot from a different repository branch, or an altogether different repository.",
      "pos": [
        4731,
        4832
      ]
    },
    {
      "content": "You can also change the slot's configuration.",
      "pos": [
        4833,
        4878
      ]
    },
    {
      "content": "Use the publish profile or deployment credentials associated with the deployment slot for content updates.",
      "pos": [
        4879,
        4985
      ]
    },
    {
      "content": "For example, you can <bpt id=\"p1\">[</bpt>publish to this slot with git<ept id=\"p1\">](web-sites-publish-source-control.md)</ept>.",
      "pos": [
        4987,
        5077
      ]
    },
    {
      "content": "Configuration for deployment slots",
      "pos": [
        5116,
        5150
      ]
    },
    {
      "content": "When you clone configuration from another deployment slot, the cloned configuration is editable.",
      "pos": [
        5154,
        5250
      ]
    },
    {
      "content": "Furthermore, some configuration elements will follow the content across a swap (not slot specific) while other configuration elements will stay in the same slot after a swap (slot specific).",
      "pos": [
        5251,
        5441
      ]
    },
    {
      "content": "The following lists show the configuration that will change when you swap slots.",
      "pos": [
        5442,
        5522
      ]
    },
    {
      "pos": [
        5524,
        5554
      ],
      "content": "<bpt id=\"p1\">**</bpt>Settings that are swapped<ept id=\"p1\">**</ept>:"
    },
    {
      "content": "General settings - such as framework version, 32/64-bit, Web sockets",
      "pos": [
        5558,
        5626
      ]
    },
    {
      "content": "App settings (can be configured to stick to a slot)",
      "pos": [
        5629,
        5680
      ]
    },
    {
      "content": "Connection strings (can be configured to stick to a slot)",
      "pos": [
        5683,
        5740
      ]
    },
    {
      "content": "Handler mappings",
      "pos": [
        5743,
        5759
      ]
    },
    {
      "content": "Monitoring and diagnostic settings",
      "pos": [
        5762,
        5796
      ]
    },
    {
      "content": "WebJobs content",
      "pos": [
        5799,
        5814
      ]
    },
    {
      "pos": [
        5816,
        5850
      ],
      "content": "<bpt id=\"p1\">**</bpt>Settings that are not swapped<ept id=\"p1\">**</ept>:"
    },
    {
      "content": "Publishing endpoints",
      "pos": [
        5854,
        5874
      ]
    },
    {
      "content": "Custom Domain Names",
      "pos": [
        5877,
        5896
      ]
    },
    {
      "content": "SSL certificates and bindings",
      "pos": [
        5899,
        5928
      ]
    },
    {
      "content": "Scale settings",
      "pos": [
        5931,
        5945
      ]
    },
    {
      "content": "WebJobs schedulers",
      "pos": [
        5948,
        5966
      ]
    },
    {
      "content": "To configure an app setting or connection string to stick to a slot (not swapped), access the <bpt id=\"p1\">**</bpt>Application Settings<ept id=\"p1\">**</ept> blade for a specific slot, then select the <bpt id=\"p2\">**</bpt>Slot Setting<ept id=\"p2\">**</ept> box for the configuration elements that should stick the slot.",
      "pos": [
        5968,
        6209
      ]
    },
    {
      "content": "Note that marking a configuration element as slot specific has the effect of establishing that element as not swappable across all the deployment slots associated with the web app.",
      "pos": [
        6210,
        6390
      ]
    },
    {
      "content": "![Slot settings][SlotSettings]",
      "pos": [
        6392,
        6422
      ]
    },
    {
      "content": "To swap deployment slots",
      "pos": [
        6447,
        6471
      ]
    },
    {
      "pos": [
        6477,
        6672
      ],
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> Before you swap a web app from a deployment slot into production, make sure that all non-slot specific settings are configured exactly as you want to have it in the swap target."
    },
    {
      "content": "To swap deployment slots, click the <bpt id=\"p1\">**</bpt>Swap<ept id=\"p1\">**</ept> button in the command bar of the web app or in the command bar of a deployment slot.",
      "pos": [
        6677,
        6806
      ]
    },
    {
      "content": "Make sure that the swap source and swap target are set properly.",
      "pos": [
        6807,
        6871
      ]
    },
    {
      "content": "Usually, the swap target would be the production slot.",
      "pos": [
        6872,
        6926
      ]
    },
    {
      "content": "![Swap Button][SwapButtonBar]",
      "pos": [
        6934,
        6963
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to complete the operation.",
      "pos": [
        6968,
        7007
      ]
    },
    {
      "content": "When the operation finishes, the deployment slots have been swapped.",
      "pos": [
        7008,
        7076
      ]
    },
    {
      "content": "Configure Auto Swap for your web app",
      "pos": [
        7081,
        7117
      ]
    },
    {
      "content": "Auto Swap streamlines DevOps scenarios where you want to continuously deploy your web app with zero cold start and zero downtime for end customers of the web app.",
      "pos": [
        7122,
        7284
      ]
    },
    {
      "content": "When a deployment slot is configured for Auto Swap into production, every time you push your code update to that slot, App Service will automatically swap the web app into production after it has already warmed up in the slot.",
      "pos": [
        7285,
        7511
      ]
    },
    {
      "pos": [
        7514,
        7691
      ],
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> When you enable Auto Swap for a slot, make sure the slot configuration is exactly the configuration intended for the target slot (usually the production slot)."
    },
    {
      "content": "Configuring Auto Swap for a slot is easy.",
      "pos": [
        7693,
        7734
      ]
    },
    {
      "content": "Follow the steps below:",
      "pos": [
        7735,
        7758
      ]
    },
    {
      "pos": [
        7763,
        7873
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Deployment Slots<ept id=\"p1\">**</ept> blade, select a non-production slot, click <bpt id=\"p2\">**</bpt>All Settings<ept id=\"p2\">**</ept> for that slot's blade."
    },
    {
      "content": "![][Autoswap1]",
      "pos": [
        7881,
        7895
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Application Settings<ept id=\"p1\">**</ept>.",
      "pos": [
        7900,
        7931
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>On<ept id=\"p1\">**</ept> for <bpt id=\"p2\">**</bpt>Auto Swap<ept id=\"p2\">**</ept>, select the desired target slot in <bpt id=\"p3\">**</bpt>Auto Swap Slot<ept id=\"p3\">**</ept>, and click <bpt id=\"p4\">**</bpt>Save<ept id=\"p4\">**</ept> in the command bar.",
      "pos": [
        7932,
        8057
      ]
    },
    {
      "content": "Make sure configuration for the slot is exactly the configuration intended for the target slot.",
      "pos": [
        8058,
        8153
      ]
    },
    {
      "pos": [
        8159,
        8247
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Notifications<ept id=\"p1\">**</ept> tab will flash a green <bpt id=\"p2\">**</bpt>SUCCESS<ept id=\"p2\">**</ept> once the operation is complete."
    },
    {
      "content": "![][Autoswap2]",
      "pos": [
        8253,
        8267
      ]
    },
    {
      "pos": [
        8274,
        8431
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> To test Auto Swap for your web app, you can first select a non-production target slot in <bpt id=\"p1\">**</bpt>Auto Swap Slot<ept id=\"p1\">**</ept> to become familiar with the feature."
    },
    {
      "content": "Execute a code push to that deployment slot.",
      "pos": [
        8438,
        8482
      ]
    },
    {
      "content": "Auto Swap will happen after a short time and the update will be reflected at your target slot's URL.",
      "pos": [
        8483,
        8583
      ]
    },
    {
      "content": "To rollback a production app after swap",
      "pos": [
        8612,
        8651
      ]
    },
    {
      "content": "If any errors are identified in production after a slot swap, roll the slots back to their pre-swap states by swapping the same two slots immediately.",
      "pos": [
        8655,
        8805
      ]
    },
    {
      "content": "To delete a deployment slot",
      "pos": [
        8832,
        8859
      ]
    },
    {
      "pos": [
        8863,
        8935
      ],
      "content": "In the blade for a deployment slot, click <bpt id=\"p1\">**</bpt>Delete<ept id=\"p1\">**</ept> in the command bar."
    },
    {
      "content": "![Delete a Deployment Slot][DeleteStagingSiteButton]",
      "pos": [
        8939,
        8991
      ]
    },
    {
      "content": "<ph id=\"ph1\">\n\n&lt;a name=\"PowerShell\"&gt;&lt;/a&gt;</ph><ph id=\"ph2\">\n##</ph> Azure PowerShell cmdlets for deployment slots\n\nAzure PowerShell is a module that provides cmdlets to manage Azure through Windows PowerShell, including support for managing web app deployment slots in Azure App Service.",
      "pos": [
        9047,
        9297
      ]
    },
    {
      "content": "- For information on installing and configuring Azure PowerShell, and on authenticating Azure PowerShell with your Azure subscription, see <bpt id=\"p1\">[</bpt><ept id=\"p1\">How to install and configure Microsoft Azure PowerShell](../install-configure-powershell.md)</ept>.",
      "pos": [
        9299,
        9532
      ]
    },
    {
      "content": "- To list the cmdlets available for Azure App Service in PowerShell, call <ph id=\"ph1\">`help AzureWebsite`</ph>.",
      "pos": [
        9536,
        9630
      ]
    },
    {
      "content": "----------\n\n### Get-AzureWebsite\nThe <bpt id=\"p1\">**</bpt>Get-AzureWebsite<ept id=\"p1\">**</ept> cmdlet presents information about Azure web apps for the current subscription, as in the following example.",
      "pos": [
        9632,
        9797
      ]
    },
    {
      "content": "<ph id=\"ph1\">`Get-AzureWebsite webappslotstest`</ph><ph id=\"ph2\">\n\n----------\n\n###</ph> New-AzureWebsite\nYou can create a deployment slot by using the <bpt id=\"p1\">**</bpt>New-AzureWebsite<ept id=\"p1\">**</ept> cmdlet and specifying the names of both the web app and slot.",
      "pos": [
        9799,
        9996
      ]
    },
    {
      "content": "Also indicate the same region as the web app for deployment slot creation, as in the following example.",
      "pos": [
        9997,
        10100
      ]
    },
    {
      "content": "<ph id=\"ph1\">`New-AzureWebsite webappslotstest -Slot staging -Location \"West US\"`</ph><ph id=\"ph2\">\n\n----------\n\n###</ph> Publish-AzureWebsiteProject\nYou can use the <bpt id=\"p1\">**</bpt>Publish-AzureWebsiteProject<ept id=\"p1\">**</ept> cmdlet for content deployment, as in the following example.",
      "pos": [
        10102,
        10323
      ]
    },
    {
      "content": "<ph id=\"ph1\">`Publish-AzureWebsiteProject -Name webappslotstest -Slot staging -Package [path].zip`</ph><ph id=\"ph2\">\n\n----------\n\n###</ph> Show-AzureWebsite\nAfter content and configuration updates have been applied to the new slot, you can validate the updates by browsing to the slot using the <bpt id=\"p1\">**</bpt>Show-AzureWebsite<ept id=\"p1\">**</ept> cmdlet, as in the following example.",
      "pos": [
        10325,
        10642
      ]
    },
    {
      "content": "<ph id=\"ph1\">`Show-AzureWebsite -Name webappslotstest -Slot staging`</ph><ph id=\"ph2\">\n\n----------\n\n###</ph> Switch-AzureWebsiteSlot\nThe <bpt id=\"p1\">**</bpt>Switch-AzureWebsiteSlot<ept id=\"p1\">**</ept> cmdlet can perform a swap operation to make the updated deployment slot the production site, as in the following example.",
      "pos": [
        10644,
        10894
      ]
    },
    {
      "content": "The production app will not experience any down time, nor will it undergo a cold start.",
      "pos": [
        10895,
        10982
      ]
    },
    {
      "content": "<ph id=\"ph1\">`Switch-AzureWebsiteSlot -Name webappslotstest`</ph><ph id=\"ph2\">\n\n----------\n\n###</ph> Remove-AzureWebsite\nIf a deployment slot is no longer needed, it can be deleted by using the <bpt id=\"p1\">**</bpt>Remove-AzureWebsite<ept id=\"p1\">**</ept> cmdlet, as in the following example.",
      "pos": [
        10984,
        11202
      ]
    },
    {
      "content": "<ph id=\"ph1\">`Remove-AzureWebsite -Name webappslotstest -Slot staging`</ph><ph id=\"ph2\">\n\n----------\n\n</ph>",
      "pos": [
        11204,
        11275
      ]
    },
    {
      "content": "Azure Command-Line Interface (Azure CLI) commands for Deployment Slots",
      "pos": [
        11338,
        11408
      ]
    },
    {
      "content": "The Azure CLI provides cross-platform commands for working with Azure, including support for managing Web App deployment slots.",
      "pos": [
        11410,
        11537
      ]
    },
    {
      "pos": [
        11541,
        11740
      ],
      "content": "For instructions on installing and configuring the Azure CLI, including information on how to connect Azure CLI to your Azure subscription, see <bpt id=\"p1\">[</bpt>Install and Configure the Azure CLI<ept id=\"p1\">](../xplat-cli.md)</ept>."
    },
    {
      "pos": [
        11745,
        11837
      ],
      "content": "To list the commands available for Azure App Service in the Azure CLI, call <ph id=\"ph1\">`azure site -h`</ph>."
    },
    {
      "content": "azure site list",
      "pos": [
        11854,
        11869
      ]
    },
    {
      "pos": [
        11870,
        11988
      ],
      "content": "For information about the web apps in the current subscription, call <bpt id=\"p1\">**</bpt>azure site list<ept id=\"p1\">**</ept>, as in the following example."
    },
    {
      "content": "azure site create",
      "pos": [
        12040,
        12057
      ]
    },
    {
      "pos": [
        12058,
        12222
      ],
      "content": "To create a deployment slot, call <bpt id=\"p1\">**</bpt>azure site create<ept id=\"p1\">**</ept> and specify the name of an existing web app and the name of the slot to create, as in the following example."
    },
    {
      "pos": [
        12276,
        12373
      ],
      "content": "To enable source control for the new slot, use the <bpt id=\"p1\">**</bpt>--git<ept id=\"p1\">**</ept> option, as in the following example."
    },
    {
      "content": "azure site swap",
      "pos": [
        12448,
        12463
      ]
    },
    {
      "content": "To make the updated deployment slot the production app, use the <bpt id=\"p1\">**</bpt>azure site swap<ept id=\"p1\">**</ept> command to perform a swap operation, as in the following example.",
      "pos": [
        12464,
        12613
      ]
    },
    {
      "content": "The production app will not experience any down time, nor will it undergo a cold start.",
      "pos": [
        12614,
        12701
      ]
    },
    {
      "content": "azure site delete",
      "pos": [
        12753,
        12770
      ]
    },
    {
      "pos": [
        12771,
        12892
      ],
      "content": "To delete a deployment slot that is no longer needed, use the <bpt id=\"p1\">**</bpt>azure site delete<ept id=\"p1\">**</ept> command, as in the following example."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you want to get started with Azure App Service before signing up for an Azure account, go to <bpt id=\"p1\">[</bpt>Try App Service<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=523751)</ept>, where you can immediately create a short-lived starter web app in App Service.",
      "pos": [
        12959,
        13212
      ]
    },
    {
      "content": "No credit cards required; no commitments.",
      "pos": [
        13213,
        13254
      ]
    },
    {
      "content": "Next Steps",
      "pos": [
        13259,
        13269
      ]
    },
    {
      "content": "Azure App Service Web App – block web access to non-production deployment slots",
      "pos": [
        13274,
        13353
      ]
    },
    {
      "content": "Microsoft Azure Free Trial",
      "pos": [
        13454,
        13480
      ]
    },
    {
      "content": "What's changed",
      "pos": [
        13508,
        13522
      ]
    },
    {
      "pos": [
        13525,
        13693
      ],
      "content": "For a guide to the change from Websites to App Service see: <bpt id=\"p1\">[</bpt>Azure App Service and Its Impact on Existing Azure Services<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529714)</ept>"
    },
    {
      "pos": [
        13696,
        13855
      ],
      "content": "For a guide to the change of the old portal to the new portal see: <bpt id=\"p1\">[</bpt>Reference for navigating the preview portal<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529715)</ept>"
    },
    {
      "content": "test",
      "pos": [
        14942,
        14946
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Set up staging environments for web apps in Azure App Service\"\n    description=\"Learn how to use staged publishing for web apps in Azure App Service.\"\n    services=\"app-service\\web\"\n    documentationCenter=\"\"\n    authors=\"cephalin\"\n    writer=\"cephalin\"\n    manager=\"wpickett\"\n    editor=\"mollybos\"/>\n\n<tags\n    ms.service=\"app-service-web\"\n    ms.workload=\"web\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"08/03/2015\"\n    ms.author=\"cephalin\"/>\n\n# Set up staging environments for web apps in Azure App Service\n<a name=\"Overview\"></a>\n\nWhen you deploy your web app to [App Service](http://go.microsoft.com/fwlink/?LinkId=529714), you can deploy to a separate deployment slot instead of the default production slot when running in the **Standard** or **Premium** App Service plan mode. Deployment slots are actually live web apps with their own hostnames. Web app content and configurations elements can be swapped between two deployment slots, including the production slot. Deploying your application to a deployment slot has the following benefits:\n\n- You can validate web app changes in a staging deployment slot before swapping it with the production slot.\n\n- Deploying a web app to a slot first and swapping it into production ensures that all instances of the slot are warmed up before being swapped into production. This eliminates downtime when you deploy your web app. The traffic redirection is seamless, and no requests are dropped as a result of swap operations. This entire workflow can be automated by configuring [Auto Swap](#configure-auto-swap-for-your-web-app) when pre-swap validation is not needed.\n\n- After a swap, the slot with previously staged web app now has the previous production web app. If the changes swapped into the production slot are not as you expected, you can perform the same swap immediately to get your \"last known good site\" back.\n\nEach App Service plan mode supports a different number of deployment slots. To find out the number of slots your web app's mode supports, see [App Service Pricing](/pricing/details/app-service/).\n\n- When your web app has multiple slots, you cannot change the mode.\n\n- Scaling is not available for non-production slots.\n\n- Linked resource management is not supported for non-production slots.\n\n    > [AZURE.NOTE] In the [Azure preview portal](http://go.microsoft.com/fwlink/?LinkId=529715) only, you can avoid this potential impact on a production slot by temporarily moving the non-production slot to a different App Service plan mode. Note that the non-production slot must once again share the same mode with the production slot before you can swap the two slots.\n\n<a name=\"Add\"></a>\n## Add a deployment slot to a web app ##\n\nThe web app must be running in the **Standard** or **Premium** mode in order for you to enable multiple deployment slots.\n\n1. In the [Azure Preview Portal](https://portal.azure.com/), open your web app's blade.\n2. Click **Deployment slots**. Then, in the **Deployment slots** blade, click **Add Slot**.\n\n    ![Add a new deployment slot][QGAddNewDeploymentSlot]\n\n    > [AZURE.NOTE]\n    > If the web app is not already in the **Standard** or **Premium** mode, you will receive a message indicating the supported modes for enabling staged publishing. At this point, you have the option to select **Upgrade** and navigate to the **Scale** tab of your web app before continuing.\n\n2. In the **Add a slot** blade, give the slot a name, and select whether to clone web app configuration from another existing deployment slot. Click the check mark to continue.\n\n    ![Configuration Source][ConfigurationSource1]\n\n    The first time you add a slot, you will only have two choices: clone configuration from the default slot in production or not at all.\n\n    After you have created several slots, you will be able to clone configuration from a slot other than the one in production:\n\n    ![Configuration sources][MultipleConfigurationSources]\n\n5. In the **Deployment slots** blade, click the deployment slot to open a blade for the slot, with a set of metrics and configuration just like any other web app. **your-web-app-name-deployment-slot-name** will appear at the top of blade to remind you that you are viewing the deployment slot.\n\n    ![Deployment Slot Title][StagingTitle]\n\n5. Click the app URL in the slot's blade. Notice the the deployment slot has its own hostname and is also a live app. To limit public access to the deployment slot, see [App Service Web App – block web access to non-production deployment slots](http://ruslany.net/2014/04/azure-web-sites-block-web-access-to-non-production-deployment-slots/).\n\nThere is no content after deployment slot creation. You can deploy to the slot from a different repository branch, or an altogether different repository. You can also change the slot's configuration. Use the publish profile or deployment credentials associated with the deployment slot for content updates.  For example, you can [publish to this slot with git](web-sites-publish-source-control.md).\n\n<a name=\"AboutConfiguration\"></a>\n## Configuration for deployment slots ##\nWhen you clone configuration from another deployment slot, the cloned configuration is editable. Furthermore, some configuration elements will follow the content across a swap (not slot specific) while other configuration elements will stay in the same slot after a swap (slot specific). The following lists show the configuration that will change when you swap slots.\n\n**Settings that are swapped**:\n\n- General settings - such as framework version, 32/64-bit, Web sockets\n- App settings (can be configured to stick to a slot)\n- Connection strings (can be configured to stick to a slot)\n- Handler mappings\n- Monitoring and diagnostic settings\n- WebJobs content\n\n**Settings that are not swapped**:\n\n- Publishing endpoints\n- Custom Domain Names\n- SSL certificates and bindings\n- Scale settings\n- WebJobs schedulers\n\nTo configure an app setting or connection string to stick to a slot (not swapped), access the **Application Settings** blade for a specific slot, then select the **Slot Setting** box for the configuration elements that should stick the slot. Note that marking a configuration element as slot specific has the effect of establishing that element as not swappable across all the deployment slots associated with the web app.\n\n![Slot settings][SlotSettings]\n\n<a name=\"Swap\"></a>\n## To swap deployment slots ##\n\n>[AZURE.IMPORTANT] Before you swap a web app from a deployment slot into production, make sure that all non-slot specific settings are configured exactly as you want to have it in the swap target.\n\n1. To swap deployment slots, click the **Swap** button in the command bar of the web app or in the command bar of a deployment slot. Make sure that the swap source and swap target are set properly. Usually, the swap target would be the production slot.  \n\n    ![Swap Button][SwapButtonBar]\n\n3. Click **OK** to complete the operation. When the operation finishes, the deployment slots have been swapped.\n\n## Configure Auto Swap for your web app ##\n\nAuto Swap streamlines DevOps scenarios where you want to continuously deploy your web app with zero cold start and zero downtime for end customers of the web app. When a deployment slot is configured for Auto Swap into production, every time you push your code update to that slot, App Service will automatically swap the web app into production after it has already warmed up in the slot.\n\n>[AZURE.IMPORTANT] When you enable Auto Swap for a slot, make sure the slot configuration is exactly the configuration intended for the target slot (usually the production slot).\n\nConfiguring Auto Swap for a slot is easy. Follow the steps below:\n\n1. In the **Deployment Slots** blade, select a non-production slot, click **All Settings** for that slot's blade.  \n\n    ![][Autoswap1]\n\n2. Click **Application Settings**. Select **On** for **Auto Swap**, select the desired target slot in **Auto Swap Slot**, and click **Save** in the command bar. Make sure configuration for the slot is exactly the configuration intended for the target slot.\n\n    The **Notifications** tab will flash a green **SUCCESS** once the operation is complete.\n\n    ![][Autoswap2]\n\n    >[AZURE.NOTE] To test Auto Swap for your web app, you can first select a non-production target slot in **Auto Swap Slot** to become familiar with the feature.  \n\n3. Execute a code push to that deployment slot. Auto Swap will happen after a short time and the update will be reflected at your target slot's URL.\n\n<a name=\"Rollback\"></a>\n## To rollback a production app after swap ##\nIf any errors are identified in production after a slot swap, roll the slots back to their pre-swap states by swapping the same two slots immediately.\n\n<a name=\"Delete\"></a>\n## To delete a deployment slot##\n\nIn the blade for a deployment slot, click **Delete** in the command bar.  \n\n![Delete a Deployment Slot][DeleteStagingSiteButton]\n\n<!-- ======== AZURE POWERSHELL CMDLETS =========== -->\n\n<a name=\"PowerShell\"></a>\n## Azure PowerShell cmdlets for deployment slots\n\nAzure PowerShell is a module that provides cmdlets to manage Azure through Windows PowerShell, including support for managing web app deployment slots in Azure App Service.\n\n- For information on installing and configuring Azure PowerShell, and on authenticating Azure PowerShell with your Azure subscription, see [How to install and configure Microsoft Azure PowerShell](../install-configure-powershell.md).  \n\n- To list the cmdlets available for Azure App Service in PowerShell, call `help AzureWebsite`.\n\n----------\n\n### Get-AzureWebsite\nThe **Get-AzureWebsite** cmdlet presents information about Azure web apps for the current subscription, as in the following example.\n\n`Get-AzureWebsite webappslotstest`\n\n----------\n\n### New-AzureWebsite\nYou can create a deployment slot by using the **New-AzureWebsite** cmdlet and specifying the names of both the web app and slot. Also indicate the same region as the web app for deployment slot creation, as in the following example.\n\n`New-AzureWebsite webappslotstest -Slot staging -Location \"West US\"`\n\n----------\n\n### Publish-AzureWebsiteProject\nYou can use the **Publish-AzureWebsiteProject** cmdlet for content deployment, as in the following example.\n\n`Publish-AzureWebsiteProject -Name webappslotstest -Slot staging -Package [path].zip`\n\n----------\n\n### Show-AzureWebsite\nAfter content and configuration updates have been applied to the new slot, you can validate the updates by browsing to the slot using the **Show-AzureWebsite** cmdlet, as in the following example.\n\n`Show-AzureWebsite -Name webappslotstest -Slot staging`\n\n----------\n\n### Switch-AzureWebsiteSlot\nThe **Switch-AzureWebsiteSlot** cmdlet can perform a swap operation to make the updated deployment slot the production site, as in the following example. The production app will not experience any down time, nor will it undergo a cold start.\n\n`Switch-AzureWebsiteSlot -Name webappslotstest`\n\n----------\n\n### Remove-AzureWebsite\nIf a deployment slot is no longer needed, it can be deleted by using the **Remove-AzureWebsite** cmdlet, as in the following example.\n\n`Remove-AzureWebsite -Name webappslotstest -Slot staging`\n\n----------\n\n<!-- ======== Azure CLI =========== -->\n\n<a name=\"CLI\"></a>\n## Azure Command-Line Interface (Azure CLI) commands for Deployment Slots\n\nThe Azure CLI provides cross-platform commands for working with Azure, including support for managing Web App deployment slots.\n\n- For instructions on installing and configuring the Azure CLI, including information on how to connect Azure CLI to your Azure subscription, see [Install and Configure the Azure CLI](../xplat-cli.md).\n\n-  To list the commands available for Azure App Service in the Azure CLI, call `azure site -h`.\n\n----------\n### azure site list\nFor information about the web apps in the current subscription, call **azure site list**, as in the following example.\n\n`azure site list webappslotstest`\n\n----------\n### azure site create\nTo create a deployment slot, call **azure site create** and specify the name of an existing web app and the name of the slot to create, as in the following example.\n\n`azure site create webappslotstest --slot staging`\n\nTo enable source control for the new slot, use the **--git** option, as in the following example.\n\n`azure site create --git webappslotstest --slot staging`\n\n----------\n### azure site swap\nTo make the updated deployment slot the production app, use the **azure site swap** command to perform a swap operation, as in the following example. The production app will not experience any down time, nor will it undergo a cold start.\n\n`azure site swap webappslotstest`\n\n----------\n### azure site delete\nTo delete a deployment slot that is no longer needed, use the **azure site delete** command, as in the following example.\n\n`azure site delete webappslotstest --slot staging`\n\n----------\n\n>[AZURE.NOTE] If you want to get started with Azure App Service before signing up for an Azure account, go to [Try App Service](http://go.microsoft.com/fwlink/?LinkId=523751), where you can immediately create a short-lived starter web app in App Service. No credit cards required; no commitments.\n\n## Next Steps ##\n[Azure App Service Web App – block web access to non-production deployment slots](http://ruslany.net/2014/04/azure-web-sites-block-web-access-to-non-production-deployment-slots/)\n\n[Microsoft Azure Free Trial](/pricing/free-trial/)\n\n## What's changed\n* For a guide to the change from Websites to App Service see: [Azure App Service and Its Impact on Existing Azure Services](http://go.microsoft.com/fwlink/?LinkId=529714)\n* For a guide to the change of the old portal to the new portal see: [Reference for navigating the preview portal](http://go.microsoft.com/fwlink/?LinkId=529715)\n\n<!-- IMAGES -->\n[QGAddNewDeploymentSlot]:  ./media/web-sites-staged-publishing/QGAddNewDeploymentSlot.png\n[AddNewDeploymentSlotDialog]: ./media/web-sites-staged-publishing/AddNewDeploymentSlotDialog.png\n[ConfigurationSource1]: ./media/web-sites-staged-publishing/ConfigurationSource1.png\n[MultipleConfigurationSources]: ./media/web-sites-staged-publishing/MultipleConfigurationSources.png\n[SiteListWithStagedSite]: ./media/web-sites-staged-publishing/SiteListWithStagedSite.png\n[StagingTitle]: ./media/web-sites-staged-publishing/StagingTitle.png\n[SwapButtonBar]: ./media/web-sites-staged-publishing/SwapButtonBar.png\n[SwapConfirmationDialog]:  ./media/web-sites-staged-publishing/SwapConfirmationDialog.png\n[DeleteStagingSiteButton]: ./media/web-sites-staged-publishing/DeleteStagingSiteButton.png\n[SwapDeploymentsDialog]: ./media/web-sites-staged-publishing/SwapDeploymentsDialog.png\n[Autoswap1]: ./media/web-sites-staged-publishing/AutoSwap01.png\n[Autoswap2]: ./media/web-sites-staged-publishing/AutoSwap02.png\n[SlotSettings]: ./media/web-sites-staged-publishing/SlotSetting.png\n \n\ntest\n"
}