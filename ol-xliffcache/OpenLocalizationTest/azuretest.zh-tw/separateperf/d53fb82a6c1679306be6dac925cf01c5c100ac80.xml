{
  "nodes": [
    {
      "content": "Usage analysis for web applications with Application Insights",
      "pos": [
        28,
        89
      ]
    },
    {
      "content": "Overview of usage analytics with Application Insights",
      "pos": [
        109,
        162
      ]
    },
    {
      "content": "Usage analysis for web applications with Application Insights",
      "pos": [
        480,
        541
      ]
    },
    {
      "content": "Knowing how people use your application lets you focus your development work on the scenarios that are most important to them, and gain insights into the goals that they find easier or more difficult to achieve.",
      "pos": [
        543,
        754
      ]
    },
    {
      "content": "Visual Studio Application Insights provides two levels of usage tracking:",
      "pos": [
        757,
        830
      ]
    },
    {
      "pos": [
        834,
        897
      ],
      "content": "<bpt id=\"p1\">**</bpt>User, session and page view data<ept id=\"p1\">**</ept> - provided out of the box."
    },
    {
      "pos": [
        902,
        1002
      ],
      "content": "<bpt id=\"p1\">**</bpt>Custom telemetry<ept id=\"p1\">**</ept> - You [write code][api] to trace your users through your app's user experience."
    },
    {
      "content": "Setting up",
      "pos": [
        1008,
        1018
      ]
    },
    {
      "content": "Usage data from a web application comes from the client browser.",
      "pos": [
        1020,
        1084
      ]
    },
    {
      "content": "Set up an Application Insights resource",
      "pos": [
        1091,
        1130
      ]
    },
    {
      "content": "An Application Insights resource is a place in Microsoft Azure where telemetry data from your app is analyzed and displayed.",
      "pos": [
        1133,
        1257
      ]
    },
    {
      "content": "You might already have set up one to display data from your app's server side in [ASP.NET][greenbrown] or [J2EE][java].",
      "pos": [
        1258,
        1377
      ]
    },
    {
      "content": "If not, you might want to do that now.",
      "pos": [
        1378,
        1416
      ]
    },
    {
      "content": "It's usually best to display the usage data from the web client in the same resource as the data from the server.",
      "pos": [
        1418,
        1531
      ]
    },
    {
      "content": "That way, you can easily correlate diagnostics and metrics from the two ends.",
      "pos": [
        1532,
        1609
      ]
    },
    {
      "content": "So, if you already have a resource, skip to the next step.",
      "pos": [
        1610,
        1668
      ]
    },
    {
      "content": "Insert code in your web pages",
      "pos": [
        1675,
        1704
      ]
    },
    {
      "content": "In your resource in the [Azure portal][portal] , open Quick Start get the code snippet to monitor web pages.",
      "pos": [
        1706,
        1814
      ]
    },
    {
      "content": "Put the code in a master page such as (in .NET) _Layout.cshtml, or in an include file, to make sure it is included in all your pages.",
      "pos": [
        1884,
        2017
      ]
    },
    {
      "content": "The code snippet includes the instrumentation key (iKey) that identifies your resource.",
      "pos": [
        2019,
        2106
      ]
    },
    {
      "content": "To send data to a different resource - for example during testing - you only have to replace the iKey.",
      "pos": [
        2107,
        2209
      ]
    },
    {
      "content": "Publish your web pages or use them in debug mode, to generate some telemetry data.",
      "pos": [
        2211,
        2293
      ]
    },
    {
      "content": "How popular is my web application?",
      "pos": [
        2299,
        2333
      ]
    },
    {
      "content": "Sign in to the [Azure portal][portal], browse to your application resource, and click Usage:",
      "pos": [
        2335,
        2427
      ]
    },
    {
      "pos": [
        2487,
        2566
      ],
      "content": "<bpt id=\"p1\">**</bpt>Users:<ept id=\"p1\">**</ept> The count of distinct active users over the time range of the chart."
    },
    {
      "pos": [
        2570,
        2612
      ],
      "content": "<bpt id=\"p1\">**</bpt>Sessions:<ept id=\"p1\">**</ept> The count of active sessions"
    },
    {
      "pos": [
        2615,
        2716
      ],
      "content": "<bpt id=\"p1\">**</bpt>Page views<ept id=\"p1\">**</ept> Counts the number of calls to trackPageView(), typically called once in each web page."
    },
    {
      "content": "Click any of the charts to see more detail.",
      "pos": [
        2718,
        2761
      ]
    },
    {
      "content": "Notice that you can change the time range of the charts.",
      "pos": [
        2762,
        2818
      ]
    },
    {
      "content": "Where do my users live?",
      "pos": [
        2824,
        2847
      ]
    },
    {
      "content": "From the usage blade, click the Users chart to see more detail:",
      "pos": [
        2849,
        2912
      ]
    },
    {
      "content": "On the Usage blade, click the Users chart",
      "pos": [
        2916,
        2957
      ]
    },
    {
      "content": "What browsers or operating systems do they use?",
      "pos": [
        3019,
        3066
      ]
    },
    {
      "content": "Group (segment) data by a property such as Browser, Operating System, or City:",
      "pos": [
        3068,
        3146
      ]
    },
    {
      "content": "Select a chart that shows a single metric, switch on Grouping, and choose a property",
      "pos": [
        3150,
        3234
      ]
    },
    {
      "content": "Sessions",
      "pos": [
        3295,
        3303
      ]
    },
    {
      "content": "Session is a fundamental concept in Application Insights, which strives to associate every telemetry event - such as requests, page views, exceptions, or custom events that you code yourself - with a specific user session.",
      "pos": [
        3305,
        3527
      ]
    },
    {
      "content": "Rich context information is collected about each session, such as device characteristics, geo location, operating system, and so on.",
      "pos": [
        3530,
        3662
      ]
    },
    {
      "content": "If you instrument both the client and server ([ASP.NET][greenbrown] or [J2EE][java]), the SDKs will propagate the session id between client and server, so that events on both sides can be correlated.",
      "pos": [
        3664,
        3863
      ]
    },
    {
      "content": "When [diagnosing problems][diagnostic], you can find all the telemetry related to the session in which a problem occurred, including all requests, and any events, exceptions or traces that were logged.",
      "pos": [
        3865,
        4066
      ]
    },
    {
      "content": "Sessions provide a good measure of the popularity of contexts such as device, operating system or location.",
      "pos": [
        4068,
        4175
      ]
    },
    {
      "content": "By showing the count of sessions grouped by device, for example, you get a more accurate count of how often that device is used with your app, than by counting page views.",
      "pos": [
        4176,
        4347
      ]
    },
    {
      "content": "This would be a useful input to triage of any device-specific issue.",
      "pos": [
        4348,
        4416
      ]
    },
    {
      "content": "What's a session?",
      "pos": [
        4424,
        4441
      ]
    },
    {
      "content": "A session represents a single encounter between the user and the app.",
      "pos": [
        4443,
        4512
      ]
    },
    {
      "content": "In its simplest form, session starts with a user launching the app and finishes when user leaves the app.",
      "pos": [
        4513,
        4618
      ]
    },
    {
      "content": "For web apps, by default, the session terminates after 30 minutes of inactivity, or after 24 hours of activity.",
      "pos": [
        4619,
        4730
      ]
    },
    {
      "content": "You can alter these defaults by editing the code snippet:",
      "pos": [
        4733,
        4790
      ]
    },
    {
      "content": "<ph id=\"ph1\">`sessionRenewalMs`</ph> : The time, in milliseconds, to expire the session due to user’s inactivity.",
      "pos": [
        5003,
        5098
      ]
    },
    {
      "content": "Default: 30 minutes.",
      "pos": [
        5099,
        5119
      ]
    },
    {
      "content": "<ph id=\"ph1\">`sessionExpirationMs`</ph> : The maximum session length, in milliseconds.",
      "pos": [
        5122,
        5190
      ]
    },
    {
      "content": "If the user remains active after this time, another session is counted.",
      "pos": [
        5191,
        5262
      ]
    },
    {
      "content": "Default: 24 hours.",
      "pos": [
        5263,
        5281
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Session duration<ept id=\"p1\">**</ept> is a [metric][metrics] that records the span of time between the first and last telemetry items of the session.",
      "pos": [
        5283,
        5415
      ]
    },
    {
      "content": "(It doesn't include the timeout period.)",
      "pos": [
        5416,
        5456
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Session count<ept id=\"p1\">**</ept> in a certain interval is defined as the number of unique sessions with some activity during this interval.",
      "pos": [
        5458,
        5582
      ]
    },
    {
      "content": "When you look at a long time range such as daily session count for the past week, this is usually equivalent to the total number of sessions.",
      "pos": [
        5583,
        5724
      ]
    },
    {
      "content": "However, when you explore shorter time ranges such as hourly grain, a long session spanning multiple hours will be counted for each hour in which the session was active.",
      "pos": [
        5727,
        5896
      ]
    },
    {
      "content": "Users and user counts",
      "pos": [
        5902,
        5923
      ]
    },
    {
      "content": "Each user session is associated with a unique user id.",
      "pos": [
        5926,
        5980
      ]
    },
    {
      "content": "By default, the user is identified by placing a cookie.",
      "pos": [
        5983,
        6038
      ]
    },
    {
      "content": "A user who uses multiple browsers or devices will be counted more than once.",
      "pos": [
        6039,
        6115
      ]
    },
    {
      "content": "(But see <bpt id=\"p1\">[</bpt>authenticated users<ept id=\"p1\">](#authenticated-users)</ept>",
      "pos": [
        6116,
        6168
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>user count<ept id=\"p1\">**</ept> metric in a certain interval is defined as the number of unique users with recorded activity during this interval.",
      "pos": [
        6171,
        6304
      ]
    },
    {
      "content": "As a result, users with long sessions may be accounted multiple times, when you set a time range so that the grain is less than an hour or so.",
      "pos": [
        6305,
        6447
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>New Users<ept id=\"p1\">**</ept> counts the users whose first sessions with the app occurred during this interval.",
      "pos": [
        6449,
        6544
      ]
    },
    {
      "content": "If the default method of counting by users by cookies is used, then this will also include users who have cleared their cookies, or who are using a new device or browser to access your app for the first time.",
      "pos": [
        6545,
        6753
      ]
    },
    {
      "content": "<ph id=\"ph1\">![</ph>From the usage blade, click on Users chart to examine New Users.<ph id=\"ph2\">](./media/app-insights-web-track-usage/031-dual.png)</ph>",
      "pos": [
        6754,
        6872
      ]
    },
    {
      "content": "Authenticated users",
      "pos": [
        6878,
        6897
      ]
    },
    {
      "content": "If your web app lets users sign in, you can get a more accurate count by providing Application Insights with a unique user identifier.",
      "pos": [
        6899,
        7033
      ]
    },
    {
      "content": "It doesn't have to be their name, or the same id that you use in your app.",
      "pos": [
        7034,
        7108
      ]
    },
    {
      "content": "As soon as your app has identified the user, use this code:",
      "pos": [
        7109,
        7168
      ]
    },
    {
      "content": "JavaScript at client",
      "pos": [
        7172,
        7192
      ]
    },
    {
      "content": "If your app groups users into accounts, you can also pass an identifier for the account.",
      "pos": [
        7251,
        7339
      ]
    },
    {
      "pos": [
        7409,
        7482
      ],
      "content": "The user and account ids must not contain spaces or the characters <ph id=\"ph1\">`,;=|`</ph>"
    },
    {
      "pos": [
        7485,
        7609
      ],
      "content": "In <bpt id=\"p1\">[</bpt>metrics explorer<ept id=\"p1\">](app-insights-metrics-explorer.md)</ept>, you can create a chart of <bpt id=\"p2\">**</bpt>Authenticated Users<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Accounts<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Synthetic traffic",
      "pos": [
        7615,
        7632
      ]
    },
    {
      "content": "Synthetic traffic includes requests from availability and load tests, search engine crawlers and other agents.",
      "pos": [
        7634,
        7744
      ]
    },
    {
      "content": "Application Insights tries strives to automatically determine and classify synthetic traffic and mark it appropriately.",
      "pos": [
        7747,
        7866
      ]
    },
    {
      "content": "In most cases, synthetic traffic does not invoke the JavaScript SDK, so that this activity is excluded from user and session counting.",
      "pos": [
        7867,
        8001
      ]
    },
    {
      "content": "However, for Application Insights [web tests][availability], the user id is automatically set based on POP location, and session id is set based on test run id.",
      "pos": [
        8004,
        8164
      ]
    },
    {
      "content": "In default reports, synthetic traffic is filtered out by default, which will exclude these users and sessions.",
      "pos": [
        8165,
        8275
      ]
    },
    {
      "content": "However, when synthetic traffic is included, it may cause a small increase in overall users and session counts.",
      "pos": [
        8276,
        8387
      ]
    },
    {
      "content": "Page usage",
      "pos": [
        8393,
        8403
      ]
    },
    {
      "content": "Click through the page views chart to get a more zoomed-in version together with a breakdown of your most popular pages:",
      "pos": [
        8405,
        8525
      ]
    },
    {
      "content": "From the Overview blade, click the Page views chart",
      "pos": [
        8530,
        8581
      ]
    },
    {
      "content": "The example above is from a games website.",
      "pos": [
        8636,
        8678
      ]
    },
    {
      "content": "From it we can instantly see:",
      "pos": [
        8679,
        8708
      ]
    },
    {
      "content": "Usage hasn't improved in the past week.",
      "pos": [
        8712,
        8751
      ]
    },
    {
      "content": "Maybe we should think about search engine optimization?",
      "pos": [
        8752,
        8807
      ]
    },
    {
      "content": "Many fewer people see the games pages than the Home page.",
      "pos": [
        8810,
        8867
      ]
    },
    {
      "content": "Why doesn't our Home page attract people to play games?",
      "pos": [
        8868,
        8923
      ]
    },
    {
      "content": "'Crossword' is the most popular game.",
      "pos": [
        8926,
        8963
      ]
    },
    {
      "content": "We should give priority to new ideas and improvements there.",
      "pos": [
        8964,
        9024
      ]
    },
    {
      "content": "Custom tracking",
      "pos": [
        9029,
        9044
      ]
    },
    {
      "content": "Let's suppose that instead of implementing each game in a separate web page, you decide to refactor them all into the same single-page app, with most of the functionality coded as Javascript in the web page.",
      "pos": [
        9046,
        9253
      ]
    },
    {
      "content": "This allows the user to switch quickly between one game and another, or even have several games on one page.",
      "pos": [
        9254,
        9362
      ]
    },
    {
      "content": "But you'd still like Application Insights to log the number of times each game is opened, in exactly the same way as when they were on separate web pages.",
      "pos": [
        9365,
        9519
      ]
    },
    {
      "content": "That's easy: just insert a call to the telemetry module into your JavaScript where you want to record that a new 'page' has opened:",
      "pos": [
        9520,
        9651
      ]
    },
    {
      "content": "Custom events",
      "pos": [
        9699,
        9712
      ]
    },
    {
      "content": "Use custom events to .",
      "pos": [
        9714,
        9736
      ]
    },
    {
      "content": "You can send them from device apps, web pages or a web server:",
      "pos": [
        9737,
        9799
      ]
    },
    {
      "content": "JavaScript",
      "pos": [
        9802,
        9812
      ]
    },
    {
      "content": "C",
      "pos": [
        9856,
        9857
      ]
    },
    {
      "content": "VB",
      "pos": [
        9960,
        9962
      ]
    },
    {
      "content": "The most frequent custom events are listed on the overview blade.",
      "pos": [
        10061,
        10126
      ]
    },
    {
      "content": "On the Overview blade, scroll down to and click Custom Events.",
      "pos": [
        10130,
        10192
      ]
    },
    {
      "content": "Click the head of the table to see total numbers of events.",
      "pos": [
        10247,
        10306
      ]
    },
    {
      "content": "You can segment the chart by various attributes such as the event name:",
      "pos": [
        10307,
        10378
      ]
    },
    {
      "content": "Select a chart that shows just one metric.",
      "pos": [
        10383,
        10425
      ]
    },
    {
      "content": "Switch on Grouping.",
      "pos": [
        10426,
        10445
      ]
    },
    {
      "content": "Choose a property.",
      "pos": [
        10446,
        10464
      ]
    },
    {
      "content": "Not all properties are available.",
      "pos": [
        10465,
        10498
      ]
    },
    {
      "content": "The particularly useful feature of timelines is that you can correlate changes with other metrics and events.",
      "pos": [
        10560,
        10669
      ]
    },
    {
      "content": "For example, at times when more games are played, you'd expect to see a rise in abandoned games as well.",
      "pos": [
        10670,
        10774
      ]
    },
    {
      "content": "But the rise in abandoned games is disproportionate, you'd want to find out whether the high load is causing problems that users find unacceptable.",
      "pos": [
        10775,
        10922
      ]
    },
    {
      "content": "Drill into specific events",
      "pos": [
        10927,
        10953
      ]
    },
    {
      "content": "To get a better understanding of how a typical session goes, you might want to focus on a specific user session that contains a particular type of event.",
      "pos": [
        10955,
        11108
      ]
    },
    {
      "content": "In this example, we coded a custom event \"NoGame\" that is called if the user logs out without actually starting a game.",
      "pos": [
        11111,
        11230
      ]
    },
    {
      "content": "Why would a user do that?",
      "pos": [
        11231,
        11256
      ]
    },
    {
      "content": "Maybe if we drill into some specific occurrences, we'll get a clue.",
      "pos": [
        11257,
        11324
      ]
    },
    {
      "content": "The custom events received from the app are listed by name on the overview blade:",
      "pos": [
        11327,
        11408
      ]
    },
    {
      "content": "On the Overview blade, click one of the custom event types.",
      "pos": [
        11413,
        11472
      ]
    },
    {
      "content": "Click through the event of interest, and select a recent specific occurrence:",
      "pos": [
        11532,
        11609
      ]
    },
    {
      "content": "In the list under the summary chart, click an event",
      "pos": [
        11614,
        11665
      ]
    },
    {
      "content": "Let's look at all the telemetry for the session in which that particular NoGame event occurred.",
      "pos": [
        11727,
        11822
      ]
    },
    {
      "content": "Click 'all telemetry for session'",
      "pos": [
        11828,
        11861
      ]
    },
    {
      "content": "There were no exceptions, so the user wasn't prevented from playing by some failure.",
      "pos": [
        11927,
        12011
      ]
    },
    {
      "content": "We can filter out all types of telemetry except page views for this session:",
      "pos": [
        12014,
        12090
      ]
    },
    {
      "content": "And now we can see that this user logged in simply to check the latest scores.",
      "pos": [
        12151,
        12229
      ]
    },
    {
      "content": "Maybe we should consider developing a user story that makes it easier to do that.",
      "pos": [
        12230,
        12311
      ]
    },
    {
      "content": "(And we should implement a custom event to report when this specific story occurs.)",
      "pos": [
        12312,
        12395
      ]
    },
    {
      "content": "Filter, search and segment your data with properties",
      "pos": [
        12400,
        12452
      ]
    },
    {
      "content": "You can attach arbitrary tags and numeric values to events.",
      "pos": [
        12453,
        12512
      ]
    },
    {
      "content": "JavaScript at client",
      "pos": [
        12517,
        12537
      ]
    },
    {
      "content": "C# at server",
      "pos": [
        12812,
        12824
      ]
    },
    {
      "content": "VB at server",
      "pos": [
        13227,
        13239
      ]
    },
    {
      "content": "Attach properties to page views in the same way:",
      "pos": [
        13696,
        13744
      ]
    },
    {
      "content": "JavaScript at client",
      "pos": [
        13747,
        13767
      ]
    },
    {
      "content": "In Diagnostic Search, view the properties by clicking through an individual occurrence of an event.",
      "pos": [
        13905,
        14004
      ]
    },
    {
      "content": "In the list of events, open an event, and then click '...'",
      "pos": [
        14009,
        14067
      ]
    },
    {
      "content": "to see more properties",
      "pos": [
        14068,
        14090
      ]
    },
    {
      "content": "Use the Search field to see event occurrences with a particular property value.",
      "pos": [
        14147,
        14226
      ]
    },
    {
      "content": "Type a value into the Search field",
      "pos": [
        14231,
        14265
      ]
    },
    {
      "content": "A | B Testing",
      "pos": [
        14330,
        14343
      ]
    },
    {
      "content": "If you don't know which variant of a feature will be more successful, release both of them, making each accessible to different users.",
      "pos": [
        14345,
        14479
      ]
    },
    {
      "content": "Measure the success of each, and then move to a unified version.",
      "pos": [
        14480,
        14544
      ]
    },
    {
      "content": "For this technique, you attach distinct tags to all the telemetry that is sent by each version of your app.",
      "pos": [
        14546,
        14653
      ]
    },
    {
      "content": "You can do that by defining properties in the active TelemetryContext.",
      "pos": [
        14654,
        14724
      ]
    },
    {
      "content": "These default properties are added to every telemetry message that the application sends - not just your custom messages, but the standard telemetry as well.",
      "pos": [
        14725,
        14882
      ]
    },
    {
      "content": "In the Application Insights portal, you'll then be able to filter and group (segment) your data on the tags, so as to compare the different versions.",
      "pos": [
        14885,
        15034
      ]
    },
    {
      "content": "C# at server",
      "pos": [
        15037,
        15049
      ]
    },
    {
      "content": "VB at server",
      "pos": [
        15380,
        15392
      ]
    },
    {
      "content": "Individual telemetry can override the default values.",
      "pos": [
        15659,
        15712
      ]
    },
    {
      "content": "You can set up a universal initializer so that all new TelemetryClients automatically use your context.",
      "pos": [
        15714,
        15817
      ]
    },
    {
      "content": "In the app initializer such as Global.asax.cs:",
      "pos": [
        16073,
        16119
      ]
    },
    {
      "content": "Build - Measure - Learn",
      "pos": [
        16305,
        16328
      ]
    },
    {
      "content": "When you use analytics, it becomes an integrated part of your development cycle - not just something you think about to help solve problems.",
      "pos": [
        16330,
        16470
      ]
    },
    {
      "content": "Here are some tips:",
      "pos": [
        16471,
        16490
      ]
    },
    {
      "content": "Determine the key metric of your application.",
      "pos": [
        16494,
        16539
      ]
    },
    {
      "content": "Do you want as many users as possible, or would you prefer a small set of very happy users?",
      "pos": [
        16540,
        16631
      ]
    },
    {
      "content": "Do you want to maximize visits or sales?",
      "pos": [
        16632,
        16672
      ]
    },
    {
      "content": "Plan to measure each story.",
      "pos": [
        16675,
        16702
      ]
    },
    {
      "content": "When you sketch a new user story or feature, or plan to update an existing one, always think about how you will measure the success of the change.",
      "pos": [
        16703,
        16849
      ]
    },
    {
      "content": "Before coding starts, ask \"What effect will this have on our metrics, if it works?",
      "pos": [
        16850,
        16932
      ]
    },
    {
      "content": "Should we track any new events?\"",
      "pos": [
        16933,
        16965
      ]
    },
    {
      "content": "And of course, when the feature is live, make sure you look at the analytics and act on the results.",
      "pos": [
        16966,
        17066
      ]
    },
    {
      "content": "Relate other metrics to the key metric.",
      "pos": [
        17070,
        17109
      ]
    },
    {
      "content": "For example, if you add a \"favorites\" feature, you'd like to know how often users add favorites.",
      "pos": [
        17110,
        17206
      ]
    },
    {
      "content": "But it's perhaps more interesting to know how often they come back to their favorites.",
      "pos": [
        17207,
        17293
      ]
    },
    {
      "content": "And, most importantly, do customers who use favorites ultimately buy more of your product?",
      "pos": [
        17294,
        17384
      ]
    },
    {
      "content": "Canary testing.",
      "pos": [
        17387,
        17402
      ]
    },
    {
      "content": "Set up a feature switch that allows you to make a new feature visible only to some users.",
      "pos": [
        17403,
        17492
      ]
    },
    {
      "content": "Use Application Insights to see whether the new feature is being used in the way you envisaged.",
      "pos": [
        17493,
        17588
      ]
    },
    {
      "content": "Make adjustments, then release it to a wider audience.",
      "pos": [
        17589,
        17643
      ]
    },
    {
      "content": "Talk to your users!",
      "pos": [
        17646,
        17665
      ]
    },
    {
      "content": "Analytics is not enough on its own, but complementary to maintaining a good customer relationship.",
      "pos": [
        17666,
        17764
      ]
    },
    {
      "content": "References",
      "pos": [
        17770,
        17780
      ]
    },
    {
      "content": "[Using the API - overview][api]",
      "pos": [
        17784,
        17815
      ]
    },
    {
      "content": "JavaScript API reference",
      "pos": [
        17819,
        17843
      ]
    },
    {
      "content": "Video",
      "pos": [
        17931,
        17936
      ]
    },
    {
      "content": "test",
      "pos": [
        18448,
        18452
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Usage analysis for web applications with Application Insights\" \n    description=\"Overview of usage analytics with Application Insights\" \n    services=\"application-insights\" \n    documentationCenter=\"\"\n    authors=\"alancameronwills\" \n    manager=\"douge\"/>\n\n<tags \n    ms.service=\"application-insights\" \n    ms.workload=\"tbd\" \n    ms.tgt_pltfrm=\"ibiza\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"08/24/2015\" \n    ms.author=\"awills\"/>\n \n# Usage analysis for web applications with Application Insights\n\nKnowing how people use your application lets you focus your development work on the scenarios that are most important to them, and gain insights into the goals that they find easier or more difficult to achieve. \n\nVisual Studio Application Insights provides two levels of usage tracking:\n\n* **User, session and page view data** - provided out of the box.  \n* **Custom telemetry** - You [write code][api] to trace your users through your app's user experience. \n\n## Setting up\n\nUsage data from a web application comes from the client browser.\n\n#### Set up an Application Insights resource \n\nAn Application Insights resource is a place in Microsoft Azure where telemetry data from your app is analyzed and displayed. You might already have set up one to display data from your app's server side in [ASP.NET][greenbrown] or [J2EE][java]. If not, you might want to do that now.\n\nIt's usually best to display the usage data from the web client in the same resource as the data from the server. That way, you can easily correlate diagnostics and metrics from the two ends. So, if you already have a resource, skip to the next step.\n\n#### Insert code in your web pages\n\nIn your resource in the [Azure portal][portal] , open Quick Start get the code snippet to monitor web pages. \n\n![](./media/app-insights-web-track-usage/02-monitor-web-page.png)\n\nPut the code in a master page such as (in .NET) _Layout.cshtml, or in an include file, to make sure it is included in all your pages.\n\nThe code snippet includes the instrumentation key (iKey) that identifies your resource. To send data to a different resource - for example during testing - you only have to replace the iKey.\n\nPublish your web pages or use them in debug mode, to generate some telemetry data.\n\n\n## How popular is my web application?\n\nSign in to the [Azure portal][portal], browse to your application resource, and click Usage:\n\n![](./media/app-insights-web-track-usage/14-usage.png)\n\n* **Users:** The count of distinct active users over the time range of the chart. \n* **Sessions:** The count of active sessions\n* **Page views** Counts the number of calls to trackPageView(), typically called once in each web page.\n\nClick any of the charts to see more detail. Notice that you can change the time range of the charts.\n\n### Where do my users live?\n\nFrom the usage blade, click the Users chart to see more detail:\n\n![On the Usage blade, click the Users chart](./media/app-insights-web-track-usage/02-sessions.png)\n \n### What browsers or operating systems do they use?\n\nGroup (segment) data by a property such as Browser, Operating System, or City:\n\n![Select a chart that shows a single metric, switch on Grouping, and choose a property](./media/app-insights-web-track-usage/03-browsers.png)\n\n\n## Sessions\n\nSession is a fundamental concept in Application Insights, which strives to associate every telemetry event - such as requests, page views, exceptions, or custom events that you code yourself - with a specific user session. \n\nRich context information is collected about each session, such as device characteristics, geo location, operating system, and so on.\n\nIf you instrument both the client and server ([ASP.NET][greenbrown] or [J2EE][java]), the SDKs will propagate the session id between client and server, so that events on both sides can be correlated.\n\nWhen [diagnosing problems][diagnostic], you can find all the telemetry related to the session in which a problem occurred, including all requests, and any events, exceptions or traces that were logged.\n\nSessions provide a good measure of the popularity of contexts such as device, operating system or location. By showing the count of sessions grouped by device, for example, you get a more accurate count of how often that device is used with your app, than by counting page views. This would be a useful input to triage of any device-specific issue.\n\n\n#### What's a session?\n\nA session represents a single encounter between the user and the app. In its simplest form, session starts with a user launching the app and finishes when user leaves the app. For web apps, by default, the session terminates after 30 minutes of inactivity, or after 24 hours of activity. \n\nYou can alter these defaults by editing the code snippet:\n\n    <script type=\"text/javascript\">\n        var appInsights= ... { ... }({\n            instrumentationKey: \"...\",\n            sessionRenewalMs: 3600000,\n            sessionExpirationMs: 172800000\n        });\n\n* `sessionRenewalMs` : The time, in milliseconds, to expire the session due to user’s inactivity. Default: 30 minutes.\n* `sessionExpirationMs` : The maximum session length, in milliseconds. If the user remains active after this time, another session is counted. Default: 24 hours.\n\n**Session duration** is a [metric][metrics] that records the span of time between the first and last telemetry items of the session. (It doesn't include the timeout period.)\n\n**Session count** in a certain interval is defined as the number of unique sessions with some activity during this interval. When you look at a long time range such as daily session count for the past week, this is usually equivalent to the total number of sessions. \n\nHowever, when you explore shorter time ranges such as hourly grain, a long session spanning multiple hours will be counted for each hour in which the session was active. \n\n## Users and user counts\n\n\nEach user session is associated with a unique user id. \n\nBy default, the user is identified by placing a cookie. A user who uses multiple browsers or devices will be counted more than once. (But see [authenticated users](#authenticated-users)\n\n\nThe **user count** metric in a certain interval is defined as the number of unique users with recorded activity during this interval. As a result, users with long sessions may be accounted multiple times, when you set a time range so that the grain is less than an hour or so.\n\n**New Users** counts the users whose first sessions with the app occurred during this interval. If the default method of counting by users by cookies is used, then this will also include users who have cleared their cookies, or who are using a new device or browser to access your app for the first time.\n![From the usage blade, click on Users chart to examine New Users.](./media/app-insights-web-track-usage/031-dual.png)\n\n### Authenticated users\n\nIf your web app lets users sign in, you can get a more accurate count by providing Application Insights with a unique user identifier. It doesn't have to be their name, or the same id that you use in your app. As soon as your app has identified the user, use this code:\n\n\n*JavaScript at client*\n\n      appInsights.setAuthenticatedUserContext(userId);\n\nIf your app groups users into accounts, you can also pass an identifier for the account. \n\n      appInsights.setAuthenticatedUserContext(userId, accountId);\n\nThe user and account ids must not contain spaces or the characters `,;=|`\n\n\nIn [metrics explorer](app-insights-metrics-explorer.md), you can create a chart of **Authenticated Users** and **Accounts**. \n\n## Synthetic traffic\n\nSynthetic traffic includes requests from availability and load tests, search engine crawlers and other agents. \n\nApplication Insights tries strives to automatically determine and classify synthetic traffic and mark it appropriately. In most cases, synthetic traffic does not invoke the JavaScript SDK, so that this activity is excluded from user and session counting. \n\nHowever, for Application Insights [web tests][availability], the user id is automatically set based on POP location, and session id is set based on test run id. In default reports, synthetic traffic is filtered out by default, which will exclude these users and sessions. However, when synthetic traffic is included, it may cause a small increase in overall users and session counts.\n \n## Page usage\n\nClick through the page views chart to get a more zoomed-in version together with a breakdown of your most popular pages:\n\n\n![From the Overview blade, click the Page views chart](./media/app-insights-web-track-usage/05-games.png)\n \nThe example above is from a games website. From it we can instantly see:\n\n* Usage hasn't improved in the past week. Maybe we should think about search engine optimization?\n* Many fewer people see the games pages than the Home page. Why doesn't our Home page attract people to play games?\n* 'Crossword' is the most popular game. We should give priority to new ideas and improvements there.\n\n## Custom tracking\n\nLet's suppose that instead of implementing each game in a separate web page, you decide to refactor them all into the same single-page app, with most of the functionality coded as Javascript in the web page. This allows the user to switch quickly between one game and another, or even have several games on one page. \n\nBut you'd still like Application Insights to log the number of times each game is opened, in exactly the same way as when they were on separate web pages. That's easy: just insert a call to the telemetry module into your JavaScript where you want to record that a new 'page' has opened:\n\n    appInsights.trackPageView(game.Name);\n\n## Custom events\n\nUse custom events to . You can send them from device apps, web pages or a web server:\n\n*JavaScript*\n\n    appInsights.trackEvent(\"GameEnd\");\n\n*C#*\n\n    var tc = new Microsoft.ApplicationInsights.TelemetryClient(); \n    tc.TrackEvent(\"GameEnd\");\n\n*VB*\n\n    Dim tc = New Microsoft.ApplicationInsights.TelemetryClient()\n    tc.TrackEvent(\"GameEnd\")\n\n\nThe most frequent custom events are listed on the overview blade.\n\n![On the Overview blade, scroll down to and click Custom Events.](./media/app-insights-web-track-usage/04-events.png)\n\nClick the head of the table to see total numbers of events. You can segment the chart by various attributes such as the event name: \n\n![Select a chart that shows just one metric. Switch on Grouping. Choose a property. Not all properties are available.](./media/app-insights-web-track-usage/06-eventsSegment.png)\n\nThe particularly useful feature of timelines is that you can correlate changes with other metrics and events. For example, at times when more games are played, you'd expect to see a rise in abandoned games as well. But the rise in abandoned games is disproportionate, you'd want to find out whether the high load is causing problems that users find unacceptable.\n\n## Drill into specific events\n\nTo get a better understanding of how a typical session goes, you might want to focus on a specific user session that contains a particular type of event. \n\nIn this example, we coded a custom event \"NoGame\" that is called if the user logs out without actually starting a game. Why would a user do that? Maybe if we drill into some specific occurrences, we'll get a clue. \n\nThe custom events received from the app are listed by name on the overview blade:\n\n\n![On the Overview blade, click one of the custom event types.](./media/app-insights-web-track-usage/07-clickEvent.png)\n \nClick through the event of interest, and select a recent specific occurrence:\n\n\n![In the list under the summary chart, click an event](./media/app-insights-web-track-usage/08-searchEvents.png)\n \nLet's look at all the telemetry for the session in which that particular NoGame event occurred. \n\n\n![Click 'all telemetry for session'](./media/app-insights-web-track-usage/09-relatedTelemetry.png)\n \nThere were no exceptions, so the user wasn't prevented from playing by some failure.\n \nWe can filter out all types of telemetry except page views for this session:\n\n\n![](./media/app-insights-web-track-usage/10-filter.png)\n \nAnd now we can see that this user logged in simply to check the latest scores. Maybe we should consider developing a user story that makes it easier to do that. (And we should implement a custom event to report when this specific story occurs.)\n\n## Filter, search and segment your data with properties\nYou can attach arbitrary tags and numeric values to events.\n \n\n*JavaScript at client*\n\n```JavaScript\n\n    appInsights.trackEvent(\"WinGame\",\n        // String properties:\n        {Game: currentGame.name, Difficulty: currentGame.difficulty},\n        // Numeric measurements:\n        {Score: currentGame.score, Opponents: currentGame.opponentCount}\n    );\n```\n\n*C# at server*\n\n```C#\n\n    // Set up some properties:\n    var properties = new Dictionary <string, string> \n        {{\"game\", currentGame.Name}, {\"difficulty\", currentGame.Difficulty}};\n    var measurements = new Dictionary <string, double>\n        {{\"Score\", currentGame.Score}, {\"Opponents\", currentGame.OpponentCount}};\n\n    // Send the event:\n    telemetry.TrackEvent(\"WinGame\", properties, measurements);\n```\n\n*VB at server*\n\n```VB\n\n    ' Set up some properties:\n    Dim properties = New Dictionary (Of String, String)\n    properties.Add(\"game\", currentGame.Name)\n    properties.Add(\"difficulty\", currentGame.Difficulty)\n\n    Dim measurements = New Dictionary (Of String, Double)\n    measurements.Add(\"Score\", currentGame.Score)\n    measurements.Add(\"Opponents\", currentGame.OpponentCount)\n\n    ' Send the event:\n    telemetry.TrackEvent(\"WinGame\", properties, measurements)\n```\n\nAttach properties to page views in the same way:\n\n*JavaScript at client*\n\n```JS\n\n    appInsights.trackPageView(\"Win\", \n        url,\n        {Game: currentGame.Name}, \n        {Score: currentGame.Score});\n```\n\nIn Diagnostic Search, view the properties by clicking through an individual occurrence of an event.\n\n\n![In the list of events, open an event, and then click '...' to see more properties](./media/app-insights-web-track-usage/11-details.png)\n \nUse the Search field to see event occurrences with a particular property value.\n\n\n![Type a value into the Search field](./media/app-insights-web-track-usage/12-searchEvents.png)\n\n\n## A | B Testing\n\nIf you don't know which variant of a feature will be more successful, release both of them, making each accessible to different users. Measure the success of each, and then move to a unified version.\n\nFor this technique, you attach distinct tags to all the telemetry that is sent by each version of your app. You can do that by defining properties in the active TelemetryContext. These default properties are added to every telemetry message that the application sends - not just your custom messages, but the standard telemetry as well. \n\nIn the Application Insights portal, you'll then be able to filter and group (segment) your data on the tags, so as to compare the different versions.\n\n*C# at server*\n\n```C#\n\n    using Microsoft.ApplicationInsights.DataContracts;\n\n    var context = new TelemetryContext();\n    context.Properties[\"Game\"] = currentGame.Name;\n    var telemetry = new TelemetryClient(context);\n    // Now all telemetry will automatically be sent with the context property:\n    telemetry.TrackEvent(\"WinGame\");\n```\n\n*VB at server*\n\n```VB\n\n    Dim context = New TelemetryContext\n    context.Properties(\"Game\") = currentGame.Name\n    Dim telemetry = New TelemetryClient(context)\n    ' Now all telemetry will automatically be sent with the context property:\n    telemetry.TrackEvent(\"WinGame\")\n```\n\nIndividual telemetry can override the default values.\n\nYou can set up a universal initializer so that all new TelemetryClients automatically use your context.\n\n```C#\n\n    // Telemetry initializer class\n    public class MyTelemetryInitializer : IContextInitializer\n    {\n        public void Initialize (TelemetryContext context)\n        {\n            context.Properties[\"AppVersion\"] = \"v2.1\";\n        }\n    }\n```\n\nIn the app initializer such as Global.asax.cs:\n\n```C#\n\n    protected void Application_Start()\n    {\n        // ...\n        TelemetryConfiguration.Active.ContextInitializers\n        .Add(new MyTelemetryInitializer());\n    }\n```\n\n\n## Build - Measure - Learn\n\nWhen you use analytics, it becomes an integrated part of your development cycle - not just something you think about to help solve problems. Here are some tips:\n\n* Determine the key metric of your application. Do you want as many users as possible, or would you prefer a small set of very happy users? Do you want to maximize visits or sales?\n* Plan to measure each story. When you sketch a new user story or feature, or plan to update an existing one, always think about how you will measure the success of the change. Before coding starts, ask \"What effect will this have on our metrics, if it works? Should we track any new events?\"\nAnd of course, when the feature is live, make sure you look at the analytics and act on the results. \n* Relate other metrics to the key metric. For example, if you add a \"favorites\" feature, you'd like to know how often users add favorites. But it's perhaps more interesting to know how often they come back to their favorites. And, most importantly, do customers who use favorites ultimately buy more of your product?\n* Canary testing. Set up a feature switch that allows you to make a new feature visible only to some users. Use Application Insights to see whether the new feature is being used in the way you envisaged. Make adjustments, then release it to a wider audience.\n* Talk to your users! Analytics is not enough on its own, but complementary to maintaining a good customer relationship.\n\n\n## References\n\n* [Using the API - overview][api]\n* [JavaScript API reference](https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md)\n\n## Video\n\n> [AZURE.VIDEO usage-monitoring-application-insights]\n\n\n<!--Link references-->\n\n[api]: app-insights-api-custom-events-metrics.md\n[availability]: app-insights-monitor-web-app-availability.md\n[client]: app-insights-javascript.md\n[diagnostic]: app-insights-diagnostic-search.md\n[greenbrown]: app-insights-start-monitoring-app-health-usage.md\n[java]: app-insights-java-get-started.md\n[metrics]: app-insights-metrics-explorer.md\n[portal]: http://portal.azure.com/\n[windows]: app-insights-windows-get-started.md\n\n \n\ntest\n"
}