{
  "nodes": [
    {
      "content": "Using the Microsoft Azure CLI for Mac, Linux, and Windows with Azure Resource Management | Microsoft Azure",
      "pos": [
        27,
        133
      ]
    },
    {
      "content": "Using the Microsoft Azure CLI for Mac, Linux, and Windows with Azure Resource Manager.",
      "pos": [
        152,
        238
      ]
    },
    {
      "content": "Use the Azure CLI for Mac, Linux, and Windows with Azure Resource Manager",
      "pos": [
        585,
        658
      ]
    },
    {
      "content": "[AZURE.SELECTOR]",
      "pos": [
        662,
        678
      ]
    },
    {
      "content": "Azure PowerShell",
      "pos": [
        682,
        698
      ]
    },
    {
      "content": "Azure CLI",
      "pos": [
        744,
        753
      ]
    },
    {
      "content": "This article describes how to create, manage, and delete Azure resources and VMs using the Azure CLI for Mac, Linux, and Windows using the Azure Resource Manager mode.",
      "pos": [
        794,
        961
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> To create and manage Azure resources on the command line, you will need an Azure account (<bpt id=\"p1\">[</bpt>free trial here<ept id=\"p1\">](http://azure.microsoft.com/pricing/free-trial/)</ept>).",
      "pos": [
        966,
        1136
      ]
    },
    {
      "content": "You will also need to <bpt id=\"p1\">[</bpt>install the Azure CLI<ept id=\"p1\">](../xplat-cli-install.md)</ept>, and to <bpt id=\"p2\">[</bpt>log on to use Azure resources associated with your account<ept id=\"p2\">](../xplat-cli-connect.md)</ept>.",
      "pos": [
        1137,
        1302
      ]
    },
    {
      "content": "If you've done these things, you're ready to go.",
      "pos": [
        1303,
        1351
      ]
    },
    {
      "content": "Azure resources",
      "pos": [
        1356,
        1371
      ]
    },
    {
      "content": "Use the Azure Resource Manager to manage a group of <bpt id=\"p1\">_</bpt>resources<ept id=\"p1\">_</ept> (user-managed entities such as a virtual machine, database server, database, or website) as a single logical unit, or <bpt id=\"p2\">_</bpt>resource group<ept id=\"p2\">_</ept>.",
      "pos": [
        1373,
        1572
      ]
    },
    {
      "content": "You can create, manage, and delete these resources imperatively on the command line, just like you can in the asm mode.",
      "pos": [
        1573,
        1692
      ]
    },
    {
      "content": "Using the Azure Resoure Manager mode, you can also manage your Azure resources in a <bpt id=\"p1\">_</bpt>declarative<ept id=\"p1\">_</ept> way by describing the structure and relationships of a deployable group of resources in JSON <bpt id=\"p2\">*</bpt>templates<ept id=\"p2\">*</ept>.",
      "pos": [
        1694,
        1897
      ]
    },
    {
      "content": "The template describes parameters that can be filled in either inline when running a command or stored in a separate JSON azuredeploy-parameters.json file.",
      "pos": [
        1898,
        2053
      ]
    },
    {
      "content": "This allows you to easily create new resources using the same template by simply providing different parameters.",
      "pos": [
        2054,
        2166
      ]
    },
    {
      "content": "For example, a template that creates a website will have parameters for the site name, the region the website will be located in, and other common parameters.",
      "pos": [
        2167,
        2325
      ]
    },
    {
      "content": "When a template is used to modify or create a group, a <bpt id=\"p1\">_</bpt>deployment<ept id=\"p1\">_</ept> is created, which is then applied to the group.",
      "pos": [
        2327,
        2442
      ]
    },
    {
      "content": "For more information on the Azure Resource Manager, visit the <bpt id=\"p1\">[</bpt>Azure Resource Manager Overview<ept id=\"p1\">](../resource-group-overview.md)</ept>.",
      "pos": [
        2443,
        2570
      ]
    },
    {
      "content": "Authentication",
      "pos": [
        2575,
        2589
      ]
    },
    {
      "content": "Working with the Azure Resource Manager through the Azure CLI requires that you authenticate to Microsoft Azure using a work or school account.",
      "pos": [
        2591,
        2734
      ]
    },
    {
      "content": "Authenticating with a certificate installed through a .publishsettings file will not work.",
      "pos": [
        2735,
        2825
      ]
    },
    {
      "pos": [
        2827,
        2981
      ],
      "content": "For more information on authenticating using a work or school account, see <bpt id=\"p1\">[</bpt>Connect to an Azure subscription from the Azure CLI<ept id=\"p1\">](../xplat-cli-connect.md)</ept>."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Because you use a work or school account -- which is managed by Azure Active Directory -- you can also use Azure Role-Based Access Control (RBAC) to manage access and usage of Azure resources.",
      "pos": [
        2985,
        3190
      ]
    },
    {
      "content": "For details, see <bpt id=\"p1\">[</bpt>Managing and Auditing Access to Resources<ept id=\"p1\">](../resource-group-rbac.md)</ept>.",
      "pos": [
        3191,
        3279
      ]
    },
    {
      "content": "Setting the Azure Resource Manager mode",
      "pos": [
        3284,
        3323
      ]
    },
    {
      "content": "Because the Azure Resource Manager mode is not enabled by default, you must use the following command to enable Azure CLI Resource Manager commands.",
      "pos": [
        3325,
        3473
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The Azure Resource Manager mode and Azure Service Management mode are mutually exclusive.",
      "pos": [
        3503,
        3605
      ]
    },
    {
      "content": "That is, resources created in one mode cannot be managed from the other mode.",
      "pos": [
        3606,
        3683
      ]
    },
    {
      "content": "Finding the locations",
      "pos": [
        3688,
        3709
      ]
    },
    {
      "content": "Most of the Azure Resource Manager commands need a valid location to create or find a resource from.",
      "pos": [
        3711,
        3811
      ]
    },
    {
      "content": "You can find all available locations by using the following command.",
      "pos": [
        3812,
        3880
      ]
    },
    {
      "content": "It will list locations specific to regions such as \"West US\", \"East US\", and so on.",
      "pos": [
        3907,
        3990
      ]
    },
    {
      "content": "Creating resource group",
      "pos": [
        3995,
        4018
      ]
    },
    {
      "content": "A resource group is a logical grouping of network, storage and other resources.",
      "pos": [
        4020,
        4099
      ]
    },
    {
      "content": "Almost all commands in the Azure Resource Manager mode need a resource group.",
      "pos": [
        4100,
        4177
      ]
    },
    {
      "content": "You can create a resource group named <bpt id=\"p1\">_</bpt>testrg<ept id=\"p1\">_</ept>, for example, by using the following command.",
      "pos": [
        4178,
        4270
      ]
    },
    {
      "content": "You can start adding resources to this group after this, and use it to configure a new virtual machine.",
      "pos": [
        4321,
        4424
      ]
    },
    {
      "content": "Creating virtual machines",
      "pos": [
        4429,
        4454
      ]
    },
    {
      "content": "There are two ways to create virtual machines in the Azure Resource Manager mode:",
      "pos": [
        4456,
        4537
      ]
    },
    {
      "content": "Using individual Azure CLI commands.",
      "pos": [
        4542,
        4578
      ]
    },
    {
      "content": "Using resource group templates.",
      "pos": [
        4582,
        4613
      ]
    },
    {
      "content": "Be sure to create at least one resource group before you start with any of these methods.",
      "pos": [
        4615,
        4704
      ]
    },
    {
      "content": "Using individual Azure CLI commands",
      "pos": [
        4710,
        4745
      ]
    },
    {
      "content": "This is the basic approach to configure and create a virtual machine as per your needs.",
      "pos": [
        4747,
        4834
      ]
    },
    {
      "content": "In the Azure Resource Manager mode, you will need to configure some mandatory resources like the networking before you can use the <bpt id=\"p1\">**</bpt>vm create<ept id=\"p1\">**</ept> command.",
      "pos": [
        4835,
        4988
      ]
    },
    {
      "pos": [
        4991,
        5280
      ],
      "content": "[AZURE.NOTE] If you are creating resources for the first time on the command line for your subscription, you might be prompted to register for certain resource providers.\nIf that happens, it is easy to register the provider and try the failed command again, as shown in the next example.",
      "leadings": [
        "",
        "> "
      ],
      "nodes": [
        {
          "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you are creating resources for the first time on the command line for your subscription, you might be prompted to register for certain resource providers.",
          "pos": [
            0,
            170
          ]
        },
        {
          "content": "If that happens, it is easy to register the provider and try the failed command again, as shown in the next example.",
          "pos": [
            171,
            287
          ]
        }
      ]
    },
    {
      "content": "You can find out the list of providers registered for your subscription by running the following command.",
      "pos": [
        5333,
        5438
      ]
    },
    {
      "content": "Creating a public IP resource",
      "pos": [
        5472,
        5501
      ]
    },
    {
      "content": "You will need to create a public IP so you can SSH into your new virtual machine for any meaningful work.",
      "pos": [
        5503,
        5608
      ]
    },
    {
      "content": "Creating a public IP is straightforward.",
      "pos": [
        5609,
        5649
      ]
    },
    {
      "content": "The command needs a resource group, a name for your public IP resource, and a location, in that order.",
      "pos": [
        5650,
        5752
      ]
    },
    {
      "content": "Creating a Network Interface Card resource",
      "pos": [
        5822,
        5864
      ]
    },
    {
      "content": "The Network Interface Card or NIC needs a subnet and a virtual network to be created first.",
      "pos": [
        5866,
        5957
      ]
    },
    {
      "content": "Create a virtual network in a particular location and resource group by using the <bpt id=\"p1\">**</bpt>network vnet create<ept id=\"p1\">**</ept> command.",
      "pos": [
        5958,
        6072
      ]
    },
    {
      "pos": [
        6134,
        6239
      ],
      "content": "You can then create a subnet in this virtual network by using the <bpt id=\"p1\">**</bpt>network vnet subnet create<ept id=\"p1\">**</ept> command."
    },
    {
      "pos": [
        6312,
        6409
      ],
      "content": "You should be able to create a NIC using these resources with the <bpt id=\"p1\">**</bpt>network nic create<ept id=\"p1\">**</ept> command."
    },
    {
      "pos": [
        6512,
        6759
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Although optional, it is very important to pass the public IP name as a parameter to the <bpt id=\"p1\">**</bpt>network nic create<ept id=\"p1\">**</ept> command as this binds the NIC to this IP, which will be later used to SSH into the virtual machine created using this NIC."
    },
    {
      "pos": [
        6761,
        6916
      ],
      "content": "For more imformation on the <bpt id=\"p1\">**</bpt>network<ept id=\"p1\">**</ept> commands, see command-line help or <bpt id=\"p2\">[</bpt>Using the Azure CLI with Azure Resource Management<ept id=\"p2\">](azure-cli-arm-commands.md)</ept>."
    },
    {
      "content": "Finding the operating system image",
      "pos": [
        6923,
        6957
      ]
    },
    {
      "content": "Currently, you can only find an operating system based on the publisher of the image.",
      "pos": [
        6959,
        7044
      ]
    },
    {
      "content": "In other words, you must run the following command to find a list of OS image publishers in your desired location.",
      "pos": [
        7045,
        7159
      ]
    },
    {
      "content": "Then choose a publisher from the list, and find the list of images by that publisher by running the following command.",
      "pos": [
        7206,
        7324
      ]
    },
    {
      "content": "Finally, choose an OS image from the list that looks something like the following example.",
      "pos": [
        7369,
        7459
      ]
    },
    {
      "content": "Save the URN name of the image you want to load on your virtual machine.",
      "pos": [
        8083,
        8155
      ]
    },
    {
      "content": "You'll use it later in the article.",
      "pos": [
        8156,
        8191
      ]
    },
    {
      "content": "Creating a virtual machine",
      "pos": [
        8198,
        8224
      ]
    },
    {
      "content": "You are now ready to create a virtual machine by running the <bpt id=\"p1\">**</bpt>vm create<ept id=\"p1\">**</ept> command and passing the required information.",
      "pos": [
        8226,
        8346
      ]
    },
    {
      "content": "It's optional to pass the public IP at this stage, since the NIC already has this information.",
      "pos": [
        8347,
        8441
      ]
    },
    {
      "content": "Your command may look something like the following example, where <bpt id=\"p1\">_</bpt>testvm<ept id=\"p1\">_</ept> is the name of the virtual machine created in the <bpt id=\"p2\">_</bpt>testrg<ept id=\"p2\">_</ept> resource group.",
      "pos": [
        8442,
        8591
      ]
    },
    {
      "content": "You should be able to start this virtual machine by running the following command.",
      "pos": [
        9304,
        9386
      ]
    },
    {
      "content": "Then SSH into it by using the <bpt id=\"p1\">**</bpt>ssh username@ipaddress<ept id=\"p1\">**</ept> command.",
      "pos": [
        9426,
        9491
      ]
    },
    {
      "content": "To quickly look up the IP address of your public IP resource, use the following command.",
      "pos": [
        9492,
        9580
      ]
    },
    {
      "content": "Managing this virtual machine is easy with <bpt id=\"p1\">**</bpt>vm<ept id=\"p1\">**</ept> commands.",
      "pos": [
        9634,
        9693
      ]
    },
    {
      "content": "For more information, visit <bpt id=\"p1\">[</bpt>Using the Azure CLI with Azure Resource Management<ept id=\"p1\">](azure-cli-arm-commands.md)</ept>.",
      "pos": [
        9694,
        9802
      ]
    },
    {
      "content": "vm quick-create shortcut",
      "pos": [
        9808,
        9832
      ]
    },
    {
      "content": "The new <bpt id=\"p1\">**</bpt>vm quick-create<ept id=\"p1\">**</ept> shortcut cuts out most of the steps of the imperative method of VM creation.",
      "pos": [
        9834,
        9938
      ]
    },
    {
      "content": "This is handy when you want to try out creating simple virtual machines or if you do not care about the networking configurations.",
      "pos": [
        9939,
        10069
      ]
    },
    {
      "content": "It's an interactive command, and you need to find out only the OS image URN before running it.",
      "pos": [
        10070,
        10164
      ]
    },
    {
      "content": "The Azure CLI will create a virtual machine with default VM size.",
      "pos": [
        10562,
        10627
      ]
    },
    {
      "content": "It will also create a storage account, a NIC, a virtual network and subnet, and a public IP.",
      "pos": [
        10628,
        10720
      ]
    },
    {
      "content": "You can SSH into the virtual machine using the public IP after it boots.",
      "pos": [
        10721,
        10793
      ]
    },
    {
      "content": "Using resource group templates",
      "pos": [
        10799,
        10829
      ]
    },
    {
      "content": "Locating and configuring a resource group template",
      "pos": [
        10836,
        10886
      ]
    },
    {
      "content": "When working with templates, you can either create your own, or use one from the Template Gallery, or use templates available on <bpt id=\"p1\">[</bpt>GitHub<ept id=\"p1\">](https://github.com/azurermtemplates/azurermtemplates)</ept>.",
      "pos": [
        10891,
        11083
      ]
    },
    {
      "content": "To start with, let's use a template named CoreOS.CoreOSStable.0.2.40-preview from the Template Gallery.",
      "pos": [
        11084,
        11187
      ]
    },
    {
      "content": "To list available templates from the gallery, use the following command.",
      "pos": [
        11188,
        11260
      ]
    },
    {
      "content": "As there are thousands of templates available, you can paginate the results or use <bpt id=\"p1\">**</bpt>grep<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>findstr<ept id=\"p2\">**</ept> (on Windows) or your favorite string-searching command to locate interesting templates.",
      "pos": [
        11261,
        11455
      ]
    },
    {
      "content": "Alternatively, you can use the <bpt id=\"p1\">**</bpt>--json<ept id=\"p1\">**</ept> option and download the entire list in JSON format for easier searching.",
      "pos": [
        11456,
        11570
      ]
    },
    {
      "content": "The response will list the publisher and template name, and will appear similar to the following example (although there will be far more).",
      "pos": [
        11611,
        11750
      ]
    },
    {
      "content": "To view the details of the template, use the following command.",
      "pos": [
        12239,
        12302
      ]
    },
    {
      "content": "This will return descriptive information about the template.",
      "pos": [
        12378,
        12438
      ]
    },
    {
      "content": "The template we are using will create a Linux virtual machine.",
      "pos": [
        12439,
        12501
      ]
    },
    {
      "content": "Once you have selected a template, you can download it with the following command.",
      "pos": [
        12506,
        12588
      ]
    },
    {
      "content": "Downloading a template allows you to customize it to better suite your requirements.",
      "pos": [
        12668,
        12752
      ]
    },
    {
      "content": "For example, adding another resource to the template.",
      "pos": [
        12753,
        12806
      ]
    },
    {
      "pos": [
        12813,
        12990
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you modify the template, use the <ph id=\"ph2\">`azure group template validate`</ph> command to validate the template before using it to create or modify an existing resource group."
    },
    {
      "content": "To configure the resource group template for your use, open the template file in a text editor.",
      "pos": [
        12995,
        13090
      ]
    },
    {
      "content": "Note the <bpt id=\"p1\">**</bpt>parameters<ept id=\"p1\">**</ept> JSON collection near the top.",
      "pos": [
        13091,
        13144
      ]
    },
    {
      "content": "This contains a list of the parameters that this template expects in order to create the resources described by the template.",
      "pos": [
        13145,
        13270
      ]
    },
    {
      "content": "Some parameters might have default values, while others specify either the type of the value or a range of allowed values.",
      "pos": [
        13271,
        13393
      ]
    },
    {
      "content": "When using a template, you can supply parameters either as part of the command-line parameters, or by specifying a file containing the parameter values.",
      "pos": [
        13399,
        13551
      ]
    },
    {
      "content": "You can also write your <bpt id=\"p1\">**</bpt>value<ept id=\"p1\">**</ept> fields directly inside the <bpt id=\"p2\">**</bpt>parameters<ept id=\"p2\">**</ept> section in the template, although that would make the template tightly bound to a particular deployment and wouldn't be reusable easily.",
      "pos": [
        13552,
        13764
      ]
    },
    {
      "content": "Either way, the parameters must be in JSON format, and you must provide your own values for those keys that do not have default values.",
      "pos": [
        13765,
        13900
      ]
    },
    {
      "content": "For example, to create a file that contains parameters for the CoreOS.CoreOSStable.0.2.40-preview template, use the following data to create a file named params.json.",
      "pos": [
        13906,
        14072
      ]
    },
    {
      "content": "Replace the values used in this sample with your own values.",
      "pos": [
        14073,
        14133
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Location<ept id=\"p1\">**</ept> should specify an Azure region near you, such as <bpt id=\"p2\">**</bpt>North Europe<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>South Central US<ept id=\"p3\">**</ept>.",
      "pos": [
        14134,
        14241
      ]
    },
    {
      "content": "(This example uses <bpt id=\"p1\">**</bpt>West US<ept id=\"p1\">**</ept>).",
      "pos": [
        14242,
        14274
      ]
    },
    {
      "content": "After saving the params.json file, use the following command to create a new resource group based on the template.",
      "pos": [
        14970,
        15084
      ]
    },
    {
      "content": "The <ph id=\"ph1\">`-e`</ph> parameter specifies the params.json file created in the previous step.",
      "pos": [
        15085,
        15164
      ]
    },
    {
      "content": "Replace the <bpt id=\"p1\">**</bpt>testRG<ept id=\"p1\">**</ept> with the group name you wish to use, and <bpt id=\"p2\">**</bpt>testDeploy<ept id=\"p2\">**</ept> with your deployment name.",
      "pos": [
        15165,
        15270
      ]
    },
    {
      "content": "The location should be same as the one specified in your params.json template parameter file.",
      "pos": [
        15271,
        15364
      ]
    },
    {
      "content": "This command will return OK once the deployment is uploaded, but before the deployment is applied to resources in the group.",
      "pos": [
        15491,
        15615
      ]
    },
    {
      "content": "To check the status of the deployment, use the following command.",
      "pos": [
        15616,
        15681
      ]
    },
    {
      "pos": [
        15746,
        15807
      ],
      "content": "The <bpt id=\"p1\">**</bpt>ProvisioningState<ept id=\"p1\">**</ept> shows the status of the deployment."
    },
    {
      "content": "If your deployment was successful, you will see an output similar to the following example.",
      "pos": [
        15813,
        15904
      ]
    },
    {
      "pos": [
        17084,
        17221
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you realize that your configuration isn't correct, and need to stop a long running deployment, use the following command."
    },
    {
      "content": "If you do not provide a deployment name, one will be created automatically based on the name of the template file.",
      "pos": [
        17298,
        17412
      ]
    },
    {
      "content": "It will be returned as part of the output of the <ph id=\"ph1\">`azure group create`</ph> command.",
      "pos": [
        17413,
        17491
      ]
    },
    {
      "content": "To view the group, use the following command.",
      "pos": [
        17496,
        17541
      ]
    },
    {
      "content": "This command returns information about the resources in the group.",
      "pos": [
        17582,
        17648
      ]
    },
    {
      "content": "If you have multiple groups, you can use the <ph id=\"ph1\">`azure group list`</ph> command to retrieve a list of group names, and then use <ph id=\"ph2\">`azure group show`</ph> to view details of a specific group.",
      "pos": [
        17649,
        17824
      ]
    },
    {
      "content": "You can also use latest templates directly from GitHub, instead of downloading from the template library.",
      "pos": [
        17829,
        17934
      ]
    },
    {
      "content": "Open <bpt id=\"p1\">[</bpt>GitHub.com<ept id=\"p1\">](http://www.github.com)</ept> and search for AzureRmTemplates.",
      "pos": [
        17935,
        18008
      ]
    },
    {
      "content": "Select the AzureRmTemplates repository and look for any templates that you find interesting, for example, <bpt id=\"p1\">_</bpt>101-simple-vm-from-image<ept id=\"p1\">_</ept>.",
      "pos": [
        18009,
        18142
      ]
    },
    {
      "content": "If you click the template, you will see it contains azuredeploy.json among other files.",
      "pos": [
        18143,
        18230
      ]
    },
    {
      "content": "This is the template you want to use in your command by using a <bpt id=\"p1\">**</bpt>--template-url<ept id=\"p1\">**</ept> option.",
      "pos": [
        18231,
        18321
      ]
    },
    {
      "content": "Open it in <bpt id=\"p1\">_</bpt>raw<ept id=\"p1\">_</ept> mode, and copy the URL that appears in the browser's address bar.",
      "pos": [
        18322,
        18404
      ]
    },
    {
      "content": "You can then use this URL directly to create a deployment, instead of downloading from a template library, by using a command similar to the following example.",
      "pos": [
        18405,
        18564
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> It is important to open the json template in <bpt id=\"p1\">_</bpt>raw<ept id=\"p1\">_</ept> mode.",
      "pos": [
        18779,
        18848
      ]
    },
    {
      "content": "The URL that appears in the browser's address bar is different from the one that appears in regular mode.",
      "pos": [
        18849,
        18954
      ]
    },
    {
      "content": "To open the file in <bpt id=\"p1\">_</bpt>raw<ept id=\"p1\">_</ept> mode when viewing the file on GitHub, in the upper-right corner click <bpt id=\"p2\">**</bpt>Raw<ept id=\"p2\">**</ept>.",
      "pos": [
        18955,
        19059
      ]
    },
    {
      "content": "Working with resources",
      "pos": [
        19066,
        19088
      ]
    },
    {
      "content": "While templates allow you to declare group-wide changes in configuration, sometimes you need to work with just a specific resource.",
      "pos": [
        19090,
        19221
      ]
    },
    {
      "content": "You can do this using the <ph id=\"ph1\">`azure resource`</ph> commands.",
      "pos": [
        19222,
        19274
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> When using the <ph id=\"ph2\">`azure resource`</ph> commands other than the <ph id=\"ph3\">`list`</ph> command, you must specify the API version of the resource you are working with using the <ph id=\"ph4\">`-o`</ph> parameter.",
      "pos": [
        19278,
        19458
      ]
    },
    {
      "content": "If you are unsure about the API version to use, consult the template file and find the <bpt id=\"p1\">**</bpt>apiVersion<ept id=\"p1\">**</ept> field for the resource.",
      "pos": [
        19459,
        19584
      ]
    },
    {
      "content": "To list all resources in a group, use the following command.",
      "pos": [
        19589,
        19649
      ]
    },
    {
      "content": "To view individual resources, within the group, use the following command.",
      "pos": [
        19692,
        19766
      ]
    },
    {
      "content": "Notice the <bpt id=\"p1\">**</bpt>Microsoft.ClassicCompute/virtualMachines<ept id=\"p1\">**</ept> parameter.",
      "pos": [
        19878,
        19944
      ]
    },
    {
      "content": "This indicates the type of the resource you are requesting information on.",
      "pos": [
        19945,
        20019
      ]
    },
    {
      "content": "If you look at the template file downloaded earlier, you will notice that this same value is used to define the type of the virtual machine resource described in the template.",
      "pos": [
        20020,
        20195
      ]
    },
    {
      "content": "This command returns information related to the virtual machine.",
      "pos": [
        20201,
        20265
      ]
    },
    {
      "content": "When viewing details on a resource, it is often useful to use the <ph id=\"ph1\">`--json`</ph> parameter, as this makes the output more readable as some values are nested structures, or collections.",
      "pos": [
        20270,
        20448
      ]
    },
    {
      "content": "The following example demonstrates returning the results of the <bpt id=\"p1\">**</bpt>show<ept id=\"p1\">**</ept> command as a JSON document.",
      "pos": [
        20449,
        20549
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You can save the JSON data to file by using the &amp;gt; character to pipe the output to file.",
      "pos": [
        20669,
        20772
      ]
    },
    {
      "content": "For example:",
      "pos": [
        20773,
        20785
      ]
    },
    {
      "content": "To delete an existing resource, use the following command.",
      "pos": [
        20922,
        20980
      ]
    },
    {
      "content": "Logging",
      "pos": [
        21093,
        21100
      ]
    },
    {
      "content": "To view logged information on operations performed on a group, use the <ph id=\"ph1\">`azure group log show`</ph> command.",
      "pos": [
        21102,
        21204
      ]
    },
    {
      "content": "By default, this will list the last operation performed on the group.",
      "pos": [
        21205,
        21274
      ]
    },
    {
      "content": "To view all operations, use the optional <ph id=\"ph1\">`--all`</ph> parameter.",
      "pos": [
        21275,
        21334
      ]
    },
    {
      "content": "For the last deployment, use <ph id=\"ph1\">`--last-deployment`</ph>.",
      "pos": [
        21335,
        21384
      ]
    },
    {
      "content": "For a specific deployment, use <ph id=\"ph1\">`--deployment`</ph> and specify the deployment name.",
      "pos": [
        21385,
        21463
      ]
    },
    {
      "content": "The following example returns a log of all operations performed against the group MyGroup.",
      "pos": [
        21464,
        21554
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        21599,
        21609
      ]
    },
    {
      "pos": [
        21613,
        21736
      ],
      "content": "For information on using the Azure Command-Line Interface (Azure CLI), see <bpt id=\"p1\">[</bpt>Install and Configure the Azure CLI<ept id=\"p1\">][clisetup]</ept>."
    },
    {
      "pos": [
        21739,
        21916
      ],
      "content": "For information on working with Azure Resource Manager using Azure PowerShell, see <bpt id=\"p1\">[</bpt>Using Azure PowerShell with Azure Resource Manager<ept id=\"p1\">](../powershell-azure-resource-manager.md)</ept>."
    },
    {
      "pos": [
        21919,
        22062
      ],
      "content": "For information on working with Azure Resource Manager from the Azure Portal, see <bpt id=\"p1\">[</bpt>Using resource groups to manage your Azure resources<ept id=\"p1\">][psrm]</ept>."
    }
  ],
  "content": "<properties\n    pageTitle=\"Using the Microsoft Azure CLI for Mac, Linux, and Windows with Azure Resource Management | Microsoft Azure\"\n    description=\"Using the Microsoft Azure CLI for Mac, Linux, and Windows with Azure Resource Manager.\"\n    editor=\"tysonn\"\n    manager=\"timlt\"\n    documentationCenter=\"\"\n    authors=\"dlepow\"\n    services=\"virtual-machines\"/>\n\n<tags\n    ms.service=\"virtual-machines\"\n    ms.workload=\"infrastructure-services\"\"\n    ms.tgt_pltfrm=\"command-line-interface\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"06/09/2015\"\n    ms.author=\"danlep\"/>\n\n# Use the Azure CLI for Mac, Linux, and Windows with Azure Resource Manager\n\n> [AZURE.SELECTOR]\n- [Azure PowerShell](../powershell-azure-resource-manager.md)\n- [Azure CLI](xplat-cli-azure-resource-manager.md)\n\n\nThis article describes how to create, manage, and delete Azure resources and VMs using the Azure CLI for Mac, Linux, and Windows using the Azure Resource Manager mode.  \n\n>[AZURE.NOTE] To create and manage Azure resources on the command line, you will need an Azure account ([free trial here](http://azure.microsoft.com/pricing/free-trial/)). You will also need to [install the Azure CLI](../xplat-cli-install.md), and to [log on to use Azure resources associated with your account](../xplat-cli-connect.md). If you've done these things, you're ready to go.\n\n## Azure resources\n\nUse the Azure Resource Manager to manage a group of _resources_ (user-managed entities such as a virtual machine, database server, database, or website) as a single logical unit, or _resource group_. You can create, manage, and delete these resources imperatively on the command line, just like you can in the asm mode.\n\nUsing the Azure Resoure Manager mode, you can also manage your Azure resources in a _declarative_ way by describing the structure and relationships of a deployable group of resources in JSON *templates*. The template describes parameters that can be filled in either inline when running a command or stored in a separate JSON azuredeploy-parameters.json file. This allows you to easily create new resources using the same template by simply providing different parameters. For example, a template that creates a website will have parameters for the site name, the region the website will be located in, and other common parameters.\n\nWhen a template is used to modify or create a group, a _deployment_ is created, which is then applied to the group. For more information on the Azure Resource Manager, visit the [Azure Resource Manager Overview](../resource-group-overview.md).\n\n## Authentication\n\nWorking with the Azure Resource Manager through the Azure CLI requires that you authenticate to Microsoft Azure using a work or school account. Authenticating with a certificate installed through a .publishsettings file will not work.\n\nFor more information on authenticating using a work or school account, see [Connect to an Azure subscription from the Azure CLI](../xplat-cli-connect.md).\n\n> [AZURE.NOTE] Because you use a work or school account -- which is managed by Azure Active Directory -- you can also use Azure Role-Based Access Control (RBAC) to manage access and usage of Azure resources. For details, see [Managing and Auditing Access to Resources](../resource-group-rbac.md).\n\n## Setting the Azure Resource Manager mode\n\nBecause the Azure Resource Manager mode is not enabled by default, you must use the following command to enable Azure CLI Resource Manager commands.\n\n    azure config mode arm\n\n>[AZURE.NOTE] The Azure Resource Manager mode and Azure Service Management mode are mutually exclusive. That is, resources created in one mode cannot be managed from the other mode.\n\n## Finding the locations\n\nMost of the Azure Resource Manager commands need a valid location to create or find a resource from. You can find all available locations by using the following command.\n\n    azure location list\n\nIt will list locations specific to regions such as \"West US\", \"East US\", and so on.\n\n## Creating resource group\n\nA resource group is a logical grouping of network, storage and other resources. Almost all commands in the Azure Resource Manager mode need a resource group. You can create a resource group named _testrg_, for example, by using the following command.\n\n    azure group create -n \"testrg\" -l \"West US\"\n\nYou can start adding resources to this group after this, and use it to configure a new virtual machine.\n\n## Creating virtual machines\n\nThere are two ways to create virtual machines in the Azure Resource Manager mode:\n\n1. Using individual Azure CLI commands.\n2. Using resource group templates.\n\nBe sure to create at least one resource group before you start with any of these methods.\n\n### Using individual Azure CLI commands\n\nThis is the basic approach to configure and create a virtual machine as per your needs. In the Azure Resource Manager mode, you will need to configure some mandatory resources like the networking before you can use the **vm create** command.\n\n>[AZURE.NOTE] If you are creating resources for the first time on the command line for your subscription, you might be prompted to register for certain resource providers.\n> If that happens, it is easy to register the provider and try the failed command again, as shown in the next example.\n>\n> `azure provider register Microsoft.Storage`\n>\n> You can find out the list of providers registered for your subscription by running the following command.\n>\n> `azure provider list`\n\n\n#### Creating a public IP resource\n\nYou will need to create a public IP so you can SSH into your new virtual machine for any meaningful work. Creating a public IP is straightforward. The command needs a resource group, a name for your public IP resource, and a location, in that order.\n\n    azure network public-ip create \"testrg\" \"testip\" \"westus\"\n\n#### Creating a Network Interface Card resource\n\nThe Network Interface Card or NIC needs a subnet and a virtual network to be created first. Create a virtual network in a particular location and resource group by using the **network vnet create** command.\n\n    azure network vnet create \"testrg\" \"testvnet\" \"westus\"\n\nYou can then create a subnet in this virtual network by using the **network vnet subnet create** command.\n\n    azure network vnet subnet create \"testrg\" \"testvnet\" \"testsubnet\"\n\nYou should be able to create a NIC using these resources with the **network nic create** command.\n\n    azure network nic create \"testrg\" \"testnic\" \"westus\" -k \"testsubnet\" -m \"testvnet\" -p \"testip\"\n\n>[AZURE.NOTE] Although optional, it is very important to pass the public IP name as a parameter to the **network nic create** command as this binds the NIC to this IP, which will be later used to SSH into the virtual machine created using this NIC.\n\nFor more imformation on the **network** commands, see command-line help or [Using the Azure CLI with Azure Resource Management](azure-cli-arm-commands.md).\n\n#### Finding the operating system image\n\nCurrently, you can only find an operating system based on the publisher of the image. In other words, you must run the following command to find a list of OS image publishers in your desired location.\n\n    azure vm image list-publishers \"westus\"\n\nThen choose a publisher from the list, and find the list of images by that publisher by running the following command.\n\n    azure vm image list \"westus\" \"CoreOS\"\n\nFinally, choose an OS image from the list that looks something like the following example.\n\n    info:    Executing command **vm image list**\n    warn:    The parameters --offer and --sku if specified will be ignored\n    + Getting virtual machine image offers (Publisher: \"Canonical\" Location: \"westus\")\n    data:    Publisher  Offer        Sku          Version          Location  Urn\n\n    data:    ---------  -----------  -----------  ---------------  --------- ----------------------------------------\n    data:    CoreOS     CoreOS       Alpha        475.1.0          westus    CoreOS:CoreOS:Alpha:475.1.0\n    data:    CoreOS     CoreOS       Alpha        490.0.0          westus    CoreOS:CoreOS:Alpha:490.0.0\n\nSave the URN name of the image you want to load on your virtual machine. You'll use it later in the article.\n\n#### Creating a virtual machine\n\nYou are now ready to create a virtual machine by running the **vm create** command and passing the required information. It's optional to pass the public IP at this stage, since the NIC already has this information. Your command may look something like the following example, where _testvm_ is the name of the virtual machine created in the _testrg_ resource group.\n\n    azure-cli@0.8.0:/# azure vm create \"testrg\" \"testvm\" \"westus\" \"Linux\" -Q \"CoreOS:CoreOS:Alpha:660.0.0\" -u \"azureuser\" -p \"Pass1234!\" -N \"testnic\"\n    info:    Executing command vm create\n    + Looking up the VM \"testvm\"\n    info:    Using the VM Size \"Standard_A1\"\n    info:    The [OS, Data] Disk or image configuration requires storage account\n    + Retrieving storage accounts\n    info:    Could not find any storage accounts in the region \"westus\", trying to create new one\n    + Creating storage account \"cli02f696bbfda6d83414300\" in \"westus\"\n    + Looking up the storage account cli02f696bbfda6d83414300\n    + Looking up the NIC \"testnic\"\n    + Creating VM \"testvm\"\n    info:    vm create command OK\n\nYou should be able to start this virtual machine by running the following command.\n\n    azure vm start \"testrg\" \"testvm\"\n\nThen SSH into it by using the **ssh username@ipaddress** command. To quickly look up the IP address of your public IP resource, use the following command.\n\n    azure network public-ip show \"testrg\" \"testip\"\n\nManaging this virtual machine is easy with **vm** commands. For more information, visit [Using the Azure CLI with Azure Resource Management](azure-cli-arm-commands.md).\n\n### vm quick-create shortcut\n\nThe new **vm quick-create** shortcut cuts out most of the steps of the imperative method of VM creation. This is handy when you want to try out creating simple virtual machines or if you do not care about the networking configurations. It's an interactive command, and you need to find out only the OS image URN before running it.\n\n    azure-cli@0.8.0:/# azure vm quick-create\n    info:  Executing command vm quick-create\n    Resource group name: CLIRG\n    Virtual machine name: myqvm\n    Location name: westus\n    Operating system Type [Windows, Linux]: Linux\n    ImageURN (format: \"publisherName:offer:skus:version\"): CoreOS:CoreOS:Alpha:660.0.0\n    User name: azureuser\n    Password: ********\n    Confirm password: ********\n\nThe Azure CLI will create a virtual machine with default VM size. It will also create a storage account, a NIC, a virtual network and subnet, and a public IP. You can SSH into the virtual machine using the public IP after it boots.\n\n### Using resource group templates\n\n#### Locating and configuring a resource group template\n\n1. When working with templates, you can either create your own, or use one from the Template Gallery, or use templates available on [GitHub](https://github.com/azurermtemplates/azurermtemplates). To start with, let's use a template named CoreOS.CoreOSStable.0.2.40-preview from the Template Gallery. To list available templates from the gallery, use the following command. As there are thousands of templates available, you can paginate the results or use **grep** or **findstr** (on Windows) or your favorite string-searching command to locate interesting templates. Alternatively, you can use the **--json** option and download the entire list in JSON format for easier searching.\n\n        azure group template list\n\n    The response will list the publisher and template name, and will appear similar to the following example (although there will be far more).\n\n        data:    Publisher               Name\n        data:    ----------------------------------------------------------------------------\n        data:    CoreOS                  CoreOS.CoreOSStable.0.2.40-preview\n        data:    CoreOS                  CoreOS.CoreOSAlpha.0.2.39-preview\n        data:    SUSE                    SUSE.SUSELinuxEnterpriseServer12.2.0.36-preview\n        data:    SUSE                    SUSE.SUSELinuxEnterpriseServer11SP3PremiumImage0.2.54-preview\n\n2. To view the details of the template, use the following command.\n\n        azure group template show CoreOS.CoreOSStable.0.2.40-preview\n\n    This will return descriptive information about the template. The template we are using will create a Linux virtual machine.\n\n3. Once you have selected a template, you can download it with the following command.\n\n        azure group template download CoreOS.CoreOSStable.0.2.40-preview\n\n    Downloading a template allows you to customize it to better suite your requirements. For example, adding another resource to the template.\n\n    >[AZURE.NOTE] If you modify the template, use the `azure group template validate` command to validate the template before using it to create or modify an existing resource group.\n\n4. To configure the resource group template for your use, open the template file in a text editor. Note the **parameters** JSON collection near the top. This contains a list of the parameters that this template expects in order to create the resources described by the template. Some parameters might have default values, while others specify either the type of the value or a range of allowed values.\n\n    When using a template, you can supply parameters either as part of the command-line parameters, or by specifying a file containing the parameter values. You can also write your **value** fields directly inside the **parameters** section in the template, although that would make the template tightly bound to a particular deployment and wouldn't be reusable easily. Either way, the parameters must be in JSON format, and you must provide your own values for those keys that do not have default values.\n\n    For example, to create a file that contains parameters for the CoreOS.CoreOSStable.0.2.40-preview template, use the following data to create a file named params.json. Replace the values used in this sample with your own values. The **Location** should specify an Azure region near you, such as **North Europe** or **South Central US**. (This example uses **West US**).\n\n        {\n          \"newStorageAccountName\": {\n            \"value\": \"testStorage\"\n          },\n          \"newDomainName\": {\n            \"value\": \"testDomain\"\n          },\n          \"newVirtualNetworkName\": {\n            \"value\": \"testVNet\"\n          },\n          \"vnetAddressSpace\": {\n            \"value\": \"10.0.0.0/11\"\n          },\n          \"hostName\": {\n            \"value\": \"testHost\"\n          },\n          \"userName\": {\n            \"value\": \"azureUser\"\n          },\n          \"password\": {\n            \"value\": \"Pass1234!\"\n          },\n          \"location\": {\n            \"value\": \"West US\"\n          },\n          \"hardwareSize\": {\n            \"value\": \"Medium\"\n          }\n        }\n\n5. After saving the params.json file, use the following command to create a new resource group based on the template. The `-e` parameter specifies the params.json file created in the previous step. Replace the **testRG** with the group name you wish to use, and **testDeploy** with your deployment name. The location should be same as the one specified in your params.json template parameter file.\n\n        azure group create \"testRG\" \"West US\" -f CoreOS.CoreOSStable.0.2.40-preview.json -d \"testDeploy\" -e params.json\n\n    This command will return OK once the deployment is uploaded, but before the deployment is applied to resources in the group. To check the status of the deployment, use the following command.\n\n        azure group deployment show \"testRG\" \"testDeploy\"\n\n    The **ProvisioningState** shows the status of the deployment.\n\n    If your deployment was successful, you will see an output similar to the following example.\n\n        azure-cli@0.8.0:/# azure group deployment show testRG testDeploy\n        info:    Executing command group deployment show\n        + Getting deployments\n        data:    DeploymentName     : testDeploy\n        data:    ResourceGroupName  : testRG\n        data:    ProvisioningState  : Running\n        data:    Timestamp          : 2015-04-27T07:49:18.5237635Z\n        data:    Mode               : Incremental\n        data:    Name                   Type          Value\n        data:    ---------------------  ------------  ----------------\n        data:    newStorageAccountName  String        testStorage\n        data:    newDomainName          String        testDomain\n        data:    newVirtualNetworkName  String        testVNet\n        data:    vnetAddressSpace       String        10.0.0.0/11\n        data:    hostName               String        testHost\n        data:    userName               String        azureUser\n        data:    password               SecureString  undefined\n        data:    location               String        West US\n        data:    hardwareSize           String        Medium\n        info:    group deployment show command OK\n\n    >[AZURE.NOTE] If you realize that your configuration isn't correct, and need to stop a long running deployment, use the following command.\n    >\n    > `azure group deployment stop \"testRG\" \"testDeploy\"`\n    >\n    > If you do not provide a deployment name, one will be created automatically based on the name of the template file. It will be returned as part of the output of the `azure group create` command.\n\n6. To view the group, use the following command.\n\n        azure group show \"testRG\"\n\n    This command returns information about the resources in the group. If you have multiple groups, you can use the `azure group list` command to retrieve a list of group names, and then use `azure group show` to view details of a specific group.\n\n7. You can also use latest templates directly from GitHub, instead of downloading from the template library. Open [GitHub.com](http://www.github.com) and search for AzureRmTemplates. Select the AzureRmTemplates repository and look for any templates that you find interesting, for example, _101-simple-vm-from-image_. If you click the template, you will see it contains azuredeploy.json among other files. This is the template you want to use in your command by using a **--template-url** option. Open it in _raw_ mode, and copy the URL that appears in the browser's address bar. You can then use this URL directly to create a deployment, instead of downloading from a template library, by using a command similar to the following example.\n\n        azure group deployment create \"testDeploy\" -g \"testResourceGroup\" --template-uri https://raw/githubusercontent.com/azurermtemplates/azurermtemplates/master/101-simple-vm-from-image/azuredeploy.json\n\n    > [AZURE.NOTE] It is important to open the json template in _raw_ mode. The URL that appears in the browser's address bar is different from the one that appears in regular mode. To open the file in _raw_ mode when viewing the file on GitHub, in the upper-right corner click **Raw**.\n\n#### Working with resources\n\nWhile templates allow you to declare group-wide changes in configuration, sometimes you need to work with just a specific resource. You can do this using the `azure resource` commands.\n\n> [AZURE.NOTE] When using the `azure resource` commands other than the `list` command, you must specify the API version of the resource you are working with using the `-o` parameter. If you are unsure about the API version to use, consult the template file and find the **apiVersion** field for the resource.\n\n1. To list all resources in a group, use the following command.\n\n        azure resource list \"testRG\"\n\n2. To view individual resources, within the group, use the following command.\n\n        azure resource show \"testRG\" \"testHost\" Microsoft.ClassicCompute/virtualMachines -o \"2014-06-01\"\n\n    Notice the **Microsoft.ClassicCompute/virtualMachines** parameter. This indicates the type of the resource you are requesting information on. If you look at the template file downloaded earlier, you will notice that this same value is used to define the type of the virtual machine resource described in the template.\n\n    This command returns information related to the virtual machine.\n\n3. When viewing details on a resource, it is often useful to use the `--json` parameter, as this makes the output more readable as some values are nested structures, or collections. The following example demonstrates returning the results of the **show** command as a JSON document.\n\n        azure resource show \"testRG\" \"testHost\" Microsoft.ClassicCompute/virtualMachines -o \"2014-06-01\" --json\n\n    >[AZURE.NOTE] You can save the JSON data to file by using the &gt; character to pipe the output to file. For example:\n    >\n    > `azure resource show \"testRG\" \"testHost\" Microsoft.ClassicCompute/virtualMachines -o \"2014-06-01\" --json > myfile.json`\n\n4. To delete an existing resource, use the following command.\n\n        azure resource delete \"testRG\" \"testHost\" Microsoft.ClassicCompute/virtualMachines -o \"2014-06-01\"\n\n## Logging\n\nTo view logged information on operations performed on a group, use the `azure group log show` command. By default, this will list the last operation performed on the group. To view all operations, use the optional `--all` parameter. For the last deployment, use `--last-deployment`. For a specific deployment, use `--deployment` and specify the deployment name. The following example returns a log of all operations performed against the group MyGroup.\n\n    azure group log show mygroup --all\n\n## Next steps\n\n* For information on using the Azure Command-Line Interface (Azure CLI), see [Install and Configure the Azure CLI][clisetup].\n* For information on working with Azure Resource Manager using Azure PowerShell, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).\n* For information on working with Azure Resource Manager from the Azure Portal, see [Using resource groups to manage your Azure resources][psrm].\n\n[signuporg]: http://www.windowsazure.com/documentation/articles/sign-up-organization/\n[adtenant]: http://technet.microsoft.com/library/jj573650#createAzureTenant\n[portal]: https://manage.windowsazure.com/\n[clisetup]: ../xplat-cli.md\n[psrm]: http://go.microsoft.com/fwlink/?LinkId=394760\n"
}