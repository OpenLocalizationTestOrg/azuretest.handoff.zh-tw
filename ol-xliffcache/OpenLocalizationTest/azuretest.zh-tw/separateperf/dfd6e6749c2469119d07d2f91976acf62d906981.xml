{
  "nodes": [
    {
      "content": "Create a web app in Azure that connects to MongoDB running on a virtual machine",
      "pos": [
        28,
        107
      ]
    },
    {
      "content": "A tutorial that teaches you how to use Git to deploy an ASP.NET app to Azure App Service, connected to MongoDB on an Azure Virtual Machine.",
      "pos": [
        127,
        266
      ]
    },
    {
      "content": "Create a web app in Azure that connects to MongoDB running on a virtual machine",
      "pos": [
        634,
        713
      ]
    },
    {
      "content": "Using Git, you can deploy an ASP.NET application to Azure App Service Web Apps.",
      "pos": [
        715,
        794
      ]
    },
    {
      "content": "In this tutorial, you will build a simple front-end ASP.NET MVC task list application that connects to a MongoDB database running on a virtual machine in Azure.",
      "pos": [
        795,
        955
      ]
    },
    {
      "content": "[MongoDB][MongoDB] is a popular open source, high performance NoSQL database.",
      "pos": [
        957,
        1034
      ]
    },
    {
      "content": "After running and testing the ASP.NET application on your development computer, you will upload the application to App Service Web Apps using Git.",
      "pos": [
        1035,
        1181
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you want to get started with Azure App Service before signing up for an Azure account, go to <bpt id=\"p1\">[</bpt>Try App Service<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=523751)</ept>, where you can immediately create a short-lived starter web app in App Service.",
      "pos": [
        1184,
        1437
      ]
    },
    {
      "content": "No credit cards required; no commitments.",
      "pos": [
        1438,
        1479
      ]
    },
    {
      "content": "Background knowledge",
      "pos": [
        1485,
        1505
      ]
    },
    {
      "content": "Knowledge of the following is useful for this tutorial, though not required:",
      "pos": [
        1510,
        1586
      ]
    },
    {
      "content": "The C# driver for MongoDB.",
      "pos": [
        1590,
        1616
      ]
    },
    {
      "content": "For more information on developing C# applications against MongoDB, see the MongoDB [CSharp Language Center][MongoC#LangCenter].",
      "pos": [
        1617,
        1745
      ]
    },
    {
      "content": "The ASP .NET web application framework.",
      "pos": [
        1749,
        1788
      ]
    },
    {
      "content": "You can learn all about it at the [ASP.net website][ASP.NET].",
      "pos": [
        1789,
        1850
      ]
    },
    {
      "content": "The ASP .NET MVC web application framework.",
      "pos": [
        1853,
        1896
      ]
    },
    {
      "content": "You can learn all about it at the [ASP.NET MVC website][MVCWebSite].",
      "pos": [
        1897,
        1965
      ]
    },
    {
      "content": "Azure.",
      "pos": [
        1968,
        1974
      ]
    },
    {
      "content": "You can get started reading at [Azure][WindowsAzure].",
      "pos": [
        1975,
        2028
      ]
    },
    {
      "content": "Prerequisites",
      "pos": [
        2033,
        2046
      ]
    },
    {
      "content": "[Visual Studio Express 2013 for Web] [VSEWeb] or [Visual Studio 2013] [VSUlt]",
      "pos": [
        2053,
        2130
      ]
    },
    {
      "content": "Azure SDK for .NET",
      "pos": [
        2134,
        2152
      ]
    },
    {
      "content": "An active Microsoft Azure subscription",
      "pos": [
        2217,
        2255
      ]
    },
    {
      "content": "Create a virtual machine and install MongoDB",
      "pos": [
        2393,
        2437
      ]
    },
    {
      "content": "This tutorial assumes you have created a virtual machine in Azure.",
      "pos": [
        2442,
        2508
      ]
    },
    {
      "content": "After creating the virtual machine you need to install MongoDB on the virtual machine:",
      "pos": [
        2509,
        2595
      ]
    },
    {
      "content": "To create a Windows virtual machine and install MongoDB, see [Install MongoDB on a virtual machine running Windows Server in Azure][InstallMongoOnWindowsVM].",
      "pos": [
        2599,
        2756
      ]
    },
    {
      "content": "Alternatively, to create a Linux virtual machine and install MongoDB, see [Install MongoDB on a virtual machine running CentOS Linux in Azure][InstallMongoOnCentOSLinuxVM].",
      "pos": [
        2759,
        2931
      ]
    },
    {
      "content": "After you have created the virtual machine in Azure and installed MongoDB, be sure to remember the DNS name of the virtual machine (\"testlinuxvm.cloudapp.net\", for example) and the external port for MongoDB that you specified in the endpoint.",
      "pos": [
        2933,
        3175
      ]
    },
    {
      "content": "You will need this information later in the tutorial.",
      "pos": [
        3177,
        3230
      ]
    },
    {
      "content": "Create the application",
      "pos": [
        3258,
        3280
      ]
    },
    {
      "content": "In this section you will create an ASP.NET application called \"My Task List\" by using Visual Studio and perform an initial deployment to Azure App Service Web Apps.",
      "pos": [
        3285,
        3449
      ]
    },
    {
      "content": "You will run the application locally, but it will connect to your virtual machine on Azure and use the MongoDB instance that you created there.",
      "pos": [
        3450,
        3593
      ]
    },
    {
      "pos": [
        3598,
        3638
      ],
      "content": "In Visual Studio, click <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Start Page New Project",
      "pos": [
        3646,
        3668
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> window, in the left pane, select <bpt id=\"p2\">**</bpt>Visual C#<ept id=\"p2\">**</ept>, and then select <bpt id=\"p3\">**</bpt>Web<ept id=\"p3\">**</ept>.",
      "pos": [
        3695,
        3790
      ]
    },
    {
      "content": "In the middle pane, select <bpt id=\"p1\">**</bpt>ASP.NET  Web Application<ept id=\"p1\">**</ept>.",
      "pos": [
        3791,
        3847
      ]
    },
    {
      "content": "At the bottom, name your project \"MyTaskListApp,\" and then click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.",
      "pos": [
        3848,
        3920
      ]
    },
    {
      "content": "New Project Dialog",
      "pos": [
        3928,
        3946
      ]
    },
    {
      "pos": [
        3977,
        4058
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>New ASP.NET Project<ept id=\"p1\">**</ept> dialog box, select <bpt id=\"p2\">**</bpt>MVC<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Select MVC Template",
      "pos": [
        4066,
        4085
      ]
    },
    {
      "content": "If you aren't already signed into Microsoft Azure, you will be prompted to sign in.",
      "pos": [
        4116,
        4199
      ]
    },
    {
      "content": "Follow the prompts to sign into Azure.",
      "pos": [
        4200,
        4238
      ]
    },
    {
      "content": "Once you are signed in, you can start configuring your App Service web app.",
      "pos": [
        4242,
        4317
      ]
    },
    {
      "content": "Specify the <bpt id=\"p1\">**</bpt>Web App name<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>App Service plan<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Resource group<ept id=\"p3\">**</ept>, and <bpt id=\"p4\">**</bpt>Region<ept id=\"p4\">**</ept>, then click <bpt id=\"p5\">**</bpt>OK<ept id=\"p5\">**</ept>.",
      "pos": [
        4318,
        4424
      ]
    },
    {
      "content": "After the project creation completes, wait for the web app to be created in Azure App Service as indicated in the <bpt id=\"p1\">**</bpt>Azure App Service Activity<ept id=\"p1\">**</ept> window.",
      "pos": [
        4516,
        4668
      ]
    },
    {
      "content": "Then, click <bpt id=\"p1\">**</bpt>Publish MyTaskListApp to this Web App now<ept id=\"p1\">**</ept>.",
      "pos": [
        4669,
        4727
      ]
    },
    {
      "pos": [
        4732,
        4750
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Once your default ASP.NET application is published to Azure App Service Web Apps, it will be launched in the browser.",
      "pos": [
        4830,
        4947
      ]
    },
    {
      "content": "Install the MongoDB C# driver",
      "pos": [
        4952,
        4981
      ]
    },
    {
      "content": "MongoDB offers client-side support for C# applications through a driver, which you need to install on your local development computer.",
      "pos": [
        4983,
        5117
      ]
    },
    {
      "content": "The C# driver is available through NuGet.",
      "pos": [
        5118,
        5159
      ]
    },
    {
      "content": "To install the MongoDB C# driver:",
      "pos": [
        5161,
        5194
      ]
    },
    {
      "pos": [
        5199,
        5303
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>MyTaskListApp<ept id=\"p2\">**</ept> project and select <bpt id=\"p3\">**</bpt>Manage NuGetPackages<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Manage NuGet Packages",
      "pos": [
        5311,
        5332
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Manage NuGet Packages<ept id=\"p1\">**</ept> window, in the left pane, click <bpt id=\"p2\">**</bpt>Online<ept id=\"p2\">**</ept>.",
      "pos": [
        5365,
        5441
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Search Online<ept id=\"p1\">**</ept> box on the right, type \"mongodb.driver\".",
      "pos": [
        5442,
        5507
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Install<ept id=\"p1\">**</ept> to install the driver.",
      "pos": [
        5509,
        5549
      ]
    },
    {
      "content": "Search for MongoDB C# Driver",
      "pos": [
        5557,
        5585
      ]
    },
    {
      "pos": [
        5621,
        5680
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>I Accept<ept id=\"p1\">**</ept> to accept the 10gen, Inc. license terms."
    },
    {
      "pos": [
        5685,
        5797
      ],
      "content": "Click **Close** after the driver has installed.\n ![MongoDB C# Driver Installed][MongoDBCsharpDriverInstalled]",
      "leadings": [
        "",
        "   "
      ],
      "nodes": [
        {
          "content": "Click <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> after the driver has installed.",
          "pos": [
            0,
            47
          ]
        },
        {
          "content": "<ph id=\"ph1\"> ![</ph>MongoDB C# Driver Installed<ph id=\"ph2\">][MongoDBCsharpDriverInstalled]</ph>",
          "pos": [
            48,
            109
          ]
        }
      ]
    },
    {
      "content": "The MongoDB C# driver is now installed.",
      "pos": [
        5800,
        5839
      ]
    },
    {
      "content": "References to the <bpt id=\"p1\">**</bpt>MongoDB.Bson<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>MongoDB.Driver<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>MongoDB.Driver.Core<ept id=\"p3\">**</ept>  libraries have been added to the project.",
      "pos": [
        5841,
        5967
      ]
    },
    {
      "content": "MongoDB C# Driver References",
      "pos": [
        5971,
        5999
      ]
    },
    {
      "content": "Add a model",
      "pos": [
        6036,
        6047
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">*</bpt>Models<ept id=\"p2\">*</ept> folder and <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept> a new <bpt id=\"p4\">**</bpt>Class<ept id=\"p4\">**</ept> and name it <bpt id=\"p5\">*</bpt>TaskModel.cs<ept id=\"p5\">*</ept>.",
      "pos": [
        6051,
        6164
      ]
    },
    {
      "content": "In <bpt id=\"p1\">*</bpt>TaskModel.cs<ept id=\"p1\">*</ept>, replace the existing code with the following code:",
      "pos": [
        6166,
        6235
      ]
    },
    {
      "content": "Add the data access layer",
      "pos": [
        7036,
        7061
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">*</bpt>MyTaskListApp<ept id=\"p2\">*</ept> project and <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept> a <bpt id=\"p4\">**</bpt>New Folder<ept id=\"p4\">**</ept> named <bpt id=\"p5\">*</bpt>DAL<ept id=\"p5\">*</ept>.",
      "pos": [
        7065,
        7172
      ]
    },
    {
      "content": "Right-click the <bpt id=\"p1\">*</bpt>DAL<ept id=\"p1\">*</ept> folder and <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept> a new <bpt id=\"p3\">**</bpt>Class<ept id=\"p3\">**</ept>.",
      "pos": [
        7174,
        7231
      ]
    },
    {
      "content": "Name the class file <bpt id=\"p1\">*</bpt>Dal.cs<ept id=\"p1\">*</ept>.",
      "pos": [
        7232,
        7261
      ]
    },
    {
      "content": "In <bpt id=\"p1\">*</bpt>Dal.cs<ept id=\"p1\">*</ept>, replace the existing code with the following code:",
      "pos": [
        7263,
        7326
      ]
    },
    {
      "content": "Add a controller",
      "pos": [
        10802,
        10818
      ]
    },
    {
      "pos": [
        10822,
        10942
      ],
      "content": "Open the <bpt id=\"p1\">*</bpt>Controllers\\HomeController.cs<ept id=\"p1\">*</ept> file in <bpt id=\"p2\">**</bpt>Solution Explorer<ept id=\"p2\">**</ept> and replace the existing code with the following:"
    },
    {
      "content": "Set up the styles",
      "pos": [
        12759,
        12776
      ]
    },
    {
      "pos": [
        12780,
        13005
      ],
      "content": "To change the title at the top of the page, open the <bpt id=\"p1\">*</bpt>Views\\Shared\\\\_Layout.cshtml<ept id=\"p1\">*</ept> file in <bpt id=\"p2\">**</bpt>Solution Explorer<ept id=\"p2\">**</ept> and replace \"Application name\" in the navbar header with \"My Task List Application\" so that it looks like this:"
    },
    {
      "pos": [
        13113,
        13247
      ],
      "content": "In order to set up the Task List menu, open the <bpt id=\"p1\">*</bpt>\\Views\\Home\\Index.cshtml<ept id=\"p1\">*</ept> file and replace the existing code with the following code:"
    },
    {
      "content": "To add the ability to create a new task, right-click the <bpt id=\"p1\">*</bpt>Views\\Home\\\\<ept id=\"p1\">*</ept> folder and <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept> a <bpt id=\"p3\">**</bpt>View<ept id=\"p3\">**</ept>.",
      "pos": [
        14006,
        14108
      ]
    },
    {
      "content": "Name the view <bpt id=\"p1\">*</bpt>Create<ept id=\"p1\">*</ept>.",
      "pos": [
        14110,
        14133
      ]
    },
    {
      "content": "Replace the code with the following:",
      "pos": [
        14134,
        14170
      ]
    },
    {
      "pos": [
        15676,
        15720
      ],
      "content": "<bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept> should look like this:"
    },
    {
      "content": "Solution Explorer",
      "pos": [
        15724,
        15741
      ]
    },
    {
      "content": "Set the MongoDB connection string",
      "pos": [
        15778,
        15811
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, open the <bpt id=\"p2\">*</bpt>DAL/Dal.cs<ept id=\"p2\">*</ept> file.",
      "pos": [
        15815,
        15868
      ]
    },
    {
      "content": "Find the following line of code:",
      "pos": [
        15869,
        15901
      ]
    },
    {
      "content": "Replace <ph id=\"ph1\">`&lt;vm-dns-name&gt;`</ph> with the DNS name of the virtual machine running MongoDB you created in the [Create a virtual machine and install MongoDB][] step of this tutorial.",
      "pos": [
        15969,
        16140
      ]
    },
    {
      "content": "To find the DNS name of your virtual machine, go to the Azure portal, select <bpt id=\"p1\">**</bpt>Virtual Machines<ept id=\"p1\">**</ept>, and find <bpt id=\"p2\">**</bpt>DNS Name<ept id=\"p2\">**</ept>.",
      "pos": [
        16142,
        16263
      ]
    },
    {
      "content": "If the DNS name of the virtual machine is \"testlinuxvm.cloudapp.net\" and MongoDB is listening on the default port 27017, the connection string line of code will look like:",
      "pos": [
        16265,
        16436
      ]
    },
    {
      "content": "If the virtual machine endpoint specifies a different external port for MongoDB, you can specifiy the port in the connection string:",
      "pos": [
        16515,
        16647
      ]
    },
    {
      "content": "For more information on MongoDB connection strings, see [Connections][MongoConnectionStrings].",
      "pos": [
        16732,
        16826
      ]
    },
    {
      "content": "Test the local deployment",
      "pos": [
        16831,
        16856
      ]
    },
    {
      "content": "To run your application on your development computer, select <bpt id=\"p1\">**</bpt>Start Debugging<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Debug<ept id=\"p2\">**</ept> menu or hit <bpt id=\"p3\">**</bpt>F5<ept id=\"p3\">**</ept>.",
      "pos": [
        16861,
        16980
      ]
    },
    {
      "content": "IIS Express starts and a browser opens and launches the application's home page.",
      "pos": [
        16981,
        17061
      ]
    },
    {
      "content": "You can add a new task, which will be added to the MongoDB database running on your virtual machine in Azure.",
      "pos": [
        17063,
        17172
      ]
    },
    {
      "content": "My Task List Application",
      "pos": [
        17176,
        17200
      ]
    },
    {
      "content": "Publish to Azure App Service Web Apps",
      "pos": [
        17224,
        17261
      ]
    },
    {
      "content": "In this section you will publish your changes to Azure App Service Web Apps.",
      "pos": [
        17263,
        17339
      ]
    },
    {
      "pos": [
        17344,
        17424
      ],
      "content": "In Solution Explorer, right-click <bpt id=\"p1\">**</bpt>MyTaskListApp<ept id=\"p1\">**</ept> again and click <bpt id=\"p2\">**</bpt>Publish<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        17428,
        17446
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept>."
    },
    {
      "content": "You should now see your web app running in Azure App Service and accessing the MongoDB database in Azure Virtual Machines.",
      "pos": [
        17452,
        17574
      ]
    },
    {
      "content": "Summary",
      "pos": [
        17579,
        17586
      ]
    },
    {
      "content": "You have now successfully deployed your ASP.NET application to Azure App Service Web Apps.",
      "pos": [
        17591,
        17681
      ]
    },
    {
      "content": "To view the web app:",
      "pos": [
        17682,
        17702
      ]
    },
    {
      "content": "Log into the Azure portal.",
      "pos": [
        17707,
        17733
      ]
    },
    {
      "pos": [
        17737,
        17756
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Web apps<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        17761,
        17806
      ],
      "content": "Select your web app in the <bpt id=\"p1\">**</bpt>Web Apps<ept id=\"p1\">**</ept> list."
    },
    {
      "content": "For more information on developing C# applications against MongoDB, see [CSharp Language Center][MongoC#LangCenter].",
      "pos": [
        17808,
        17924
      ]
    },
    {
      "content": "test",
      "pos": [
        20481,
        20485
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Create a web app in Azure that connects to MongoDB running on a virtual machine\" \n    description=\"A tutorial that teaches you how to use Git to deploy an ASP.NET app to Azure App Service, connected to MongoDB on an Azure Virtual Machine.\"\n    tags=\"azure-portal\" \n    services=\"app-service\\web, virtual-machines\" \n    documentationCenter=\".net\" \n    authors=\"cephalin\" \n    manager=\"wpickett\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"app-service-web\" \n    ms.workload=\"web\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"dotnet\" \n    ms.topic=\"article\" \n    ms.date=\"08/11/2015\" \n    ms.author=\"cephalin\"/>\n\n\n# Create a web app in Azure that connects to MongoDB running on a virtual machine\n\nUsing Git, you can deploy an ASP.NET application to Azure App Service Web Apps. In this tutorial, you will build a simple front-end ASP.NET MVC task list application that connects to a MongoDB database running on a virtual machine in Azure.  [MongoDB][MongoDB] is a popular open source, high performance NoSQL database. After running and testing the ASP.NET application on your development computer, you will upload the application to App Service Web Apps using Git.\n\n>[AZURE.NOTE] If you want to get started with Azure App Service before signing up for an Azure account, go to [Try App Service](http://go.microsoft.com/fwlink/?LinkId=523751), where you can immediately create a short-lived starter web app in App Service. No credit cards required; no commitments.\n\n\n## Background knowledge ##\n\nKnowledge of the following is useful for this tutorial, though not required:\n\n* The C# driver for MongoDB. For more information on developing C# applications against MongoDB, see the MongoDB [CSharp Language Center][MongoC#LangCenter]. \n* The ASP .NET web application framework. You can learn all about it at the [ASP.net website][ASP.NET].\n* The ASP .NET MVC web application framework. You can learn all about it at the [ASP.NET MVC website][MVCWebSite].\n* Azure. You can get started reading at [Azure][WindowsAzure].\n\n## Prerequisites ##\n\n- [Visual Studio Express 2013 for Web] [VSEWeb] or [Visual Studio 2013] [VSUlt]\n- [Azure SDK for .NET](http://go.microsoft.com/fwlink/p/?linkid=323510&clcid=0x409)\n- An active Microsoft Azure subscription\n\n[AZURE.INCLUDE [create-account-and-websites-note](../../includes/create-account-and-websites-note.md)]\n\n<a id=\"virtualmachine\"></a> \n## Create a virtual machine and install MongoDB ##\n\nThis tutorial assumes you have created a virtual machine in Azure. After creating the virtual machine you need to install MongoDB on the virtual machine:\n\n* To create a Windows virtual machine and install MongoDB, see [Install MongoDB on a virtual machine running Windows Server in Azure][InstallMongoOnWindowsVM].\n* Alternatively, to create a Linux virtual machine and install MongoDB, see [Install MongoDB on a virtual machine running CentOS Linux in Azure][InstallMongoOnCentOSLinuxVM].\n\nAfter you have created the virtual machine in Azure and installed MongoDB, be sure to remember the DNS name of the virtual machine (\"testlinuxvm.cloudapp.net\", for example) and the external port for MongoDB that you specified in the endpoint.  You will need this information later in the tutorial.\n\n<a id=\"createapp\"></a>\n## Create the application ##\n\nIn this section you will create an ASP.NET application called \"My Task List\" by using Visual Studio and perform an initial deployment to Azure App Service Web Apps. You will run the application locally, but it will connect to your virtual machine on Azure and use the MongoDB instance that you created there.\n\n1. In Visual Studio, click **New Project**.\n\n    ![Start Page New Project][StartPageNewProject]\n\n1. In the **New Project** window, in the left pane, select **Visual C#**, and then select **Web**. In the middle pane, select **ASP.NET  Web Application**. At the bottom, name your project \"MyTaskListApp,\" and then click **OK**.\n\n    ![New Project Dialog][NewProjectMyTaskListApp]\n\n1. In the **New ASP.NET Project** dialog box, select **MVC**, and then click **OK**.\n\n    ![Select MVC Template][VS2013SelectMVCTemplate]\n\n1. If you aren't already signed into Microsoft Azure, you will be prompted to sign in. Follow the prompts to sign into Azure.\n2. Once you are signed in, you can start configuring your App Service web app. Specify the **Web App name**, **App Service plan**, **Resource group**, and **Region**, then click **OK**.\n\n    ![](./media/web-sites-dotnet-store-data-mongodb-vm/VSConfigureWebAppSettings.png)\n\n1. After the project creation completes, wait for the web app to be created in Azure App Service as indicated in the **Azure App Service Activity** window. Then, click **Publish MyTaskListApp to this Web App now**.\n\n1. Click **Publish**.\n\n    ![](./media/web-sites-dotnet-store-data-mongodb-vm/VSPublishWeb.png)\n\n    Once your default ASP.NET application is published to Azure App Service Web Apps, it will be launched in the browser.\n\n## Install the MongoDB C# driver\n\nMongoDB offers client-side support for C# applications through a driver, which you need to install on your local development computer. The C# driver is available through NuGet.\n\nTo install the MongoDB C# driver:\n\n1. In **Solution Explorer**, right-click the **MyTaskListApp** project and select **Manage NuGetPackages**.\n\n    ![Manage NuGet Packages][VS2013ManageNuGetPackages]\n\n2. In the **Manage NuGet Packages** window, in the left pane, click **Online**. In the **Search Online** box on the right, type \"mongodb.driver\".  Click **Install** to install the driver.\n\n    ![Search for MongoDB C# Driver][SearchforMongoDBCSharpDriver]\n\n3. Click **I Accept** to accept the 10gen, Inc. license terms.\n\n4. Click **Close** after the driver has installed.\n    ![MongoDB C# Driver Installed][MongoDBCsharpDriverInstalled]\n\n\nThe MongoDB C# driver is now installed.  References to the **MongoDB.Bson**, **MongoDB.Driver**, and **MongoDB.Driver.Core**  libraries have been added to the project.\n\n![MongoDB C# Driver References][MongoDBCSharpDriverReferences]\n\n## Add a model ##\nIn **Solution Explorer**, right-click the *Models* folder and **Add** a new **Class** and name it *TaskModel.cs*.  In *TaskModel.cs*, replace the existing code with the following code:\n\n    using System;\n    using System.Collections.Generic;\n    using System.Linq;\n    using System.Web;\n    using MongoDB.Bson.Serialization.Attributes;\n    using MongoDB.Bson.Serialization.IdGenerators;\n    using MongoDB.Bson;\n    \n    namespace MyTaskListApp.Models\n    {\n        public class MyTask\n        {\n            [BsonId(IdGenerator = typeof(CombGuidGenerator))]\n            public Guid Id { get; set; }\n    \n            [BsonElement(\"Name\")]\n            public string Name { get; set; }\n    \n            [BsonElement(\"Category\")]\n            public string Category { get; set; }\n    \n            [BsonElement(\"Date\")]\n            public DateTime Date { get; set; }\n    \n            [BsonElement(\"CreatedDate\")]\n            public DateTime CreatedDate { get; set; }\n    \n        }\n    }\n\n## Add the data access layer ##\nIn **Solution Explorer**, right-click the *MyTaskListApp* project and **Add** a **New Folder** named *DAL*.  Right-click the *DAL* folder and **Add** a new **Class**. Name the class file *Dal.cs*.  In *Dal.cs*, replace the existing code with the following code:\n\n    using System;\n    using System.Collections.Generic;\n    using System.Linq;\n    using System.Web;\n    using MyTaskListApp.Models;\n    using MongoDB.Driver;\n    using System.Configuration;\n    \n    namespace MyTaskListApp\n    {\n        public class Dal : IDisposable\n        {\n            private MongoServer mongoServer = null;\n            private bool disposed = false;\n    \n            // To do: update the connection string with the DNS name\n            // or IP address of your server. \n            //For example, \"mongodb://testlinux.cloudapp.net\"\n            private string connectionString = \"mongodb://<vm-dns-name>\";\n    \n            // This sample uses a database named \"Tasks\" and a \n            //collection named \"TasksList\".  The database and collection \n            //will be automatically created if they don't already exist.\n            private string dbName = \"Tasks\";\n            private string collectionName = \"TasksList\";\n    \n            // Default constructor.        \n            public Dal()\n            {\n            }        \n    \n            // Gets all Task items from the MongoDB server.        \n            public List<MyTask> GetAllTasks()\n            {\n                try\n                {\n                    MongoCollection<MyTask> collection = GetTasksCollection();\n                    return collection.FindAll().ToList<MyTask>();\n                }\n                catch (MongoConnectionException)\n                {\n                    return new List<MyTask >();\n                }\n            }\n    \n            // Creates a Task and inserts it into the collection in MongoDB.\n            public void CreateTask(MyTask task)\n            {\n                MongoCollection<MyTask> collection = GetTasksCollectionForEdit();\n                try\n                {\n                    collection.Insert(task, SafeMode.True);\n                }\n                catch (MongoCommandException ex)\n                {\n                    string msg = ex.Message;\n                }\n            }\n    \n            private MongoCollection<MyTask> GetTasksCollection()\n            {\n                MongoServer server = MongoServer.Create(connectionString);\n                MongoDatabase database = server[dbName];\n                MongoCollection<MyTask> todoTaskCollection = database.GetCollection<MyTask>(collectionName);\n                return todoTaskCollection;\n            }\n    \n            private MongoCollection<MyTask> GetTasksCollectionForEdit()\n            {\n                MongoServer server = MongoServer.Create(connectionString);\n                MongoDatabase database = server[dbName];\n                MongoCollection<MyTask> todoTaskCollection = database.GetCollection<MyTask>(collectionName);\n                return todoTaskCollection;\n            }\n    \n            # region IDisposable\n    \n            public void Dispose()\n            {\n                this.Dispose(true);\n                GC.SuppressFinalize(this);\n            }\n    \n            protected virtual void Dispose(bool disposing)\n            {\n                if (!this.disposed)\n                {\n                    if (disposing)\n                    {\n                        if (mongoServer != null)\n                        {\n                            this.mongoServer.Disconnect();\n                        }\n                    }\n                }\n    \n                this.disposed = true;\n            }\n    \n            # endregion\n        }\n    }\n\n## Add a controller ##\nOpen the *Controllers\\HomeController.cs* file in **Solution Explorer** and replace the existing code with the following:\n\n    using System;\n    using System.Collections.Generic;\n    using System.Linq;\n    using System.Web;\n    using System.Web.Mvc;\n    using MyTaskListApp.Models;\n    using System.Configuration;\n    \n    namespace MyTaskListApp.Controllers\n    {\n        public class HomeController : Controller, IDisposable\n        {\n            private Dal dal = new Dal();\n            private bool disposed = false;\n            //\n            // GET: /MyTask/\n    \n            public ActionResult Index()\n            {\n                return View(dal.GetAllTasks());\n            }\n    \n            //\n            // GET: /MyTask/Create\n    \n            public ActionResult Create()\n            {\n                return View();\n            }\n    \n            //\n            // POST: /MyTask/Create\n    \n            [HttpPost]\n            public ActionResult Create(MyTask task)\n            {\n                try\n                {\n                    dal.CreateTask(task);\n                    return RedirectToAction(\"Index\");\n                }\n                catch\n                {\n                    return View();\n                }\n            }\n    \n            public ActionResult About()\n            {\n                return View();\n            }\n    \n            # region IDisposable\n    \n            new protected void Dispose()\n            {\n                this.Dispose(true);\n                GC.SuppressFinalize(this);\n            }\n    \n            new protected virtual void Dispose(bool disposing)\n            {\n                if (!this.disposed)\n                {\n                    if (disposing)\n                    {\n                        this.dal.Dispose();\n                    }\n                }\n    \n                this.disposed = true;\n            }\n    \n            # endregion\n    \n        }\n    }\n\n## Set up the styles ##\nTo change the title at the top of the page, open the *Views\\Shared\\\\_Layout.cshtml* file in **Solution Explorer** and replace \"Application name\" in the navbar header with \"My Task List Application\" so that it looks like this:\n\n    @Html.ActionLink(\"My Task List Application\", \"Index\", \"Home\", null, new { @class = \"navbar-brand\" })\n\nIn order to set up the Task List menu, open the *\\Views\\Home\\Index.cshtml* file and replace the existing code with the following code:\n    \n    @model IEnumerable<MyTaskListApp.Models.MyTask>\n    \n    @{\n        ViewBag.Title = \"My Task List\";\n    }\n    \n    <h2>My Task List</h2>\n    \n    <table border=\"1\">\n        <tr>\n            <th>Task</th>\n            <th>Category</th>\n            <th>Date</th>\n            \n        </tr>\n    \n    @foreach (var item in Model) {\n        <tr>\n            <td>\n                @Html.DisplayFor(modelItem => item.Name)\n            </td>\n            <td>\n                @Html.DisplayFor(modelItem => item.Category)\n            </td>\n            <td>\n                @Html.DisplayFor(modelItem => item.Date)\n            </td>\n            \n        </tr>\n    }\n    \n    </table>\n    <div>  @Html.Partial(\"Create\", new MyTaskListApp.Models.MyTask())</div>\n\n\nTo add the ability to create a new task, right-click the *Views\\Home\\\\* folder and **Add** a **View**.  Name the view *Create*. Replace the code with the following:\n\n    @model MyTaskListApp.Models.MyTask\n    \n    <script src=\"@Url.Content(\"~/Scripts/jquery-1.10.2.min.js\")\" type=\"text/javascript\"></script>\n    <script src=\"@Url.Content(\"~/Scripts/jquery.validate.min.js\")\" type=\"text/javascript\"></script>\n    <script src=\"@Url.Content(\"~/Scripts/jquery.validate.unobtrusive.min.js\")\" type=\"text/javascript\"></script>\n    \n    @using (Html.BeginForm(\"Create\", \"Home\")) {\n        @Html.ValidationSummary(true)\n        <fieldset>\n            <legend>New Task</legend>\n    \n            <div class=\"editor-label\">\n                @Html.LabelFor(model => model.Name)\n            </div>\n            <div class=\"editor-field\">\n                @Html.EditorFor(model => model.Name)\n                @Html.ValidationMessageFor(model => model.Name)\n            </div>\n    \n            <div class=\"editor-label\">\n                @Html.LabelFor(model => model.Category)\n            </div>\n            <div class=\"editor-field\">\n                @Html.EditorFor(model => model.Category)\n                @Html.ValidationMessageFor(model => model.Category)\n            </div>\n    \n            <div class=\"editor-label\">\n                @Html.LabelFor(model => model.Date)\n            </div>\n            <div class=\"editor-field\">\n                @Html.EditorFor(model => model.Date)\n                @Html.ValidationMessageFor(model => model.Date)\n            </div>\n    \n            <p>\n                <input type=\"submit\" value=\"Create\" />\n            </p>\n        </fieldset>\n    }\n\n**Solution Explorer** should look like this:\n\n![Solution Explorer][SolutionExplorerMyTaskListApp]\n\n## Set the MongoDB connection string ##\nIn **Solution Explorer**, open the *DAL/Dal.cs* file. Find the following line of code:\n\n    private string connectionString = \"mongodb://<vm-dns-name>\";\n\nReplace `<vm-dns-name>` with the DNS name of the virtual machine running MongoDB you created in the [Create a virtual machine and install MongoDB][] step of this tutorial.  To find the DNS name of your virtual machine, go to the Azure portal, select **Virtual Machines**, and find **DNS Name**.\n\nIf the DNS name of the virtual machine is \"testlinuxvm.cloudapp.net\" and MongoDB is listening on the default port 27017, the connection string line of code will look like:\n\n    private string connectionString = \"mongodb://testlinuxvm.cloudapp.net\";\n\nIf the virtual machine endpoint specifies a different external port for MongoDB, you can specifiy the port in the connection string:\n\n    private string connectionString = \"mongodb://testlinuxvm.cloudapp.net:12345\";\n\nFor more information on MongoDB connection strings, see [Connections][MongoConnectionStrings].\n\n## Test the local deployment ##\n\nTo run your application on your development computer, select **Start Debugging** from the **Debug** menu or hit **F5**. IIS Express starts and a browser opens and launches the application's home page.  You can add a new task, which will be added to the MongoDB database running on your virtual machine in Azure.\n\n![My Task List Application][TaskListAppBlank]\n\n## Publish to Azure App Service Web Apps\n\nIn this section you will publish your changes to Azure App Service Web Apps.\n\n1. In Solution Explorer, right-click **MyTaskListApp** again and click **Publish**.\n2. Click **Publish**.\n\n    You should now see your web app running in Azure App Service and accessing the MongoDB database in Azure Virtual Machines.\n\n## Summary ##\n\nYou have now successfully deployed your ASP.NET application to Azure App Service Web Apps. To view the web app:\n\n1. Log into the Azure portal.\n2. Click **Web apps**. \n3. Select your web app in the **Web Apps** list.\n\nFor more information on developing C# applications against MongoDB, see [CSharp Language Center][MongoC#LangCenter]. \n\n[AZURE.INCLUDE [app-service-web-whats-changed](../../includes/app-service-web-whats-changed.md)]\n \n\n<!-- HYPERLINKS -->\n\n[AzurePortal]: http://manage.windowsazure.com\n[WindowsAzure]: http://www.windowsazure.com\n[MongoC#LangCenter]: http://docs.mongodb.org/ecosystem/drivers/csharp/\n[MVCWebSite]: http://www.asp.net/mvc\n[ASP.NET]: http://www.asp.net/\n[MongoConnectionStrings]: http://www.mongodb.org/display/DOCS/Connections\n[MongoDB]: http://www.mongodb.org\n[InstallMongoOnCentOSLinuxVM]: /manage/linux/common-tasks/mongodb-on-a-linux-vm/\n[InstallMongoOnWindowsVM]: /manage/windows/common-tasks/install-mongodb/\n[VSEWeb]: http://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express\n[VSUlt]: http://www.microsoft.com/visualstudio/eng/2013-downloads\n\n<!-- IMAGES -->\n\n\n[StartPageNewProject]: ./media/web-sites-dotnet-store-data-mongodb-vm/NewProject.png\n[NewProjectMyTaskListApp]: ./media/web-sites-dotnet-store-data-mongodb-vm/NewProjectMyTaskListApp.png\n[VS2013SelectMVCTemplate]: ./media/web-sites-dotnet-store-data-mongodb-vm/VS2013SelectMVCTemplate.png\n[VS2013DefaultMVCApplication]: ./media/web-sites-dotnet-store-data-mongodb-vm/VS2013DefaultMVCApplication.png\n[VS2013ManageNuGetPackages]: ./media/web-sites-dotnet-store-data-mongodb-vm/VS2013ManageNuGetPackages.png\n[SearchforMongoDBCSharpDriver]: ./media/web-sites-dotnet-store-data-mongodb-vm/SearchforMongoDBCSharpDriver.png\n[MongoDBCsharpDriverInstalled]: ./media/web-sites-dotnet-store-data-mongodb-vm/MongoDBCsharpDriverInstalled.png\n[MongoDBCSharpDriverReferences]: ./media/web-sites-dotnet-store-data-mongodb-vm/MongoDBCSharpDriverReferences.png\n[SolutionExplorerMyTaskListApp]: ./media/web-sites-dotnet-store-data-mongodb-vm/SolutionExplorerMyTaskListApp.png\n[TaskListAppBlank]: ./media/web-sites-dotnet-store-data-mongodb-vm/TaskListAppBlank.png\n[WAWSCreateWebSite]: ./media/web-sites-dotnet-store-data-mongodb-vm/WAWSCreateWebSite.png\n[WAWSDashboardMyTaskListApp]: ./media/web-sites-dotnet-store-data-mongodb-vm/WAWSDashboardMyTaskListApp.png\n[Image9]: ./media/web-sites-dotnet-store-data-mongodb-vm/RepoReady.png\n[Image10]: ./media/web-sites-dotnet-store-data-mongodb-vm/GitInstructions.png\n[Image11]: ./media/web-sites-dotnet-store-data-mongodb-vm/GitDeploymentComplete.png\n\n<!-- TOC BOOKMARKS -->\n[Create a virtual machine and install MongoDB]: #virtualmachine\n[Create and run the My Task List ASP.NET application on your development computer]: #createapp\n[Create an Azure web site]: #createwebsite\n[Deploy the ASP.NET application to the web site using Git]: #deployapp\n \ntest\n"
}