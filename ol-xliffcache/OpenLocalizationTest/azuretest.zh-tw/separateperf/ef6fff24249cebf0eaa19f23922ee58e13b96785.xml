{
  "nodes": [
    {
      "content": "Azure Backup - restore a virtual machine | Microsoft Azure",
      "pos": [
        28,
        86
      ]
    },
    {
      "content": "Learn how to restore an Azure virtual machine",
      "pos": [
        105,
        150
      ]
    },
    {
      "content": "Restore a virtual machine",
      "pos": [
        468,
        493
      ]
    },
    {
      "content": "You can restore a virtual machine to a new VM from the backups stored in Azure backup vault using restore action.",
      "pos": [
        494,
        607
      ]
    },
    {
      "content": "Restore workflow",
      "pos": [
        612,
        628
      ]
    },
    {
      "content": "1. Choose an item to restore",
      "pos": [
        633,
        661
      ]
    },
    {
      "pos": [
        666,
        769
      ],
      "content": "Navigate to the <bpt id=\"p1\">**</bpt>Protected Items<ept id=\"p1\">**</ept> tab and select the virtual machine you want to restore to a new VM."
    },
    {
      "content": "Protected items",
      "pos": [
        777,
        792
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Recovery Point<ept id=\"p1\">**</ept> column in the <bpt id=\"p2\">**</bpt>Protected Items<ept id=\"p2\">**</ept> page will tell you the number of recovery points for a virtual machine.",
      "pos": [
        853,
        981
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Newest Recovery Point<ept id=\"p1\">**</ept> column tells you the time of the most recent backup from which a virtual machine can be restored.",
      "pos": [
        982,
        1109
      ]
    },
    {
      "pos": [
        1114,
        1171
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Restore<ept id=\"p1\">**</ept> to open the <bpt id=\"p2\">**</bpt>Restore an Item<ept id=\"p2\">**</ept> wizard."
    },
    {
      "content": "Restore an item",
      "pos": [
        1179,
        1194
      ]
    },
    {
      "content": "2. Pick a recovery point",
      "pos": [
        1252,
        1276
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>select a recovery point<ept id=\"p1\">**</ept> screen, you can restore from the newest recovery point, or from a previous point in time.",
      "pos": [
        1281,
        1405
      ]
    },
    {
      "content": "The default option selected when wizard opens is <bpt id=\"p1\">*</bpt>Newest Recovery Point<ept id=\"p1\">*</ept>.",
      "pos": [
        1406,
        1479
      ]
    },
    {
      "content": "Select a recovery point",
      "pos": [
        1487,
        1510
      ]
    },
    {
      "content": "To pick an earlier point in time, choose the <bpt id=\"p1\">**</bpt>Select Date<ept id=\"p1\">**</ept> option in the dropdown and select a date in the calendar control by clicking on the <bpt id=\"p2\">**</bpt>calendar icon<ept id=\"p2\">**</ept>.",
      "pos": [
        1576,
        1739
      ]
    },
    {
      "content": "In the control, all dates that have recovery points are filled with a light gray shade and are selectable by the user.",
      "pos": [
        1740,
        1858
      ]
    },
    {
      "content": "Select a date",
      "pos": [
        1866,
        1879
      ]
    },
    {
      "content": "Once you click a date in the calendar control, the recovery points available on that date will be shown in recovery points table below.",
      "pos": [
        1936,
        2071
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Time<ept id=\"p1\">**</ept> column indicates the time at which the snapshot was taken.",
      "pos": [
        2072,
        2143
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Type<ept id=\"p1\">**</ept> column displays the <bpt id=\"p2\">[</bpt>consistency<ept id=\"p2\">](https://azure.microsoft.com/documentation/articles/backup-azure-vms/#consistency-of-recovery-points)</ept> of the recovery point.",
      "pos": [
        2144,
        2314
      ]
    },
    {
      "content": "The table header shows the number of recovery points available on that day in parenthesis.",
      "pos": [
        2315,
        2405
      ]
    },
    {
      "content": "Recovery points",
      "pos": [
        2413,
        2428
      ]
    },
    {
      "pos": [
        2488,
        2599
      ],
      "content": "Select the recovery point from the <bpt id=\"p1\">**</bpt>Recovery Points<ept id=\"p1\">**</ept> table and click the Next arrow to go to the next screen."
    },
    {
      "content": "3. Specify a destination location",
      "pos": [
        2605,
        2638
      ]
    },
    {
      "pos": [
        2643,
        2741
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Select restore instance<ept id=\"p1\">**</ept> screen specify details of where to restore the virtual machine."
    },
    {
      "content": "Specify the virtual machine name: In a given cloud service, the virtual machine name should be unique.",
      "pos": [
        2747,
        2849
      ]
    },
    {
      "content": "If you plan to replace an existing VM with the same name, first delete the existing VM and data disks and then restore the data from Azure Backup.",
      "pos": [
        2850,
        2996
      ]
    },
    {
      "content": "Select a cloud service for the VM: This is mandatory for creating a VM.",
      "pos": [
        3001,
        3072
      ]
    },
    {
      "content": "You can choose to either use an existing cloud service or create a new cloud service.",
      "pos": [
        3073,
        3158
      ]
    },
    {
      "content": "Select a storage account for the VM: This is mandatory for creating the VM.",
      "pos": [
        3887,
        3962
      ]
    },
    {
      "content": "You can select from existing storage accounts in the same region as the Azure Backup vault.",
      "pos": [
        3963,
        4054
      ]
    },
    {
      "content": "We don’t support storage accounts that are Zone redundant or of Premium storage type.",
      "pos": [
        4055,
        4140
      ]
    },
    {
      "content": "If there are no storage accounts with supported configuration, please create a storage account of supported configuration prior to starting restore operation.",
      "pos": [
        4146,
        4304
      ]
    },
    {
      "content": "Select a virtual network",
      "pos": [
        4312,
        4336
      ]
    },
    {
      "content": "Select a Virtual Network: The virtual network (VNET) for the virtual machine should be selected at the time of creating the VM.",
      "pos": [
        4391,
        4518
      ]
    },
    {
      "content": "The restore UI shows all the VNETs within this subscription that can be used.",
      "pos": [
        4519,
        4596
      ]
    },
    {
      "content": "It is not mandatory to select a VNET for the restored VM – you will be able to connect to the restored virtual machine over the internet even if the VNET is not applied.",
      "pos": [
        4597,
        4766
      ]
    },
    {
      "content": "If the cloud service selected is associated with a virtual network, then you cannot change the virtual network.",
      "pos": [
        4772,
        4883
      ]
    },
    {
      "content": "Select a virtual network",
      "pos": [
        4891,
        4915
      ]
    },
    {
      "content": "Select a subnet: In case the VNET has subnets, by default the first subnet will be selected.",
      "pos": [
        4975,
        5067
      ]
    },
    {
      "content": "Choose the subnet of your choice from the dropdown options.",
      "pos": [
        5068,
        5127
      ]
    },
    {
      "content": "For subnet details, go to Networks extension in the <bpt id=\"p1\">[</bpt>portal home page<ept id=\"p1\">](https://manage.windowsazure.com/)</ept>, go to <bpt id=\"p2\">**</bpt>Virtual Networks<ept id=\"p2\">**</ept> and select the virtual network and drill down into Configure to see subnet details.",
      "pos": [
        5128,
        5344
      ]
    },
    {
      "content": "Select a subnet",
      "pos": [
        5352,
        5367
      ]
    },
    {
      "pos": [
        5425,
        5512
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Submit<ept id=\"p1\">**</ept> icon in the wizard to submit the details and create a restore job."
    },
    {
      "content": "Track the Restore operation",
      "pos": [
        5517,
        5544
      ]
    },
    {
      "content": "Once you have input all the information into the restore wizard and submitted it Azure Backup will try to create a job to track the restore operation.",
      "pos": [
        5545,
        5695
      ]
    },
    {
      "content": "Creating a restore job",
      "pos": [
        5699,
        5721
      ]
    },
    {
      "content": "If the job creation is successful, you will see a toast notification indicating that the job is created.",
      "pos": [
        5781,
        5885
      ]
    },
    {
      "content": "You can get more details by clicking the <bpt id=\"p1\">**</bpt>View Job<ept id=\"p1\">**</ept> button that will take you to <bpt id=\"p2\">**</bpt>Jobs<ept id=\"p2\">**</ept> tab.",
      "pos": [
        5886,
        5982
      ]
    },
    {
      "content": "Restore job created",
      "pos": [
        5986,
        6005
      ]
    },
    {
      "pos": [
        6066,
        6153
      ],
      "content": "Once the restore operation is finished, it will be marked as completed in <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> tab."
    },
    {
      "content": "Restore job complete",
      "pos": [
        6157,
        6177
      ]
    },
    {
      "pos": [
        6239,
        6451
      ],
      "content": "After restoring the virtual machine you may need to re-install the extensions existing on the original VM and <bpt id=\"p1\">[</bpt>modify the endpoints<ept id=\"p1\">](virtual-machines-set-up-endpoints)</ept> for the virtual machine in the Azure portal."
    },
    {
      "content": "Restoring Domain Controller VMs",
      "pos": [
        6456,
        6487
      ]
    },
    {
      "content": "Backup of Domain Controller (DC) virtual machines is a supported scenario with Azure Backup.",
      "pos": [
        6488,
        6580
      ]
    },
    {
      "content": "However some care must be taken during the restore process.",
      "pos": [
        6581,
        6640
      ]
    },
    {
      "content": "The restore experience is vastly different for Domain Controller VMs in a single-DC configuration vs. VMs in a multi-DC configuration.",
      "pos": [
        6641,
        6775
      ]
    },
    {
      "content": "Single DC",
      "pos": [
        6781,
        6790
      ]
    },
    {
      "content": "The VM can be restored (like any other VM) from the Azure portal or using PowerShell.",
      "pos": [
        6791,
        6876
      ]
    },
    {
      "content": "Multiple DCs",
      "pos": [
        6882,
        6894
      ]
    },
    {
      "content": "When you have a multi-DC environment, the Domain Controllers have their own way of keeping data in sync.",
      "pos": [
        6895,
        6999
      ]
    },
    {
      "content": "When an older backup point is restored <bpt id=\"p1\">*</bpt>without the proper precautions<ept id=\"p1\">*</ept>, The USN rollback process can wreak havoc in a multi-DC environment.",
      "pos": [
        7000,
        7140
      ]
    },
    {
      "content": "The right way to recover such a VM is to boot it in DSRM mode.",
      "pos": [
        7141,
        7203
      ]
    },
    {
      "content": "The challenge arises because DSRM mode is not present in Azure.",
      "pos": [
        7206,
        7269
      ]
    },
    {
      "content": "So to restore such a VM, you cannot use the Azure portal.",
      "pos": [
        7270,
        7327
      ]
    },
    {
      "content": "The only supported restore mechanism is disk-based restore using PowerShell.",
      "pos": [
        7328,
        7404
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.WARNING]</ph> For Domain Controller VMs in a multi-DC environment, do not use the Azure portal for restore!",
      "pos": [
        7407,
        7516
      ]
    },
    {
      "content": "Only PowerShell based restore is supported",
      "pos": [
        7517,
        7559
      ]
    },
    {
      "pos": [
        7561,
        7691
      ],
      "content": "Read more about the <bpt id=\"p1\">[</bpt>USN rollback problem<ept id=\"p1\">](https://technet.microsoft.com/library/dd363553)</ept> and the strategies suggested to fix it."
    },
    {
      "content": "Next steps",
      "pos": [
        7696,
        7706
      ]
    },
    {
      "content": "Troubleshooting errors",
      "pos": [
        7710,
        7732
      ]
    },
    {
      "content": "Manage virtual machines",
      "pos": [
        7779,
        7802
      ]
    },
    {
      "content": "test",
      "pos": [
        7833,
        7837
      ]
    }
  ],
  "content": "\n<properties\n    pageTitle=\"Azure Backup - restore a virtual machine | Microsoft Azure\"\n    description=\"Learn how to restore an Azure virtual machine\"\n    services=\"backup\"\n    documentationCenter=\"\"\n    authors=\"trinadhk\"\n    manager=\"shreeshd\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"backup\"\n    ms.workload=\"storage-backup-recovery\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"08/11/2015\"\n    ms.author=\"trinadhk\"; \"jimpark\"/>\n\n# Restore a virtual machine\nYou can restore a virtual machine to a new VM from the backups stored in Azure backup vault using restore action.\n\n## Restore workflow\n### 1. Choose an item to restore\n\n1. Navigate to the **Protected Items** tab and select the virtual machine you want to restore to a new VM.\n\n    ![Protected items](./media/backup-azure-restore-vms/protected-items.png)\n\n    The **Recovery Point** column in the **Protected Items** page will tell you the number of recovery points for a virtual machine. The **Newest Recovery Point** column tells you the time of the most recent backup from which a virtual machine can be restored.\n\n2. Click **Restore** to open the **Restore an Item** wizard.\n\n    ![Restore an item](./media/backup-azure-restore-vms/restore-item.png)\n\n### 2. Pick a recovery point\n\n1. In the **select a recovery point** screen, you can restore from the newest recovery point, or from a previous point in time. The default option selected when wizard opens is *Newest Recovery Point*.\n\n    ![Select a recovery point](./media/backup-azure-restore-vms/select-recovery-point.png)\n\n2. To pick an earlier point in time, choose the **Select Date** option in the dropdown and select a date in the calendar control by clicking on the **calendar icon**. In the control, all dates that have recovery points are filled with a light gray shade and are selectable by the user.\n\n    ![Select a date](./media/backup-azure-restore-vms/select-date.png)\n\n    Once you click a date in the calendar control, the recovery points available on that date will be shown in recovery points table below. The **Time** column indicates the time at which the snapshot was taken. The **Type** column displays the [consistency](https://azure.microsoft.com/documentation/articles/backup-azure-vms/#consistency-of-recovery-points) of the recovery point. The table header shows the number of recovery points available on that day in parenthesis.\n\n    ![Recovery points](./media/backup-azure-restore-vms/recovery-points.png)\n\n3. Select the recovery point from the **Recovery Points** table and click the Next arrow to go to the next screen.\n\n### 3. Specify a destination location\n\n1. In the **Select restore instance** screen specify details of where to restore the virtual machine.\n\n  - Specify the virtual machine name: In a given cloud service, the virtual machine name should be unique. If you plan to replace an existing VM with the same name, first delete the existing VM and data disks and then restore the data from Azure Backup.\n  - Select a cloud service for the VM: This is mandatory for creating a VM. You can choose to either use an existing cloud service or create a new cloud service.\n\n        Whatever cloud service name is picked should be globally unique. Typically, the cloud service name gets associated with a public-facing URL in the form of [cloudservice].cloudapp.net. Azure will not allow you to create a new cloud service if the name has already been used. If you choose to create select create a new cloud service, it will be given the same name as the virtual machine – in which case the VM name picked should be unique enough to be applied to the associated cloud service.\n\n        We only display cloud services and virtual networks that are not associated with any affinity groups in the restore instance details. [Learn More](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).\n\n2. Select a storage account for the VM: This is mandatory for creating the VM. You can select from existing storage accounts in the same region as the Azure Backup vault. We don’t support storage accounts that are Zone redundant or of Premium storage type.\n\n    If there are no storage accounts with supported configuration, please create a storage account of supported configuration prior to starting restore operation.\n\n    ![Select a virtual network](./media/backup-azure-restore-vms/restore-sa.png)\n\n3. Select a Virtual Network: The virtual network (VNET) for the virtual machine should be selected at the time of creating the VM. The restore UI shows all the VNETs within this subscription that can be used. It is not mandatory to select a VNET for the restored VM – you will be able to connect to the restored virtual machine over the internet even if the VNET is not applied.\n\n    If the cloud service selected is associated with a virtual network, then you cannot change the virtual network.\n\n    ![Select a virtual network](./media/backup-azure-restore-vms/restore-cs-vnet.png)\n\n4. Select a subnet: In case the VNET has subnets, by default the first subnet will be selected. Choose the subnet of your choice from the dropdown options. For subnet details, go to Networks extension in the [portal home page](https://manage.windowsazure.com/), go to **Virtual Networks** and select the virtual network and drill down into Configure to see subnet details.\n\n    ![Select a subnet](./media/backup-azure-restore-vms/select-subnet.png)\n\n5. Click the **Submit** icon in the wizard to submit the details and create a restore job.\n\n## Track the Restore operation\nOnce you have input all the information into the restore wizard and submitted it Azure Backup will try to create a job to track the restore operation.\n\n![Creating a restore job](./media/backup-azure-restore-vms/create-restore-job.png)\n\nIf the job creation is successful, you will see a toast notification indicating that the job is created. You can get more details by clicking the **View Job** button that will take you to **Jobs** tab.\n\n![Restore job created](./media/backup-azure-restore-vms/restore-job-created.png)\n\nOnce the restore operation is finished, it will be marked as completed in **Jobs** tab.\n\n![Restore job complete](./media/backup-azure-restore-vms/restore-job-complete.png)\n\nAfter restoring the virtual machine you may need to re-install the extensions existing on the original VM and [modify the endpoints](virtual-machines-set-up-endpoints) for the virtual machine in the Azure portal.\n\n## Restoring Domain Controller VMs\nBackup of Domain Controller (DC) virtual machines is a supported scenario with Azure Backup. However some care must be taken during the restore process. The restore experience is vastly different for Domain Controller VMs in a single-DC configuration vs. VMs in a multi-DC configuration.\n\n### Single DC\nThe VM can be restored (like any other VM) from the Azure portal or using PowerShell.\n\n### Multiple DCs\nWhen you have a multi-DC environment, the Domain Controllers have their own way of keeping data in sync. When an older backup point is restored *without the proper precautions*, The USN rollback process can wreak havoc in a multi-DC environment. The right way to recover such a VM is to boot it in DSRM mode. \n\nThe challenge arises because DSRM mode is not present in Azure. So to restore such a VM, you cannot use the Azure portal. The only supported restore mechanism is disk-based restore using PowerShell.\n\n>[AZURE.WARNING] For Domain Controller VMs in a multi-DC environment, do not use the Azure portal for restore! Only PowerShell based restore is supported\n\nRead more about the [USN rollback problem](https://technet.microsoft.com/library/dd363553) and the strategies suggested to fix it.\n\n## Next steps\n- [Troubleshooting errors](backup-azure-vms-troubleshoot.md#restore)\n- [Manage virtual machines](backup-azure-manage-vms.md)\n\ntest\n"
}