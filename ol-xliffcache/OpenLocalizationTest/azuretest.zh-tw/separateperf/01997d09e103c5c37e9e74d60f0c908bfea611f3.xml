{
  "nodes": [
    {
      "content": "Next, you need to change the way that push notifications are registered to make sure that the user is authenticated before registration is attempted.",
      "pos": [
        1,
        150
      ]
    },
    {
      "content": "The client app updates depend on the way in which you implemented push notifications.",
      "pos": [
        151,
        236
      ]
    },
    {
      "content": "Using the Add Push Notification Wizard in Visual Studio 2013 Update 2 or a later version",
      "pos": [
        241,
        329
      ]
    },
    {
      "content": "In this method, the wizard generated a new push.register.cs file in your project.",
      "pos": [
        331,
        412
      ]
    },
    {
      "pos": [
        417,
        593
      ],
      "content": "In Visual Studio in Solution Explorer, open the app.xaml.cs project file and in the <bpt id=\"p1\">**</bpt>OnLaunched<ept id=\"p1\">**</ept> event handler comment-out or delete the call to the <bpt id=\"p2\">**</bpt>UploadChannel<ept id=\"p2\">**</ept> method."
    },
    {
      "pos": [
        599,
        704
      ],
      "content": "Open the push.register.cs project file and replace the <bpt id=\"p1\">**</bpt>UploadChannel<ept id=\"p1\">**</ept> method, with the following code:"
    },
    {
      "content": "This makes sure that registration is done using the same client instance that has the authenticated user credentials.",
      "pos": [
        1312,
        1429
      ]
    },
    {
      "content": "Otherwise, registration will fail with an Unauthorized (401) error.",
      "pos": [
        1430,
        1497
      ]
    },
    {
      "pos": [
        1502,
        1609
      ],
      "content": "Open the shared MainPage.cs project file, and replace the <bpt id=\"p1\">**</bpt>ButtonLogin_Click<ept id=\"p1\">**</ept> handler with the following:"
    },
    {
      "content": "This makes sure that authentication occurs before push registration is attempted.",
      "pos": [
        2066,
        2147
      ]
    },
    {
      "pos": [
        2153,
        2341
      ],
      "content": "In the previous code, replace the generated push class name (<ph id=\"ph1\">`todolistPush`</ph>) with the name of class generated by the wizard, usually in the format <ph id=\"ph2\">&lt;code&gt;</ph><ph id=\"ph3\">&lt;em&gt;</ph><ph id=\"ph4\">mobile_service</ph><ph id=\"ph5\">&lt;/em&gt;</ph><ph id=\"ph6\">Push</ph><ph id=\"ph7\">&lt;/code&gt;</ph>."
    },
    {
      "content": "Manually enabled push notifications",
      "pos": [
        2347,
        2382
      ]
    },
    {
      "content": "In this method, you added registration code from the tutorial directly to the app.xaml.cs project file.",
      "pos": [
        2390,
        2493
      ]
    },
    {
      "pos": [
        2498,
        2672
      ],
      "content": "In Visual Studio in Solution Explorer, open the app.xaml.cs project file and in the <bpt id=\"p1\">**</bpt>OnLaunched<ept id=\"p1\">**</ept> event handler comment-out or delete the call to <bpt id=\"p2\">**</bpt>InitNotificationsAsync<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        2679,
        2802
      ],
      "content": "Change the accessibility of the <bpt id=\"p1\">**</bpt>InitNotificationsAsync<ept id=\"p1\">**</ept> method from <ph id=\"ph1\">`private`</ph> to <ph id=\"ph2\">`public`</ph> and add the <ph id=\"ph3\">`static`</ph> modifier."
    },
    {
      "pos": [
        2808,
        2915
      ],
      "content": "Open the shared MainPage.cs project file, and replace the <bpt id=\"p1\">**</bpt>ButtonLogin_Click<ept id=\"p1\">**</ept> handler with the following:"
    },
    {
      "content": "This makes sure that authentication occurs before push registration is attempted.",
      "pos": [
        3376,
        3457
      ]
    }
  ],
  "content": "\nNext, you need to change the way that push notifications are registered to make sure that the user is authenticated before registration is attempted. The client app updates depend on the way in which you implemented push notifications.\n\n###Using the Add Push Notification Wizard in Visual Studio 2013 Update 2 or a later version\n\nIn this method, the wizard generated a new push.register.cs file in your project.\n\n1. In Visual Studio in Solution Explorer, open the app.xaml.cs project file and in the **OnLaunched** event handler comment-out or delete the call to the **UploadChannel** method. \n\n2. Open the push.register.cs project file and replace the **UploadChannel** method, with the following code:\n\n        public async static void UploadChannel()\n        {\n            var channel = \n                await Windows.Networking.PushNotifications.PushNotificationChannelManager\n                .CreatePushNotificationChannelForApplicationAsync();\n        \n            try\n            {\n                // Create a native push notification registration.\n                await App.MobileService.GetPush().RegisterNativeAsync(channel.Uri);             \n        \n            }\n            catch (Exception exception)\n            {\n                HandleRegisterException(exception);\n            }\n        }\n\n    This makes sure that registration is done using the same client instance that has the authenticated user credentials. Otherwise, registration will fail with an Unauthorized (401) error.\n\n3. Open the shared MainPage.cs project file, and replace the **ButtonLogin_Click** handler with the following:\n\n        private async void ButtonLogin_Click(object sender, RoutedEventArgs e)\n        {\n            // Login the user and then load data from the mobile service.\n            await AuthenticateAsync();\n            todolistPush.UploadChannel();\n\n            // Hide the login button and load items from the mobile service.\n            this.ButtonLogin.Visibility = Windows.UI.Xaml.Visibility.Collapsed;\n            await RefreshTodoItems();\n        }\n\n    This makes sure that authentication occurs before push registration is attempted.\n\n4.  In the previous code, replace the generated push class name (`todolistPush`) with the name of class generated by the wizard, usually in the format <code><em>mobile_service</em>Push</code>. \n\n###Manually enabled push notifications      \n\nIn this method, you added registration code from the tutorial directly to the app.xaml.cs project file.\n\n1. In Visual Studio in Solution Explorer, open the app.xaml.cs project file and in the **OnLaunched** event handler comment-out or delete the call to **InitNotificationsAsync**. \n \n2. Change the accessibility of the **InitNotificationsAsync** method from `private` to `public` and add the `static` modifier. \n\n3. Open the shared MainPage.cs project file, and replace the **ButtonLogin_Click** handler with the following:\n\n        private async void ButtonLogin_Click(object sender, RoutedEventArgs e)\n        {\n            // Login the user and then load data from the mobile service.\n            await AuthenticateAsync();\n            App.InitNotificationsAsync();\n\n            // Hide the login button and load items from the mobile service.\n            this.ButtonLogin.Visibility = Windows.UI.Xaml.Visibility.Collapsed;\n            await RefreshTodoItems();\n        }\n    \n    This makes sure that authentication occurs before push registration is attempted."
}