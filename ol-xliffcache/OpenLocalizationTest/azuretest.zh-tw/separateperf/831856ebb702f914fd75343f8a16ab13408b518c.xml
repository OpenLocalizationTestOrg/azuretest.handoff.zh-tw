{
  "nodes": [
    {
      "content": "Base Configuration Test Environment with Azure Resource Manager",
      "pos": [
        27,
        90
      ]
    },
    {
      "content": "Learn how to create a simple dev/test environment that simulates a simplified intranet in Microsoft Azure using Resource Manager.",
      "pos": [
        109,
        238
      ]
    },
    {
      "content": "Base Configuration test environment with Azure Resource Manager",
      "pos": [
        609,
        672
      ]
    },
    {
      "content": "This article provides you with step-by-step instructions to create the Base Configuration test environment in a Microsoft Azure Virtual Network, using virtual machines created in Resource Manager.",
      "pos": [
        674,
        870
      ]
    },
    {
      "content": "You can use the resulting test environment:",
      "pos": [
        873,
        916
      ]
    },
    {
      "content": "For application development and testing.",
      "pos": [
        920,
        960
      ]
    },
    {
      "content": "As the initial configuration of an extended test environment of your own design that includes additional virtual machines and Azure services.",
      "pos": [
        963,
        1104
      ]
    },
    {
      "content": "The Base Configuration test environment consists of the Corpnet subnet in a cloud-only virtual network named TestLab that simulates a simplified, private intranet connected to the Internet.",
      "pos": [
        1106,
        1295
      ]
    },
    {
      "content": "It contains:",
      "pos": [
        1394,
        1406
      ]
    },
    {
      "content": "An Azure virtual machine running Windows Server 2012 R2 named DC1 that is configured as an intranet domain controller and Domain Name System (DNS) server.",
      "pos": [
        1410,
        1564
      ]
    },
    {
      "content": "An Azure virtual machine running Windows Server 2012 R2 named APP1 that is configured as a general application and web server.",
      "pos": [
        1567,
        1693
      ]
    },
    {
      "content": "An Azure virtual machine running Windows Server 2012 R2 named CLIENT1 that acts as an intranet client.",
      "pos": [
        1696,
        1798
      ]
    },
    {
      "content": "This configuration allows DC1, APP1, CLIENT1, and additional Corpnet subnet computers to be:",
      "pos": [
        1800,
        1892
      ]
    },
    {
      "content": "Connected to the Internet to install updates, access Internet resources in real time, and participate in public cloud technologies such as Microsoft Office 365 and other Azure services.",
      "pos": [
        1898,
        2083
      ]
    },
    {
      "content": "Remotely managed using Remote Desktop Connections from your computer that is connected to the Internet or your organization network.",
      "pos": [
        2086,
        2218
      ]
    },
    {
      "content": "There are four phases to setting up the Corpnet subnet of the Windows Server 2012 R2 Base Configuration test environment in Azure.",
      "pos": [
        2220,
        2350
      ]
    },
    {
      "content": "Create the virtual network.",
      "pos": [
        2356,
        2383
      ]
    },
    {
      "content": "Configure DC1.",
      "pos": [
        2388,
        2402
      ]
    },
    {
      "content": "Configure APP1.",
      "pos": [
        2407,
        2422
      ]
    },
    {
      "content": "Configure CLIENT1.",
      "pos": [
        2427,
        2445
      ]
    },
    {
      "content": "If you do not already have an Azure account, you can sign up for a free trial at <bpt id=\"p1\">[</bpt>Try Azure<ept id=\"p1\">](http://azure.microsoft.com/pricing/free-trial/)</ept>.",
      "pos": [
        2447,
        2588
      ]
    },
    {
      "content": "If you have an MSDN Subscription, see <bpt id=\"p1\">[</bpt>Azure benefit for MSDN subscribers<ept id=\"p1\">](http://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/)</ept>.",
      "pos": [
        2589,
        2737
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Virtual machines in Azure incur an ongoing monetary cost when they are running.",
      "pos": [
        2741,
        2833
      ]
    },
    {
      "content": "This cost is billed against your free trial, MSDN subscription, or paid subscription.",
      "pos": [
        2834,
        2919
      ]
    },
    {
      "content": "For more information about the costs of running Azure virtual machines, see <bpt id=\"p1\">[</bpt>Virtual Machines Pricing Details<ept id=\"p1\">](http://azure.microsoft.com/pricing/details/virtual-machines/)</ept> and <bpt id=\"p2\">[</bpt>Azure Pricing Calculator<ept id=\"p2\">](http://azure.microsoft.com/pricing/calculator/)</ept>.",
      "pos": [
        2920,
        3172
      ]
    },
    {
      "content": "To keep costs down, see <bpt id=\"p1\">[</bpt>Minimizing the costs of test environment virtual machines in Azure<ept id=\"p1\">](#costs)</ept>.",
      "pos": [
        3173,
        3274
      ]
    },
    {
      "content": "Base Configuration test environment",
      "pos": [
        3411,
        3446
      ]
    },
    {
      "content": "Phase 1: Create the virtual network",
      "pos": [
        3510,
        3545
      ]
    },
    {
      "content": "First, if needed, use the instructions in <bpt id=\"p1\">[</bpt>How to install and configure Azure PowerShell<ept id=\"p1\">](../install-configure-powershell.md)</ept> to install Azure PowerShell on your local computer.",
      "pos": [
        3547,
        3724
      ]
    },
    {
      "content": "Open an Azure PowerShell prompt.",
      "pos": [
        3725,
        3757
      ]
    },
    {
      "content": "Next, select the correct Azure subscription with these commands.",
      "pos": [
        3759,
        3823
      ]
    },
    {
      "content": "Replace everything within the quotes, including the &lt; and &gt; characters, with the correct name.",
      "pos": [
        3824,
        3918
      ]
    },
    {
      "pos": [
        4019,
        4144
      ],
      "content": "You can get the subscription name from the SubscriptionName property of the display of the <bpt id=\"p1\">**</bpt>Get-AzureSubscription<ept id=\"p1\">**</ept> command."
    },
    {
      "content": "Next, switch Azure PowerShell into Resource Manager mode.",
      "pos": [
        4146,
        4203
      ]
    },
    {
      "content": "Next, create a new resource group for your Base Configuration test lab.",
      "pos": [
        4249,
        4320
      ]
    },
    {
      "content": "To determine a unique resource group name, use this command to list your existing resource groups.",
      "pos": [
        4321,
        4419
      ]
    },
    {
      "content": "To list the Azure locations where you can create Resource Manager-based virtual machines, use these commands.",
      "pos": [
        4501,
        4610
      ]
    },
    {
      "content": "Create your new resource group with these commands.",
      "pos": [
        4719,
        4770
      ]
    },
    {
      "content": "Replace everything within the quotes, including the &lt; and &gt; characters, with the correct names.",
      "pos": [
        4771,
        4866
      ]
    },
    {
      "content": "Resource Manager-based virtual machines require a Resource Manager-based storage account.",
      "pos": [
        5013,
        5102
      ]
    },
    {
      "content": "You must pick a globally unique name for your storage account that contains only lowercase letters and numbers.",
      "pos": [
        5103,
        5214
      ]
    },
    {
      "content": "You can use this command to list the existing storage accounts.",
      "pos": [
        5215,
        5278
      ]
    },
    {
      "content": "To test whether a chosen storage account name is globally unique, you need to run the <bpt id=\"p1\">**</bpt>Test-AzureName<ept id=\"p1\">**</ept> command in the Azure Service Management mode of PowerShell.",
      "pos": [
        5335,
        5499
      ]
    },
    {
      "content": "Use these commands.",
      "pos": [
        5500,
        5519
      ]
    },
    {
      "content": "If the Test-AzureName command displays <bpt id=\"p1\">**</bpt>False<ept id=\"p1\">**</ept>, your proposed name is unique.",
      "pos": [
        5626,
        5705
      ]
    },
    {
      "content": "When you have determined a unique name, switch Azure PowerShell back to Resource Manager mode with this command.",
      "pos": [
        5706,
        5818
      ]
    },
    {
      "content": "Create a new storage account for your new test environment with these commands.",
      "pos": [
        5864,
        5943
      ]
    },
    {
      "content": "Next, you create the TestLab Azure Virtual Network that will host the Corpnet subnet of the base configuration.",
      "pos": [
        6192,
        6303
      ]
    },
    {
      "content": "This is your current configuration.",
      "pos": [
        6661,
        6696
      ]
    },
    {
      "content": "Phase 2: Configure DC1",
      "pos": [
        6798,
        6820
      ]
    },
    {
      "content": "DC1 is a domain controller for the corp.contoso.com Active Directory Domain Services (AD DS) domain and a DNS server for the virtual machines of the TestLab virtual network.",
      "pos": [
        6822,
        6995
      ]
    },
    {
      "content": "First, fill in the name of your resource group, Azure location, and storage account name and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for DC1.",
      "pos": [
        6997,
        7214
      ]
    },
    {
      "content": "Next, connect to the DC1 virtual machine.",
      "pos": [
        8742,
        8783
      ]
    },
    {
      "pos": [
        8789,
        8951
      ],
      "content": "In the Azure Preview portal, click <bpt id=\"p1\">**</bpt>Browse All<ept id=\"p1\">**</ept> in the left pane, click <bpt id=\"p2\">**</bpt>Virtual machines<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Browse<ept id=\"p3\">**</ept> list, and then click the <bpt id=\"p4\">**</bpt>DC1<ept id=\"p4\">**</ept> virtual machine."
    },
    {
      "pos": [
        8958,
        8998
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>DC1<ept id=\"p1\">**</ept> pane,, click <bpt id=\"p2\">**</bpt>Connect<ept id=\"p2\">**</ept>."
    },
    {
      "content": "When prompted, open the DC1.rdp downloaded file.",
      "pos": [
        9003,
        9051
      ]
    },
    {
      "pos": [
        9056,
        9134
      ],
      "content": "When prompted with a Remote Desktop Connection message box, click <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept>."
    },
    {
      "content": "When prompted for credentials, use the following:",
      "pos": [
        9139,
        9188
      ]
    },
    {
      "pos": [
        9191,
        9240
      ],
      "content": "Name: <bpt id=\"p1\">**</bpt>DC1\\\\<ept id=\"p1\">**</ept>[Local administrator account name]"
    },
    {
      "content": "Password: [Local administrator account password]",
      "pos": [
        9243,
        9291
      ]
    },
    {
      "pos": [
        9296,
        9396
      ],
      "content": "When prompted with a Remote Desktop Connection message box referring to certificates, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Next, add an extra data disk as a new volume with the drive letter F:.",
      "pos": [
        9398,
        9468
      ]
    },
    {
      "pos": [
        9474,
        9572
      ],
      "content": "In the left pane of Server Manager, click <bpt id=\"p1\">**</bpt>File and Storage Services<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Disks<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        9577,
        9684
      ],
      "content": "In the contents pane, in the <bpt id=\"p1\">**</bpt>Disks<ept id=\"p1\">**</ept> group, click <bpt id=\"p2\">**</bpt>disk 2<ept id=\"p2\">**</ept> (with the <bpt id=\"p3\">**</bpt>Partition<ept id=\"p3\">**</ept> set to <bpt id=\"p4\">**</bpt>Unknown<ept id=\"p4\">**</ept>)."
    },
    {
      "pos": [
        9689,
        9736
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Tasks<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>New Volume<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        9741,
        9811
      ],
      "content": "On the Before you begin page of the New Volume Wizard, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "content": "On the Select the server and disk page, click <bpt id=\"p1\">**</bpt>Disk 2<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.",
      "pos": [
        9816,
        9898
      ]
    },
    {
      "content": "When prompted, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.",
      "pos": [
        9899,
        9927
      ]
    },
    {
      "pos": [
        9932,
        9991
      ],
      "content": "On the Specify the size of the volume page, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        9996,
        10059
      ],
      "content": "On the Assign to a drive letter or folder page, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        10064,
        10120
      ],
      "content": "On the Select file system settings page, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        10125,
        10174
      ],
      "content": "On the Confirm selections page, click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        10179,
        10210
      ],
      "content": "When complete, click <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Next, configure DC1 as a domain controller and DNS server for the corp.contoso.com domain.",
      "pos": [
        10212,
        10302
      ]
    },
    {
      "content": "Run these commands at an administrator-level Windows PowerShell command prompt.",
      "pos": [
        10303,
        10382
      ]
    },
    {
      "content": "After DC1 restarts, reconnect to the DC1 virtual machine.",
      "pos": [
        10574,
        10631
      ]
    },
    {
      "content": "In the Azure Preview portal, click Browse All in the left pane, click Virtual machines in the Browse list, and then click the DC1 virtual machine.",
      "pos": [
        10637,
        10783
      ]
    },
    {
      "content": "In the DC1 pane, click Connect.",
      "pos": [
        10788,
        10819
      ]
    },
    {
      "pos": [
        10824,
        10870
      ],
      "content": "When prompted to open DC1.rdp, click <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        10875,
        10953
      ],
      "content": "When prompted with a Remote Desktop Connection message box, click <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept>."
    },
    {
      "content": "When prompted for credentials, use the following:",
      "pos": [
        10958,
        11007
      ]
    },
    {
      "pos": [
        11010,
        11060
      ],
      "content": "Name: <bpt id=\"p1\">**</bpt>CORP\\\\<ept id=\"p1\">**</ept>[Local administrator account name]"
    },
    {
      "content": "Password: [Local administrator account password]",
      "pos": [
        11063,
        11111
      ]
    },
    {
      "pos": [
        11116,
        11214
      ],
      "content": "When prompted by a Remote Desktop Connection message box referring to certificates, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Next, create a user account in Active Directory that will be used when logging in to CORP domain member computers.",
      "pos": [
        11216,
        11330
      ]
    },
    {
      "content": "Run these commands one at a time at an administrator-level Windows PowerShell command prompt.",
      "pos": [
        11331,
        11424
      ]
    },
    {
      "content": "Note that the first command results in a prompt to supply the User1 account password.",
      "pos": [
        11829,
        11914
      ]
    },
    {
      "content": "Because this account will be used for remote desktop connections for all CORP domain member computers, choose a strong password.",
      "pos": [
        11915,
        12043
      ]
    },
    {
      "content": "To check its strength, see <bpt id=\"p1\">[</bpt>Password Checker: Using Strong Passwords<ept id=\"p1\">](https://www.microsoft.com/security/pc-security/password-checker.aspx)</ept>.",
      "pos": [
        12044,
        12184
      ]
    },
    {
      "content": "Record the User1 account password and store it in a secured location.",
      "pos": [
        12185,
        12254
      ]
    },
    {
      "content": "Close the Remote Desktop session with DC1 and then reconnect using the CORP\\User1 account.",
      "pos": [
        12256,
        12346
      ]
    },
    {
      "content": "Next, to allow traffic for the Ping tool, run this command at an administrator-level Windows PowerShell command prompt.",
      "pos": [
        12348,
        12467
      ]
    },
    {
      "content": "This is your current configuration.",
      "pos": [
        12575,
        12610
      ]
    },
    {
      "content": "Phase 3: Configure APP1",
      "pos": [
        12712,
        12735
      ]
    },
    {
      "content": "APP1 provides web and file sharing services.",
      "pos": [
        12737,
        12781
      ]
    },
    {
      "content": "First, fill in the name of your resource group, Azure location, and storage account name and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for APP1.",
      "pos": [
        12783,
        13001
      ]
    },
    {
      "content": "Next, connect to the APP1 virtual machine using the APP1 local administrator account name and password, and then open an administrator-level Windows PowerShell command prompt.",
      "pos": [
        14316,
        14491
      ]
    },
    {
      "pos": [
        14493,
        14651
      ],
      "content": "To check name resolution and network communication between APP1 and DC1, run the <bpt id=\"p1\">**</bpt>ping dc1.corp.contoso.com<ept id=\"p1\">**</ept> command and verify that there are four replies."
    },
    {
      "content": "Next, join the APP1 virtual machine to the CORP domain with these commands at the Windows PowerShell prompt.",
      "pos": [
        14653,
        14761
      ]
    },
    {
      "content": "Note that you must supply your CORP\\User1 domain account credentials after entering the Add-Computer command.",
      "pos": [
        14831,
        14940
      ]
    },
    {
      "content": "After APP1 restarts, connect to it using the CORP\\User1 account name and password, and then open an administrator-level Windows PowerShell command prompt.",
      "pos": [
        14942,
        15096
      ]
    },
    {
      "content": "Next, make APP1 a web server with this command at the Windows PowerShell command prompt.",
      "pos": [
        15098,
        15186
      ]
    },
    {
      "content": "Next, create a shared folder and a text file within the folder on APP1 with these commands.",
      "pos": [
        15254,
        15345
      ]
    },
    {
      "content": "This is your current configuration.",
      "pos": [
        15535,
        15570
      ]
    },
    {
      "content": "Phase 4: Configure CLIENT1",
      "pos": [
        15672,
        15698
      ]
    },
    {
      "content": "CLIENT1 acts as a typical laptop, tablet, or desktop computer on the Contoso intranet.",
      "pos": [
        15700,
        15786
      ]
    },
    {
      "content": "First, fill in the name of your resource group, Azure location, and storage account name and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for CLIENT1.",
      "pos": [
        15788,
        16009
      ]
    },
    {
      "content": "Next, connect to the CLIENT1 virtual machine using the CLIENT1 local administrator account name and password, and then open an administrator-level Windows PowerShell command prompt.",
      "pos": [
        17346,
        17527
      ]
    },
    {
      "pos": [
        17529,
        17729
      ],
      "content": "To check name resolution and network communication between CLIENT1 and DC1, run the <bpt id=\"p1\">**</bpt>ping dc1.corp.contoso.com<ept id=\"p1\">**</ept> command at a Windows PowerShell command prompt and verify that there are four replies."
    },
    {
      "content": "Next, join the CLIENT1 virtual machine to the CORP domain with these commands at the Windows PowerShell prompt.",
      "pos": [
        17731,
        17842
      ]
    },
    {
      "content": "Note that you must supply your CORP\\User1 domain account credentials after entering the Add-Computer command.",
      "pos": [
        17912,
        18021
      ]
    },
    {
      "content": "After CLIENT1 restarts, connect to it using the CORP\\User1 account name and password, and then open an administrator-level Windows PowerShell command prompt.",
      "pos": [
        18023,
        18180
      ]
    },
    {
      "content": "Next, verify that you can access web and file share resources on APP1 from CLIENT1.",
      "pos": [
        18182,
        18265
      ]
    },
    {
      "pos": [
        18271,
        18331
      ],
      "content": "In Server Manager, in the tree pane, click <bpt id=\"p1\">**</bpt>Local Server<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        18336,
        18427
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Properties for CLIENT1<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>On<ept id=\"p2\">**</ept> next to <bpt id=\"p3\">**</bpt>IE Enhanced Security Configuration<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        18432,
        18564
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Internet Explorer Enhanced Security Configuration<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Off<ept id=\"p2\">**</ept> for <bpt id=\"p3\">**</bpt>Administrators<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>Users<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>OK<ept id=\"p5\">**</ept>."
    },
    {
      "pos": [
        18569,
        18643
      ],
      "content": "From the Start screen, click <bpt id=\"p1\">**</bpt>Internet Explorer<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "In the Address bar, type <bpt id=\"p1\">**</bpt>http://app1.corp.contoso.com/<ept id=\"p1\">**</ept>, and then press ENTER.",
      "pos": [
        18648,
        18729
      ]
    },
    {
      "content": "You should see the default Internet Information Services web page for APP1.",
      "pos": [
        18731,
        18806
      ]
    },
    {
      "content": "From the desktop taskbar, click the File Explorer icon.",
      "pos": [
        18811,
        18866
      ]
    },
    {
      "pos": [
        18871,
        18936
      ],
      "content": "In the address bar, type <bpt id=\"p1\">**</bpt>\\\\\\app1\\Files<ept id=\"p1\">**</ept>, and then press ENTER."
    },
    {
      "content": "You should see a folder window with the contents of the Files shared folder.",
      "pos": [
        18941,
        19017
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Files<ept id=\"p1\">**</ept> shared folder window, double-click the <bpt id=\"p2\">**</bpt>Example.txt<ept id=\"p2\">**</ept> file.",
      "pos": [
        19022,
        19099
      ]
    },
    {
      "content": "You should see the contents of the Example.txt file.",
      "pos": [
        19100,
        19152
      ]
    },
    {
      "pos": [
        19157,
        19233
      ],
      "content": "Close the <bpt id=\"p1\">**</bpt>example.txt - Notepad<ept id=\"p1\">**</ept> and the <bpt id=\"p2\">**</bpt>Files<ept id=\"p2\">**</ept> shared folder windows."
    },
    {
      "content": "This is your final configuration.",
      "pos": [
        19235,
        19268
      ]
    },
    {
      "content": "Your base configuration in Azure is now ready for application development and testing or for additional test environments.",
      "pos": [
        19367,
        19489
      ]
    },
    {
      "content": "Additional resources",
      "pos": [
        19494,
        19514
      ]
    },
    {
      "content": "Hybrid cloud test environments",
      "pos": [
        19517,
        19547
      ]
    },
    {
      "content": "Base Configuration test environment",
      "pos": [
        19630,
        19665
      ]
    },
    {
      "pos": [
        19729,
        19813
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"costs\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Minimizing the costs of test environment virtual machines in Azure"
    },
    {
      "content": "To minimize the cost of running the test environment virtual machines, you can do one of the following:",
      "pos": [
        19815,
        19918
      ]
    },
    {
      "content": "Create the test environment and perform your needed testing and demonstration as quickly as possible.",
      "pos": [
        19922,
        20023
      ]
    },
    {
      "content": "When complete, delete the test environment virtual machines.",
      "pos": [
        20024,
        20084
      ]
    },
    {
      "content": "Shut down your test environment virtual machines into a deallocated state.",
      "pos": [
        20087,
        20161
      ]
    },
    {
      "content": "To shut down the virtual machines with Azure PowerShell, fill in the resource group name and run these commands.",
      "pos": [
        20163,
        20275
      ]
    },
    {
      "content": "To ensure that your virtual machines work properly when starting all of them from the Stopped (Deallocated) state, you should start them in the following order:",
      "pos": [
        20516,
        20676
      ]
    },
    {
      "content": "DC1",
      "pos": [
        20682,
        20685
      ]
    },
    {
      "content": "APP1",
      "pos": [
        20690,
        20694
      ]
    },
    {
      "content": "CLIENT1",
      "pos": [
        20699,
        20706
      ]
    },
    {
      "content": "To start the virtual machines in order with Azure PowerShell, fill in the resource group name and run these commands.",
      "pos": [
        20708,
        20825
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Base Configuration Test Environment with Azure Resource Manager\"\n    description=\"Learn how to create a simple dev/test environment that simulates a simplified intranet in Microsoft Azure using Resource Manager.\"\n    documentationCenter=\"\"\n    services=\"virtual-machines\"\n    authors=\"JoeDavies-MSFT\"\n    manager=\"timlt\"\n    editor=\"\"\n    tags=\"azure-resource-manager\"/>\n\n<tags\n    ms.service=\"virtual-machines\"\n    ms.workload=\"infrastructure-services\"\n    ms.tgt_pltfrm=\"vm-windows\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"07/23/2015\"\n    ms.author=\"josephd\"/>\n\n# Base Configuration test environment with Azure Resource Manager\n\nThis article provides you with step-by-step instructions to create the Base Configuration test environment in a Microsoft Azure Virtual Network, using virtual machines created in Resource Manager. \n\nYou can use the resulting test environment:\n\n- For application development and testing.\n- As the initial configuration of an extended test environment of your own design that includes additional virtual machines and Azure services.\n\nThe Base Configuration test environment consists of the Corpnet subnet in a cloud-only virtual network named TestLab that simulates a simplified, private intranet connected to the Internet.\n\n![](./media/virtual-machines-base-configuration-test-environment-resource-manager/BC_TLG04.png)\n\nIt contains:\n\n- An Azure virtual machine running Windows Server 2012 R2 named DC1 that is configured as an intranet domain controller and Domain Name System (DNS) server.\n- An Azure virtual machine running Windows Server 2012 R2 named APP1 that is configured as a general application and web server.\n- An Azure virtual machine running Windows Server 2012 R2 named CLIENT1 that acts as an intranet client.\n\nThis configuration allows DC1, APP1, CLIENT1, and additional Corpnet subnet computers to be:  \n\n- Connected to the Internet to install updates, access Internet resources in real time, and participate in public cloud technologies such as Microsoft Office 365 and other Azure services.\n- Remotely managed using Remote Desktop Connections from your computer that is connected to the Internet or your organization network.\n\nThere are four phases to setting up the Corpnet subnet of the Windows Server 2012 R2 Base Configuration test environment in Azure.\n\n1.  Create the virtual network.\n2.  Configure DC1.\n3.  Configure APP1.\n4.  Configure CLIENT1.\n\nIf you do not already have an Azure account, you can sign up for a free trial at [Try Azure](http://azure.microsoft.com/pricing/free-trial/). If you have an MSDN Subscription, see [Azure benefit for MSDN subscribers](http://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/).\n\n> [AZURE.NOTE] Virtual machines in Azure incur an ongoing monetary cost when they are running. This cost is billed against your free trial, MSDN subscription, or paid subscription. For more information about the costs of running Azure virtual machines, see [Virtual Machines Pricing Details](http://azure.microsoft.com/pricing/details/virtual-machines/) and [Azure Pricing Calculator](http://azure.microsoft.com/pricing/calculator/). To keep costs down, see [Minimizing the costs of test environment virtual machines in Azure](#costs).\n\n[AZURE.INCLUDE [resource-manager-pointer-to-service-management](../../includes/resource-manager-pointer-to-service-management.md)]\n\n- [Base Configuration test environment](virtual-machines-base-configuration-test-environment.md)\n\n\n## Phase 1: Create the virtual network\n\nFirst, if needed, use the instructions in [How to install and configure Azure PowerShell](../install-configure-powershell.md) to install Azure PowerShell on your local computer. Open an Azure PowerShell prompt.\n\nNext, select the correct Azure subscription with these commands. Replace everything within the quotes, including the < and > characters, with the correct name.\n\n    $subscr=\"<Subscription name>\"\n    Select-AzureSubscription -SubscriptionName $subscr –Current\n\nYou can get the subscription name from the SubscriptionName property of the display of the **Get-AzureSubscription** command.\n\nNext, switch Azure PowerShell into Resource Manager mode.\n\n    Switch-AzureMode AzureResourceManager \n\nNext, create a new resource group for your Base Configuration test lab. To determine a unique resource group name, use this command to list your existing resource groups.\n\n    Get-AzureResourceGroup | Sort ResourceGroupName | Select ResourceGroupName\n\nTo list the Azure locations where you can create Resource Manager-based virtual machines, use these commands.\n\n    $loc=Get-AzureLocation | where { $_.Name –eq \"Microsoft.Compute/virtualMachines\" }\n    $loc.Locations\n\nCreate your new resource group with these commands. Replace everything within the quotes, including the < and > characters, with the correct names.\n\n    $rgName=\"<resource group name>\"\n    $locName=\"<location name, such as West US>\"\n    New-AzureResourceGroup -Name $rgName -Location $locName\n\nResource Manager-based virtual machines require a Resource Manager-based storage account. You must pick a globally unique name for your storage account that contains only lowercase letters and numbers. You can use this command to list the existing storage accounts.\n\n    Get-AzureStorageAccount | Sort Name | Select Name\n\nTo test whether a chosen storage account name is globally unique, you need to run the **Test-AzureName** command in the Azure Service Management mode of PowerShell. Use these commands.\n\n    Switch-AzureMode AzureServiceManagement\n    Test-AzureName -Storage <Proposed storage account name>\n\nIf the Test-AzureName command displays **False**, your proposed name is unique. When you have determined a unique name, switch Azure PowerShell back to Resource Manager mode with this command.\n\n    Switch-AzureMode AzureResourceManager \n\nCreate a new storage account for your new test environment with these commands.\n\n    $rgName=\"<your new resource group name>\"\n    $locName=\"<the location of your new resource group>\"\n    $saName=\"<storage account name>\"\n    New-AzureStorageAccount -Name $saName -ResourceGroupName $rgName –Type Standard_LRS -Location $locName\n\nNext, you create the TestLab Azure Virtual Network that will host the Corpnet subnet of the base configuration.\n\n    $rgName=\"<name of your new resource group>\"\n    $locName=\"<Azure location name, such as West US>\"\n    $corpnetSubnet=New-AzureVirtualNetworkSubnetConfig -Name Corpnet -AddressPrefix 10.0.0.0/24\n    New-AzurevirtualNetwork -Name TestLab -ResourceGroupName $rgName -Location $locName -AddressPrefix 10.0.0.0/8 -Subnet $corpnetSubnet –DNSServer 10.0.0.4\n\nThis is your current configuration.\n\n![](./media/virtual-machines-base-configuration-test-environment-resource-manager/BC_TLG01.png)\n\n## Phase 2: Configure DC1\n\nDC1 is a domain controller for the corp.contoso.com Active Directory Domain Services (AD DS) domain and a DNS server for the virtual machines of the TestLab virtual network.\n\nFirst, fill in the name of your resource group, Azure location, and storage account name and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for DC1.\n\n    $rgName=\"<resource group name>\"\n    $locName=\"<Azure location, such as West US>\"\n    $saName=\"<storage account name>\"\n    $vnet=Get-AzurevirtualNetwork -Name TestLab -ResourceGroupName $rgName\n    $pip = New-AzurePublicIpAddress -Name DC1-NIC -ResourceGroupName $rgName -Location $locName -AllocationMethod Dynamic\n    $nic = New-AzureNetworkInterface -Name DC1-NIC -ResourceGroupName $rgName -Location $locName -SubnetId $vnet.Subnets[0].Id -PublicIpAddressId $pip.Id -PrivateIpAddress 10.0.0.4\n    $vm=New-AzureVMConfig -VMName DC1 -VMSize Standard_A1\n    $storageAcc=Get-AzureStorageAccount -ResourceGroupName $rgName -Name $saName\n    $vhdURI=$storageAcc.PrimaryEndpoints.Blob.ToString() + \"vhds/DC1-TestLab-ADDSDisk.vhd\"\n    Add-AzureVMDataDisk -VM $vm -Name ADDS-Data -DiskSizeInGB 20 -VhdUri $vhdURI  -CreateOption empty\n    $cred=Get-Credential -Message \"Type the name and password of the local administrator account for DC1.\" \n    $vm=Set-AzureVMOperatingSystem -VM $vm -Windows -ComputerName DC1 -Credential $cred -ProvisionVMAgent -EnableAutoUpdate\n    $vm=Set-AzureVMSourceImage -VM $vm -PublisherName MicrosoftWindowsServer -Offer WindowsServer -Skus 2012-R2-Datacenter -Version \"latest\"\n    $vm=Add-AzureVMNetworkInterface -VM $vm -Id $nic.Id\n    $osDiskUri=$storageAcc.PrimaryEndpoints.Blob.ToString() + \"vhds/DC1-TestLab-OSDisk.vhd\"\n    $vm=Set-AzureVMOSDisk -VM $vm -Name DC1-TestLab-OSDisk -VhdUri $osDiskUri -CreateOption fromImage\n    New-AzureVM -ResourceGroupName $rgName -Location $locName -VM $vm\n\nNext, connect to the DC1 virtual machine.\n\n1.  In the Azure Preview portal, click **Browse All** in the left pane, click **Virtual machines** in the **Browse** list, and then click the **DC1** virtual machine.  \n2.  In the **DC1** pane,, click **Connect**.\n3.  When prompted, open the DC1.rdp downloaded file.\n4.  When prompted with a Remote Desktop Connection message box, click **Connect**.\n5.  When prompted for credentials, use the following:\n- Name: **DC1\\\\**[Local administrator account name]\n- Password: [Local administrator account password]\n6.  When prompted with a Remote Desktop Connection message box referring to certificates, click **Yes**.\n\nNext, add an extra data disk as a new volume with the drive letter F:.\n\n1.  In the left pane of Server Manager, click **File and Storage Services**, and then click **Disks**.\n2.  In the contents pane, in the **Disks** group, click **disk 2** (with the **Partition** set to **Unknown**).\n3.  Click **Tasks**, and then click **New Volume**.\n4.  On the Before you begin page of the New Volume Wizard, click **Next**.\n5.  On the Select the server and disk page, click **Disk 2**, and then click **Next**. When prompted, click **OK**.\n6.  On the Specify the size of the volume page, click **Next**.\n7.  On the Assign to a drive letter or folder page, click **Next**.\n8.  On the Select file system settings page, click **Next**.\n9.  On the Confirm selections page, click **Create**.\n10. When complete, click **Close**.\n\nNext, configure DC1 as a domain controller and DNS server for the corp.contoso.com domain. Run these commands at an administrator-level Windows PowerShell command prompt.\n\n    Install-WindowsFeature AD-Domain-Services -IncludeManagementTools\n    Install-ADDSForest -DomainName corp.contoso.com -DatabasePath \"F:\\NTDS\" -SysvolPath \"F:\\SYSVOL\" -LogPath \"F:\\Logs\"\n\nAfter DC1 restarts, reconnect to the DC1 virtual machine.\n\n1.  In the Azure Preview portal, click Browse All in the left pane, click Virtual machines in the Browse list, and then click the DC1 virtual machine.\n2.  In the DC1 pane, click Connect.\n3.  When prompted to open DC1.rdp, click **Open**.\n4.  When prompted with a Remote Desktop Connection message box, click **Connect**.\n5.  When prompted for credentials, use the following:\n- Name: **CORP\\\\**[Local administrator account name]\n- Password: [Local administrator account password]\n6.  When prompted by a Remote Desktop Connection message box referring to certificates, click **Yes**.\n\nNext, create a user account in Active Directory that will be used when logging in to CORP domain member computers. Run these commands one at a time at an administrator-level Windows PowerShell command prompt.\n\n    New-ADUser -SamAccountName User1 -AccountPassword (read-host \"Set user password\" -assecurestring) -name \"User1\" -enabled $true -PasswordNeverExpires $true -ChangePasswordAtLogon $false\n    Add-ADPrincipalGroupMembership -Identity \"CN=User1,CN=Users,DC=corp,DC=contoso,DC=com\" -MemberOf \"CN=Enterprise Admins,CN=Users,DC=corp,DC=contoso,DC=com\",\"CN=Domain Admins,CN=Users,DC=corp,DC=contoso,DC=com\"\n\nNote that the first command results in a prompt to supply the User1 account password. Because this account will be used for remote desktop connections for all CORP domain member computers, choose a strong password. To check its strength, see [Password Checker: Using Strong Passwords](https://www.microsoft.com/security/pc-security/password-checker.aspx). Record the User1 account password and store it in a secured location.\n\nClose the Remote Desktop session with DC1 and then reconnect using the CORP\\User1 account.\n\nNext, to allow traffic for the Ping tool, run this command at an administrator-level Windows PowerShell command prompt.\n\n    Set-NetFirewallRule -DisplayName \"File and Printer Sharing (Echo Request - ICMPv4-In)\" -enabled True\n\nThis is your current configuration.\n\n![](./media/virtual-machines-base-configuration-test-environment-resource-manager/BC_TLG02.png)\n\n## Phase 3: Configure APP1\n\nAPP1 provides web and file sharing services.\n\nFirst, fill in the name of your resource group, Azure location, and storage account name and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for APP1.\n\n    $rgName=\"<resource group name>\"\n    $locName=\"<Azure location, such as West US>\"\n    $saName=\"<storage account name>\"\n    $vnet=Get-AzurevirtualNetwork -Name TestLab -ResourceGroupName $rgName\n    $pip = New-AzurePublicIpAddress -Name APP1-NIC -ResourceGroupName $rgName -Location $locName -AllocationMethod Dynamic\n    $nic = New-AzureNetworkInterface -Name APP1-NIC -ResourceGroupName $rgName -Location $locName -SubnetId $vnet.Subnets[0].Id -PublicIpAddressId $pip.Id\n    $vm=New-AzureVMConfig -VMName APP1 -VMSize Standard_A1\n    $storageAcc=Get-AzureStorageAccount -ResourceGroupName $rgName -Name $saName\n    $cred=Get-Credential -Message \"Type the name and password of the local administrator account for APP1.\" \n    $vm=Set-AzureVMOperatingSystem -VM $vm -Windows -ComputerName APP1 -Credential $cred -ProvisionVMAgent -EnableAutoUpdate\n    $vm=Set-AzureVMSourceImage -VM $vm -PublisherName MicrosoftWindowsServer -Offer WindowsServer -Skus 2012-R2-Datacenter -Version \"latest\"\n    $vm=Add-AzureVMNetworkInterface -VM $vm -Id $nic.Id\n    $osDiskUri=$storageAcc.PrimaryEndpoints.Blob.ToString() + \"vhds/APP1-TestLab-OSDisk.vhd\"\n    $vm=Set-AzureVMOSDisk -VM $vm -Name APP1-TestLab-OSDisk -VhdUri $osDiskUri -CreateOption fromImage\n    New-AzureVM -ResourceGroupName $rgName -Location $locName -VM $vm\n\nNext, connect to the APP1 virtual machine using the APP1 local administrator account name and password, and then open an administrator-level Windows PowerShell command prompt.\n\nTo check name resolution and network communication between APP1 and DC1, run the **ping dc1.corp.contoso.com** command and verify that there are four replies.\n\nNext, join the APP1 virtual machine to the CORP domain with these commands at the Windows PowerShell prompt.\n\n    Add-Computer -DomainName corp.contoso.com\n    Restart-Computer\n\nNote that you must supply your CORP\\User1 domain account credentials after entering the Add-Computer command.\n\nAfter APP1 restarts, connect to it using the CORP\\User1 account name and password, and then open an administrator-level Windows PowerShell command prompt.\n\nNext, make APP1 a web server with this command at the Windows PowerShell command prompt.\n\n    Install-WindowsFeature Web-WebServer –IncludeManagementTools\n\nNext, create a shared folder and a text file within the folder on APP1 with these commands.\n\n    New-Item -path c:\\files -type directory\n    Write-Output \"This is a shared file.\" | out-file c:\\files\\example.txt\n    New-SmbShare -name files -path c:\\files -changeaccess CORP\\User1\n\nThis is your current configuration.\n\n![](./media/virtual-machines-base-configuration-test-environment-resource-manager/BC_TLG03.png)\n\n## Phase 4: Configure CLIENT1\n\nCLIENT1 acts as a typical laptop, tablet, or desktop computer on the Contoso intranet.\n\nFirst, fill in the name of your resource group, Azure location, and storage account name and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for CLIENT1.\n\n    $rgName=\"<resource group name>\"\n    $locName=\"<Azure location, such as West US>\"\n    $saName=\"<storage account name>\"\n    $vnet=Get-AzurevirtualNetwork -Name TestLab -ResourceGroupName $rgName\n    $pip = New-AzurePublicIpAddress -Name CLIENT1-NIC -ResourceGroupName $rgName -Location $locName -AllocationMethod Dynamic\n    $nic = New-AzureNetworkInterface -Name CLIENT1-NIC -ResourceGroupName $rgName -Location $locName -SubnetId $vnet.Subnets[0].Id -PublicIpAddressId $pip.Id\n    $vm=New-AzureVMConfig -VMName CLIENT1 -VMSize Standard_A1\n    $storageAcc=Get-AzureStorageAccount -ResourceGroupName $rgName -Name $saName\n    $cred=Get-Credential -Message \"Type the name and password of the local administrator account for CLIENT1.\" \n    $vm=Set-AzureVMOperatingSystem -VM $vm -Windows -ComputerName CLIENT1 -Credential $cred -ProvisionVMAgent -EnableAutoUpdate\n    $vm=Set-AzureVMSourceImage -VM $vm -PublisherName MicrosoftWindowsServer -Offer WindowsServer -Skus 2012-R2-Datacenter -Version \"latest\"\n    $vm=Add-AzureVMNetworkInterface -VM $vm -Id $nic.Id \n    $osDiskUri=$storageAcc.PrimaryEndpoints.Blob.ToString() + \"vhds/CLIENT1-TestLab-OSDisk.vhd\"\n    $vm=Set-AzureVMOSDisk -VM $vm -Name CLIENT1-TestLab-OSDisk -VhdUri $osDiskUri -CreateOption fromImage\n    New-AzureVM -ResourceGroupName $rgName -Location $locName -VM $vm\n\nNext, connect to the CLIENT1 virtual machine using the CLIENT1 local administrator account name and password, and then open an administrator-level Windows PowerShell command prompt.\n\nTo check name resolution and network communication between CLIENT1 and DC1, run the **ping dc1.corp.contoso.com** command at a Windows PowerShell command prompt and verify that there are four replies.\n\nNext, join the CLIENT1 virtual machine to the CORP domain with these commands at the Windows PowerShell prompt.\n\n    Add-Computer -DomainName corp.contoso.com\n    Restart-Computer\n\nNote that you must supply your CORP\\User1 domain account credentials after entering the Add-Computer command.\n\nAfter CLIENT1 restarts, connect to it using the CORP\\User1 account name and password, and then open an administrator-level Windows PowerShell command prompt.\n\nNext, verify that you can access web and file share resources on APP1 from CLIENT1.\n\n1.  In Server Manager, in the tree pane, click **Local Server**.\n2.  In **Properties for CLIENT1**, click **On** next to **IE Enhanced Security Configuration**.\n3.  In **Internet Explorer Enhanced Security Configuration**, click **Off** for **Administrators** and **Users**, and then click **OK**.\n4.  From the Start screen, click **Internet Explorer**, and then click **OK**.\n5.  In the Address bar, type **http://app1.corp.contoso.com/**, and then press ENTER.  You should see the default Internet Information Services web page for APP1.\n6.  From the desktop taskbar, click the File Explorer icon.\n7.  In the address bar, type **\\\\\\app1\\Files**, and then press ENTER.\n8.  You should see a folder window with the contents of the Files shared folder.\n9.  In the **Files** shared folder window, double-click the **Example.txt** file. You should see the contents of the Example.txt file.\n10. Close the **example.txt - Notepad** and the **Files** shared folder windows.\n\nThis is your final configuration.\n\n![](./media/virtual-machines-base-configuration-test-environment-resource-manager/BC_TLG04.png)\n\nYour base configuration in Azure is now ready for application development and testing or for additional test environments.\n\n## Additional resources\n\n[Hybrid cloud test environments](../virtual-network/virtual-networks-setup-hybrid-cloud-environment-testing.md)\n\n[Base Configuration test environment](virtual-machines-base-configuration-test-environment.md)\n\n\n## <a id=\"costs\"></a>Minimizing the costs of test environment virtual machines in Azure\n\nTo minimize the cost of running the test environment virtual machines, you can do one of the following:\n\n- Create the test environment and perform your needed testing and demonstration as quickly as possible. When complete, delete the test environment virtual machines.\n- Shut down your test environment virtual machines into a deallocated state.\n\nTo shut down the virtual machines with Azure PowerShell, fill in the resource group name and run these commands.\n\n    $rgName=\"<your resource group name>\"\n    Stop-AzureVM -ResourceGroupName $rgName -Name \"CLIENT1\"\n    Stop-AzureVM -ResourceGroupName $rgName -Name \"APP1\"\n    Stop-AzureVM -ResourceGroupName $rgName -Name \"DC1\" -Force -StayProvisioned\n\nTo ensure that your virtual machines work properly when starting all of them from the Stopped (Deallocated) state, you should start them in the following order:\n\n1.  DC1\n2.  APP1\n3.  CLIENT1\n\nTo start the virtual machines in order with Azure PowerShell, fill in the resource group name and run these commands.\n\n    $rgName=\"<your resource group name>\"\n    Start-AzureVM -ResourceGroupName $rgName -Name \"DC1\"\n    Start-AzureVM -ResourceGroupName $rgName -Name \"APP1\"\n    Start-AzureVM -ResourceGroupName $rgName -Name \"CLIENT1\"\n"
}