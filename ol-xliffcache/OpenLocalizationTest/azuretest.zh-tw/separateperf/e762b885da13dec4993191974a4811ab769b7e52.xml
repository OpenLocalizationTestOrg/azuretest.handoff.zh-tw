{
  "nodes": [
    {
      "content": "Connecting Azure Cloud Services Roles to a custom AD Domain Controller hosted in Azure",
      "pos": [
        25,
        111
      ]
    },
    {
      "content": "Learn how to connect your web/worker roles to a custom AD Domain using Powershell and AD Domain Extension",
      "pos": [
        128,
        233
      ]
    },
    {
      "content": "Connecting Azure Cloud Services Roles to a custom AD Domain Controller hosted in Azure",
      "pos": [
        521,
        607
      ]
    },
    {
      "content": "Stepwise guide to connect your Azure Web/Worker roles to a custom domain controller hosted on Azure",
      "pos": [
        612,
        711
      ]
    },
    {
      "content": "We will first set up a Virtual Network (VNET) in Azure.",
      "pos": [
        713,
        768
      ]
    },
    {
      "content": "We will then add an Active Directory Domain Controller (hosted on an Azure Virtual Machine) to the VNET.",
      "pos": [
        769,
        873
      ]
    },
    {
      "content": "Next, we will add existing cloud service roles to the pre-created VNET and subsequently connect them to the Domain Controller.",
      "pos": [
        874,
        1000
      ]
    },
    {
      "content": "Before we get started, couple of things to keep in mind:",
      "pos": [
        1002,
        1058
      ]
    },
    {
      "content": "This tutorial uses Powershell, so please make sure you have Azure Powershell installed and ready to go.",
      "pos": [
        1063,
        1166
      ]
    },
    {
      "content": "To get help with setting up Azure Powershell, see <bpt id=\"p1\">[</bpt>How to install and configure Azure PowerShell<ept id=\"p1\">](../install-configure-powershell.md)</ept>.",
      "pos": [
        1167,
        1301
      ]
    },
    {
      "content": "Your AD Domain Controller and Web/Worker Role instances need to be in the VNET.",
      "pos": [
        1306,
        1385
      ]
    },
    {
      "content": "Follow this step-by-step guide and if you run into any issues, leave us a comment below.",
      "pos": [
        1387,
        1475
      ]
    },
    {
      "content": "Someone will get back to you (yes, we do read comments).",
      "pos": [
        1476,
        1532
      ]
    },
    {
      "content": "Create a Virtual Network",
      "pos": [
        1537,
        1561
      ]
    },
    {
      "content": "You can create a Virtual Network in Azure using the Azure Portal or Powershell.",
      "pos": [
        1563,
        1642
      ]
    },
    {
      "content": "For this tutorial, we will use Powershell.",
      "pos": [
        1643,
        1685
      ]
    },
    {
      "content": "To create a Virtual Network using the Azure Portal, see <bpt id=\"p1\">[</bpt>Create Virtual Network<ept id=\"p1\">](../create-virtual-network.md)</ept>.",
      "pos": [
        1686,
        1797
      ]
    },
    {
      "content": "Create a Virtual Machine",
      "pos": [
        2789,
        2813
      ]
    },
    {
      "content": "Once you have completed setting up the Virtual Network, you will need to create an AD Domain Controller.",
      "pos": [
        2815,
        2919
      ]
    },
    {
      "content": "For this tutorial, we will be setting up an AD Domain Controller on an Azure Virtual Machine.",
      "pos": [
        2920,
        3013
      ]
    },
    {
      "content": "To do this, create a virtual machine through Powershell using the commands below.",
      "pos": [
        3015,
        3096
      ]
    },
    {
      "content": "Promote your Virtual Machine to a Domain Controller",
      "pos": [
        3618,
        3669
      ]
    },
    {
      "content": "To configure the Virtual Machine as an AD Domain Controller, you will need to log in to the VM and configure it.",
      "pos": [
        3670,
        3782
      ]
    },
    {
      "content": "To log in to the VM, you can get the RDP file through Powershell, use the commands below.",
      "pos": [
        3784,
        3873
      ]
    },
    {
      "pos": [
        3985,
        4301
      ],
      "content": "Once you are logged into the VM, setup your Virtual Machine as an AD Domain Controller by following the step-by-step guide on <bpt id=\"p1\">[</bpt>How to setup your customer AD Domain Controller<ept id=\"p1\">](http://social.technet.microsoft.com/wiki/contents/articles/12370.windows-server-2012-set-up-your-first-domain-controller-step-by-step.aspx)</ept>."
    },
    {
      "content": "Add your Cloud Service deployment to the Virtual Network",
      "pos": [
        4306,
        4362
      ]
    },
    {
      "content": "Next, you need to add your cloud service deployment to the VNET you just created.",
      "pos": [
        4364,
        4445
      ]
    },
    {
      "content": "To do this, modify your cloud service cscfg by adding the relevant sections to your cscfg using Visual Studio or the editor of your choice.",
      "pos": [
        4446,
        4585
      ]
    },
    {
      "content": "Next build your cloud services project and deploy it to Azure.",
      "pos": [
        5484,
        5546
      ]
    },
    {
      "content": "To get help with deploying your cloud services package to Azure, see <bpt id=\"p1\">[</bpt>How to Create and Deploy a Cloud Service<ept id=\"p1\">](cloud-services-how-to-create-deploy.md#deploy)</ept>",
      "pos": [
        5547,
        5705
      ]
    },
    {
      "content": "Connect your web/worker role(s) to the custom domain using the AD Domain Extension",
      "pos": [
        5710,
        5792
      ]
    },
    {
      "content": "Once your cloud service project is deployed on Azure, connect your role instances to the custom AD domain using the AD Domain Extension.",
      "pos": [
        5794,
        5930
      ]
    },
    {
      "content": "To add the AD Domain Extension to your existing cloud services deployment and join the custom domain, execute the following commands in Powershell:",
      "pos": [
        5931,
        6078
      ]
    },
    {
      "content": "And that’s it.",
      "pos": [
        6640,
        6654
      ]
    },
    {
      "content": "You cloud services should now be joined to your custom domain controller.",
      "pos": [
        6656,
        6729
      ]
    },
    {
      "content": "If you would like to learn more about the different options available for how to configure AD Domain Extension, use the PS help as shown below.",
      "pos": [
        6730,
        6873
      ]
    },
    {
      "content": "We would also like your feedback on if it would be useful for you to have an extension that promotes a Virtual Machine to a Domain Controller.",
      "pos": [
        6970,
        7112
      ]
    },
    {
      "content": "So if you think it would be, please let us know in the comments section.",
      "pos": [
        7113,
        7185
      ]
    },
    {
      "content": "Hope you found this helpful!",
      "pos": [
        7187,
        7215
      ]
    },
    {
      "content": "test",
      "pos": [
        7218,
        7222
      ]
    }
  ],
  "content": "<properties\n  pageTitle=\"Connecting Azure Cloud Services Roles to a custom AD Domain Controller hosted in Azure\"\n  description=\"Learn how to connect your web/worker roles to a custom AD Domain using Powershell and AD Domain Extension\"\n  services=\"cloud-services\"\n  documentationCenter=\"\"\n  authors=\"VMak\"\n  manager=\"MadhanA\"\n  editor=\"\"/>\n\n  <tags\n    ms.service=\"cloud-services\"\n    ms.workload=\"tbd\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"03/05/2015\"\n    ms.author=\"vmaker\"/>\n\n# Connecting Azure Cloud Services Roles to a custom AD Domain Controller hosted in Azure\n\n## Stepwise guide to connect your Azure Web/Worker roles to a custom domain controller hosted on Azure\n\nWe will first set up a Virtual Network (VNET) in Azure. We will then add an Active Directory Domain Controller (hosted on an Azure Virtual Machine) to the VNET. Next, we will add existing cloud service roles to the pre-created VNET and subsequently connect them to the Domain Controller.\n\nBefore we get started, couple of things to keep in mind:\n1.  This tutorial uses Powershell, so please make sure you have Azure Powershell installed and ready to go. To get help with setting up Azure Powershell, see [How to install and configure Azure PowerShell](../install-configure-powershell.md).\n2.  Your AD Domain Controller and Web/Worker Role instances need to be in the VNET.\n\nFollow this step-by-step guide and if you run into any issues, leave us a comment below. Someone will get back to you (yes, we do read comments).\n\n## Create a Virtual Network\n\nYou can create a Virtual Network in Azure using the Azure Portal or Powershell. For this tutorial, we will use Powershell. To create a Virtual Network using the Azure Portal, see [Create Virtual Network](../create-virtual-network.md).\n\n    #Create Virtual Network\n\n    $vnetStr =\n    @\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <NetworkConfiguration xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2011/07/NetworkConfiguration\">\n      <VirtualNetworkConfiguration>\n        <VirtualNetworkSites>\n          <VirtualNetworkSite name=\"[your-vnet-name]\" Location=\"West US\">\n            <AddressSpace>\n              <AddressPrefix>[your-address-prefix]</AddressPrefix>\n            </AddressSpace>\n            <Subnets>\n              <Subnet name=\"[your-subnet-name]\">\n                <AddressPrefix>[your-subnet-range]</AddressPrefix>\n              </Subnet>\n            </Subnets>\n          </VirtualNetworkSite>\n        </VirtualNetworkSites>\n      </VirtualNetworkConfiguration>\n    </NetworkConfiguration>\n    \"@;\n\n    $vnetConfigPath = \"<path-to-vnet-config>\"\n    Set-AzureVNetConfig -ConfigurationPath $vnetConfigPath;\n\n## Create a Virtual Machine\n\nOnce you have completed setting up the Virtual Network, you will need to create an AD Domain Controller. For this tutorial, we will be setting up an AD Domain Controller on an Azure Virtual Machine.\n\nTo do this, create a virtual machine through Powershell using the commands below.\n\n    #Initialize variables\n\n    $vnetname = '<your-vnet-name>'\n    $subnetname = '<your-subnet-name>'\n    $vmsvc1 = ‘<your-hosted-service>’\n    $vm1 = ‘<your-vm-name>’\n    $username = ‘<your-username>’\n    $password = ‘<your-password>’\n    $ affgrp = ‘<your- affgrp>’\n\n    #Create a VM and add it to the Virtual Network\n\n    New-AzureQuickVM -Windows -ServiceName $vmsvc1 -name $vm1 -ImageName $imgname -AdminUsername $username -Password $password -AffinityGroup $affgrp -SubnetNames $subnetname -VNetName $vnetname\n\n\n## Promote your Virtual Machine to a Domain Controller\nTo configure the Virtual Machine as an AD Domain Controller, you will need to log in to the VM and configure it.\n\nTo log in to the VM, you can get the RDP file through Powershell, use the commands below.\n\n    #Get RDP file\n\n    Get-AzureRemoteDesktopFile -ServiceName $vmsvc1 -Name $vm1 -LocalPath <rdp-file-path>\n\nOnce you are logged into the VM, setup your Virtual Machine as an AD Domain Controller by following the step-by-step guide on [How to setup your customer AD Domain Controller](http://social.technet.microsoft.com/wiki/contents/articles/12370.windows-server-2012-set-up-your-first-domain-controller-step-by-step.aspx).\n\n## Add your Cloud Service deployment to the Virtual Network\n\nNext, you need to add your cloud service deployment to the VNET you just created. To do this, modify your cloud service cscfg by adding the relevant sections to your cscfg using Visual Studio or the editor of your choice.\n\n    <ServiceConfiguration serviceName=\"[hosted-service-name]\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2008/10/ServiceConfiguration\" osFamily=\"[os-family]\" osVersion=\"*\">\n        <Role name=\"[role-name]\">\n        <Instances count=\"[number-of-instances]\" />\n      </Role>\n      <NetworkConfiguration>\n\n        <!--optional-->\n        <Dns>\n          <DnsServers><DnsServer name=\"[dns-server-name]\" IPAddress=\"[ip-address]\" /></DnsServers>\n        </Dns>\n        <!--optional-->\n\n        <!--VNET settings-->\n        <VirtualNetworkSite name=\"[virtual-network-name]\" />\n        <AddressAssignments>\n          <InstanceAddress roleName=\"[role-name]\">\n            <Subnets>\n              <Subnet name=\"[subnet-name]\" />\n            </Subnets>\n          </InstanceAddress>\n        </AddressAssignments>\n        <!--VNET settings-->\n\n      </NetworkConfiguration>\n    </ServiceConfiguration>\n\nNext build your cloud services project and deploy it to Azure. To get help with deploying your cloud services package to Azure, see [How to Create and Deploy a Cloud Service](cloud-services-how-to-create-deploy.md#deploy)\n\n## Connect your web/worker role(s) to the custom domain using the AD Domain Extension\n\nOnce your cloud service project is deployed on Azure, connect your role instances to the custom AD domain using the AD Domain Extension. To add the AD Domain Extension to your existing cloud services deployment and join the custom domain, execute the following commands in Powershell:\n\n    #Initialize domain variables\n\n    $domain = ‘<your-domain-name>’;\n    $dmuser = ‘$domain\\<your-username>’;\n    $dmpswd = '<your-domain-password>';\n    $dmspwd = ConvertTo-SecureString $dmpswd -AsPlainText -Force;\n    $dmcred = New-Object System.Management.Automation.PSCredential ($dmuser, $dmspwd);\n\n    #Add AD Domain Extension to the cloud service roles\n\n    Set-AzureServiceADDomainExtension -Service <your-cloud-service-hosted-service-name> -Role <your-role-name> -Slot <staging-or-production> -DomainName $domain -Credential $dmcred -JoinOption 35;\n\nAnd that’s it.\n\nYou cloud services should now be joined to your custom domain controller. If you would like to learn more about the different options available for how to configure AD Domain Extension, use the PS help as shown below.\n\n    help Set-AzureServiceADDomainExtension;\n    help New-AzureServiceADDomainExtensionConfig;\n\nWe would also like your feedback on if it would be useful for you to have an extension that promotes a Virtual Machine to a Domain Controller. So if you think it would be, please let us know in the comments section.\n\nHope you found this helpful!\n \ntest\n"
}