{
  "nodes": [
    {
      "content": "Build an HBase application using Maven | Microsoft Azure",
      "pos": [
        27,
        83
      ]
    },
    {
      "content": "Learn how to use Apache Maven to build a Java-based Apache HBase application, then deploy it to Azure HDInsight.",
      "pos": [
        102,
        214
      ]
    },
    {
      "content": "Use Maven to build Java applications that use HBase with HDInsight (Hadoop)",
      "pos": [
        543,
        618
      ]
    },
    {
      "content": "Learn how to create and build an <bpt id=\"p1\">[</bpt>Apache HBase<ept id=\"p1\">](http://hbase.apache.org/)</ept> application in Java by using Apache Maven.",
      "pos": [
        620,
        736
      ]
    },
    {
      "content": "Then use the application with Azure HDInsight (Hadoop).",
      "pos": [
        737,
        792
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Maven<ept id=\"p1\">](http://maven.apache.org/)</ept> is a software project management and comprehension tool that allows you to build software, documentation, and reports for Java projects.",
      "pos": [
        794,
        964
      ]
    },
    {
      "content": "In this article, you will learn how to use it to create a basic Java application that that creates, queries, and deletes an HBase table on an Azure HDInsight cluster.",
      "pos": [
        965,
        1131
      ]
    },
    {
      "content": "Requirements",
      "pos": [
        1135,
        1147
      ]
    },
    {
      "pos": [
        1151,
        1249
      ],
      "content": "<bpt id=\"p1\">[</bpt>Java platform JDK<ept id=\"p1\">](http://www.oracle.com/technetwork/java/javase/downloads/index.html)</ept> 7 or later"
    },
    {
      "content": "Maven",
      "pos": [
        1254,
        1259
      ]
    },
    {
      "content": "An Azure HDInsight cluster with HBase",
      "pos": [
        1291,
        1328
      ]
    },
    {
      "content": "Create the project",
      "pos": [
        1386,
        1404
      ]
    },
    {
      "pos": [
        1409,
        1570
      ],
      "content": "From the command-line in your development environment, change directories to the location where you want to create the project, for example, <ph id=\"ph1\">`cd code\\hdinsight`</ph>."
    },
    {
      "pos": [
        1575,
        1675
      ],
      "content": "Use the <bpt id=\"p1\">__</bpt>mvn<ept id=\"p1\">__</ept> command, which is installed with Maven, to generate the scaffolding for the project."
    },
    {
      "pos": [
        1841,
        2032
      ],
      "content": "This creates a new directory in the current directory, with the name specified by the <bpt id=\"p1\">__</bpt>artifactID<ept id=\"p1\">__</ept> parameter (<bpt id=\"p2\">**</bpt>hbaseapp<ept id=\"p2\">**</ept> in this example.) This directory will contain the following items:"
    },
    {
      "pos": [
        2040,
        2234
      ],
      "content": "<bpt id=\"p1\">__</bpt>pom.xml<ept id=\"p1\">__</ept>:  The Project Object Model (<bpt id=\"p2\">[</bpt>POM<ept id=\"p2\">](http://maven.apache.org/guides/introduction/introduction-to-the-pom.html)</ept>) contains information and configuration details used to build the project."
    },
    {
      "pos": [
        2242,
        2369
      ],
      "content": "<bpt id=\"p1\">__</bpt>src<ept id=\"p1\">__</ept>: The directory that contains the <bpt id=\"p2\">__</bpt>main\\java\\com\\microsoft\\examples<ept id=\"p2\">__</ept> directory, where you will author the application."
    },
    {
      "pos": [
        2374,
        2488
      ],
      "content": "Delete the <bpt id=\"p1\">__</bpt>src\\test\\java\\com\\microsoft\\examples\\apptest.java<ept id=\"p1\">__</ept> file because it will not be used in this example."
    },
    {
      "content": "Update the Project Object Model",
      "pos": [
        2492,
        2523
      ]
    },
    {
      "pos": [
        2528,
        2617
      ],
      "content": "Edit the <bpt id=\"p1\">__</bpt>pom.xml<ept id=\"p1\">__</ept> file and add the following code inside the <ph id=\"ph1\">`&lt;dependencies&gt;`</ph> section:"
    },
    {
      "content": "This tells Maven that the project requires <bpt id=\"p1\">__</bpt>hbase-client<ept id=\"p1\">__</ept> version <bpt id=\"p2\">__</bpt>0.98.4-hadoop2<ept id=\"p2\">__</ept>.",
      "pos": [
        2805,
        2892
      ]
    },
    {
      "content": "At compile time, this will be downloaded from the default Maven repository.",
      "pos": [
        2893,
        2968
      ]
    },
    {
      "content": "You can use the <bpt id=\"p1\">[</bpt>Maven Central Repository Search<ept id=\"p1\">](http://search.maven.org/#artifactdetails%7Corg.apache.hbase%7Chbase-client%7C0.98.4-hadoop2%7Cjar)</ept> to learn more about this dependency.",
      "pos": [
        2969,
        3154
      ]
    },
    {
      "content": "Add the following code to the <bpt id=\"p1\">__</bpt>pom.xml<ept id=\"p1\">__</ept> file.",
      "pos": [
        3159,
        3206
      ]
    },
    {
      "content": "This must be inside the <ph id=\"ph1\">`&lt;project&gt;...&lt;/project&gt;`</ph> tags in the file, for example, between <ph id=\"ph2\">`&lt;/dependencies&gt;`</ph> and <ph id=\"ph3\">`&lt;/project&gt;`</ph>.",
      "pos": [
        3207,
        3330
      ]
    },
    {
      "pos": [
        4813,
        4917
      ],
      "content": "This configures a resource (<bpt id=\"p1\">__</bpt>conf\\hbase-site.xml<ept id=\"p1\">__</ept>,) that contains configuration information for HBase."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You can also set configuration values via code.",
      "pos": [
        4925,
        4985
      ]
    },
    {
      "content": "See the comments in the <bpt id=\"p1\">__</bpt>CreateTable<ept id=\"p1\">__</ept> example that follows for how to do this.",
      "pos": [
        4986,
        5066
      ]
    },
    {
      "content": "This also configures the <bpt id=\"p1\">[</bpt>Maven Compiler Plugin<ept id=\"p1\">](http://maven.apache.org/plugins/maven-compiler-plugin/)</ept> and <bpt id=\"p2\">[</bpt>Maven Shade Plugin<ept id=\"p2\">](http://maven.apache.org/plugins/maven-shade-plugin/)</ept>.",
      "pos": [
        5072,
        5255
      ]
    },
    {
      "content": "The compiler plug-in is used to compile the topology.",
      "pos": [
        5256,
        5309
      ]
    },
    {
      "content": "The shade plug-in is used to prevent license duplication in the JAR package that is built by Maven.",
      "pos": [
        5310,
        5409
      ]
    },
    {
      "content": "The reason this is used is that the duplicate license files cause an error at run time on the HDInsight cluster.",
      "pos": [
        5410,
        5522
      ]
    },
    {
      "content": "Using maven-shade-plugin with the <ph id=\"ph1\">`ApacheLicenseResourceTransformer`</ph> implementation prevents this error.",
      "pos": [
        5523,
        5627
      ]
    },
    {
      "content": "The maven-shade-plugin also produces an uber jar (or fat jar,) that contains all the dependencies required by the application.",
      "pos": [
        5633,
        5759
      ]
    },
    {
      "pos": [
        5764,
        5790
      ],
      "content": "Save the <bpt id=\"p1\">__</bpt>pom.xml<ept id=\"p1\">__</ept> file."
    },
    {
      "content": "Create a new directory named <bpt id=\"p1\">__</bpt>conf<ept id=\"p1\">__</ept> in the <bpt id=\"p2\">__</bpt>hbaseapp<ept id=\"p2\">__</ept> directory.",
      "pos": [
        5795,
        5863
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">__</bpt>conf<ept id=\"p1\">__</ept> directory, create a new file named <bpt id=\"p2\">__</bpt>hbase-site.xml<ept id=\"p2\">__</ept> and use the following as the contents:",
      "pos": [
        5864,
        5972
      ]
    },
    {
      "content": "This file will be used to load the HBase configuration for an HDInsight cluster.",
      "pos": [
        7575,
        7655
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> This is a very minimal hbase-site.xml file, and it contains the bare minimum settings for the HDInsight cluster.",
      "pos": [
        7663,
        7788
      ]
    },
    {
      "content": "For a full version of the hbase-site.xml configuration file used by HDInsight, see <bpt id=\"p1\">[</bpt>Manage Hadoop clusters in HDInsight by using the Azure portal<ept id=\"p1\">](hdinsight-administer-use-management-portal.md#rdp)</ept>.",
      "pos": [
        7789,
        7987
      ]
    },
    {
      "content": "The hbase-site.xml file is located in the C:\\apps\\dist\\hbase-&amp;lt;version number&gt;-hadoop2\\conf directory.",
      "pos": [
        7988,
        8092
      ]
    },
    {
      "content": "The version number portion of the file path will change as HBase is updated on the cluster.",
      "pos": [
        8093,
        8184
      ]
    },
    {
      "pos": [
        8189,
        8222
      ],
      "content": "Save the <bpt id=\"p1\">__</bpt>hbase-site.xml<ept id=\"p1\">__</ept> file."
    },
    {
      "content": "Create the application",
      "pos": [
        8226,
        8248
      ]
    },
    {
      "pos": [
        8253,
        8376
      ],
      "content": "Go to the <bpt id=\"p1\">__</bpt>hbaseapp\\src\\main\\java\\com\\microsoft\\examples<ept id=\"p1\">__</ept> directory and rename the app.java file to <bpt id=\"p2\">__</bpt>CreateTable.java<ept id=\"p2\">__</ept>."
    },
    {
      "pos": [
        8381,
        8469
      ],
      "content": "Open the <bpt id=\"p1\">__</bpt>CreateTable.java<ept id=\"p1\">__</ept> file and replace the existing contents with the following:"
    },
    {
      "pos": [
        11417,
        11538
      ],
      "content": "This is the <bpt id=\"p1\">__</bpt>CreateTable<ept id=\"p1\">__</ept> class, which will create a table named <bpt id=\"p2\">__</bpt>people<ept id=\"p2\">__</ept> and populate it with some predefined users."
    },
    {
      "pos": [
        11543,
        11578
      ],
      "content": "Save the <bpt id=\"p1\">__</bpt>CreateTable.java<ept id=\"p1\">__</ept> file."
    },
    {
      "content": "In the <bpt id=\"p1\">__</bpt>hbaseapp\\src\\main\\java\\com\\microsoft\\examples<ept id=\"p1\">__</ept> directory, create a new file named <bpt id=\"p2\">__</bpt>SearchByEmail.java<ept id=\"p2\">__</ept>.",
      "pos": [
        11583,
        11698
      ]
    },
    {
      "content": "Use the following as the contents of this file:",
      "pos": [
        11699,
        11746
      ]
    },
    {
      "content": "The <bpt id=\"p1\">__</bpt>SearchByEmail<ept id=\"p1\">__</ept> class can be used to query for rows by email address.",
      "pos": [
        14990,
        15065
      ]
    },
    {
      "content": "Because it uses a regular expression filter, you can provide either a string or a regular expression when using the class.",
      "pos": [
        15066,
        15188
      ]
    },
    {
      "pos": [
        15193,
        15230
      ],
      "content": "Save the <bpt id=\"p1\">__</bpt>SearchByEmail.java<ept id=\"p1\">__</ept> file."
    },
    {
      "content": "In the <bpt id=\"p1\">__</bpt>hbaseapp\\src\\main\\hava\\com\\microsoft\\examples<ept id=\"p1\">__</ept> directory, create a new file named <bpt id=\"p2\">__</bpt>DeleteTable.java<ept id=\"p2\">__</ept>.",
      "pos": [
        15235,
        15348
      ]
    },
    {
      "content": "Use the following as the contents of this file:",
      "pos": [
        15349,
        15396
      ]
    },
    {
      "pos": [
        16087,
        16203
      ],
      "content": "This class is for cleaning up this example by disabling and dropping the table created by the <bpt id=\"p1\">__</bpt>CreateTable<ept id=\"p1\">__</ept> class."
    },
    {
      "pos": [
        16208,
        16243
      ],
      "content": "Save the <bpt id=\"p1\">__</bpt>DeleteTable.java<ept id=\"p1\">__</ept> file."
    },
    {
      "content": "Build and package the application",
      "pos": [
        16247,
        16280
      ]
    },
    {
      "pos": [
        16285,
        16360
      ],
      "content": "Open a command prompt and change directories to the <bpt id=\"p1\">__</bpt>hbaseapp<ept id=\"p1\">__</ept> directory."
    },
    {
      "content": "Use the following command to build a JAR file that contains the application:",
      "pos": [
        16365,
        16441
      ]
    },
    {
      "content": "This cleans any previous build artifacts, downloads any dependencies that have not already been installed, then builds and packages the application.",
      "pos": [
        16474,
        16622
      ]
    },
    {
      "pos": [
        16627,
        16745
      ],
      "content": "When the command completes, the <bpt id=\"p1\">__</bpt>hbaseapp\\target<ept id=\"p1\">__</ept> directory will contain a file named <bpt id=\"p2\">__</bpt>hbaseapp-1.0-SNAPSHOT.jar<ept id=\"p2\">__</ept>."
    },
    {
      "pos": [
        16753,
        16918
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The <bpt id=\"p1\">__</bpt>hbaseapp-1.0-SNAPSHOT.jar<ept id=\"p1\">__</ept> file is an uber jar (sometimes called a fat jar,) which contains all the dependencies required to run the application."
    },
    {
      "content": "Upload the JAR file and start a job",
      "pos": [
        16922,
        16957
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> There are many ways to upload a file to your HDInsight cluster, as described in <bpt id=\"p1\">[</bpt>Upload data for Hadoop jobs in HDInsight<ept id=\"p1\">](hdinsight-upload-data.md)</ept>.",
      "pos": [
        16961,
        17123
      ]
    },
    {
      "content": "The following steps use <bpt id=\"p1\">[</bpt>Azure PowerShell<ept id=\"p1\">](../install-configure-powershell.md)</ept>.",
      "pos": [
        17124,
        17203
      ]
    },
    {
      "content": "After installing and configuring Azure PowerShell, create a new file named <bpt id=\"p1\">__</bpt>hbase-runner.psm1<ept id=\"p1\">__</ept>.",
      "pos": [
        17208,
        17305
      ]
    },
    {
      "content": "Use the following as the contents of this file:",
      "pos": [
        17306,
        17353
      ]
    },
    {
      "content": "This file contains two modules:",
      "pos": [
        24391,
        24422
      ]
    },
    {
      "pos": [
        24430,
        24487
      ],
      "content": "<bpt id=\"p1\">__</bpt>Add-HDInsightFile<ept id=\"p1\">__</ept> - used to upload files to HDInsight"
    },
    {
      "pos": [
        24495,
        24559
      ],
      "content": "<bpt id=\"p1\">__</bpt>Start-HBaseExample<ept id=\"p1\">__</ept> - used to run the classes created earlier"
    },
    {
      "pos": [
        24564,
        24600
      ],
      "content": "Save the <bpt id=\"p1\">__</bpt>hbase-runner.psm1<ept id=\"p1\">__</ept> file."
    },
    {
      "pos": [
        24605,
        24726
      ],
      "content": "Open a new Azure PowerShell window, change directories to the <bpt id=\"p1\">__</bpt>hbaseapp<ept id=\"p1\">__</ept> directory, and then run the following command."
    },
    {
      "content": "Change the path to the location of the <bpt id=\"p1\">__</bpt>hbase-runner.psm1<ept id=\"p1\">__</ept> file created earlier.",
      "pos": [
        24791,
        24873
      ]
    },
    {
      "content": "This registers the module for this Azure PowerShell session.",
      "pos": [
        24874,
        24934
      ]
    },
    {
      "pos": [
        24939,
        25035
      ],
      "content": "Use the following command to upload the <bpt id=\"p1\">__</bpt>hbaseapp-1.0-SNAPSHOT.jar<ept id=\"p1\">__</ept> to your HDInsight cluster."
    },
    {
      "content": "Replace <bpt id=\"p1\">__</bpt>hdinsightclustername<ept id=\"p1\">__</ept> with the name of your HDInsight cluster.",
      "pos": [
        25202,
        25275
      ]
    },
    {
      "content": "The command will then upload the <bpt id=\"p1\">__</bpt>hbaseapp-1.0-SNAPSHOT.jar<ept id=\"p1\">__</ept> to the <bpt id=\"p2\">__</bpt>example/jars<ept id=\"p2\">__</ept> location in the primary storage for your HDInsight cluster.",
      "pos": [
        25276,
        25422
      ]
    },
    {
      "pos": [
        25427,
        25525
      ],
      "content": "After the files are uploaded, use the following code to create a new table using the <bpt id=\"p1\">__</bpt>hbaseapp<ept id=\"p1\">__</ept>:"
    },
    {
      "pos": [
        25639,
        25712
      ],
      "content": "Replace <bpt id=\"p1\">__</bpt>hdinsightclustername<ept id=\"p1\">__</ept> with the name of your HDInsight cluster."
    },
    {
      "content": "This command creates a new table named <bpt id=\"p1\">__</bpt>people<ept id=\"p1\">__</ept> in your HDInsight cluster.",
      "pos": [
        25718,
        25794
      ]
    },
    {
      "content": "This command does not show any output in the console window.",
      "pos": [
        25795,
        25855
      ]
    },
    {
      "content": "To search for entries in the table, use the following command:",
      "pos": [
        25860,
        25922
      ]
    },
    {
      "pos": [
        26062,
        26135
      ],
      "content": "Replace <bpt id=\"p1\">__</bpt>hdinsightclustername<ept id=\"p1\">__</ept> with the name of your HDInsight cluster."
    },
    {
      "content": "This command uses the <bpt id=\"p1\">**</bpt>SearchByEmail<ept id=\"p1\">**</ept> class to search for any rows where the <bpt id=\"p2\">__</bpt>contactinformation<ept id=\"p2\">__</ept> column family and the <bpt id=\"p3\">__</bpt>email<ept id=\"p3\">__</ept> column, contains the string <bpt id=\"p4\">__</bpt>contoso.com<ept id=\"p4\">__</ept>.",
      "pos": [
        26141,
        26319
      ]
    },
    {
      "content": "You should receive the following results:",
      "pos": [
        26320,
        26361
      ]
    },
    {
      "content": "Using <bpt id=\"p1\">__</bpt>fabrikam.com<ept id=\"p1\">__</ept> for the <ph id=\"ph1\">`-emailRegex`</ph> value will return the users that have <bpt id=\"p2\">__</bpt>fabrikam.com<ept id=\"p2\">__</ept> in the email field.",
      "pos": [
        26618,
        26737
      ]
    },
    {
      "content": "Since this search is implemented by using a regular expression-based filter, you can also enter regular expressions, such as <bpt id=\"p1\">__</bpt>^r<ept id=\"p1\">__</ept>, which will return entries where the email begins with the letter 'r'.",
      "pos": [
        26738,
        26940
      ]
    },
    {
      "content": "Delete the table",
      "pos": [
        26944,
        26960
      ]
    },
    {
      "pos": [
        26962,
        27110
      ],
      "content": "When you are done with the example, use the following command from the Azure PowerShell session to delete the <bpt id=\"p1\">__</bpt>people<ept id=\"p1\">__</ept> table used in this example:"
    },
    {
      "pos": [
        27216,
        27289
      ],
      "content": "Replace <bpt id=\"p1\">__</bpt>hdinsightclustername<ept id=\"p1\">__</ept> with the name of your HDInsight cluster."
    },
    {
      "content": "Troubleshooting",
      "pos": [
        27293,
        27308
      ]
    },
    {
      "content": "No results or unexpected results when using Start-HBaseExample",
      "pos": [
        27313,
        27375
      ]
    },
    {
      "pos": [
        27377,
        27481
      ],
      "content": "Use the <ph id=\"ph1\">`-showErr`</ph> parameter to view the standard error (STDERR) that is produced while running the job."
    },
    {
      "content": "test",
      "pos": [
        27483,
        27487
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Build an HBase application using Maven | Microsoft Azure\"\n    description=\"Learn how to use Apache Maven to build a Java-based Apache HBase application, then deploy it to Azure HDInsight.\"\n    services=\"hdinsight\"\n    documentationCenter=\"\"\n    authors=\"Blackmist\"\n    manager=\"paulettm\"\n    editor=\"cgronlun\"\n    tags=\"azure-portal\"/>\n\n<tags\n    ms.service=\"hdinsight\"\n    ms.workload=\"big-data\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"08/11/2015\"\n    ms.author=\"larryfr\"/>\n\n#Use Maven to build Java applications that use HBase with HDInsight (Hadoop)\n\nLearn how to create and build an [Apache HBase](http://hbase.apache.org/) application in Java by using Apache Maven. Then use the application with Azure HDInsight (Hadoop).\n\n[Maven](http://maven.apache.org/) is a software project management and comprehension tool that allows you to build software, documentation, and reports for Java projects. In this article, you will learn how to use it to create a basic Java application that that creates, queries, and deletes an HBase table on an Azure HDInsight cluster.\n\n##Requirements\n\n* [Java platform JDK](http://www.oracle.com/technetwork/java/javase/downloads/index.html) 7 or later\n\n* [Maven](http://maven.apache.org/)\n\n* [An Azure HDInsight cluster with HBase](hdinsight-hbase-get-started.md#create-hbase-cluster)\n\n##Create the project\n\n1. From the command-line in your development environment, change directories to the location where you want to create the project, for example, `cd code\\hdinsight`.\n\n2. Use the __mvn__ command, which is installed with Maven, to generate the scaffolding for the project.\n\n        mvn archetype:generate -DgroupId=com.microsoft.examples -DartifactId=hbaseapp -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false\n\n    This creates a new directory in the current directory, with the name specified by the __artifactID__ parameter (**hbaseapp** in this example.) This directory will contain the following items:\n\n    * __pom.xml__:  The Project Object Model ([POM](http://maven.apache.org/guides/introduction/introduction-to-the-pom.html)) contains information and configuration details used to build the project.\n\n    * __src__: The directory that contains the __main\\java\\com\\microsoft\\examples__ directory, where you will author the application.\n\n3. Delete the __src\\test\\java\\com\\microsoft\\examples\\apptest.java__ file because it will not be used in this example.\n\n##Update the Project Object Model\n\n1. Edit the __pom.xml__ file and add the following code inside the `<dependencies>` section:\n\n        <dependency>\n          <groupId>org.apache.hbase</groupId>\n          <artifactId>hbase-client</artifactId>\n          <version>0.98.4-hadoop2</version>\n        </dependency>\n\n    This tells Maven that the project requires __hbase-client__ version __0.98.4-hadoop2__. At compile time, this will be downloaded from the default Maven repository. You can use the [Maven Central Repository Search](http://search.maven.org/#artifactdetails%7Corg.apache.hbase%7Chbase-client%7C0.98.4-hadoop2%7Cjar) to learn more about this dependency.\n\n2. Add the following code to the __pom.xml__ file. This must be inside the `<project>...</project>` tags in the file, for example, between `</dependencies>` and `</project>`.\n\n        <build>\n          <sourceDirectory>src</sourceDirectory>\n          <resources>\n            <resource>\n              <directory>${basedir}/conf</directory>\n              <filtering>false</filtering>\n              <includes>\n                <include>hbase-site.xml</include>\n              </includes>\n            </resource>\n          </resources>\n          <plugins>\n            <plugin>\n              <groupId>org.apache.maven.plugins</groupId>\n              <artifactId>maven-compiler-plugin</artifactId>\n                        <version>3.3</version>\n              <configuration>\n                <source>1.6</source>\n                <target>1.6</target>\n              </configuration>\n            </plugin>\n            <plugin>\n              <groupId>org.apache.maven.plugins</groupId>\n              <artifactId>maven-shade-plugin</artifactId>\n              <version>2.3</version>\n              <configuration>\n                <transformers>\n                  <transformer implementation=\"org.apache.maven.plugins.shade.resource.ApacheLicenseResourceTransformer\">\n                  </transformer>\n                </transformers>\n              </configuration>\n              <executions>\n                <execution>\n                  <phase>package</phase>\n                  <goals>\n                    <goal>shade</goal>\n                  </goals>\n                </execution>\n              </executions>\n            </plugin>\n          </plugins>\n        </build>\n\n    This configures a resource (__conf\\hbase-site.xml__,) that contains configuration information for HBase.\n\n    > [AZURE.NOTE] You can also set configuration values via code. See the comments in the __CreateTable__ example that follows for how to do this.\n\n    This also configures the [Maven Compiler Plugin](http://maven.apache.org/plugins/maven-compiler-plugin/) and [Maven Shade Plugin](http://maven.apache.org/plugins/maven-shade-plugin/). The compiler plug-in is used to compile the topology. The shade plug-in is used to prevent license duplication in the JAR package that is built by Maven. The reason this is used is that the duplicate license files cause an error at run time on the HDInsight cluster. Using maven-shade-plugin with the `ApacheLicenseResourceTransformer` implementation prevents this error.\n\n    The maven-shade-plugin also produces an uber jar (or fat jar,) that contains all the dependencies required by the application.\n\n3. Save the __pom.xml__ file.\n\n4. Create a new directory named __conf__ in the __hbaseapp__ directory. In the __conf__ directory, create a new file named __hbase-site.xml__ and use the following as the contents:\n\n        <?xml version=\"1.0\"?>\n        <?xml-stylesheet type=\"text/xsl\" href=\"configuration.xsl\"?>\n        <!--\n        /**\n         * Copyright 2010 The Apache Software Foundation\n         *\n         * Licensed to the Apache Software Foundation (ASF) under one\n         * or more contributor license agreements.  See the NOTICE file\n         * distributed with this work for additional information\n         * regarding copyright ownership.  The ASF licenses this file\n         * to you under the Apache License, Version 2.0 (the\n         * \"License\"); you may not use this file except in compliance\n         * with the License.  You may obtain a copy of the License at\n         *\n         *     http://www.apache.org/licenses/LICENSE-2.0\n         *\n         * Unless required by applicable law or agreed to in writing, software\n         * distributed under the License is distributed on an \"AS IS\" BASIS,\n         * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n         * See the License for the specific language governing permissions and\n         * limitations under the License.\n         */\n        -->\n        <configuration>\n          <property>\n            <name>hbase.cluster.distributed</name>\n            <value>true</value>\n          </property>\n          <property>\n            <name>hbase.zookeeper.quorum</name>\n            <value>zookeeper0,zookeeper1,zookeeper2</value>\n          </property>\n          <property>\n            <name>hbase.zookeeper.property.clientPort</name>\n            <value>2181</value>\n          </property>\n        </configuration>\n\n    This file will be used to load the HBase configuration for an HDInsight cluster.\n\n    > [AZURE.NOTE] This is a very minimal hbase-site.xml file, and it contains the bare minimum settings for the HDInsight cluster. For a full version of the hbase-site.xml configuration file used by HDInsight, see [Manage Hadoop clusters in HDInsight by using the Azure portal](hdinsight-administer-use-management-portal.md#rdp). The hbase-site.xml file is located in the C:\\apps\\dist\\hbase-&lt;version number>-hadoop2\\conf directory. The version number portion of the file path will change as HBase is updated on the cluster.\n\n3. Save the __hbase-site.xml__ file.\n\n##Create the application\n\n1. Go to the __hbaseapp\\src\\main\\java\\com\\microsoft\\examples__ directory and rename the app.java file to __CreateTable.java__.\n\n2. Open the __CreateTable.java__ file and replace the existing contents with the following:\n\n        package com.microsoft.examples;\n        import java.io.IOException;\n\n        import org.apache.hadoop.conf.Configuration;\n        import org.apache.hadoop.hbase.HBaseConfiguration;\n        import org.apache.hadoop.hbase.client.HBaseAdmin;\n        import org.apache.hadoop.hbase.HTableDescriptor;\n        import org.apache.hadoop.hbase.TableName;\n        import org.apache.hadoop.hbase.HColumnDescriptor;\n        import org.apache.hadoop.hbase.client.HTable;\n        import org.apache.hadoop.hbase.client.Put;\n        import org.apache.hadoop.hbase.util.Bytes;\n\n        public class CreateTable {\n          public static void main(String[] args) throws IOException {\n            Configuration config = HBaseConfiguration.create();\n\n            // Example of setting zookeeper values for HDInsight\n            //   in code instead of an hbase-site.xml file\n            //\n            // config.set(\"hbase.zookeeper.quorum\",\n            //            \"zookeepernode0,zookeepernode1,zookeepernode2\");\n            //config.set(\"hbase.zookeeper.property.clientPort\", \"2181\");\n            //config.set(\"hbase.cluster.distributed\", \"true\");\n\n            // create an admin object using the config\n            HBaseAdmin admin = new HBaseAdmin(config);\n\n            // create the table...\n            HTableDescriptor tableDescriptor = new HTableDescriptor(TableName.valueOf(\"people\"));\n            // ... with two column families\n            tableDescriptor.addFamily(new HColumnDescriptor(\"name\"));\n            tableDescriptor.addFamily(new HColumnDescriptor(\"contactinfo\"));\n            admin.createTable(tableDescriptor);\n\n            // define some people\n            String[][] people = {\n                { \"1\", \"Marcel\", \"Haddad\", \"marcel@fabrikam.com\"},\n                { \"2\", \"Franklin\", \"Holtz\", \"franklin@contoso.com\" },\n                { \"3\", \"Dwayne\", \"McKee\", \"dwayne@fabrikam.com\" },\n                { \"4\", \"Rae\", \"Schroeder\", \"rae@contoso.com\" },\n                { \"5\", \"Rosalie\", \"burton\", \"rosalie@fabrikam.com\"},\n                { \"6\", \"Gabriela\", \"Ingram\", \"gabriela@contoso.com\"} };\n\n            HTable table = new HTable(config, \"people\");\n\n            // Add each person to the table\n            //   Use the `name` column family for the name\n            //   Use the `contactinfo` column family for the email\n            for (int i = 0; i< people.length; i++) {\n              Put person = new Put(Bytes.toBytes(people[i][0]));\n              person.add(Bytes.toBytes(\"name\"), Bytes.toBytes(\"first\"), Bytes.toBytes(people[i][1]));\n              person.add(Bytes.toBytes(\"name\"), Bytes.toBytes(\"last\"), Bytes.toBytes(people[i][2]));\n              person.add(Bytes.toBytes(\"contactinfo\"), Bytes.toBytes(\"email\"), Bytes.toBytes(people[i][3]));\n              table.put(person);\n            }\n            // flush commits and close the table\n            table.flushCommits();\n            table.close();\n          }\n        }\n\n    This is the __CreateTable__ class, which will create a table named __people__ and populate it with some predefined users.\n\n3. Save the __CreateTable.java__ file.\n\n4. In the __hbaseapp\\src\\main\\java\\com\\microsoft\\examples__ directory, create a new file named __SearchByEmail.java__. Use the following as the contents of this file:\n\n        package com.microsoft.examples;\n        import java.io.IOException;\n\n        import org.apache.hadoop.conf.Configuration;\n        import org.apache.hadoop.hbase.HBaseConfiguration;\n        import org.apache.hadoop.hbase.client.HTable;\n        import org.apache.hadoop.hbase.client.Scan;\n        import org.apache.hadoop.hbase.client.ResultScanner;\n        import org.apache.hadoop.hbase.client.Result;\n        import org.apache.hadoop.hbase.filter.RegexStringComparator;\n        import org.apache.hadoop.hbase.filter.SingleColumnValueFilter;\n        import org.apache.hadoop.hbase.filter.CompareFilter.CompareOp;\n        import org.apache.hadoop.hbase.util.Bytes;\n        import org.apache.hadoop.util.GenericOptionsParser;\n\n        public class SearchByEmail {\n          public static void main(String[] args) throws IOException {\n            Configuration config = HBaseConfiguration.create();\n\n            // Use GenericOptionsParser to get only the parameters to the class\n            // and not all the parameters passed (when using WebHCat for example)\n            String[] otherArgs = new GenericOptionsParser(config, args).getRemainingArgs();\n            if (otherArgs.length != 1) {\n              System.out.println(\"usage: [regular expression]\");\n              System.exit(-1);\n            }\n\n            // Open the table\n            HTable table = new HTable(config, \"people\");\n\n            // Define the family and qualifiers to be used\n            byte[] contactFamily = Bytes.toBytes(\"contactinfo\");\n            byte[] emailQualifier = Bytes.toBytes(\"email\");\n            byte[] nameFamily = Bytes.toBytes(\"name\");\n            byte[] firstNameQualifier = Bytes.toBytes(\"first\");\n            byte[] lastNameQualifier = Bytes.toBytes(\"last\");\n\n            // Create a new regex filter\n            RegexStringComparator emailFilter = new RegexStringComparator(otherArgs[0]);\n            // Attach the regex filter to a filter\n            //   for the email column\n            SingleColumnValueFilter filter = new SingleColumnValueFilter(\n              contactFamily,\n              emailQualifier,\n              CompareOp.EQUAL,\n              emailFilter\n            );\n\n            // Create a scan and set the filter\n            Scan scan = new Scan();\n            scan.setFilter(filter);\n\n            // Get the results\n            ResultScanner results = table.getScanner(scan);\n            // Iterate over results and print  values\n            for (Result result : results ) {\n              String id = new String(result.getRow());\n              byte[] firstNameObj = result.getValue(nameFamily, firstNameQualifier);\n              String firstName = new String(firstNameObj);\n              byte[] lastNameObj = result.getValue(nameFamily, lastNameQualifier);\n              String lastName = new String(lastNameObj);\n              System.out.println(firstName + \" \" + lastName + \" - ID: \" + id);\n              byte[] emailObj = result.getValue(contactFamily, emailQualifier);\n              String email = new String(emailObj);\n              System.out.println(firstName + \" \" + lastName + \" - \" + email + \" - ID: \" + id);\n            }\n            results.close();\n            table.close();\n          }\n        }\n\n    The __SearchByEmail__ class can be used to query for rows by email address. Because it uses a regular expression filter, you can provide either a string or a regular expression when using the class.\n\n5. Save the __SearchByEmail.java__ file.\n\n6. In the __hbaseapp\\src\\main\\hava\\com\\microsoft\\examples__ directory, create a new file named __DeleteTable.java__. Use the following as the contents of this file:\n\n        package com.microsoft.examples;\n        import java.io.IOException;\n\n        import org.apache.hadoop.conf.Configuration;\n        import org.apache.hadoop.hbase.HBaseConfiguration;\n        import org.apache.hadoop.hbase.client.HBaseAdmin;\n\n        public class DeleteTable {\n          public static void main(String[] args) throws IOException {\n            Configuration config = HBaseConfiguration.create();\n\n            // Create an admin object using the config\n            HBaseAdmin admin = new HBaseAdmin(config);\n\n            // Disable, and then delete the table\n            admin.disableTable(\"people\");\n            admin.deleteTable(\"people\");\n          }\n        }\n\n    This class is for cleaning up this example by disabling and dropping the table created by the __CreateTable__ class.\n\n7. Save the __DeleteTable.java__ file.\n\n##Build and package the application\n\n1. Open a command prompt and change directories to the __hbaseapp__ directory.\n\n2. Use the following command to build a JAR file that contains the application:\n\n        mvn clean package\n\n    This cleans any previous build artifacts, downloads any dependencies that have not already been installed, then builds and packages the application.\n\n3. When the command completes, the __hbaseapp\\target__ directory will contain a file named __hbaseapp-1.0-SNAPSHOT.jar__.\n\n    > [AZURE.NOTE] The __hbaseapp-1.0-SNAPSHOT.jar__ file is an uber jar (sometimes called a fat jar,) which contains all the dependencies required to run the application.\n\n##Upload the JAR file and start a job\n\n> [AZURE.NOTE] There are many ways to upload a file to your HDInsight cluster, as described in [Upload data for Hadoop jobs in HDInsight](hdinsight-upload-data.md). The following steps use [Azure PowerShell](../install-configure-powershell.md).\n\n1. After installing and configuring Azure PowerShell, create a new file named __hbase-runner.psm1__. Use the following as the contents of this file:\n\n        <#\n        .SYNOPSIS\n            Copies a file to the primary storage of an HDInsight cluster.\n        .DESCRIPTION\n            Copies a file from a local directory to the blob container for\n            the HDInsight cluster.\n        .EXAMPLE\n            Start-HBaseExample -className \"com.microsoft.examples.CreateTable\"\n                -clusterName \"MyHDInsightCluster\"\n\n        .EXAMPLE\n            Start-HBaseExample -className \"com.microsoft.examples.SearchByEmail\"\n                -clusterName \"MyHDInsightCluster\"\n                -emailRegex \"contoso.com\"\n\n        .EXAMPLE\n            Start-HBaseExample -className \"com.microsoft.examples.SearchByEmail\"\n                -clusterName \"MyHDInsightCluster\"\n                -emailRegex \"^r\" -showErr\n        #>\n\n        function Start-HBaseExample {\n            [CmdletBinding(SupportsShouldProcess = $true)]\n            param(\n                #The class to run\n                [Parameter(Mandatory = $true)]\n                [String]$className,\n\n                #The name of the HDInsight cluster\n                [Parameter(Mandatory = $true)]\n                [String]$clusterName,\n\n                #Only used when using SearchByEmail\n                [Parameter(Mandatory = $false)]\n                [String]$emailRegex,\n\n                #Use if you want to see stderr output\n                [Parameter(Mandatory = $false)]\n                [Switch]$showErr\n            )\n\n            Set-StrictMode -Version 3\n\n            # Is the Azure module installed?\n            FindAzure\n\n            # The JAR\n            $jarFile = \"wasb:///example/jars/hbaseapp-1.0-SNAPSHOT.jar\"\n\n            # The job definition\n            $jobDefinition = New-AzureHDInsightMapReduceJobDefinition `\n              -JarFile $jarFile `\n              -ClassName $className `\n              -Arguments $emailRegex\n\n            # Get the job output\n            $job = Start-AzureHDInsightJob -Cluster $clusterName -JobDefinition $jobDefinition\n            Write-Host \"Wait for the job to complete ...\" -ForegroundColor Green\n            Wait-AzureHDInsightJob -Job $job\n            if($showErr)\n            {\n                Write-Host \"STDERR\"\n                Get-AzureHDInsightJobOutput -Cluster $clusterName -JobId $job.JobId -StandardError\n            }\n            Write-Host \"Display the standard output ...\" -ForegroundColor Green\n            Get-AzureHDInsightJobOutput -Cluster $clusterName -JobId $job.JobId -StandardOutput\n        }\n\n        <#\n        .SYNOPSIS\n            Copies a file to the primary storage of an HDInsight cluster.\n        .DESCRIPTION\n            Copies a file from a local directory to the blob container for\n            the HDInsight cluster.\n        .EXAMPLE\n            Add-HDInsightFile -localPath \"C:\\temp\\data.txt\"\n                -destinationPath \"example/data/data.txt\"\n                -ClusterName \"MyHDInsightCluster\"\n        .EXAMPLE\n            Add-HDInsightFile -localPath \"C:\\temp\\data.txt\"\n                -destinationPath \"example/data/data.txt\"\n                -ClusterName \"MyHDInsightCluster\"\n                -Container \"MyContainer\"\n        #>\n\n        function Add-HDInsightFile {\n            [CmdletBinding(SupportsShouldProcess = $true)]\n            param(\n                #The path to the local file.\n                [Parameter(Mandatory = $true)]\n                [String]$localPath,\n\n                #The destination path and file name, relative to the root of the container.\n                [Parameter(Mandatory = $true)]\n                [String]$destinationPath,\n\n                #The name of the HDInsight cluster\n                [Parameter(Mandatory = $true)]\n                [String]$clusterName,\n\n                #If specified, overwrites existing files without prompting\n                [Parameter(Mandatory = $false)]\n                [Switch]$force\n            )\n\n            Set-StrictMode -Version 3\n\n            # Is the Azure module installed?\n            FindAzure\n\n            # Does the local path exist?\n            if (-not (Test-Path $localPath))\n            {\n                throw \"Source path '$localPath' does not exist.\"\n            }\n\n            # Get the primary storage container\n            $storage = GetStorage -clusterName $clusterName\n\n            # Upload file to storage, overwriting existing files if -force was used.\n            Set-AzureStorageBlobContent -File $localPath -Blob $destinationPath -force:$force `\n                                        -Container $storage.container `\n                                        -Context $storage.context\n        }\n\n        function FindAzure {\n            # Is the Azure module installed?\n            if (-not(Get-Module -ListAvailable Azure))\n            {\n                throw \"Azure PowerShell not found! For help, see http://www.windowsazure.com/documentation/articles/install-configure-powershell/\"\n            }\n\n            # Is there an active Azure subscription?\n            $sub = Get-AzureSubscription -ErrorAction SilentlyContinue\n            if(-not($sub))\n            {\n                throw \"No active Azure subscription found! If you have a subscription, use the Add-AzureAccount or Import-PublishSettingsFile cmdlets to make the Azure account available to Windows PowerShell.\"\n            }\n        }\n\n        function GetStorage {\n            param(\n                [Parameter(Mandatory = $true)]\n                [String]$clusterName\n            )\n            $hdi = Get-AzureHDInsightCluster -name $clusterName\n            # Does the cluster exist?\n            if (!$hdi)\n            {\n                throw \"HDInsight cluster '$clusterName' does not exist.\"\n            }\n            # Create a return object for context & container\n            $return = @{}\n            $storageAccounts = @{}\n            # Get the primary storage account information\n            $storageAccountName = $hdi.DefaultStorageAccount.StorageAccountName.Split(\".\",2)[0]\n            $storageAccountKey = $hdi.DefaultStorageAccount.StorageAccountKey\n            # Build the hash of storage account name/keys\n            $storageAccounts.Add($hdi.DefaultStorageAccount.StorageAccountName, $storageAccountKey)\n            foreach($account in $hdi.StorageAccounts)\n            {\n                $storageAccounts.Add($account.StorageAccountName, $account.StorageAccountKey)\n            }\n            # Get the storage context, as we can't depend\n            # on using the default storage context\n            $return.context = New-AzureStorageContext -StorageAccountName $storageAccountName -StorageAccountKey $storageAccountKey\n            # Get the container, so we know where to\n            # find/store blobs\n            $return.container = $hdi.DefaultStorageAccount.StorageContainerName\n            # Return storage accounts to support finding all accounts for\n            # a cluster\n            $return.storageAccounts = $storageAccounts\n\n            return $return\n        }\n        # Only export the verb-phrase things\n        export-modulemember *-*\n\n    This file contains two modules:\n\n    * __Add-HDInsightFile__ - used to upload files to HDInsight\n\n    * __Start-HBaseExample__ - used to run the classes created earlier\n\n2. Save the __hbase-runner.psm1__ file.\n\n3. Open a new Azure PowerShell window, change directories to the __hbaseapp__ directory, and then run the following command.\n\n        PS C:\\ Import-Module c:\\path\\to\\hbase-runner.psm1\n\n    Change the path to the location of the __hbase-runner.psm1__ file created earlier. This registers the module for this Azure PowerShell session.\n\n2. Use the following command to upload the __hbaseapp-1.0-SNAPSHOT.jar__ to your HDInsight cluster.\n\n        Add-HDInsightFile -localPath target\\hbaseapp-1.0-SNAPSHOT.jar -destinationPath example/jars/hbaseapp-1.0-SNAPSHOT.jar -clusterName hdinsightclustername\n\n    Replace __hdinsightclustername__ with the name of your HDInsight cluster. The command will then upload the __hbaseapp-1.0-SNAPSHOT.jar__ to the __example/jars__ location in the primary storage for your HDInsight cluster.\n\n3. After the files are uploaded, use the following code to create a new table using the __hbaseapp__:\n\n        Start-HBaseExample -className com.microsoft.examples.CreateTable -clusterName hdinsightclustername\n\n    Replace __hdinsightclustername__ with the name of your HDInsight cluster.\n\n    This command creates a new table named __people__ in your HDInsight cluster. This command does not show any output in the console window.\n\n2. To search for entries in the table, use the following command:\n\n        Start-HBaseExample -className com.microsoft.examples.SearchByEmail -clusterName hdinsightclustername -emailRegex contoso.com\n\n    Replace __hdinsightclustername__ with the name of your HDInsight cluster.\n\n    This command uses the **SearchByEmail** class to search for any rows where the __contactinformation__ column family and the __email__ column, contains the string __contoso.com__. You should receive the following results:\n\n        Franklin Holtz - ID: 2\n        Franklin Holtz - franklin@contoso.com - ID: 2\n        Rae Schroeder - ID: 4\n        Rae Schroeder - rae@contoso.com - ID: 4\n        Gabriela Ingram - ID: 6\n        Gabriela Ingram - gabriela@contoso.com - ID: 6\n\n    Using __fabrikam.com__ for the `-emailRegex` value will return the users that have __fabrikam.com__ in the email field. Since this search is implemented by using a regular expression-based filter, you can also enter regular expressions, such as __^r__, which will return entries where the email begins with the letter 'r'.\n\n##Delete the table\n\nWhen you are done with the example, use the following command from the Azure PowerShell session to delete the __people__ table used in this example:\n\n    Start-HBaseExample -className com.microsoft.examples.DeleteTable -clusterName hdinsightclustername\n\nReplace __hdinsightclustername__ with the name of your HDInsight cluster.\n\n##Troubleshooting\n\n###No results or unexpected results when using Start-HBaseExample\n\nUse the `-showErr` parameter to view the standard error (STDERR) that is produced while running the job.\n\ntest\n"
}