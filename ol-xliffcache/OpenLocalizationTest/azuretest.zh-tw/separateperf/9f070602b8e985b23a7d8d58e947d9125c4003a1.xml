{
  "nodes": [
    {
      "content": "Analyze real-time Twitter sentiment with HBase | Microsoft Azure",
      "pos": [
        28,
        92
      ]
    },
    {
      "content": "Learn how to do real-time sentiment analysis of big data from Twitter using HBase in an HDInsight (Hadoop) cluster.",
      "pos": [
        112,
        227
      ]
    },
    {
      "content": "Analyze real-time Twitter sentiment with HBase in HDInsight",
      "pos": [
        539,
        598
      ]
    },
    {
      "pos": [
        600,
        769
      ],
      "content": "Learn how to do real-time <bpt id=\"p1\">[</bpt>sentiment analysis<ept id=\"p1\">](http://en.wikipedia.org/wiki/Sentiment_analysis)</ept> of big data from Twitter by using HBase in an HDInsight (Hadoop) cluster."
    },
    {
      "content": "Social websites are one of the major driving forces for big data adoption.",
      "pos": [
        772,
        846
      ]
    },
    {
      "content": "Public APIs provided by sites like Twitter are a useful source of data for analyzing and understanding popular trends.",
      "pos": [
        847,
        965
      ]
    },
    {
      "content": "In this tutorial, you will develop a console streaming service application and an ASP.NET web application to perform the following:",
      "pos": [
        966,
        1097
      ]
    },
    {
      "content": "The streaming application",
      "pos": [
        1120,
        1145
      ]
    },
    {
      "content": "Get geo-tagged tweets in real time by using the Twitter streaming API",
      "pos": [
        1152,
        1221
      ]
    },
    {
      "content": "Evaluate the sentiment of these tweets",
      "pos": [
        1228,
        1266
      ]
    },
    {
      "content": "Store the sentiment information in HBase by using the Microsoft HBase SDK",
      "pos": [
        1273,
        1346
      ]
    },
    {
      "content": "The Azure Websites application",
      "pos": [
        1349,
        1379
      ]
    },
    {
      "content": "Plot the real-time statistical results on Bing maps by using an ASP.NET web application.",
      "pos": [
        1386,
        1474
      ]
    },
    {
      "content": "A visualization of the tweets will look something like this:",
      "pos": [
        1475,
        1535
      ]
    },
    {
      "content": "hdinsight.hbase.twitter.sentiment.bing.map",
      "pos": [
        1543,
        1585
      ]
    },
    {
      "content": "You will be able to query tweets with certain keywords to get a sense of if the expressed opinion in the tweets is positive, negative, or neutral.",
      "pos": [
        1610,
        1756
      ]
    },
    {
      "pos": [
        1758,
        1907
      ],
      "content": "A complete Visual Studio solution sample can be found on GitHub: <bpt id=\"p1\">[</bpt>Realtime social sentiment analysis app<ept id=\"p1\">](https://github.com/maxluk/tweet-sentiment)</ept>."
    },
    {
      "content": "<ph id=\"ph1\">&lt;a id=\"prerequisites\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Prerequisites",
      "pos": [
        1941,
        1980
      ]
    },
    {
      "content": "Before you begin this tutorial, you must have the following:",
      "pos": [
        1981,
        2041
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>An HBase cluster in HDInsight<ept id=\"p1\">**</ept>.",
      "pos": [
        2045,
        2079
      ]
    },
    {
      "content": "For instructions about cluster provision, see  <bpt id=\"p1\">[</bpt>Get started using HBase with Hadoop in HDInsight<ept id=\"p1\">] [hbase-get-started]</ept>.",
      "pos": [
        2080,
        2198
      ]
    },
    {
      "content": "You will need the following data to go through the tutorial:",
      "pos": [
        2199,
        2259
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>A workstation<ept id=\"p1\">**</ept> with Visual Studio 2013 installed.",
      "pos": [
        2713,
        2765
      ]
    },
    {
      "content": "For instructions, see <bpt id=\"p1\">[</bpt>Installing Visual Studio<ept id=\"p1\">](http://msdn.microsoft.com/library/e2h7fzkw.aspx)</ept>.",
      "pos": [
        2766,
        2864
      ]
    },
    {
      "pos": [
        2872,
        2935
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"twitter\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Create a Twitter application ID and secrets"
    },
    {
      "content": "The Twitter streaming APIs use <bpt id=\"p1\">[</bpt>OAuth<ept id=\"p1\">](http://oauth.net/)</ept> to authorize requests.",
      "pos": [
        2937,
        3017
      ]
    },
    {
      "content": "The first step to use OAuth is to create a new application on the Twitter developer site.",
      "pos": [
        3018,
        3107
      ]
    },
    {
      "content": "To create Twitter application ID and secrets",
      "pos": [
        3111,
        3155
      ]
    },
    {
      "content": "Sign in to <bpt id=\"p1\">[</bpt>Twitter Apps<ept id=\"p1\">](https://apps.twitter.com/)</ept>.",
      "pos": [
        3162,
        3215
      ]
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Sign up now<ept id=\"p1\">**</ept> link if you don't have a Twitter account.",
      "pos": [
        3216,
        3283
      ]
    },
    {
      "pos": [
        3287,
        3312
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Create New App<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Enter a <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Description<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Website<ept id=\"p3\">**</ept>.",
      "pos": [
        3316,
        3367
      ]
    },
    {
      "content": "The Website field is not really used.",
      "pos": [
        3368,
        3405
      ]
    },
    {
      "content": "It doesn't have to be a valid URL.",
      "pos": [
        3406,
        3440
      ]
    },
    {
      "content": "The following table shows some sample values to use:",
      "pos": [
        3441,
        3493
      ]
    },
    {
      "pos": [
        3499,
        3762
      ],
      "content": "<table border=\"1\">\n <tr><th>Field</th><th>Value</th></tr>\n <tr><td>Name</td><td>MyHDInsightHBaseApp</td></tr>\n <tr><td>Description</td><td>MyHDInsightHBaseApp</td></tr>\n <tr><td>Website</td><td>http://www.myhdinsighthbaseapp.com</td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Field",
          "pos": [
            28,
            33
          ]
        },
        {
          "content": "Value",
          "pos": [
            42,
            47
          ]
        },
        {
          "content": "Name",
          "pos": [
            67,
            71
          ]
        },
        {
          "content": "MyHDInsightHBaseApp",
          "pos": [
            80,
            99
          ]
        },
        {
          "content": "Description",
          "pos": [
            119,
            130
          ]
        },
        {
          "content": "MyHDInsightHBaseApp",
          "pos": [
            139,
            158
          ]
        },
        {
          "content": "Website",
          "pos": [
            178,
            185
          ]
        },
        {
          "content": "http://www.myhdinsighthbaseapp.com",
          "pos": [
            194,
            228
          ]
        }
      ]
    },
    {
      "pos": [
        3770,
        3835
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The Twitter application name must be an unique name."
    },
    {
      "pos": [
        3842,
        3917
      ],
      "content": "Check <bpt id=\"p1\">**</bpt>Yes, I agree<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Create your Twitter application<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Permissions<ept id=\"p1\">**</ept> tab.",
      "pos": [
        3921,
        3951
      ]
    },
    {
      "content": "The default permission is <bpt id=\"p1\">**</bpt>Read only<ept id=\"p1\">**</ept>.",
      "pos": [
        3952,
        3992
      ]
    },
    {
      "content": "This is sufficient for this tutorial.",
      "pos": [
        3993,
        4030
      ]
    },
    {
      "pos": [
        4035,
        4076
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Keys and Access Tokens<ept id=\"p1\">**</ept> tab."
    },
    {
      "pos": [
        4080,
        4113
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Create my access token<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        4117,
        4176
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Test OAuth<ept id=\"p1\">**</ept> in the upper-right corner of the page."
    },
    {
      "content": "Copy the <bpt id=\"p1\">**</bpt>Consumer key<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Consumer secret<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Access token<ept id=\"p3\">**</ept>, and <bpt id=\"p4\">**</bpt>Access token secret<ept id=\"p4\">**</ept> values.",
      "pos": [
        4180,
        4281
      ]
    },
    {
      "content": "You will need these values later in the tutorial.",
      "pos": [
        4282,
        4331
      ]
    },
    {
      "content": "hdi.hbase.twitter.sentiment.twitter.app",
      "pos": [
        4339,
        4378
      ]
    },
    {
      "pos": [
        4429,
        4493
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"streaming\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Create a simple Twitter streaming service"
    },
    {
      "content": "You need to create a console application to get tweets, calculate tweet sentiment score, and send the processed tweet words to HBase.",
      "pos": [
        4495,
        4628
      ]
    },
    {
      "content": "To download the sentiment dictionary file",
      "pos": [
        4632,
        4673
      ]
    },
    {
      "pos": [
        4680,
        4774
      ],
      "content": "Browse to <bpt id=\"p1\">[</bpt>Realtime social sentiment analysis app<ept id=\"p1\">](https://github.com/maxluk/tweet-sentiment)</ept>."
    },
    {
      "pos": [
        4778,
        4801
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Download ZIP<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Extract the file locally.",
      "pos": [
        4805,
        4830
      ]
    },
    {
      "content": "Copy the path of the <bpt id=\"p1\">**</bpt>../tweet-sentiment/SimpleStreamingService/data/dictionary/dictionary.tsv<ept id=\"p1\">**</ept> file.",
      "pos": [
        4834,
        4937
      ]
    },
    {
      "content": "You will need it in the application.",
      "pos": [
        4938,
        4974
      ]
    },
    {
      "content": "To create the  Visual Studio solution",
      "pos": [
        4978,
        5015
      ]
    },
    {
      "pos": [
        5022,
        5045
      ],
      "content": "Open <bpt id=\"p1\">**</bpt>Visual Studio<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        5049,
        5118
      ],
      "content": "From the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, point to <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Type or select the following values:",
      "pos": [
        5122,
        5158
      ]
    },
    {
      "pos": [
        5166,
        5229
      ],
      "content": "Template: <bpt id=\"p1\">**</bpt>Visual C# / Windows Desktop / Console Application<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        5236,
        5269
      ],
      "content": "Name: <bpt id=\"p1\">**</bpt>TweetSentimentStreaming<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        5277,
        5303
      ],
      "content": "Location: <bpt id=\"p1\">**</bpt>C:\\Tutorials<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        5310,
        5352
      ],
      "content": "Solution name: <bpt id=\"p1\">**</bpt>TweetSentimentStreaming<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        5357,
        5382
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to continue."
    },
    {
      "content": "To install NuGet packages and add SDK references",
      "pos": [
        5389,
        5437
      ]
    },
    {
      "content": "From the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Nuget Package Manager<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Package Manager Console<ept id=\"p3\">**</ept>.",
      "pos": [
        5444,
        5545
      ]
    },
    {
      "content": "The console panel will open at the bottom of the page.",
      "pos": [
        5546,
        5600
      ]
    },
    {
      "pos": [
        5604,
        5904
      ],
      "content": "Use the following commands to install the <bpt id=\"p1\">[</bpt>HBase .NET SDK<ept id=\"p1\">](https://www.nuget.org/packages/Microsoft.HBase.Client/)</ept> package, which is the client library to access the HBase cluster, and the <bpt id=\"p2\">[</bpt>Tweetinvi API<ept id=\"p2\">](https://www.nuget.org/packages/TweetinviAPI/)</ept> package, which is used to access the Twitter API."
    },
    {
      "pos": [
        5998,
        6087
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click <bpt id=\"p2\">**</bpt>References<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Add Reference<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        6091,
        6161
      ],
      "content": "In the left pane, expand <bpt id=\"p1\">**</bpt>Assemblies<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Framework<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        6165,
        6265
      ],
      "content": "In the right pane, select the check box in front of <bpt id=\"p1\">**</bpt>System.Configuration<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "To define the Tweeter streaming service class",
      "pos": [
        6271,
        6316
      ]
    },
    {
      "pos": [
        6323,
        6435
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click <bpt id=\"p2\">**</bpt>TweetSentimentStreaming<ept id=\"p2\">**</ept>, point to <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>Class<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        6439,
        6507
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> field, type <bpt id=\"p2\">**</bpt>HBaseWriter<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        6511,
        6596
      ],
      "content": "In <bpt id=\"p1\">**</bpt>HBaseWriter.cs<ept id=\"p1\">**</ept>, add the following <bpt id=\"p2\">**</bpt>using<ept id=\"p2\">**</ept> statements at the top of the file:"
    },
    {
      "pos": [
        6845,
        6912
      ],
      "content": "Inside <bpt id=\"p1\">**</bpt>HbaseWriter.cs<ept id=\"p1\">**</ept>, add a new class call <bpt id=\"p2\">**</bpt>DictionaryItem<ept id=\"p2\">**</ept>:"
    },
    {
      "content": "This class structure is used to parse the sentiment dictionary file.",
      "pos": [
        7250,
        7318
      ]
    },
    {
      "content": "The data is used to calculate sentiment score for each tweet.",
      "pos": [
        7319,
        7380
      ]
    },
    {
      "pos": [
        7385,
        7464
      ],
      "content": "Inside the <bpt id=\"p1\">**</bpt>HBaseWriter<ept id=\"p1\">**</ept> class, define the following constants and variables:"
    },
    {
      "content": "Set the constant values, including <bpt id=\"p1\">**</bpt>&amp;lt;HBaseClusterName&gt;<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>&amp;lt;HadoopUserName&gt;<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>&amp;lt;HaddopUserPassword&gt;<ept id=\"p3\">**</ept>.",
      "pos": [
        8638,
        8757
      ]
    },
    {
      "content": "If you want to change the HBase table name, you must change the table name in the web application accordingly.",
      "pos": [
        8758,
        8868
      ]
    },
    {
      "content": "You will download and move the dictionary.tsv file to a specific folder later in the tutorial.",
      "pos": [
        8874,
        8968
      ]
    },
    {
      "pos": [
        8973,
        9037
      ],
      "content": "Define the following functions inside the <bpt id=\"p1\">**</bpt>HBaseWriter<ept id=\"p1\">**</ept> class:"
    },
    {
      "content": "This code provides the following functionality:",
      "pos": [
        15352,
        15399
      ]
    },
    {
      "pos": [
        15407,
        15637
      ],
      "content": "<bpt id=\"p1\">**</bpt>Connect to Hbase [ HBaseWriter() ]<ept id=\"p1\">**</ept>: Use the HBase SDK to create a <bpt id=\"p2\">*</bpt>ClusterCredentials<ept id=\"p2\">*</ept> object with the cluster URL and the Hadoop user credential, and then create an <bpt id=\"p3\">*</bpt>HBaseClient<ept id=\"p3\">*</ept> object by using the ClusterCredentials object."
    },
    {
      "pos": [
        15644,
        15733
      ],
      "content": "<bpt id=\"p1\">**</bpt>Create HBase table [ HBaseWriter() ]<ept id=\"p1\">**</ept>: The method call is <bpt id=\"p2\">*</bpt>HBaseClient.CreateTable()<ept id=\"p2\">*</ept>."
    },
    {
      "pos": [
        15740,
        15839
      ],
      "content": "<bpt id=\"p1\">**</bpt>Write to HBase table [ WriterThreadFunction() ]<ept id=\"p1\">**</ept>: The method call is <bpt id=\"p2\">*</bpt>HBaseClient.StoreCells()<ept id=\"p2\">*</ept>."
    },
    {
      "content": "To complete the Program.cs",
      "pos": [
        15843,
        15869
      ]
    },
    {
      "pos": [
        15876,
        15943
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, double-click <bpt id=\"p2\">**</bpt>Program.cs<ept id=\"p2\">**</ept> to open it."
    },
    {
      "pos": [
        15947,
        16016
      ],
      "content": "At the beginning of the file, add the following <bpt id=\"p1\">**</bpt>using<ept id=\"p1\">**</ept> statements:"
    },
    {
      "pos": [
        16117,
        16178
      ],
      "content": "Inside the <bpt id=\"p1\">**</bpt>Program<ept id=\"p1\">**</ept> class, define the following constants:"
    },
    {
      "content": "Set the constant values to match your Twitter application values.",
      "pos": [
        16495,
        16560
      ]
    },
    {
      "pos": [
        16565,
        16619
      ],
      "content": "Modify the <bpt id=\"p1\">**</bpt>Main()<ept id=\"p1\">**</ept> function, so it looks like this:"
    },
    {
      "content": "Add the following function to the class:",
      "pos": [
        16868,
        16908
      ]
    },
    {
      "content": "To run the streaming service",
      "pos": [
        18718,
        18746
      ]
    },
    {
      "content": "From Visual Studio, press <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept>.",
      "pos": [
        18753,
        18786
      ]
    },
    {
      "content": "The following is a screenshot of the console application:",
      "pos": [
        18787,
        18844
      ]
    },
    {
      "content": "hdinsight.hbase.twitter.sentiment.streaming.service",
      "pos": [
        18852,
        18903
      ]
    },
    {
      "content": "Keep the streaming console application running while you develop the web application, so you have more data to use.",
      "pos": [
        18931,
        19046
      ]
    },
    {
      "pos": [
        19076,
        19164
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"web\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Create a website by using Azure Websites to visualize Twitter sentiment"
    },
    {
      "content": "In this section, you will create an ASP.NET MVC web application to read the real-time sentiment data from HBase and plot the data on Bing maps.",
      "pos": [
        19166,
        19309
      ]
    },
    {
      "content": "To create an ASP.NET MVC Web application",
      "pos": [
        19313,
        19353
      ]
    },
    {
      "content": "Open Visual Studio.",
      "pos": [
        19360,
        19379
      ]
    },
    {
      "pos": [
        19383,
        19441
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Enter the following information:",
      "pos": [
        19445,
        19477
      ]
    },
    {
      "pos": [
        19485,
        19521
      ],
      "content": "Template category: <bpt id=\"p1\">**</bpt>Visual C#/Web<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        19528,
        19565
      ],
      "content": "Template: <bpt id=\"p1\">**</bpt>ASP.NET Web Application<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        19572,
        19599
      ],
      "content": "Name: <bpt id=\"p1\">**</bpt>TweetSentimentWeb<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        19606,
        19632
      ],
      "content": "Location: <bpt id=\"p1\">**</bpt>C:\\Tutorials<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        19637,
        19650
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        19654,
        19694
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Select a template<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>MVC<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        19699,
        19754
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Microsoft Azure<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Manage Subscriptions<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        19758,
        19823
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Manage Microsoft Azure Subscriptions<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Sign in<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Enter your Azure credentials.",
      "pos": [
        19827,
        19856
      ]
    },
    {
      "content": "Your Azure subscription information will be shown on the <bpt id=\"p1\">**</bpt>Accounts<ept id=\"p1\">**</ept> tab.",
      "pos": [
        19857,
        19931
      ]
    },
    {
      "pos": [
        19935,
        20012
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept> to close the <bpt id=\"p2\">**</bpt>Manage Microsoft Azure Subscriptions<ept id=\"p2\">**</ept> window."
    },
    {
      "pos": [
        20017,
        20080
      ],
      "content": "From <bpt id=\"p1\">**</bpt>New ASP.NET Project - TweetSentimentWeb<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "From <bpt id=\"p1\">**</bpt>Configure Microsoft Azure Site Settings<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>Region<ept id=\"p2\">**</ept> that is closest to you.",
      "pos": [
        20085,
        20180
      ]
    },
    {
      "content": "You don't need to specify a database server.",
      "pos": [
        20181,
        20225
      ]
    },
    {
      "pos": [
        20231,
        20244
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>."
    },
    {
      "content": "To install NuGet packages",
      "pos": [
        20248,
        20273
      ]
    },
    {
      "content": "From the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Nuget Package Manager<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Package Manager Console<ept id=\"p3\">**</ept>.",
      "pos": [
        20280,
        20381
      ]
    },
    {
      "content": "The console panel is opened at the bottom of the page.",
      "pos": [
        20382,
        20436
      ]
    },
    {
      "pos": [
        20440,
        20615
      ],
      "content": "Use the following command to install the <bpt id=\"p1\">[</bpt>HBase .NET SDK<ept id=\"p1\">](https://www.nuget.org/packages/Microsoft.HBase.Client/)</ept> package, which is the client library to access HBase cluster:"
    },
    {
      "content": "To add HBaseReader class",
      "pos": [
        20668,
        20692
      ]
    },
    {
      "pos": [
        20699,
        20753
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, expand <bpt id=\"p2\">**</bpt>TweetSentiment<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        20757,
        20821
      ],
      "content": "Right-click <bpt id=\"p1\">**</bpt>Models<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Class<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        20825,
        20896
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> field, type <bpt id=\"p2\">**</bpt>HBaseReader.cs<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Replace the code with the following:",
      "pos": [
        20900,
        20936
      ]
    },
    {
      "pos": [
        25623,
        25695
      ],
      "content": "Inside the <bpt id=\"p1\">**</bpt>HBaseReader<ept id=\"p1\">**</ept> class, change the constant values as follows:"
    },
    {
      "pos": [
        25703,
        25806
      ],
      "content": "<bpt id=\"p1\">**</bpt>CLUSTERNAME<ept id=\"p1\">**</ept>: The HBase cluster name, for example, <bpt id=\"p2\">*</bpt>https://<ph id=\"ph1\">&lt;HBaseClusterName&gt;</ph>.azurehdinsight.net/<ept id=\"p2\">*</ept>."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>HADOOPUSERNAME<ept id=\"p1\">**</ept>: The HBase cluster Hadoop user user name.",
      "pos": [
        25814,
        25874
      ]
    },
    {
      "content": "The default name is <bpt id=\"p1\">*</bpt>admin<ept id=\"p1\">*</ept>.",
      "pos": [
        25875,
        25903
      ]
    },
    {
      "pos": [
        25910,
        25973
      ],
      "content": "<bpt id=\"p1\">**</bpt>HADOOPUSERPASSWORD<ept id=\"p1\">**</ept>: The HBase cluster Hadoop user password."
    },
    {
      "pos": [
        25980,
        26019
      ],
      "content": "<bpt id=\"p1\">**</bpt>HBASETABLENAME<ept id=\"p1\">**</ept> = \"tweets_by_words\";"
    },
    {
      "content": "The HBase table name is <bpt id=\"p1\">**</bpt>\"tweets_by_words\";<ept id=\"p1\">**</ept>.",
      "pos": [
        26025,
        26072
      ]
    },
    {
      "content": "The values must match the values you sent in the streaming service, so that the web application reads the data from the same HBase table.",
      "pos": [
        26073,
        26210
      ]
    },
    {
      "content": "To add TweetsController controller",
      "pos": [
        26217,
        26251
      ]
    },
    {
      "pos": [
        26258,
        26315
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, expand <bpt id=\"p2\">**</bpt>TweetSentimentWeb<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        26319,
        26393
      ],
      "content": "Right-click <bpt id=\"p1\">**</bpt>Controllers<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Controller<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        26397,
        26460
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Web API 2 Controller - Empty<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        26464,
        26548
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Controller name<ept id=\"p1\">**</ept> field, type <bpt id=\"p2\">**</bpt>TweetsController<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        26552,
        26630
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, double-click TweetsController.cs to open the file."
    },
    {
      "content": "Modify the file, so it looks like the following:",
      "pos": [
        26634,
        26682
      ]
    },
    {
      "content": "To add heatmap.js",
      "pos": [
        27374,
        27391
      ]
    },
    {
      "pos": [
        27398,
        27455
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, expand <bpt id=\"p2\">**</bpt>TweetSentimentWeb<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        27459,
        27525
      ],
      "content": "Right-click <bpt id=\"p1\">**</bpt>Scripts<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>JavaScript File<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        27529,
        27577
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Item name<ept id=\"p1\">**</ept> field, type <bpt id=\"p2\">**</bpt>heatmap.js<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Paste the following code into the file.",
      "pos": [
        27581,
        27620
      ]
    },
    {
      "content": "The code was written by Alastair Aitchison.",
      "pos": [
        27621,
        27664
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Bing Maps AJAX v7 HeatMap Library<ept id=\"p1\">](http://alastaira.wordpress.com/2011/04/15/bing-maps-ajax-v7-heatmap-library/)</ept>.",
      "pos": [
        27665,
        27805
      ]
    },
    {
      "content": "To add twitterStream.js",
      "pos": [
        38415,
        38438
      ]
    },
    {
      "pos": [
        38445,
        38502
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, expand <bpt id=\"p2\">**</bpt>TweetSentimentWeb<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        38506,
        38572
      ],
      "content": "Right-click <bpt id=\"p1\">**</bpt>Scripts<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>JavaScript File<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        38576,
        38629
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Item name<ept id=\"p1\">**</ept> field, type<bpt id=\"p2\">**</bpt>twitterStream.js<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Copy and paste the following code into the file:",
      "pos": [
        38633,
        38681
      ]
    },
    {
      "content": "To modify the layout.cshtml",
      "pos": [
        45942,
        45969
      ]
    },
    {
      "pos": [
        45976,
        46112
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, expand <bpt id=\"p2\">**</bpt>TweetSentimentWeb<ept id=\"p2\">**</ept>, expand <bpt id=\"p3\">**</bpt>Views<ept id=\"p3\">**</ept>, expand <bpt id=\"p4\">**</bpt>Shared<ept id=\"p4\">**</ept>, and then double-click _<bpt id=\"p5\">**</bpt>Layout.cshtml<ept id=\"p5\">**</ept>."
    },
    {
      "content": "Replace the content with the following:",
      "pos": [
        46116,
        46155
      ]
    },
    {
      "content": "To modify the Index.cshtml",
      "pos": [
        49207,
        49233
      ]
    },
    {
      "pos": [
        49240,
        49372
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, expand <bpt id=\"p2\">**</bpt>TweetSentimentWeb<ept id=\"p2\">**</ept>, expand <bpt id=\"p3\">**</bpt>Views<ept id=\"p3\">**</ept>, expand <bpt id=\"p4\">**</bpt>Home<ept id=\"p4\">**</ept>, and then double-click <bpt id=\"p5\">**</bpt>Index.cshtml<ept id=\"p5\">**</ept>."
    },
    {
      "content": "Replace the content with the following:",
      "pos": [
        49376,
        49415
      ]
    },
    {
      "content": "To modify the site.css file",
      "pos": [
        49583,
        49610
      ]
    },
    {
      "pos": [
        49617,
        49730
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, expand <bpt id=\"p2\">**</bpt>TweetSentimentWeb<ept id=\"p2\">**</ept>, expand <bpt id=\"p3\">**</bpt>Content<ept id=\"p3\">**</ept>, and then double-click <bpt id=\"p4\">**</bpt>Site.css<ept id=\"p4\">**</ept>."
    },
    {
      "content": "Append the following code to the file:",
      "pos": [
        49734,
        49772
      ]
    },
    {
      "content": "To modify the global.asax file",
      "pos": [
        50149,
        50179
      ]
    },
    {
      "pos": [
        50186,
        50282
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, expand <bpt id=\"p2\">**</bpt>TweetSentimentWeb<ept id=\"p2\">**</ept>, and then double-click <bpt id=\"p3\">**</bpt>Global.asax<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        50286,
        50324
      ],
      "content": "Add the following <bpt id=\"p1\">**</bpt>using<ept id=\"p1\">**</ept> statement:"
    },
    {
      "pos": [
        50361,
        50429
      ],
      "content": "Add the following lines inside the <bpt id=\"p1\">**</bpt>Application_Start()<ept id=\"p1\">**</ept> function:"
    },
    {
      "content": "Modify the registration of the API routes to make the Web API controller work inside the MVC application.",
      "pos": [
        50531,
        50636
      ]
    },
    {
      "content": "To run the web application",
      "pos": [
        50640,
        50666
      ]
    },
    {
      "content": "Verify that the streaming service console application is still running so you can see the real-time changes.",
      "pos": [
        50673,
        50781
      ]
    },
    {
      "pos": [
        50785,
        50825
      ],
      "content": "Press <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> to run the web application:"
    },
    {
      "content": "hdinsight.hbase.twitter.sentiment.bing.map",
      "pos": [
        50833,
        50875
      ]
    },
    {
      "content": "In the text box, enter a keyword, and then click <bpt id=\"p1\">**</bpt>Go<ept id=\"p1\">**</ept>.",
      "pos": [
        50894,
        50950
      ]
    },
    {
      "content": "Depending on the data collected in the HBase table, some keywords might not be found.",
      "pos": [
        50952,
        51037
      ]
    },
    {
      "content": "Try some common keywords, such as \"love,\" \"xbox,\" and \"playstation.\"",
      "pos": [
        51038,
        51106
      ]
    },
    {
      "pos": [
        51111,
        51204
      ],
      "content": "Toggle among <bpt id=\"p1\">**</bpt>Positive<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Neutral<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Negative<ept id=\"p3\">**</ept> to compare sentiment on the subject."
    },
    {
      "content": "Let the streaming service run for another hour, and then search the same keywords, and compare the results.",
      "pos": [
        51208,
        51315
      ]
    },
    {
      "content": "Optionally, you can deploy the application to Azure Websites.",
      "pos": [
        51319,
        51380
      ]
    },
    {
      "content": "For instructions, see <bpt id=\"p1\">[</bpt>Get started with Azure Websites and ASP.NET<ept id=\"p1\">][website-get-started]</ept>.",
      "pos": [
        51381,
        51470
      ]
    },
    {
      "pos": [
        51475,
        51507
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"nextsteps\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Next Steps"
    },
    {
      "content": "In this tutorial, you learned how to get tweets, analyze the sentiment of tweets, save the sentiment data to HBase, and present the real-time Twitter sentiment data to Bing maps.",
      "pos": [
        51509,
        51687
      ]
    },
    {
      "content": "To learn more, see:",
      "pos": [
        51688,
        51707
      ]
    },
    {
      "content": "Get started with HDInsight",
      "pos": [
        51712,
        51738
      ]
    },
    {
      "content": "Configure HBase replication in HDInsight",
      "pos": [
        51766,
        51806
      ]
    },
    {
      "content": "Analyze Twitter data with Hadoop in HDInsight",
      "pos": [
        51848,
        51893
      ]
    },
    {
      "content": "Analyze flight delay data using HDInsight",
      "pos": [
        51930,
        51971
      ]
    },
    {
      "content": "Develop C# Hadoop streaming programs for HDInsight",
      "pos": [
        52013,
        52063
      ]
    },
    {
      "content": "Develop Java MapReduce programs for HDInsight",
      "pos": [
        52097,
        52142
      ]
    },
    {
      "content": "test",
      "pos": [
        53960,
        53964
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Analyze real-time Twitter sentiment with HBase | Microsoft Azure\" \n    description=\"Learn how to do real-time sentiment analysis of big data from Twitter using HBase in an HDInsight (Hadoop) cluster.\" \n    services=\"hdinsight\" \n    documentationCenter=\"\" \n    authors=\"mumian\" \n    manager=\"paulettm\" \n    editor=\"cgronlun\"/>\n\n<tags \n    ms.service=\"hdinsight\" \n    ms.workload=\"big-data\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"07/09/2015\" \n    ms.author=\"jgao\"/>\n\n# Analyze real-time Twitter sentiment with HBase in HDInsight\n\nLearn how to do real-time [sentiment analysis](http://en.wikipedia.org/wiki/Sentiment_analysis) of big data from Twitter by using HBase in an HDInsight (Hadoop) cluster.\n\n\nSocial websites are one of the major driving forces for big data adoption. Public APIs provided by sites like Twitter are a useful source of data for analyzing and understanding popular trends. In this tutorial, you will develop a console streaming service application and an ASP.NET web application to perform the following:\n\n![][img-app-arch]\n\n- The streaming application\n    - Get geo-tagged tweets in real time by using the Twitter streaming API\n    - Evaluate the sentiment of these tweets\n    - Store the sentiment information in HBase by using the Microsoft HBase SDK\n- The Azure Websites application\n    - Plot the real-time statistical results on Bing maps by using an ASP.NET web application. A visualization of the tweets will look something like this:\n\n    ![hdinsight.hbase.twitter.sentiment.bing.map][img-bing-map]\n    \n    You will be able to query tweets with certain keywords to get a sense of if the expressed opinion in the tweets is positive, negative, or neutral.\n\nA complete Visual Studio solution sample can be found on GitHub: [Realtime social sentiment analysis app](https://github.com/maxluk/tweet-sentiment).\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n##<a id=\"prerequisites\"></a>Prerequisites\nBefore you begin this tutorial, you must have the following:\n\n- **An HBase cluster in HDInsight**. For instructions about cluster provision, see  [Get started using HBase with Hadoop in HDInsight] [hbase-get-started]. You will need the following data to go through the tutorial:\n\n\n    <table border=\"1\">\n    <tr><th>Cluster property</th><th>Description</th></tr>\n    <tr><td>HBase cluster name</td><td>Your HDInsight HBase cluster name. For example: https://myhbase.azurehdinsight.net/</td></tr>\n    <tr><td>Cluster user name</td><td>The Hadoop user account name. The default Hadoop user name is <strong>admin</strong>.</td></tr>\n    <tr><td>Cluster user password</td><td>The Hadoop cluster user password.</td></tr>\n    </table>\n\n- **A workstation** with Visual Studio 2013 installed. For instructions, see [Installing Visual Studio](http://msdn.microsoft.com/library/e2h7fzkw.aspx).\n\n\n\n\n\n##<a id=\"twitter\"></a>Create a Twitter application ID and secrets\n\nThe Twitter streaming APIs use [OAuth](http://oauth.net/) to authorize requests. The first step to use OAuth is to create a new application on the Twitter developer site.\n\n**To create Twitter application ID and secrets**\n\n1. Sign in to [Twitter Apps](https://apps.twitter.com/). Click the **Sign up now** link if you don't have a Twitter account.\n2. Click **Create New App**.\n3. Enter a **Name**, **Description**, and **Website**. The Website field is not really used. It doesn't have to be a valid URL. The following table shows some sample values to use:\n\n    <table border=\"1\">\n    <tr><th>Field</th><th>Value</th></tr>\n    <tr><td>Name</td><td>MyHDInsightHBaseApp</td></tr>\n    <tr><td>Description</td><td>MyHDInsightHBaseApp</td></tr>\n    <tr><td>Website</td><td>http://www.myhdinsighthbaseapp.com</td></tr>\n    </table>\n\n    > [AZURE.NOTE] The Twitter application name must be an unique name.  \n\n4. Check **Yes, I agree**, and then click **Create your Twitter application**.\n5. Click the **Permissions** tab. The default permission is **Read only**. This is sufficient for this tutorial. \n6. Click the **Keys and Access Tokens** tab.\n7. Click **Create my access token**.\n8. Click **Test OAuth** in the upper-right corner of the page.\n9. Copy the **Consumer key**, **Consumer secret**, **Access token**, and **Access token secret** values. You will need these values later in the tutorial.\n\n    ![hdi.hbase.twitter.sentiment.twitter.app][img-twitter-app]\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n##<a id=\"streaming\"></a> Create a simple Twitter streaming service\n\nYou need to create a console application to get tweets, calculate tweet sentiment score, and send the processed tweet words to HBase.\n\n**To download the sentiment dictionary file**\n\n1. Browse to [Realtime social sentiment analysis app](https://github.com/maxluk/tweet-sentiment).\n2. Click **Download ZIP**.\n3. Extract the file locally.\n4. Copy the path of the **../tweet-sentiment/SimpleStreamingService/data/dictionary/dictionary.tsv** file. You will need it in the application.\n\n**To create the  Visual Studio solution**\n\n1. Open **Visual Studio**.\n2. From the **File** menu, point to **New**, and then click **Project**.\n3. Type or select the following values:\n\n    - Template: **Visual C# / Windows Desktop / Console Application**\n    - Name: **TweetSentimentStreaming** \n    - Location: **C:\\Tutorials**\n    - Solution name: **TweetSentimentStreaming**\n\n4. Click **OK** to continue.\n \n\n\n**To install NuGet packages and add SDK references**\n\n1. From the **Tools** menu, click **Nuget Package Manager**, and then click **Package Manager Console**. The console panel will open at the bottom of the page.\n2. Use the following commands to install the [HBase .NET SDK](https://www.nuget.org/packages/Microsoft.HBase.Client/) package, which is the client library to access the HBase cluster, and the [Tweetinvi API](https://www.nuget.org/packages/TweetinviAPI/) package, which is used to access the Twitter API.\n\n        Install-Package Microsoft.HBase.Client\n        Install-Package TweetinviAPI\n    \n3. From **Solution Explorer**, right-click **References**, and then click **Add Reference**.\n4. In the left pane, expand **Assemblies**, and then click **Framework**.\n5. In the right pane, select the check box in front of **System.Configuration**, and then click **OK**.\n\n\n\n**To define the Tweeter streaming service class**\n\n1. From **Solution Explorer**, right-click **TweetSentimentStreaming**, point to **Add**, and then click **Class**.\n2. In the **Name** field, type **HBaseWriter**, and then click **Add**.\n3. In **HBaseWriter.cs**, add the following **using** statements at the top of the file:\n\n        using System.IO;        \n        using System.Threading;\n        using System.Globalization;\n        using Microsoft.HBase.Client;\n        using Tweetinvi.Core.Interfaces;\n        using org.apache.hadoop.hbase.rest.protobuf.generated;\n\n4. Inside **HbaseWriter.cs**, add a new class call **DictionaryItem**:\n\n        public class DictionaryItem\n        {\n            public string Type { get; set; }\n            public int Length { get; set; }\n            public string Word { get; set; }\n            public string Pos { get; set; }\n            public string Stemmed { get; set; }\n            public string Polarity { get; set; }\n        }\n\n    This class structure is used to parse the sentiment dictionary file. The data is used to calculate sentiment score for each tweet.\n\n5. Inside the **HBaseWriter** class, define the following constants and variables:\n\n        // HDinsight HBase cluster and HBase table information\n        const string CLUSTERNAME = \"https://<HBaseClusterName>.azurehdinsight.net/\";\n        const string HADOOPUSERNAME = \"<HadoopUserName>\"; //the default name is \"admin\"\n        const string HADOOPUSERPASSWORD = \"<HaddopUserPassword>\";\n        const string HBASETABLENAME = \"tweets_by_words\";\n\n        // Sentiment dictionary file and the punctuation characters\n        const string DICTIONARYFILENAME = @\"..\\..\\data\\dictionary\\dictionary.tsv\";\n        private static char[] _punctuationChars = new[] { \n            ' ', '!', '\\\"', '#', '$', '%', '&', '\\'', '(', ')', '*', '+', ',', '-', '.', '/',   //ascii 23--47\n            ':', ';', '<', '=', '>', '?', '@', '[', ']', '^', '_', '`', '{', '|', '}', '~' };   //ascii 58--64 + misc.\n\n        // For writting to HBase\n        HBaseClient client;\n\n        // a sentiment dictionary for estimate sentiment. It is loaded from a physical file.\n        Dictionary<string, DictionaryItem> dictionary;\n        \n        // use multithread write\n        Thread writerThread;\n        Queue<ITweet> queue = new Queue<ITweet>();\n        bool threadRunning = true;\n\n6. Set the constant values, including **&lt;HBaseClusterName>**, **&lt;HadoopUserName>**, and **&lt;HaddopUserPassword>**. If you want to change the HBase table name, you must change the table name in the web application accordingly.\n\n    You will download and move the dictionary.tsv file to a specific folder later in the tutorial.\n\n7. Define the following functions inside the **HBaseWriter** class:\n\n        // This function connects to HBase, loads the sentiment dictionary, and starts the thread for writting.\n        public HBaseWriter()\n        {\n            ClusterCredentials credentials = new ClusterCredentials(new Uri(CLUSTERNAME), HADOOPUSERNAME, HADOOPUSERPASSWORD);\n            client = new HBaseClient(credentials);\n\n            // create the HBase table if it doesn't exist\n            if (!client.ListTables().name.Contains(HBASETABLENAME))\n            {\n                TableSchema tableSchema = new TableSchema();\n                tableSchema.name = HBASETABLENAME;\n                tableSchema.columns.Add(new ColumnSchema { name = \"d\" });\n                client.CreateTable(tableSchema);\n                Console.WriteLine(\"Table \\\"{0}\\\" is created.\", HBASETABLENAME);\n            }\n\n            // Load sentiment dictionary from a file\n            LoadDictionary();\n\n            // Start a thread for writting to HBase\n            writerThread = new Thread(new ThreadStart(WriterThreadFunction));\n            writerThread.Start();\n        }\n\n        ~HBaseWriter()\n        {\n            threadRunning = false;\n        }\n\n        // Enqueue the Tweets received\n        public void WriteTweet(ITweet tweet)\n        {\n            lock (queue)\n            {\n                queue.Enqueue(tweet);\n            }\n        }\n\n        // Load sentiment dictionary from a file\n        private void LoadDictionary()\n        {\n            List<string> lines = File.ReadAllLines(DICTIONARYFILENAME).ToList();\n            var items = lines.Select(line =>\n            {\n                var fields = line.Split('\\t');\n                var pos = 0;\n                return new DictionaryItem\n                {\n                    Type = fields[pos++],\n                    Length = Convert.ToInt32(fields[pos++]),\n                    Word = fields[pos++],\n                    Pos = fields[pos++],\n                    Stemmed = fields[pos++],\n                    Polarity = fields[pos++]\n                };\n            });\n\n            dictionary = new Dictionary<string, DictionaryItem>();\n            foreach (var item in items)\n            {\n                if (!dictionary.Keys.Contains(item.Word))\n                {\n                    dictionary.Add(item.Word, item);\n                }\n            }\n        }\n\n        // Calculate sentiment score\n        private int CalcSentimentScore(string[] words)\n        {\n            Int32 total = 0;\n            foreach (string word in words)\n            {\n                if (dictionary.Keys.Contains(word))\n                {\n                    switch (dictionary[word].Polarity)\n                    {\n                        case \"negative\": total -= 1; break;\n                        case \"positive\": total += 1; break;\n                    }\n                }\n            }\n            if (total > 0)\n            {\n                return 1;\n            }\n            else if (total < 0)\n            {\n                return -1;\n            }\n            else\n            {\n                return 0;\n            }\n        }\n\n        // Popular a CellSet object to be written into HBase\n        private void CreateTweetByWordsCells(CellSet set, ITweet tweet)\n        {\n            // Split the Tweet into words\n            string[] words = tweet.Text.ToLower().Split(_punctuationChars);\n\n            // Calculate sentiment score base on the words\n            int sentimentScore = CalcSentimentScore(words);\n            var word_pairs = words.Take(words.Length - 1)\n                                  .Select((word, idx) => string.Format(\"{0} {1}\", word, words[idx + 1]));\n            var all_words = words.Concat(word_pairs).ToList();\n\n            // For each word in the Tweet add a row to the HBase table\n            foreach (string word in all_words)\n            {\n                string time_index = (ulong.MaxValue - (ulong)tweet.CreatedAt.ToBinary()).ToString().PadLeft(20) + tweet.IdStr;\n                string key = word + \"_\" + time_index;\n\n                // Create a row\n                var row = new CellSet.Row { key = Encoding.UTF8.GetBytes(key) };\n\n                // Add columns to the row, including Tweet identifier, language, coordinator(if available), and sentiment \n                var value = new Cell { column = Encoding.UTF8.GetBytes(\"d:id_str\"), data = Encoding.UTF8.GetBytes(tweet.IdStr) };\n                row.values.Add(value);\n                \n                value = new Cell { column = Encoding.UTF8.GetBytes(\"d:lang\"), data = Encoding.UTF8.GetBytes(tweet.Language.ToString()) };\n                row.values.Add(value);\n                \n                if (tweet.Coordinates != null)\n                {\n                    var str = tweet.Coordinates.Longitude.ToString() + \",\" + tweet.Coordinates.Latitude.ToString();\n                    value = new Cell { column = Encoding.UTF8.GetBytes(\"d:coor\"), data = Encoding.UTF8.GetBytes(str) };\n                    row.values.Add(value);\n                }\n\n                value = new Cell { column = Encoding.UTF8.GetBytes(\"d:sentiment\"), data = Encoding.UTF8.GetBytes(sentimentScore.ToString()) };\n                row.values.Add(value);\n\n                set.rows.Add(row);\n            }\n        }\n\n        // Write a Tweet (CellSet) to HBase\n        public void WriterThreadFunction()\n        {\n            try\n            {\n                while (threadRunning)\n                {\n                    if (queue.Count > 0)\n                    {\n                        CellSet set = new CellSet();\n                        lock (queue)\n                        {\n                            do\n                            {\n                                ITweet tweet = queue.Dequeue();\n                                CreateTweetByWordsCells(set, tweet);\n                            } while (queue.Count > 0);\n                        }\n\n                        // Write the Tweet by words cell set to the HBase table\n                        client.StoreCells(HBASETABLENAME, set);\n                        Console.WriteLine(\"\\tRows written: {0}\", set.rows.Count);\n                    }\n                    Thread.Sleep(100);\n                }\n            }\n            catch (Exception ex)\n            {\n                Console.WriteLine(\"Exception: \" + ex.Message);\n            }\n        }\n\n    This code provides the following functionality:\n\n    - **Connect to Hbase [ HBaseWriter() ]**: Use the HBase SDK to create a *ClusterCredentials* object with the cluster URL and the Hadoop user credential, and then create an *HBaseClient* object by using the ClusterCredentials object.\n    - **Create HBase table [ HBaseWriter() ]**: The method call is *HBaseClient.CreateTable()*.\n    - **Write to HBase table [ WriterThreadFunction() ]**: The method call is *HBaseClient.StoreCells()*.\n\n**To complete the Program.cs**\n\n1. From **Solution Explorer**, double-click **Program.cs** to open it.\n2. At the beginning of the file, add the following **using** statements:\n\n        using System.Configuration;\n        using System.Diagnostics;\n        using Tweetinvi;\n\n3. Inside the **Program** class, define the following constants:\n\n        const string TWITTERAPPACCESSTOKEN = \"<TwitterApplicationAccessToken\";\n        const string TWITTERAPPACCESSTOKENSECRET = \"TwitterApplicationAccessTokenSecret\";\n        const string TWITTERAPPAPIKEY = \"TwitterApplicationAPIKey\";\n        const string TWITTERAPPAPISECRET = \"TwitterApplicationAPISecret\";\n\n4. Set the constant values to match your Twitter application values.\n\n3. Modify the **Main()** function, so it looks like this:\n\n        static void Main(string[] args)\n        {\n            TwitterCredentials.SetCredentials(TWITTERAPPACCESSTOKEN, TWITTERAPPACCESSTOKENSECRET, TWITTERAPPAPIKEY, TWITTERAPPAPISECRET);\n\n            Stream_FilteredStreamExample();\n        }\n\n4. Add the following function to the class:\n\n        private static void Stream_FilteredStreamExample()\n        {\n            for (; ; )\n            {\n                try\n                {\n                    HBaseWriter hbase = new HBaseWriter();\n                    var stream = Stream.CreateFilteredStream();\n                    stream.AddLocation(Geo.GenerateLocation(-180, -90, 180, 90));\n\n                    var tweetCount = 0;\n                    var timer = Stopwatch.StartNew();\n\n                    stream.MatchingTweetReceived += (sender, args) =>\n                    {\n                        tweetCount++;\n                        var tweet = args.Tweet;\n\n                        // Write Tweets to HBase\n                        hbase.WriteTweet(tweet);\n\n                        if (timer.ElapsedMilliseconds > 1000)\n                        {\n                            if (tweet.Coordinates != null)\n                            {\n                                Console.ForegroundColor = ConsoleColor.Green;\n                                Console.WriteLine(\"\\n{0}: {1} {2}\", tweet.Id, tweet.Language.ToString(), tweet.Text);\n                                Console.ForegroundColor = ConsoleColor.White;\n                                Console.WriteLine(\"\\tLocation: {0}, {1}\", tweet.Coordinates.Longitude, tweet.Coordinates.Latitude);\n                            }\n\n                            timer.Restart();\n                            Console.WriteLine(\"\\tTweets/sec: {0}\", tweetCount);\n                            tweetCount = 0;\n                        }\n                    };\n\n                    stream.StartStreamMatchingAllConditions();\n                }\n                catch (Exception ex)\n                {\n                    Console.WriteLine(\"Exception: {0}\", ex.Message);\n                }\n            }\n        }\n\n\n\n**To run the streaming service**\n\n1. From Visual Studio, press **F5**. The following is a screenshot of the console application:\n\n    ![hdinsight.hbase.twitter.sentiment.streaming.service][img-streaming-service]\n2. Keep the streaming console application running while you develop the web application, so you have more data to use.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n##<a id=\"web\"></a> Create a website by using Azure Websites to visualize Twitter sentiment\n\nIn this section, you will create an ASP.NET MVC web application to read the real-time sentiment data from HBase and plot the data on Bing maps.\n\n**To create an ASP.NET MVC Web application**\n\n1. Open Visual Studio.\n2. Click **File**, click **New**, and then click **Project**.\n3. Enter the following information:\n\n    - Template category: **Visual C#/Web**\n    - Template: **ASP.NET Web Application**\n    - Name: **TweetSentimentWeb**\n    - Location: **C:\\Tutorials** \n4. Click **OK**.\n5. In **Select a template**, click **MVC**. \n6. In **Microsoft Azure**, click **Manage Subscriptions**.\n7. From **Manage Microsoft Azure Subscriptions**, click **Sign in**.\n8. Enter your Azure credentials. Your Azure subscription information will be shown on the **Accounts** tab.\n9. Click **Close** to close the **Manage Microsoft Azure Subscriptions** window.\n10. From **New ASP.NET Project - TweetSentimentWeb**, click **OK**.\n11. From **Configure Microsoft Azure Site Settings**, select the **Region** that is closest to you. You don't need to specify a database server. \n12. Click **OK**.\n\n**To install NuGet packages**\n\n1. From the **Tools** menu, click **Nuget Package Manager**, and then click **Package Manager Console**. The console panel is opened at the bottom of the page.\n2. Use the following command to install the [HBase .NET SDK](https://www.nuget.org/packages/Microsoft.HBase.Client/) package, which is the client library to access HBase cluster:\n\n        Install-Package Microsoft.HBase.Client \n\n**To add HBaseReader class**\n\n1. From **Solution Explorer**, expand **TweetSentiment**.\n2. Right-click **Models**, click **Add**, and then click **Class**.\n3. In the **Name** field, type **HBaseReader.cs**, and then click **Add**.\n4. Replace the code with the following:\n\n        using System;\n        using System.Collections.Generic;\n        using System.Linq;\n        using System.Web;\n        \n        using System.Configuration;\n        using System.Threading.Tasks;\n        using System.Text;\n        using Microsoft.HBase.Client;\n        using org.apache.hadoop.hbase.rest.protobuf.generated;\n        \n        namespace TweetSentimentWeb.Models\n        {\n            public class HBaseReader\n            {\n                // For reading Tweet sentiment data from HDInsight HBase\n                HBaseClient client;\n        \n                // HDinsight HBase cluster and HBase table information\n                const string CLUSTERNAME = \"<HBaseClusterName>\";\n                const string HADOOPUSERNAME = \"<HBaseClusterHadoopUserName>\"\n                const string HADOOPUSERPASSWORD = \"<HBaseCluserUserPassword>\";\n                const string HBASETABLENAME = \"tweets_by_words\";\n        \n                // The constructor\n                public HBaseReader()\n                {\n                    ClusterCredentials creds = new ClusterCredentials(\n                                    new Uri(CLUSTERNAME),\n                                    HADOOPUSERNAME,\n                                    HADOOPUSERPASSWORD);\n                    client = new HBaseClient(creds);\n                }\n        \n                // Query Tweets sentiment data from the HBase table asynchronously \n                public async Task<IEnumerable<Tweet>> QueryTweetsByKeywordAsync(string keyword)\n                {\n                    List<Tweet> list = new List<Tweet>();\n        \n                    // Demonstrate Filtering the data from the past 6 hours the row key\n                    string timeIndex = (ulong.MaxValue -\n                        (ulong)DateTime.UtcNow.Subtract(new TimeSpan(6, 0, 0)).ToBinary()).ToString().PadLeft(20);\n                    string startRow = keyword + \"_\" + timeIndex;\n                    string endRow = keyword + \"|\";\n                    Scanner scanSettings = new Scanner\n                    {\n                        batch = 100000,\n                        startRow = Encoding.UTF8.GetBytes(startRow),\n                        endRow = Encoding.UTF8.GetBytes(endRow)\n                    };\n        \n                    // Make async scan call\n                    ScannerInformation scannerInfo =\n                        await client.CreateScannerAsync(HBASETABLENAME, scanSettings);\n        \n                    CellSet next;\n        \n                    while ((next = await client.ScannerGetNextAsync(scannerInfo)) != null)\n                    {\n                        foreach (CellSet.Row row in next.rows)\n                        {\n                            // find the cell with string pattern \"d:coor\" \n                            var coordinates =\n                                row.values.Find(c => Encoding.UTF8.GetString(c.column) == \"d:coor\");\n        \n                            if (coordinates != null)\n                            {\n                                string[] lonlat = Encoding.UTF8.GetString(coordinates.data).Split(',');\n        \n                                var sentimentField =\n                                    row.values.Find(c => Encoding.UTF8.GetString(c.column) == \"d:sentiment\");\n                                Int32 sentiment = 0;\n                                if (sentimentField != null)\n                                {\n                                    sentiment = Convert.ToInt32(Encoding.UTF8.GetString(sentimentField.data));\n                                }\n        \n                                list.Add(new Tweet\n                                {\n                                    Longtitude = Convert.ToDouble(lonlat[0]),\n                                    Latitude = Convert.ToDouble(lonlat[1]),\n                                    Sentiment = sentiment\n                                });\n                            }\n        \n                            if (coordinates != null)\n                            {\n                                string[] lonlat = Encoding.UTF8.GetString(coordinates.data).Split(',');\n                            }\n                        }\n                    }\n        \n                    return list;\n                }\n            }\n        \n            public class Tweet\n            {\n                public string IdStr { get; set; }\n                public string Text { get; set; }\n                public string Lang { get; set; }\n                public double Longtitude { get; set; }\n                public double Latitude { get; set; }\n                public int Sentiment { get; set; }\n            }\n        }\n\n4. Inside the **HBaseReader** class, change the constant values as follows:\n\n    - **CLUSTERNAME**: The HBase cluster name, for example, *https://<HBaseClusterName>.azurehdinsight.net/*. \n    - **HADOOPUSERNAME**: The HBase cluster Hadoop user user name. The default name is *admin*.\n    - **HADOOPUSERPASSWORD**: The HBase cluster Hadoop user password.\n    - **HBASETABLENAME** = \"tweets_by_words\";\n\n    The HBase table name is **\"tweets_by_words\";**. The values must match the values you sent in the streaming service, so that the web application reads the data from the same HBase table.\n\n\n\n\n**To add TweetsController controller**\n\n1. From **Solution Explorer**, expand **TweetSentimentWeb**.\n2. Right-click **Controllers**, click **Add**, and then click **Controller**.\n3. Click **Web API 2 Controller - Empty**, and then click **Add**.\n4. In the **Controller name** field, type **TweetsController**, and then click **Add**.\n5. From **Solution Explorer**, double-click TweetsController.cs to open the file.\n5. Modify the file, so it looks like the following:\n\n        using System;\n        using System.Collections.Generic;\n        using System.Linq;\n        using System.Net;\n        using System.Net.Http;\n        using System.Web.Http;\n        \n        using System.Threading.Tasks;\n        using TweetSentimentWeb.Models;\n        \n        namespace TweetSentimentWeb.Controllers\n        {\n            public class TweetsController : ApiController\n            {\n                HBaseReader hbase = new HBaseReader();\n        \n                public async Task<IEnumerable<Tweet>> GetTweetsByQuery(string query)\n                {\n                    return await hbase.QueryTweetsByKeywordAsync(query);\n                }\n            }\n        }\n\n**To add heatmap.js**\n\n1. From **Solution Explorer**, expand **TweetSentimentWeb**.\n2. Right-click **Scripts**, click **Add**, click **JavaScript File**.\n3. In the **Item name** field, type **heatmap.js**.\n4. Paste the following code into the file. The code was written by Alastair Aitchison. For more information, see [Bing Maps AJAX v7 HeatMap Library](http://alastaira.wordpress.com/2011/04/15/bing-maps-ajax-v7-heatmap-library/).\n\n        /*******************************************************************************\n        * Author: Alastair Aitchison\n        * Website: http://alastaira.wordpress.com\n        * Date: 15th April 2011\n        * \n        * Description: \n        * This JavaScript file provides an algorithm that can be used to add a heatmap\n        * overlay on a Bing Maps v7 control. The intensity and temperature palette\n        * of the heatmap are designed to be easily customisable.\n        *\n        * Requirements:\n        * The heatmap layer itself is created dynamically on the client-side using\n        * the HTML5 <canvas> element, and therefore requires a browser that supports\n        * this element. It has been tested on IE9, Firefox 3.6/4 and \n        * Chrome 10 browsers. If you can confirm whether it works on other browsers or\n        * not, I'd love to hear from you!\n        \n        * Usage:\n        * The HeatMapLayer constructor requires:\n        * - A reference to a map object\n        * - An array or Microsoft.Maps.Location items\n        * - Optional parameters to customise the appearance of the layer\n        *  (Radius,, Unit, Intensity, and ColourGradient), and a callback function\n        *\n        */\n        \n        var HeatMapLayer = function (map, locations, options) {\n        \n            /* Private Properties */\n            var _map = map,\n              _canvas,\n              _temperaturemap,\n              _locations = [],\n              _viewchangestarthandler,\n              _viewchangeendhandler;\n        \n            // Set default options\n            var _options = {\n                // Opacity at the centre of each heat point\n                intensity: 0.5,\n        \n                // Affected radius of each heat point\n                radius: 1000,\n        \n                // Whether the radius is an absolute pixel value or meters\n                unit: 'meters',\n        \n                // Colour temperature gradient of the map\n                colourgradient: {\n                    \"0.00\": 'rgba(255,0,255,20)',  // Magenta\n                    \"0.25\": 'rgba(0,0,255,40)',    // Blue\n                    \"0.50\": 'rgba(0,255,0,80)',    // Green\n                    \"0.75\": 'rgba(255,255,0,120)', // Yellow\n                    \"1.00\": 'rgba(255,0,0,150)'    // Red\n                },\n        \n                // Callback function to be fired after heatmap layer has been redrawn \n                callback: null\n            };\n        \n            /* Private Methods */\n            function _init() {\n                var _mapDiv = _map.getRootElement();\n        \n                if (_mapDiv.childNodes.length >= 3 && _mapDiv.childNodes[2].childNodes.length >= 2) {\n                    // Create the canvas element\n                    _canvas = document.createElement('canvas');\n                    _canvas.style.position = 'relative';\n        \n                    var container = document.createElement('div');\n                    container.style.position = 'absolute';\n                    container.style.left = '0px';\n                    container.style.top = '0px';\n                    container.appendChild(_canvas);\n        \n                    _mapDiv.childNodes[2].childNodes[1].appendChild(container);\n        \n                    // Override defaults with any options passed in the constructor\n                    _setOptions(options);\n        \n                    // Load array of location data\n                    _setPoints(locations);\n        \n                    // Create a colour gradient from the suppied colourstops\n                    _temperaturemap = _createColourGradient(_options.colourgradient);\n        \n                    // Wire up the event handler to redraw heatmap canvas\n                    _viewchangestarthandler = Microsoft.Maps.Events.addHandler(_map, 'viewchangestart', _clearHeatMap);\n                    _viewchangeendhandler = Microsoft.Maps.Events.addHandler(_map, 'viewchangeend', _createHeatMap);\n        \n                    _createHeatMap();\n        \n                    delete _init;\n                } else {\n                    setTimeout(_init, 100);\n                }\n            }\n        \n            // Resets the heat map\n            function _clearHeatMap() {\n                var ctx = _canvas.getContext(\"2d\");\n                ctx.clearRect(0, 0, _canvas.width, _canvas.height);\n            }\n        \n            // Creates a colour gradient from supplied colour stops on initialisation\n            function _createColourGradient(colourstops) {\n                var ctx = document.createElement('canvas').getContext('2d');\n                var grd = ctx.createLinearGradient(0, 0, 256, 0);\n                for (var c in colourstops) {\n                    grd.addColorStop(c, colourstops[c]);\n                }\n                ctx.fillStyle = grd;\n                ctx.fillRect(0, 0, 256, 1);\n                return ctx.getImageData(0, 0, 256, 1).data;\n            }\n        \n            // Applies a colour gradient to the intensity map\n            function _colouriseHeatMap() {\n                var ctx = _canvas.getContext(\"2d\");\n                var dat = ctx.getImageData(0, 0, _canvas.width, _canvas.height);\n                var pix = dat.data; // pix is a CanvasPixelArray containing height x width x 4 bytes of data (RGBA)\n                for (var p = 0, len = pix.length; p < len;) {\n                    var a = pix[p + 3] * 4; // get the alpha of this pixel\n                    if (a != 0) { // If there is any data to plot\n                        pix[p] = _temperaturemap[a]; // set the red value of the gradient that corresponds to this alpha\n                        pix[p + 1] = _temperaturemap[a + 1]; //set the green value based on alpha\n                        pix[p + 2] = _temperaturemap[a + 2]; //set the blue value based on alpha\n                    }\n                    p += 4; // Move on to the next pixel\n                }\n                ctx.putImageData(dat, 0, 0);\n            }\n        \n            // Sets any options passed in\n            function _setOptions(options) {\n                for (attrname in options) {\n                    _options[attrname] = options[attrname];\n                }\n            }\n        \n            // Sets the heatmap points from an array of Microsoft.Maps.Locations  \n            function _setPoints(locations) {\n                _locations = locations;\n            }\n        \n            // Main method to draw the heatmap\n            function _createHeatMap() {\n                // Ensure the canvas matches the current dimensions of the map\n                // This also has the effect of resetting the canvas\n                _canvas.height = _map.getHeight();\n                _canvas.width = _map.getWidth();\n        \n                _canvas.style.top = -_canvas.height / 2 + 'px';\n                _canvas.style.left = -_canvas.width / 2 + 'px';\n        \n                // Calculate the pixel radius of each heatpoint at the current map zoom\n                if (_options.unit == \"pixels\") {\n                    radiusInPixel = _options.radius;\n                } else {\n                    radiusInPixel = _options.radius / _map.getMetersPerPixel();\n                }\n        \n                var ctx = _canvas.getContext(\"2d\");\n        \n                // Convert lat/long to pixel location\n                var pixlocs = _map.tryLocationToPixel(_locations, Microsoft.Maps.PixelReference.control);\n                var shadow = 'rgba(0, 0, 0, ' + _options.intensity + ')';\n                var mapWidth = 256 * Math.pow(2, _map.getZoom());\n        \n                // Create the Intensity Map by looping through each location\n                for (var i = 0, len = pixlocs.length; i < len; i++) {\n                    var x = pixlocs[i].x;\n                    var y = pixlocs[i].y;\n        \n                    if (x < 0) {\n                        x += mapWidth * Math.ceil(Math.abs(x / mapWidth));\n                    }\n        \n                    // Create radial gradient centred on this point\n                    var grd = ctx.createRadialGradient(x, y, 0, x, y, radiusInPixel);\n                    grd.addColorStop(0.0, shadow);\n                    grd.addColorStop(1.0, 'transparent');\n        \n                    // Draw the heatpoint onto the canvas\n                    ctx.fillStyle = grd;\n                    ctx.fillRect(x - radiusInPixel, y - radiusInPixel, 2 * radiusInPixel, 2 * radiusInPixel);\n                }\n        \n                // Apply the specified colour gradient to the intensity map\n                _colouriseHeatMap();\n        \n                // Call the callback function, if specified\n                if (_options.callback) {\n                    _options.callback();\n                }\n            }\n        \n            /* Public Methods */\n        \n            this.Show = function () {\n                if (_canvas) {\n                    _canvas.style.display = '';\n                }\n            };\n        \n            this.Hide = function () {\n                if (_canvas) {\n                    _canvas.style.display = 'none';\n                }\n            };\n        \n            // Sets options for intensity, radius, colourgradient etc.\n            this.SetOptions = function (options) {\n                _setOptions(options);\n            }\n        \n            // Sets an array of Microsoft.Maps.Locations from which the heatmap is created\n            this.SetPoints = function (locations) {\n                // Reset the existing heatmap layer\n                _clearHeatMap();\n                // Pass in the new set of locations\n                _setPoints(locations);\n                // Recreate the layer\n                _createHeatMap();\n            }\n        \n            // Removes the heatmap layer from the DOM\n            this.Remove = function () {\n                _canvas.parentNode.parentNode.removeChild(_canvas.parentNode);\n        \n                if (_viewchangestarthandler) { Microsoft.Maps.Events.removeHandler(_viewchangestarthandler); }\n                if (_viewchangeendhandler) { Microsoft.Maps.Events.removeHandler(_viewchangeendhandler); }\n        \n                _locations = null;\n                _temperaturemap = null;\n                _canvas = null;\n                _options = null;\n                _viewchangestarthandler = null;\n                _viewchangeendhandler = null;\n            }\n        \n            // Call the initialisation routine\n            _init();\n        };\n        \n        // Call the Module Loaded method\n        Microsoft.Maps.moduleLoaded('HeatMapModule');\n\n\n**To add twitterStream.js**\n\n1. From **Solution Explorer**, expand **TweetSentimentWeb**.\n2. Right-click **Scripts**, click **Add**, click **JavaScript File**.\n3. In the **Item name** field, type**twitterStream.js**.\n4. Copy and paste the following code into the file:\n\n        var liveTweetsPos = [];\n        var liveTweets = [];\n        var liveTweetsNeg = [];\n        var map;\n        var heatmap;\n        var heatmapNeg;\n        var heatmapPos;\n        \n        function initialize() {\n            // Initialize the map\n            var options = {\n                credentials: \"AvFJTZPZv8l3gF8VC3Y7BPBd0r7LKo8dqKG02EAlqg9WAi0M7la6zSIT-HwkMQbx\",\n                center: new Microsoft.Maps.Location(23.0, 8.0),\n                mapTypeId: Microsoft.Maps.MapTypeId.ordnanceSurvey,\n                labelOverlay: Microsoft.Maps.LabelOverlay.hidden,\n                zoom: 2.5\n            };\n            var map = new Microsoft.Maps.Map(document.getElementById('map_canvas'), options);\n        \n            // Heatmap options for positive, neutral and negative layers\n        \n            var heatmapOptions = {\n                // Opacity at the centre of each heat point\n                intensity: 0.5,\n        \n                // Affected radius of each heat point\n                radius: 15,\n        \n                // Whether the radius is an absolute pixel value or meters\n                unit: 'pixels'\n            };\n        \n            var heatmapPosOptions = {\n                // Opacity at the centre of each heat point\n                intensity: 0.5,\n        \n                // Affected radius of each heat point\n                radius: 15,\n        \n                // Whether the radius is an absolute pixel value or meters\n                unit: 'pixels',\n        \n                colourgradient: {\n                    0.0: 'rgba(0, 255, 255, 0)',\n                    0.1: 'rgba(0, 255, 255, 1)',\n                    0.2: 'rgba(0, 255, 191, 1)',\n                    0.3: 'rgba(0, 255, 127, 1)',\n                    0.4: 'rgba(0, 255, 63, 1)',\n                    0.5: 'rgba(0, 127, 0, 1)',\n                    0.7: 'rgba(0, 159, 0, 1)',\n                    0.8: 'rgba(0, 191, 0, 1)',\n                    0.9: 'rgba(0, 223, 0, 1)',\n                    1.0: 'rgba(0, 255, 0, 1)'\n                }\n            };\n        \n            var heatmapNegOptions = {\n                // Opacity at the centre of each heat point\n                intensity: 0.5,\n        \n                // Affected radius of each heat point\n                radius: 15,\n        \n                // Whether the radius is an absolute pixel value or meters\n                unit: 'pixels',\n        \n                colourgradient: {\n                    0.0: 'rgba(0, 255, 255, 0)',\n                    0.1: 'rgba(0, 255, 255, 1)',\n                    0.2: 'rgba(0, 191, 255, 1)',\n                    0.3: 'rgba(0, 127, 255, 1)',\n                    0.4: 'rgba(0, 63, 255, 1)',\n                    0.5: 'rgba(0, 0, 127, 1)',\n                    0.7: 'rgba(0, 0, 159, 1)',\n                    0.8: 'rgba(0, 0, 191, 1)',\n                    0.9: 'rgba(0, 0, 223, 1)',\n                    1.0: 'rgba(0, 0, 255, 1)'\n                }\n            };\n        \n            // Register and load the Client Side HeatMap Module\n            Microsoft.Maps.registerModule(\"HeatMapModule\", \"scripts/heatmap.js\");\n            Microsoft.Maps.loadModule(\"HeatMapModule\", {\n                callback: function () {\n                    // Create heatmap layers for positive, neutral and negative tweets\n                    heatmapPos = new HeatMapLayer(map, liveTweetsPos, heatmapPosOptions);\n                    heatmap = new HeatMapLayer(map, liveTweets, heatmapOptions);\n                    heatmapNeg = new HeatMapLayer(map, liveTweetsNeg, heatmapNegOptions);\n                }\n            });\n        \n            $(\"#searchbox\").val(\"xbox\");\n            $(\"#searchBtn\").click(onsearch);\n            $(\"#positiveBtn\").click(onPositiveBtn);\n            $(\"#negativeBtn\").click(onNegativeBtn);\n            $(\"#neutralBtn\").click(onNeutralBtn);\n            $(\"#neutralBtn\").button(\"toggle\");\n        }\n        \n        function onsearch() {\n            var uri = 'api/tweets?query=';\n            var query = $('#searchbox').val();\n            $.getJSON(uri + query)\n                .done(function (data) {\n                    liveTweetsPos = [];\n                    liveTweets = [];\n                    liveTweetsNeg = [];\n        \n                    // On success, 'data' contains a list of tweets.\n                    $.each(data, function (key, item) {\n                        addTweet(item);\n                    });\n        \n                    if (!$(\"#neutralBtn\").hasClass('active')) {\n                        $(\"#neutralBtn\").button(\"toggle\");\n                    }\n                    onNeutralBtn();\n                })\n                .fail(function (jqXHR, textStatus, err) {\n                    $('#statustext').text('Error: ' + err);\n                });\n        }\n        \n        function addTweet(item) {\n            //Add tweet to the heat map arrays.\n            var tweetLocation = new Microsoft.Maps.Location(item.Latitude, item.Longtitude);\n            if (item.Sentiment > 0) {\n                liveTweetsPos.push(tweetLocation);\n            } else if (item.Sentiment < 0) {\n                liveTweetsNeg.push(tweetLocation);\n            } else {\n                liveTweets.push(tweetLocation);\n            }\n        }\n        \n        function onPositiveBtn() {\n            if ($(\"#neutralBtn\").hasClass('active')) {\n                $(\"#neutralBtn\").button(\"toggle\");\n            }\n            if ($(\"#negativeBtn\").hasClass('active')) {\n                $(\"#negativeBtn\").button(\"toggle\");\n            }\n        \n            heatmapPos.SetPoints(liveTweetsPos);\n            heatmapPos.Show();\n            heatmapNeg.Hide();\n            heatmap.Hide();\n        \n            $('#statustext').text('Tweets: ' + liveTweetsPos.length + \"   \" + getPosNegRatio());\n        }\n        \n        function onNeutralBtn() {\n            if ($(\"#positiveBtn\").hasClass('active')) {\n                $(\"#positiveBtn\").button(\"toggle\");\n            }\n            if ($(\"#negativeBtn\").hasClass('active')) {\n                $(\"#negativeBtn\").button(\"toggle\");\n            }\n        \n            heatmap.SetPoints(liveTweets);\n            heatmap.Show();\n            heatmapNeg.Hide();\n            heatmapPos.Hide();\n        \n            $('#statustext').text('Tweets: ' + liveTweets.length + \"   \" + getPosNegRatio());\n        }\n        \n        function onNegativeBtn() {\n            if ($(\"#positiveBtn\").hasClass('active')) {\n                $(\"#positiveBtn\").button(\"toggle\");\n            }\n            if ($(\"#neutralBtn\").hasClass('active')) {\n                $(\"#neutralBtn\").button(\"toggle\");\n            }\n        \n            heatmapNeg.SetPoints(liveTweetsNeg);\n            heatmapNeg.Show();\n            heatmap.Hide();;\n            heatmapPos.Hide();;\n        \n            $('#statustext').text('Tweets: ' + liveTweetsNeg.length + \"\\t\" + getPosNegRatio());\n        }\n        \n        function getPosNegRatio() {\n            if (liveTweetsNeg.length == 0) {\n                return \"\";\n            }\n            else {\n                var ratio = liveTweetsPos.length / liveTweetsNeg.length;\n                var str = parseFloat(Math.round(ratio * 10) / 10).toFixed(1);\n                return \"Positive/Negative Ratio: \" + str;\n            }\n        }\n\n\n**To modify the layout.cshtml**\n\n1. From **Solution Explorer**, expand **TweetSentimentWeb**, expand **Views**, expand **Shared**, and then double-click _**Layout.cshtml**.\n2. Replace the content with the following:\n\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset=\"utf-8\" />\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>@ViewBag.Title</title>\n            @Styles.Render(\"~/Content/css\")\n            @Scripts.Render(\"~/bundles/modernizr\")\n            <!-- Bing Maps -->\n            <script type=\"text/javascript\" src=\"http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0&mkt=en-gb\"></script>\n            <!-- Spatial Dashboard JavaScript -->\n            <script src=\"~/Scripts/twitterStream.js\" type=\"text/javascript\"></script>\n        </head>\n        <body onload=\"initialize()\">\n            <div class=\"navbar navbar-inverse navbar-fixed-top\">\n                <div class=\"container\">\n                    <div class=\"navbar-header\">\n                        <button type=\"button\" class=\"navbar-toggle\" data-toggle=\"collapse\" data-target=\".navbar-collapse\">\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                            <span class=\"icon-bar\"></span>\n                        </button>\n                    </div>\n                    <div class=\"navbar-collapse collapse\">\n                        <div class=\"row\">\n                            <ul class=\"nav navbar-nav col-lg-5\">\n                                <li class=\"col-lg-12\">\n                                    <div class=\"navbar-form\">\n                                        <input id=\"searchbox\" type=\"search\" class=\"form-control\">\n                                        <button type=\"button\" id=\"searchBtn\" class=\"btn btn-primary\">Go</button>\n                                    </div>\n                                </li>\n                            </ul>\n                            <ul class=\"nav navbar-nav col-lg-7\">\n                                <li>\n                                    <div class=\"navbar-form\">\n                                        <div class=\"btn-group\" data-toggle=\"buttons-radio\">\n                                            <button type=\"button\" id=\"positiveBtn\" class=\"btn btn-primary\">Positive</button>\n                                            <button type=\"button\" id=\"neutralBtn\" class=\"btn btn-primary\">Neutral</button>\n                                            <button type=\"button\" id=\"negativeBtn\" class=\"btn btn-primary\">Negative</button>\n                                        </div>\n                                    </div>\n                                </li>\n                                <li><span id=\"statustext\" class=\"navbar-text\"></span></li>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"map_container\">\n                @RenderBody()\n            </div>\n            @Scripts.Render(\"~/bundles/jquery\")\n            @Scripts.Render(\"~/bundles/bootstrap\")\n            @RenderSection(\"scripts\", required: false)\n        </body>\n        </html>\n\n\n\n**To modify the Index.cshtml**\n\n1. From **Solution Explorer**, expand **TweetSentimentWeb**, expand **Views**, expand **Home**, and then double-click **Index.cshtml**.\n2. Replace the content with the following:\n\n        @{\n            ViewBag.Title = \"Tweet Sentiment\";\n        }\n        \n        <div class=\"map_container\">\n            <div id=\"map_canvas\"/>\n        </div>\n\n**To modify the site.css file**\n\n1. From **Solution Explorer**, expand **TweetSentimentWeb**, expand **Content**, and then double-click **Site.css**.\n2. Append the following code to the file:\n        \n        /* make container, and thus map, 100% width */\n        .map_container {\n            width: 100%;\n            height: 100%;\n        }\n        \n        #map_canvas{\n          height:100%;\n        }\n        \n        #tweets{\n          position: absolute;\n          top: 60px;\n          left: 75px;\n          z-index:1000;\n          font-size: 30px;\n        }\n\n**To modify the global.asax file**\n\n1. From **Solution Explorer**, expand **TweetSentimentWeb**, and then double-click **Global.asax**.\n2. Add the following **using** statement:\n\n        using System.Web.Http;\n\n2. Add the following lines inside the **Application_Start()** function:\n\n        // Register API routes\n        GlobalConfiguration.Configure(WebApiConfig.Register);\n  \n    Modify the registration of the API routes to make the Web API controller work inside the MVC application.\n\n**To run the web application**\n\n1. Verify that the streaming service console application is still running so you can see the real-time changes.\n2. Press **F5** to run the web application:\n\n    ![hdinsight.hbase.twitter.sentiment.bing.map][img-bing-map]\n2. In the text box, enter a keyword, and then click **Go**.  Depending on the data collected in the HBase table, some keywords might not be found. Try some common keywords, such as \"love,\" \"xbox,\" and \"playstation.\" \n3. Toggle among **Positive**, **Neutral**, and **Negative** to compare sentiment on the subject.\n4. Let the streaming service run for another hour, and then search the same keywords, and compare the results.\n\n \nOptionally, you can deploy the application to Azure Websites. For instructions, see [Get started with Azure Websites and ASP.NET][website-get-started].\n \n##<a id=\"nextsteps\"></a>Next Steps\n\nIn this tutorial, you learned how to get tweets, analyze the sentiment of tweets, save the sentiment data to HBase, and present the real-time Twitter sentiment data to Bing maps. To learn more, see:\n\n- [Get started with HDInsight][hdinsight-get-started]\n- [Configure HBase replication in HDInsight](hdinsight-hbase-geo-replication.md) \n- [Analyze Twitter data with Hadoop in HDInsight][hdinsight-analyze-twitter-data]\n- [Analyze flight delay data using HDInsight][hdinsight-analyze-flight-delay-data]\n- [Develop C# Hadoop streaming programs for HDInsight][hdinsight-develop-streaming]\n- [Develop Java MapReduce programs for HDInsight][hdinsight-develop-mapreduce]\n\n\n[hbase-get-started]: ../hdinsight-hbase-get-started.md\n[website-get-started]: ../web-sites-dotnet-get-started.md\n\n\n\n[img-app-arch]: ./media/hdinsight-hbase-analyze-twitter-sentiment/AppArchitecture.png\n[img-twitter-app]: ./media/hdinsight-hbase-analyze-twitter-sentiment/TwitterApp.png\n[img-streaming-service]: ./media/hdinsight-hbase-analyze-twitter-sentiment/StreamingService.png\n[img-bing-map]: ./media/hdinsight-hbase-analyze-twitter-sentiment/TwitterSentimentBingMap.png\n\n\n\n[hdinsight-develop-streaming]: hdinsight-hadoop-develop-deploy-streaming-jobs.md\n[hdinsight-develop-mapreduce]: hdinsight-develop-deploy-java-mapreduce.md\n[hdinsight-analyze-twitter-data]: hdinsight-analyze-twitter-data.md\n[hdinsight-hbase-get-started]: ../hdinsight-hbase-get-started.md\n\n\n\n\n[curl]: http://curl.haxx.se\n[curl-download]: http://curl.haxx.se/download.html\n\n[apache-hive-tutorial]: https://cwiki.apache.org/confluence/display/Hive/Tutorial\n\n[twitter-streaming-api]: https://dev.twitter.com/docs/streaming-apis\n[twitter-statuses-filter]: https://dev.twitter.com/docs/api/1.1/post/statuses/filter\n\n[powershell-start]: http://technet.microsoft.com/library/hh847889.aspx\n[powershell-install]: ../install-configure-powershell.md\n[powershell-script]: http://technet.microsoft.com/library/ee176949.aspx\n\n[hdinsight-provision]: hdinsight-provision-clusters.md\n[hdinsight-get-started]: ../hdinsight-get-started.md\n[hdinsight-storage-powershell]: ../hdinsight-use-blob-storage.md#powershell\n[hdinsight-analyze-flight-delay-data]: hdinsight-analyze-flight-delay-data.md\n[hdinsight-storage]: ../hdinsight-use-blob-storage.md\n[hdinsight-use-sqoop]: hdinsight-use-sqoop.md\n[hdinsight-power-query]: hdinsight-connect-excel-power-query.md\n[hdinsight-hive-odbc]: hdinsight-connect-excel-hive-ODBC-driver.md\n \ntest\n"
}