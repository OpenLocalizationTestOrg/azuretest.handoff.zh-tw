{
  "nodes": [
    {
      "content": "Install and use Giraph on Hadoop clusters in HDInsight | Microsoft Azure",
      "pos": [
        28,
        100
      ]
    },
    {
      "content": "Learn how to customize HDInsight cluster with Giraph.",
      "pos": [
        120,
        173
      ]
    },
    {
      "content": "You'll use a Script Action configuration option to use a script to install Giraph.",
      "pos": [
        174,
        256
      ]
    },
    {
      "content": "Install Giraph on HDInsight Hadoop clusters, and use Giraph to process large-scale graphs",
      "pos": [
        572,
        661
      ]
    },
    {
      "content": "You can install Giraph on any type of cluster in Hadoop on Azure HDInsight by using <bpt id=\"p1\">**</bpt>Script Action<ept id=\"p1\">**</ept> cluster customization.",
      "pos": [
        663,
        787
      ]
    },
    {
      "content": "Script Action lets you run scripts to customize a cluster, only when the cluster is being created.",
      "pos": [
        788,
        886
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Customize HDInsight clusters using Script Action<ept id=\"p1\">][hdinsight-cluster-customize]</ept>.",
      "pos": [
        887,
        993
      ]
    },
    {
      "content": "In this topic, you will learn how to install Giraph by using Script Action.",
      "pos": [
        995,
        1070
      ]
    },
    {
      "content": "Once you have installed Giraph, you'll also learn how to use Giraph for most typical applications, which is to process large-scale graphs.",
      "pos": [
        1071,
        1209
      ]
    },
    {
      "content": "Install Giraph on HDInsight clusters",
      "pos": [
        1298,
        1334
      ]
    },
    {
      "pos": [
        1376,
        1412
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"whatis\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>What is Giraph?"
    },
    {
      "content": "<ph id=\"ph1\">&lt;a href=\"http://giraph.apache.org/\" target=\"_blank\"&gt;</ph>Apache Giraph<ph id=\"ph2\">&lt;/a&gt;</ph> allows you to perform graph processing by using Hadoop, and can be used with Azure HDInsight.",
      "pos": [
        1414,
        1577
      ]
    },
    {
      "content": "Graphs model relationships between objects, such as the connections between routers on a large network like the Internet, or relationships between people on social networks (sometimes referred to as a social graph).",
      "pos": [
        1578,
        1793
      ]
    },
    {
      "content": "Graph processing allows you to reason about the relationships between objects in a graph, such as:",
      "pos": [
        1794,
        1892
      ]
    },
    {
      "content": "Identifying potential friends based on your current relationships.",
      "pos": [
        1896,
        1962
      ]
    },
    {
      "content": "Identifying the shortest route between two computers in a network.",
      "pos": [
        1965,
        2031
      ]
    },
    {
      "content": "Calculating the page rank of webpages.",
      "pos": [
        2034,
        2072
      ]
    },
    {
      "pos": [
        2081,
        2127
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"install\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How do I install Giraph?"
    },
    {
      "content": "A sample script to install Giraph on an HDInsight cluster is available from a read-only Azure storage blob at <bpt id=\"p1\">[</bpt>https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1<ept id=\"p1\">](https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1)</ept>.",
      "pos": [
        2129,
        2430
      ]
    },
    {
      "content": "This section provides instructions on how to use the sample script while provisioning the cluster by using the Azure portal.",
      "pos": [
        2431,
        2555
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The sample script works only with HDInsight cluster version 3.1.",
      "pos": [
        2560,
        2637
      ]
    },
    {
      "content": "For more information on HDInsight cluster versions, see <bpt id=\"p1\">[</bpt>HDInsight cluster versions<ept id=\"p1\">](hdinsight-component-versioning.md)</ept>.",
      "pos": [
        2638,
        2758
      ]
    },
    {
      "pos": [
        2763,
        2933
      ],
      "content": "Start provisioning a cluster by using the <bpt id=\"p1\">**</bpt>CUSTOM CREATE<ept id=\"p1\">**</ept> option, as described at <bpt id=\"p2\">[</bpt>Provisioning a cluster using custom options<ept id=\"p2\">](hdinsight-provision-clusters.md#portal)</ept>."
    },
    {
      "pos": [
        2938,
        3071
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Script Actions<ept id=\"p1\">**</ept> page of the wizard, click <bpt id=\"p2\">**</bpt>add script action<ept id=\"p2\">**</ept> to provide details about the script action, as shown below:"
    },
    {
      "content": "Use Script Action to customize a cluster",
      "pos": [
        3079,
        3119
      ]
    },
    {
      "pos": [
        3246,
        4119
      ],
      "content": "<table border='1'>\n     <tr><th>Property</th><th>Value</th></tr>\n     <tr><td>Name</td>\n         <td>Specify a name for the script action. For example, <b>Install Giraph</b>.</td></tr>\n     <tr><td>Script URI</td>\n         <td>Specify the Uniform Resource Identifier (URI) to the script that is invoked to customize the cluster. For example, <i>https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1</i></td></tr>\n     <tr><td>Node Type</td>\n         <td>Specify the nodes on which the customization script is run. You can choose <b>All nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes only</b>.\n     <tr><td>Parameters</td>\n         <td>Specify the parameters, if required by the script. The script to install Giraph does not require any parameters, so you can leave this blank.</td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Property",
          "pos": [
            32,
            40
          ]
        },
        {
          "content": "Value",
          "pos": [
            49,
            54
          ]
        },
        {
          "content": "Name",
          "pos": [
            78,
            82
          ]
        },
        {
          "content": "Specify a name for the script action. For example, <b>Install Giraph</b>.",
          "pos": [
            101,
            174
          ],
          "nodes": [
            {
              "content": "Specify a name for the script action.",
              "pos": [
                0,
                37
              ]
            },
            {
              "content": "For example, <ph id=\"ph1\">&lt;b&gt;</ph>Install Giraph<ph id=\"ph2\">&lt;/b&gt;</ph>.",
              "pos": [
                38,
                73
              ]
            }
          ]
        },
        {
          "content": "Script URI",
          "pos": [
            198,
            208
          ]
        },
        {
          "content": "Specify the Uniform Resource Identifier (URI) to the script that is invoked to customize the cluster. For example, <i>https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1</i>",
          "pos": [
            227,
            442
          ],
          "nodes": [
            {
              "content": "Specify the Uniform Resource Identifier (URI) to the script that is invoked to customize the cluster.",
              "pos": [
                0,
                101
              ]
            },
            {
              "content": "For example, <ph id=\"ph1\">&lt;i&gt;</ph>https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1<ph id=\"ph2\">&lt;/i&gt;</ph>",
              "pos": [
                102,
                215
              ]
            }
          ]
        },
        {
          "content": "Node Type",
          "pos": [
            466,
            475
          ]
        },
        {
          "content": "Specify the nodes on which the customization script is run. You can choose <b>All nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes only</b>.",
          "pos": [
            494,
            639
          ],
          "nodes": [
            {
              "content": "Specify the nodes on which the customization script is run.",
              "pos": [
                0,
                59
              ]
            },
            {
              "content": "You can choose <ph id=\"ph1\">&lt;b&gt;</ph>All nodes<ph id=\"ph2\">&lt;/b&gt;</ph>, <ph id=\"ph3\">&lt;b&gt;</ph>Head nodes only<ph id=\"ph4\">&lt;/b&gt;</ph>, or <ph id=\"ph5\">&lt;b&gt;</ph>Worker nodes only<ph id=\"ph6\">&lt;/b&gt;</ph>.",
              "pos": [
                60,
                145
              ]
            }
          ]
        },
        {
          "content": "Parameters",
          "pos": [
            653,
            663
          ]
        },
        {
          "content": "Specify the parameters, if required by the script. The script to install Giraph does not require any parameters, so you can leave this blank.",
          "pos": [
            682,
            823
          ],
          "nodes": [
            {
              "content": "Specify the parameters, if required by the script.",
              "pos": [
                0,
                50
              ]
            },
            {
              "content": "The script to install Giraph does not require any parameters, so you can leave this blank.",
              "pos": [
                51,
                141
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "You can add more than one script action to install multiple components on the cluster.",
      "pos": [
        4129,
        4215
      ]
    },
    {
      "content": "After you have added the scripts, click the checkmark to start provisioning the cluster.",
      "pos": [
        4216,
        4304
      ]
    },
    {
      "content": "You can also use the script to install Giraph on HDInsight by using Azure PowerShell or the HDInsight .NET SDK.",
      "pos": [
        4306,
        4417
      ]
    },
    {
      "content": "Instructions for these procedures are provided later in this topic.",
      "pos": [
        4418,
        4485
      ]
    },
    {
      "pos": [
        4490,
        4547
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"usegiraph\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How do I use Giraph in HDInsight?"
    },
    {
      "content": "We use the SimpleShortestPathsComputation example to demonstrate the basic <ph id=\"ph1\">&lt;a href = \"http://people.apache.org/~edwardyoon/documents/pregel.pdf\"&gt;</ph>Pregel<ph id=\"ph2\">&lt;/a&gt;</ph> implementation for finding the shortest path between objects in a graph.",
      "pos": [
        4549,
        4777
      ]
    },
    {
      "content": "Use the following steps to upload the sample data and the sample jar, run a job by using the SimpleShortestPathsComputation example, and then view the results.",
      "pos": [
        4778,
        4937
      ]
    },
    {
      "content": "Upload a sample data file to Azure Blob storage.",
      "pos": [
        4942,
        4990
      ]
    },
    {
      "content": "On your local workstation, create a new file named <bpt id=\"p1\">**</bpt>tiny_graph.txt<ept id=\"p1\">**</ept>.",
      "pos": [
        4991,
        5061
      ]
    },
    {
      "content": "It should contain the following lines:",
      "pos": [
        5062,
        5100
      ]
    },
    {
      "content": "Upload the tiny_graph.txt file to the primary storage for your HDInsight cluster.",
      "pos": [
        5259,
        5340
      ]
    },
    {
      "content": "For instructions on how to upload data, see <bpt id=\"p1\">[</bpt>Upload data for Hadoop jobs in HDInsight<ept id=\"p1\">](hdinsight-upload-data.md)</ept>.",
      "pos": [
        5341,
        5454
      ]
    },
    {
      "content": "This data describes a relationship between objects in a directed graph, by using the format [source\\_id, source\\_value,[[dest\\_id], [edge\\_value],...]].",
      "pos": [
        5460,
        5612
      ]
    },
    {
      "content": "Each line represents a relationship between a <bpt id=\"p1\">**</bpt>source\\_id<ept id=\"p1\">**</ept> object and one or more <bpt id=\"p2\">**</bpt>dest\\_id<ept id=\"p2\">**</ept> objects.",
      "pos": [
        5613,
        5718
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>edge\\_value<ept id=\"p1\">**</ept> (or weight) can be thought of as the strength or distance of the connection between <bpt id=\"p2\">**</bpt>source_id<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>dest\\_id<ept id=\"p3\">**</ept>.",
      "pos": [
        5719,
        5854
      ]
    },
    {
      "content": "Drawn out, and using the value (or weight) as the distance between objects, the above data might look like this:",
      "pos": [
        5860,
        5972
      ]
    },
    {
      "content": "tiny_graph.txt drawn as circles with lines of varying distance between",
      "pos": [
        5980,
        6050
      ]
    },
    {
      "content": "Run the SimpleShortestPathsComputation example.",
      "pos": [
        6123,
        6170
      ]
    },
    {
      "content": "Use the following Azure PowerShell cmdlets to run the example by using the tiny_graph.txt file as input.",
      "pos": [
        6171,
        6275
      ]
    },
    {
      "content": "This requires that you have installed and configured <bpt id=\"p1\">[</bpt>Azure PowerShell<ept id=\"p1\">][powershell-install]</ept>.",
      "pos": [
        6276,
        6368
      ]
    },
    {
      "pos": [
        7856,
        7968
      ],
      "content": "In the above example, replace <bpt id=\"p1\">**</bpt>clustername<ept id=\"p1\">**</ept> with the name of your HDInsight cluster that has Giraph installed."
    },
    {
      "content": "View the results.",
      "pos": [
        7973,
        7990
      ]
    },
    {
      "content": "Once the job has finished, the results will be stored in two output files in the <bpt id=\"p1\">__</bpt>wasb:///example/out/shotestpaths<ept id=\"p1\">__</ept> folder.",
      "pos": [
        7991,
        8116
      ]
    },
    {
      "content": "The files are called <bpt id=\"p1\">__</bpt>part-m-00001<ept id=\"p1\">__</ept> and <bpt id=\"p2\">__</bpt>part-m-00002<ept id=\"p2\">__</ept>.",
      "pos": [
        8117,
        8176
      ]
    },
    {
      "content": "Perform the following steps to download and view the output:",
      "pos": [
        8177,
        8237
      ]
    },
    {
      "pos": [
        9202,
        9373
      ],
      "content": "This will create the <bpt id=\"p1\">__</bpt>example/output/shortestpaths<ept id=\"p1\">__</ept> directory structure in the current directory on your workstation, and download the two output files to that location."
    },
    {
      "pos": [
        9379,
        9439
      ],
      "content": "Use the <bpt id=\"p1\">__</bpt>Cat<ept id=\"p1\">__</ept> cmdlet to display the contents of the files:"
    },
    {
      "content": "The output should appear similar to the following:",
      "pos": [
        9494,
        9544
      ]
    },
    {
      "pos": [
        10373,
        10464
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"usingPS\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Install Giraph on HDInsight Hadoop clusters by using Azure PowerShell"
    },
    {
      "content": "In this section, we use the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&lt;a href = \"http://msdn.microsoft.com/library/dn858088.aspx\" target=\"_blank\"&gt;</ph>Add-AzureHDInsightScriptAction<ph id=\"ph2\">&lt;/a&gt;</ph><ept id=\"p1\">**</ept> cmdlet to invoke scripts by using Script Action to customize a cluster.",
      "pos": [
        10466,
        10680
      ]
    },
    {
      "content": "Before proceeding, make sure you have installed and configured Azure PowerShell.",
      "pos": [
        10681,
        10761
      ]
    },
    {
      "content": "For information on configuring a workstation to run Azure Powershell cmdlets for HDInsight, see <bpt id=\"p1\">[</bpt>Install and configure Azure PowerShell<ept id=\"p1\">][powershell-install]</ept>.",
      "pos": [
        10762,
        10919
      ]
    },
    {
      "content": "Perform the following steps:",
      "pos": [
        10921,
        10949
      ]
    },
    {
      "content": "Open an Azure PowerShell window and declare the following variables:",
      "pos": [
        10954,
        11022
      ]
    },
    {
      "content": "Specify the configuration values, such as nodes in the cluster and the default storage to be used:",
      "pos": [
        11812,
        11910
      ]
    },
    {
      "content": "Use the <bpt id=\"p1\">**</bpt>Add-AzureHDInsightScriptAction<ept id=\"p1\">**</ept> cmdlet to add a script action to the cluster configuration.",
      "pos": [
        12349,
        12451
      ]
    },
    {
      "content": "Later, when the cluster is being created, the script action gets executed.",
      "pos": [
        12452,
        12526
      ]
    },
    {
      "pos": [
        12812,
        12889
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Add-AzureHDInsightScriptAction<ept id=\"p1\">**</ept> cmdlet takes the following parameters:"
    },
    {
      "pos": [
        12895,
        15289
      ],
      "content": "<table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n <tr>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Parameter</th>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:550px; padding-left:5px; padding-right:5px;\">Definition</th></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Config</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Configuration object to which script action information is added.</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name of the script action.</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">ClusterRoleCollection</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Nodes on which the customization script is run. The valid values are HeadNode (to install on the head node) or DataNode (to install on all the data nodes). You can use either or both values.</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Uri</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">URI to the script that is executed.</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters required by the script. The sample script used in this topic does not require any parameters, and hence you do not see this parameter in the snippet above.\n </td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Parameter",
          "pos": [
            264,
            273
          ]
        },
        {
          "content": "Definition",
          "pos": [
            432,
            442
          ]
        },
        {
          "content": "Config",
          "pos": [
            580,
            586
          ]
        },
        {
          "content": "Configuration object to which script action information is added.",
          "pos": [
            732,
            797
          ]
        },
        {
          "content": "Name",
          "pos": [
            935,
            939
          ]
        },
        {
          "content": "Name of the script action.",
          "pos": [
            1066,
            1092
          ]
        },
        {
          "content": "ClusterRoleCollection",
          "pos": [
            1230,
            1251
          ]
        },
        {
          "content": "Nodes on which the customization script is run. The valid values are HeadNode (to install on the head node) or DataNode (to install on all the data nodes). You can use either or both values.",
          "pos": [
            1378,
            1568
          ],
          "nodes": [
            {
              "content": "Nodes on which the customization script is run.",
              "pos": [
                0,
                47
              ]
            },
            {
              "content": "The valid values are HeadNode (to install on the head node) or DataNode (to install on all the data nodes).",
              "pos": [
                48,
                155
              ]
            },
            {
              "content": "You can use either or both values.",
              "pos": [
                156,
                190
              ]
            }
          ]
        },
        {
          "content": "Uri",
          "pos": [
            1706,
            1709
          ]
        },
        {
          "content": "URI to the script that is executed.",
          "pos": [
            1836,
            1871
          ]
        },
        {
          "content": "Parameters",
          "pos": [
            2009,
            2019
          ]
        },
        {
          "content": "Parameters required by the script. The sample script used in this topic does not require any parameters, and hence you do not see this parameter in the snippet above.",
          "pos": [
            2146,
            2312
          ],
          "nodes": [
            {
              "content": "Parameters required by the script.",
              "pos": [
                0,
                34
              ]
            },
            {
              "content": "The sample script used in this topic does not require any parameters, and hence you do not see this parameter in the snippet above.",
              "pos": [
                35,
                166
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "Finally, start provisioning a customized cluster with Giraph installed:",
      "pos": [
        15298,
        15369
      ]
    },
    {
      "content": "When prompted, enter the credentials for the cluster.",
      "pos": [
        15547,
        15600
      ]
    },
    {
      "content": "It can take several minutes before the cluster is created.",
      "pos": [
        15601,
        15659
      ]
    },
    {
      "pos": [
        15665,
        15753
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"usingSDK\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Install Giraph on HDInsight Hadoop clusters by using the .NET SDK"
    },
    {
      "content": "The HDInsight .NET SDK provides .NET client libraries that make it easier to work with HDInsight from a .NET Framework application.",
      "pos": [
        15755,
        15886
      ]
    },
    {
      "content": "This section provides instructions on how to use Script Action from the SDK to provision a cluster that has Giraph installed.",
      "pos": [
        15887,
        16012
      ]
    },
    {
      "content": "The following procedures must be performed:",
      "pos": [
        16013,
        16056
      ]
    },
    {
      "content": "Install the HDInsight .NET SDK",
      "pos": [
        16060,
        16090
      ]
    },
    {
      "content": "Create a self-signed certificate",
      "pos": [
        16093,
        16125
      ]
    },
    {
      "content": "Create a console application",
      "pos": [
        16128,
        16156
      ]
    },
    {
      "content": "Run the application",
      "pos": [
        16159,
        16178
      ]
    },
    {
      "content": "To install the HDInsight .NET SDK",
      "pos": [
        16183,
        16216
      ]
    },
    {
      "content": "You can install the latest published build of the SDK from <bpt id=\"p1\">[</bpt>NuGet<ept id=\"p1\">](http://nuget.codeplex.com/wikipage?title=Getting%20Started)</ept>.",
      "pos": [
        16220,
        16347
      ]
    },
    {
      "content": "The instructions will be shown in the next procedure.",
      "pos": [
        16348,
        16401
      ]
    },
    {
      "content": "To create a self-signed certificate",
      "pos": [
        16405,
        16440
      ]
    },
    {
      "content": "Create a self-signed certificate, install it on your workstation, and upload it to your Azure subscription.",
      "pos": [
        16444,
        16551
      ]
    },
    {
      "content": "For instructions, see <bpt id=\"p1\">[</bpt>Create a self-signed certificate<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=511138)</ept>.",
      "pos": [
        16552,
        16656
      ]
    },
    {
      "content": "To create a Visual Studio application",
      "pos": [
        16662,
        16699
      ]
    },
    {
      "content": "Open Visual Studio 2013.",
      "pos": [
        16706,
        16730
      ]
    },
    {
      "pos": [
        16735,
        16801
      ],
      "content": "From the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        16806,
        16864
      ],
      "content": "From <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept>, type or select the following values:"
    },
    {
      "pos": [
        16874,
        18267
      ],
      "content": "<table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n <tr>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Property</th>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Value</th></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Category</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Templates/Visual C#/Windows</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Template</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Console Application</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">CreateGiraphCluster</td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Property",
          "pos": [
            264,
            272
          ]
        },
        {
          "content": "Value",
          "pos": [
            430,
            435
          ]
        },
        {
          "content": "Category",
          "pos": [
            573,
            581
          ]
        },
        {
          "content": "Templates/Visual C#/Windows",
          "pos": [
            727,
            754
          ]
        },
        {
          "content": "Template",
          "pos": [
            892,
            900
          ]
        },
        {
          "content": "Console Application",
          "pos": [
            1027,
            1046
          ]
        },
        {
          "content": "Name",
          "pos": [
            1184,
            1188
          ]
        },
        {
          "content": "CreateGiraphCluster",
          "pos": [
            1315,
            1334
          ]
        }
      ]
    },
    {
      "pos": [
        18272,
        18307
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to create the project."
    },
    {
      "pos": [
        18312,
        18413
      ],
      "content": "From the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Nuget Package Manager<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Package Manager Console<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Run the following command in the console to install the package:",
      "pos": [
        18418,
        18482
      ]
    },
    {
      "content": "This command adds the .NET libraries and references to them from the current Visual Studio project.",
      "pos": [
        18557,
        18656
      ]
    },
    {
      "pos": [
        18661,
        18724
      ],
      "content": "From Solution Explorer, double-click <bpt id=\"p1\">**</bpt>Program.cs<ept id=\"p1\">**</ept> to open it."
    },
    {
      "content": "Add the following using statements to the top of the file:",
      "pos": [
        18729,
        18787
      ]
    },
    {
      "content": "In the Main() function, copy and paste the following code, and provide values for the variables:",
      "pos": [
        19073,
        19169
      ]
    },
    {
      "pos": [
        20816,
        21063
      ],
      "content": "Append the following code to the Main() function to use the <bpt id=\"p1\">[</bpt>ScriptAction<ept id=\"p1\">](http://msdn.microsoft.com/library/microsoft.windowsazure.management.hdinsight.clusterprovisioning.data.scriptaction.aspx)</ept> class to invoke a custom script to install Giraph:"
    },
    {
      "content": "Finally, create the cluster:",
      "pos": [
        21579,
        21607
      ]
    },
    {
      "content": "Save changes to the application and build the solution.",
      "pos": [
        21657,
        21712
      ]
    },
    {
      "content": "To run the application",
      "pos": [
        21717,
        21739
      ]
    },
    {
      "content": "Open an Azure PowerShell console, navigate to the location where you saved the Visual Studio project, navigate to the \\bin\\debug directory within the project, and then run the following command:",
      "pos": [
        21743,
        21937
      ]
    },
    {
      "content": "Provide a cluster name and press ENTER to provision a cluster with Giraph installed.",
      "pos": [
        21981,
        22065
      ]
    },
    {
      "content": "See also",
      "pos": [
        22071,
        22079
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Install and use Spark on HDInsight clusters<ept id=\"p1\">][hdinsight-install-spark]</ept> for instructions on how to use cluster customization to install and use Spark on HDInsight Hadoop clusters.",
      "pos": [
        22084,
        22262
      ]
    },
    {
      "content": "Spark is an open-source parallel processing framework that supports in-memory processing to boost the performance of big-data analytic applications.",
      "pos": [
        22263,
        22411
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Install R on HDInsight clusters<ept id=\"p1\">][hdinsight-install-r]</ept> provides instructions on how to use cluster customization to install and use R on HDInsight Hadoop clusters.",
      "pos": [
        22414,
        22577
      ]
    },
    {
      "content": "R is an open-source language and environment for statistical computing.",
      "pos": [
        22578,
        22649
      ]
    },
    {
      "content": "It provides hundreds of built-in statistical functions and its own programming language that combines aspects of functional and object-oriented programming.",
      "pos": [
        22650,
        22806
      ]
    },
    {
      "content": "It also provides extensive graphical capabilities.",
      "pos": [
        22807,
        22857
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Install Solr on HDInsight clusters<ept id=\"p1\">](hdinsight-hadoop-solr-install.md)</ept>.",
      "pos": [
        22860,
        22931
      ]
    },
    {
      "content": "Use cluster customization to install Solr on HDInsight Hadoop clusters.",
      "pos": [
        22932,
        23003
      ]
    },
    {
      "content": "Solr allows you to perform powerful search operations on data stored.",
      "pos": [
        23004,
        23073
      ]
    },
    {
      "content": "test",
      "pos": [
        23516,
        23520
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Install and use Giraph on Hadoop clusters in HDInsight | Microsoft Azure\" \n    description=\"Learn how to customize HDInsight cluster with Giraph. You'll use a Script Action configuration option to use a script to install Giraph.\" \n    services=\"hdinsight\" \n    documentationCenter=\"\" \n    authors=\"nitinme\" \n    manager=\"paulettm\" \n    editor=\"cgronlun\"/>\n\n<tags \n    ms.service=\"hdinsight\" \n    ms.workload=\"big-data\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"08/07/2015\" \n    ms.author=\"nitinme\"/>\n\n# Install Giraph on HDInsight Hadoop clusters, and use Giraph to process large-scale graphs\n\nYou can install Giraph on any type of cluster in Hadoop on Azure HDInsight by using **Script Action** cluster customization. Script Action lets you run scripts to customize a cluster, only when the cluster is being created. For more information, see [Customize HDInsight clusters using Script Action][hdinsight-cluster-customize].\n\nIn this topic, you will learn how to install Giraph by using Script Action. Once you have installed Giraph, you'll also learn how to use Giraph for most typical applications, which is to process large-scale graphs.\n\n[AZURE.INCLUDE [hdinsight-azure-portal](../../includes/hdinsight-azure-portal.md)]\n\n* [Install Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md)\n\n## <a name=\"whatis\"></a>What is Giraph?\n\n<a href=\"http://giraph.apache.org/\" target=\"_blank\">Apache Giraph</a> allows you to perform graph processing by using Hadoop, and can be used with Azure HDInsight. Graphs model relationships between objects, such as the connections between routers on a large network like the Internet, or relationships between people on social networks (sometimes referred to as a social graph). Graph processing allows you to reason about the relationships between objects in a graph, such as:\n\n- Identifying potential friends based on your current relationships.\n- Identifying the shortest route between two computers in a network.\n- Calculating the page rank of webpages.\n\n   \n## <a name=\"install\"></a>How do I install Giraph?\n\nA sample script to install Giraph on an HDInsight cluster is available from a read-only Azure storage blob at [https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1](https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1). This section provides instructions on how to use the sample script while provisioning the cluster by using the Azure portal. \n\n> [AZURE.NOTE] The sample script works only with HDInsight cluster version 3.1. For more information on HDInsight cluster versions, see [HDInsight cluster versions](hdinsight-component-versioning.md).\n\n1. Start provisioning a cluster by using the **CUSTOM CREATE** option, as described at [Provisioning a cluster using custom options](hdinsight-provision-clusters.md#portal). \n2. On the **Script Actions** page of the wizard, click **add script action** to provide details about the script action, as shown below:\n\n    ![Use Script Action to customize a cluster](./media/hdinsight-hadoop-giraph-install-v1/hdi-script-action-giraph.png \"Use Script Action to customize a cluster\")\n    \n    <table border='1'>\n        <tr><th>Property</th><th>Value</th></tr>\n        <tr><td>Name</td>\n            <td>Specify a name for the script action. For example, <b>Install Giraph</b>.</td></tr>\n        <tr><td>Script URI</td>\n            <td>Specify the Uniform Resource Identifier (URI) to the script that is invoked to customize the cluster. For example, <i>https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1</i></td></tr>\n        <tr><td>Node Type</td>\n            <td>Specify the nodes on which the customization script is run. You can choose <b>All nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes only</b>.\n        <tr><td>Parameters</td>\n            <td>Specify the parameters, if required by the script. The script to install Giraph does not require any parameters, so you can leave this blank.</td></tr>\n    </table>    \n\n    You can add more than one script action to install multiple components on the cluster. After you have added the scripts, click the checkmark to start provisioning the cluster.\n\nYou can also use the script to install Giraph on HDInsight by using Azure PowerShell or the HDInsight .NET SDK. Instructions for these procedures are provided later in this topic.\n\n## <a name=\"usegiraph\"></a>How do I use Giraph in HDInsight?\n\nWe use the SimpleShortestPathsComputation example to demonstrate the basic <a href = \"http://people.apache.org/~edwardyoon/documents/pregel.pdf\">Pregel</a> implementation for finding the shortest path between objects in a graph. Use the following steps to upload the sample data and the sample jar, run a job by using the SimpleShortestPathsComputation example, and then view the results.\n\n1. Upload a sample data file to Azure Blob storage. On your local workstation, create a new file named **tiny_graph.txt**. It should contain the following lines:\n\n        [0,0,[[1,1],[3,3]]]\n        [1,0,[[0,1],[2,2],[3,1]]]\n        [2,0,[[1,2],[4,4]]]\n        [3,0,[[0,3],[1,1],[4,4]]]\n        [4,0,[[3,4],[2,4]]]\n\n    Upload the tiny_graph.txt file to the primary storage for your HDInsight cluster. For instructions on how to upload data, see [Upload data for Hadoop jobs in HDInsight](hdinsight-upload-data.md).\n\n    This data describes a relationship between objects in a directed graph, by using the format [source\\_id, source\\_value,[[dest\\_id], [edge\\_value],...]]. Each line represents a relationship between a **source\\_id** object and one or more **dest\\_id** objects. The **edge\\_value** (or weight) can be thought of as the strength or distance of the connection between **source_id** and **dest\\_id**.\n\n    Drawn out, and using the value (or weight) as the distance between objects, the above data might look like this:\n\n    ![tiny_graph.txt drawn as circles with lines of varying distance between](./media/hdinsight-hadoop-giraph-install-v1/giraph-graph.png)\n\n    \n\n4. Run the SimpleShortestPathsComputation example. Use the following Azure PowerShell cmdlets to run the example by using the tiny_graph.txt file as input. This requires that you have installed and configured [Azure PowerShell][powershell-install].\n\n        $clusterName = \"clustername\"\n        # Giraph examples jar\n        $jarFile = \"wasb:///example/jars/giraph-examples.jar\"\n        # Arguments for this job\n        $jobArguments = \"org.apache.giraph.examples.SimpleShortestPathsComputation\",\n                        \"-ca\", \"mapred.job.tracker=headnodehost:9010\",\n                        \"-vif\", \"org.apache.giraph.io.formats.JsonLongDoubleFloatDoubleVertexInputFormat\",\n                        \"-vip\", \"wasb:///example/data/tiny_graph.txt\",\n                        \"-vof\", \"org.apache.giraph.io.formats.IdWithValueTextOutputFormat\",\n                        \"-op\",  \"wasb:///example/output/shortestpaths\",\n                        \"-w\", \"2\"\n        # Create the definition\n        $jobDefinition = New-AzureHDInsightMapReduceJobDefinition\n          -JarFile $jarFile\n          -ClassName \"org.apache.giraph.GiraphRunner\"\n          -Arguments $jobArguments\n        \n        # Run the job, write output to the Azure PowerShell window\n        $job = Start-AzureHDInsightJob -Cluster $clusterName -JobDefinition $jobDefinition\n        Write-Host \"Wait for the job to complete ...\" -ForegroundColor Green\n        Wait-AzureHDInsightJob -Job $job\n        Write-Host \"STDERR\"\n        Get-AzureHDInsightJobOutput -Cluster $clusterName -JobId $job.JobId -StandardError\n        Write-Host \"Display the standard output ...\" -ForegroundColor Green\n        Get-AzureHDInsightJobOutput -Cluster $clusterName -JobId $job.JobId -StandardOutput\n\n    In the above example, replace **clustername** with the name of your HDInsight cluster that has Giraph installed.\n\n5. View the results. Once the job has finished, the results will be stored in two output files in the __wasb:///example/out/shotestpaths__ folder. The files are called __part-m-00001__ and __part-m-00002__. Perform the following steps to download and view the output:\n\n        $subscriptionName = \"<SubscriptionName>\"       # Azure subscription name\n        $storageAccountName = \"<StorageAccountName>\"   # Azure Storage account name\n        $containerName = \"<ContainerName>\"             # Blob storage container name\n\n        # Select the current subscription\n        Select-AzureSubscription $subscriptionName\n        \n        # Create the Storage account context object\n        $storageAccountKey = Get-AzureStorageKey $storageAccountName | %{ $_.Primary }\n        $storageContext = New-AzureStorageContext -StorageAccountName $storageAccountName -StorageAccountKey $storageAccountKey\n\n        # Download the job output to the workstation\n        Get-AzureStorageBlobContent -Container $containerName -Blob example/output/shortestpaths/part-m-00001 -Context $storageContext -Force\n        Get-AzureStorageBlobContent -Container $containerName -Blob example/output/shortestpaths/part-m-00002 -Context $storageContext -Force\n\n    This will create the __example/output/shortestpaths__ directory structure in the current directory on your workstation, and download the two output files to that location.\n\n    Use the __Cat__ cmdlet to display the contents of the files: \n\n        Cat example/output/shortestpaths/part*\n\n    The output should appear similar to the following:\n\n\n        0   1.0\n        4   5.0\n        2   2.0\n        1   0.0\n        3   1.0\n\n    The SimpleShortestPathComputation example is hard coded to start with object ID 1 and find the shortest path to other objects. So the output should be read as `destination_id distance`, where distance is the value (or weight) of the edges traveled between object ID 1 and the target ID.\n    \n    Visualizing this, you can verify the results by traveling the shortest paths between ID 1 and all other objects. Note that the shortest path between ID 1 and ID 4 is 5. This is the total distance between <span style=\"color:orange\">ID 1 and 3</span>, and then <span style=\"color:red\">ID 3 and 4</span>.\n\n    ![Drawing of objects as circles with shortest paths drawn between](./media/hdinsight-hadoop-giraph-install-v1/giraph-graph-out.png) \n\n\n## <a name=\"usingPS\"></a>Install Giraph on HDInsight Hadoop clusters by using Azure PowerShell\n\nIn this section, we use the **<a href = \"http://msdn.microsoft.com/library/dn858088.aspx\" target=\"_blank\">Add-AzureHDInsightScriptAction</a>** cmdlet to invoke scripts by using Script Action to customize a cluster. Before proceeding, make sure you have installed and configured Azure PowerShell. For information on configuring a workstation to run Azure Powershell cmdlets for HDInsight, see [Install and configure Azure PowerShell][powershell-install].\n\nPerform the following steps:\n\n1. Open an Azure PowerShell window and declare the following variables:\n\n        # Provide values for these variables\n        $subscriptionName = \"<SubscriptionName>\"        # Name of the Azure subscription\n        $clusterName = \"<HDInsightClusterName>\"         # HDInsight cluster name\n        $storageAccountName = \"<StorageAccountName>\"    # Azure Storage account that hosts the default container\n        $storageAccountKey = \"<StorageAccountKey>\"      # Key for the Storage account\n        $containerName = $clusterName\n        $location = \"<MicrosoftDataCenter>\"             # Location of the HDInsight cluster. It must be in the same data center as the Storage account.\n        $clusterNodes = <ClusterSizeInNumbers>          # Number of nodes in the HDInsight cluster\n        $version = \"<HDInsightClusterVersion>\"          # For example, \"3.1\"\n    \n2. Specify the configuration values, such as nodes in the cluster and the default storage to be used:\n\n        # Specify the configuration options\n        Select-AzureSubscription $subscriptionName\n        $config = New-AzureHDInsightClusterConfig -ClusterSizeInNodes $clusterNodes\n        $config.DefaultStorageAccount.StorageAccountName=\"$storageAccountName.blob.core.windows.net\"\n        $config.DefaultStorageAccount.StorageAccountKey=$storageAccountKey\n        $config.DefaultStorageAccount.StorageContainerName=$containerName\n    \n3. Use the **Add-AzureHDInsightScriptAction** cmdlet to add a script action to the cluster configuration. Later, when the cluster is being created, the script action gets executed. \n\n        # Add a script action to the cluster configuration\n        $config = Add-AzureHDInsightScriptAction -Config $config -Name \"Install Giraph\" -ClusterRoleCollection HeadNode -Uri https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1\n\n    The **Add-AzureHDInsightScriptAction** cmdlet takes the following parameters:\n\n    <table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n    <tr>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Parameter</th>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:550px; padding-left:5px; padding-right:5px;\">Definition</th></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Config</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Configuration object to which script action information is added.</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name of the script action.</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">ClusterRoleCollection</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Nodes on which the customization script is run. The valid values are HeadNode (to install on the head node) or DataNode (to install on all the data nodes). You can use either or both values.</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Uri</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">URI to the script that is executed.</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters required by the script. The sample script used in this topic does not require any parameters, and hence you do not see this parameter in the snippet above.\n    </td></tr>\n    </table>\n    \n4. Finally, start provisioning a customized cluster with Giraph installed:  \n    \n        # Start provisioning a cluster with Giraph installed\n        New-AzureHDInsightCluster -Config $config -Name $clusterName -Location $location -Version $version \n\nWhen prompted, enter the credentials for the cluster. It can take several minutes before the cluster is created.\n\n\n## <a name=\"usingSDK\"></a>Install Giraph on HDInsight Hadoop clusters by using the .NET SDK\n\nThe HDInsight .NET SDK provides .NET client libraries that make it easier to work with HDInsight from a .NET Framework application. This section provides instructions on how to use Script Action from the SDK to provision a cluster that has Giraph installed. The following procedures must be performed:\n\n- Install the HDInsight .NET SDK\n- Create a self-signed certificate\n- Create a console application\n- Run the application\n\n\n**To install the HDInsight .NET SDK**\n\nYou can install the latest published build of the SDK from [NuGet](http://nuget.codeplex.com/wikipage?title=Getting%20Started). The instructions will be shown in the next procedure.\n\n**To create a self-signed certificate**\n\nCreate a self-signed certificate, install it on your workstation, and upload it to your Azure subscription. For instructions, see [Create a self-signed certificate](http://go.microsoft.com/fwlink/?LinkId=511138). \n\n\n**To create a Visual Studio application**\n\n1. Open Visual Studio 2013.\n\n2. From the **File** menu, click **New**, and then click **Project**.\n\n3. From **New Project**, type or select the following values:\n    \n    <table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n    <tr>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Property</th>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Value</th></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Category</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Templates/Visual C#/Windows</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Template</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Console Application</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">CreateGiraphCluster</td></tr>\n    </table>\n\n4. Click **OK** to create the project.\n\n5. From the **Tools** menu, click **Nuget Package Manager**, and then click **Package Manager Console**.\n\n6. Run the following command in the console to install the package:\n\n        Install-Package Microsoft.WindowsAzure.Management.HDInsight\n\n    This command adds the .NET libraries and references to them from the current Visual Studio project.\n\n7. From Solution Explorer, double-click **Program.cs** to open it.\n\n8. Add the following using statements to the top of the file:\n\n        using System.Security.Cryptography.X509Certificates;\n        using Microsoft.WindowsAzure.Management.HDInsight;\n        using Microsoft.WindowsAzure.Management.HDInsight.ClusterProvisioning;\n        using Microsoft.WindowsAzure.Management.HDInsight.Framework.Logging;\n    \n9. In the Main() function, copy and paste the following code, and provide values for the variables:\n        \n        var clusterName = args[0];\n\n        // Provide values for the variables\n        string thumbprint = \"<CertificateThumbprint>\";  \n        string subscriptionId = \"<AzureSubscriptionID>\";\n        string location = \"<MicrosoftDataCenterLocation>\";\n        string storageaccountname = \"<AzureStorageAccountName>.blob.core.windows.net\";\n        string storageaccountkey = \"<AzureStorageAccountKey>\";\n        string username = \"<HDInsightUsername>\";\n        string password = \"<HDInsightUserPassword>\";\n        int clustersize = <NumberOfNodesInTheCluster>;\n\n        // Provide the certificate thumbprint to retrieve the certificate from the certificate store \n        X509Store store = new X509Store();\n        store.Open(OpenFlags.ReadOnly);\n        X509Certificate2 cert = store.Certificates.Cast<X509Certificate2>().First(item => item.Thumbprint == thumbprint);\n\n        // Create an HDInsight client object\n        HDInsightCertificateCredential creds = new HDInsightCertificateCredential(new Guid(subscriptionId), cert);\n        var client = HDInsightClient.Connect(creds);\n        client.IgnoreSslErrors = true;\n        \n        // Provide the cluster information\n        var clusterInfo = new ClusterCreateParameters()\n        {\n            Name = clusterName,\n            Location = location,\n            DefaultStorageAccountName = storageaccountname,\n            DefaultStorageAccountKey = storageaccountkey,\n            DefaultStorageContainer = clusterName,\n            UserName = username,\n            Password = password,\n            ClusterSizeInNodes = clustersize,\n            Version = \"3.1\"\n        };        \n\n10. Append the following code to the Main() function to use the [ScriptAction](http://msdn.microsoft.com/library/microsoft.windowsazure.management.hdinsight.clusterprovisioning.data.scriptaction.aspx) class to invoke a custom script to install Giraph:\n\n        // Add the script action to install Giraph\n        clusterInfo.ConfigActions.Add(new ScriptAction(\n          \"Install Giraph\", // Name of the config action\n          new ClusterNodeType[] { ClusterNodeType.HeadNode }, // List of nodes to install Giraph on\n          new Uri(\"https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1\"), // Location of the script to install Giraph\n          null //Because the script used does not require any parameters\n        ));\n\n11. Finally, create the cluster:\n\n        client.CreateCluster(clusterInfo);\n\n12. Save changes to the application and build the solution. \n\n**To run the application**\n\nOpen an Azure PowerShell console, navigate to the location where you saved the Visual Studio project, navigate to the \\bin\\debug directory within the project, and then run the following command:\n\n    .\\CreateGiraphCluster <cluster-name>\n\nProvide a cluster name and press ENTER to provision a cluster with Giraph installed.\n\n\n## See also##\n- [Install and use Spark on HDInsight clusters][hdinsight-install-spark] for instructions on how to use cluster customization to install and use Spark on HDInsight Hadoop clusters. Spark is an open-source parallel processing framework that supports in-memory processing to boost the performance of big-data analytic applications.\n- [Install R on HDInsight clusters][hdinsight-install-r] provides instructions on how to use cluster customization to install and use R on HDInsight Hadoop clusters. R is an open-source language and environment for statistical computing. It provides hundreds of built-in statistical functions and its own programming language that combines aspects of functional and object-oriented programming. It also provides extensive graphical capabilities.\n- [Install Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md). Use cluster customization to install Solr on HDInsight Hadoop clusters. Solr allows you to perform powerful search operations on data stored.\n\n\n\n[tools]: https://github.com/Blackmist/hdinsight-tools\n[aps]: http://azure.microsoft.com/documentation/articles/install-configure-powershell/\n\n[powershell-install]: ../powershell-install-configure.md\n[hdinsight-provision]: hdinsight-provision-clusters.md\n[hdinsight-install-r]: hdinsight-hadoop-r-scripts.md\n[hdinsight-install-spark]: hdinsight-hadoop-spark-install.md\n[hdinsight-cluster-customize]: hdinsight-hadoop-customize-cluster.md\n \ntest\n"
}