{
  "nodes": [
    {
      "content": "Azure Queues and Service Bus queues - compared and contrasted",
      "pos": [
        27,
        88
      ]
    },
    {
      "content": "Analyzes differences and similarities between two types of queues offered by Azure.",
      "pos": [
        106,
        189
      ]
    },
    {
      "content": "Azure Queues and Service Bus queues - compared and contrasted",
      "pos": [
        481,
        542
      ]
    },
    {
      "content": "This article analyzes the differences and similarities between the two types of queues offered by Microsoft Azure today: Azure Queues and Service Bus queues.",
      "pos": [
        544,
        701
      ]
    },
    {
      "content": "By using this information, you can compare and contrast the respective technologies and be able to make a more informed decision about which solution best meets your needs.",
      "pos": [
        702,
        874
      ]
    },
    {
      "content": "Introduction",
      "pos": [
        879,
        891
      ]
    },
    {
      "pos": [
        893,
        993
      ],
      "content": "Microsoft Azure supports two types of queue mechanisms: <bpt id=\"p1\">**</bpt>Azure Queues<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Service Bus Queues<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        995,
        1234
      ],
      "content": "<bpt id=\"p1\">**</bpt>Azure Queues<ept id=\"p1\">**</ept>, which are part of the <bpt id=\"p2\">[</bpt>Azure storage<ept id=\"p2\">](http://azure.microsoft.com/services/storage/)</ept> infrastructure, feature a simple REST-based Get/Put/Peek interface, providing reliable, persistent messaging within and between services."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Service Bus queues<ept id=\"p1\">**</ept> are part of a broader <bpt id=\"p2\">[</bpt>Azure messaging<ept id=\"p2\">](http://azure.microsoft.com/services/messaging/)</ept> infrastructure that supports queuing as well as publish/subscribe, Web service remoting, and integration patterns.",
      "pos": [
        1236,
        1461
      ]
    },
    {
      "content": "For more information about Service Bus queues, topics/subscriptions, and relays, see <bpt id=\"p1\">[</bpt>Overview of Service Bus Messaging Patterns<ept id=\"p1\">](https://msdn.microsoft.com/library/hh410103.aspx)</ept>.",
      "pos": [
        1462,
        1642
      ]
    },
    {
      "content": "While both queuing technologies exist concurrently, Azure Queues were introduced first, as a dedicated queue storage mechanism built on top of the Azure storage services.",
      "pos": [
        1644,
        1814
      ]
    },
    {
      "content": "Service Bus queues are built on top of the broader \"brokered messaging\" infrastructure designed to integrate applications or application components that may span multiple communication protocols, data contracts, trust domains, and/or network environments.",
      "pos": [
        1815,
        2070
      ]
    },
    {
      "content": "This article compares the two queue technologies offered by Azure by discussing the differences in the behavior and implementation of the features provided by each.",
      "pos": [
        2072,
        2236
      ]
    },
    {
      "content": "The article also provides guidance for choosing which features might best suit your application development needs.",
      "pos": [
        2237,
        2351
      ]
    },
    {
      "content": "Technology selection considerations",
      "pos": [
        2356,
        2391
      ]
    },
    {
      "content": "Both Azure Queues and Service Bus queues are implementations of the message queuing service currently offered on Microsoft Azure.",
      "pos": [
        2393,
        2522
      ]
    },
    {
      "content": "Each has a slightly different feature set, which means you can choose one or the other, or use both, depending on the needs of your particular solution or business/technical problem you are solving.",
      "pos": [
        2523,
        2721
      ]
    },
    {
      "content": "When determining which queuing technology fits the purpose for a given solution, solution architects and developers should consider the recommendations below.",
      "pos": [
        2723,
        2881
      ]
    },
    {
      "content": "For more details, see the next section.",
      "pos": [
        2882,
        2921
      ]
    },
    {
      "pos": [
        2923,
        3006
      ],
      "content": "As a solution architect/developer, <bpt id=\"p1\">**</bpt>you should consider using Azure Queues<ept id=\"p1\">**</ept> when:"
    },
    {
      "content": "Your application must store over 80 GB of messages in a queue, where the messages have a lifetime shorter than 7 days.",
      "pos": [
        3010,
        3128
      ]
    },
    {
      "content": "Your application wants to track progress for processing a message inside of the queue.",
      "pos": [
        3132,
        3218
      ]
    },
    {
      "content": "This is useful if the worker processing a message crashes.",
      "pos": [
        3219,
        3277
      ]
    },
    {
      "content": "A subsequent worker can then use that information to continue from where the prior worker left off.",
      "pos": [
        3278,
        3377
      ]
    },
    {
      "content": "You require server side logs of all of the transactions executed against your queues.",
      "pos": [
        3381,
        3466
      ]
    },
    {
      "pos": [
        3468,
        3557
      ],
      "content": "As a solution architect/developer, <bpt id=\"p1\">**</bpt>you should consider using Service Bus queues<ept id=\"p1\">**</ept> when:"
    },
    {
      "content": "Your solution must be able to receive messages without having to poll the queue.",
      "pos": [
        3561,
        3641
      ]
    },
    {
      "content": "With Service Bus, this can be achieved through the use of the long-polling receive operation using the TCP-based protocols that Service Bus supports.",
      "pos": [
        3642,
        3791
      ]
    },
    {
      "content": "Your solution requires the queue to provide a guaranteed first-in-first-out (FIFO) ordered delivery.",
      "pos": [
        3795,
        3895
      ]
    },
    {
      "content": "You want a symmetric experience in Azure and on Windows Server (private cloud).",
      "pos": [
        3899,
        3978
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Service Bus for Windows Server<ept id=\"p1\">](https://msdn.microsoft.com/library/dn282144.aspx)</ept>.",
      "pos": [
        3979,
        4088
      ]
    },
    {
      "content": "Your solution must be able to support automatic duplicate detection.",
      "pos": [
        4092,
        4160
      ]
    },
    {
      "content": "You want your application to process messages as parallel long-running streams (messages are associated with a stream using the <bpt id=\"p1\">[</bpt>SessionId<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.sessionid.aspx)</ept> property on the message).",
      "pos": [
        4164,
        4427
      ]
    },
    {
      "content": "In this model, each node in the consuming application competes for streams, as opposed to messages.",
      "pos": [
        4428,
        4527
      ]
    },
    {
      "content": "When a stream is given to a consuming node, the node can examine the state of the application stream state using transactions.",
      "pos": [
        4528,
        4654
      ]
    },
    {
      "content": "Your solution requires transactional behavior and atomicity when sending or receiving multiple messages from a queue.",
      "pos": [
        4658,
        4775
      ]
    },
    {
      "content": "The time-to-live (TTL) characteristic of the application-specific workload can exceed the 7-day period.",
      "pos": [
        4779,
        4882
      ]
    },
    {
      "content": "Your application handles messages that can exceed 64 KB but will not likely approach the 256 KB limit.",
      "pos": [
        4886,
        4988
      ]
    },
    {
      "content": "You deal with a requirement to provide a role-based access model to the queues, and different rights/permissions for senders and receivers.",
      "pos": [
        4992,
        5131
      ]
    },
    {
      "content": "Your queue size will not grow larger than 80 GB.",
      "pos": [
        5135,
        5183
      ]
    },
    {
      "content": "You want to use the AMQP 1.0 standards-based messaging broker.",
      "pos": [
        5187,
        5249
      ]
    },
    {
      "content": "For more information about AMQP, see <bpt id=\"p1\">[</bpt>Service Bus AMQP Overview<ept id=\"p1\">](https://msdn.microsoft.com/library/jj841072.aspx)</ept>.",
      "pos": [
        5250,
        5365
      ]
    },
    {
      "content": "You can envision an eventual migration from queue-based point-to-point communication to a message exchange pattern that enables seamless integration of additional receivers (subscribers), each of which receives independent copies of either some or all messages sent to the queue.",
      "pos": [
        5369,
        5648
      ]
    },
    {
      "content": "The latter refers to the publish/subscribe capability natively provided by Service Bus.",
      "pos": [
        5649,
        5736
      ]
    },
    {
      "content": "Your messaging solution must be able to support the “At-Most-Once” delivery guarantee without the need for you to build the additional infrastructure components.",
      "pos": [
        5740,
        5901
      ]
    },
    {
      "content": "You would like to be able to publish and consume batches of messages.",
      "pos": [
        5905,
        5974
      ]
    },
    {
      "content": "You require full integration with the Windows Communication Foundation (WCF) communication stack in the .NET Framework.",
      "pos": [
        5978,
        6097
      ]
    },
    {
      "content": "Comparing Azure Queues and Service Bus Queues",
      "pos": [
        6102,
        6147
      ]
    },
    {
      "content": "The tables in the following sections provide a logical grouping of queue features and let you compare, at a glance, the capabilities available in both Azure Queues and Service Bus queues.",
      "pos": [
        6149,
        6336
      ]
    },
    {
      "content": "Foundational capabilities",
      "pos": [
        6341,
        6366
      ]
    },
    {
      "content": "This section compares some of the fundamental queuing capabilities provided by Azure Queues and Service Bus queues.",
      "pos": [
        6368,
        6483
      ]
    },
    {
      "content": "Comparison Criteria",
      "pos": [
        6486,
        6505
      ]
    },
    {
      "content": "Azure Queues",
      "pos": [
        6506,
        6518
      ]
    },
    {
      "content": "Service Bus Queues",
      "pos": [
        6519,
        6537
      ]
    },
    {
      "content": "Ordering guarantee",
      "pos": [
        6554,
        6572
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>No<ept id=\"p1\">**</ept>",
      "pos": [
        6573,
        6579
      ]
    },
    {
      "content": "For more information, see the first note in the “Additional Information” section.",
      "pos": [
        6589,
        6670
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes - First-In-First-Out (FIFO)<ept id=\"p1\">**</ept>",
      "pos": [
        6676,
        6711
      ]
    },
    {
      "content": "(through the use of messaging sessions)",
      "pos": [
        6720,
        6759
      ]
    },
    {
      "content": "Delivery guarantee",
      "pos": [
        6762,
        6780
      ]
    },
    {
      "content": "At-Least-Once",
      "pos": [
        6783,
        6796
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>At-Least-Once<ept id=\"p1\">**</ept>",
      "pos": [
        6799,
        6816
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>At-Most-Once<ept id=\"p1\">**</ept>",
      "pos": [
        6826,
        6842
      ]
    },
    {
      "content": "Transaction support",
      "pos": [
        6845,
        6864
      ]
    },
    {
      "content": "No",
      "pos": [
        6867,
        6869
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        6872,
        6879
      ]
    },
    {
      "content": "(through the use of local transactions)",
      "pos": [
        6889,
        6928
      ]
    },
    {
      "content": "Receive behavior",
      "pos": [
        6931,
        6947
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Non-blocking<ept id=\"p1\">**</ept>",
      "pos": [
        6948,
        6964
      ]
    },
    {
      "content": "(completes immediately if no new message is found)",
      "pos": [
        6974,
        7024
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Blocking with/without timeout<ept id=\"p1\">**</ept>",
      "pos": [
        7025,
        7058
      ]
    },
    {
      "content": "(offers long polling, or the <bpt id=\"p1\">[</bpt>\"Comet technique\"<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=613759)</ept>)",
      "pos": [
        7068,
        7164
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Non-blocking<ept id=\"p1\">**</ept>",
      "pos": [
        7174,
        7190
      ]
    },
    {
      "content": "(through the use of .NET managed API only)",
      "pos": [
        7200,
        7242
      ]
    },
    {
      "content": "Push-style API",
      "pos": [
        7245,
        7259
      ]
    },
    {
      "content": "No",
      "pos": [
        7262,
        7264
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        7267,
        7274
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>OnMessage<ept id=\"p1\">](https://msdn.microsoft.com/library/jj908682.aspx)</ept> and <bpt id=\"p2\">[</bpt>OnMessage sessions<ept id=\"p2\">](https://msdn.microsoft.com/library/dn790528.aspx)</ept> .NET API.",
      "pos": [
        7284,
        7430
      ]
    },
    {
      "content": "Receive mode",
      "pos": [
        7433,
        7445
      ]
    },
    {
      "content": "Peek &amp; Lease",
      "pos": [
        7448,
        7460
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Peek &amp; Lock<ept id=\"p1\">**</ept>",
      "pos": [
        7463,
        7478
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Receive &amp; Delete<ept id=\"p1\">**</ept>",
      "pos": [
        7488,
        7508
      ]
    },
    {
      "content": "Exclusive access mode",
      "pos": [
        7511,
        7532
      ]
    },
    {
      "content": "Lease-based",
      "pos": [
        7535,
        7546
      ]
    },
    {
      "content": "Lock-based",
      "pos": [
        7551,
        7561
      ]
    },
    {
      "content": "Lease/Lock duration",
      "pos": [
        7566,
        7585
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>30 seconds (default)<ept id=\"p1\">**</ept>",
      "pos": [
        7586,
        7610
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>7 days (maximum)<ept id=\"p1\">**</ept> (You can renew or release a message lease using the <bpt id=\"p2\">[</bpt>UpdateMessage<ept id=\"p2\">](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.updatemessage.aspx)</ept> API.)",
      "pos": [
        7620,
        7823
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>60 seconds (default)<ept id=\"p1\">**</ept>",
      "pos": [
        7824,
        7848
      ]
    },
    {
      "content": "You can renew a message lock using the <bpt id=\"p1\">[</bpt>RenewLock<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.renewlock.aspx)</ept> API.",
      "pos": [
        7858,
        8011
      ]
    },
    {
      "content": "Lease/Lock precision",
      "pos": [
        8014,
        8034
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Message level<ept id=\"p1\">**</ept>",
      "pos": [
        8035,
        8052
      ]
    },
    {
      "content": "(each message can have a different timeout value, which you can then update as needed while processing the message, by using the <bpt id=\"p1\">[</bpt>UpdateMessage<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.updatemessage.aspx)</ept> API)",
      "pos": [
        8062,
        8314
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Queue level<ept id=\"p1\">**</ept>",
      "pos": [
        8315,
        8330
      ]
    },
    {
      "content": "(each queue has a lock precision applied to all of its messages, but you can renew the lock using the <bpt id=\"p1\">[</bpt>RenewLock<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.renewlock.aspx)</ept> API.)",
      "pos": [
        8340,
        8557
      ]
    },
    {
      "content": "Batched receive",
      "pos": [
        8560,
        8575
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        8576,
        8583
      ]
    },
    {
      "content": "(explicitly specifying message count when retrieving messages, up to a maximum of 32 messages)",
      "pos": [
        8593,
        8687
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        8688,
        8695
      ]
    },
    {
      "content": "(implicitly enabling a pre-fetch property or explicitly through the use of transactions)",
      "pos": [
        8705,
        8793
      ]
    },
    {
      "content": "Batched send",
      "pos": [
        8796,
        8808
      ]
    },
    {
      "content": "No",
      "pos": [
        8811,
        8813
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        8816,
        8823
      ]
    },
    {
      "content": "(through the use of transactions or client-side batching)",
      "pos": [
        8833,
        8890
      ]
    },
    {
      "content": "Additional information",
      "pos": [
        8897,
        8919
      ]
    },
    {
      "content": "Messages in Azure Queues are typically first-in-first-out, but sometimes they can be out of order; for example, when a message’s visibility timeout duration expires (for example, as a result of a client application crashing during processing).",
      "pos": [
        8923,
        9166
      ]
    },
    {
      "content": "When the visibility timeout expires, the message becomes visible again on the queue for another worker to dequeue it.",
      "pos": [
        9167,
        9284
      ]
    },
    {
      "content": "At that point, the newly visible message might be placed in the queue (to be dequeued again) after a message that was originally enqueued after it.",
      "pos": [
        9285,
        9432
      ]
    },
    {
      "content": "If you are already using Azure Storage Blobs or Tables and you start using queues, you are guaranteed 99.9% availability.",
      "pos": [
        9436,
        9557
      ]
    },
    {
      "content": "If you use Blobs or Tables with Service Bus queues, you will have lower availability.",
      "pos": [
        9558,
        9643
      ]
    },
    {
      "content": "The guaranteed FIFO pattern in Service Bus queues requires the use of messaging sessions.",
      "pos": [
        9647,
        9736
      ]
    },
    {
      "content": "In the event that the application crashes while processing a message received in the <bpt id=\"p1\">**</bpt>Peek &amp; Lock<ept id=\"p1\">**</ept> mode, the next time a queue receiver accepts a messaging session, it will start with the failed message after its time-to-live (TTL) period expires.",
      "pos": [
        9737,
        9986
      ]
    },
    {
      "content": "Azure Queues are designed to support standard queuing scenarios, such as decoupling application components to increase scalability and tolerance for failures, load leveling, and building process workflows.",
      "pos": [
        9990,
        10195
      ]
    },
    {
      "content": "Service Bus queues support the <bpt id=\"p1\">*</bpt>At-Least-Once<ept id=\"p1\">*</ept> delivery guarantee.",
      "pos": [
        10199,
        10265
      ]
    },
    {
      "content": "In addition, the <bpt id=\"p1\">*</bpt>At-Most-Once<ept id=\"p1\">*</ept> semantic can be supported by using session state to store the application state and by using transactions to atomically receive messages and update the session state.",
      "pos": [
        10266,
        10464
      ]
    },
    {
      "content": "The Azure Workflow Service uses this technique to guarantee At-Most-Once delivery.",
      "pos": [
        10465,
        10547
      ]
    },
    {
      "content": "Azure Queues provide a uniform and consistent programming model across queues, tables, and BLOBs – both for developers and for operations teams.",
      "pos": [
        10551,
        10695
      ]
    },
    {
      "content": "Service Bus queues provide support for local transactions in the context of a single queue.",
      "pos": [
        10699,
        10790
      ]
    },
    {
      "pos": [
        10794,
        10975
      ],
      "content": "The <bpt id=\"p1\">*</bpt>Receive and Delete<ept id=\"p1\">*</ept> mode supported by Service Bus provides the ability to reduce the messaging operation count (and associated cost) in exchange for lowered delivery assurance."
    },
    {
      "content": "Azure Queues provide leases with the ability to extend the leases for messages.",
      "pos": [
        10979,
        11058
      ]
    },
    {
      "content": "This allows the workers to maintain short leases on messages.",
      "pos": [
        11059,
        11120
      ]
    },
    {
      "content": "Thus, if a worker crashes, the message can be quickly processed again by another worker.",
      "pos": [
        11121,
        11209
      ]
    },
    {
      "content": "In addition, a worker can extend the lease on a message if it needs to process it longer than the current lease time.",
      "pos": [
        11210,
        11327
      ]
    },
    {
      "content": "Azure Queues offer a visibility timeout that you can set upon the enqueueing or dequeuing of a message.",
      "pos": [
        11331,
        11434
      ]
    },
    {
      "content": "In addition, you can update a message with different lease values at runtime, and update different values across messages in the same queue.",
      "pos": [
        11435,
        11575
      ]
    },
    {
      "content": "Service Bus lock timeouts are defined in the queue metadata; however, you can renew the lock by calling the <bpt id=\"p1\">[</bpt>RenewLock<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.renewlock.aspx)</ept> method.",
      "pos": [
        11576,
        11801
      ]
    },
    {
      "content": "The maximum timeout for a blocking receive operation in Service Bus queues is 24 days.",
      "pos": [
        11805,
        11891
      ]
    },
    {
      "content": "However, REST-based timeouts have a maximum value of 55 seconds.",
      "pos": [
        11892,
        11956
      ]
    },
    {
      "content": "Client-side batching provided by Service Bus enables a queue client to batch multiple messages into a single send operation.",
      "pos": [
        11960,
        12084
      ]
    },
    {
      "content": "Batching is only available for asynchronous send operations.",
      "pos": [
        12085,
        12145
      ]
    },
    {
      "content": "Features such as the 200TB ceiling of Azure Queues (more when you virtualize accounts) and unlimited queues make it an ideal platform for SaaS providers.",
      "pos": [
        12149,
        12302
      ]
    },
    {
      "content": "Azure Queues provide a flexible and performant delegated access control mechanism.",
      "pos": [
        12306,
        12388
      ]
    },
    {
      "content": "Advanced capabilities",
      "pos": [
        12393,
        12414
      ]
    },
    {
      "content": "This section compares advanced capabilities provided by Azure Queues and Service Bus queues.",
      "pos": [
        12416,
        12508
      ]
    },
    {
      "content": "Comparison Criteria",
      "pos": [
        12511,
        12530
      ]
    },
    {
      "content": "Azure Queues",
      "pos": [
        12531,
        12543
      ]
    },
    {
      "content": "Service Bus Queues",
      "pos": [
        12544,
        12562
      ]
    },
    {
      "content": "Scheduled delivery",
      "pos": [
        12579,
        12597
      ]
    },
    {
      "content": "Yes",
      "pos": [
        12600,
        12603
      ]
    },
    {
      "content": "Yes",
      "pos": [
        12608,
        12611
      ]
    },
    {
      "content": "Automatic dead lettering",
      "pos": [
        12616,
        12640
      ]
    },
    {
      "content": "No",
      "pos": [
        12643,
        12645
      ]
    },
    {
      "content": "Yes",
      "pos": [
        12650,
        12653
      ]
    },
    {
      "content": "Increasing queue time-to-live value",
      "pos": [
        12658,
        12693
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        12694,
        12701
      ]
    },
    {
      "content": "(via in-place update of visibility timeout)",
      "pos": [
        12711,
        12754
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        12755,
        12762
      ]
    },
    {
      "content": "(provided via a dedicated API function)",
      "pos": [
        12772,
        12811
      ]
    },
    {
      "content": "Poison message support",
      "pos": [
        12814,
        12836
      ]
    },
    {
      "content": "Yes",
      "pos": [
        12839,
        12842
      ]
    },
    {
      "content": "Yes",
      "pos": [
        12847,
        12850
      ]
    },
    {
      "content": "In-place update",
      "pos": [
        12855,
        12870
      ]
    },
    {
      "content": "Yes",
      "pos": [
        12873,
        12876
      ]
    },
    {
      "content": "Yes",
      "pos": [
        12881,
        12884
      ]
    },
    {
      "content": "Server-side transaction log",
      "pos": [
        12889,
        12916
      ]
    },
    {
      "content": "Yes",
      "pos": [
        12919,
        12922
      ]
    },
    {
      "content": "No",
      "pos": [
        12927,
        12929
      ]
    },
    {
      "content": "Storage metrics",
      "pos": [
        12934,
        12949
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        12950,
        12957
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Minute Metrics<ept id=\"p1\">**</ept>: provides real-time metrics for availability, TPS, API call counts, error counts, and more, all in real time (aggregated per minute and reported within a few minutes from what just happened in production.",
      "pos": [
        12967,
        13190
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>About Storage Analytics Metrics<ept id=\"p1\">](https://msdn.microsoft.com/library/hh343258.aspx)</ept>.",
      "pos": [
        13191,
        13301
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        13302,
        13309
      ]
    },
    {
      "content": "(bulk queries by calling <bpt id=\"p1\">[</bpt>GetQueues<ept id=\"p1\">](https://msdn.microsoft.com/library/hh293128.aspx)</ept>)",
      "pos": [
        13319,
        13406
      ]
    },
    {
      "content": "State management",
      "pos": [
        13409,
        13425
      ]
    },
    {
      "content": "No",
      "pos": [
        13428,
        13430
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        13433,
        13440
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Microsoft.ServiceBus.Messaging.EntityStatus.Active<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.entitystatus.aspx)</ept>, <bpt id=\"p2\">[</bpt>Microsoft.ServiceBus.Messaging.EntityStatus.Disabled<ept id=\"p2\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.entitystatus.aspx)</ept>, <bpt id=\"p3\">[</bpt>Microsoft.ServiceBus.Messaging.EntityStatus.SendDisabled<ept id=\"p3\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.entitystatus.aspx)</ept>, <bpt id=\"p4\">[</bpt>Microsoft.ServiceBus.Messaging.EntityStatus.ReceiveDisabled<ept id=\"p4\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.entitystatus.aspx)</ept>",
      "pos": [
        13450,
        14021
      ]
    },
    {
      "content": "Message auto-forwarding",
      "pos": [
        14024,
        14047
      ]
    },
    {
      "content": "No",
      "pos": [
        14050,
        14052
      ]
    },
    {
      "content": "Yes",
      "pos": [
        14057,
        14060
      ]
    },
    {
      "content": "Purge queue function",
      "pos": [
        14065,
        14085
      ]
    },
    {
      "content": "Yes",
      "pos": [
        14088,
        14091
      ]
    },
    {
      "content": "No",
      "pos": [
        14096,
        14098
      ]
    },
    {
      "content": "Message groups",
      "pos": [
        14103,
        14117
      ]
    },
    {
      "content": "No",
      "pos": [
        14120,
        14122
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        14125,
        14132
      ]
    },
    {
      "content": "(through the use of messaging sessions)",
      "pos": [
        14142,
        14181
      ]
    },
    {
      "content": "Application state per message group",
      "pos": [
        14184,
        14219
      ]
    },
    {
      "content": "No",
      "pos": [
        14222,
        14224
      ]
    },
    {
      "content": "Yes",
      "pos": [
        14229,
        14232
      ]
    },
    {
      "content": "Duplicate detection",
      "pos": [
        14237,
        14256
      ]
    },
    {
      "content": "No",
      "pos": [
        14259,
        14261
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        14264,
        14271
      ]
    },
    {
      "content": "(configurable on the sender side)",
      "pos": [
        14281,
        14314
      ]
    },
    {
      "content": "WCF integration",
      "pos": [
        14317,
        14332
      ]
    },
    {
      "content": "No",
      "pos": [
        14335,
        14337
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        14340,
        14347
      ]
    },
    {
      "content": "(offers out-of-the-box WCF bindings)",
      "pos": [
        14357,
        14393
      ]
    },
    {
      "content": "WF integration",
      "pos": [
        14396,
        14410
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Custom<ept id=\"p1\">**</ept>",
      "pos": [
        14411,
        14421
      ]
    },
    {
      "content": "(requires building a custom WF activity)",
      "pos": [
        14431,
        14471
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Native<ept id=\"p1\">**</ept>",
      "pos": [
        14472,
        14482
      ]
    },
    {
      "content": "(offers out-of-the-box WF activities)",
      "pos": [
        14492,
        14529
      ]
    },
    {
      "content": "Browsing message groups",
      "pos": [
        14532,
        14555
      ]
    },
    {
      "content": "No",
      "pos": [
        14558,
        14560
      ]
    },
    {
      "content": "Yes",
      "pos": [
        14565,
        14568
      ]
    },
    {
      "content": "Fetching message sessions by ID",
      "pos": [
        14573,
        14604
      ]
    },
    {
      "content": "No",
      "pos": [
        14607,
        14609
      ]
    },
    {
      "content": "Yes",
      "pos": [
        14614,
        14617
      ]
    },
    {
      "content": "Additional information",
      "pos": [
        14626,
        14648
      ]
    },
    {
      "content": "Both queuing technologies enable a message to be scheduled for delivery at a later time.",
      "pos": [
        14652,
        14740
      ]
    },
    {
      "content": "Queue auto-forwarding enables thousands of queues to auto-forward their messages to a single queue, from which the receiving application consumes the message.",
      "pos": [
        14744,
        14902
      ]
    },
    {
      "content": "You can use this mechanism to achieve security, control flow, and isolate storage between each message publisher.",
      "pos": [
        14903,
        15016
      ]
    },
    {
      "content": "Azure Queues provide support for updating message content.",
      "pos": [
        15020,
        15078
      ]
    },
    {
      "content": "You can use this functionality for persisting state information and incremental progress updates into the message so that it can be processed from the last known checkpoint, instead of starting from scratch.",
      "pos": [
        15079,
        15286
      ]
    },
    {
      "content": "With Service Bus queues, you can enable the same scenario through the use of message sessions.",
      "pos": [
        15287,
        15381
      ]
    },
    {
      "content": "Sessions enable you to save and retrieve the application processing state (by using <bpt id=\"p1\">[</bpt>SetState<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.messagesession.setstate.aspx)</ept> and <bpt id=\"p2\">[</bpt>GetState<ept id=\"p2\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.messagesession.getstate.aspx)</ept>).",
      "pos": [
        15382,
        15685
      ]
    },
    {
      "content": "Dead lettering, which is only supported by Service Bus queues, can be useful for isolating messages that cannot be processed successfully by the receiving application or when messages cannot reach their destination due to an expired time-to-live (TTL) property.",
      "pos": [
        15689,
        15950
      ]
    },
    {
      "content": "The TTL value specifies how long a message remains in the queue.",
      "pos": [
        15951,
        16015
      ]
    },
    {
      "content": "With Service Bus, the message will be moved to a special queue called $DeadLetterQueue when the TTL period expires.",
      "pos": [
        16016,
        16131
      ]
    },
    {
      "content": "To find “poison” messages in Azure Queues, when dequeuing a message the application examines the DequeueCount property of the message.",
      "pos": [
        16135,
        16269
      ]
    },
    {
      "content": "If DequeueCount is above a given threshold, the application moves the message to an application-defined “dead letter” queue.",
      "pos": [
        16270,
        16394
      ]
    },
    {
      "content": "Azure Queues enable you to obtain a detailed log of all of the transactions executed against the queue, as well as aggregated metrics.",
      "pos": [
        16398,
        16532
      ]
    },
    {
      "content": "Both of these options are useful for debugging and understanding how your application uses Azure Queues.",
      "pos": [
        16533,
        16637
      ]
    },
    {
      "content": "They are also useful for performance-tuning your application and reducing the costs of using queues.",
      "pos": [
        16638,
        16738
      ]
    },
    {
      "content": "The concept of “message sessions” supported by Service Bus allows messages that belong to a certain logical group to be associated with a given receiver, which in turn creates a session-like affinity between messages and their respective receivers.",
      "pos": [
        16742,
        16990
      ]
    },
    {
      "content": "You can enable this advanced functionality in Service Bus by setting the <bpt id=\"p1\">[</bpt>SessionID<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.sessionid.aspx)</ept> property on a message.",
      "pos": [
        16991,
        17196
      ]
    },
    {
      "content": "Receivers can then listen on a specific session ID and receive messages that share the specified session identifier.",
      "pos": [
        17197,
        17313
      ]
    },
    {
      "pos": [
        17317,
        17601
      ],
      "content": "The duplication detection functionality supported by Service Bus queues automatically removes duplicate messages sent to a queue or topic, based on the value of the <bpt id=\"p1\">[</bpt>MessageID<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.messageid.aspx)</ept> property."
    },
    {
      "content": "Capacity and quotas",
      "pos": [
        17606,
        17625
      ]
    },
    {
      "content": "This section compares Azure Queues and Service Bus queues from the perspective of capacity and quotas that may apply.",
      "pos": [
        17627,
        17744
      ]
    },
    {
      "content": "Comparison Criteria",
      "pos": [
        17747,
        17766
      ]
    },
    {
      "content": "Azure Queues",
      "pos": [
        17767,
        17779
      ]
    },
    {
      "content": "Service Bus Queues",
      "pos": [
        17780,
        17798
      ]
    },
    {
      "content": "Maximum queue size",
      "pos": [
        17815,
        17833
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>200 TB<ept id=\"p1\">**</ept>",
      "pos": [
        17834,
        17844
      ]
    },
    {
      "content": "(limited to a single storage account capacity)",
      "pos": [
        17854,
        17900
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>1 GB to 80 GB<ept id=\"p1\">**</ept>",
      "pos": [
        17901,
        17918
      ]
    },
    {
      "content": "(defined upon creation of a queue and <bpt id=\"p1\">[</bpt>enabling partitioning<ept id=\"p1\">](https://msdn.microsoft.com/library/dn520246.aspx)</ept> – see the “Additional Information” section)",
      "pos": [
        17928,
        18083
      ]
    },
    {
      "content": "Maximum message size",
      "pos": [
        18086,
        18106
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>64 KB<ept id=\"p1\">**</ept>",
      "pos": [
        18107,
        18116
      ]
    },
    {
      "content": "(48 KB when using <bpt id=\"p1\">**</bpt>Base64<ept id=\"p1\">**</ept> encoding)",
      "pos": [
        18126,
        18164
      ]
    },
    {
      "content": "Azure supports large messages by combining queues and blobs – at which point you can enqueue up to 200GB for a single item.",
      "pos": [
        18174,
        18297
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>256 KB<ept id=\"p1\">**</ept>",
      "pos": [
        18298,
        18308
      ]
    },
    {
      "content": "(including both header and body, maximum header size: 64 KB)",
      "pos": [
        18318,
        18378
      ]
    },
    {
      "content": "Maximum message TTL",
      "pos": [
        18381,
        18400
      ]
    },
    {
      "content": "7 days",
      "pos": [
        18403,
        18409
      ]
    },
    {
      "content": "Unlimited",
      "pos": [
        18414,
        18423
      ]
    },
    {
      "content": "Maximum number of queues",
      "pos": [
        18428,
        18452
      ]
    },
    {
      "content": "Unlimited",
      "pos": [
        18455,
        18464
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>10,000<ept id=\"p1\">**</ept>",
      "pos": [
        18467,
        18477
      ]
    },
    {
      "content": "(per service namespace, can be increased)",
      "pos": [
        18487,
        18528
      ]
    },
    {
      "content": "Maximum number of concurrent clients",
      "pos": [
        18531,
        18567
      ]
    },
    {
      "content": "Unlimited",
      "pos": [
        18570,
        18579
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Unlimited<ept id=\"p1\">**</ept>",
      "pos": [
        18582,
        18595
      ]
    },
    {
      "content": "(100 concurrent connection limit only applies to TCP protocol-based communication)",
      "pos": [
        18605,
        18687
      ]
    },
    {
      "content": "Additional information",
      "pos": [
        18694,
        18716
      ]
    },
    {
      "content": "Service Bus enforces queue size limits.",
      "pos": [
        18720,
        18759
      ]
    },
    {
      "content": "The maximum queue size is specified upon creation of the queue and can have a value between 1 and 80 GB.",
      "pos": [
        18760,
        18864
      ]
    },
    {
      "content": "If the queue size value set on creation of the queue is reached, additional incoming messages will be rejected and an exception will be received by the calling code.",
      "pos": [
        18865,
        19030
      ]
    },
    {
      "content": "For more information about quotas in Service Bus, see <bpt id=\"p1\">[</bpt>Service Bus Quotas<ept id=\"p1\">](https://msdn.microsoft.com/library/ee732538.aspx)</ept>.",
      "pos": [
        19031,
        19156
      ]
    },
    {
      "content": "You can create Service Bus queues in 1, 2, 3, 4, or 5 GB sizes (the default is 1 GB).",
      "pos": [
        19160,
        19245
      ]
    },
    {
      "content": "With partitioning enabled (which is the default), Service Bus creates 16 partitions for each GB you specify.",
      "pos": [
        19246,
        19354
      ]
    },
    {
      "content": "As such, if you create a queue that’s 5 GB in size, with 16 partitions the maximum queue size becomes (5 * 16) = 80 GB.",
      "pos": [
        19355,
        19474
      ]
    },
    {
      "content": "You can see the maximum size of your partitioned queue or topic by looking at its entry on the Azure management portal.",
      "pos": [
        19475,
        19594
      ]
    },
    {
      "content": "With Azure Queues, if the content of the message is not XML-safe, then it must be <bpt id=\"p1\">**</bpt>Base64<ept id=\"p1\">**</ept> encoded.",
      "pos": [
        19598,
        19699
      ]
    },
    {
      "content": "If you <bpt id=\"p1\">**</bpt>Base64<ept id=\"p1\">**</ept>-encode the message, the user payload can be up to 48 KB, instead of 64 KB.",
      "pos": [
        19700,
        19792
      ]
    },
    {
      "content": "With Service Bus queues, each message stored in a queue is comprised of two parts: a header and a body.",
      "pos": [
        19796,
        19899
      ]
    },
    {
      "content": "The total size of the message cannot exceed 256 KB.",
      "pos": [
        19900,
        19951
      ]
    },
    {
      "content": "When clients communicate with Service Bus queues over the TCP protocol, the maximum number of concurrent connections to a single Service Bus queue is limited to 100.",
      "pos": [
        19955,
        20120
      ]
    },
    {
      "content": "This number is shared between senders and receivers.",
      "pos": [
        20121,
        20173
      ]
    },
    {
      "content": "If this quota is reached, subsequent requests for additional connections will be rejected and an exception will be received by the calling code.",
      "pos": [
        20174,
        20318
      ]
    },
    {
      "content": "This limit is not imposed on clients connecting to the queues using REST-based API.",
      "pos": [
        20319,
        20402
      ]
    },
    {
      "content": "If you require more than 10,000 queues in a single Service Bus namespace, you can contact the Azure support team and request an increase.",
      "pos": [
        20406,
        20543
      ]
    },
    {
      "content": "To scale beyond 10,000 queues with Service Bus, you can also create additional namespaces using the Azure management portal.",
      "pos": [
        20544,
        20668
      ]
    },
    {
      "content": "Management and operations",
      "pos": [
        20673,
        20698
      ]
    },
    {
      "content": "This section compares the management features provided by Azure Queues and Service Bus queues.",
      "pos": [
        20700,
        20794
      ]
    },
    {
      "content": "Comparison Criteria",
      "pos": [
        20797,
        20816
      ]
    },
    {
      "content": "Azure Queues",
      "pos": [
        20817,
        20829
      ]
    },
    {
      "content": "Service Bus Queues",
      "pos": [
        20830,
        20848
      ]
    },
    {
      "content": "Management protocol",
      "pos": [
        20865,
        20884
      ]
    },
    {
      "content": "REST over HTTP/HTTPS",
      "pos": [
        20887,
        20907
      ]
    },
    {
      "content": "REST over HTTPS",
      "pos": [
        20912,
        20927
      ]
    },
    {
      "content": "Runtime protocol",
      "pos": [
        20932,
        20948
      ]
    },
    {
      "content": "REST over HTTP/HTTPS",
      "pos": [
        20951,
        20971
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>REST over HTTPS<ept id=\"p1\">**</ept>",
      "pos": [
        20974,
        20993
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>AMQP 1.0 Standard (TCP with TLS)<ept id=\"p1\">**</ept>",
      "pos": [
        21003,
        21039
      ]
    },
    {
      "content": ".NET Managed API",
      "pos": [
        21042,
        21058
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        21059,
        21066
      ]
    },
    {
      "content": "(.NET managed Storage Client API)",
      "pos": [
        21076,
        21109
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        21110,
        21117
      ]
    },
    {
      "content": "(.NET managed brokered messaging API)",
      "pos": [
        21127,
        21164
      ]
    },
    {
      "content": "Native C++",
      "pos": [
        21167,
        21177
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21180,
        21183
      ]
    },
    {
      "content": "No",
      "pos": [
        21188,
        21190
      ]
    },
    {
      "content": "Java API",
      "pos": [
        21195,
        21203
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21206,
        21209
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21214,
        21217
      ]
    },
    {
      "content": "PHP API",
      "pos": [
        21222,
        21229
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21232,
        21235
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21240,
        21243
      ]
    },
    {
      "content": "Node.js API",
      "pos": [
        21248,
        21259
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21262,
        21265
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21270,
        21273
      ]
    },
    {
      "content": "Arbitrary metadata support",
      "pos": [
        21278,
        21304
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21307,
        21310
      ]
    },
    {
      "content": "No",
      "pos": [
        21315,
        21317
      ]
    },
    {
      "content": "Queue naming rules",
      "pos": [
        21322,
        21340
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Up to 63 characters long<ept id=\"p1\">**</ept>",
      "pos": [
        21341,
        21369
      ]
    },
    {
      "content": "(letters in a queue name must be lowercase)",
      "pos": [
        21379,
        21422
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Up to 260 characters long<ept id=\"p1\">**</ept>",
      "pos": [
        21423,
        21452
      ]
    },
    {
      "content": "(queue names are case-insensitive)",
      "pos": [
        21462,
        21496
      ]
    },
    {
      "content": "Get queue length function",
      "pos": [
        21499,
        21524
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        21525,
        21532
      ]
    },
    {
      "content": "(approximate value if messages expire beyond the TTL without being deleted)",
      "pos": [
        21542,
        21617
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>",
      "pos": [
        21618,
        21625
      ]
    },
    {
      "content": "(exact, point-in-time value)",
      "pos": [
        21635,
        21663
      ]
    },
    {
      "content": "Peek function",
      "pos": [
        21666,
        21679
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21682,
        21685
      ]
    },
    {
      "content": "Yes",
      "pos": [
        21690,
        21693
      ]
    },
    {
      "content": "Additional information",
      "pos": [
        21702,
        21724
      ]
    },
    {
      "content": "Azure Queues provide support for arbitrary attributes that can be applied to the queue description, in the form of name/value pairs.",
      "pos": [
        21728,
        21860
      ]
    },
    {
      "content": "Both queue technologies offer the ability to peek a message without having to lock it, which can be useful when implementing a queue explorer/browser tool.",
      "pos": [
        21864,
        22019
      ]
    },
    {
      "content": "The Service Bus .NET brokered messaging APIs leverage full-duplex TCP connections for improved performance when compared to REST over HTTP, and they support the AMQP 1.0 standard protocol.",
      "pos": [
        22023,
        22211
      ]
    },
    {
      "content": "Azure queue names can be 3-63 characters long, can contain lowercase letters, numbers, and hyphens.",
      "pos": [
        22215,
        22314
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Naming Queues and Metadata<ept id=\"p1\">](https://msdn.microsoft.com/library/dd179349.aspx)</ept>.",
      "pos": [
        22315,
        22420
      ]
    },
    {
      "content": "Service Bus queue names can be up to 260 characters long and have less restrictive naming rules.",
      "pos": [
        22424,
        22520
      ]
    },
    {
      "content": "Service Bus queue names can contain letters, numbers, periods (.), hyphens (-), and underscores (_).",
      "pos": [
        22521,
        22621
      ]
    },
    {
      "content": "Performance",
      "pos": [
        22626,
        22637
      ]
    },
    {
      "content": "This section compares Azure Queues and Service Bus queues from a performance perspective.",
      "pos": [
        22639,
        22728
      ]
    },
    {
      "content": "Comparison Criteria",
      "pos": [
        22731,
        22750
      ]
    },
    {
      "content": "Azure Queues",
      "pos": [
        22751,
        22763
      ]
    },
    {
      "content": "Service Bus Queues",
      "pos": [
        22764,
        22782
      ]
    },
    {
      "content": "Maximum throughput",
      "pos": [
        22799,
        22817
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Up to 2,000 messages per second<ept id=\"p1\">**</ept>",
      "pos": [
        22818,
        22853
      ]
    },
    {
      "content": "(based on benchmark with 1 KB messages)",
      "pos": [
        22863,
        22902
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Up to 2,000 messages per second<ept id=\"p1\">**</ept>",
      "pos": [
        22903,
        22938
      ]
    },
    {
      "content": "(based on benchmark with 1 KB messages)",
      "pos": [
        22948,
        22987
      ]
    },
    {
      "content": "Average latency",
      "pos": [
        22990,
        23005
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>10 ms<ept id=\"p1\">**</ept>",
      "pos": [
        23006,
        23015
      ]
    },
    {
      "content": "(with <bpt id=\"p1\">[</bpt>TCP Nagle<ept id=\"p1\">](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/06/25/nagle-s-algorithm-is-not-friendly-towards-small-requests.aspx)</ept> disabled)",
      "pos": [
        23025,
        23178
      ]
    },
    {
      "content": "20-25 ms",
      "pos": [
        23181,
        23189
      ]
    },
    {
      "content": "Throttling behavior",
      "pos": [
        23194,
        23213
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Reject with HTTP 503 code<ept id=\"p1\">**</ept>",
      "pos": [
        23214,
        23243
      ]
    },
    {
      "content": "(throttled requests are not treated as billable)",
      "pos": [
        23253,
        23301
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Reject with exception/HTTP 503<ept id=\"p1\">**</ept>",
      "pos": [
        23302,
        23336
      ]
    },
    {
      "content": "(throttled requests are not treated as billable)",
      "pos": [
        23346,
        23394
      ]
    },
    {
      "content": "Additional information",
      "pos": [
        23401,
        23423
      ]
    },
    {
      "content": "A single Azure queue can process up to 2,000 transactions per second.",
      "pos": [
        23427,
        23496
      ]
    },
    {
      "content": "A transaction is either a <bpt id=\"p1\">**</bpt>Put<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Get<ept id=\"p2\">**</ept>, or <bpt id=\"p3\">**</bpt>Delete<ept id=\"p3\">**</ept> operation.",
      "pos": [
        23497,
        23565
      ]
    },
    {
      "content": "Sending a single message to a queue (<bpt id=\"p1\">**</bpt>Put<ept id=\"p1\">**</ept>) is counted as one transaction, but receiving a message is often a two-step process involving the retrieval (<bpt id=\"p2\">**</bpt>Get<ept id=\"p2\">**</ept>), followed by a request to remove the message from the queue (<bpt id=\"p3\">**</bpt>Delete<ept id=\"p3\">**</ept>).",
      "pos": [
        23566,
        23802
      ]
    },
    {
      "content": "As a result, a successful dequeue operation usually involves two transactions.",
      "pos": [
        23803,
        23881
      ]
    },
    {
      "content": "Retrieving multiple messages in a batch can reduce the impact of this, as you can <bpt id=\"p1\">**</bpt>Get<ept id=\"p1\">**</ept> up to 32 messages in a single transaction, followed by a <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept> for each of them.",
      "pos": [
        23882,
        24057
      ]
    },
    {
      "content": "For better throughput, you can create multiple queues (a storage account can have an unlimited number of queues).",
      "pos": [
        24058,
        24171
      ]
    },
    {
      "content": "When your application reaches the maximum throughput for an Azure queue, an “HTTP 503 Server Busy” response is usually returned from the queue service.",
      "pos": [
        24175,
        24326
      ]
    },
    {
      "content": "When this occurs, the application should trigger the retry logic with exponential back-off delay.",
      "pos": [
        24327,
        24424
      ]
    },
    {
      "content": "The latency of Azure Queues is 10 milliseconds on average when handling small messages (less than 10 KB) from a hosted service located in the same location (region) as the storage account.",
      "pos": [
        24428,
        24616
      ]
    },
    {
      "content": "Both Azure Queues and Service Bus queues enforce throttling behavior by rejecting requests to a queue that is being throttled.",
      "pos": [
        24620,
        24746
      ]
    },
    {
      "content": "However, neither of them treats throttled requests as billable.",
      "pos": [
        24747,
        24810
      ]
    },
    {
      "content": "Benchmarks against Service Bus queues have demonstrated that a single queue can achieve a message throughput of up to 2,000 messages per second with a message size of approximately 1 KB.",
      "pos": [
        24814,
        25000
      ]
    },
    {
      "content": "To achieve higher throughput, use multiple queues.",
      "pos": [
        25001,
        25051
      ]
    },
    {
      "content": "For more information about performance optimization with Service Bus, see <bpt id=\"p1\">[</bpt>Best Practices for Performance Improvements Using Service Bus Brokered Messaging<ept id=\"p1\">](https://msdn.microsoft.com/library/hh528527.aspx)</ept>.",
      "pos": [
        25052,
        25259
      ]
    },
    {
      "pos": [
        25263,
        25618
      ],
      "content": "When the maximum throughput is reached for a Service Bus queue, a <bpt id=\"p1\">[</bpt>ServerBusyException<ept id=\"p1\">](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.serverbusyexception.aspx)</ept> (when using the.NET brokered messaging API) or HTTP 503 (when using the REST-based API) response is returned to the queue client, indicating that the queue is being throttled."
    },
    {
      "content": "Authentication and authorization",
      "pos": [
        25623,
        25655
      ]
    },
    {
      "content": "This section discusses the authentication and authorization features supported by Azure Queues and Service Bus queues.",
      "pos": [
        25657,
        25775
      ]
    },
    {
      "content": "Comparison Criteria",
      "pos": [
        25778,
        25797
      ]
    },
    {
      "content": "Azure Queues",
      "pos": [
        25798,
        25810
      ]
    },
    {
      "content": "Service Bus Queues",
      "pos": [
        25811,
        25829
      ]
    },
    {
      "content": "Authentication",
      "pos": [
        25846,
        25860
      ]
    },
    {
      "content": "Symmetric key",
      "pos": [
        25863,
        25876
      ]
    },
    {
      "content": "Symmetric key",
      "pos": [
        25881,
        25894
      ]
    },
    {
      "content": "Access control model",
      "pos": [
        25899,
        25919
      ]
    },
    {
      "content": "Delegated access via SAS tokens.",
      "pos": [
        25920,
        25952
      ]
    },
    {
      "content": "RBAC via ACS",
      "pos": [
        25953,
        25965
      ]
    },
    {
      "content": "Identity provider federation",
      "pos": [
        25968,
        25996
      ]
    },
    {
      "content": "No",
      "pos": [
        25999,
        26001
      ]
    },
    {
      "content": "Yes",
      "pos": [
        26006,
        26009
      ]
    },
    {
      "content": "Additional information",
      "pos": [
        26018,
        26040
      ]
    },
    {
      "content": "Every request to either of the queuing technologies must be authenticated.",
      "pos": [
        26044,
        26118
      ]
    },
    {
      "content": "Public queues with anonymous access are not supported.",
      "pos": [
        26119,
        26173
      ]
    },
    {
      "content": "Using SAS, you can address this scenario by publishing a write-only SAS, read-only SAS, or even a full-access SAS.",
      "pos": [
        26174,
        26288
      ]
    },
    {
      "content": "The authentication scheme provided by Azure Queues involves the use of a symmetric key, which is a hash-based Message Authentication Code (HMAC), computed with the SHA-256 algorithm and encoded as a <bpt id=\"p1\">**</bpt>Base64<ept id=\"p1\">**</ept> string.",
      "pos": [
        26292,
        26509
      ]
    },
    {
      "content": "For more information about the respective protocol, see <bpt id=\"p1\">[</bpt>Authenticating Access to Your Storage Account<ept id=\"p1\">](https://msdn.microsoft.com/library/hh225339.aspx)</ept>.",
      "pos": [
        26510,
        26664
      ]
    },
    {
      "content": "Service Bus queues support a similar model using symmetric keys.",
      "pos": [
        26665,
        26729
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Shared Access Signature Authentication with Service Bus<ept id=\"p1\">](https://msdn.microsoft.com/library/dn170477.aspx)</ept>.",
      "pos": [
        26730,
        26864
      ]
    },
    {
      "pos": [
        26868,
        27114
      ],
      "content": "The Microsoft Azure Active Directory Access Control (also known as Access Control Service or ACS) supported by Service Bus offers three distinct roles: <bpt id=\"p1\">**</bpt>Admin<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Sender<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Receiver<ept id=\"p3\">**</ept>, which is not supported at this time for Azure Queues."
    },
    {
      "content": "Because Service Bus offers ACS integration, it enables you to federate with Active Directory (through the use of ADFS) and other common web identity providers.",
      "pos": [
        27118,
        27277
      ]
    },
    {
      "content": "Cost",
      "pos": [
        27282,
        27286
      ]
    },
    {
      "content": "This section compares Azure Queues and Service Bus queues from a cost perspective.",
      "pos": [
        27288,
        27370
      ]
    },
    {
      "content": "Comparison Criteria",
      "pos": [
        27373,
        27392
      ]
    },
    {
      "content": "Azure Queues",
      "pos": [
        27393,
        27405
      ]
    },
    {
      "content": "Service Bus Queues",
      "pos": [
        27406,
        27424
      ]
    },
    {
      "content": "Queue transaction cost",
      "pos": [
        27441,
        27463
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>$0.0005<ept id=\"p1\">**</ept>",
      "pos": [
        27464,
        27475
      ]
    },
    {
      "content": "(per 10,000 transactions)",
      "pos": [
        27485,
        27510
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Basic tier<ept id=\"p1\">**</ept>: <bpt id=\"p2\">**</bpt>$0.05<ept id=\"p2\">**</ept>",
      "pos": [
        27511,
        27536
      ]
    },
    {
      "content": "(per million operations)",
      "pos": [
        27546,
        27570
      ]
    },
    {
      "content": "Billable operations",
      "pos": [
        27573,
        27592
      ]
    },
    {
      "content": "All",
      "pos": [
        27595,
        27598
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Send/Receive only<ept id=\"p1\">**</ept>",
      "pos": [
        27601,
        27622
      ]
    },
    {
      "content": "(no charge for other operations)",
      "pos": [
        27632,
        27664
      ]
    },
    {
      "content": "Idle transactions",
      "pos": [
        27667,
        27684
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Billable<ept id=\"p1\">**</ept>",
      "pos": [
        27685,
        27697
      ]
    },
    {
      "content": "(querying an empty queue is counted as a billable transaction)",
      "pos": [
        27707,
        27769
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Billable<ept id=\"p1\">**</ept>",
      "pos": [
        27770,
        27782
      ]
    },
    {
      "content": "(a receive against an empty queue is considered a billable message)",
      "pos": [
        27792,
        27859
      ]
    },
    {
      "content": "Storage cost",
      "pos": [
        27862,
        27874
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>$0.07<ept id=\"p1\">**</ept>",
      "pos": [
        27875,
        27884
      ]
    },
    {
      "content": "(per GB/month)",
      "pos": [
        27894,
        27908
      ]
    },
    {
      "content": "$0.00",
      "pos": [
        27911,
        27916
      ]
    },
    {
      "content": "Outbound data transfer costs",
      "pos": [
        27921,
        27949
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>$0.12 - $0.19<ept id=\"p1\">**</ept>",
      "pos": [
        27950,
        27967
      ]
    },
    {
      "content": "(depending on geography)",
      "pos": [
        27977,
        28001
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>$0.12 - $0.19<ept id=\"p1\">**</ept>",
      "pos": [
        28002,
        28019
      ]
    },
    {
      "content": "(depending on geography)",
      "pos": [
        28029,
        28053
      ]
    },
    {
      "content": "Additional information",
      "pos": [
        28060,
        28082
      ]
    },
    {
      "content": "Data transfers are charged based on the total amount of data leaving the Azure datacenters via the internet in a given billing period.",
      "pos": [
        28086,
        28220
      ]
    },
    {
      "content": "Data transfers between Azure services located within the same region are not subject to charge.",
      "pos": [
        28224,
        28319
      ]
    },
    {
      "content": "As of this writing, all inbound data transfers are not subject to charge.",
      "pos": [
        28323,
        28396
      ]
    },
    {
      "content": "Given the support for long polling, using Service Bus queues can be cost effective in situations where low-latency delivery is required.",
      "pos": [
        28400,
        28536
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> All costs are subject to change.",
      "pos": [
        28539,
        28584
      ]
    },
    {
      "content": "This table reflects current pricing as of the writing of this article and does not include any promotional offers that may currently be available.",
      "pos": [
        28585,
        28731
      ]
    },
    {
      "content": "For up-to-date information about Azure pricing, see the <bpt id=\"p1\">[</bpt>Azure pricing<ept id=\"p1\">](http://azure.microsoft.com/pricing/)</ept> page.",
      "pos": [
        28732,
        28846
      ]
    },
    {
      "content": "For more information about Service Bus pricing, see [Service Bus pricing]((http://azure.microsoft.com/pricing/details/service-bus/).",
      "pos": [
        28847,
        28979
      ]
    },
    {
      "content": "Conclusion",
      "pos": [
        28984,
        28994
      ]
    },
    {
      "content": "By gaining a deeper understanding of the two technologies, you will be able to make a more informed decision on which queue technology to use, and when.",
      "pos": [
        28996,
        29148
      ]
    },
    {
      "content": "The decision on when to use Azure Queues or Service Bus queues clearly depends on a number of factors.",
      "pos": [
        29149,
        29251
      ]
    },
    {
      "content": "These factors may depend heavily on the individual needs of your application and its architecture.",
      "pos": [
        29252,
        29350
      ]
    },
    {
      "content": "If your application already uses the core capabilities of Microsoft Azure, you may prefer to choose Azure Queues, especially if you require basic communication and messaging between services or need queues that can be larger than 80 GB in size.",
      "pos": [
        29351,
        29595
      ]
    },
    {
      "content": "Because Service Bus queues provide a number of advanced features, such as sessions, transactions, duplicate detection, automatic dead-lettering, and durable publish/subscribe capabilities, they may be a preferred choice if you are building a hybrid application or if your application otherwise requires these features.",
      "pos": [
        29597,
        29915
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        29920,
        29930
      ]
    },
    {
      "content": "The following articles provide more guidance and information about using Azure Queues or Service Bus queues.",
      "pos": [
        29932,
        30040
      ]
    },
    {
      "content": "How to Use Service Bus Queues",
      "pos": [
        30045,
        30074
      ]
    },
    {
      "content": "How to Use the Queue Storage Service",
      "pos": [
        30120,
        30156
      ]
    },
    {
      "content": "Best Practices for Performance Improvements Using Service Bus Brokered Messaging",
      "pos": [
        30201,
        30281
      ]
    },
    {
      "content": "Introducing Queues and Topics in Azure Service Bus",
      "pos": [
        30336,
        30386
      ]
    },
    {
      "content": "The Developer's Guide to Service Bus",
      "pos": [
        30450,
        30486
      ]
    },
    {
      "content": "\"Azure Tables and Queues Deep Dive\"",
      "pos": [
        30528,
        30563
      ]
    },
    {
      "content": "Azure Storage Architecture",
      "pos": [
        30608,
        30634
      ]
    },
    {
      "content": "Using the Queuing Service in Azure",
      "pos": [
        30795,
        30829
      ]
    },
    {
      "content": "Understanding Azure Storage Billing – Bandwidth, Transactions, and Capacity",
      "pos": [
        30926,
        31001
      ]
    }
  ],
  "content": "<properties \n   pageTitle=\"Azure Queues and Service Bus queues - compared and contrasted\"\n   description=\"Analyzes differences and similarities between two types of queues offered by Azure.\"\n   services=\"service-bus\"\n   documentationCenter=\"na\"\n   authors=\"sethmanheim\"\n   manager=\"timlt\"\n   editor=\"tysonn\" />\n<tags \n   ms.service=\"service-bus\"\n   ms.devlang=\"na\"\n   ms.topic=\"article\"\n   ms.tgt_pltfrm=\"na\"\n   ms.workload=\"tbd\"\n   ms.date=\"08/25/2015\"\n   ms.author=\"sethm\" />\n\n# Azure Queues and Service Bus queues - compared and contrasted\n\nThis article analyzes the differences and similarities between the two types of queues offered by Microsoft Azure today: Azure Queues and Service Bus queues. By using this information, you can compare and contrast the respective technologies and be able to make a more informed decision about which solution best meets your needs.\n\n## Introduction\n\nMicrosoft Azure supports two types of queue mechanisms: **Azure Queues** and **Service Bus Queues**.\n\n**Azure Queues**, which are part of the [Azure storage](http://azure.microsoft.com/services/storage/) infrastructure, feature a simple REST-based Get/Put/Peek interface, providing reliable, persistent messaging within and between services.\n\n**Service Bus queues** are part of a broader [Azure messaging](http://azure.microsoft.com/services/messaging/) infrastructure that supports queuing as well as publish/subscribe, Web service remoting, and integration patterns. For more information about Service Bus queues, topics/subscriptions, and relays, see [Overview of Service Bus Messaging Patterns](https://msdn.microsoft.com/library/hh410103.aspx).\n\nWhile both queuing technologies exist concurrently, Azure Queues were introduced first, as a dedicated queue storage mechanism built on top of the Azure storage services. Service Bus queues are built on top of the broader \"brokered messaging\" infrastructure designed to integrate applications or application components that may span multiple communication protocols, data contracts, trust domains, and/or network environments.\n\nThis article compares the two queue technologies offered by Azure by discussing the differences in the behavior and implementation of the features provided by each. The article also provides guidance for choosing which features might best suit your application development needs.\n\n## Technology selection considerations\n\nBoth Azure Queues and Service Bus queues are implementations of the message queuing service currently offered on Microsoft Azure. Each has a slightly different feature set, which means you can choose one or the other, or use both, depending on the needs of your particular solution or business/technical problem you are solving.\n\nWhen determining which queuing technology fits the purpose for a given solution, solution architects and developers should consider the recommendations below. For more details, see the next section.\n\nAs a solution architect/developer, **you should consider using Azure Queues** when:\n\n- Your application must store over 80 GB of messages in a queue, where the messages have a lifetime shorter than 7 days.\n\n- Your application wants to track progress for processing a message inside of the queue. This is useful if the worker processing a message crashes. A subsequent worker can then use that information to continue from where the prior worker left off.\n\n- You require server side logs of all of the transactions executed against your queues.\n\nAs a solution architect/developer, **you should consider using Service Bus queues** when:\n\n- Your solution must be able to receive messages without having to poll the queue. With Service Bus, this can be achieved through the use of the long-polling receive operation using the TCP-based protocols that Service Bus supports.\n\n- Your solution requires the queue to provide a guaranteed first-in-first-out (FIFO) ordered delivery.\n\n- You want a symmetric experience in Azure and on Windows Server (private cloud). For more information, see [Service Bus for Windows Server](https://msdn.microsoft.com/library/dn282144.aspx).\n\n- Your solution must be able to support automatic duplicate detection.\n\n- You want your application to process messages as parallel long-running streams (messages are associated with a stream using the [SessionId](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.sessionid.aspx) property on the message). In this model, each node in the consuming application competes for streams, as opposed to messages. When a stream is given to a consuming node, the node can examine the state of the application stream state using transactions.\n\n- Your solution requires transactional behavior and atomicity when sending or receiving multiple messages from a queue.\n\n- The time-to-live (TTL) characteristic of the application-specific workload can exceed the 7-day period.\n\n- Your application handles messages that can exceed 64 KB but will not likely approach the 256 KB limit.\n\n- You deal with a requirement to provide a role-based access model to the queues, and different rights/permissions for senders and receivers.\n\n- Your queue size will not grow larger than 80 GB.\n\n- You want to use the AMQP 1.0 standards-based messaging broker. For more information about AMQP, see [Service Bus AMQP Overview](https://msdn.microsoft.com/library/jj841072.aspx).\n\n- You can envision an eventual migration from queue-based point-to-point communication to a message exchange pattern that enables seamless integration of additional receivers (subscribers), each of which receives independent copies of either some or all messages sent to the queue. The latter refers to the publish/subscribe capability natively provided by Service Bus.\n\n- Your messaging solution must be able to support the “At-Most-Once” delivery guarantee without the need for you to build the additional infrastructure components.\n\n- You would like to be able to publish and consume batches of messages.\n\n- You require full integration with the Windows Communication Foundation (WCF) communication stack in the .NET Framework.\n\n## Comparing Azure Queues and Service Bus Queues\n\nThe tables in the following sections provide a logical grouping of queue features and let you compare, at a glance, the capabilities available in both Azure Queues and Service Bus queues.\n\n## Foundational capabilities\n\nThis section compares some of the fundamental queuing capabilities provided by Azure Queues and Service Bus queues.\n\n|Comparison Criteria|Azure Queues|Service Bus Queues|\n|---|---|---|\n|Ordering guarantee|**No** <br/><br>For more information, see the first note in the “Additional Information” section.</br>|**Yes - First-In-First-Out (FIFO)**<br/><br>(through the use of messaging sessions)|\n|Delivery guarantee|**At-Least-Once**|**At-Least-Once**<br/><br/>**At-Most-Once**|\n|Transaction support|**No**|**Yes**<br/><br/>(through the use of local transactions)|\n|Receive behavior|**Non-blocking**<br/><br/>(completes immediately if no new message is found)|**Blocking with/without timeout**<br/><br/>(offers long polling, or the [\"Comet technique\"](http://go.microsoft.com/fwlink/?LinkId=613759))<br/><br/>**Non-blocking**<br/><br/>(through the use of .NET managed API only)|\n|Push-style API|**No**|**Yes**<br/><br/>[OnMessage](https://msdn.microsoft.com/library/jj908682.aspx) and [OnMessage sessions](https://msdn.microsoft.com/library/dn790528.aspx) .NET API.|\n|Receive mode|**Peek & Lease**|**Peek & Lock**<br/><br/>**Receive & Delete**|\n|Exclusive access mode|**Lease-based**|**Lock-based**|\n|Lease/Lock duration|**30 seconds (default)**<br/><br/>**7 days (maximum)** (You can renew or release a message lease using the [UpdateMessage](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.queue.cloudqueue.updatemessage.aspx) API.)|**60 seconds (default)**<br/><br/>You can renew a message lock using the [RenewLock](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.renewlock.aspx) API.|\n|Lease/Lock precision|**Message level**<br/><br/>(each message can have a different timeout value, which you can then update as needed while processing the message, by using the [UpdateMessage](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.updatemessage.aspx) API)|**Queue level**<br/><br/>(each queue has a lock precision applied to all of its messages, but you can renew the lock using the [RenewLock](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.renewlock.aspx) API.)|\n|Batched receive|**Yes**<br/><br/>(explicitly specifying message count when retrieving messages, up to a maximum of 32 messages)|**Yes**<br/><br/>(implicitly enabling a pre-fetch property or explicitly through the use of transactions)|\n|Batched send|**No**|**Yes**<br/><br/>(through the use of transactions or client-side batching)|\n\n### Additional information\n\n- Messages in Azure Queues are typically first-in-first-out, but sometimes they can be out of order; for example, when a message’s visibility timeout duration expires (for example, as a result of a client application crashing during processing). When the visibility timeout expires, the message becomes visible again on the queue for another worker to dequeue it. At that point, the newly visible message might be placed in the queue (to be dequeued again) after a message that was originally enqueued after it.\n\n- If you are already using Azure Storage Blobs or Tables and you start using queues, you are guaranteed 99.9% availability. If you use Blobs or Tables with Service Bus queues, you will have lower availability.\n\n- The guaranteed FIFO pattern in Service Bus queues requires the use of messaging sessions. In the event that the application crashes while processing a message received in the **Peek & Lock** mode, the next time a queue receiver accepts a messaging session, it will start with the failed message after its time-to-live (TTL) period expires.\n\n- Azure Queues are designed to support standard queuing scenarios, such as decoupling application components to increase scalability and tolerance for failures, load leveling, and building process workflows.\n\n- Service Bus queues support the *At-Least-Once* delivery guarantee. In addition, the *At-Most-Once* semantic can be supported by using session state to store the application state and by using transactions to atomically receive messages and update the session state. The Azure Workflow Service uses this technique to guarantee At-Most-Once delivery.\n\n- Azure Queues provide a uniform and consistent programming model across queues, tables, and BLOBs – both for developers and for operations teams.\n\n- Service Bus queues provide support for local transactions in the context of a single queue.\n\n- The *Receive and Delete* mode supported by Service Bus provides the ability to reduce the messaging operation count (and associated cost) in exchange for lowered delivery assurance.\n\n- Azure Queues provide leases with the ability to extend the leases for messages. This allows the workers to maintain short leases on messages. Thus, if a worker crashes, the message can be quickly processed again by another worker. In addition, a worker can extend the lease on a message if it needs to process it longer than the current lease time.\n\n- Azure Queues offer a visibility timeout that you can set upon the enqueueing or dequeuing of a message. In addition, you can update a message with different lease values at runtime, and update different values across messages in the same queue. Service Bus lock timeouts are defined in the queue metadata; however, you can renew the lock by calling the [RenewLock](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.renewlock.aspx) method.\n\n- The maximum timeout for a blocking receive operation in Service Bus queues is 24 days. However, REST-based timeouts have a maximum value of 55 seconds.\n\n- Client-side batching provided by Service Bus enables a queue client to batch multiple messages into a single send operation. Batching is only available for asynchronous send operations.\n\n- Features such as the 200TB ceiling of Azure Queues (more when you virtualize accounts) and unlimited queues make it an ideal platform for SaaS providers.\n\n- Azure Queues provide a flexible and performant delegated access control mechanism.\n\n## Advanced capabilities\n\nThis section compares advanced capabilities provided by Azure Queues and Service Bus queues.\n\n|Comparison Criteria|Azure Queues|Service Bus Queues|\n|---|---|---|\n|Scheduled delivery|**Yes**|**Yes**|\n|Automatic dead lettering|**No**|**Yes**|\n|Increasing queue time-to-live value|**Yes**<br/><br/>(via in-place update of visibility timeout)|**Yes**<br/><br/>(provided via a dedicated API function)|\n|Poison message support|**Yes**|**Yes**|\n|In-place update|**Yes**|**Yes**|\n|Server-side transaction log|**Yes**|**No**|\n|Storage metrics|**Yes**<br/><br/>**Minute Metrics**: provides real-time metrics for availability, TPS, API call counts, error counts, and more, all in real time (aggregated per minute and reported within a few minutes from what just happened in production. For more information, see [About Storage Analytics Metrics](https://msdn.microsoft.com/library/hh343258.aspx).|**Yes**<br/><br/>(bulk queries by calling [GetQueues](https://msdn.microsoft.com/library/hh293128.aspx))|\n|State management|**No**|**Yes**<br/><br/>[Microsoft.ServiceBus.Messaging.EntityStatus.Active](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.entitystatus.aspx), [Microsoft.ServiceBus.Messaging.EntityStatus.Disabled](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.entitystatus.aspx), [Microsoft.ServiceBus.Messaging.EntityStatus.SendDisabled](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.entitystatus.aspx), [Microsoft.ServiceBus.Messaging.EntityStatus.ReceiveDisabled](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.entitystatus.aspx)|\n|Message auto-forwarding|**No**|**Yes**|\n|Purge queue function|**Yes**|**No**|\n|Message groups|**No**|**Yes**<br/><br/>(through the use of messaging sessions)|\n|Application state per message group|**No**|**Yes**|\n|Duplicate detection|**No**|**Yes**<br/><br/>(configurable on the sender side)|\n|WCF integration|**No**|**Yes**<br/><br/>(offers out-of-the-box WCF bindings)|\n|WF integration|**Custom**<br/><br/>(requires building a custom WF activity)|**Native**<br/><br/>(offers out-of-the-box WF activities)|\n|Browsing message groups|**No**|**Yes**|\n|Fetching message sessions by ID|**No**|**Yes**|\n\n### Additional information\n\n- Both queuing technologies enable a message to be scheduled for delivery at a later time.\n\n- Queue auto-forwarding enables thousands of queues to auto-forward their messages to a single queue, from which the receiving application consumes the message. You can use this mechanism to achieve security, control flow, and isolate storage between each message publisher.\n\n- Azure Queues provide support for updating message content. You can use this functionality for persisting state information and incremental progress updates into the message so that it can be processed from the last known checkpoint, instead of starting from scratch. With Service Bus queues, you can enable the same scenario through the use of message sessions. Sessions enable you to save and retrieve the application processing state (by using [SetState](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.messagesession.setstate.aspx) and [GetState](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.messagesession.getstate.aspx)).\n\n- Dead lettering, which is only supported by Service Bus queues, can be useful for isolating messages that cannot be processed successfully by the receiving application or when messages cannot reach their destination due to an expired time-to-live (TTL) property. The TTL value specifies how long a message remains in the queue. With Service Bus, the message will be moved to a special queue called $DeadLetterQueue when the TTL period expires.\n\n- To find “poison” messages in Azure Queues, when dequeuing a message the application examines the DequeueCount property of the message. If DequeueCount is above a given threshold, the application moves the message to an application-defined “dead letter” queue.\n\n- Azure Queues enable you to obtain a detailed log of all of the transactions executed against the queue, as well as aggregated metrics. Both of these options are useful for debugging and understanding how your application uses Azure Queues. They are also useful for performance-tuning your application and reducing the costs of using queues.\n\n- The concept of “message sessions” supported by Service Bus allows messages that belong to a certain logical group to be associated with a given receiver, which in turn creates a session-like affinity between messages and their respective receivers. You can enable this advanced functionality in Service Bus by setting the [SessionID](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.sessionid.aspx) property on a message. Receivers can then listen on a specific session ID and receive messages that share the specified session identifier.\n\n- The duplication detection functionality supported by Service Bus queues automatically removes duplicate messages sent to a queue or topic, based on the value of the [MessageID](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.brokeredmessage.messageid.aspx) property.\n\n## Capacity and quotas\n\nThis section compares Azure Queues and Service Bus queues from the perspective of capacity and quotas that may apply.\n\n|Comparison Criteria|Azure Queues|Service Bus Queues|\n|---|---|---|\n|Maximum queue size|**200 TB**<br/><br/>(limited to a single storage account capacity)|**1 GB to 80 GB**<br/><br/>(defined upon creation of a queue and [enabling partitioning](https://msdn.microsoft.com/library/dn520246.aspx) – see the “Additional Information” section)|\n|Maximum message size|**64 KB**<br/><br/>(48 KB when using **Base64** encoding)<br/><br/>Azure supports large messages by combining queues and blobs – at which point you can enqueue up to 200GB for a single item.|**256 KB**<br/><br/>(including both header and body, maximum header size: 64 KB)|\n|Maximum message TTL|**7 days**|**Unlimited**|\n|Maximum number of queues|**Unlimited**|**10,000**<br/><br/>(per service namespace, can be increased)|\n|Maximum number of concurrent clients|**Unlimited**|**Unlimited**<br/><br/>(100 concurrent connection limit only applies to TCP protocol-based communication)|\n\n### Additional information\n\n- Service Bus enforces queue size limits. The maximum queue size is specified upon creation of the queue and can have a value between 1 and 80 GB. If the queue size value set on creation of the queue is reached, additional incoming messages will be rejected and an exception will be received by the calling code. For more information about quotas in Service Bus, see [Service Bus Quotas](https://msdn.microsoft.com/library/ee732538.aspx).\n\n- You can create Service Bus queues in 1, 2, 3, 4, or 5 GB sizes (the default is 1 GB). With partitioning enabled (which is the default), Service Bus creates 16 partitions for each GB you specify. As such, if you create a queue that’s 5 GB in size, with 16 partitions the maximum queue size becomes (5 * 16) = 80 GB. You can see the maximum size of your partitioned queue or topic by looking at its entry on the Azure management portal.\n\n- With Azure Queues, if the content of the message is not XML-safe, then it must be **Base64** encoded. If you **Base64**-encode the message, the user payload can be up to 48 KB, instead of 64 KB.\n\n- With Service Bus queues, each message stored in a queue is comprised of two parts: a header and a body. The total size of the message cannot exceed 256 KB.\n\n- When clients communicate with Service Bus queues over the TCP protocol, the maximum number of concurrent connections to a single Service Bus queue is limited to 100. This number is shared between senders and receivers. If this quota is reached, subsequent requests for additional connections will be rejected and an exception will be received by the calling code. This limit is not imposed on clients connecting to the queues using REST-based API.\n\n- If you require more than 10,000 queues in a single Service Bus namespace, you can contact the Azure support team and request an increase. To scale beyond 10,000 queues with Service Bus, you can also create additional namespaces using the Azure management portal.\n\n## Management and operations\n\nThis section compares the management features provided by Azure Queues and Service Bus queues.\n\n|Comparison Criteria|Azure Queues|Service Bus Queues|\n|---|---|---|\n|Management protocol|**REST over HTTP/HTTPS**|**REST over HTTPS**|\n|Runtime protocol|**REST over HTTP/HTTPS**|**REST over HTTPS**<br/><br/>**AMQP 1.0 Standard (TCP with TLS)**|\n|.NET Managed API|**Yes**<br/><br/>(.NET managed Storage Client API)|**Yes**<br/><br/>(.NET managed brokered messaging API)|\n|Native C++|**Yes**|**No**|\n|Java API|**Yes**|**Yes**|\n|PHP API|**Yes**|**Yes**|\n|Node.js API|**Yes**|**Yes**|\n|Arbitrary metadata support|**Yes**|**No**|\n|Queue naming rules|**Up to 63 characters long**<br/><br/>(letters in a queue name must be lowercase)|**Up to 260 characters long**<br/><br/>(queue names are case-insensitive)|\n|Get queue length function|**Yes**<br/><br/>(approximate value if messages expire beyond the TTL without being deleted)|**Yes**<br/><br/>(exact, point-in-time value)|\n|Peek function|**Yes**|**Yes**|\n\n### Additional information\n\n- Azure Queues provide support for arbitrary attributes that can be applied to the queue description, in the form of name/value pairs.\n\n- Both queue technologies offer the ability to peek a message without having to lock it, which can be useful when implementing a queue explorer/browser tool.\n\n- The Service Bus .NET brokered messaging APIs leverage full-duplex TCP connections for improved performance when compared to REST over HTTP, and they support the AMQP 1.0 standard protocol.\n\n- Azure queue names can be 3-63 characters long, can contain lowercase letters, numbers, and hyphens. For more information, see [Naming Queues and Metadata](https://msdn.microsoft.com/library/dd179349.aspx).\n\n- Service Bus queue names can be up to 260 characters long and have less restrictive naming rules. Service Bus queue names can contain letters, numbers, periods (.), hyphens (-), and underscores (_).\n\n## Performance\n\nThis section compares Azure Queues and Service Bus queues from a performance perspective.\n\n|Comparison Criteria|Azure Queues|Service Bus Queues|\n|---|---|---|\n|Maximum throughput|**Up to 2,000 messages per second**<br/><br/>(based on benchmark with 1 KB messages)|**Up to 2,000 messages per second**<br/><br/>(based on benchmark with 1 KB messages)|\n|Average latency|**10 ms**<br/><br/>(with [TCP Nagle](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/06/25/nagle-s-algorithm-is-not-friendly-towards-small-requests.aspx) disabled)|**20-25 ms**|\n|Throttling behavior|**Reject with HTTP 503 code**<br/><br/>(throttled requests are not treated as billable)|**Reject with exception/HTTP 503**<br/><br/>(throttled requests are not treated as billable)|\n\n### Additional information\n\n- A single Azure queue can process up to 2,000 transactions per second. A transaction is either a **Put**, **Get**, or **Delete** operation. Sending a single message to a queue (**Put**) is counted as one transaction, but receiving a message is often a two-step process involving the retrieval (**Get**), followed by a request to remove the message from the queue (**Delete**). As a result, a successful dequeue operation usually involves two transactions. Retrieving multiple messages in a batch can reduce the impact of this, as you can **Get** up to 32 messages in a single transaction, followed by a **Delete** for each of them. For better throughput, you can create multiple queues (a storage account can have an unlimited number of queues).\n\n- When your application reaches the maximum throughput for an Azure queue, an “HTTP 503 Server Busy” response is usually returned from the queue service. When this occurs, the application should trigger the retry logic with exponential back-off delay.\n\n- The latency of Azure Queues is 10 milliseconds on average when handling small messages (less than 10 KB) from a hosted service located in the same location (region) as the storage account.\n\n- Both Azure Queues and Service Bus queues enforce throttling behavior by rejecting requests to a queue that is being throttled. However, neither of them treats throttled requests as billable.\n\n- Benchmarks against Service Bus queues have demonstrated that a single queue can achieve a message throughput of up to 2,000 messages per second with a message size of approximately 1 KB. To achieve higher throughput, use multiple queues. For more information about performance optimization with Service Bus, see [Best Practices for Performance Improvements Using Service Bus Brokered Messaging](https://msdn.microsoft.com/library/hh528527.aspx).\n\n- When the maximum throughput is reached for a Service Bus queue, a [ServerBusyException](https://msdn.microsoft.com/library/microsoft.servicebus.messaging.serverbusyexception.aspx) (when using the.NET brokered messaging API) or HTTP 503 (when using the REST-based API) response is returned to the queue client, indicating that the queue is being throttled.\n\n## Authentication and authorization\n\nThis section discusses the authentication and authorization features supported by Azure Queues and Service Bus queues.\n\n|Comparison Criteria|Azure Queues|Service Bus Queues|\n|---|---|---|\n|Authentication|**Symmetric key**|**Symmetric key**|\n|Access control model|Delegated access via SAS tokens.|RBAC via ACS|\n|Identity provider federation|**No**|**Yes**|\n\n### Additional information\n\n- Every request to either of the queuing technologies must be authenticated. Public queues with anonymous access are not supported. Using SAS, you can address this scenario by publishing a write-only SAS, read-only SAS, or even a full-access SAS.\n\n- The authentication scheme provided by Azure Queues involves the use of a symmetric key, which is a hash-based Message Authentication Code (HMAC), computed with the SHA-256 algorithm and encoded as a **Base64** string. For more information about the respective protocol, see [Authenticating Access to Your Storage Account](https://msdn.microsoft.com/library/hh225339.aspx). Service Bus queues support a similar model using symmetric keys. For more information, see [Shared Access Signature Authentication with Service Bus](https://msdn.microsoft.com/library/dn170477.aspx).\n\n- The Microsoft Azure Active Directory Access Control (also known as Access Control Service or ACS) supported by Service Bus offers three distinct roles: **Admin**, **Sender**, and **Receiver**, which is not supported at this time for Azure Queues.\n\n- Because Service Bus offers ACS integration, it enables you to federate with Active Directory (through the use of ADFS) and other common web identity providers.\n\n## Cost\n\nThis section compares Azure Queues and Service Bus queues from a cost perspective.\n\n|Comparison Criteria|Azure Queues|Service Bus Queues|\n|---|---|---|\n|Queue transaction cost|**$0.0005**<br/><br/>(per 10,000 transactions)|**Basic tier**: **$0.05**<br/><br/>(per million operations)|\n|Billable operations|**All**|**Send/Receive only**<br/><br/>(no charge for other operations)|\n|Idle transactions|**Billable**<br/><br/>(querying an empty queue is counted as a billable transaction)|**Billable**<br/><br/>(a receive against an empty queue is considered a billable message)|\n|Storage cost|**$0.07**<br/><br/>(per GB/month)|**$0.00**|\n|Outbound data transfer costs|**$0.12 - $0.19**<br/><br/>(depending on geography)|**$0.12 - $0.19**<br/><br/>(depending on geography)|\n\n### Additional information\n\n- Data transfers are charged based on the total amount of data leaving the Azure datacenters via the internet in a given billing period.\n\n- Data transfers between Azure services located within the same region are not subject to charge.\n\n- As of this writing, all inbound data transfers are not subject to charge.\n\n- Given the support for long polling, using Service Bus queues can be cost effective in situations where low-latency delivery is required.\n\n>[AZURE.NOTE] All costs are subject to change. This table reflects current pricing as of the writing of this article and does not include any promotional offers that may currently be available. For up-to-date information about Azure pricing, see the [Azure pricing](http://azure.microsoft.com/pricing/) page. For more information about Service Bus pricing, see [Service Bus pricing]((http://azure.microsoft.com/pricing/details/service-bus/).\n\n## Conclusion\n\nBy gaining a deeper understanding of the two technologies, you will be able to make a more informed decision on which queue technology to use, and when. The decision on when to use Azure Queues or Service Bus queues clearly depends on a number of factors. These factors may depend heavily on the individual needs of your application and its architecture. If your application already uses the core capabilities of Microsoft Azure, you may prefer to choose Azure Queues, especially if you require basic communication and messaging between services or need queues that can be larger than 80 GB in size.\n\nBecause Service Bus queues provide a number of advanced features, such as sessions, transactions, duplicate detection, automatic dead-lettering, and durable publish/subscribe capabilities, they may be a preferred choice if you are building a hybrid application or if your application otherwise requires these features.\n\n## Next steps\n\nThe following articles provide more guidance and information about using Azure Queues or Service Bus queues.\n\n- [How to Use Service Bus Queues](service-bus-dotnet-how-to-use-queues.md)\n- [How to Use the Queue Storage Service](../storage-dotnet-how-to-use-queues.md)\n- [Best Practices for Performance Improvements Using Service Bus Brokered Messaging](https://msdn.microsoft.com/library/hh528527.aspx)\n- [Introducing Queues and Topics in Azure Service Bus](http://www.code-magazine.com/article.aspx?quickid=1112041)\n- [The Developer's Guide to Service Bus](http://www.cloudcasts.net/devguide/)\n- [\"Azure Tables and Queues Deep Dive\"](http://www.microsoftpdc.com/2009/SVC09)\n- [Azure Storage Architecture](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)\n- [Using the Queuing Service in Azure ](http://www.developerfusion.com/article/120197/using-the-queuing-service-in-windows-azure/)\n- [Understanding Azure Storage Billing – Bandwidth, Transactions, and Capacity](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx)\n "
}