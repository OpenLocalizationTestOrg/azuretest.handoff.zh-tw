{
  "nodes": [
    {
      "content": "How to use the Xamarin Component client | Microsoft Azure",
      "pos": [
        27,
        84
      ]
    },
    {
      "content": "Learn how to use the Xamarin Component client for Azure Mobile Services.",
      "pos": [
        103,
        175
      ]
    },
    {
      "content": "How to use the Xamarin Component client for Azure Mobile Services",
      "pos": [
        509,
        574
      ]
    },
    {
      "content": "This guide shows you how to perform common scenarios using the Xamarin Component client for Azure Mobile Services, in Xamarin apps for iOS and Android.",
      "pos": [
        693,
        844
      ]
    },
    {
      "content": "The scenarios covered include querying for data, inserting, updating, and deleting data, authenticating users, and handling errors.",
      "pos": [
        845,
        976
      ]
    },
    {
      "content": "If you are new to Mobile Services, you should consider first completing the \"Mobile Services quickstart\" tutorial (<bpt id=\"p1\">[</bpt>Xamarin.iOS<ept id=\"p1\">][Xamarin.iOS quickstart tutorial]</ept>/<bpt id=\"p2\">[</bpt>Xamarin.Android<ept id=\"p2\">][Xamarin.Android quickstart tutorial]</ept>) and the \"Getting Started with Data in .NET\" tutorial (<bpt id=\"p3\">[</bpt>Xamarin.iOS<ept id=\"p3\">][Xamarin.iOS data tutorial]</ept>/<bpt id=\"p4\">[</bpt>Xamarin.Android<ept id=\"p4\">][Xamarin.Android data tutorial]</ept>).",
      "pos": [
        977,
        1340
      ]
    },
    {
      "content": "The quickstart tutorial requires <bpt id=\"p1\">[</bpt>Xamarin<ept id=\"p1\">][Xamarin download]</ept> the <bpt id=\"p2\">[</bpt><ept id=\"p2\">Mobile Services SDK]</ept> and helps you configure your account and create your first mobile service.",
      "pos": [
        1341,
        1502
      ]
    },
    {
      "pos": [
        1595,
        1638
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"setup\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Setup and Prerequisites"
    },
    {
      "content": "We assume that you have created a mobile service and a table.",
      "pos": [
        1640,
        1701
      ]
    },
    {
      "content": "For more information see <bpt id=\"p1\">[</bpt>Create a table<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=298592)</ept>.",
      "pos": [
        1702,
        1791
      ]
    },
    {
      "content": "In the code used in this topic, the table is named <ph id=\"ph1\">`TodoItem`</ph> and it will have the following columns: <ph id=\"ph2\">`id`</ph>, <ph id=\"ph3\">`Text`</ph>, and <ph id=\"ph4\">`Complete`</ph>.",
      "pos": [
        1792,
        1923
      ]
    },
    {
      "content": "The corresponding typed client-side .NET type is the following:",
      "pos": [
        1925,
        1988
      ]
    },
    {
      "content": "When dynamic schema is enabled, Azure Mobile Services automatically generates new columns based on the object in insert or update requests.",
      "pos": [
        2251,
        2390
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Dynamic schema<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=296271)</ept>.",
      "pos": [
        2391,
        2481
      ]
    },
    {
      "pos": [
        2486,
        2555
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"create-client\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Create the Mobile Services client"
    },
    {
      "pos": [
        2557,
        2660
      ],
      "content": "The following code creates the <ph id=\"ph1\">`MobileServiceClient`</ph> object that is used to access your mobile service."
    },
    {
      "content": "In the code above, replace <ph id=\"ph1\">`AppUrl`</ph> and <ph id=\"ph2\">`AppKey`</ph> with the mobile service URL and application key, in that order.",
      "pos": [
        2763,
        2875
      ]
    },
    {
      "content": "Both of these are available on the Azure Management Portal, by selecting your mobile service and then clicking on \"Dashboard\".",
      "pos": [
        2876,
        3002
      ]
    },
    {
      "pos": [
        3007,
        3067
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"instantiating\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Create a table reference"
    },
    {
      "content": "All of the code that accesses or modifies data in the Mobile Services table calls functions on the <ph id=\"ph1\">`MobileServiceTable`</ph> object.",
      "pos": [
        3069,
        3196
      ]
    },
    {
      "content": "You get a reference to the table by calling the <bpt id=\"p1\">[</bpt>GetTable<ept id=\"p1\">](http://msdn.microsoft.com/library/windowsazure/jj554275.aspx)</ept> function on an instance of the <ph id=\"ph1\">`MobileServiceClient`</ph>.",
      "pos": [
        3197,
        3371
      ]
    },
    {
      "pos": [
        3457,
        3575
      ],
      "content": "This is the typed serialization model; see discussion of <ph id=\"ph1\">&lt;a href=\"#untyped\"&gt;</ph>the untyped serialization model<ph id=\"ph2\">&lt;/a&gt;</ph> below."
    },
    {
      "pos": [
        3580,
        3643
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"querying\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Query data from a mobile service"
    },
    {
      "content": "This section describes how to issue queries to the mobile service.",
      "pos": [
        3645,
        3711
      ]
    },
    {
      "content": "Subsections describe different aspects such as sorting, filtering, and paging.",
      "pos": [
        3712,
        3790
      ]
    },
    {
      "pos": [
        3796,
        3848
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"filtering\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Filter returned data"
    },
    {
      "content": "The following code illustrates how to filter data by including a <ph id=\"ph1\">`Where`</ph> clause in a query.",
      "pos": [
        3850,
        3941
      ]
    },
    {
      "content": "It returns all items from <ph id=\"ph1\">`todoTable`</ph> whose <ph id=\"ph2\">`Complete`</ph> property is equal to <ph id=\"ph3\">`false`</ph>.",
      "pos": [
        3942,
        4026
      ]
    },
    {
      "content": "The <ph id=\"ph1\">`Where`</ph> function applies a row filtering predicate to the query against the table.",
      "pos": [
        4027,
        4113
      ]
    },
    {
      "content": "You can view the URI of the request sent to the mobile service by using message inspection software, such as browser developer tools or Fiddler.",
      "pos": [
        4325,
        4469
      ]
    },
    {
      "content": "If you look at the request URI below,  notice that we are modifying the query string  itself:",
      "pos": [
        4470,
        4563
      ]
    },
    {
      "content": "This request would normally be translated roughly into the following SQL query on the server side:",
      "pos": [
        4627,
        4725
      ]
    },
    {
      "content": "The function which is passed to the <ph id=\"ph1\">`Where`</ph> method can have an arbitrary number of conditions.",
      "pos": [
        4793,
        4887
      ]
    },
    {
      "content": "For example, the line below:",
      "pos": [
        4888,
        4916
      ]
    },
    {
      "content": "Would be roughly translated (for the same request shown before) as",
      "pos": [
        5147,
        5213
      ]
    },
    {
      "pos": [
        5315,
        5416
      ],
      "content": "The <ph id=\"ph1\">`where`</ph> statement above will find items with <ph id=\"ph2\">`Complete`</ph> status set to false with non-null <ph id=\"ph3\">`Text`</ph>."
    },
    {
      "content": "We also could have written that in multiple lines instead:",
      "pos": [
        5418,
        5476
      ]
    },
    {
      "content": "The two methods are equivalent and may be used interchangeably.",
      "pos": [
        5648,
        5711
      ]
    },
    {
      "content": "The former option -- of concatenating multiple predicates in one query -- is more compact and recommended.",
      "pos": [
        5713,
        5819
      ]
    },
    {
      "content": "The <ph id=\"ph1\">`where`</ph> clause supports operations that be translated into the Mobile Services OData subset.",
      "pos": [
        5821,
        5917
      ]
    },
    {
      "content": "This includes relational operators (==, !=, &lt;, &lt;=, &gt;, &gt;=), arithmetic operators (+, -, /, *, %), number precision (Math.Floor, Math.Ceiling), string functions (Length, Substring, Replace, IndexOf, StartsWith, EndsWith), date properties (Year, Month, Day, Hour, Minute, Second), access properties of an object, and expressions combining all of these.",
      "pos": [
        5918,
        6267
      ]
    },
    {
      "pos": [
        6273,
        6321
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"sorting\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Sort returned data"
    },
    {
      "content": "The following code illustrates how to sort data by including an <ph id=\"ph1\">`OrderBy`</ph> or <ph id=\"ph2\">`OrderByDescending`</ph> function in the query.",
      "pos": [
        6323,
        6442
      ]
    },
    {
      "content": "It returns items from <ph id=\"ph1\">`todoTable`</ph> sorted ascending by the <ph id=\"ph2\">`Text`</ph> field.",
      "pos": [
        6443,
        6514
      ]
    },
    {
      "content": "By default, the server returns only the first 50 elements.",
      "pos": [
        6515,
        6573
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> A server-driven page size is used by default to prevent all elements from being returned.",
      "pos": [
        6577,
        6679
      ]
    },
    {
      "content": "This keeps default requests for large data sets from negatively impacting the service.",
      "pos": [
        6680,
        6766
      ]
    },
    {
      "pos": [
        6768,
        6871
      ],
      "content": "You may increase the number of items to be returned by calling <ph id=\"ph1\">`Take`</ph> as described in the next section."
    },
    {
      "pos": [
        7324,
        7373
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"paging\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Return data in pages"
    },
    {
      "content": "The following code shows how to implement paging in returned data by using the <ph id=\"ph1\">`Take`</ph> and <ph id=\"ph2\">`Skip`</ph> clauses in the query.",
      "pos": [
        7375,
        7493
      ]
    },
    {
      "content": "The following query, when executed, returns the top three items in the table.",
      "pos": [
        7495,
        7572
      ]
    },
    {
      "content": "The following revised query skips the first three results and returns the next three after that.",
      "pos": [
        7776,
        7872
      ]
    },
    {
      "content": "This is effectively the second \"page\" of data, where the page size is three items.",
      "pos": [
        7873,
        7955
      ]
    },
    {
      "pos": [
        8215,
        8481
      ],
      "content": "You can also use the <bpt id=\"p1\">[</bpt>IncludeTotalCount<ept id=\"p1\">](http://msdn.microsoft.com/library/windowsazure/jj730933.aspx)</ept> method to ensure that the query will get the total count for <ph id=\"ph1\">&lt;i&gt;</ph>all<ph id=\"ph2\">&lt;/i&gt;</ph> the records that would have been returned, ignoring any take paging/limit clause specified:"
    },
    {
      "content": "This is a simplified scenario of passing hard-coded paging values to the <ph id=\"ph1\">`Take`</ph> and <ph id=\"ph2\">`Skip`</ph> methods.",
      "pos": [
        8523,
        8622
      ]
    },
    {
      "content": "In a real-world app, you can use queries similar to the above with a pager control or comparable UI to let users navigate to previous and next pages.",
      "pos": [
        8623,
        8772
      ]
    },
    {
      "pos": [
        8778,
        8833
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"selecting\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Select specific columns"
    },
    {
      "content": "You can specify which set of properties to include in the results by adding a <ph id=\"ph1\">`Select`</ph> clause to your query.",
      "pos": [
        8835,
        8943
      ]
    },
    {
      "content": "For example, the following code shows how to select just one field and also how to select and format multiple fields:",
      "pos": [
        8944,
        9061
      ]
    },
    {
      "content": "All the functions described so far are additive, so we can just keep calling them and we'll each time affect more of the query.",
      "pos": [
        9590,
        9717
      ]
    },
    {
      "content": "One more example:",
      "pos": [
        9718,
        9735
      ]
    },
    {
      "pos": [
        10032,
        10082
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"lookingup\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Look up data by ID"
    },
    {
      "pos": [
        10084,
        10181
      ],
      "content": "The <ph id=\"ph1\">`LookupAsync`</ph> function can be used to look up objects from the database with a particular ID."
    },
    {
      "pos": [
        10299,
        10364
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"inserting\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Insert data into a mobile service"
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you want to perform insert, lookup, delete, or update operations on a type, then you need to create a member called <bpt id=\"p1\">**</bpt>Id<ept id=\"p1\">**</ept> (regardless of case).",
      "pos": [
        10368,
        10528
      ]
    },
    {
      "content": "This is why the example class <bpt id=\"p1\">**</bpt>TodoItem<ept id=\"p1\">**</ept> has a member of name <bpt id=\"p2\">**</bpt>Id<ept id=\"p2\">**</ept>.",
      "pos": [
        10529,
        10600
      ]
    },
    {
      "content": "An ID value must not be set to anything other than the default value during insert operations; by contrast, the ID value should always be set to a non-default value and present in update and delete operations.",
      "pos": [
        10601,
        10810
      ]
    },
    {
      "content": "The following code illustrates how to insert new rows into a table.",
      "pos": [
        10812,
        10879
      ]
    },
    {
      "content": "The parameter contains the data to be inserted as a .NET object.",
      "pos": [
        10880,
        10944
      ]
    },
    {
      "pos": [
        10990,
        11131
      ],
      "content": "After the await <ph id=\"ph1\">`todoTable.InsertAsync`</ph> call returns, the ID of the object in the server is populated to the <ph id=\"ph2\">`todoItem`</ph> object in the client."
    },
    {
      "content": "To insert untyped data, you may take advantage of Json.NET as shown below.",
      "pos": [
        11133,
        11207
      ]
    },
    {
      "content": "Again, note that an ID must not be specified when inserting an object.",
      "pos": [
        11208,
        11278
      ]
    },
    {
      "pos": [
        11427,
        11571
      ],
      "content": "If you attempt to insert an item with the \"Id\" field already set, you will get back a <ph id=\"ph1\">`MobileServiceInvalidOperationException`</ph> from the service."
    },
    {
      "pos": [
        11576,
        11639
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"modifying\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Modify data in a mobile service"
    },
    {
      "content": "The following code illustrates how to update an existing instance with the same ID with new information.",
      "pos": [
        11641,
        11745
      ]
    },
    {
      "content": "The parameter contains the data to be updated as a .NET object.",
      "pos": [
        11746,
        11809
      ]
    },
    {
      "content": "To insert untyped data, you may take advantage of Json.NET like so.",
      "pos": [
        11856,
        11923
      ]
    },
    {
      "content": "Note that when making an update, an ID must be specified, as that is how the mobile service identifies which instance to update.",
      "pos": [
        11924,
        12052
      ]
    },
    {
      "content": "The ID can be obtained from the result of the <ph id=\"ph1\">`InsertAsync`</ph> call.",
      "pos": [
        12053,
        12118
      ]
    },
    {
      "content": "If you attempt to update an item without the \"Id\" field already set, there is no way for the service to tell which instance to update, so you will get back a <ph id=\"ph1\">`MobileServiceInvalidOperationException`</ph> from the service.",
      "pos": [
        12289,
        12505
      ]
    },
    {
      "content": "Similarly, if you attempt to update an untyped item without the \"Id\" field already set, you will again get back a <ph id=\"ph1\">`MobileServiceInvalidOperationException`</ph> from the service.",
      "pos": [
        12506,
        12678
      ]
    },
    {
      "pos": [
        12684,
        12746
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"deleting\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Delete data in a mobile service"
    },
    {
      "content": "The following code illustrates how to delete an existing instance.",
      "pos": [
        12748,
        12814
      ]
    },
    {
      "content": "The instance is identified by the \"Id\" field set on the <ph id=\"ph1\">`todoItem`</ph>.",
      "pos": [
        12815,
        12882
      ]
    },
    {
      "content": "To delete untyped data, you may take advantage of Json.NET like so.",
      "pos": [
        12928,
        12995
      ]
    },
    {
      "content": "Note that when making a delete request, an ID must be specified, as that is how the mobile service identifies which instance to delete.",
      "pos": [
        12996,
        13131
      ]
    },
    {
      "content": "A delete request needs only the ID; other properties are not passed to the service, and if any are passed, they are ignored at the service.",
      "pos": [
        13132,
        13271
      ]
    },
    {
      "content": "The result of a <ph id=\"ph1\">`DeleteAsync`</ph> call is usually <ph id=\"ph2\">`null`</ph> as well.",
      "pos": [
        13272,
        13333
      ]
    },
    {
      "content": "The ID to pass in can be obtained from the result of the <ph id=\"ph1\">`InsertAsync`</ph> call.",
      "pos": [
        13334,
        13410
      ]
    },
    {
      "content": "If you attempt to delete an item without the \"Id\" field already set, there is no way for the service to tell which instance to delete, so you will get back a <ph id=\"ph1\">`MobileServiceInvalidOperationException`</ph> from the service.",
      "pos": [
        13500,
        13716
      ]
    },
    {
      "content": "Similarly, if you attempt to delete an untyped item without the \"Id\" field already set, you will again get back a <ph id=\"ph1\">`MobileServiceInvalidOperationException`</ph> from the service.",
      "pos": [
        13717,
        13889
      ]
    },
    {
      "pos": [
        13896,
        13951
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"authentication\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Authenticate users"
    },
    {
      "content": "Mobile Services supports authenticating and authorizing app users using a variety of external identity providers: Facebook, Google, Microsoft Account, Twitter, and Azure Active Directory.",
      "pos": [
        13953,
        14140
      ]
    },
    {
      "content": "You can set permissions on tables to restrict access for specific operations to only authenticated users.",
      "pos": [
        14141,
        14246
      ]
    },
    {
      "content": "You can also use the identity of authenticated users to implement authorization rules in server scripts.",
      "pos": [
        14247,
        14351
      ]
    },
    {
      "content": "For more information, see the \"Get started with authentication\" tutorial (<bpt id=\"p1\">[</bpt>Xamarin.iOS<ept id=\"p1\">][Xamarin.iOS authentication]</ept>/<bpt id=\"p2\">[</bpt>Xamarin.Android<ept id=\"p2\">][Xamarin.Android authentication]</ept>).",
      "pos": [
        14352,
        14519
      ]
    },
    {
      "content": "Two authentication flows are supported: a <bpt id=\"p1\">_</bpt>server flow<ept id=\"p1\">_</ept> and a <bpt id=\"p2\">_</bpt>client flow<ept id=\"p2\">_</ept>.",
      "pos": [
        14521,
        14597
      ]
    },
    {
      "content": "The server flow provides the simplest authentication experience, as it relies on the provider's web authentication interface.",
      "pos": [
        14598,
        14723
      ]
    },
    {
      "content": "The client flow allows for deeper integration with device-specific capabilities as it relies on provider-specific device-specific SDKs.",
      "pos": [
        14724,
        14859
      ]
    },
    {
      "content": "Server flow",
      "pos": [
        14865,
        14876
      ]
    },
    {
      "content": "To have Mobile Services manage the authentication process in your Windows Store or Windows Phone app,",
      "pos": [
        14877,
        14978
      ]
    },
    {
      "content": "you must register your app with your identity provider.",
      "pos": [
        14979,
        15034
      ]
    },
    {
      "content": "Then in your mobile service, you need to configure the application ID and secret provided by your provider.",
      "pos": [
        15035,
        15142
      ]
    },
    {
      "content": "For more information, see the \"Get started with authentication\" tutorial (<bpt id=\"p1\">[</bpt>Xamarin.iOS<ept id=\"p1\">][Xamarin.iOS authentication]</ept>/<bpt id=\"p2\">[</bpt>Xamarin.Android<ept id=\"p2\">][Xamarin.Android authentication]</ept>).",
      "pos": [
        15143,
        15310
      ]
    },
    {
      "content": "Once you have registered your identity provider, simply call the <bpt id=\"p1\">[</bpt><ept id=\"p1\">LoginAsync method]</ept> with the <bpt id=\"p2\">[</bpt><ept id=\"p2\">MobileServiceAuthenticationProvider]</ept> value of your provider.",
      "pos": [
        15312,
        15467
      ]
    },
    {
      "content": "For example, the following code initiates a server flow login by using Facebook.",
      "pos": [
        15468,
        15548
      ]
    },
    {
      "pos": [
        16282,
        16436
      ],
      "content": "If you are using an identity provider other than Facebook, change the value of <bpt id=\"p1\">[</bpt><ept id=\"p1\">MobileServiceAuthenticationProvider]</ept> above to the value for your provider."
    },
    {
      "content": "In this case, Mobile Services manages the OAuth 2.0 authentication flow by displaying the login page of the selected provider and generating a Mobile Services authentication token after successful login with the identity provider.",
      "pos": [
        16438,
        16668
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt><ept id=\"p1\">LoginAsync method]</ept> returns a <bpt id=\"p2\">[</bpt><ept id=\"p2\">MobileServiceUser]</ept>, which provides both the <bpt id=\"p3\">[</bpt><ept id=\"p3\">userId]</ept> of the authenticated user and the <bpt id=\"p4\">[</bpt><ept id=\"p4\">MobileServiceAuthenticationToken]</ept>, as a JSON web token (JWT).",
      "pos": [
        16669,
        16853
      ]
    },
    {
      "content": "This token can be cached and re-used until it expires.",
      "pos": [
        16854,
        16908
      ]
    },
    {
      "content": "For more information, see [Caching the authentication token].",
      "pos": [
        16909,
        16970
      ]
    },
    {
      "content": "Client flow",
      "pos": [
        16976,
        16987
      ]
    },
    {
      "content": "Your app can also independently contact the identity provider and then provide the returned token to Mobile Services for authentication.",
      "pos": [
        16989,
        17125
      ]
    },
    {
      "content": "This client flow enables you to provide a single sign-in experience for users or to retrieve additional user data from the identity provider.",
      "pos": [
        17126,
        17267
      ]
    },
    {
      "content": "In the most simplified form, you can use the client flow as shown in this snippet for Facebook or Google.",
      "pos": [
        17269,
        17374
      ]
    },
    {
      "pos": [
        18485,
        18539
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"caching\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Caching the authentication token"
    },
    {
      "content": "In some cases, the call to the login method can be avoided after the first time the user authenticates.",
      "pos": [
        18540,
        18643
      ]
    },
    {
      "content": "You can use a local secure store (such as <bpt id=\"p1\">[</bpt>Xamarin.Auth<ept id=\"p1\">][Xamarin.Auth component]</ept>) to cache the current user identity the first time they log in and every subsequent time you check whether you already have the user identity in our cache.",
      "pos": [
        18644,
        18880
      ]
    },
    {
      "content": "When the cache is empty, you still need to send the user through the login process.",
      "pos": [
        18881,
        18964
      ]
    },
    {
      "pos": [
        20032,
        20074
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"errors\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Handle errors"
    },
    {
      "content": "There are several ways to encounter, validate, and work around errors in Mobile Services.",
      "pos": [
        20076,
        20165
      ]
    },
    {
      "content": "As an example, server scripts are registered in a mobile service and can be used to perform a wide range of operations on data being inserted and updated, including validation and data modification.",
      "pos": [
        20167,
        20365
      ]
    },
    {
      "content": "Imagine defining and registering a server script that validate and modify data, like so:",
      "pos": [
        20366,
        20454
      ]
    },
    {
      "content": "This server-side script validates the length of string data sent to the mobile service and rejects strings that are too long, in this case longer than 10 characters.",
      "pos": [
        20699,
        20864
      ]
    },
    {
      "content": "Now that the mobile service is validating data and sending error responses on the server-side, you can update your .NET app to be able to handle error responses from validation.",
      "pos": [
        20866,
        21043
      ]
    },
    {
      "pos": [
        21522,
        21574
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"untyped\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Work with untyped data"
    },
    {
      "content": "The Xamarin Component client is designed for strongly typed scenarios.",
      "pos": [
        21576,
        21646
      ]
    },
    {
      "content": "However, sometimes, a more loosely typed experience is convenient; for example, this could be when dealing with objects with open schema.",
      "pos": [
        21647,
        21784
      ]
    },
    {
      "content": "That scenario is enabled as follows.",
      "pos": [
        21785,
        21821
      ]
    },
    {
      "content": "In queries, you forego LINQ and use the wire format.",
      "pos": [
        21822,
        21874
      ]
    },
    {
      "content": "You get back JSON values that you can use like a property bag.",
      "pos": [
        22126,
        22188
      ]
    },
    {
      "content": "For more information on JToken and Json.NET, see <bpt id=\"p1\">[</bpt>Json.NET<ept id=\"p1\">](http://json.codeplex.com/)</ept>",
      "pos": [
        22189,
        22275
      ]
    },
    {
      "pos": [
        22280,
        22332
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"unit-testing\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Design unit tests"
    },
    {
      "content": "The value returned by <ph id=\"ph1\">`MobileServiceClient.GetTable`</ph> and the queries are interfaces.",
      "pos": [
        22334,
        22418
      ]
    },
    {
      "content": "That makes them easily \"mockable\" for testing purposes, so you could create a <ph id=\"ph1\">`MyMockTable : IMobileServiceTable&lt;TodoItem&gt;`</ph> that implements your testing logic.",
      "pos": [
        22419,
        22578
      ]
    },
    {
      "pos": [
        22583,
        22617
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"nextsteps\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Next steps"
    },
    {
      "content": "Now that you have completed this how-to conceptual reference topic, learn how to perform important tasks in Mobile Services in detail:",
      "pos": [
        22619,
        22753
      ]
    },
    {
      "pos": [
        22757,
        22958
      ],
      "content": "Get started with Mobile Services ([Xamarin.iOS][Get started with Mobile Services iOS]/[Xamarin.Android][Get started with Mobile Services Android])\n<br/>Learn the basics of how to use Mobile Services.",
      "leadings": [
        "",
        "  "
      ],
      "nodes": [
        {
          "content": "Get started with Mobile Services (<bpt id=\"p1\">[</bpt>Xamarin.iOS<ept id=\"p1\">][Get started with Mobile Services iOS]</ept>/<bpt id=\"p2\">[</bpt>Xamarin.Android<ept id=\"p2\">][Get started with Mobile Services Android]</ept>)",
          "pos": [
            0,
            146
          ]
        },
        {
          "content": "Learn the basics of how to use Mobile Services.",
          "pos": [
            152,
            199
          ]
        }
      ]
    },
    {
      "pos": [
        22962,
        23148
      ],
      "content": "Get started with data ([Xamarin.iOS][Get started with data iOS]/[Xamarin.Android][Get started with data Android])\n<br/>Learn more about storing and querying data using Mobile Services.",
      "leadings": [
        "",
        "  "
      ],
      "nodes": [
        {
          "content": "Get started with data (<bpt id=\"p1\">[</bpt>Xamarin.iOS<ept id=\"p1\">][Get started with data iOS]</ept>/<bpt id=\"p2\">[</bpt>Xamarin.Android<ept id=\"p2\">][Get started with data Android]</ept>)",
          "pos": [
            0,
            113
          ]
        },
        {
          "content": "Learn more about storing and querying data using Mobile Services.",
          "pos": [
            119,
            184
          ]
        }
      ]
    },
    {
      "pos": [
        23152,
        23373
      ],
      "content": "Get started with authentication ([Xamarin.iOS][Get started with authentication iOS]/[Xamarin.Android][Get started with authentication Android])\n<br/>Learn how to authenticate users of your app with an identity provider.",
      "leadings": [
        "",
        "  "
      ],
      "nodes": [
        {
          "content": "Get started with authentication (<bpt id=\"p1\">[</bpt>Xamarin.iOS<ept id=\"p1\">][Get started with authentication iOS]</ept>/<bpt id=\"p2\">[</bpt>Xamarin.Android<ept id=\"p2\">][Get started with authentication Android]</ept>)",
          "pos": [
            0,
            143
          ]
        },
        {
          "content": "Learn how to authenticate users of your app with an identity provider.",
          "pos": [
            149,
            219
          ]
        }
      ]
    },
    {
      "pos": [
        23377,
        23650
      ],
      "content": "Validate and modify data with scripts ([Xamarin.iOS][Validate and modify data with scripts ios]/[Xamarin.Android][Validate and modify data with scripts android])\n<br/>Learn more about using server scripts in Mobile Services to validate and change data sent from your app.",
      "leadings": [
        "",
        "  "
      ],
      "nodes": [
        {
          "content": "Validate and modify data with scripts (<bpt id=\"p1\">[</bpt>Xamarin.iOS<ept id=\"p1\">][Validate and modify data with scripts ios]</ept>/<bpt id=\"p2\">[</bpt>Xamarin.Android<ept id=\"p2\">][Validate and modify data with scripts android]</ept>)",
          "pos": [
            0,
            161
          ]
        },
        {
          "content": "Learn more about using server scripts in Mobile Services to validate and change data sent from your app.",
          "pos": [
            167,
            271
          ]
        }
      ]
    },
    {
      "pos": [
        23654,
        23883
      ],
      "content": "Refine queries with paging ([Xamarin.iOS][Refine queries with paging iOS]/[Xamarin.Android][Refine queries with paging Android])\n<br/>Learn how to use paging in queries to control the amount of data handled in a single request.",
      "leadings": [
        "",
        "  "
      ],
      "nodes": [
        {
          "content": "Refine queries with paging (<bpt id=\"p1\">[</bpt>Xamarin.iOS<ept id=\"p1\">][Refine queries with paging iOS]</ept>/<bpt id=\"p2\">[</bpt>Xamarin.Android<ept id=\"p2\">][Refine queries with paging Android]</ept>)",
          "pos": [
            0,
            128
          ]
        },
        {
          "content": "Learn how to use paging in queries to control the amount of data handled in a single request.",
          "pos": [
            134,
            227
          ]
        }
      ]
    },
    {
      "pos": [
        23887,
        24182
      ],
      "content": "Authorize users with scripts ([Xamarin.iOS][Authorize users with scripts iOS]/[Xamarin.Android][Authorize users with scripts Android])\n<br/>Learn how to take the user ID value provided by Mobile Services based on an authenticated user and use it to filter the data returned by Mobile Services.",
      "leadings": [
        "",
        "  "
      ],
      "nodes": [
        {
          "content": "Authorize users with scripts (<bpt id=\"p1\">[</bpt>Xamarin.iOS<ept id=\"p1\">][Authorize users with scripts iOS]</ept>/<bpt id=\"p2\">[</bpt>Xamarin.Android<ept id=\"p2\">][Authorize users with scripts Android]</ept>)",
          "pos": [
            0,
            134
          ]
        },
        {
          "content": "Learn how to take the user ID value provided by Mobile Services based on an authenticated user and use it to filter the data returned by Mobile Services.",
          "pos": [
            140,
            293
          ]
        }
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"How to use the Xamarin Component client | Microsoft Azure\"\n    description=\"Learn how to use the Xamarin Component client for Azure Mobile Services.\"\n    authors=\"lindydonna\"\n    manager=\"dwrede\"\n    editor=\"\"\n    services=\"mobile-services\"\n    documentationCenter=\"xamarin\"/>\n\n<tags\n    ms.service=\"mobile-services\"\n    ms.workload=\"mobile\"\n    ms.tgt_pltfrm=\"mobile-xamarin\"\n    ms.devlang=\"dotnet\"\n    ms.topic=\"article\"\n    ms.date=\"08/18/2015\" \n    ms.author=\"lindydonna\"/>\n\n# How to use the Xamarin Component client for Azure Mobile Services\n[AZURE.INCLUDE [mobile-services-selector-client-library](../../includes/mobile-services-selector-client-library.md)]\n\nThis guide shows you how to perform common scenarios using the Xamarin Component client for Azure Mobile Services, in Xamarin apps for iOS and Android. The scenarios covered include querying for data, inserting, updating, and deleting data, authenticating users, and handling errors. If you are new to Mobile Services, you should consider first completing the \"Mobile Services quickstart\" tutorial ([Xamarin.iOS][Xamarin.iOS quickstart tutorial]/[Xamarin.Android][Xamarin.Android quickstart tutorial]) and the \"Getting Started with Data in .NET\" tutorial ([Xamarin.iOS][Xamarin.iOS data tutorial]/[Xamarin.Android][Xamarin.Android data tutorial]). The quickstart tutorial requires [Xamarin][Xamarin download] the [Mobile Services SDK] and helps you configure your account and create your first mobile service.\n\n[AZURE.INCLUDE [mobile-services-concepts](../../includes/mobile-services-concepts.md)]\n\n## <a name=\"setup\"></a>Setup and Prerequisites\n\nWe assume that you have created a mobile service and a table. For more information see [Create a table](http://go.microsoft.com/fwlink/?LinkId=298592). In the code used in this topic, the table is named `TodoItem` and it will have the following columns: `id`, `Text`, and `Complete`.\n\nThe corresponding typed client-side .NET type is the following:\n\n\n    public class TodoItem\n    {\n        public string id { get; set; }\n\n        [JsonProperty(PropertyName = \"text\")]\n        public string Text { get; set; }\n\n        [JsonProperty(PropertyName = \"complete\")]\n        public bool Complete { get; set; }\n    }\n\nWhen dynamic schema is enabled, Azure Mobile Services automatically generates new columns based on the object in insert or update requests. For more information, see [Dynamic schema](http://go.microsoft.com/fwlink/?LinkId=296271).\n\n## <a name=\"create-client\"></a>How to: Create the Mobile Services client\n\nThe following code creates the `MobileServiceClient` object that is used to access your mobile service.\n\n    MobileServiceClient client = new MobileServiceClient(\n        \"AppUrl\",\n        \"AppKey\"\n    );\n\nIn the code above, replace `AppUrl` and `AppKey` with the mobile service URL and application key, in that order. Both of these are available on the Azure Management Portal, by selecting your mobile service and then clicking on \"Dashboard\".\n\n## <a name=\"instantiating\"></a>How to: Create a table reference\n\nAll of the code that accesses or modifies data in the Mobile Services table calls functions on the `MobileServiceTable` object. You get a reference to the table by calling the [GetTable](http://msdn.microsoft.com/library/windowsazure/jj554275.aspx) function on an instance of the `MobileServiceClient`.\n\n    IMobileServiceTable<TodoItem> todoTable =\n        client.GetTable<TodoItem>();\n\nThis is the typed serialization model; see discussion of <a href=\"#untyped\">the untyped serialization model</a> below.\n\n## <a name=\"querying\"></a>How to: Query data from a mobile service\n\nThis section describes how to issue queries to the mobile service. Subsections describe different aspects such as sorting, filtering, and paging.\n\n### <a name=\"filtering\"></a>How to: Filter returned data\n\nThe following code illustrates how to filter data by including a `Where` clause in a query. It returns all items from `todoTable` whose `Complete` property is equal to `false`. The `Where` function applies a row filtering predicate to the query against the table.\n\n\n    // This query filters out completed TodoItems and\n    // items without a timestamp.\n    List<TodoItem> items = await todoTable\n       .Where(todoItem => todoItem.Complete == false)\n       .ToListAsync();\n\nYou can view the URI of the request sent to the mobile service by using message inspection software, such as browser developer tools or Fiddler. If you look at the request URI below,  notice that we are modifying the query string  itself:\n\n    GET /tables/todoitem?$filter=(complete+eq+false) HTTP/1.1\nThis request would normally be translated roughly into the following SQL query on the server side:\n\n    SELECT *\n    FROM TodoItem\n    WHERE ISNULL(complete, 0) = 0\n\nThe function which is passed to the `Where` method can have an arbitrary number of conditions. For example, the line below:\n\n    // This query filters out completed TodoItems where Text isn't null\n    List<TodoItem> items = await todoTable\n       .Where(todoItem => todoItem.Complete == false\n           && todoItem.Text != null)\n       .ToListAsync();\n\nWould be roughly translated (for the same request shown before) as\n\n    SELECT *\n    FROM TodoItem\n    WHERE ISNULL(complete, 0) = 0\n          AND ISNULL(text, 0) = 0\n\nThe `where` statement above will find items with `Complete` status set to false with non-null `Text`.\n\nWe also could have written that in multiple lines instead:\n\n    List<TodoItem> items = await todoTable\n       .Where(todoItem => todoItem.Complete == false)\n       .Where(todoItem => todoItem.Text != null)\n       .ToListAsync();\n\nThe two methods are equivalent and may be used interchangeably.  The former option -- of concatenating multiple predicates in one query -- is more compact and recommended.\n\nThe `where` clause supports operations that be translated into the Mobile Services OData subset. This includes relational operators (==, !=, <, <=, >, >=), arithmetic operators (+, -, /, *, %), number precision (Math.Floor, Math.Ceiling), string functions (Length, Substring, Replace, IndexOf, StartsWith, EndsWith), date properties (Year, Month, Day, Hour, Minute, Second), access properties of an object, and expressions combining all of these.\n\n### <a name=\"sorting\"></a>How to: Sort returned data\n\nThe following code illustrates how to sort data by including an `OrderBy` or `OrderByDescending` function in the query. It returns items from `todoTable` sorted ascending by the `Text` field. By default, the server returns only the first 50 elements.\n\n> [AZURE.NOTE] A server-driven page size is used by default to prevent all elements from being returned. This keeps default requests for large data sets from negatively impacting the service.\n\nYou may increase the number of items to be returned by calling `Take` as described in the next section.\n\n    // Sort items in ascending order by Text field\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .OrderBy(todoItem => todoItem.Text)\n    List<TodoItem> items = await query.ToListAsync();\n\n    // Sort items in descending order by Text field\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .OrderByDescending(todoItem => todoItem.Text)\n    List<TodoItem> items = await query.ToListAsync();\n\n### <a name=\"paging\"></a>How to: Return data in pages\n\nThe following code shows how to implement paging in returned data by using the `Take` and `Skip` clauses in the query.  The following query, when executed, returns the top three items in the table.\n\n    // Define a filtered query that returns the top 3 items.\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Take(3);\n    List<TodoItem> items = await query.ToListAsync();\n\nThe following revised query skips the first three results and returns the next three after that. This is effectively the second \"page\" of data, where the page size is three items.\n\n    // Define a filtered query that skips the top 3 items and returns the next 3 items.\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Skip(3)\n                    .Take(3);\n    List<TodoItem> items = await query.ToListAsync();\n\nYou can also use the [IncludeTotalCount](http://msdn.microsoft.com/library/windowsazure/jj730933.aspx) method to ensure that the query will get the total count for <i>all</i> the records that would have been returned, ignoring any take paging/limit clause specified:\n\n    query = query.IncludeTotalCount();\n\nThis is a simplified scenario of passing hard-coded paging values to the `Take` and `Skip` methods. In a real-world app, you can use queries similar to the above with a pager control or comparable UI to let users navigate to previous and next pages.\n\n### <a name=\"selecting\"></a>How to: Select specific columns\n\nYou can specify which set of properties to include in the results by adding a `Select` clause to your query. For example, the following code shows how to select just one field and also how to select and format multiple fields:\n\n    // Select one field -- just the Text\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Select(todoItem => todoItem.Text);\n    List<string> items = await query.ToListAsync();\n\n    // Select multiple fields -- both Complete and Text info\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Select(todoItem => string.Format(\"{0} -- {1}\", todoItem.Text.PadRight(30), todoItem.Complete ? \"Now complete!\" : \"Incomplete!\"));\n    List<string> items = await query.ToListAsync();\n\nAll the functions described so far are additive, so we can just keep calling them and we'll each time affect more of the query. One more example:\n\n    MobileServiceTableQuery<TodoItem> query = todoTable\n                    .Where(todoItem => todoItem.Complete == false)\n                    .Select(todoItem => todoItem.Text)\n                    .Skip(3).\n                    .Take(3);\n    List<string> items = await query.ToListAsync();\n\n### <a name=\"lookingup\"></a>How to: Look up data by ID\n\nThe `LookupAsync` function can be used to look up objects from the database with a particular ID.\n\n    // This query filters out the item with the ID of 25\n    TodoItem item25 = await todoTable.LookupAsync(25);\n\n## <a name=\"inserting\"></a>How to: Insert data into a mobile service\n\n> [AZURE.NOTE] If you want to perform insert, lookup, delete, or update operations on a type, then you need to create a member called **Id** (regardless of case). This is why the example class **TodoItem** has a member of name **Id**. An ID value must not be set to anything other than the default value during insert operations; by contrast, the ID value should always be set to a non-default value and present in update and delete operations.\n\nThe following code illustrates how to insert new rows into a table. The parameter contains the data to be inserted as a .NET object.\n\n    await todoTable.InsertAsync(todoItem);\n\nAfter the await `todoTable.InsertAsync` call returns, the ID of the object in the server is populated to the `todoItem` object in the client.\n\nTo insert untyped data, you may take advantage of Json.NET as shown below. Again, note that an ID must not be specified when inserting an object.\n\n    JObject jo = new JObject();\n    jo.Add(\"Text\", \"Hello World\");\n    jo.Add(\"Complete\", false);\n    var inserted = await table.InsertAsync(jo);\n\nIf you attempt to insert an item with the \"Id\" field already set, you will get back a `MobileServiceInvalidOperationException` from the service.\n\n## <a name=\"modifying\"></a>How to: Modify data in a mobile service\n\nThe following code illustrates how to update an existing instance with the same ID with new information. The parameter contains the data to be updated as a .NET object.\n\n    await todoTable.UpdateAsync(todoItem);\n\n\nTo insert untyped data, you may take advantage of Json.NET like so. Note that when making an update, an ID must be specified, as that is how the mobile service identifies which instance to update. The ID can be obtained from the result of the `InsertAsync` call.\n\n    JObject jo = new JObject();\n    jo.Add(\"Id\", 52);\n    jo.Add(\"Text\", \"Hello World\");\n    jo.Add(\"Complete\", false);\n    var inserted = await table.UpdateAsync(jo);\n\nIf you attempt to update an item without the \"Id\" field already set, there is no way for the service to tell which instance to update, so you will get back a `MobileServiceInvalidOperationException` from the service. Similarly, if you attempt to update an untyped item without the \"Id\" field already set, you will again get back a `MobileServiceInvalidOperationException` from the service.\n\n\n## <a name=\"deleting\"></a>How to: Delete data in a mobile service\n\nThe following code illustrates how to delete an existing instance. The instance is identified by the \"Id\" field set on the `todoItem`.\n\n    await todoTable.DeleteAsync(todoItem);\n\nTo delete untyped data, you may take advantage of Json.NET like so. Note that when making a delete request, an ID must be specified, as that is how the mobile service identifies which instance to delete. A delete request needs only the ID; other properties are not passed to the service, and if any are passed, they are ignored at the service. The result of a `DeleteAsync` call is usually `null` as well. The ID to pass in can be obtained from the result of the `InsertAsync` call.\n\n    JObject jo = new JObject();\n    jo.Add(\"Id\", 52);\n    await table.DeleteAsync(jo);\n\nIf you attempt to delete an item without the \"Id\" field already set, there is no way for the service to tell which instance to delete, so you will get back a `MobileServiceInvalidOperationException` from the service. Similarly, if you attempt to delete an untyped item without the \"Id\" field already set, you will again get back a `MobileServiceInvalidOperationException` from the service.\n\n\n\n## <a name=\"authentication\"></a>How to: Authenticate users\n\nMobile Services supports authenticating and authorizing app users using a variety of external identity providers: Facebook, Google, Microsoft Account, Twitter, and Azure Active Directory. You can set permissions on tables to restrict access for specific operations to only authenticated users. You can also use the identity of authenticated users to implement authorization rules in server scripts. For more information, see the \"Get started with authentication\" tutorial ([Xamarin.iOS][Xamarin.iOS authentication]/[Xamarin.Android][Xamarin.Android authentication]).\n\nTwo authentication flows are supported: a _server flow_ and a _client flow_. The server flow provides the simplest authentication experience, as it relies on the provider's web authentication interface. The client flow allows for deeper integration with device-specific capabilities as it relies on provider-specific device-specific SDKs.\n\n### Server flow\nTo have Mobile Services manage the authentication process in your Windows Store or Windows Phone app,\nyou must register your app with your identity provider. Then in your mobile service, you need to configure the application ID and secret provided by your provider. For more information, see the \"Get started with authentication\" tutorial ([Xamarin.iOS][Xamarin.iOS authentication]/[Xamarin.Android][Xamarin.Android authentication]).\n\nOnce you have registered your identity provider, simply call the [LoginAsync method] with the [MobileServiceAuthenticationProvider] value of your provider. For example, the following code initiates a server flow login by using Facebook.\n\n    private MobileServiceUser user;\n    private async System.Threading.Tasks.Task Authenticate()\n    {\n        while (user == null)\n        {\n            string message;\n            try\n            {\n                user = await client\n                    .LoginAsync(MobileServiceAuthenticationProvider.Facebook);\n                message =\n                    string.Format(\"You are now logged in - {0}\", user.UserId);\n            }\n            catch (InvalidOperationException)\n            {\n                message = \"You must log in. Login Required\";\n            }\n\n            var dialog = new MessageDialog(message);\n            dialog.Commands.Add(new UICommand(\"OK\"));\n            await dialog.ShowAsync();\n        }\n    }\n\nIf you are using an identity provider other than Facebook, change the value of [MobileServiceAuthenticationProvider] above to the value for your provider.\n\nIn this case, Mobile Services manages the OAuth 2.0 authentication flow by displaying the login page of the selected provider and generating a Mobile Services authentication token after successful login with the identity provider. The [LoginAsync method] returns a [MobileServiceUser], which provides both the [userId] of the authenticated user and the [MobileServiceAuthenticationToken], as a JSON web token (JWT). This token can be cached and re-used until it expires. For more information, see [Caching the authentication token].\n\n### Client flow\n\nYour app can also independently contact the identity provider and then provide the returned token to Mobile Services for authentication. This client flow enables you to provide a single sign-in experience for users or to retrieve additional user data from the identity provider.\n\nIn the most simplified form, you can use the client flow as shown in this snippet for Facebook or Google.\n\n    var token = new JObject();\n    // Replace access_token_value with actual value of your access token obtained\n    // using the Facebook or Google SDK.\n    token.Add(\"access_token\", \"access_token_value\");\n\n    private MobileServiceUser user;\n    private async System.Threading.Tasks.Task Authenticate()\n    {\n        while (user == null)\n        {\n            string message;\n            try\n            {\n                // Change MobileServiceAuthenticationProvider.Facebook\n                // to MobileServiceAuthenticationProvider.Google if using Google auth.\n                user = await client\n                    .LoginAsync(MobileServiceAuthenticationProvider.Facebook, token);\n                message =\n                    string.Format(\"You are now logged in - {0}\", user.UserId);\n            }\n            catch (InvalidOperationException)\n            {\n                message = \"You must log in. Login Required\";\n            }\n\n            var dialog = new MessageDialog(message);\n            dialog.Commands.Add(new UICommand(\"OK\"));\n            await dialog.ShowAsync();\n        }\n    }\n\n### <a name=\"caching\"></a>Caching the authentication token\nIn some cases, the call to the login method can be avoided after the first time the user authenticates. You can use a local secure store (such as [Xamarin.Auth][Xamarin.Auth component]) to cache the current user identity the first time they log in and every subsequent time you check whether you already have the user identity in our cache. When the cache is empty, you still need to send the user through the login process.\n\n    using Xamarin.Auth;\n    var accountStore = AccountStore.Create(); // Xamarin.iOS\n    //var accountStore = AccountStore.Create(this); // Xamarin.Android\n\n    // After logging in\n    var account = new Account (user.UserId, new Dictionary<string,string> {{\"token\",user.MobileServiceAuthenticationToken}});\n    accountStore.Save(account, \"Facebook\");\n\n    // Log in\n    var accounts = accountStore.FindAccountsForService (\"Facebook\").ToArray();\n    if (accounts.Count != 0)\n    {\n        user = new MobileServiceUser (accounts[0].Username);\n        user.MobileServiceAuthenticationToken = accounts[0].Properties[\"token\"];\n    }\n    else\n    {\n        // Regular login flow\n        user = new MobileServiceuser( await client\n            .LoginAsync(MobileServiceAuthenticationProvider.Facebook, token);\n        var token = new JObject();\n        // Replace access_token_value with actual value of your access token\n        token.Add(\"access_token\", \"access_token_value\");\n    }\n\n     // Log out\n    client.Logout();\n    accountStore.Delete(account, \"Facebook\");\n\n\n## <a name=\"errors\"></a>How to: Handle errors\n\nThere are several ways to encounter, validate, and work around errors in Mobile Services.\n\nAs an example, server scripts are registered in a mobile service and can be used to perform a wide range of operations on data being inserted and updated, including validation and data modification. Imagine defining and registering a server script that validate and modify data, like so:\n\n    function insert(item, user, request)\n    {\n       if (item.text.length > 10) {\n          request.respond(statusCodes.BAD_REQUEST, { error: \"Text cannot exceed 10 characters\" });\n       } else {\n          request.execute();\n       }\n    }\n\nThis server-side script validates the length of string data sent to the mobile service and rejects strings that are too long, in this case longer than 10 characters.\n\nNow that the mobile service is validating data and sending error responses on the server-side, you can update your .NET app to be able to handle error responses from validation.\n\n    private async void InsertTodoItem(TodoItem todoItem)\n    {\n        // This code inserts a new TodoItem into the database. When the operation completes\n        // and Mobile Services has assigned an Id, the item is added to the CollectionView\n        try\n        {\n            await todoTable.InsertAsync(todoItem);\n            items.Add(todoItem);\n        }\n        catch (MobileServiceInvalidOperationException e)\n        {\n            // Handle error\n        }\n    }\n\n## <a name=\"untyped\"></a>How to: Work with untyped data\n\nThe Xamarin Component client is designed for strongly typed scenarios. However, sometimes, a more loosely typed experience is convenient; for example, this could be when dealing with objects with open schema. That scenario is enabled as follows. In queries, you forego LINQ and use the wire format.\n\n    // Get an untyped table reference\n    IMobileServiceTable untypedTodoTable = client.GetTable(\"TodoItem\");\n\n    // Lookup untyped data using OData\n    JToken untypedItems = await untypedTodoTable.ReadAsync(\"$filter=complete eq 0&$orderby=text\");\n\nYou get back JSON values that you can use like a property bag. For more information on JToken and Json.NET, see [Json.NET](http://json.codeplex.com/)\n\n## <a name=\"unit-testing\"></a>How to: Design unit tests\n\nThe value returned by `MobileServiceClient.GetTable` and the queries are interfaces. That makes them easily \"mockable\" for testing purposes, so you could create a `MyMockTable : IMobileServiceTable<TodoItem>` that implements your testing logic.\n\n## <a name=\"nextsteps\"></a>Next steps\n\nNow that you have completed this how-to conceptual reference topic, learn how to perform important tasks in Mobile Services in detail:\n\n* Get started with Mobile Services ([Xamarin.iOS][Get started with Mobile Services iOS]/[Xamarin.Android][Get started with Mobile Services Android])\n  <br/>Learn the basics of how to use Mobile Services.\n\n* Get started with data ([Xamarin.iOS][Get started with data iOS]/[Xamarin.Android][Get started with data Android])\n  <br/>Learn more about storing and querying data using Mobile Services.\n\n* Get started with authentication ([Xamarin.iOS][Get started with authentication iOS]/[Xamarin.Android][Get started with authentication Android])\n  <br/>Learn how to authenticate users of your app with an identity provider.\n\n* Validate and modify data with scripts ([Xamarin.iOS][Validate and modify data with scripts ios]/[Xamarin.Android][Validate and modify data with scripts android])\n  <br/>Learn more about using server scripts in Mobile Services to validate and change data sent from your app.\n\n* Refine queries with paging ([Xamarin.iOS][Refine queries with paging iOS]/[Xamarin.Android][Refine queries with paging Android])\n  <br/>Learn how to use paging in queries to control the amount of data handled in a single request.\n\n* Authorize users with scripts ([Xamarin.iOS][Authorize users with scripts iOS]/[Xamarin.Android][Authorize users with scripts Android])\n  <br/>Learn how to take the user ID value provided by Mobile Services based on an authenticated user and use it to filter the data returned by Mobile Services.\n\n<!-- Anchors. -->\n[What is Mobile Services]: #what-is\n[Concepts]: #concepts\n[How to: Create the Mobile Services client]: #create-client\n[How to: Create a table reference]: #instantiating\n[How to: Query data from a mobile service]: #querying\n[Filter returned data]: #filtering\n[Sort returned data]: #sorting\n[Return data in pages]: #paging\n[Select specific columns]: #selecting\n[Look up data by ID]: #lookingup\n[How to: Bind data to user interface in a mobile service]: #binding\n[How to: Insert data into a mobile service]: #inserting\n[How to: Modify data in a mobile service]: #modifying\n[How to: Delete data in a mobile service]: #deleting\n[How to: Authenticate users]: #authentication\n[How to: Handle errors]: #errors\n[How to: Design unit tests]: #unit-testing\n[How to: Query data from a mobile service]: #querying\n[How to: Customize the client]: #customizing\n[How to: Work with untyped data]: #untyped\n[Customize request headers]: #headers\n[Customize serialization]: #serialization\n[Next steps]: #nextsteps\n[Caching the authentication token]: #caching\n\n<!-- URLs. -->\n[Get started with Mobile Services iOS]: /develop/mobile/tutorials/get-started-xamarin-ios\n[Get started with Mobile Services Android]: /develop/mobile/tutorials/get-started-xamarin-android\n[Xamarin download]: http://xamarin.com/download/\n[Mobile Services SDK]: http://go.microsoft.com/fwlink/?LinkId=257545\n[Xamarin.iOS quickstart tutorial]: /develop/mobile/tutorials/get-started-xamarin-ios/\n[Xamarin.Android quickstart tutorial]: /develop/mobile/tutorials/get-started-xamarin-android/\n[Xamarin.iOS data tutorial]: /develop/mobile/tutorials/get-started-with-data-xamarin-ios/\n[Xamarin.Android data tutorial]: /develop/mobile/tutorials/get-started-with-data-xamarin-android/\n[Xamarin.iOS authentication]: /develop/mobile/tutorials/get-started-with-users-xamarin-ios/\n[Xamarin.Android authentication]: /develop/mobile/tutorials/get-started-with-users-xamarin-android/\n[Mobile Services SDK]: http://go.microsoft.com/fwlink/?LinkId=257545\n[Xamarin.Auth component]: https://components.xamarin.com/view/xamarin.auth\n\n[Mobile Services SDK]: http://nuget.org/packages/WindowsAzure.MobileServices/\n[Get started with data iOS]: /develop/mobile/tutorials/get-started-with-data-xamarin-ios\n[Get started with data Android]: /develop/mobile/tutorials/get-started-with-data-xamarin-android\n[Get started with authentication iOS]: /develop/mobile/tutorials/get-started-with-users-xamarin-ios\n[Get started with authentication Android]: /develop/mobile/tutorials/get-started-with-users-xamarin-android\n[Validate and modify data with scripts ios]: /develop/mobile/tutorials/validate-modify-and-augment-data-xamarin-ios\n[Validate and modify data with scripts android]: /develop/mobile/tutorials/validate-modify-and-augment-data-xamarin-android\n[Refine queries with paging iOS]: /develop/mobile/tutorials/add-paging-to-data-xamarin-ios\n[Refine queries with paging Android]: /develop/mobile/tutorials/add-paging-to-data-xamarin-android\n[Authorize users with scripts iOS]: /develop/mobile/tutorials/authorize-users-in-scripts-xamarin-ios\n[Authorize users with scripts Android]: /develop/mobile/tutorials/authorize-users-in-scripts-xamarin-android\n[LoginAsync method]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceclientextensions.loginasync.aspx\n[MobileServiceAuthenticationProvider]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceauthenticationprovider.aspx\n[MobileServiceUser]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceuser.aspx\n[UserID]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceuser.userid.aspx\n[MobileServiceAuthenticationToken]: http://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.mobileservices.mobileserviceuser.mobileserviceauthenticationtoken.aspx\n"
}