{
  "nodes": [
    {
      "content": "Capacity planning for Hyper-V replication",
      "pos": [
        27,
        68
      ]
    },
    {
      "content": "This article contains instructions on how to use the capacity planner tool for Azure Site Recovery, and includes resources for capacity planning for Hyper-V replication",
      "pos": [
        87,
        255
      ]
    },
    {
      "content": "Capacity planning for Hyper-V replication",
      "pos": [
        593,
        634
      ]
    },
    {
      "content": "Azure Site Recovery uses Hyper-V Replica for replication between two on-premises VMM sites or between an on-premise VMM server and Azure storage.",
      "pos": [
        636,
        781
      ]
    },
    {
      "content": "This article contains step-by-step instructions on using the Capacity planner for Azure Site Recovery (ASR) - Hyper-V Replica tool.",
      "pos": [
        782,
        913
      ]
    },
    {
      "content": "The Capacity Planner for ASR - Hyper-V Replica tool guides an IT administrator in designing the server, storage, and network infrastructure that is required to successfully deploy Hyper-V Replica and to validate network connectivity between two sites.",
      "pos": [
        914,
        1165
      ]
    },
    {
      "content": "System requirements",
      "pos": [
        1170,
        1189
      ]
    },
    {
      "content": "Operating system: Windows Server® 2012 or Windows Server® 2012 R2",
      "pos": [
        1192,
        1257
      ]
    },
    {
      "content": "Memory: 20 MB (minimum)",
      "pos": [
        1260,
        1283
      ]
    },
    {
      "content": "CPU: 5 percent overhead (minimum)",
      "pos": [
        1286,
        1319
      ]
    },
    {
      "content": "Disk space: 5 MB (minimum)",
      "pos": [
        1322,
        1348
      ]
    },
    {
      "content": "Tutorial steps",
      "pos": [
        1353,
        1367
      ]
    },
    {
      "content": "Step 1: Prepare the primary site",
      "pos": [
        1370,
        1402
      ]
    },
    {
      "content": "Step 2: Prepare the recovery site if your recovery site is on-premises",
      "pos": [
        1405,
        1475
      ]
    },
    {
      "content": "Step 3: Run the capacity planner tool",
      "pos": [
        1478,
        1515
      ]
    },
    {
      "content": "Step 4: Interpret the results",
      "pos": [
        1518,
        1547
      ]
    },
    {
      "content": "Step 1: Prepare the primary site",
      "pos": [
        1552,
        1584
      ]
    },
    {
      "content": "Make a list of all of the Hyper-V virtual machines that will need to be enabled for replication and the corresponding primary Hyper-V hosts/clusters.",
      "pos": [
        1588,
        1737
      ]
    },
    {
      "content": "Group primary Hyper-V hosts and clusters into one of the following:",
      "pos": [
        1741,
        1808
      ]
    },
    {
      "content": "Windows Server® 2012 standalone servers",
      "pos": [
        1814,
        1853
      ]
    },
    {
      "content": "Windows Server® 2012 clusters",
      "pos": [
        1858,
        1887
      ]
    },
    {
      "content": "Windows Server® 2012 R2 standalone servers",
      "pos": [
        1892,
        1934
      ]
    },
    {
      "content": "Windows Server® 2012 R2 clusters",
      "pos": [
        1939,
        1971
      ]
    },
    {
      "content": "You will need to run the capacity planner tool once per standalone server group and once for each cluster.",
      "pos": [
        1976,
        2082
      ]
    },
    {
      "content": "Enable remote access to WMI on all primary hosts and clusters.",
      "pos": [
        2086,
        2148
      ]
    },
    {
      "content": "Ensure that the right set of firewall rules and user permissions are set.",
      "pos": [
        2149,
        2222
      ]
    },
    {
      "content": "Enable performance monitoring on the primary hosts.",
      "pos": [
        2282,
        2333
      ]
    },
    {
      "pos": [
        2339,
        2452
      ],
      "content": "Open the <bpt id=\"p1\">**</bpt>Windows Firewall<ept id=\"p1\">**</ept> with the <bpt id=\"p2\">**</bpt>Advanced Security<ept id=\"p2\">**</ept> snapin, and then enable the following inbound rules:"
    },
    {
      "content": "COM+ Network Access (DCOM-IN)",
      "pos": [
        2459,
        2488
      ]
    },
    {
      "content": "All rules in the Remote Event Log Management group",
      "pos": [
        2495,
        2545
      ]
    },
    {
      "content": "Step 2: Prepare the recovery site",
      "pos": [
        2550,
        2583
      ]
    },
    {
      "content": "If you are using Azure as the recovery site, or your on-premises recovery site is not yet ready, then you can skip this section.",
      "pos": [
        2584,
        2712
      ]
    },
    {
      "content": "But if you skip it, you won't be able to measure the available bandwidth between the two sites.",
      "pos": [
        2713,
        2808
      ]
    },
    {
      "content": "Identify the authentication method",
      "pos": [
        2813,
        2847
      ]
    },
    {
      "content": "a.",
      "pos": [
        2853,
        2855
      ]
    },
    {
      "content": "Kerberos: To be used when both the primary and recovery Hyper-V hosts are in the same domain or are in mutually trusted domains.",
      "pos": [
        2856,
        2984
      ]
    },
    {
      "content": "b.",
      "pos": [
        2990,
        2992
      ]
    },
    {
      "content": "Certificate: To be used when primary and recovery Hyper-V hosts are in different domains.",
      "pos": [
        2993,
        3082
      ]
    },
    {
      "content": "Certificates can be created using makecert.",
      "pos": [
        3083,
        3126
      ]
    },
    {
      "content": "For information about the steps required to deploy certificates using this technique, see the <bpt id=\"p1\">[</bpt>Hyper-V Replica Certificate Based Authentication - makecert<ept id=\"p1\">](http://blogs.technet.com/b/virtualization/archive/2013/04/13/hyper-v-replica-certificate-based-authentication-makecert.aspx)</ept> blog post.",
      "pos": [
        3127,
        3418
      ]
    },
    {
      "pos": [
        3423,
        3498
      ],
      "content": "Identify a <bpt id=\"p1\">**</bpt>single<ept id=\"p1\">**</ept> Recovery Hyper-V host/cluster from the recovery site."
    },
    {
      "content": "a.",
      "pos": [
        3504,
        3506
      ]
    },
    {
      "content": "This recovery host/cluster will be used to replicate a dummy virtual machine, and to estimate the available bandwidth between the primary and secondary sites.",
      "pos": [
        3507,
        3665
      ]
    },
    {
      "content": "b.",
      "pos": [
        3671,
        3673
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Recommended<ept id=\"p1\">**</ept>: Use a single recovery Hyper-V host for running the tests.",
      "pos": [
        3674,
        3748
      ]
    },
    {
      "content": "Prepare a single Hyper-V host as a recovery server",
      "pos": [
        3754,
        3804
      ]
    },
    {
      "pos": [
        3808,
        3879
      ],
      "content": "In Hyper-V Manager, click <bpt id=\"p1\">**</bpt>Hyper-V Settings<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Actions<ept id=\"p2\">**</ept> pane."
    },
    {
      "pos": [
        3883,
        3955
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Hyper-V Settings<ept id=\"p1\">**</ept> dialog, click <bpt id=\"p2\">**</bpt>Replication Configuration<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        3959,
        4032
      ],
      "content": "In the Details pane, select <bpt id=\"p1\">**</bpt>Enable this computer as a Replica server<ept id=\"p1\">**</ept>."
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Autentication and ports<ept id=\"p1\">**</ept> section, select the authentication method you previously chose.",
      "pos": [
        4036,
        4134
      ]
    },
    {
      "content": "For either authentication method, specify the port to be used (the default ports are 80 for kerberos over HTTP and 443 for certificate-based authentication over HTTPS).",
      "pos": [
        4135,
        4303
      ]
    },
    {
      "pos": [
        4307,
        4433
      ],
      "content": "If you are using certificate-based authentication, click <bpt id=\"p1\">**</bpt>Select Certificate<ept id=\"p1\">**</ept>, and then provide the certificate information."
    },
    {
      "pos": [
        4437,
        4587
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Authorization and Storage<ept id=\"p1\">**</ept> section, specify to allow <bpt id=\"p2\">**</bpt>any<ept id=\"p2\">**</ept> authenticated (primary) server to send replication data to this replica server."
    },
    {
      "pos": [
        4591,
        4617
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Apply<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        4703,
        4809
      ],
      "content": "Validate that the https listener is running by executing the command:\n     netsh http show servicestate",
      "leadings": [
        "",
        "   "
      ],
      "nodes": [
        {
          "content": "Validate that the https listener is running by executing the command:",
          "pos": [
            0,
            69
          ]
        },
        {
          "content": "netsh http show servicestate",
          "pos": [
            75,
            103
          ]
        }
      ]
    },
    {
      "content": "Open firewall ports:",
      "pos": [
        4813,
        4833
      ]
    },
    {
      "content": "Prepare a single Hyper-V cluster as a recovery target",
      "pos": [
        5097,
        5150
      ]
    },
    {
      "content": "If you have already prepared a standalone Hyper-V host a recovery server, then you can skip this section.",
      "pos": [
        5151,
        5256
      ]
    },
    {
      "content": "Configure Hyper-V Replica broker:",
      "pos": [
        5261,
        5294
      ]
    },
    {
      "content": "a.",
      "pos": [
        5300,
        5302
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Server Manager<ept id=\"p1\">**</ept>, open <bpt id=\"p2\">**</bpt>Failover Cluster Manager<ept id=\"p2\">**</ept>.",
      "pos": [
        5303,
        5360
      ]
    },
    {
      "content": "b.",
      "pos": [
        5366,
        5368
      ]
    },
    {
      "content": "In the left pane, connect to the cluster, and while the cluster name is highlighted, click <bpt id=\"p1\">**</bpt>Configure Role<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Actions<ept id=\"p2\">**</ept> pane.",
      "pos": [
        5369,
        5503
      ]
    },
    {
      "content": "This opens the <bpt id=\"p1\">**</bpt>High Availability wizard<ept id=\"p1\">**</ept>.",
      "pos": [
        5504,
        5548
      ]
    },
    {
      "content": "c.",
      "pos": [
        5554,
        5556
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Select Role<ept id=\"p1\">**</ept> screen, select <bpt id=\"p2\">**</bpt>Hyper-V Replica Broker<ept id=\"p2\">**</ept>.",
      "pos": [
        5557,
        5622
      ]
    },
    {
      "content": "d.",
      "pos": [
        5628,
        5630
      ]
    },
    {
      "content": "Complete the wizard, providing a <bpt id=\"p1\">**</bpt>NetBIOS name<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>IP address<ept id=\"p2\">**</ept> to be used as the connection point to the cluster (called a client access point).",
      "pos": [
        5631,
        5781
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>Hyper-V Replica Broker<ept id=\"p1\">**</ept> is configured, resulting in a client access point name.",
      "pos": [
        5782,
        5868
      ]
    },
    {
      "content": "Make a note of the client access point name - you will use it to configure the replica later on.",
      "pos": [
        5869,
        5965
      ]
    },
    {
      "content": "e.",
      "pos": [
        5971,
        5973
      ]
    },
    {
      "content": "Verify that the Hyper-V Replica Broker role comes online successfully and can fail over between all nodes of the cluster.",
      "pos": [
        5974,
        6095
      ]
    },
    {
      "content": "To do this, right click the role, point to <bpt id=\"p1\">**</bpt>Move<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Select Node<ept id=\"p2\">**</ept>.",
      "pos": [
        6096,
        6180
      ]
    },
    {
      "content": "Select a node &gt; <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.",
      "pos": [
        6181,
        6204
      ]
    },
    {
      "content": "f.",
      "pos": [
        6210,
        6212
      ]
    },
    {
      "content": "If you use certificate-based authentication, ensure that each cluster node and the Hyper-V Replica Broker's client access point all have the certificate installed.",
      "pos": [
        6213,
        6376
      ]
    },
    {
      "content": "Configure replica settings:",
      "pos": [
        6381,
        6408
      ]
    },
    {
      "content": "a.",
      "pos": [
        6414,
        6416
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Server Manager<ept id=\"p1\">**</ept>, open <bpt id=\"p2\">**</bpt>Failover Cluster Manager<ept id=\"p2\">**</ept>.",
      "pos": [
        6417,
        6474
      ]
    },
    {
      "content": "b.",
      "pos": [
        6484,
        6486
      ]
    },
    {
      "content": "In the left pane, connect to the cluster, and while the cluster name is highlighted, click <bpt id=\"p1\">**</bpt>Roles<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Navigate<ept id=\"p2\">**</ept> category of the <bpt id=\"p3\">**</bpt>Details<ept id=\"p3\">**</ept> pane.",
      "pos": [
        6487,
        6641
      ]
    },
    {
      "content": "c.",
      "pos": [
        6651,
        6653
      ]
    },
    {
      "content": "Right-click the role, and then choose <bpt id=\"p1\">**</bpt>Replication Settings<ept id=\"p1\">**</ept>.",
      "pos": [
        6654,
        6717
      ]
    },
    {
      "content": "d.",
      "pos": [
        6727,
        6729
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Details<ept id=\"p1\">**</ept> pane, select <bpt id=\"p2\">**</bpt>Enable this cluster as a Replica Server<ept id=\"p2\">**</ept>.",
      "pos": [
        6730,
        6806
      ]
    },
    {
      "content": "e.",
      "pos": [
        6812,
        6814
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Authentication and ports<ept id=\"p1\">**</ept> section, select the authentication method you chose earlier.",
      "pos": [
        6815,
        6911
      ]
    },
    {
      "content": "For either authentication method, specify the port to be used (the default ports are 80 for Kerberos over HTTP, and 443 for certificate-based authentication over HTTPS).",
      "pos": [
        6912,
        7081
      ]
    },
    {
      "content": "f.",
      "pos": [
        7087,
        7089
      ]
    },
    {
      "content": "If you are using certificate-based authentication, click <bpt id=\"p1\">**</bpt>Select Certificate<ept id=\"p1\">**</ept>, and then provide the reqeusted certificate information.",
      "pos": [
        7090,
        7226
      ]
    },
    {
      "content": "g.",
      "pos": [
        7232,
        7234
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Authorization and storage<ept id=\"p1\">**</ept> section, specify whether to allow <bpt id=\"p2\">**</bpt>any<ept id=\"p2\">**</ept> authenticated (primary) server to send replication data to this replica server or to limit acceptance to data from specific primary servers.",
      "pos": [
        7235,
        7454
      ]
    },
    {
      "content": "You can use wildcard characters to limit acceptance to servers from a particular domain without having to specify them each individually (for example, *.contoso.com).",
      "pos": [
        7455,
        7621
      ]
    },
    {
      "pos": [
        7627,
        7899
      ],
      "content": "h. Open firewall ports on all recovery Hyper-V hosts:\n       Port 443 (Certificate auth):\n          Get-ClusterNode | ForEach-Object {Invoke-command -computername \\$\\_.name -scriptblock {Enable-Netfirewallrule -displayname \"Hyper-V Replica HTTPS Listener (TCP-In)\"}}",
      "leadings": [
        "",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "h. Open firewall ports on all recovery Hyper-V hosts:",
          "pos": [
            0,
            53
          ],
          "nodes": [
            {
              "content": "h.",
              "pos": [
                0,
                2
              ]
            },
            {
              "content": "Open firewall ports on all recovery Hyper-V hosts:",
              "pos": [
                3,
                53
              ]
            }
          ]
        },
        {
          "content": "Port 443 (Certificate auth):",
          "pos": [
            61,
            89
          ]
        },
        {
          "content": "Get-ClusterNode | ForEach-Object {Invoke-command -computername \\$\\_.name -scriptblock {Enable-Netfirewallrule -displayname \"Hyper-V Replica HTTPS Listener (TCP-In)\"}}",
          "pos": [
            100,
            266
          ]
        }
      ]
    },
    {
      "content": "Step 3: Run the capacity planner tool",
      "pos": [
        8122,
        8159
      ]
    },
    {
      "content": "Download the Capacity Planner tool.",
      "pos": [
        8163,
        8198
      ]
    },
    {
      "content": "Run the tool from one of the primary servers (or one of the nodes from the primary cluster).",
      "pos": [
        8202,
        8294
      ]
    },
    {
      "content": "Right-click the .exe file, and then choose <bpt id=\"p1\">**</bpt>Run as administrator<ept id=\"p1\">**</ept>.",
      "pos": [
        8295,
        8363
      ]
    },
    {
      "pos": [
        8367,
        8439
      ],
      "content": "If you choose, accept the <bpt id=\"p1\">**</bpt>Terms of License<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Select a <bpt id=\"p1\">**</bpt>Duration for metric collection<ept id=\"p1\">**</ept>.",
      "pos": [
        8443,
        8487
      ]
    },
    {
      "content": "It is highly recommended that the tool runs during production hours to ensure that the most representative data is collected.",
      "pos": [
        8488,
        8613
      ]
    },
    {
      "content": "The suggested duration for metric collection is 30 minutes.",
      "pos": [
        8614,
        8673
      ]
    },
    {
      "content": "If you're only trying to validate network connectivity, you can choose one minute as the duration.",
      "pos": [
        8674,
        8772
      ]
    },
    {
      "pos": [
        8858,
        8930
      ],
      "content": "Specify the <bpt id=\"p1\">**</bpt>Primary site details<ept id=\"p1\">**</ept>, as shown, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."
    },
    {
      "content": "For a standalone host, enter the server name or FQDN.",
      "pos": [
        8936,
        8989
      ]
    },
    {
      "content": "If your Primary host is part of a cluster, you can enter FQDN of one of the following:",
      "pos": [
        8995,
        9081
      ]
    },
    {
      "content": "a.",
      "pos": [
        9087,
        9089
      ]
    },
    {
      "content": "The Hyper-V Replica Broker Client Access Point (CAP)",
      "pos": [
        9090,
        9142
      ]
    },
    {
      "content": "b.",
      "pos": [
        9148,
        9150
      ]
    },
    {
      "content": "The cluster name",
      "pos": [
        9151,
        9167
      ]
    },
    {
      "content": "c.",
      "pos": [
        9173,
        9175
      ]
    },
    {
      "content": "Any node of the cluster",
      "pos": [
        9176,
        9199
      ]
    },
    {
      "pos": [
        9288,
        9378
      ],
      "content": "Enter the <bpt id=\"p1\">**</bpt>Replica site details<ept id=\"p1\">**</ept> (on-premises site to on-premises site replication only)"
    },
    {
      "content": "If you want to enable replication to Azure or you didn't prepare a Hyper-V host or cluster as a recovery server (as explained in Step 2), you should skip test involving the replica site.",
      "pos": [
        9382,
        9568
      ]
    },
    {
      "pos": [
        9572,
        9634
      ],
      "content": "Specify the <bpt id=\"p1\">**</bpt>Replica site<ept id=\"p1\">**</ept> details, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."
    },
    {
      "content": "i.",
      "pos": [
        9636,
        9638
      ]
    },
    {
      "content": "For a standalone host, enter the server name or FQDN",
      "pos": [
        9639,
        9691
      ]
    },
    {
      "content": "ii.",
      "pos": [
        9693,
        9696
      ]
    },
    {
      "content": "If your Primary host is part of a cluster, you can enter FQDN of one of the following:",
      "pos": [
        9697,
        9783
      ]
    },
    {
      "content": "a.",
      "pos": [
        9785,
        9787
      ]
    },
    {
      "content": "The Hyper-V Replica Broker Client Access Point (CAP)",
      "pos": [
        9788,
        9840
      ]
    },
    {
      "content": "b.",
      "pos": [
        9842,
        9844
      ]
    },
    {
      "content": "The cluster name",
      "pos": [
        9845,
        9861
      ]
    },
    {
      "content": "c.",
      "pos": [
        9863,
        9865
      ]
    },
    {
      "content": "Any node of the cluster",
      "pos": [
        9866,
        9889
      ]
    },
    {
      "content": "Skip the tests involving <bpt id=\"p1\">**</bpt>Extended Replica site<ept id=\"p1\">**</ept>.",
      "pos": [
        9978,
        10029
      ]
    },
    {
      "content": "They are not supported by ASR.",
      "pos": [
        10030,
        10060
      ]
    },
    {
      "content": "Select the virtual machines to profile.",
      "pos": [
        10064,
        10103
      ]
    },
    {
      "content": "The tool connects to the cluster or standalone servers specified in <bpt id=\"p1\">**</bpt>Primary Site Details<ept id=\"p1\">**</ept>, and enumerates the virtual machines that are running.",
      "pos": [
        10104,
        10251
      ]
    },
    {
      "content": "Select the virtual machines and virtual disks for which you want metrics to be collected.",
      "pos": [
        10252,
        10341
      ]
    },
    {
      "content": "The following virtual machines will not be enumerated or shown:",
      "pos": [
        10343,
        10406
      ]
    },
    {
      "content": "Virtual machines that have already been enabled for replication",
      "pos": [
        10410,
        10473
      ]
    },
    {
      "content": "Virtual machines that are not running",
      "pos": [
        10476,
        10513
      ]
    },
    {
      "pos": [
        10518,
        10669
      ],
      "content": "Enter <bpt id=\"p1\">**</bpt>Network information<ept id=\"p1\">**</ept> (this is applicable only to on-premises site to on-premises site replication and when replica site details are provided)."
    },
    {
      "pos": [
        10671,
        10738
      ],
      "content": "Specify the requested network information, and then click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Estimated WAN bandwidth",
      "pos": [
        10742,
        10765
      ]
    },
    {
      "content": "The certificate to be used for authentication (optional): If you plan to use certificate-based authentication, you should provide the required certificates on this page.",
      "pos": [
        10768,
        10937
      ]
    },
    {
      "pos": [
        11027,
        11088
      ],
      "content": "On the next set of screens, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to start the tool."
    },
    {
      "pos": [
        11175,
        11249
      ],
      "content": "When the tool is done running, click <bpt id=\"p1\">**</bpt>View Report<ept id=\"p1\">**</ept> to review the output."
    },
    {
      "content": "Default report location:",
      "pos": [
        11255,
        11279
      ]
    },
    {
      "content": "%systemdrive%\\Users\\Public\\Documents\\Capacity Planner",
      "pos": [
        11285,
        11338
      ]
    },
    {
      "content": "Logs location:",
      "pos": [
        11344,
        11358
      ]
    },
    {
      "content": "%systemdrive%\\Users\\Public\\Documents\\CapacityPlanner",
      "pos": [
        11364,
        11416
      ]
    },
    {
      "content": "Step 4: Interpret the results",
      "pos": [
        11421,
        11450
      ]
    },
    {
      "content": "You can ignore metrics which are not listed under one of the following two scenarios, as they are not relevant for this scenario.",
      "pos": [
        11451,
        11580
      ]
    },
    {
      "content": "On-premises site to on-premises site replication",
      "pos": [
        11586,
        11634
      ]
    },
    {
      "content": "Impact of replication on the primary host's compute, memory",
      "pos": [
        11639,
        11698
      ]
    },
    {
      "content": "Impact of replication on the primary, recovery hosts's storage disk space, IOPS",
      "pos": [
        11703,
        11782
      ]
    },
    {
      "content": "Total bandwidth required for delta replication (Mbps)",
      "pos": [
        11787,
        11840
      ]
    },
    {
      "content": "Observed network bandwidth between the primary host and the recovery host (Mbps)",
      "pos": [
        11845,
        11925
      ]
    },
    {
      "content": "Suggestion for the ideal number of active parallel transfers between the two hosts/clusters",
      "pos": [
        11930,
        12021
      ]
    },
    {
      "content": "On-premises site to Azure replication",
      "pos": [
        12027,
        12064
      ]
    },
    {
      "content": "Impact of replication on the primary host's compute, memory",
      "pos": [
        12069,
        12128
      ]
    },
    {
      "content": "Impact of replication on the primary host's storage disk space, IOPS",
      "pos": [
        12133,
        12201
      ]
    },
    {
      "content": "Total bandwidth required for delta replication (Mbps)",
      "pos": [
        12206,
        12259
      ]
    },
    {
      "pos": [
        12261,
        12398
      ],
      "content": "More detailed guidance can be found on the <bpt id=\"p1\">[</bpt>Capacity Planner for Hyper-V Replica download page<ept id=\"p1\">](http://go.microsoft.com/?linkid=9876170)</ept>."
    },
    {
      "content": "Other resources",
      "pos": [
        12403,
        12418
      ]
    },
    {
      "content": "The following resources can help you with capacity planning for Hyper-V replication:",
      "pos": [
        12419,
        12503
      ]
    },
    {
      "pos": [
        12507,
        12655
      ],
      "content": "<bpt id=\"p1\">[</bpt>Update: Capacity Planner for Hyper-V Replica<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=510891)</ept>—Read this blog entry for an overview of this new tool."
    },
    {
      "pos": [
        12659,
        12786
      ],
      "content": "<bpt id=\"p1\">[</bpt>Capacity Planner for Hyper-V Replica<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=510892)</ept>—Download the latest version of this tool."
    },
    {
      "pos": [
        12790,
        12948
      ],
      "content": "<bpt id=\"p1\">[</bpt>Guided Hands-On Lab<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=510893)</ept>—Get a great walkthrough of capacity planning with the tool on Keith Mayer’s TechNet blog."
    },
    {
      "pos": [
        12952,
        13156
      ],
      "content": "<bpt id=\"p1\">[</bpt>Performance and Scaling Testing - On-Premises to On-Premises<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/dn760892.aspx)</ept>—Read the results of replication testing for an on-premises to on-premises deployment."
    },
    {
      "content": "Next steps",
      "pos": [
        13162,
        13172
      ]
    },
    {
      "content": "To start deploying ASR:",
      "pos": [
        13174,
        13197
      ]
    },
    {
      "content": "Set up protection between an on-premises VMM site and Azure",
      "pos": [
        13202,
        13261
      ]
    },
    {
      "content": "Set up protection between an on-premises Hyper-V site and Azure",
      "pos": [
        13297,
        13360
      ]
    },
    {
      "content": "Set up protection between two on-premises VMM sites",
      "pos": [
        13402,
        13453
      ]
    },
    {
      "content": "Set up protection between two on-premises VMM sites with SAN",
      "pos": [
        13484,
        13544
      ]
    },
    {
      "content": "Set up protection with a single VMM server",
      "pos": [
        13572,
        13614
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Capacity planning for Hyper-V replication\"\n    description=\"This article contains instructions on how to use the capacity planner tool for Azure Site Recovery, and includes resources for capacity planning for Hyper-V replication\"\n    services=\"site-recovery\"\n    documentationCenter=\"na\"\n    authors=\"csilauraa\"\n    manager=\"jwhit\"\n    editor=\"tysonn\" />\n<tags\n    ms.service=\"site-recovery\"\n    ms.devlang=\"na\"\n    ms.topic=\"get-started-article\"\n    ms.tgt_pltfrm=\"na\"\n    ms.workload=\"infrastructure-services\"\n    ms.date=\"08/05/2015\"\n    ms.author=\"lauraa\" />\n\n# Capacity planning for Hyper-V replication\n\nAzure Site Recovery uses Hyper-V Replica for replication between two on-premises VMM sites or between an on-premise VMM server and Azure storage. This article contains step-by-step instructions on using the Capacity planner for Azure Site Recovery (ASR) - Hyper-V Replica tool. The Capacity Planner for ASR - Hyper-V Replica tool guides an IT administrator in designing the server, storage, and network infrastructure that is required to successfully deploy Hyper-V Replica and to validate network connectivity between two sites.\n\n## System requirements\n- Operating system: Windows Server® 2012 or Windows Server® 2012 R2\n- Memory: 20 MB (minimum)\n- CPU: 5 percent overhead (minimum)\n- Disk space: 5 MB (minimum)\n\n## Tutorial steps\n- Step 1: Prepare the primary site\n- Step 2: Prepare the recovery site if your recovery site is on-premises\n- Step 3: Run the capacity planner tool\n- Step 4: Interpret the results\n\n## Step 1: Prepare the primary site\n1. Make a list of all of the Hyper-V virtual machines that will need to be enabled for replication and the corresponding primary Hyper-V hosts/clusters.\n2. Group primary Hyper-V hosts and clusters into one of the following:\n\n  - Windows Server® 2012 standalone servers\n  - Windows Server® 2012 clusters\n  - Windows Server® 2012 R2 standalone servers\n  - Windows Server® 2012 R2 clusters\n\n3. You will need to run the capacity planner tool once per standalone server group and once for each cluster.\n4. Enable remote access to WMI on all primary hosts and clusters. Ensure that the right set of firewall rules and user permissions are set.\n\n        netsh firewall set service RemoteAdmin enable\n\n5. Enable performance monitoring on the primary hosts.\n\n  - Open the **Windows Firewall** with the **Advanced Security** snapin, and then enable the following inbound rules:\n    - COM+ Network Access (DCOM-IN)\n    - All rules in the Remote Event Log Management group\n\n## Step 2: Prepare the recovery site\nIf you are using Azure as the recovery site, or your on-premises recovery site is not yet ready, then you can skip this section. But if you skip it, you won't be able to measure the available bandwidth between the two sites.\n\n1. Identify the authentication method\n\n    a. Kerberos: To be used when both the primary and recovery Hyper-V hosts are in the same domain or are in mutually trusted domains.\n\n    b. Certificate: To be used when primary and recovery Hyper-V hosts are in different domains. Certificates can be created using makecert. For information about the steps required to deploy certificates using this technique, see the [Hyper-V Replica Certificate Based Authentication - makecert](http://blogs.technet.com/b/virtualization/archive/2013/04/13/hyper-v-replica-certificate-based-authentication-makecert.aspx) blog post.\n\n2. Identify a **single** Recovery Hyper-V host/cluster from the recovery site.\n\n    a. This recovery host/cluster will be used to replicate a dummy virtual machine, and to estimate the available bandwidth between the primary and secondary sites.\n\n    b. **Recommended**: Use a single recovery Hyper-V host for running the tests.\n\n### Prepare a single Hyper-V host as a recovery server\n1. In Hyper-V Manager, click **Hyper-V Settings** in the **Actions** pane.\n2. In the **Hyper-V Settings** dialog, click **Replication Configuration**.\n3. In the Details pane, select **Enable this computer as a Replica server**.\n4. In the **Autentication and ports** section, select the authentication method you previously chose. For either authentication method, specify the port to be used (the default ports are 80 for kerberos over HTTP and 443 for certificate-based authentication over HTTPS).\n5. If you are using certificate-based authentication, click **Select Certificate**, and then provide the certificate information.\n6. In the **Authorization and Storage** section, specify to allow **any** authenticated (primary) server to send replication data to this replica server.\n7. Click **OK** or **Apply**.\n\n![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image1.png)\n\n8. Validate that the https listener is running by executing the command:\n        netsh http show servicestate\n9. Open firewall ports:\n\n        Port 443 (certificae-based authentication):\n          Enable-Netfirewallrule -displayname \"Hyper-V Replica HTTPS Listener (TCP-In)\"\n\n\n        Port 80 (Kerberos):\n          Enable-Netfirewallrule -displayname \"Hyper-V Replica HTTP Listener (TCP-In)\"\n\n### Prepare a single Hyper-V cluster as a recovery target\nIf you have already prepared a standalone Hyper-V host a recovery server, then you can skip this section.\n\n1. Configure Hyper-V Replica broker:\n\n    a. In **Server Manager**, open **Failover Cluster Manager**.\n\n    b. In the left pane, connect to the cluster, and while the cluster name is highlighted, click **Configure Role** in the **Actions** pane. This opens the **High Availability wizard**.\n\n    c. In the **Select Role** screen, select **Hyper-V Replica Broker**.\n\n    d. Complete the wizard, providing a **NetBIOS name** and **IP address** to be used as the connection point to the cluster (called a client access point). The **Hyper-V Replica Broker** is configured, resulting in a client access point name. Make a note of the client access point name - you will use it to configure the replica later on.\n\n    e. Verify that the Hyper-V Replica Broker role comes online successfully and can fail over between all nodes of the cluster. To do this, right click the role, point to **Move**, and then click **Select Node**. Select a node > **OK**.\n\n    f. If you use certificate-based authentication, ensure that each cluster node and the Hyper-V Replica Broker's client access point all have the certificate installed.\n\n2. Configure replica settings:\n\n    a. In **Server Manager**, open **Failover Cluster Manager**.\n    \n    b. In the left pane, connect to the cluster, and while the cluster name is highlighted, click **Roles** in the **Navigate** category of the **Details** pane.\n    \n    c. Right-click the role, and then choose **Replication Settings**.\n    \n    d. In the **Details** pane, select **Enable this cluster as a Replica Server**.\n\n    e. In the **Authentication and ports** section, select the authentication method you chose earlier. For either authentication method, specify the port to be used (the default ports are 80 for Kerberos over HTTP, and 443 for certificate-based authentication over HTTPS).\n\n    f. If you are using certificate-based authentication, click **Select Certificate**, and then provide the reqeusted certificate information.\n\n    g. In the **Authorization and storage** section, specify whether to allow **any** authenticated (primary) server to send replication data to this replica server or to limit acceptance to data from specific primary servers. You can use wildcard characters to limit acceptance to servers from a particular domain without having to specify them each individually (for example, *.contoso.com).\n\n    h. Open firewall ports on all recovery Hyper-V hosts:\n          Port 443 (Certificate auth):\n             Get-ClusterNode | ForEach-Object {Invoke-command -computername \\$\\_.name -scriptblock {Enable-Netfirewallrule -displayname \"Hyper-V Replica HTTPS Listener (TCP-In)\"}}\n\n\n          Port 80 (Kerberos auth):\n              Get-ClusterNode | ForEach-Object {Invoke-command -computername \\$\\_.name -scriptblock {Enable-Netfirewallrule -displayname \"Hyper-V Replica HTTP Listener (TCP-In)\"}}\n\n\n## Step 3: Run the capacity planner tool\n1. Download the Capacity Planner tool.\n2. Run the tool from one of the primary servers (or one of the nodes from the primary cluster). Right-click the .exe file, and then choose **Run as administrator**.\n3. If you choose, accept the **Terms of License**, and then click **Next**.\n4. Select a **Duration for metric collection**. It is highly recommended that the tool runs during production hours to ensure that the most representative data is collected. The suggested duration for metric collection is 30 minutes. If you're only trying to validate network connectivity, you can choose one minute as the duration.\n\n![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image2.png)\n\n5. Specify the **Primary site details**, as shown, and then click **Next**.\n\n    For a standalone host, enter the server name or FQDN.\n\n    If your Primary host is part of a cluster, you can enter FQDN of one of the following:\n\n    a. The Hyper-V Replica Broker Client Access Point (CAP)\n\n    b. The cluster name\n\n    c. Any node of the cluster\n\n  ![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image3.png)\n\n\n6. Enter the **Replica site details** (on-premises site to on-premises site replication only)\n\n  If you want to enable replication to Azure or you didn't prepare a Hyper-V host or cluster as a recovery server (as explained in Step 2), you should skip test involving the replica site.\n\n  Specify the **Replica site** details, and then click **Next**.\n\ni. For a standalone host, enter the server name or FQDN\n\nii. If your Primary host is part of a cluster, you can enter FQDN of one of the following:\n\na. The Hyper-V Replica Broker Client Access Point (CAP)\n\nb. The cluster name\n\nc. Any node of the cluster\n\n   ![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image4.png)\n\n7. Skip the tests involving **Extended Replica site**. They are not supported by ASR.\n8. Select the virtual machines to profile. The tool connects to the cluster or standalone servers specified in **Primary Site Details**, and enumerates the virtual machines that are running. Select the virtual machines and virtual disks for which you want metrics to be collected.\n\nThe following virtual machines will not be enumerated or shown:\n\n- Virtual machines that have already been enabled for replication\n- Virtual machines that are not running\n\n9. Enter **Network information** (this is applicable only to on-premises site to on-premises site replication and when replica site details are provided).\n\nSpecify the requested network information, and then click **Next**.\n\n- Estimated WAN bandwidth\n- The certificate to be used for authentication (optional): If you plan to use certificate-based authentication, you should provide the required certificates on this page.\n\n   ![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image5.png)\n\n10. On the next set of screens, click **Next** to start the tool.\n\n![](./media/site-recovery-capacity-planning-for-hyper-v-replication/image6.png)\n\n11. When the tool is done running, click **View Report** to review the output.\n\n    Default report location:\n\n    %systemdrive%\\Users\\Public\\Documents\\Capacity Planner\n\n    Logs location:\n\n    %systemdrive%\\Users\\Public\\Documents\\CapacityPlanner\n\n## Step 4: Interpret the results\nYou can ignore metrics which are not listed under one of the following two scenarios, as they are not relevant for this scenario.\n\n### On-premises site to on-premises site replication\n  - Impact of replication on the primary host's compute, memory\n  - Impact of replication on the primary, recovery hosts's storage disk space, IOPS\n  - Total bandwidth required for delta replication (Mbps)\n  - Observed network bandwidth between the primary host and the recovery host (Mbps)\n  - Suggestion for the ideal number of active parallel transfers between the two hosts/clusters\n\n### On-premises site to Azure replication\n  - Impact of replication on the primary host's compute, memory\n  - Impact of replication on the primary host's storage disk space, IOPS\n  - Total bandwidth required for delta replication (Mbps)\n\nMore detailed guidance can be found on the [Capacity Planner for Hyper-V Replica download page](http://go.microsoft.com/?linkid=9876170).\n\n## Other resources\nThe following resources can help you with capacity planning for Hyper-V replication:\n\n- [Update: Capacity Planner for Hyper-V Replica](http://go.microsoft.com/fwlink/?LinkId=510891)—Read this blog entry for an overview of this new tool.\n\n- [Capacity Planner for Hyper-V Replica](http://go.microsoft.com/fwlink/?LinkId=510892)—Download the latest version of this tool.\n\n- [Guided Hands-On Lab](http://go.microsoft.com/fwlink/?LinkId=510893)—Get a great walkthrough of capacity planning with the tool on Keith Mayer’s TechNet blog.\n\n- [Performance and Scaling Testing - On-Premises to On-Premises](https://msdn.microsoft.com/library/azure/dn760892.aspx)—Read the results of replication testing for an on-premises to on-premises deployment.\n\n\n## Next steps\n\nTo start deploying ASR:\n\n- [Set up protection between an on-premises VMM site and Azure](site-recovery-vmm-to-azure.md)\n- [Set up protection between an on-premises Hyper-V site and Azure](site-recovery-hyper-v-site-to-azure)\n- [Set up protection between two on-premises VMM sites](site-recovery-vmm-to-vmm)\n- [Set up protection between two on-premises VMM sites with SAN](site-recovery-vmm-san)\n- [Set up protection with a single VMM server](site-recovery-single-vmm)\n \n"
}