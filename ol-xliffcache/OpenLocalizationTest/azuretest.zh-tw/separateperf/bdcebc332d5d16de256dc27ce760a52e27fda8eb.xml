{
  "nodes": [
    {
      "content": "Azure Mobile Engagement Android SDK Integration",
      "pos": [
        28,
        75
      ]
    },
    {
      "content": "Latest updates and procedures for Android SDK for Azure Mobile Engagement",
      "pos": [
        95,
        168
      ]
    },
    {
      "content": "How to Integrate Engagement Reach on Android",
      "pos": [
        510,
        554
      ]
    },
    {
      "pos": [
        558,
        711
      ],
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> You must follow the integration procedure described in the How to Integrate Engagement on Android document before following this guide."
    },
    {
      "content": "Standard integration",
      "pos": [
        715,
        735
      ]
    },
    {
      "pos": [
        737,
        797
      ],
      "content": "The Reach SDK requires the <bpt id=\"p1\">**</bpt>Android Support library (v4)<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        799,
        941
      ],
      "content": "The fastest way to add the library to your project in <bpt id=\"p1\">**</bpt>Eclipse<ept id=\"p1\">**</ept> is <ph id=\"ph1\">`Right click on your project -&gt; Android Tools -&gt; Add Support Library...`</ph>."
    },
    {
      "pos": [
        943,
        1006
      ],
      "content": "If you don't use Eclipse, you can read the instructions <bpt id=\"p1\">[</bpt><ept id=\"p1\">here]</ept>."
    },
    {
      "content": "Copy Reach resource files from the SDK in your project :",
      "pos": [
        1008,
        1064
      ]
    },
    {
      "pos": [
        1070,
        1186
      ],
      "content": "Copy the files from the <ph id=\"ph1\">`res/layout`</ph> folder delivered with the SDK into the <ph id=\"ph2\">`res/layout`</ph> folder of your application."
    },
    {
      "pos": [
        1191,
        1311
      ],
      "content": "Copy the files from the <ph id=\"ph1\">`res/drawable`</ph> folder delivered with the SDK into the <ph id=\"ph2\">`res/drawable`</ph> folder of your application."
    },
    {
      "pos": [
        1313,
        1350
      ],
      "content": "Edit your <ph id=\"ph1\">`AndroidManifest.xml`</ph> file:"
    },
    {
      "pos": [
        1356,
        1438
      ],
      "content": "Add the following section (between the <ph id=\"ph1\">`&lt;application&gt;`</ph> and <ph id=\"ph2\">`&lt;/application&gt;`</ph> tags):"
    },
    {
      "content": "You need this permission to replay system notifications that were not clicked at boot (otherwise they will be kept on disk but won't be displayed anymore, you really have to include this).",
      "pos": [
        4316,
        4504
      ]
    },
    {
      "pos": [
        4600,
        4770
      ],
      "content": "Specify an icon used for notifications (both in app and system ones) by copying and editing the following section (between the <ph id=\"ph1\">`&lt;application&gt;`</ph> and <ph id=\"ph2\">`&lt;/application&gt;`</ph> tags):"
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> This section is <bpt id=\"p1\">**</bpt>mandatory<ept id=\"p1\">**</ept> if you plan on using system notifications when creating Reach campaigns.",
      "pos": [
        4930,
        5050
      ]
    },
    {
      "content": "Android prevents system notifications without icons from being shown.",
      "pos": [
        5051,
        5120
      ]
    },
    {
      "content": "So if you omit this section, your end users will not be able to receive them.",
      "pos": [
        5121,
        5198
      ]
    },
    {
      "pos": [
        5204,
        5359
      ],
      "content": "If you create campaigns with system notifications using big picture, you need to add the following permissions (after the <ph id=\"ph1\">`&lt;/application&gt;`</ph> tag) if missing:"
    },
    {
      "content": "On Android M and if your application targets Android API level 23 or greater, <ph id=\"ph1\">``WRITE_EXTERNAL_STORAGE``</ph> permission requires user approval.",
      "pos": [
        5551,
        5690
      ]
    },
    {
      "content": "Please read <bpt id=\"p1\">[</bpt>this section<ept id=\"p1\">](mobile-engagement-android-integrate-engagement.md#android-m-permissions)</ept>.",
      "pos": [
        5691,
        5791
      ]
    },
    {
      "content": "For system notifications you can also specify in the Reach campaign if the device should ring and/or vibrate.",
      "pos": [
        5797,
        5906
      ]
    },
    {
      "content": "For it to work, you have to make sure you declared the following permission (after the <ph id=\"ph1\">`&lt;/application&gt;`</ph> tag):",
      "pos": [
        5907,
        6016
      ]
    },
    {
      "content": "Without this permission, Android prevents system notifications from being shown if you checked the ring or the vibrate option in the Reach Campaign manager.",
      "pos": [
        6097,
        6253
      ]
    },
    {
      "pos": [
        6259,
        6438
      ],
      "content": "If you build your application using <bpt id=\"p1\">**</bpt>ProGuard<ept id=\"p1\">**</ept> and have errors related to the Android Support library or the Engagement jar, add the following lines to your <ph id=\"ph1\">`proguard.cfg`</ph> file:"
    },
    {
      "content": "Native Push",
      "pos": [
        6530,
        6541
      ]
    },
    {
      "content": "Now that you configured Reach module, you need to configure native push to be able to receive the campaigns on the device.",
      "pos": [
        6543,
        6665
      ]
    },
    {
      "content": "We support two services on Android:",
      "pos": [
        6667,
        6702
      ]
    },
    {
      "pos": [
        6708,
        6870
      ],
      "content": "Google Play devices: Use <bpt id=\"p1\">[</bpt><ept id=\"p1\">Google Cloud Messaging]</ept> by following the <bpt id=\"p2\">[</bpt>How to Integrate GCM with Engagement guide<ept id=\"p2\">](mobile-engagement-android-gcm-integrate.md)</ept> guide."
    },
    {
      "pos": [
        6875,
        7033
      ],
      "content": "Amazon devices: Use <bpt id=\"p1\">[</bpt><ept id=\"p1\">Amazon Device Messaging]</ept> by following the <bpt id=\"p2\">[</bpt>How to Integrate ADM with Engagement guide<ept id=\"p2\">](mobile-engagement-android-adm-integrate.md)</ept> guide."
    },
    {
      "content": "If you want to target both Amazon and Google Play devices, its possible to have everything inside 1 AndroidManifest.xml/APK for development.",
      "pos": [
        7035,
        7175
      ]
    },
    {
      "content": "But when submitting to Amazon, they may reject your application if they find GCM code.",
      "pos": [
        7176,
        7262
      ]
    },
    {
      "content": "You should use multiple APKs in that case.",
      "pos": [
        7264,
        7306
      ]
    },
    {
      "content": "Your application is now ready to receive and display reach campaigns!",
      "pos": [
        7310,
        7379
      ]
    },
    {
      "content": "How to handle data push",
      "pos": [
        7385,
        7408
      ]
    },
    {
      "content": "Integration",
      "pos": [
        7414,
        7425
      ]
    },
    {
      "pos": [
        7427,
        7712
      ],
      "content": "If you want your application to be able to receive Reach data pushes, you have to create a sub-class of <ph id=\"ph1\">`com.microsoft.azure.engagement.reach.EngagementReachDataPushReceiver`</ph> and reference it in the <ph id=\"ph2\">`AndroidManifest.xml`</ph> file (between the <ph id=\"ph3\">`&lt;application&gt;`</ph> and/or <ph id=\"ph4\">`&lt;/application&gt;`</ph> tags):"
    },
    {
      "content": "Then you can override the <ph id=\"ph1\">`onDataPushStringReceived`</ph> and <ph id=\"ph2\">`onDataPushBase64Received`</ph> callbacks.",
      "pos": [
        8069,
        8163
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        8164,
        8183
      ]
    },
    {
      "content": "Category",
      "pos": [
        8963,
        8971
      ]
    },
    {
      "content": "The category parameter is optional when you create a Data Push campaign and allows you to filter data pushes.",
      "pos": [
        8973,
        9082
      ]
    },
    {
      "content": "This is useful if you have several broadcast receivers handling different types of data pushes, or if you want to push different kinds of <ph id=\"ph1\">`Base64`</ph> data and want to identify their type before parsing them.",
      "pos": [
        9083,
        9287
      ]
    },
    {
      "content": "Callbacks' return parameter",
      "pos": [
        9293,
        9320
      ]
    },
    {
      "pos": [
        9322,
        9448
      ],
      "content": "Here are some guidelines to properly handle the return parameter of <ph id=\"ph1\">`onDataPushStringReceived`</ph> and <ph id=\"ph2\">`onDataPushBase64Received`</ph>:"
    },
    {
      "content": "A broadcast receiver should return <ph id=\"ph1\">`null`</ph> in the callback if it does not know how to handle a data push.",
      "pos": [
        9454,
        9558
      ]
    },
    {
      "content": "You should use the category to determine whether your broadcast receiver should handle the data push or not.",
      "pos": [
        9559,
        9667
      ]
    },
    {
      "pos": [
        9672,
        9767
      ],
      "content": "One of the broadcast receiver should return <ph id=\"ph1\">`true`</ph> in the callback if it accepts the data push."
    },
    {
      "content": "One of the broadcast receiver should return <ph id=\"ph1\">`false`</ph> in the callback if it recognizes the data push, but discards it for whatever reason.",
      "pos": [
        9772,
        9908
      ]
    },
    {
      "content": "For example, return <ph id=\"ph1\">`false`</ph> when the received data is invalid.",
      "pos": [
        9909,
        9971
      ]
    },
    {
      "pos": [
        9976,
        10127
      ],
      "content": "If one broadcast receiver returns <ph id=\"ph1\">`true`</ph> while another one returns <ph id=\"ph2\">`false`</ph> for the same data push, the behavior is undefined, you should never do that."
    },
    {
      "content": "The return type is used only for the Reach statistics:",
      "pos": [
        10129,
        10183
      ]
    },
    {
      "pos": [
        10189,
        10282
      ],
      "content": "<ph id=\"ph1\">`Replied`</ph> is incremented if one of the broadcast receivers returned either <ph id=\"ph2\">`true`</ph> or <ph id=\"ph3\">`false`</ph>."
    },
    {
      "pos": [
        10287,
        10368
      ],
      "content": "<ph id=\"ph1\">`Actioned`</ph> is incremented only if one of the broadcast receivers returned <ph id=\"ph2\">`true`</ph>."
    },
    {
      "content": "How to customize campaigns",
      "pos": [
        10372,
        10398
      ]
    },
    {
      "content": "To customize campaigns, you can modify the layouts provided in the Reach SDK.",
      "pos": [
        10400,
        10477
      ]
    },
    {
      "content": "You should keep all the identifiers used in the layouts and keep the types of the views that use an identifier, especially for text views and image views.",
      "pos": [
        10479,
        10633
      ]
    },
    {
      "content": "Some views are just used to hide or show areas so their type may be changed.",
      "pos": [
        10634,
        10710
      ]
    },
    {
      "content": "Please check the source code if you intend to change the type of a view in the provided layouts.",
      "pos": [
        10711,
        10807
      ]
    },
    {
      "content": "Notifications",
      "pos": [
        10813,
        10826
      ]
    },
    {
      "content": "There are two types of notifications: system and in-app notifications which use different layout files.",
      "pos": [
        10828,
        10931
      ]
    },
    {
      "content": "System notifications",
      "pos": [
        10938,
        10958
      ]
    },
    {
      "content": "To customize system notifications you need to use the <bpt id=\"p1\">**</bpt>categories<ept id=\"p1\">**</ept>.",
      "pos": [
        10960,
        11029
      ]
    },
    {
      "content": "You can jump to <bpt id=\"p1\">[</bpt>Categories<ept id=\"p1\">](#categories)</ept>.",
      "pos": [
        11030,
        11072
      ]
    },
    {
      "content": "In-app notifications",
      "pos": [
        11079,
        11099
      ]
    },
    {
      "content": "By default, an in-app notification is a view that is dynamically added to the current activity user interface thanks to the Android method <ph id=\"ph1\">`addContentView()`</ph>.",
      "pos": [
        11101,
        11259
      ]
    },
    {
      "content": "This is called a notification overlay.",
      "pos": [
        11260,
        11298
      ]
    },
    {
      "content": "Notification overlays are great for a fast integration because they do not require you to modify any layout in your application.",
      "pos": [
        11299,
        11427
      ]
    },
    {
      "pos": [
        11429,
        11559
      ],
      "content": "To modify the look of your notification overlays, you can simply modify the file <ph id=\"ph1\">`engagement_notification_area.xml`</ph> to your needs."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The file <ph id=\"ph2\">`engagement_notification_overlay.xml`</ph> is the one that is used to create a notification overlay, it includes the file <ph id=\"ph3\">`engagement_notification_area.xml`</ph>.",
      "pos": [
        11563,
        11737
      ]
    },
    {
      "content": "You can also customize it to suit your needs (such as for positioning the notification area within the overlay).",
      "pos": [
        11738,
        11850
      ]
    },
    {
      "content": "Include notification layout as part of an activity layout",
      "pos": [
        11858,
        11915
      ]
    },
    {
      "content": "Overlays are great for a fast integration but can be inconvenient or have side effects in special cases.",
      "pos": [
        11917,
        12021
      ]
    },
    {
      "content": "The overlay system can be customized at an activity level, making it easy to prevent side effects for special activities.",
      "pos": [
        12022,
        12143
      ]
    },
    {
      "content": "You can decide to include our notification layout in your existing layout thanks to the Android <bpt id=\"p1\">**</bpt>include<ept id=\"p1\">**</ept> statement.",
      "pos": [
        12145,
        12263
      ]
    },
    {
      "content": "The following is an example of a modified <ph id=\"ph1\">`ListActivity`</ph> layout containing just a <ph id=\"ph2\">`ListView`</ph>.",
      "pos": [
        12264,
        12357
      ]
    },
    {
      "content": "Before Engagement integration :",
      "pos": [
        12361,
        12392
      ]
    },
    {
      "content": "After Engagement integration :",
      "pos": [
        12691,
        12721
      ]
    },
    {
      "content": "In this example we added a parent container since the original layout used a list view as the top level element.",
      "pos": [
        13378,
        13490
      ]
    },
    {
      "content": "We also added <ph id=\"ph1\">`android:layout_weight=\"1\"`</ph> to be able to add a view below a list view configured with <ph id=\"ph2\">`android:layout_height=\"fill_parent\"`</ph>.",
      "pos": [
        13491,
        13630
      ]
    },
    {
      "content": "The Engagement Reach SDK automatically detects that the notification layout is included in this activity and will not add an overlay for this activity.",
      "pos": [
        13632,
        13783
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.TIP]</ph> If you use a ListActivity in your application, a visible Reach overlay will prevent you from reacting to clicked items in the list view anymore.",
      "pos": [
        13787,
        13943
      ]
    },
    {
      "content": "This is a known issue.",
      "pos": [
        13944,
        13966
      ]
    },
    {
      "content": "To work around this problem we suggest you to embed the notification layout in your own list activity layout like in the previous sample.",
      "pos": [
        13967,
        14104
      ]
    },
    {
      "content": "Disabling application notification per activity",
      "pos": [
        14112,
        14159
      ]
    },
    {
      "pos": [
        14161,
        14427
      ],
      "content": "If you don't want the overlay to be added to your activity, and if you don't include the notification layout in your own layout, you can disable the overlay for this activity in the <ph id=\"ph1\">`AndroidManifest.xml`</ph> by adding a <ph id=\"ph2\">`meta-data`</ph> section like in the following example:"
    },
    {
      "pos": [
        14614,
        14650
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"categories\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Categories"
    },
    {
      "content": "When you modify the provided layouts, you modify the look of all your notifications.",
      "pos": [
        14652,
        14736
      ]
    },
    {
      "content": "Categories allow you to define various targeted looks (possibly behaviors) for notifications.",
      "pos": [
        14737,
        14830
      ]
    },
    {
      "content": "A category can be specified when you create a Reach campaign.",
      "pos": [
        14831,
        14892
      ]
    },
    {
      "content": "Keep in mind that categories also let you customize announcements and polls, that is described later in this document.",
      "pos": [
        14893,
        15011
      ]
    },
    {
      "content": "To register a category handler for your notifications, you need to add a call when the application is initialized.",
      "pos": [
        15013,
        15127
      ]
    },
    {
      "pos": [
        15131,
        15314
      ],
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> Please read the warning about the android:process attribute \\&lt;android-sdk-engagement-process\\&gt; in the How to Integrate Engagement on Android topic before proceeding."
    },
    {
      "pos": [
        15316,
        15431
      ],
      "content": "The following example assumes you acknowledged the previous warning and use a sub-class of <ph id=\"ph1\">`EngagementApplication`</ph>:"
    },
    {
      "content": "The <ph id=\"ph1\">`MyNotifier`</ph> object is the implementation of the notification category handler.",
      "pos": [
        15852,
        15935
      ]
    },
    {
      "content": "It is either an implementation of the <ph id=\"ph1\">`EngagementNotifier`</ph> interface or a sub class of the default implementation: <ph id=\"ph2\">`EngagementDefaultNotifier`</ph>.",
      "pos": [
        15936,
        16079
      ]
    },
    {
      "content": "Note that the same notifier can handle several categories, you can register them like this:",
      "pos": [
        16081,
        16172
      ]
    },
    {
      "content": "To replace the default category implementation, you can register your implementation like in the following example:",
      "pos": [
        16273,
        16388
      ]
    },
    {
      "pos": [
        16857,
        16985
      ],
      "content": "The current category used in a handler is passed as a parameter in most methods you can override in <ph id=\"ph1\">`EngagementDefaultNotifier`</ph>."
    },
    {
      "pos": [
        16987,
        17117
      ],
      "content": "It is passed either as a <ph id=\"ph1\">`String`</ph> parameter or indirectly in a <ph id=\"ph2\">`EngagementReachContent`</ph> object which has a <ph id=\"ph3\">`getCategory()`</ph> method."
    },
    {
      "pos": [
        17119,
        17341
      ],
      "content": "You can change most of the notification creation process by redefining methods on <ph id=\"ph1\">`EngagementDefaultNotifier`</ph>, for more advanced customization feel free to take a look at the technical documentation and at the source code."
    },
    {
      "content": "In-app notifications",
      "pos": [
        17349,
        17369
      ]
    },
    {
      "content": "If you just want to use alternate layouts for a specific category, you can implement this as in the following example:",
      "pos": [
        17371,
        17489
      ]
    },
    {
      "pos": [
        18285,
        18327
      ],
      "content": "Example of <ph id=\"ph1\">`my_notification_overlay.xml`</ph> :"
    },
    {
      "content": "As you can see, the overlay view identifier is different than the standard one.",
      "pos": [
        18760,
        18839
      ]
    },
    {
      "content": "It is important that each layout use a unique identifier for overlays.",
      "pos": [
        18840,
        18910
      ]
    },
    {
      "pos": [
        18914,
        18953
      ],
      "content": "Example of <ph id=\"ph1\">`my_notification_area.xml`</ph> :"
    },
    {
      "content": "As you can see, the notification area view identifier is different than the standard one.",
      "pos": [
        22369,
        22458
      ]
    },
    {
      "content": "It is important that each layout uses a unique identifier for notification areas.",
      "pos": [
        22459,
        22540
      ]
    },
    {
      "content": "This simple example of category makes application (or in-app) notifications displayed at the top of the screen.",
      "pos": [
        22542,
        22653
      ]
    },
    {
      "content": "We did not change the standard identifiers used in the notification area itself.",
      "pos": [
        22654,
        22734
      ]
    },
    {
      "content": "If you want to change that, you have to redefine the <ph id=\"ph1\">`EngagementDefaultNotifier.prepareInAppArea`</ph> method.",
      "pos": [
        22736,
        22841
      ]
    },
    {
      "content": "It's recommended to look at the technical documentation and at the source code of <ph id=\"ph1\">`EngagementNotifier`</ph> and <ph id=\"ph2\">`EngagementDefaultNotifier`</ph> if you want this level of advanced customization.",
      "pos": [
        22842,
        23026
      ]
    },
    {
      "content": "System notifications",
      "pos": [
        23034,
        23054
      ]
    },
    {
      "pos": [
        23056,
        23214
      ],
      "content": "By extending <ph id=\"ph1\">`EngagementDefaultNotifier`</ph>, you can override <ph id=\"ph2\">`onNotificationPrepared`</ph> to alter the notification that was prepared by the default implementation."
    },
    {
      "content": "For example:",
      "pos": [
        23216,
        23228
      ]
    },
    {
      "content": "This example makes a system notification for a content being displayed as an ongoing event when the \"ongoing\" category is used.",
      "pos": [
        23599,
        23726
      ]
    },
    {
      "content": "If you want to build the <ph id=\"ph1\">`Notification`</ph> object from scratch, you can return <ph id=\"ph2\">`false`</ph> to the method and call <ph id=\"ph3\">`notify`</ph> yourself on the <ph id=\"ph4\">`NotificationManager`</ph>.",
      "pos": [
        23728,
        23882
      ]
    },
    {
      "content": "In that case it's important that you keep a <ph id=\"ph1\">`contentIntent`</ph>, a <ph id=\"ph2\">`deleteIntent`</ph> and the notification identifier used by <ph id=\"ph3\">`EngagementReachReceiver`</ph>.",
      "pos": [
        23883,
        24027
      ]
    },
    {
      "content": "Here is a correct example of such an implementation:",
      "pos": [
        24029,
        24081
      ]
    },
    {
      "content": "Notification only announcements",
      "pos": [
        25421,
        25452
      ]
    },
    {
      "content": "The management of the click on a notification only announcement can be customized by overriding <ph id=\"ph1\">`EngagementDefaultNotifier.onNotifAnnouncementIntentPrepared`</ph> to modify the prepared <ph id=\"ph2\">`Intent`</ph>.",
      "pos": [
        25454,
        25644
      ]
    },
    {
      "content": "Using this method allows you to tune the flags easily.",
      "pos": [
        25645,
        25699
      ]
    },
    {
      "pos": [
        25701,
        25742
      ],
      "content": "For example to add the <ph id=\"ph1\">`SINGLE_TOP`</ph> flag:"
    },
    {
      "content": "For legacy Engagement users, please note that system notifications without action URL now launches the application if it was in background, so this method can be called with an announcement without action URL.",
      "pos": [
        26039,
        26248
      ]
    },
    {
      "content": "You should consider that when customizing the intent.",
      "pos": [
        26249,
        26302
      ]
    },
    {
      "pos": [
        26304,
        26392
      ],
      "content": "You can also implement <ph id=\"ph1\">`EngagementNotifier.executeNotifAnnouncementAction`</ph> from scratch."
    },
    {
      "content": "Notification life cycle",
      "pos": [
        26400,
        26423
      ]
    },
    {
      "pos": [
        26425,
        26594
      ],
      "content": "When using the default category, some life cycle methods are called on the <ph id=\"ph1\">`EngagementReachInteractiveContent`</ph> object to report statistics and update the campaign state:"
    },
    {
      "pos": [
        26600,
        26811
      ],
      "content": "When the notification is displayed in application or put in the status bar, the <ph id=\"ph1\">`displayNotification`</ph> method is called (which reports statistics) by <ph id=\"ph2\">`EngagementReachAgent`</ph> if <ph id=\"ph3\">`handleNotification`</ph> returns <ph id=\"ph4\">`true`</ph>."
    },
    {
      "pos": [
        26816,
        26953
      ],
      "content": "If the notification is dismissed, the <ph id=\"ph1\">`exitNotification`</ph> method is called, statistic is reported and next campaigns can now be processed."
    },
    {
      "pos": [
        26958,
        27082
      ],
      "content": "If the notification is clicked, <ph id=\"ph1\">`actionNotification`</ph> is called, statistic is reported and the associated intent is launched."
    },
    {
      "content": "If your implementation of <ph id=\"ph1\">`EngagementNotifier`</ph> bypasses the default behavior, you have to call these life cycle methods by yourself.",
      "pos": [
        27084,
        27216
      ]
    },
    {
      "content": "The following examples illustrate some cases where the default behavior is bypassed:",
      "pos": [
        27217,
        27301
      ]
    },
    {
      "pos": [
        27307,
        27405
      ],
      "content": "You don't extend <ph id=\"ph1\">`EngagementDefaultNotifier`</ph>, e.g. you implemented category handling from scratch."
    },
    {
      "pos": [
        27410,
        27558
      ],
      "content": "For system notifications, you overrode the <ph id=\"ph1\">`onNotificationPrepared`</ph> and you modified <ph id=\"ph2\">`contentIntent`</ph> or <ph id=\"ph3\">`deleteIntent`</ph> in the <ph id=\"ph4\">`Notification`</ph> object."
    },
    {
      "pos": [
        27563,
        27695
      ],
      "content": "For in-app notifications, you overrode <ph id=\"ph1\">`prepareInAppArea`</ph>, be sure to map at least <ph id=\"ph2\">`actionNotification`</ph> to one of your U.I controls."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If <ph id=\"ph2\">`handleNotification`</ph> throws an exception, the content is deleted and <ph id=\"ph3\">`dropContent`</ph> is called.",
      "pos": [
        27699,
        27808
      ]
    },
    {
      "content": "This is reported in statistics and next campaigns can now be processed.",
      "pos": [
        27809,
        27880
      ]
    },
    {
      "content": "Announcements and polls",
      "pos": [
        27886,
        27909
      ]
    },
    {
      "content": "Layouts",
      "pos": [
        27916,
        27923
      ]
    },
    {
      "pos": [
        27925,
        28107
      ],
      "content": "You can modify the <ph id=\"ph1\">`engagement_text_announcement.xml`</ph>, <ph id=\"ph2\">`engagement_web_announcement.xml`</ph> and <ph id=\"ph3\">`engagement_poll.xml`</ph> files to customize text announcements, web announcements and polls."
    },
    {
      "content": "These files share two common layouts for the title area and the button area.",
      "pos": [
        28109,
        28185
      ]
    },
    {
      "content": "The layout for the title is <ph id=\"ph1\">`engagement_content_title.xml`</ph> and uses the eponymous drawable file for the background.",
      "pos": [
        28186,
        28301
      ]
    },
    {
      "content": "The layout for the action and exit buttons is <ph id=\"ph1\">`engagement_button_bar.xml`</ph> and uses the eponymous drawable file for the background.",
      "pos": [
        28302,
        28432
      ]
    },
    {
      "pos": [
        28434,
        28641
      ],
      "content": "In a poll, the question layout and their choices are dynamically inflated using several times the <ph id=\"ph1\">`engagement_question.xml`</ph> layout file for the questions and the <ph id=\"ph2\">`engagement_choice.xml`</ph> file for the choices."
    },
    {
      "content": "Categories",
      "pos": [
        28648,
        28658
      ]
    },
    {
      "content": "Alternate layouts",
      "pos": [
        28666,
        28683
      ]
    },
    {
      "content": "Like notifications, the campaign's category can be used to have alternate layouts for your announcements and polls.",
      "pos": [
        28685,
        28800
      ]
    },
    {
      "pos": [
        28802,
        28961
      ],
      "content": "For example, to create a category for a text announcement, you can extend <ph id=\"ph1\">`EngagementTextAnnouncementActivity`</ph> and reference it the <ph id=\"ph2\">`AndroidManifest.xml`</ph> file:"
    },
    {
      "content": "Note that the category in the intent filter is used to make the difference with the default announcement activity.",
      "pos": [
        29347,
        29461
      ]
    },
    {
      "content": "The Reach SDK uses the intent system to resolve the right activity for a specific category and it falls back on the default category if the resolution failed.",
      "pos": [
        29463,
        29621
      ]
    },
    {
      "pos": [
        29623,
        29826
      ],
      "content": "Then you have to implement <ph id=\"ph1\">`MyCustomTextAnnouncementActivity`</ph>, if you just want to change the layout (but keep the same view identifiers), you just have to define the class like in the following example:"
    },
    {
      "pos": [
        30166,
        30357
      ],
      "content": "To replace the default category of text announcements, simply replace <ph id=\"ph1\">`android:name=\"com.microsoft.azure.engagement.reach.activity.EngagementTextAnnouncementActivity\"`</ph> by your implementation."
    },
    {
      "content": "Web announcements and polls can be customized in a similar fashion.",
      "pos": [
        30359,
        30426
      ]
    },
    {
      "pos": [
        30428,
        30586
      ],
      "content": "For web announcements you can extend <ph id=\"ph1\">`EngagementWebAnnouncementActivity`</ph> and declare your activity in the <ph id=\"ph2\">`AndroidManifest.xml`</ph> like in the following example:"
    },
    {
      "pos": [
        31058,
        31184
      ],
      "content": "For polls you can extend <ph id=\"ph1\">`EngagementPollActivity`</ph> and declare your in the <ph id=\"ph2\">`AndroidManifest.xml`</ph> like in the following example:"
    },
    {
      "content": "Implementation from scratch",
      "pos": [
        31513,
        31540
      ]
    },
    {
      "content": "You can implement categories for your announcement (and poll) activities without extending one of the <ph id=\"ph1\">`Engagement*Activity`</ph> classes provided by the Reach SDK.",
      "pos": [
        31542,
        31700
      ]
    },
    {
      "content": "This is useful for example if you want to define a layout that does not use the same views as the standard layouts.",
      "pos": [
        31701,
        31816
      ]
    },
    {
      "content": "Like for advanced notification customization, it is recommended to look at the source code of the standard implementation.",
      "pos": [
        31818,
        31940
      ]
    },
    {
      "content": "Here are some things to keep in mind: Reach will launch the activity with a specific intent (corresponding to the intent filter) plus an extra parameter which is the content identifier.",
      "pos": [
        31942,
        32127
      ]
    },
    {
      "content": "To retrieve the content object which contain the fields you specified when creating the campaign on the web site you can do this:",
      "pos": [
        32129,
        32258
      ]
    },
    {
      "pos": [
        33108,
        33191
      ],
      "content": "For statistics, you should report the content is displayed in the <ph id=\"ph1\">`onResume`</ph> event:"
    },
    {
      "pos": [
        33415,
        33557
      ],
      "content": "Then, don't forget to call either <ph id=\"ph1\">`actionContent(this)`</ph> or <ph id=\"ph2\">`exitContent(this)`</ph> on the content object before the activity goes into background."
    },
    {
      "pos": [
        33559,
        33784
      ],
      "content": "If you don't call either <ph id=\"ph1\">`actionContent`</ph> or <ph id=\"ph2\">`exitContent`</ph>, statistics won't be sent (i.e. no analytics on the campaign) and more importantly, the next campaigns will not be notified until the application process is restarted."
    },
    {
      "pos": [
        33786,
        34095
      ],
      "content": "Orientation or other configuration changes can make the code tricky to determine whether the activity goes into background or not, the standard implementation makes sure the content is reported as exited if the user leaves the activity (either by pressing <ph id=\"ph1\">`HOME`</ph> or <ph id=\"ph2\">`BACK`</ph>) but not if the orientation changes."
    },
    {
      "content": "Here is the interesting part of the implementation:",
      "pos": [
        34097,
        34148
      ]
    },
    {
      "pos": [
        34742,
        34889
      ],
      "content": "As you can see, if you called <ph id=\"ph1\">`actionContent(this)`</ph> then finished the activity, <ph id=\"ph2\">`exitContent(this)`</ph> can be safely called without having any effect."
    },
    {
      "content": "Test",
      "pos": [
        34893,
        34897
      ]
    },
    {
      "content": "Now please verify your integration by reading How to Test Engagement Integration on Android.",
      "pos": [
        34899,
        34991
      ]
    },
    {
      "content": "test",
      "pos": [
        35227,
        35231
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Azure Mobile Engagement Android SDK Integration\" \n    description=\"Latest updates and procedures for Android SDK for Azure Mobile Engagement\"\n    services=\"mobile-engagement\" \n    documentationCenter=\"mobile\" \n    authors=\"piyushjo\" \n    manager=\"dwrede\" \n    editor=\"\" />\n\n<tags \n    ms.service=\"mobile-engagement\" \n    ms.workload=\"mobile\" \n    ms.tgt_pltfrm=\"mobile-android\" \n    ms.devlang=\"Java\" \n    ms.topic=\"article\" \n    ms.date=\"08/10/2015\" \n    ms.author=\"piyushjo\" />\n\n#How to Integrate Engagement Reach on Android\n\n> [AZURE.IMPORTANT] You must follow the integration procedure described in the How to Integrate Engagement on Android document before following this guide.\n\n##Standard integration\n\nThe Reach SDK requires the **Android Support library (v4)**.\n\nThe fastest way to add the library to your project in **Eclipse** is `Right click on your project -> Android Tools -> Add Support Library...`.\n\nIf you don't use Eclipse, you can read the instructions [here].\n\nCopy Reach resource files from the SDK in your project :\n\n-   Copy the files from the `res/layout` folder delivered with the SDK into the `res/layout` folder of your application.\n-   Copy the files from the `res/drawable` folder delivered with the SDK into the `res/drawable` folder of your application.\n\nEdit your `AndroidManifest.xml` file:\n\n-   Add the following section (between the `<application>` and `</application>` tags):\n\n            <activity android:name=\"com.microsoft.azure.engagement.reach.activity.EngagementTextAnnouncementActivity\" android:theme=\"@android:style/Theme.Light\">\n              <intent-filter>\n                <action android:name=\"com.microsoft.azure.engagement.reach.intent.action.ANNOUNCEMENT\"/>\n                <category android:name=\"android.intent.category.DEFAULT\" />\n                <data android:mimeType=\"text/plain\" />\n              </intent-filter>\n            </activity>\n            <activity android:name=\"com.microsoft.azure.engagement.reach.activity.EngagementWebAnnouncementActivity\" android:theme=\"@android:style/Theme.Light\">\n              <intent-filter>\n                <action android:name=\"com.microsoft.azure.engagement.reach.intent.action.ANNOUNCEMENT\"/>\n                <category android:name=\"android.intent.category.DEFAULT\" />\n                <data android:mimeType=\"text/html\" />\n              </intent-filter>\n            </activity>\n            <activity android:name=\"com.microsoft.azure.engagement.reach.activity.EngagementPollActivity\" android:theme=\"@android:style/Theme.Light\">\n              <intent-filter>\n                <action android:name=\"com.microsoft.azure.engagement.reach.intent.action.POLL\"/>\n                <category android:name=\"android.intent.category.DEFAULT\" />\n              </intent-filter>\n            </activity>\n            <activity android:name=\"com.microsoft.azure.engagement.reach.activity.EngagementLoadingActivity\" android:theme=\"@android:style/Theme.Dialog\">\n              <intent-filter>\n                <action android:name=\"com.microsoft.azure.engagement.reach.intent.action.LOADING\"/>\n                <category android:name=\"android.intent.category.DEFAULT\"/>\n              </intent-filter>\n            </activity>\n            <receiver android:name=\"com.microsoft.azure.engagement.reach.EngagementReachReceiver\" android:exported=\"false\">\n              <intent-filter>\n                <action android:name=\"android.intent.action.BOOT_COMPLETED\"/>\n                <action android:name=\"com.microsoft.azure.engagement.intent.action.AGENT_CREATED\"/>\n                <action android:name=\"com.microsoft.azure.engagement.intent.action.MESSAGE\"/>\n                <action android:name=\"com.microsoft.azure.engagement.reach.intent.action.ACTION_NOTIFICATION\"/>\n                <action android:name=\"com.microsoft.azure.engagement.reach.intent.action.EXIT_NOTIFICATION\"/>\n                <action android:name=\"com.microsoft.azure.engagement.reach.intent.action.DOWNLOAD_TIMEOUT\"/>\n              </intent-filter>\n            </receiver>\n            <receiver android:name=\"com.microsoft.azure.engagement.reach.EngagementReachDownloadReceiver\">\n              <intent-filter>\n                <action android:name=\"android.intent.action.DOWNLOAD_COMPLETE\"/>\n              </intent-filter>\n            </receiver>\n\n-   You need this permission to replay system notifications that were not clicked at boot (otherwise they will be kept on disk but won't be displayed anymore, you really have to include this).\n\n            <uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\" />\n\n-   Specify an icon used for notifications (both in app and system ones) by copying and editing the following section (between the `<application>` and `</application>` tags):\n\n            <meta-data android:name=\"engagement:reach:notification:icon\" android:value=\"<name_of_icon_WITHOUT_file_extension_and_WITHOUT_'@drawable/'>\" />\n\n> [AZURE.IMPORTANT] This section is **mandatory** if you plan on using system notifications when creating Reach campaigns. Android prevents system notifications without icons from being shown. So if you omit this section, your end users will not be able to receive them.\n\n-   If you create campaigns with system notifications using big picture, you need to add the following permissions (after the `</application>` tag) if missing:\n\n            <uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\"/>\n            <uses-permission android:name=\"android.permission.DOWNLOAD_WITHOUT_NOTIFICATION\"/>\n\n  -   On Android M and if your application targets Android API level 23 or greater, ``WRITE_EXTERNAL_STORAGE`` permission requires user approval. Please read [this section](mobile-engagement-android-integrate-engagement.md#android-m-permissions).\n\n-   For system notifications you can also specify in the Reach campaign if the device should ring and/or vibrate. For it to work, you have to make sure you declared the following permission (after the `</application>` tag):\n\n            <uses-permission android:name=\"android.permission.VIBRATE\" />\n\n    Without this permission, Android prevents system notifications from being shown if you checked the ring or the vibrate option in the Reach Campaign manager.\n\n-   If you build your application using **ProGuard** and have errors related to the Android Support library or the Engagement jar, add the following lines to your `proguard.cfg` file:\n\n            -dontwarn android.**\n            -keep class android.support.v4.** { *; }\n\n## Native Push\n\nNow that you configured Reach module, you need to configure native push to be able to receive the campaigns on the device.\n\nWe support two services on Android:\n\n  - Google Play devices: Use [Google Cloud Messaging] by following the [How to Integrate GCM with Engagement guide](mobile-engagement-android-gcm-integrate.md) guide.\n  - Amazon devices: Use [Amazon Device Messaging] by following the [How to Integrate ADM with Engagement guide](mobile-engagement-android-adm-integrate.md) guide.\n\nIf you want to target both Amazon and Google Play devices, its possible to have everything inside 1 AndroidManifest.xml/APK for development. But when submitting to Amazon, they may reject your application if they find GCM code.\n\nYou should use multiple APKs in that case.\n\n**Your application is now ready to receive and display reach campaigns!**\n\n##How to handle data push\n\n### Integration\n\nIf you want your application to be able to receive Reach data pushes, you have to create a sub-class of `com.microsoft.azure.engagement.reach.EngagementReachDataPushReceiver` and reference it in the `AndroidManifest.xml` file (between the `<application>` and/or `</application>` tags):\n\n            <receiver android:name=\"<your_sub_class_of_com.microsoft.azure.engagement.reach.EngagementReachDataPushReceiver>\"\n              android:exported=\"false\">\n              <intent-filter>\n                <action android:name=\"com.microsoft.azure.engagement.reach.intent.action.DATA_PUSH\" />\n              </intent-filter>\n            </receiver>\n\nThen you can override the `onDataPushStringReceived` and `onDataPushBase64Received` callbacks. Here is an example:\n\n            public class MyDataPushReceiver extends EngagementReachDataPushReceiver\n            {\n              @Override\n              protected Boolean onDataPushStringReceived(Context context, String category, String body)\n              {\n                Log.d(\"tmp\", \"String data push message received: \" + body);\n                return true;\n              }\n            \n              @Override\n              protected Boolean onDataPushBase64Received(Context context, String category, byte[] decodedBody, String encodedBody)\n              {\n                Log.d(\"tmp\", \"Base64 data push message received: \" + encodedBody);\n                // Do something useful with decodedBody like updating an image view\n                return true;\n              }\n            }\n\n### Category\n\nThe category parameter is optional when you create a Data Push campaign and allows you to filter data pushes. This is useful if you have several broadcast receivers handling different types of data pushes, or if you want to push different kinds of `Base64` data and want to identify their type before parsing them.\n\n### Callbacks' return parameter\n\nHere are some guidelines to properly handle the return parameter of `onDataPushStringReceived` and `onDataPushBase64Received`:\n\n-   A broadcast receiver should return `null` in the callback if it does not know how to handle a data push. You should use the category to determine whether your broadcast receiver should handle the data push or not.\n-   One of the broadcast receiver should return `true` in the callback if it accepts the data push.\n-   One of the broadcast receiver should return `false` in the callback if it recognizes the data push, but discards it for whatever reason. For example, return `false` when the received data is invalid.\n-   If one broadcast receiver returns `true` while another one returns `false` for the same data push, the behavior is undefined, you should never do that.\n\nThe return type is used only for the Reach statistics:\n\n-   `Replied` is incremented if one of the broadcast receivers returned either `true` or `false`.\n-   `Actioned` is incremented only if one of the broadcast receivers returned `true`.\n\n##How to customize campaigns\n\nTo customize campaigns, you can modify the layouts provided in the Reach SDK.\n\nYou should keep all the identifiers used in the layouts and keep the types of the views that use an identifier, especially for text views and image views. Some views are just used to hide or show areas so their type may be changed. Please check the source code if you intend to change the type of a view in the provided layouts.\n\n### Notifications\n\nThere are two types of notifications: system and in-app notifications which use different layout files.\n\n#### System notifications\n\nTo customize system notifications you need to use the **categories**. You can jump to [Categories](#categories).\n\n#### In-app notifications\n\nBy default, an in-app notification is a view that is dynamically added to the current activity user interface thanks to the Android method `addContentView()`. This is called a notification overlay. Notification overlays are great for a fast integration because they do not require you to modify any layout in your application.\n\nTo modify the look of your notification overlays, you can simply modify the file `engagement_notification_area.xml` to your needs.\n\n> [AZURE.NOTE] The file `engagement_notification_overlay.xml` is the one that is used to create a notification overlay, it includes the file `engagement_notification_area.xml`. You can also customize it to suit your needs (such as for positioning the notification area within the overlay).\n\n##### Include notification layout as part of an activity layout\n\nOverlays are great for a fast integration but can be inconvenient or have side effects in special cases. The overlay system can be customized at an activity level, making it easy to prevent side effects for special activities.\n\nYou can decide to include our notification layout in your existing layout thanks to the Android **include** statement. The following is an example of a modified `ListActivity` layout containing just a `ListView`.\n\n**Before Engagement integration :**\n\n            <?xml version=\"1.0\" encoding=\"utf-8\"?>\n            <ListView\n              xmlns:android=\"http://schemas.android.com/apk/res/android\"\n              android:id=\"@android:id/list\"\n              android:layout_width=\"fill_parent\"\n              android:layout_height=\"fill_parent\" />\n\n**After Engagement integration :**\n\n            <?xml version=\"1.0\" encoding=\"utf-8\"?>\n            <LinearLayout\n              xmlns:android=\"http://schemas.android.com/apk/res/android\"\n              android:orientation=\"vertical\"\n              android:layout_width=\"fill_parent\"\n              android:layout_height=\"fill_parent\">\n            \n              <ListView\n                android:id=\"@android:id/list\"\n                android:layout_width=\"fill_parent\"\n                android:layout_height=\"fill_parent\"\n                android:layout_weight=\"1\" />\n            \n              <include layout=\"@layout/engagement_notification_area\" />\n            \n            </LinearLayout>\n\nIn this example we added a parent container since the original layout used a list view as the top level element. We also added `android:layout_weight=\"1\"` to be able to add a view below a list view configured with `android:layout_height=\"fill_parent\"`.\n\nThe Engagement Reach SDK automatically detects that the notification layout is included in this activity and will not add an overlay for this activity.\n\n> [AZURE.TIP] If you use a ListActivity in your application, a visible Reach overlay will prevent you from reacting to clicked items in the list view anymore. This is a known issue. To work around this problem we suggest you to embed the notification layout in your own list activity layout like in the previous sample.\n\n##### Disabling application notification per activity\n\nIf you don't want the overlay to be added to your activity, and if you don't include the notification layout in your own layout, you can disable the overlay for this activity in the `AndroidManifest.xml` by adding a `meta-data` section like in the following example:\n\n            <activity android:name=\"SplashScreenActivity\">\n              <meta-data android:name=\"engagement:notification:overlay\" android:value=\"false\"/>\n            </activity>\n\n#### <a name=\"categories\"></a> Categories\n\nWhen you modify the provided layouts, you modify the look of all your notifications. Categories allow you to define various targeted looks (possibly behaviors) for notifications. A category can be specified when you create a Reach campaign. Keep in mind that categories also let you customize announcements and polls, that is described later in this document.\n\nTo register a category handler for your notifications, you need to add a call when the application is initialized.\n\n> [AZURE.IMPORTANT] Please read the warning about the android:process attribute \\<android-sdk-engagement-process\\> in the How to Integrate Engagement on Android topic before proceeding.\n\nThe following example assumes you acknowledged the previous warning and use a sub-class of `EngagementApplication`:\n\n            public class MyApplication extends EngagementApplication\n            {\n              @Override\n              protected void onApplicationProcessCreate()\n              {\n                // [...] other init\n                EngagementReachAgent reachAgent = EngagementReachAgent.getInstance(this);\n                reachAgent.registerNotifier(new MyNotifier(this), \"myCategory\");\n              }\n            }\n\nThe `MyNotifier` object is the implementation of the notification category handler. It is either an implementation of the `EngagementNotifier` interface or a sub class of the default implementation: `EngagementDefaultNotifier`.\n\nNote that the same notifier can handle several categories, you can register them like this:\n\n            reachAgent.registerNotifier(new MyNotifier(this), \"myCategory\", \"myAnotherCategory\");\n\nTo replace the default category implementation, you can register your implementation like in the following example:\n\n            public class MyApplication extends EngagementApplication\n            {\n              @Override\n              protected void onApplicationProcessCreate()\n              {\n                // [...] other init\n                EngagementReachAgent reachAgent = EngagementReachAgent.getInstance(this);\n                reachAgent.registerNotifier(new MyNotifier(this), Intent.CATEGORY_DEFAULT); // \"android.intent.category.DEFAULT\"\n              }\n            }\n\nThe current category used in a handler is passed as a parameter in most methods you can override in `EngagementDefaultNotifier`.\n\nIt is passed either as a `String` parameter or indirectly in a `EngagementReachContent` object which has a `getCategory()` method.\n\nYou can change most of the notification creation process by redefining methods on `EngagementDefaultNotifier`, for more advanced customization feel free to take a look at the technical documentation and at the source code.\n\n##### In-app notifications\n\nIf you just want to use alternate layouts for a specific category, you can implement this as in the following example:\n            \n            public class MyNotifier extends EngagementDefaultNotifier\n            {\n              public MyNotifier(Context context)\n              {\n                super(context);\n              }\n            \n              @Override\n              protected int getOverlayLayoutId(String category)\n              {\n                return R.layout.my_notification_overlay;\n              }\n            \n            \n              @Override\n              public Integer getOverlayViewId(String category)\n              {\n                return R.id.my_notification_overlay;\n              }\n            \n              @Override\n              public Integer getInAppAreaId(String category)\n              {\n                return R.id.my_notification_area;\n              }\n            }\n\n**Example of `my_notification_overlay.xml` :**\n\n            <?xml version=\"1.0\" encoding=\"utf-8\"?>\n            <RelativeLayout\n              xmlns:android=\"http://schemas.android.com/apk/res/android\"\n              android:id=\"@+id/my_notification_overlay\"\n              android:layout_width=\"fill_parent\"\n              android:layout_height=\"fill_parent\">\n            \n              <include layout=\"@layout/my_notification_area\" />\n            \n            </RelativeLayout>\n\nAs you can see, the overlay view identifier is different than the standard one. It is important that each layout use a unique identifier for overlays.\n\n**Example of `my_notification_area.xml` :**\n\n            <?xml version=\"1.0\" encoding=\"utf-8\"?>\n            <merge\n              xmlns:android=\"http://schemas.android.com/apk/res/android\"\n              android:layout_width=\"fill_parent\"\n              android:layout_height=\"fill_parent\">\n            \n              <RelativeLayout\n                android:id=\"@+id/my_notification_area\"\n                android:layout_width=\"fill_parent\"\n                android:layout_height=\"64dp\"\n                android:layout_alignParentTop=\"true\"\n                android:background=\"#B000\">\n            \n                <LinearLayout\n                  android:orientation=\"horizontal\"\n                  android:layout_width=\"fill_parent\"\n                  android:layout_height=\"fill_parent\"\n                  android:gravity=\"center_vertical\">\n            \n                  <ImageView\n                    android:id=\"@+id/engagement_notification_icon\"\n                    android:layout_width=\"48dp\"\n                    android:layout_height=\"48dp\" />\n            \n                  <LinearLayout\n                    android:id=\"@+id/engagement_notification_text\"\n                    android:orientation=\"vertical\"\n                    android:layout_width=\"fill_parent\"\n                    android:layout_height=\"fill_parent\"\n                    android:layout_weight=\"1\"\n                    android:gravity=\"center_vertical\">\n            \n                    <TextView\n                      android:id=\"@+id/engagement_notification_title\"\n                      android:layout_width=\"fill_parent\"\n                      android:layout_height=\"wrap_content\"\n                      android:singleLine=\"true\"\n                      android:ellipsize=\"end\"\n                      android:textAppearance=\"@android:style/TextAppearance.Medium\" />\n            \n                    <TextView\n                      android:id=\"@+id/engagement_notification_message\"\n                      android:layout_width=\"fill_parent\"\n                      android:layout_height=\"wrap_content\"\n                      android:maxLines=\"2\"\n                      android:ellipsize=\"end\"\n                      android:textAppearance=\"@android:style/TextAppearance.Small\" />\n            \n                  </LinearLayout>\n            \n                  <ImageView\n                    android:id=\"@+id/engagement_notification_image\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"fill_parent\"\n                    android:adjustViewBounds=\"true\" />\n            \n                  <ImageButton\n                    android:id=\"@+id/engagement_notification_close_area\"\n                    android:visibility=\"invisible\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"fill_parent\"\n                    android:src=\"@android:drawable/btn_dialog\"\n                    android:background=\"#0F00\" />\n            \n                </LinearLayout>\n            \n                <ImageButton\n                  android:id=\"@+id/engagement_notification_close\"\n                  android:layout_width=\"wrap_content\"\n                  android:layout_height=\"fill_parent\"\n                  android:layout_alignParentRight=\"true\"\n                  android:src=\"@android:drawable/btn_dialog\"\n                  android:background=\"#0F00\" />\n            \n              </RelativeLayout>\n            \n            </merge>\n\nAs you can see, the notification area view identifier is different than the standard one. It is important that each layout uses a unique identifier for notification areas.\n\nThis simple example of category makes application (or in-app) notifications displayed at the top of the screen. We did not change the standard identifiers used in the notification area itself.\n\nIf you want to change that, you have to redefine the `EngagementDefaultNotifier.prepareInAppArea` method. It's recommended to look at the technical documentation and at the source code of `EngagementNotifier` and `EngagementDefaultNotifier` if you want this level of advanced customization.\n\n##### System notifications\n\nBy extending `EngagementDefaultNotifier`, you can override `onNotificationPrepared` to alter the notification that was prepared by the default implementation.\n\nFor example:\n\n            @Override\n            protected boolean onNotificationPrepared(Notification notification, EngagementReachInteractiveContent content)\n              throws RuntimeException\n            {\n              if (\"ongoing\".equals(content.getCategory()))\n                notification.flags |= Notification.FLAG_ONGOING_EVENT;\n              return true;\n            }\n\nThis example makes a system notification for a content being displayed as an ongoing event when the \"ongoing\" category is used.\n\nIf you want to build the `Notification` object from scratch, you can return `false` to the method and call `notify` yourself on the `NotificationManager`. In that case it's important that you keep a `contentIntent`, a `deleteIntent` and the notification identifier used by `EngagementReachReceiver`.\n\nHere is a correct example of such an implementation:\n\n            @Override\n            protected boolean onNotificationPrepared(Notification notification, EngagementReachInteractiveContent content) throws RuntimeException\n            {\n              /* Required fields */\n              NotificationCompat.Builder builder = new NotificationCompat.Builder(mContext)\n                .setSmallIcon(notification.icon)              // icon is mandatory\n                .setContentIntent(notification.contentIntent) // keep content intent\n                .setDeleteIntent(notification.deleteIntent);  // keep delete intent\n            \n              /* Your customization */\n              // builder.set...\n            \n              /* Dismiss option can be managed only after build */\n              Notification myNotification = builder.build();\n              if (!content.isNotificationCloseable())\n                myNotification.flags |= Notification.FLAG_NO_CLEAR;\n            \n              /* Notify here instead of super class */\n              NotificationManager manager = (NotificationManager) mContext.getSystemService(Context.NOTIFICATION_SERVICE);\n              manager.notify(getNotificationId(content), myNotification); // notice the call to get the right identifier\n            \n              /* Return false, we notify ourselves */\n              return false;\n            }\n\n##### Notification only announcements\n\nThe management of the click on a notification only announcement can be customized by overriding `EngagementDefaultNotifier.onNotifAnnouncementIntentPrepared` to modify the prepared `Intent`. Using this method allows you to tune the flags easily.\n\nFor example to add the `SINGLE_TOP` flag:\n            \n            @Override\n            protected Intent onNotifAnnouncementIntentPrepared(EngagementNotifAnnouncement notifAnnouncement,\n              Intent intent)\n            {\n              intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);\n              return intent;\n            }\n\nFor legacy Engagement users, please note that system notifications without action URL now launches the application if it was in background, so this method can be called with an announcement without action URL. You should consider that when customizing the intent.\n\nYou can also implement `EngagementNotifier.executeNotifAnnouncementAction` from scratch.\n\n##### Notification life cycle\n\nWhen using the default category, some life cycle methods are called on the `EngagementReachInteractiveContent` object to report statistics and update the campaign state:\n\n-   When the notification is displayed in application or put in the status bar, the `displayNotification` method is called (which reports statistics) by `EngagementReachAgent` if `handleNotification` returns `true`.\n-   If the notification is dismissed, the `exitNotification` method is called, statistic is reported and next campaigns can now be processed.\n-   If the notification is clicked, `actionNotification` is called, statistic is reported and the associated intent is launched.\n\nIf your implementation of `EngagementNotifier` bypasses the default behavior, you have to call these life cycle methods by yourself. The following examples illustrate some cases where the default behavior is bypassed:\n\n-   You don't extend `EngagementDefaultNotifier`, e.g. you implemented category handling from scratch.\n-   For system notifications, you overrode the `onNotificationPrepared` and you modified `contentIntent` or `deleteIntent` in the `Notification` object.\n-   For in-app notifications, you overrode `prepareInAppArea`, be sure to map at least `actionNotification` to one of your U.I controls.\n\n> [AZURE.NOTE] If `handleNotification` throws an exception, the content is deleted and `dropContent` is called. This is reported in statistics and next campaigns can now be processed.\n\n### Announcements and polls\n\n#### Layouts\n\nYou can modify the `engagement_text_announcement.xml`, `engagement_web_announcement.xml` and `engagement_poll.xml` files to customize text announcements, web announcements and polls.\n\nThese files share two common layouts for the title area and the button area. The layout for the title is `engagement_content_title.xml` and uses the eponymous drawable file for the background. The layout for the action and exit buttons is `engagement_button_bar.xml` and uses the eponymous drawable file for the background.\n\nIn a poll, the question layout and their choices are dynamically inflated using several times the `engagement_question.xml` layout file for the questions and the `engagement_choice.xml` file for the choices.\n\n#### Categories\n\n##### Alternate layouts\n\nLike notifications, the campaign's category can be used to have alternate layouts for your announcements and polls.\n\nFor example, to create a category for a text announcement, you can extend `EngagementTextAnnouncementActivity` and reference it the `AndroidManifest.xml` file:\n\n            <activity android:name=\"com.your_company.MyCustomTextAnnouncementActivity\">\n              <intent-filter>\n                <action android:name=\"com.microsoft.azure.engagement.intent.action.ANNOUNCEMENT\"/>\n                <category android:name=\"my_category\" />\n                <data android:mimeType=\"text/plain\" />\n              </intent-filter>\n            </activity>\n\nNote that the category in the intent filter is used to make the difference with the default announcement activity.\n\nThe Reach SDK uses the intent system to resolve the right activity for a specific category and it falls back on the default category if the resolution failed.\n\nThen you have to implement `MyCustomTextAnnouncementActivity`, if you just want to change the layout (but keep the same view identifiers), you just have to define the class like in the following example:\n\n            public class MyCustomTextAnnouncementActivity extends EngagementTextAnnouncementActivity\n            {\n              @Override\n              protected String getLayoutName()\n              {\n                return \"my_text_announcement\";  // tell super class to use R.layout.my_text_announcement\n              }\n            }\n\nTo replace the default category of text announcements, simply replace `android:name=\"com.microsoft.azure.engagement.reach.activity.EngagementTextAnnouncementActivity\"` by your implementation.\n\nWeb announcements and polls can be customized in a similar fashion.\n\nFor web announcements you can extend `EngagementWebAnnouncementActivity` and declare your activity in the `AndroidManifest.xml` like in the following example:\n\n            <activity android:name=\"com.your_company.MyCustomWebAnnouncementActivity\">\n              <intent-filter>\n                <action android:name=\"com.microsoft.azure.engagement.intent.action.ANNOUNCEMENT\"/>\n                <category android:name=\"my_category\" />\n                <data android:mimeType=\"text/html\" />    <!-- only difference with text announcements in the intent is the data mime type -->\n              </intent-filter>\n            </activity>\n\nFor polls you can extend `EngagementPollActivity` and declare your in the `AndroidManifest.xml` like in the following example:\n\n            <activity android:name=\"com.your_company.MyCustomPollActivity\">\n              <intent-filter>\n                <action android:name=\"com.microsoft.azure.engagement.intent.action.POLL\"/>\n                <category android:name=\"my_category\" />\n              </intent-filter>\n            </activity>\n            \n##### Implementation from scratch\n\nYou can implement categories for your announcement (and poll) activities without extending one of the `Engagement*Activity` classes provided by the Reach SDK. This is useful for example if you want to define a layout that does not use the same views as the standard layouts.\n\nLike for advanced notification customization, it is recommended to look at the source code of the standard implementation.\n\nHere are some things to keep in mind: Reach will launch the activity with a specific intent (corresponding to the intent filter) plus an extra parameter which is the content identifier.\n\nTo retrieve the content object which contain the fields you specified when creating the campaign on the web site you can do this:\n\n            public class MyCustomTextAnnouncement extends EngagementActivity\n            {\n              private EngagementAnnouncement mContent;\n            \n              @Override\n              protected void onCreate(Bundle savedInstanceState)\n              {\n                super.onCreate(savedInstanceState);\n            \n                /* Get content */\n                mContent = EngagementReachAgent.getInstance(this).getContent(getIntent());\n                if (mContent == null)\n                {\n                  /* If problem with content, exit */\n                  finish();\n                  return;\n                }\n            \n                setContentView(R.layout.my_text_announcement);\n            \n                /* Configure views by querying fields on mContent */\n                // ...\n              }\n            }\n\nFor statistics, you should report the content is displayed in the `onResume` event:\n            \n            @Override\n            protected void onResume()\n            {\n             /* Mark the content displayed */\n             mContent.displayContent(this);\n             super.onResume();\n            }\n\nThen, don't forget to call either `actionContent(this)` or `exitContent(this)` on the content object before the activity goes into background.\n\nIf you don't call either `actionContent` or `exitContent`, statistics won't be sent (i.e. no analytics on the campaign) and more importantly, the next campaigns will not be notified until the application process is restarted.\n\nOrientation or other configuration changes can make the code tricky to determine whether the activity goes into background or not, the standard implementation makes sure the content is reported as exited if the user leaves the activity (either by pressing `HOME` or `BACK`) but not if the orientation changes.\n\nHere is the interesting part of the implementation:\n\n            @Override\n            protected void onUserLeaveHint()\n            {\n              finish();\n            }\n            \n            @Override\n            protected void onPause()\n            {\n              if (isFinishing() && mContent != null)\n              {\n                /*\n                 * Exit content on exit, this is has no effect if another process method has already been\n                 * called so we don't have to check anything here.\n                 */\n                mContent.exitContent(this);\n              }\n              super.onPause();\n            }\n\nAs you can see, if you called `actionContent(this)` then finished the activity, `exitContent(this)` can be safely called without having any effect.\n\n##Test\n\nNow please verify your integration by reading How to Test Engagement Integration on Android.\n\n[here]:http://developer.android.com/tools/extras/support-library.html#Downloading\n[Google Cloud Messaging]:http://developer.android.com/guide/google/gcm/index.html\n[Amazon Device Messaging]:https://developer.amazon.com/sdk/adm.html\n \ntest\n"
}