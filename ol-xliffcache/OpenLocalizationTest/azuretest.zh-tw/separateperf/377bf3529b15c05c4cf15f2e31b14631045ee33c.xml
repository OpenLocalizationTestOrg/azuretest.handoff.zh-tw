{
  "nodes": [
    {
      "content": "Get started with SQL database auditing | Microsoft Azure",
      "pos": [
        28,
        84
      ]
    },
    {
      "content": "Get started with SQL database auditing",
      "pos": [
        104,
        142
      ]
    },
    {
      "content": "Get started with SQL database auditing",
      "pos": [
        466,
        504
      ]
    },
    {
      "content": "Azure SQL Database Auditing tracks database events and writes audited events to an audit log in your Azure Storage account.",
      "pos": [
        510,
        633
      ]
    },
    {
      "content": "Auditing is generally available for Basic, Standard, and Premium service tiers.",
      "pos": [
        634,
        713
      ]
    },
    {
      "content": "Auditing can help you maintain regulatory compliance, understand  database activity, and gain insight into discrepancies and anomalies that could indicate business concerns or suspected security violations.",
      "pos": [
        715,
        921
      ]
    },
    {
      "content": "Auditing tools enable and facilitate adherence to compliance standards but don't guarantee compliance.",
      "pos": [
        924,
        1026
      ]
    },
    {
      "content": "For more information about Azure programs that support standards compliance, see the <ph id=\"ph1\">&lt;a href=\"http://azure.microsoft.com/support/trust-center/compliance/\" target=\"_blank\"&gt;</ph>Azure Trust Center<ph id=\"ph2\">&lt;/a&gt;</ph>.",
      "pos": [
        1027,
        1221
      ]
    },
    {
      "content": "[Azure SQL Database Auditing basics]",
      "pos": [
        1225,
        1261
      ]
    },
    {
      "content": "[Set up auditing for your database]",
      "pos": [
        1265,
        1300
      ]
    },
    {
      "content": "[Analyze audit logs and reports]",
      "pos": [
        1303,
        1335
      ]
    },
    {
      "pos": [
        1339,
        1398
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"subheading-1\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Azure SQL Database Auditing basics"
    },
    {
      "content": "The following sections describe the configuration of Auditing using the Azure Preview Portal.",
      "pos": [
        1400,
        1493
      ]
    },
    {
      "content": "You may also [Set up auditing for your database using the Classic Azure Portal].",
      "pos": [
        1494,
        1574
      ]
    },
    {
      "content": "SQL Database auditing allows you to:",
      "pos": [
        1576,
        1612
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Retain<ept id=\"p1\">**</ept> an audit trail of selected events.",
      "pos": [
        1616,
        1661
      ]
    },
    {
      "content": "You can define categories of database actions  to be audited.",
      "pos": [
        1662,
        1723
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Report<ept id=\"p1\">**</ept> on database activity.",
      "pos": [
        1726,
        1758
      ]
    },
    {
      "content": "You can use preconfigured reports and a dashboard to get started quickly with activity and event reporting.",
      "pos": [
        1759,
        1866
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Analyze<ept id=\"p1\">**</ept> reports.",
      "pos": [
        1869,
        1889
      ]
    },
    {
      "content": "You can find suspicious events, unusual activity, and trends.",
      "pos": [
        1890,
        1951
      ]
    },
    {
      "content": "You can configure auditing for the following event categories:",
      "pos": [
        1953,
        2015
      ]
    },
    {
      "pos": [
        2017,
        2109
      ],
      "content": "<bpt id=\"p1\">**</bpt>Plain SQL<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Parameterized SQL<ept id=\"p2\">**</ept> for which the collected audit logs are classified as"
    },
    {
      "content": "Access to data",
      "pos": [
        2117,
        2131
      ]
    },
    {
      "content": "Schema changes (DDL)",
      "pos": [
        2138,
        2158
      ]
    },
    {
      "content": "Data changes (DML)",
      "pos": [
        2165,
        2183
      ]
    },
    {
      "content": "Accounts, roles, and permissions (DCL)",
      "pos": [
        2190,
        2228
      ]
    },
    {
      "pos": [
        2232,
        2296
      ],
      "content": "<bpt id=\"p1\">**</bpt>Stored Procedure<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Login<ept id=\"p2\">**</ept> and, <bpt id=\"p3\">**</bpt>Transaction Management<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        2298,
        2400
      ],
      "content": "For each Event Category, Auditing of <bpt id=\"p1\">**</bpt>Success<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Failure<ept id=\"p2\">**</ept> operations are configured separately."
    },
    {
      "pos": [
        2402,
        2594
      ],
      "content": "For further details about the activities and events audited, see the <ph id=\"ph1\">&lt;a href=\"http://go.microsoft.com/fwlink/?LinkId=506733\" target=\"_blank\"&gt;</ph>Audit Log Format Reference (doc file download)<ph id=\"ph2\">&lt;/a&gt;</ph>."
    },
    {
      "content": "Audit logs are stored in your Azure storage account.",
      "pos": [
        2597,
        2649
      ]
    },
    {
      "content": "You can define an audit log retention period.",
      "pos": [
        2650,
        2695
      ]
    },
    {
      "content": "An auditing policy can be defined for a specific database or as a default server policy.",
      "pos": [
        2697,
        2785
      ]
    },
    {
      "content": "A default server auditing policy will apply to all databases on a server which do not have a specific overriding database auditing policy defined.",
      "pos": [
        2786,
        2932
      ]
    },
    {
      "pos": [
        2934,
        3082
      ],
      "content": "Before setting up audit auditing check if you are using a <bpt id=\"p1\">[</bpt>\"Downlevel Client\"<ept id=\"p1\">](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md)</ept>."
    },
    {
      "pos": [
        3087,
        3145
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"subheading-2\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Set up auditing for your database"
    },
    {
      "content": "Launch the <ph id=\"ph1\">&lt;a href=\"https://portal.azure.com\" target=\"_blank\"&gt;</ph>Azure Preview Portal<ph id=\"ph2\">&lt;/a&gt;</ph> at https://portal.azure.com.",
      "pos": [
        3150,
        3265
      ]
    },
    {
      "content": "Alternatively, you can also launch the <ph id=\"ph1\">&lt;a href= \"https://manage.windowsazure.com/\" target=\"_bank\"&gt;</ph>Classic Azure Portal<ph id=\"ph2\">&lt;/a&gt;</ph> at https://manage.windowsazure.com/.",
      "pos": [
        3266,
        3425
      ]
    },
    {
      "content": "Refer to details below.",
      "pos": [
        3426,
        3449
      ]
    },
    {
      "content": "navigate to the configuration blade of the SQL Database / SQL Server you want to audit.",
      "pos": [
        3454,
        3541
      ]
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> button on top and then, in the Setting blade, and select <bpt id=\"p2\">**</bpt>Auditing<ept id=\"p2\">**</ept>.",
      "pos": [
        3542,
        3635
      ]
    },
    {
      "content": "In the auditing configuration blade, select STORAGE DETAILS to open the Audit Logs Storage Blade.",
      "pos": [
        3652,
        3749
      ]
    },
    {
      "content": "Select the Azure storage account where logs will be saved and, the retention period.",
      "pos": [
        3750,
        3834
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Tip:<ept id=\"p1\">**</ept> Use the same storage account for all audited databases to get the most out of the preconfigured reports templates.",
      "pos": [
        3835,
        3958
      ]
    },
    {
      "pos": [
        3975,
        4094
      ],
      "content": "Under <bpt id=\"p1\">**</bpt>LOGGING BY EVENT<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>SUCCESS<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>FAILURE<ept id=\"p3\">**</ept> to log all events, or choose individual event categories."
    },
    {
      "content": "If you are configuring Auditing for a SQL Database, Click on <bpt id=\"p1\">**</bpt>To enforce auditing click here ...<ept id=\"p1\">**</ept> and on <bpt id=\"p2\">**</bpt>SECURITY ENABLED ACCESS<ept id=\"p2\">**</ept> select <bpt id=\"p3\">**</bpt>REQUIRED<ept id=\"p3\">**</ept>.",
      "pos": [
        4100,
        4255
      ]
    },
    {
      "content": "If you are configuring Auditing for a SQL Server you have two options: (a) after step #6, navigate for each SQL database on the server and apply this step, or (2) <bpt id=\"p1\">[</bpt>Modify Server FDQN in the connection string<ept id=\"p1\">](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md)</ept>.",
      "pos": [
        4256,
        4534
      ]
    },
    {
      "pos": [
        4552,
        4565
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        4571,
        4626
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"subheading-3\"&gt;</ph>Analyze audit logs and reports<ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "content": "Audit logs are aggregated in a collection of Store Tables with a <bpt id=\"p1\">**</bpt>SQLDBAuditLogs<ept id=\"p1\">**</ept> prefix in the Azure storage account you chose during setup.",
      "pos": [
        4628,
        4771
      ]
    },
    {
      "content": "You can view log files using a tool such as <ph id=\"ph1\">&lt;a href=\"http://azurestorageexplorer.codeplex.com/\" target=\"_blank\"&gt;</ph>Azure Storage Explorer<ph id=\"ph2\">&lt;/a&gt;</ph>.",
      "pos": [
        4772,
        4911
      ]
    },
    {
      "content": "A preconfigured dashboard report template is available as a <ph id=\"ph1\">&lt;a href=\"http://go.microsoft.com/fwlink/?LinkId=403540\" target=\"_blank\"&gt;</ph>downloadable Excel spreadsheet<ph id=\"ph2\">&lt;/a&gt;</ph> to help you quickly analyze log data.",
      "pos": [
        4913,
        5117
      ]
    },
    {
      "content": "To use the template on your audit logs, you need Excel 2013 or later and Power Query, which you can download <ph id=\"ph1\">&lt;a href=\"http://www.microsoft.com/download/details.aspx?id=39379\"&gt;</ph>here<ph id=\"ph2\">&lt;/a&gt;</ph>.",
      "pos": [
        5118,
        5302
      ]
    },
    {
      "content": "The template has fictional sample data in it, and you can set up Power Query to import your audit log directly from your Azure storage account.",
      "pos": [
        5305,
        5448
      ]
    },
    {
      "pos": [
        5451,
        5610
      ],
      "content": "For more detailed instructions on working with the report template, read the <ph id=\"ph1\">&lt;a href=\"http://go.microsoft.com/fwlink/?LinkId=506731\"&gt;</ph>How To (doc download)<ph id=\"ph2\">&lt;/a&gt;</ph>."
    },
    {
      "pos": [
        5623,
        5712
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"subheading-4\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Set up auditing for your database using the Classic Azure Portal"
    },
    {
      "pos": [
        5717,
        5848
      ],
      "content": "Launch the <ph id=\"ph1\">&lt;a href= \"https://manage.windowsazure.com/\" target=\"_bank\"&gt;</ph>Classic Azure Portal<ph id=\"ph2\">&lt;/a&gt;</ph> at https://manage.windowsazure.com/."
    },
    {
      "pos": [
        5856,
        5958
      ],
      "content": "Click the SQL Database / SQL Server you want to audit, and then click the <bpt id=\"p1\">**</bpt>AUDITING &amp; SECURITY<ept id=\"p1\">**</ept> tab."
    },
    {
      "content": "If you are configuring Auditing for a SQL Database, On <bpt id=\"p1\">**</bpt>SECURITY ENABLED ACCESS<ept id=\"p1\">**</ept> select <bpt id=\"p2\">**</bpt>REQUIRED<ept id=\"p2\">**</ept>.",
      "pos": [
        5966,
        6069
      ]
    },
    {
      "content": "If you are configuring Auditing for a SQL Server you have two options: (a) after step #7, navigate for each SQL database on the server and apply this step, or (2) <bpt id=\"p1\">[</bpt>Modify Server FDQN in the connection string<ept id=\"p1\">](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md)</ept>.",
      "pos": [
        6070,
        6348
      ]
    },
    {
      "pos": [
        6353,
        6395
      ],
      "content": "At the auditing section click <bpt id=\"p1\">**</bpt>ENABLED<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        6413,
        6453
      ],
      "content": "Edit the <bpt id=\"p1\">**</bpt>LOGGING BY EVENT<ept id=\"p1\">**</ept> as needed."
    },
    {
      "pos": [
        6470,
        6527
      ],
      "content": "Select a <bpt id=\"p1\">**</bpt>STORAGE ACCOUNT<ept id=\"p1\">**</ept> and configure <bpt id=\"p2\">**</bpt>RETENTION<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        6546,
        6561
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>SAVE<ept id=\"p1\">**</ept>."
    },
    {
      "content": "<ph id=\"ph1\">&lt;a id=\"subheading-3\"&gt;</ph>Practices for usage in production<ph id=\"ph2\">&lt;/a&gt;</ph>",
      "pos": [
        6568,
        6626
      ]
    },
    {
      "content": "The description in this section refers to screen captures above.",
      "pos": [
        6627,
        6691
      ]
    },
    {
      "content": "Either <ph id=\"ph1\">&lt;a href=\"https://portal.azure.com\" target=\"_blank\"&gt;</ph>Azure Preview Portal<ph id=\"ph2\">&lt;/a&gt;</ph> or <ph id=\"ph3\">&lt;a href= \"https://manage.windowsazure.com/\" target=\"_bank\"&gt;</ph>Classic Azure Portal<ph id=\"ph4\">&lt;/a&gt;</ph> may be used.",
      "pos": [
        6692,
        6874
      ]
    },
    {
      "pos": [
        6880,
        6929
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"subheading-4\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Storage Key Regeneration"
    },
    {
      "content": "In production you are likely to refresh your storage keys periodically.",
      "pos": [
        6931,
        7002
      ]
    },
    {
      "content": "When refresh your keys you need to re-save the policy.",
      "pos": [
        7003,
        7057
      ]
    },
    {
      "content": "The process is as follows:.",
      "pos": [
        7058,
        7085
      ]
    },
    {
      "content": "In the auditing configuration blade (described above in the set up auditing section) switch the <bpt id=\"p1\">**</bpt>Storage Access Key<ept id=\"p1\">**</ept> from <bpt id=\"p2\">*</bpt>Primary<ept id=\"p2\">*</ept> to <bpt id=\"p3\">*</bpt>Secondary<ept id=\"p3\">*</ept> and <bpt id=\"p4\">**</bpt>SAVE<ept id=\"p4\">**</ept>.",
      "pos": [
        7091,
        7253
      ]
    },
    {
      "pos": [
        7265,
        7347
      ],
      "content": "Go to the storage configuration blade and <bpt id=\"p1\">**</bpt>regenerate<ept id=\"p1\">**</ept> the <bpt id=\"p2\">*</bpt>Primary Access Key<ept id=\"p2\">*</ept>."
    },
    {
      "pos": [
        7352,
        7480
      ],
      "content": "Go back to the auditing configuration blade, switch the <bpt id=\"p1\">**</bpt>Storage Access Key<ept id=\"p1\">**</ept> from <bpt id=\"p2\">*</bpt>Secondary<ept id=\"p2\">*</ept> to <bpt id=\"p3\">*</bpt>Primary<ept id=\"p3\">*</ept> and press <bpt id=\"p4\">**</bpt>SAVE<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        7485,
        7605
      ],
      "content": "Go back to the storage UI and <bpt id=\"p1\">**</bpt>regenerate<ept id=\"p1\">**</ept> the <bpt id=\"p2\">*</bpt>Secondary Access Key<ept id=\"p2\">*</ept> (as preparation for the next keys refresh cycle."
    },
    {
      "content": "<ph id=\"ph1\">&lt;a id=\"subheading-4\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Automation",
      "pos": [
        7611,
        7646
      ]
    },
    {
      "content": "There are several PowerShell cmdlets you can use to configure auditing in Azure SQL Database.",
      "pos": [
        7647,
        7740
      ]
    },
    {
      "content": "To access the auditing cmdlets you must be running PowerShell in Azure Resource Manager mode.",
      "pos": [
        7741,
        7834
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The  <bpt id=\"p1\">[</bpt>Azure Resource Manager<ept id=\"p1\">](https://msdn.microsoft.com/library/dn654592.aspx)</ept> module is currently in preview.",
      "pos": [
        7838,
        7962
      ]
    },
    {
      "content": "It might not provide the same management capabilities as the Azure module.",
      "pos": [
        7963,
        8037
      ]
    },
    {
      "pos": [
        8039,
        8143
      ],
      "content": "When you are in Azure Resource Manager mode, run <ph id=\"ph1\">`Get-Command *AzureSql*`</ph> to list the available cmdlets."
    }
  ],
  "content": "<properties \n    pageTitle=\"Get started with SQL database auditing | Microsoft Azure\" \n    description=\"Get started with SQL database auditing\" \n    services=\"sql-database\" \n    documentationCenter=\"\" \n    authors=\"jeffgoll\" \n    manager=\"jeffreyg\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"sql-database\" \n    ms.workload=\"data-management\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"06/01/2015\" \n    ms.author=\"jeffreyg\"/>\n \n# Get started with SQL database auditing \n<p> Azure SQL Database Auditing tracks database events and writes audited events to an audit log in your Azure Storage account. Auditing is generally available for Basic, Standard, and Premium service tiers.\n\nAuditing can help you maintain regulatory compliance, understand  database activity, and gain insight into discrepancies and anomalies that could indicate business concerns or suspected security violations. \n\nAuditing tools enable and facilitate adherence to compliance standards but don't guarantee compliance. For more information about Azure programs that support standards compliance, see the <a href=\"http://azure.microsoft.com/support/trust-center/compliance/\" target=\"_blank\">Azure Trust Center</a>.\n\n+ [Azure SQL Database Auditing basics] \n+ [Set up auditing for your database]\n+ [Analyze audit logs and reports]\n\n##<a id=\"subheading-1\"></a>Azure SQL Database Auditing basics\n\nThe following sections describe the configuration of Auditing using the Azure Preview Portal. You may also [Set up auditing for your database using the Classic Azure Portal].\n\nSQL Database auditing allows you to:\n\n- **Retain** an audit trail of selected events. You can define categories of database actions  to be audited.\n- **Report** on database activity. You can use preconfigured reports and a dashboard to get started quickly with activity and event reporting.\n- **Analyze** reports. You can find suspicious events, unusual activity, and trends.\n\nYou can configure auditing for the following event categories:\n\n**Plain SQL** and **Parameterized SQL** for which the collected audit logs are classified as  \n\n- **Access to data**\n- **Schema changes (DDL)**\n- **Data changes (DML)**\n- **Accounts, roles, and permissions (DCL)**\n\n**Stored Procedure**, **Login** and, **Transaction Management**.\n\nFor each Event Category, Auditing of **Success** and **Failure** operations are configured separately.\n\nFor further details about the activities and events audited, see the <a href=\"http://go.microsoft.com/fwlink/?LinkId=506733\" target=\"_blank\">Audit Log Format Reference (doc file download)</a>. \n\nAudit logs are stored in your Azure storage account. You can define an audit log retention period.\n\nAn auditing policy can be defined for a specific database or as a default server policy. A default server auditing policy will apply to all databases on a server which do not have a specific overriding database auditing policy defined.\n\nBefore setting up audit auditing check if you are using a [\"Downlevel Client\"](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md).\n\n\n##<a id=\"subheading-2\"></a>Set up auditing for your database\n\n1. Launch the <a href=\"https://portal.azure.com\" target=\"_blank\">Azure Preview Portal</a> at https://portal.azure.com. Alternatively, you can also launch the <a href= \"https://manage.windowsazure.com/\" target=\"_bank\">Classic Azure Portal</a> at https://manage.windowsazure.com/. Refer to details below.\n\n2. navigate to the configuration blade of the SQL Database / SQL Server you want to audit. Click the **Settings** button on top and then, in the Setting blade, and select **Auditing**.\n\n    ![][1]\n\n3. In the auditing configuration blade, select STORAGE DETAILS to open the Audit Logs Storage Blade. Select the Azure storage account where logs will be saved and, the retention period. **Tip:** Use the same storage account for all audited databases to get the most out of the preconfigured reports templates.\n\n    ![][2]\n\n4. Under **LOGGING BY EVENT**, click **SUCCESS** and **FAILURE** to log all events, or choose individual event categories.\n\n\n5. If you are configuring Auditing for a SQL Database, Click on **To enforce auditing click here ...** and on **SECURITY ENABLED ACCESS** select **REQUIRED**. If you are configuring Auditing for a SQL Server you have two options: (a) after step #6, navigate for each SQL database on the server and apply this step, or (2) [Modify Server FDQN in the connection string](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md).\n\n\n    ![][5]\n\n6. Click **OK**.\n\n\n\n##<a id=\"subheading-3\">Analyze audit logs and reports</a>\n\nAudit logs are aggregated in a collection of Store Tables with a **SQLDBAuditLogs** prefix in the Azure storage account you chose during setup. You can view log files using a tool such as <a href=\"http://azurestorageexplorer.codeplex.com/\" target=\"_blank\">Azure Storage Explorer</a>.\n\nA preconfigured dashboard report template is available as a <a href=\"http://go.microsoft.com/fwlink/?LinkId=403540\" target=\"_blank\">downloadable Excel spreadsheet</a> to help you quickly analyze log data. To use the template on your audit logs, you need Excel 2013 or later and Power Query, which you can download <a href=\"http://www.microsoft.com/download/details.aspx?id=39379\">here</a>. \n\nThe template has fictional sample data in it, and you can set up Power Query to import your audit log directly from your Azure storage account. \n\nFor more detailed instructions on working with the report template, read the <a href=\"http://go.microsoft.com/fwlink/?LinkId=506731\">How To (doc download)</a>.\n\n![][6]\n\n\n##<a id=\"subheading-4\"></a>Set up auditing for your database using the Classic Azure Portal\n\n1. Launch the <a href= \"https://manage.windowsazure.com/\" target=\"_bank\">Classic Azure Portal</a> at https://manage.windowsazure.com/.\n \n2.   Click the SQL Database / SQL Server you want to audit, and then click the **AUDITING & SECURITY** tab. \n\n3.   If you are configuring Auditing for a SQL Database, On **SECURITY ENABLED ACCESS** select **REQUIRED**. If you are configuring Auditing for a SQL Server you have two options: (a) after step #7, navigate for each SQL database on the server and apply this step, or (2) [Modify Server FDQN in the connection string](sql-database-auditing-and-dynamic-data-masking-downlevel-clients.md).\n\n4. At the auditing section click **ENABLED**.\n\n\n    ![][7]\n\n5. Edit the **LOGGING BY EVENT** as needed.\n\n    ![][8]\n\n6. Select a **STORAGE ACCOUNT** and configure **RETENTION**. \n\n    ![][11]\n\n7. Click **SAVE**.\n\n\n\n\n##<a id=\"subheading-3\">Practices for usage in production</a>\nThe description in this section refers to screen captures above. Either <a href=\"https://portal.azure.com\" target=\"_blank\">Azure Preview Portal</a> or <a href= \"https://manage.windowsazure.com/\" target=\"_bank\">Classic Azure Portal</a> may be used.\n \n\n##<a id=\"subheading-4\"></a>Storage Key Regeneration\n\nIn production you are likely to refresh your storage keys periodically. When refresh your keys you need to re-save the policy. The process is as follows:.\n\n\n1. In the auditing configuration blade (described above in the set up auditing section) switch the **Storage Access Key** from *Primary* to *Secondary* and **SAVE**.\n![][10]\n2. Go to the storage configuration blade and **regenerate** the *Primary Access Key*.\n\n3. Go back to the auditing configuration blade, switch the **Storage Access Key** from *Secondary* to *Primary* and press **SAVE**.\n\n4. Go back to the storage UI and **regenerate** the *Secondary Access Key* (as preparation for the next keys refresh cycle.\n  \n##<a id=\"subheading-4\"></a>Automation\nThere are several PowerShell cmdlets you can use to configure auditing in Azure SQL Database. To access the auditing cmdlets you must be running PowerShell in Azure Resource Manager mode.\n\n> [AZURE.NOTE] The  [Azure Resource Manager](https://msdn.microsoft.com/library/dn654592.aspx) module is currently in preview. It might not provide the same management capabilities as the Azure module.\n\nWhen you are in Azure Resource Manager mode, run `Get-Command *AzureSql*` to list the available cmdlets.\n\n\n\n\n\n\n\n<!--Anchors-->\n[Azure SQL Database Auditing basics]: #subheading-1\n[Set up auditing for your database]: #subheading-2\n[Analyze audit logs and reports]: #subheading-3\n[Set up auditing for your database using the Classic Azure Portal]: #subheading-4\n\n\n<!--Image references-->\n[1]: ./media/sql-database-auditing-get-started/sql-database-get-started-auditingpreview.png\n[2]: ./media/sql-database-auditing-get-started/sql-database-get-started-storageaccount.png\n[3]: ./media/sql-database-auditing-get-started/sql-database-auditing-eventtype.png\n[5]: ./media/sql-database-auditing-get-started/sql-database-get-started-connectionstring.png\n[6]: ./media/sql-database-auditing-get-started/sql-database-auditing-dashboard.png\n[7]: ./media/sql-database-auditing-get-started/sql-database-auditing-classic-portal-enable.png\n[8]: ./media/sql-database-auditing-get-started/sql-database-auditing-classic-portal-configure.png\n[9]: ./media/sql-database-auditing-get-started/sql-database-auditing-security-enabled-access.png\n[10]: ./media/sql-database-auditing-get-started/sql-database-auditing-storage-account.png\n[11]: ./media/sql-database-auditing-get-started/sql-database-auditing-classic-portal-configure-storage.png\n\n\n\n\n\n\n<!--Link references-->\n[Link 1 to another azure.microsoft.com documentation topic]: ../virtual-machines-windows-tutorial.md\n[Link 2 to another azure.microsoft.com documentation topic]: ../web-sites-custom-domain-name.md\n[Link 3 to another azure.microsoft.com documentation topic]: ../storage-whatis-account.md\n\n \n"
}