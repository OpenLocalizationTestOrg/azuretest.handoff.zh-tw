{
  "nodes": [
    {
      "content": "How to use Azure service management APIs (PHP)",
      "pos": [
        27,
        73
      ]
    },
    {
      "content": "Learn how to use the Azure PHP Service Management APIs to manage cloud services and other Azure applications.",
      "pos": [
        92,
        201
      ]
    },
    {
      "content": "How to use Service Management from PHP",
      "pos": [
        510,
        548
      ]
    },
    {
      "content": "This guide will show you how to programmatically perform common service management tasks from PHP.",
      "pos": [
        550,
        648
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt><ept id=\"p1\">ServiceManagementRestProxy]</ept> class in the <bpt id=\"p2\">[</bpt>Azure SDK for PHP<ept id=\"p2\">][download-SDK-PHP]</ept> supports programmatic access to much of the service management-related functionality that is available in the <bpt id=\"p3\">[</bpt>management portal<ept id=\"p3\">][management-portal]</ept> (such as <bpt id=\"p4\">**</bpt>creating, updating, and deleting cloud services, deployments, storage services, and affinity groups<ept id=\"p4\">**</ept>).",
      "pos": [
        649,
        996
      ]
    },
    {
      "content": "This functionality can be useful in building applications that need programmatic access to service management.",
      "pos": [
        997,
        1107
      ]
    },
    {
      "content": "What is Service Management",
      "pos": [
        1112,
        1138
      ]
    },
    {
      "content": "The Service Management API provides programmatic access to much of the service management functionality available through the <bpt id=\"p1\">[</bpt>management portal<ept id=\"p1\">][management-portal]</ept>.",
      "pos": [
        1139,
        1304
      ]
    },
    {
      "content": "The Azure SDK for PHP allows you to manage your cloud services, storage accounts, and affinity groups.",
      "pos": [
        1305,
        1407
      ]
    },
    {
      "pos": [
        1409,
        1506
      ],
      "content": "To use the Service Management API, you will need to <bpt id=\"p1\">[</bpt>create an Azure account<ept id=\"p1\">][win-azure-account]</ept>."
    },
    {
      "content": "Concepts",
      "pos": [
        1511,
        1519
      ]
    },
    {
      "content": "The Azure SDK for PHP wraps the <bpt id=\"p1\">[</bpt>Azure Service Management API<ept id=\"p1\">][svc-mgmt-rest-api]</ept>, which is a REST API.",
      "pos": [
        1520,
        1623
      ]
    },
    {
      "content": "All API operations are performed over SSL and mutually authenticated using X.509 v3 certificates.",
      "pos": [
        1624,
        1721
      ]
    },
    {
      "content": "The management service may be accessed from within a service running in Azure, or directly over the Internet from any application that can send an HTTPS request and receive an HTTPS response.",
      "pos": [
        1722,
        1913
      ]
    },
    {
      "content": "Create a PHP application",
      "pos": [
        1918,
        1942
      ]
    },
    {
      "content": "The only requirement for creating a PHP application that uses Azure Service Management is the referencing of classes in the Azure SDK for PHP from within your code.",
      "pos": [
        1944,
        2108
      ]
    },
    {
      "content": "You can use any development tools to create your application, including Notepad.",
      "pos": [
        2109,
        2189
      ]
    },
    {
      "content": "In this guide, you will use service features which can be called within a PHP application locally, or in code running within an Azure web role, worker role, or website.",
      "pos": [
        2191,
        2359
      ]
    },
    {
      "content": "Get the Azure Client Libraries",
      "pos": [
        2364,
        2394
      ]
    },
    {
      "content": "How to: Connect to service management",
      "pos": [
        2476,
        2513
      ]
    },
    {
      "content": "To connect to the Service Management endpoint, you need your Azure subscription ID and the path to a valid management certificate.",
      "pos": [
        2515,
        2645
      ]
    },
    {
      "content": "You can obtain your subscription ID through the <bpt id=\"p1\">[</bpt>management portal<ept id=\"p1\">][management-portal]</ept>, and you can create management certificates in a number of ways.",
      "pos": [
        2646,
        2797
      ]
    },
    {
      "content": "In this guide <bpt id=\"p1\">[</bpt>OpenSSL<ept id=\"p1\">](http://www.openssl.org/)</ept> is used, which you can <bpt id=\"p2\">[</bpt>download for Windows<ept id=\"p2\">](http://www.openssl.org/related/binaries.html)</ept> and run in a console.",
      "pos": [
        2798,
        2960
      ]
    },
    {
      "content": "You actually need to create two certificates, one for the server (a <ph id=\"ph1\">`.cer`</ph> file) and one for the client (a <ph id=\"ph2\">`.pem`</ph> file).",
      "pos": [
        2962,
        3082
      ]
    },
    {
      "content": "To create the <ph id=\"ph1\">`.pem`</ph> file, execute this:",
      "pos": [
        3083,
        3123
      ]
    },
    {
      "pos": [
        3219,
        3266
      ],
      "content": "To create the <ph id=\"ph1\">`.cer`</ph> certificate, execute this:"
    },
    {
      "content": "For more information about Azure certificates, see <bpt id=\"p1\">[</bpt>Overview of Certificates in Azure<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/gg981929.aspx)</ept>.",
      "pos": [
        3344,
        3486
      ]
    },
    {
      "content": "For a complete description of OpenSSL parameters, see the documentation at <bpt id=\"p1\">[</bpt>http://www.openssl.org/docs/apps/openssl.html<ept id=\"p1\">](http://www.openssl.org/docs/apps/openssl.html)</ept>.",
      "pos": [
        3487,
        3657
      ]
    },
    {
      "content": "If you have downloaded and imported your publish settings file using the <bpt id=\"p1\">[</bpt>Azure Command-Line Interface<ept id=\"p1\">][Azure CLI]</ept>, you can use the <ph id=\"ph1\">`.pem`</ph> file that the tools create instead of creating your own.",
      "pos": [
        3659,
        3854
      ]
    },
    {
      "content": "The tools create a <ph id=\"ph1\">`.cer`</ph> for you and upload it to Azure, and they put the corresponding <ph id=\"ph2\">`.pem`</ph> file in the <ph id=\"ph3\">`.azure`</ph> directory on your computer (in your user directory).",
      "pos": [
        3855,
        4024
      ]
    },
    {
      "pos": [
        4026,
        4225
      ],
      "content": "After you have created these files, you will need to upload the <ph id=\"ph1\">`.cer`</ph> file to Azure via the <bpt id=\"p1\">[</bpt>management portal<ept id=\"p1\">][management-portal]</ept>, and you will need to make note of where you saved the <ph id=\"ph2\">`.pem`</ph> file."
    },
    {
      "pos": [
        4227,
        4513
      ],
      "content": "After you have obtained your subscription ID, created a certificate, and uploaded the <ph id=\"ph1\">`.cer`</ph> file to Azure, you can connect to the Azure management endpoint by creating a connection string and passing it to the <bpt id=\"p1\">**</bpt>createServiceManagementService<ept id=\"p1\">**</ept> method on the <bpt id=\"p2\">**</bpt>ServicesBuilder<ept id=\"p2\">**</ept> class:"
    },
    {
      "content": "In the example above, <ph id=\"ph1\">`$serviceManagementRestProxy`</ph> is a <bpt id=\"p1\">[</bpt><ept id=\"p1\">ServiceManagementRestProxy]</ept> object.",
      "pos": [
        4819,
        4912
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>ServiceManagementRestProxy<ept id=\"p1\">**</ept> class is the primary class used to manage Azure services.",
      "pos": [
        4913,
        5005
      ]
    },
    {
      "content": "How to: List Available Locations",
      "pos": [
        5010,
        5042
      ]
    },
    {
      "pos": [
        5044,
        5168
      ],
      "content": "To list the locations that are available for hosting services, use the <bpt id=\"p1\">**</bpt>ServiceManagementRestProxy-&gt;listLocations<ept id=\"p1\">**</ept> method:"
    },
    {
      "content": "When you create a cloud service, storage service, or affinity group, you will need to provide a valid location.",
      "pos": [
        5987,
        6098
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>listLocations<ept id=\"p1\">**</ept> method will always return an up-to-date list of the currently available locations.",
      "pos": [
        6099,
        6203
      ]
    },
    {
      "content": "As of this writing, the available locations are:",
      "pos": [
        6204,
        6252
      ]
    },
    {
      "content": "Anywhere US",
      "pos": [
        6256,
        6267
      ]
    },
    {
      "content": "Anywhere Europe",
      "pos": [
        6270,
        6285
      ]
    },
    {
      "content": "West Europe",
      "pos": [
        6288,
        6299
      ]
    },
    {
      "content": "Anywhere Asia",
      "pos": [
        6302,
        6315
      ]
    },
    {
      "content": "Southeast Asia",
      "pos": [
        6318,
        6332
      ]
    },
    {
      "content": "East Asia",
      "pos": [
        6335,
        6344
      ]
    },
    {
      "content": "North Central US",
      "pos": [
        6347,
        6363
      ]
    },
    {
      "content": "North Europe",
      "pos": [
        6366,
        6378
      ]
    },
    {
      "content": "South Central US",
      "pos": [
        6381,
        6397
      ]
    },
    {
      "content": "West US",
      "pos": [
        6400,
        6407
      ]
    },
    {
      "content": "East US",
      "pos": [
        6410,
        6417
      ]
    },
    {
      "content": "In the code examples that follow, locations are passed to methods as strings.",
      "pos": [
        6419,
        6496
      ]
    },
    {
      "content": "However, you can also pass locations as enumerations using the <ph id=\"ph1\">&lt;code&gt;</ph><ph id=\"ph2\">WindowsAzure\\ServiceManagement\\Models\\Locations</ph><ph id=\"ph3\">&lt;/code&gt;</ph> class.",
      "pos": [
        6497,
        6627
      ]
    },
    {
      "content": "For example, instead of passing \"West US\" to a method that accepts a location, you could pass <ph id=\"ph1\">&lt;code&gt;</ph><ph id=\"ph2\">Locations::WEST_US</ph><ph id=\"ph3\">&lt;/code&gt;</ph>.",
      "pos": [
        6628,
        6754
      ]
    },
    {
      "content": "How to: Create a cloud service",
      "pos": [
        6759,
        6789
      ]
    },
    {
      "content": "When you create an application and run it in Azure, the code and configuration together are called an Azure <bpt id=\"p1\">[</bpt><ept id=\"p1\">cloud service]</ept>  - known as a <bpt id=\"p2\">*</bpt>hosted service<ept id=\"p2\">*</ept> in earlier Azure releases.",
      "pos": [
        6791,
        6972
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>createHostedServices<ept id=\"p1\">**</ept> method allows you to create a new hosted service by providing a hosted service name (which must be unique in Azure), a label (the base 64-endcoded hosted service name), and a <bpt id=\"p2\">**</bpt>CreateServiceOptions<ept id=\"p2\">**</ept> object.",
      "pos": [
        6973,
        7209
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt><ept id=\"p1\">CreateServiceOptions]</ept> object allows you to set the location <bpt id=\"p2\">*</bpt>or<ept id=\"p2\">*</ept> the affinity group for your service.",
      "pos": [
        7210,
        7316
      ]
    },
    {
      "content": "You can list all the hosted services for your subscription with the <bpt id=\"p1\">**</bpt>listHostedServices<ept id=\"p1\">**</ept> method, which returns a <bpt id=\"p2\">[</bpt><ept id=\"p2\">ListHostedServicesResult]</ept> object.",
      "pos": [
        8377,
        8526
      ]
    },
    {
      "content": "Calling the <bpt id=\"p1\">**</bpt>getHostedServices<ept id=\"p1\">**</ept> method then allows you to loop through an array of [HostedServices] objects and retrieve service properties:",
      "pos": [
        8527,
        8669
      ]
    },
    {
      "pos": [
        9197,
        9357
      ],
      "content": "If you want to get information about a particular hosted service, you can do so by passing the hosted service name to the <bpt id=\"p1\">**</bpt>getHostedServiceProperties<ept id=\"p1\">**</ept> method:"
    },
    {
      "pos": [
        9819,
        9953
      ],
      "content": "After you have created a cloud service, you can deploy your code to the service with the <bpt id=\"p1\">[</bpt>createDeployment<ept id=\"p1\">](#CreateDeployment)</ept> method."
    },
    {
      "pos": [
        9957,
        10018
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"DeleteCloudService\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How to: Delete a cloud service"
    },
    {
      "pos": [
        10020,
        10117
      ],
      "content": "You can delete a cloud service by passing the service name to the <bpt id=\"p1\">**</bpt>deleteHostedService<ept id=\"p1\">**</ept> method:"
    },
    {
      "content": "Note that before you can delete a service, all deployments for the the service must first be deleted.",
      "pos": [
        10193,
        10294
      ]
    },
    {
      "content": "(See <bpt id=\"p1\">[</bpt>How to: Delete a deployment<ept id=\"p1\">](#DeleteDeployment)</ept> for details.)",
      "pos": [
        10295,
        10362
      ]
    },
    {
      "content": "How to: Create a deployment",
      "pos": [
        10367,
        10394
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>createDeployment<ept id=\"p1\">**</ept> method uploads a new <bpt id=\"p2\">[</bpt><ept id=\"p2\">service package]</ept> and creates a new deployment in the staging or production environment.",
      "pos": [
        10396,
        10530
      ]
    },
    {
      "content": "The parameters for this method are as follows:",
      "pos": [
        10531,
        10577
      ]
    },
    {
      "pos": [
        10581,
        10623
      ],
      "content": "<bpt id=\"p1\">**</bpt>$name<ept id=\"p1\">**</ept>: The name of the hosted service."
    },
    {
      "pos": [
        10626,
        10674
      ],
      "content": "<bpt id=\"p1\">**</bpt>$deploymentName<ept id=\"p1\">**</ept>: The name of the deployment."
    },
    {
      "pos": [
        10677,
        10745
      ],
      "content": "<bpt id=\"p1\">**</bpt>$slot<ept id=\"p1\">**</ept>: An enumeration indicating the staging or production slot."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>$packageUrl<ept id=\"p1\">**</ept>: The URL for the deployment package (a .cspgk file).",
      "pos": [
        10748,
        10816
      ]
    },
    {
      "content": "The package file must be stored in an Azure Blob Storage account under the same subscription as the hosted service to which the package is being uploaded.",
      "pos": [
        10817,
        10971
      ]
    },
    {
      "content": "You can create a deployment package with the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure PowerShell cmdlets]</ept>, or with the <bpt id=\"p2\">[</bpt><ept id=\"p2\">cspack commandline tool]</ept>.",
      "pos": [
        10972,
        11083
      ]
    },
    {
      "pos": [
        11086,
        11151
      ],
      "content": "<bpt id=\"p1\">**</bpt>$configuration<ept id=\"p1\">**</ept>: The service configuration file (.cscfg file)."
    },
    {
      "pos": [
        11154,
        11206
      ],
      "content": "<bpt id=\"p1\">**</bpt>$label<ept id=\"p1\">**</ept>: The base 64-encoded hosted service name."
    },
    {
      "pos": [
        11208,
        11324
      ],
      "content": "The following example creates a new deployement in the production slot of a hosted service called <ph id=\"ph1\">`myhostedservice`</ph>:"
    },
    {
      "pos": [
        12860,
        13049
      ],
      "content": "Note in the example above that the status of the <bpt id=\"p1\">**</bpt>createDeployment<ept id=\"p1\">**</ept> operation can be retrieved by passing the result returned by <bpt id=\"p2\">**</bpt>createDeployment<ept id=\"p2\">**</ept> to the <bpt id=\"p3\">**</bpt>getOperationStatus<ept id=\"p3\">**</ept> method."
    },
    {
      "content": "You can access deployment properties with the <bpt id=\"p1\">**</bpt>getDeployment<ept id=\"p1\">**</ept> method.",
      "pos": [
        13051,
        13122
      ]
    },
    {
      "content": "The following example retrieves a deployment by specifying the deployment slot in the <bpt id=\"p1\">[</bpt><ept id=\"p1\">GetDeploymentOptions]</ept> object, but you could instead specify the deployment name.",
      "pos": [
        13123,
        13290
      ]
    },
    {
      "content": "The example also iterates through all the instances for the deployment:",
      "pos": [
        13291,
        13362
      ]
    },
    {
      "content": "How to: Update a deployment",
      "pos": [
        14193,
        14220
      ]
    },
    {
      "pos": [
        14222,
        14345
      ],
      "content": "A deployment can be updated by using the <bpt id=\"p1\">**</bpt>changeDeploymentConfiguration<ept id=\"p1\">**</ept> method or the <bpt id=\"p2\">**</bpt>updateDeploymentStatus<ept id=\"p2\">**</ept> method."
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>changeDeploymentConfiguration<ept id=\"p1\">**</ept> method allows you to upload a new service configuration (<ph id=\"ph1\">`.cscfg`</ph>) file, which will change any of several service settings (including the number of instances in a deployment).",
      "pos": [
        14347,
        14560
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Service Configuration Schema (.cscfg)]</ept>.",
      "pos": [
        14561,
        14633
      ]
    },
    {
      "content": "The following example demonstrates how to upload a new service configuration file:",
      "pos": [
        14634,
        14716
      ]
    },
    {
      "pos": [
        15986,
        16201
      ],
      "content": "Note in the example above that the status of the <bpt id=\"p1\">**</bpt>changeDeploymentConfiguration<ept id=\"p1\">**</ept> operation can be retrieved by passing the result returned by <bpt id=\"p2\">**</bpt>changeDeploymentConfiguration<ept id=\"p2\">**</ept> to the <bpt id=\"p3\">**</bpt>getOperationStatus<ept id=\"p3\">**</ept> method."
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>updateDeploymentStatus<ept id=\"p1\">**</ept> method allows you to set a deployment status to RUNNING or SUSPENDED.",
      "pos": [
        16203,
        16303
      ]
    },
    {
      "content": "The following example demonstrates how to set the status to RUNNING for a deployment in the production slot of a hosted service called <ph id=\"ph1\">`myhostedservice`</ph>:",
      "pos": [
        16304,
        16457
      ]
    },
    {
      "content": "How to: Move deployments between staging and production",
      "pos": [
        17519,
        17574
      ]
    },
    {
      "content": "Azure provides two deployment environments: staging and production.",
      "pos": [
        17576,
        17643
      ]
    },
    {
      "content": "Typically a service is deployed to the staging environment to test it before deploying the service to the production environment.",
      "pos": [
        17644,
        17773
      ]
    },
    {
      "content": "When it is time to promote the service in staging to the production environment, you can do so without redeploying the service.",
      "pos": [
        17774,
        17901
      ]
    },
    {
      "content": "This can be done by swapping the deployments.",
      "pos": [
        17902,
        17947
      ]
    },
    {
      "content": "(For more information on swapping deployments, see <bpt id=\"p1\">[</bpt><ept id=\"p1\">Overview of Managing Deployments in Azure]</ept>.)",
      "pos": [
        17948,
        18044
      ]
    },
    {
      "content": "The following example shows how to use the <bpt id=\"p1\">**</bpt>swapDeployment<ept id=\"p1\">**</ept> method to swap two deployments (with deployment names <ph id=\"ph1\">`v1`</ph> and <ph id=\"ph2\">`v2`</ph>).",
      "pos": [
        18046,
        18177
      ]
    },
    {
      "content": "In the example, prior to calling <bpt id=\"p1\">**</bpt>swapDeployment<ept id=\"p1\">**</ept>, deployment <ph id=\"ph1\">`v1`</ph> is in the production slot and deployment <ph id=\"ph2\">`v2`</ph> is in the staging slot.",
      "pos": [
        18178,
        18316
      ]
    },
    {
      "content": "After calling <bpt id=\"p1\">**</bpt>swapDeployment<ept id=\"p1\">**</ept>, <ph id=\"ph1\">`v2`</ph> is in production and <ph id=\"ph2\">`v1`</ph> is in staging.",
      "pos": [
        18317,
        18396
      ]
    },
    {
      "content": "How to: Delete a deployment",
      "pos": [
        19130,
        19157
      ]
    },
    {
      "content": "To delete a deployment, use the <bpt id=\"p1\">**</bpt>deleteDeployment<ept id=\"p1\">**</ept> method.",
      "pos": [
        19159,
        19219
      ]
    },
    {
      "content": "The following example shows how to delete a deployment in the staging environment by using the <bpt id=\"p1\">**</bpt>setSlot<ept id=\"p1\">**</ept> method on a <bpt id=\"p2\">[</bpt><ept id=\"p2\">GetDeploymentOptions]</ept> object, then passing it to <bpt id=\"p3\">**</bpt>deleteDeployment<ept id=\"p3\">**</ept>.",
      "pos": [
        19220,
        19410
      ]
    },
    {
      "content": "Instead of specifying a deployment by slot, you can use the <bpt id=\"p1\">**</bpt>setName<ept id=\"p1\">**</ept> method on the [GetDepolymentOptions] class to specify a deployment by deployment name.",
      "pos": [
        19411,
        19569
      ]
    },
    {
      "content": "How to: Create a storage service",
      "pos": [
        20531,
        20563
      ]
    },
    {
      "content": "A <bpt id=\"p1\">[</bpt><ept id=\"p1\">storage service]</ept> gives you access to Azure <bpt id=\"p2\">[</bpt>Blobs<ept id=\"p2\">][azure-blobs]</ept>, <bpt id=\"p3\">[</bpt>Tables<ept id=\"p3\">][azure-tables]</ept>, and <bpt id=\"p4\">[</bpt>Queues<ept id=\"p4\">][azure-queues]</ept>.",
      "pos": [
        20565,
        20684
      ]
    },
    {
      "content": "To create a storage service, you need a name for the service (between 3 and 24 lowercase characters and unique within Azure), a label (a base-64 encoded name for the service, up to 100 characters), and either a location or an affinity group.",
      "pos": [
        20685,
        20926
      ]
    },
    {
      "content": "Providing a description for the service is optional.",
      "pos": [
        20927,
        20979
      ]
    },
    {
      "content": "The location, affinity group, and description are set in a <bpt id=\"p1\">[</bpt><ept id=\"p1\">CreateServiceOptions]</ept> object, which is passed to the <bpt id=\"p2\">**</bpt>createStorageService<ept id=\"p2\">**</ept> method.",
      "pos": [
        20980,
        21125
      ]
    },
    {
      "content": "The following example shows how to create a storage service by specifying a location.",
      "pos": [
        21126,
        21211
      ]
    },
    {
      "content": "If you want to use an affinity group, you have to create an affinity group first (see <bpt id=\"p1\">[</bpt>How to: Create an affinity group<ept id=\"p1\">](#CreateAffinityGroup)</ept>) and set it with the <bpt id=\"p2\">**</bpt>CreateServiceOptions-&gt;setAffinityGroup<ept id=\"p2\">**</ept> method.",
      "pos": [
        21212,
        21426
      ]
    },
    {
      "pos": [
        22600,
        22797
      ],
      "content": "Note in the example above that the status of the <bpt id=\"p1\">**</bpt>createStorageService<ept id=\"p1\">**</ept> operation can be retrieved by passing the result returned by <bpt id=\"p2\">**</bpt>createStorageService<ept id=\"p2\">**</ept> to the <bpt id=\"p3\">**</bpt>getOperationStatus<ept id=\"p3\">**</ept> method."
    },
    {
      "pos": [
        22801,
        22897
      ],
      "content": "You can list your storage accounts and their properties with the <bpt id=\"p1\">**</bpt>listStorageServices<ept id=\"p1\">**</ept> method:"
    },
    {
      "content": "How to: Delete a storage service",
      "pos": [
        23560,
        23592
      ]
    },
    {
      "content": "You can delete a storage service by passing the storage service name to the <bpt id=\"p1\">**</bpt>deleteStorageService<ept id=\"p1\">**</ept> method.",
      "pos": [
        23594,
        23702
      ]
    },
    {
      "content": "Deleting a storage service will delete all data stored in the service (blobs, tables and queues).",
      "pos": [
        23703,
        23800
      ]
    },
    {
      "content": "How to: Create an affinity group",
      "pos": [
        24517,
        24549
      ]
    },
    {
      "content": "An affinity group is a logical grouping of Azure services that tells Azure to locate the services for optimized performance.",
      "pos": [
        24551,
        24675
      ]
    },
    {
      "content": "For example, you might create an affinity group in the “West US” location, then create a <bpt id=\"p1\">[</bpt>cloud Service<ept id=\"p1\">](#CreateCloudService)</ept> in that affinity group.",
      "pos": [
        24676,
        24825
      ]
    },
    {
      "content": "If you then create a storage service in the same affinity group, Azure knows to put it in the “West US” location and optimize within the data center for the best performance with the cloud services in the same affinity group.",
      "pos": [
        24826,
        25051
      ]
    },
    {
      "content": "To create an affinity group, you need a name, label (the base 64-encoded name), and location.",
      "pos": [
        25053,
        25146
      ]
    },
    {
      "content": "You can optionally provide a description:",
      "pos": [
        25147,
        25188
      ]
    },
    {
      "pos": [
        26220,
        26369
      ],
      "content": "After you have created an affinity group, you can specify the group (instead of a location) when <bpt id=\"p1\">[</bpt>creating a storage service<ept id=\"p1\">](#CreateStorageService)</ept>."
    },
    {
      "pos": [
        26371,
        26542
      ],
      "content": "You can list affinity groups and inspect their properties by calling the  <bpt id=\"p1\">**</bpt>listAffinityGroups<ept id=\"p1\">**</ept> method, then calling the appropriate methods on the <bpt id=\"p2\">[</bpt><ept id=\"p2\">AffinityGroup]</ept> class:"
    },
    {
      "content": "How to: Delete an affinity group",
      "pos": [
        26898,
        26930
      ]
    },
    {
      "content": "You can delete an affinity group by passing the group name to the <bpt id=\"p1\">**</bpt>deleteAffinityGroup<ept id=\"p1\">**</ept> method.",
      "pos": [
        26932,
        27029
      ]
    },
    {
      "content": "Note that before you can delete an affinity group, the affinity group must be disassociated from any services (or services that use the affintiy group must be deleted).",
      "pos": [
        27030,
        27198
      ]
    },
    {
      "content": "test",
      "pos": [
        30157,
        30161
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"How to use Azure service management APIs (PHP)\"\n    description=\"Learn how to use the Azure PHP Service Management APIs to manage cloud services and other Azure applications.\"\n    services=\"web-sites\"\n    documentationCenter=\"php\"\n    authors=\"tfitzmac\"\n    manager=\"wpickett\"\n    editor=\"mollybos\"/>\n\n<tags\n    ms.service=\"cloud-services\"\n    ms.workload=\"tbd\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"PHP\"\n    ms.topic=\"article\"\n    ms.date=\"11/17/2014\"\n    ms.author=\"tomfitz\"/>\n\n# How to use Service Management from PHP\n\nThis guide will show you how to programmatically perform common service management tasks from PHP. The [ServiceManagementRestProxy] class in the [Azure SDK for PHP][download-SDK-PHP] supports programmatic access to much of the service management-related functionality that is available in the [management portal][management-portal] (such as **creating, updating, and deleting cloud services, deployments, storage services, and affinity groups**). This functionality can be useful in building applications that need programmatic access to service management.\n\n## What is Service Management\nThe Service Management API provides programmatic access to much of the service management functionality available through the [management portal][management-portal]. The Azure SDK for PHP allows you to manage your cloud services, storage accounts, and affinity groups.\n\nTo use the Service Management API, you will need to [create an Azure account][win-azure-account].\n\n## Concepts\nThe Azure SDK for PHP wraps the [Azure Service Management API][svc-mgmt-rest-api], which is a REST API. All API operations are performed over SSL and mutually authenticated using X.509 v3 certificates. The management service may be accessed from within a service running in Azure, or directly over the Internet from any application that can send an HTTPS request and receive an HTTPS response.\n\n## Create a PHP application\n\nThe only requirement for creating a PHP application that uses Azure Service Management is the referencing of classes in the Azure SDK for PHP from within your code. You can use any development tools to create your application, including Notepad.\n\nIn this guide, you will use service features which can be called within a PHP application locally, or in code running within an Azure web role, worker role, or website.\n\n## Get the Azure Client Libraries\n\n[AZURE.INCLUDE [get-client-libraries](../includes/get-client-libraries.md)]\n\n## How to: Connect to service management\n\nTo connect to the Service Management endpoint, you need your Azure subscription ID and the path to a valid management certificate. You can obtain your subscription ID through the [management portal][management-portal], and you can create management certificates in a number of ways. In this guide [OpenSSL](http://www.openssl.org/) is used, which you can [download for Windows](http://www.openssl.org/related/binaries.html) and run in a console.\n\nYou actually need to create two certificates, one for the server (a `.cer` file) and one for the client (a `.pem` file). To create the `.pem` file, execute this:\n\n    `openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout mycert.pem -out mycert.pem`\n\nTo create the `.cer` certificate, execute this:\n\n    `openssl x509 -inform pem -in mycert.pem -outform der -out mycert.cer`\n\nFor more information about Azure certificates, see [Overview of Certificates in Azure](http://msdn.microsoft.com/library/azure/gg981929.aspx). For a complete description of OpenSSL parameters, see the documentation at [http://www.openssl.org/docs/apps/openssl.html](http://www.openssl.org/docs/apps/openssl.html).\n\nIf you have downloaded and imported your publish settings file using the [Azure Command-Line Interface][Azure CLI], you can use the `.pem` file that the tools create instead of creating your own. The tools create a `.cer` for you and upload it to Azure, and they put the corresponding `.pem` file in the `.azure` directory on your computer (in your user directory).\n\nAfter you have created these files, you will need to upload the `.cer` file to Azure via the [management portal][management-portal], and you will need to make note of where you saved the `.pem` file.\n\nAfter you have obtained your subscription ID, created a certificate, and uploaded the `.cer` file to Azure, you can connect to the Azure management endpoint by creating a connection string and passing it to the **createServiceManagementService** method on the **ServicesBuilder** class:\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n\n    $conn_string = \"SubscriptionID=<your_subscription_id>;CertificatePath=<path_to_.pem_certificate>\";\n\n    $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\nIn the example above, `$serviceManagementRestProxy` is a [ServiceManagementRestProxy] object. The **ServiceManagementRestProxy** class is the primary class used to manage Azure services.\n\n## How to: List Available Locations\n\nTo list the locations that are available for hosting services, use the **ServiceManagementRestProxy->listLocations** method:\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $result = $serviceManagementRestProxy->listLocations();\n\n        $locations = $result->getLocations();\n\n        foreach($locations as $location){\n              echo $location->getName().\"<br />\";\n        }\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\nWhen you create a cloud service, storage service, or affinity group, you will need to provide a valid location. The **listLocations** method will always return an up-to-date list of the currently available locations. As of this writing, the available locations are:\n\n- Anywhere US\n- Anywhere Europe\n- West Europe\n- Anywhere Asia\n- Southeast Asia\n- East Asia\n- North Central US\n- North Europe\n- South Central US\n- West US\n- East US\n\nIn the code examples that follow, locations are passed to methods as strings. However, you can also pass locations as enumerations using the <code>WindowsAzure\\ServiceManagement\\Models\\Locations</code> class. For example, instead of passing \"West US\" to a method that accepts a location, you could pass <code>Locations::WEST_US</code>.\n\n## How to: Create a cloud service\n\nWhen you create an application and run it in Azure, the code and configuration together are called an Azure [cloud service]  - known as a *hosted service* in earlier Azure releases. The **createHostedServices** method allows you to create a new hosted service by providing a hosted service name (which must be unique in Azure), a label (the base 64-endcoded hosted service name), and a **CreateServiceOptions** object. The [CreateServiceOptions] object allows you to set the location *or* the affinity group for your service.\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\ServiceManagement\\Models\\CreateServiceOptions;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $name = \"myhostedservice\";\n        $label = base64_encode($name);\n        $options = new CreateServiceOptions();\n        $options->setLocation('West US');\n        // Instead of setLocation, you can use setAffinityGroup\n        // to set an affinity group.\n\n        $result = $serviceManagementRestProxy->createHostedService($name, $label, $options);\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\nYou can list all the hosted services for your subscription with the **listHostedServices** method, which returns a [ListHostedServicesResult] object. Calling the **getHostedServices** method then allows you to loop through an array of [HostedServices] objects and retrieve service properties:\n\n    $listHostedServicesResult = $serviceManagementRestProxy->listHostedServices();\n\n    $hosted_services = $listHostedServicesResult->getHostedServices();\n\n    foreach($hosted_services as $hosted_service){\n        echo \"Service name: \".$hosted_service->getName().\"<br />\";\n        echo \"Management URL: \".$hosted_service->getUrl().\"<br />\";\n        echo \"Affinity group: \".$hosted_service->getAffinityGroup().\"<br />\";\n        echo \"Location: \".$hosted_service->getLocation().\"<br />\";\n        echo \"------<br />\";\n        }\n\nIf you want to get information about a particular hosted service, you can do so by passing the hosted service name to the **getHostedServiceProperties** method:\n\n    $getHostedServicePropertiesResult = $serviceManagementRestProxy->getHostedServiceProperties(\"myhostedservice\");\n\n    $hosted_service = $getHostedServicePropertiesResult->getHostedService();\n\n    echo \"Service name: \".$hosted_service->getName().\"<br />\";\n    echo \"Management URL: \".$hosted_service->getUrl().\"<br />\";\n    echo \"Affinity group: \".$hosted_service->getAffinityGroup().\"<br />\";\n    echo \"Location: \".$hosted_service->getLocation().\"<br />\";\n\nAfter you have created a cloud service, you can deploy your code to the service with the [createDeployment](#CreateDeployment) method.\n\n##<a id=\"DeleteCloudService\"></a>How to: Delete a cloud service\n\nYou can delete a cloud service by passing the service name to the **deleteHostedService** method:\n\n    $serviceManagementRestProxy->deleteHostedService(\"myhostedservice\");\n\nNote that before you can delete a service, all deployments for the the service must first be deleted. (See [How to: Delete a deployment](#DeleteDeployment) for details.)\n\n## How to: Create a deployment\n\nThe **createDeployment** method uploads a new [service package] and creates a new deployment in the staging or production environment. The parameters for this method are as follows:\n\n* **$name**: The name of the hosted service.\n* **$deploymentName**: The name of the deployment.\n* **$slot**: An enumeration indicating the staging or production slot.\n* **$packageUrl**: The URL for the deployment package (a .cspgk file). The package file must be stored in an Azure Blob Storage account under the same subscription as the hosted service to which the package is being uploaded. You can create a deployment package with the [Azure PowerShell cmdlets], or with the [cspack commandline tool].\n* **$configuration**: The service configuration file (.cscfg file).\n* **$label**: The base 64-encoded hosted service name.\n\nThe following example creates a new deployement in the production slot of a hosted service called `myhostedservice`:\n\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\ServiceManagement\\Models\\DeploymentSlot;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $name = \"myhostedservice\";\n        $deploymentName = \"v1\";\n        $slot = DeploymentSlot::PRODUCTION;\n        $packageUrl = \"URL_for_.cspkg_file\";\n        $configuration = base64_encode(file_get_contents('path_to_.cscfg_file'));\n        $label = base64_encode($name);\n\n        $result = $serviceManagementRestProxy->createDeployment($name,\n                                                         $deploymentName,\n                                                         $slot,\n                                                         $packageUrl,\n                                                         $configuration,\n                                                         $label);\n\n        $status = $serviceManagementRestProxy->getOperationStatus($result);\n        echo \"Operation status: \".$status->getStatus().\"<br />\";\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\nNote in the example above that the status of the **createDeployment** operation can be retrieved by passing the result returned by **createDeployment** to the **getOperationStatus** method.\n\nYou can access deployment properties with the **getDeployment** method. The following example retrieves a deployment by specifying the deployment slot in the [GetDeploymentOptions] object, but you could instead specify the deployment name. The example also iterates through all the instances for the deployment:\n\n    $options = new GetDeploymentOptions();\n    $options->setSlot(DeploymentSlot::PRODUCTION);\n\n    $getDeploymentResult = $serviceManagementRestProxy->getDeployment(\"myhostedservice\", $options);\n    $deployment = $getDeploymentResult->getDeployment();\n\n    echo \"Name: \".$deployment->getName().\"<br />\";\n    echo \"Slot: \".$deployment->getSlot().\"<br />\";\n    echo \"Private ID: \".$deployment->getPrivateId().\"<br />\";\n    echo \"Status: \".$deployment->getStatus().\"<br />\";\n    echo \"Instances: <br />\";\n    foreach($deployment->getroleInstanceList() as $roleInstance){\n        echo \"Instance name: \".$roleInstance->getInstanceName().\"<br />\";\n        echo \"Instance status: \".$roleInstance->getInstanceStatus().\"<br />\";\n        echo \"Instance size: \".$roleInstance->getInstanceSize().\"<br />\";\n    }\n    echo \"------<br />\";\n\n## How to: Update a deployment\n\nA deployment can be updated by using the **changeDeploymentConfiguration** method or the **updateDeploymentStatus** method.\n\nThe **changeDeploymentConfiguration** method allows you to upload a new service configuration (`.cscfg`) file, which will change any of several service settings (including the number of instances in a deployment). For more information, see [Azure Service Configuration Schema (.cscfg)]. The following example demonstrates how to upload a new service configuration file:\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\ServiceManagement\\Models\\ChangeDeploymentConfigurationOptions;\n    use WindowsAzure\\ServiceManagement\\Models\\DeploymentSlot;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $name = \"myhostedservice\";\n        $configuration = base64_encode(file_get_contents('path to .cscfg file'));\n        $options = new ChangeDeploymentConfigurationOptions();\n        $options->setSlot(DeploymentSlot::PRODUCTION);\n\n        $result = $serviceManagementRestProxy->changeDeploymentConfiguration($name, $configuration, $options);\n\n        $status = $serviceManagementRestProxy->getOperationStatus($result);\n        echo \"Operation status: \".$status->getStatus().\"<br />\";\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\nNote in the example above that the status of the **changeDeploymentConfiguration** operation can be retrieved by passing the result returned by **changeDeploymentConfiguration** to the **getOperationStatus** method.\n\nThe **updateDeploymentStatus** method allows you to set a deployment status to RUNNING or SUSPENDED. The following example demonstrates how to set the status to RUNNING for a deployment in the production slot of a hosted service called `myhostedservice`:\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\ServiceManagement\\Models\\DeploymentStatus;\n    use WindowsAzure\\ServiceManagement\\Models\\DeploymentSlot;\n    use WindowsAzure\\ServiceManagement\\Models\\GetDeploymentOptions;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $options = new GetDeploymentOptions();\n        $options->setSlot(DeploymentSlot::PRODUCTION);\n\n        $result = $serviceManagementRestProxy->updateDeploymentStatus(\"myhostedservice\", DeploymentStatus::RUNNING, $options);\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\n## How to: Move deployments between staging and production\n\nAzure provides two deployment environments: staging and production. Typically a service is deployed to the staging environment to test it before deploying the service to the production environment. When it is time to promote the service in staging to the production environment, you can do so without redeploying the service. This can be done by swapping the deployments. (For more information on swapping deployments, see [Overview of Managing Deployments in Azure].)\n\nThe following example shows how to use the **swapDeployment** method to swap two deployments (with deployment names `v1` and `v2`). In the example, prior to calling **swapDeployment**, deployment `v1` is in the production slot and deployment `v2` is in the staging slot. After calling **swapDeployment**, `v2` is in production and `v1` is in staging.  \n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $result = $serviceManagementRestProxy->swapDeployment(\"myhostedservice\", \"v2\", \"v1\");\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\n## How to: Delete a deployment\n\nTo delete a deployment, use the **deleteDeployment** method. The following example shows how to delete a deployment in the staging environment by using the **setSlot** method on a [GetDeploymentOptions] object, then passing it to **deleteDeployment**. Instead of specifying a deployment by slot, you can use the **setName** method on the [GetDepolymentOptions] class to specify a deployment by deployment name.\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\ServiceManagement\\Models\\GetDeploymentOptions;\n    use WindowsAzure\\ServiceManagement\\Models\\DeploymentSlot;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $options = new GetDeploymentOptions();\n        $options->setSlot(DeploymentSlot::STAGING);\n\n        $result = $serviceManagementRestProxy->deleteDeployment(\"myhostedservice\", $options);\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\n## How to: Create a storage service\n\nA [storage service] gives you access to Azure [Blobs][azure-blobs], [Tables][azure-tables], and [Queues][azure-queues]. To create a storage service, you need a name for the service (between 3 and 24 lowercase characters and unique within Azure), a label (a base-64 encoded name for the service, up to 100 characters), and either a location or an affinity group. Providing a description for the service is optional. The location, affinity group, and description are set in a [CreateServiceOptions] object, which is passed to the **createStorageService** method. The following example shows how to create a storage service by specifying a location. If you want to use an affinity group, you have to create an affinity group first (see [How to: Create an affinity group](#CreateAffinityGroup)) and set it with the **CreateServiceOptions->setAffinityGroup** method.\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\ServiceManagement\\Models\\CreateServiceOptions;\n    use WindowsAzure\\Common\\ServiceException;\n\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $name = \"mystorageaccount\";\n        $label = base64_encode($name);\n        $options = new CreateServiceOptions();\n        $options->setLocation('West US');\n        $options->setDescription(\"My storage account description.\");\n\n        $result = $serviceManagementRestProxy->createStorageService($name, $label, $options);\n\n        $status = $serviceManagementRestProxy->getOperationStatus($result);\n        echo \"Operation status: \".$status->getStatus().\"<br />\";\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\nNote in the example above that the status of the **createStorageService** operation can be retrieved by passing the result returned by **createStorageService** to the **getOperationStatus** method.  \n\nYou can list your storage accounts and their properties with the **listStorageServices** method:\n\n    // Create REST proxy.\n    $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n    $getStorageServicesResult = $serviceManagementRestProxy->listStorageServices();\n    $storageServices = $getStorageServicesResult->getStorageServices();\n\n    foreach($storageServices as $storageService){\n        echo \"Service name: \".$storageService->getName().\"<br />\";\n        echo \"Service URL: \".$storageService->getUrl().\"<br />\";\n        echo \"Affinity group: \".$storageService->getAffinityGroup().\"<br />\";\n        echo \"Location: \".$storageService->getLocation().\"<br />\";\n        echo \"------<br />\";\n    }\n\n## How to: Delete a storage service\n\nYou can delete a storage service by passing the storage service name to the **deleteStorageService** method. Deleting a storage service will delete all data stored in the service (blobs, tables and queues).\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $serviceManagementRestProxy->deleteStorageService(\"mystorageservice\");\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\n## How to: Create an affinity group\n\nAn affinity group is a logical grouping of Azure services that tells Azure to locate the services for optimized performance. For example, you might create an affinity group in the “West US” location, then create a [cloud Service](#CreateCloudService) in that affinity group. If you then create a storage service in the same affinity group, Azure knows to put it in the “West US” location and optimize within the data center for the best performance with the cloud services in the same affinity group.\n\nTo create an affinity group, you need a name, label (the base 64-encoded name), and location. You can optionally provide a description:\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\ServiceManagement\\Models\\CreateAffinityGroupOptions;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        $name = \"myAffinityGroup\";\n        $label = base64_encode($name);\n        $location = \"West US\";\n\n        $options = new CreateAffinityGroupOptions();\n        $options->setDescription = \"My affinity group description.\";\n\n        $serviceManagementRestProxy->createAffinityGroup($name, $label, $location, $options);\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\nAfter you have created an affinity group, you can specify the group (instead of a location) when [creating a storage service](#CreateStorageService).\n\nYou can list affinity groups and inspect their properties by calling the  **listAffinityGroups** method, then calling the appropriate methods on the [AffinityGroup] class:\n\n    $result = $serviceManagementRestProxy->listAffinityGroups();\n\n    $groups = $result->getAffinityGroups();\n\n    foreach($groups as $group){\n        echo \"Name: \".$group->getName().\"<br />\";\n        echo \"Description: \".$group->getDescription().\"<br />\";\n        echo \"Location: \".$group->getLocation().\"<br />\";\n        echo \"------<br />\";\n    }\n\n## How to: Delete an affinity group\n\nYou can delete an affinity group by passing the group name to the **deleteAffinityGroup** method. Note that before you can delete an affinity group, the affinity group must be disassociated from any services (or services that use the affintiy group must be deleted).\n\n    require_once 'vendor\\autoload.php';\n\n    use WindowsAzure\\Common\\ServicesBuilder;\n    use WindowsAzure\\Common\\ServiceException;\n\n    try{\n        // Create REST proxy.\n        $serviceManagementRestProxy = ServicesBuilder::getInstance()->createServiceManagementService($conn_string);\n\n        // An affinity group must be disassociated from all services\n        // before it can be deleted.\n        $serviceManagementRestProxy->deleteAffinityGroup(\"myAffinityGroup\");\n    }\n    catch(ServiceException $e){\n        // Handle exception based on error codes and messages.\n        // Error codes and messages are here:\n        // http://msdn.microsoft.com/library/windowsazure/ee460801\n        $code = $e->getCode();\n        $error_message = $e->getMessage();\n        echo $code.\": \".$error_message.\"<br />\";\n    }\n\n[ServiceManagementRestProxy]: https://github.com/WindowsAzure/azure-sdk-for-php/blob/master/WindowsAzure/ServiceManagement/ServiceManagementRestProxy.php\n[management-portal]: https://manage.windowsazure.com/\n[svc-mgmt-rest-api]: http://msdn.microsoft.com/library/windowsazure/ee460799.aspx\n[win-azure-account]: /pricing/free-trial/\n[storage-account]: storage/storage-create-storage-account.md\n\n[download-SDK-PHP]: php-download-sdk.md\n[Azure CLI]: virtual-machines/virtual-machines-command-line-tools.md\n[Composer]: http://getcomposer.org/\n[ServiceManagementSettings]: https://github.com/WindowsAzure/azure-sdk-for-php/blob/master/WindowsAzure/ServiceManagement/ServiceManagementSettings.php\n\n[cloud service]: cloud-services-what-is.md\n[CreateServiceOptions]: https://github.com/WindowsAzure/azure-sdk-for-php/blob/master/WindowsAzure/ServiceManagement/Models/CreateServiceOptions.php\n[ListHostedServicesResult]: https://github.com/WindowsAzure/azure-sdk-for-php/blob/master/WindowsAzure/ServiceManagement/Models/ListHostedServicesResult.php\n\n[service package]: http://msdn.microsoft.com/library/windowsazure/gg433093\n[Azure PowerShell cmdlets]: install-configure-powershell.md\n[cspack commandline tool]: http://msdn.microsoft.com/library/windowsazure/gg432988.aspx\n[GetDeploymentOptions]: https://github.com/WindowsAzure/azure-sdk-for-php/blob/master/WindowsAzure/ServiceManagement/Models/GetDeploymentOptions.php\n[ListHostedServicesResult]: https://github.com/WindowsAzure/azure-sdk-for-php/blob/master/WindowsAzure/ServiceManagement/Models/GetDeploymentOptions.php\n\n[Overview of Managing Deployments in Azure]: http://msdn.microsoft.com/library/windowsazure/hh386336.aspx\n[storage service]: storage-whatis-account.md\n[azure-blobs]: storage/storage-php-how-to-use-blobs.md\n[azure-tables]: storage/storage-php-how-to-use-table-storage.md\n[azure-queues]: storage/storage-php-how-to-use-queues.md\n[AffinityGroup]: https://github.com/WindowsAzure/azure-sdk-for-php/blob/master/WindowsAzure/ServiceManagement/Models/AffinityGroup.php\n\n\n[Azure Service Configuration Schema (.cscfg)]: http://msdn.microsoft.com/library/windowsazure/ee758710.aspx\n\ntest\n"
}