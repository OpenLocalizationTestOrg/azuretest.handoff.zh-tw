{
  "nodes": [
    {
      "content": "Application Insights API for custom events and metrics",
      "pos": [
        28,
        82
      ]
    },
    {
      "content": "Insert a few lines of code in your device or desktop app, web page or service, to track usage and diagnose issues.",
      "pos": [
        102,
        216
      ]
    },
    {
      "content": "Application Insights API for custom events and metrics",
      "pos": [
        540,
        594
      ]
    },
    {
      "content": "Application Insights is in preview.",
      "pos": [
        598,
        633
      ]
    },
    {
      "content": "Insert a few lines of code in your application to find out what users are doing with it, or to help diagnose issues.",
      "pos": [
        636,
        752
      ]
    },
    {
      "content": "You can send telemetry from device and desktop apps, web clients, and web servers.",
      "pos": [
        753,
        835
      ]
    },
    {
      "content": "The Application Insights data collectors use this API to send standard telemetry such as page views and exception reports, but you can also use it to send your own custom telemetry.",
      "pos": [
        838,
        1019
      ]
    },
    {
      "content": "API summary",
      "pos": [
        1024,
        1035
      ]
    },
    {
      "content": "The API is uniform across all platforms, apart from a few small variations.",
      "pos": [
        1037,
        1112
      ]
    },
    {
      "content": "Method",
      "pos": [
        1114,
        1120
      ]
    },
    {
      "content": "Used for",
      "pos": [
        1123,
        1131
      ]
    },
    {
      "content": "Pages, screens, blades or forms",
      "pos": [
        1173,
        1204
      ]
    },
    {
      "content": "User actions and other events.",
      "pos": [
        1236,
        1266
      ]
    },
    {
      "content": "Used to track user behavior or to monitor performance.",
      "pos": [
        1267,
        1321
      ]
    },
    {
      "content": "Performance measurements such as queue lengths not related to specific events",
      "pos": [
        1355,
        1432
      ]
    },
    {
      "content": "Log exceptions for diagnosis.",
      "pos": [
        1470,
        1499
      ]
    },
    {
      "content": "Trace where they occur in relation to other events and examine stack traces.",
      "pos": [
        1500,
        1576
      ]
    },
    {
      "content": "Log the frequency and duration of server requests for performance analysis.",
      "pos": [
        1611,
        1686
      ]
    },
    {
      "content": "Diagnostic log messages.",
      "pos": [
        1716,
        1740
      ]
    },
    {
      "content": "You can also capture 3rd-party logs.",
      "pos": [
        1741,
        1777
      ]
    },
    {
      "content": "Log the duration and frequency of calls to external components on which your app depends.",
      "pos": [
        1817,
        1906
      ]
    },
    {
      "pos": [
        1908,
        1994
      ],
      "content": "You can <bpt id=\"p1\">[</bpt>attach properties and metrics<ept id=\"p1\">](#properties)</ept> to most of these telemetry calls."
    },
    {
      "pos": [
        2001,
        2036
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"prep\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Before you start"
    },
    {
      "content": "If you haven't done these yet:",
      "pos": [
        2038,
        2068
      ]
    },
    {
      "content": "Add the Application Insights SDK to your project:",
      "pos": [
        2072,
        2121
      ]
    },
    {
      "content": "[ASP.NET project][greenbrown]",
      "pos": [
        2125,
        2154
      ]
    },
    {
      "content": "[Windows project][windows]",
      "pos": [
        2158,
        2184
      ]
    },
    {
      "content": "[Java project][java]",
      "pos": [
        2188,
        2208
      ]
    },
    {
      "content": "[JavaScript in each web page][client]",
      "pos": [
        2213,
        2250
      ]
    },
    {
      "content": "In your device or web server code, include:",
      "pos": [
        2257,
        2300
      ]
    },
    {
      "pos": [
        2306,
        2350
      ],
      "content": "<bpt id=\"p1\">*</bpt>C#:<ept id=\"p1\">*</ept> <ph id=\"ph1\">`using Microsoft.ApplicationInsights;`</ph>"
    },
    {
      "pos": [
        2356,
        2401
      ],
      "content": "<bpt id=\"p1\">*</bpt>VB:<ept id=\"p1\">*</ept> <ph id=\"ph1\">`Imports Microsoft.ApplicationInsights`</ph>"
    },
    {
      "pos": [
        2407,
        2474
      ],
      "content": "<bpt id=\"p1\">*</bpt>Java:<ept id=\"p1\">*</ept> <ph id=\"ph1\">`import com.microsoft.applicationinsights.TelemetryClient;`</ph>"
    },
    {
      "content": "Construct a TelemetryClient",
      "pos": [
        2479,
        2506
      ]
    },
    {
      "content": "Construct an instance of TelemetryClient (except in JavaScript in web pages):",
      "pos": [
        2508,
        2585
      ]
    },
    {
      "content": "C#:",
      "pos": [
        2588,
        2591
      ]
    },
    {
      "content": "VB:",
      "pos": [
        2660,
        2663
      ]
    },
    {
      "content": "Java",
      "pos": [
        2718,
        2722
      ]
    },
    {
      "content": "We recommend you use one instance of <ph id=\"ph1\">`TelemetryClient`</ph> for each request in a web app, or for each session in other apps.",
      "pos": [
        2789,
        2909
      ]
    },
    {
      "content": "You can set properties such as <ph id=\"ph1\">`TelemetryClient.Context.User.Id`</ph> to track users and sessions.",
      "pos": [
        2910,
        3003
      ]
    },
    {
      "content": "This information is attached to all events sent by the instance.",
      "pos": [
        3004,
        3068
      ]
    },
    {
      "content": "TelemetryClient is thread-safe.",
      "pos": [
        3070,
        3101
      ]
    },
    {
      "content": "Track Event",
      "pos": [
        3108,
        3119
      ]
    },
    {
      "content": "Events can be displayed in [Metrics Explorer][metrics] as an aggregated count, and you can also display individual occurrences in [Diagnostic Search][diagnostic].",
      "pos": [
        3121,
        3283
      ]
    },
    {
      "content": "Insert events in your code to count how often they use a particular feature, how often they achieve particular goals, or make particular choices.",
      "pos": [
        3287,
        3432
      ]
    },
    {
      "content": "For example, in a game app, send an event whenever a user wins the game:",
      "pos": [
        3435,
        3507
      ]
    },
    {
      "content": "JavaScript",
      "pos": [
        3511,
        3521
      ]
    },
    {
      "content": "C",
      "pos": [
        3565,
        3566
      ]
    },
    {
      "content": "VB",
      "pos": [
        3613,
        3615
      ]
    },
    {
      "content": "Java",
      "pos": [
        3657,
        3661
      ]
    },
    {
      "content": "Click the Custom Events tile on the overview blade:",
      "pos": [
        3703,
        3754
      ]
    },
    {
      "content": "Browse to your application resource in portal.azure.com",
      "pos": [
        3758,
        3813
      ]
    },
    {
      "content": "Click through to see an overview chart and a complete list.",
      "pos": [
        3878,
        3937
      ]
    },
    {
      "content": "Select the chart and group it by Event name to see the relative contributions of the most significant events.",
      "pos": [
        3939,
        4048
      ]
    },
    {
      "content": "Select the chart and set Grouping",
      "pos": [
        4052,
        4085
      ]
    },
    {
      "content": "From the list below the chart, select an event name.",
      "pos": [
        4151,
        4203
      ]
    },
    {
      "content": "Click through to see individual occurrences of the event.",
      "pos": [
        4204,
        4261
      ]
    },
    {
      "content": "Drill through the events",
      "pos": [
        4265,
        4289
      ]
    },
    {
      "content": "Click any occurrence to see more detail.",
      "pos": [
        4357,
        4397
      ]
    },
    {
      "pos": [
        4402,
        4479
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"properties\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Filter, search and segment your data with properties"
    },
    {
      "content": "You can attach properties and measurements to your events (and also to metrics, page views, exceptions, and other telemetry data).",
      "pos": [
        4481,
        4611
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> are string values that you can use to filter your telemetry in the usage reports.",
      "pos": [
        4613,
        4709
      ]
    },
    {
      "content": "For example if your app provides several games, you'll want to attach the name of the game to each event, so that you can see which games are more popular.",
      "pos": [
        4710,
        4865
      ]
    },
    {
      "content": "There's a limit of about 1k on the string length.",
      "pos": [
        4868,
        4917
      ]
    },
    {
      "content": "(If you want to send large chunks of data, use the message parameter of <bpt id=\"p1\">[</bpt>TrackTrace<ept id=\"p1\">](#track-trace)</ept>.)",
      "pos": [
        4918,
        5018
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Metrics<ept id=\"p1\">**</ept> are numeric values that can be presented graphically.",
      "pos": [
        5020,
        5085
      ]
    },
    {
      "content": "For example, you might want to see if there's a gradual increase in the scores your gamers achieve.",
      "pos": [
        5086,
        5185
      ]
    },
    {
      "content": "The graphs can be segmented by the properties sent with the event, so that you could get separate or stacked graphs for different games.",
      "pos": [
        5186,
        5322
      ]
    },
    {
      "content": "Metric values should be &gt;= 0 to be correctly displayed.",
      "pos": [
        5324,
        5379
      ]
    },
    {
      "pos": [
        5382,
        5490
      ],
      "content": "There are some <bpt id=\"p1\">[</bpt>limits on the number of properties, property values, and metrics<ept id=\"p1\">](#limits)</ept> that you can use."
    },
    {
      "content": "JavaScript",
      "pos": [
        5494,
        5504
      ]
    },
    {
      "content": "C",
      "pos": [
        6089,
        6090
      ]
    },
    {
      "content": "VB",
      "pos": [
        6484,
        6486
      ]
    },
    {
      "content": "Java",
      "pos": [
        6914,
        6918
      ]
    },
    {
      "pos": [
        7356,
        7440
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Take care not to log personally identifiable information in properties."
    },
    {
      "pos": [
        7442,
        7532
      ],
      "content": "<bpt id=\"p1\">**</bpt>If you used metrics<ept id=\"p1\">**</ept>, open Metric Explorer and select the metric from the Custom group:"
    },
    {
      "content": "Open metric explorer, select the chart, and select the metric",
      "pos": [
        7536,
        7597
      ]
    },
    {
      "content": "If your metric doesn't appear, close the selection blade, wait a while, and click Refresh.",
      "pos": [
        7669,
        7759
      ]
    },
    {
      "pos": [
        7762,
        7837
      ],
      "content": "<bpt id=\"p1\">**</bpt>If you used properties and metrics<ept id=\"p1\">**</ept>, segment the metric by the property:"
    },
    {
      "content": "Set Grouping, then select the property under Group by",
      "pos": [
        7842,
        7895
      ]
    },
    {
      "pos": [
        7976,
        8080
      ],
      "content": "<bpt id=\"p1\">**</bpt>In Diagnostic Search<ept id=\"p1\">**</ept>, you can view the properties and metrics of individual occurrences of an event."
    },
    {
      "content": "Select an instance, then select '...'",
      "pos": [
        8085,
        8122
      ]
    },
    {
      "content": "Use the Search field to see event occurrences with a particular property value.",
      "pos": [
        8208,
        8287
      ]
    },
    {
      "content": "Type a term into Search",
      "pos": [
        8292,
        8315
      ]
    },
    {
      "content": "[Learn more about search expressions][diagnostic].",
      "pos": [
        8400,
        8450
      ]
    },
    {
      "content": "Alternative way to set properties and metrics",
      "pos": [
        8457,
        8502
      ]
    },
    {
      "content": "If it's more convenient, you can collect the parameters of an event in a separate object:",
      "pos": [
        8504,
        8593
      ]
    },
    {
      "pos": [
        9000,
        9034
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"timed\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Timing events"
    },
    {
      "content": "Sometimes you'd like to chart how long it takes to perform some action.",
      "pos": [
        9036,
        9107
      ]
    },
    {
      "content": "For example, you might like to know how long users take to consider choices in a game.",
      "pos": [
        9108,
        9194
      ]
    },
    {
      "content": "This is a useful example of uses of the measurement parameter.",
      "pos": [
        9195,
        9257
      ]
    },
    {
      "content": "C",
      "pos": [
        9261,
        9262
      ]
    },
    {
      "content": "Track Metric",
      "pos": [
        9743,
        9755
      ]
    },
    {
      "content": "Use TrackMetric to send metrics that are not attached to particular events.",
      "pos": [
        9757,
        9832
      ]
    },
    {
      "content": "For example, you could monitor a queue length at regular intervals.",
      "pos": [
        9833,
        9900
      ]
    },
    {
      "content": "Metrics are displayed as statistical charts in metric explorer, but unlike events, you can't search for individual occurrences in diagnostic search.",
      "pos": [
        9903,
        10051
      ]
    },
    {
      "content": "Metric values should be &gt;= 0 to be correctly displayed.",
      "pos": [
        10053,
        10108
      ]
    },
    {
      "content": "JavaScript",
      "pos": [
        10112,
        10122
      ]
    },
    {
      "content": "C",
      "pos": [
        10179,
        10180
      ]
    },
    {
      "content": "VB",
      "pos": [
        10236,
        10238
      ]
    },
    {
      "content": "Java",
      "pos": [
        10292,
        10296
      ]
    },
    {
      "content": "In fact, you might do this in a background thread:",
      "pos": [
        10350,
        10400
      ]
    },
    {
      "content": "C",
      "pos": [
        10403,
        10404
      ]
    },
    {
      "content": "To see the results, open Metrics Explorer and add a new chart.",
      "pos": [
        10595,
        10657
      ]
    },
    {
      "content": "Set it to display your metric.",
      "pos": [
        10658,
        10688
      ]
    },
    {
      "content": "Add a new chart or select a chart, and under Custom select your metric",
      "pos": [
        10692,
        10762
      ]
    },
    {
      "pos": [
        10833,
        10903
      ],
      "content": "There are some <bpt id=\"p1\">[</bpt>limits on the number of metrics<ept id=\"p1\">](#limits)</ept> you can use."
    },
    {
      "content": "Page views",
      "pos": [
        10908,
        10918
      ]
    },
    {
      "content": "In a device or web page app, page view telemetry is sent by default when each screen or page is loaded.",
      "pos": [
        10920,
        11023
      ]
    },
    {
      "content": "But you can change that to track page views at additional or different times.",
      "pos": [
        11024,
        11101
      ]
    },
    {
      "content": "For example, in an app that displays tabs or blades, you might want to track a \"page\" whenever the user opens a new blade.",
      "pos": [
        11102,
        11224
      ]
    },
    {
      "content": "Usage lens on Overview blade",
      "pos": [
        11229,
        11257
      ]
    },
    {
      "content": "User and session data is sent as properties along with page views, so the user and session charts come alive when there is page view telemetry.",
      "pos": [
        11334,
        11477
      ]
    },
    {
      "content": "Custom page views",
      "pos": [
        11484,
        11501
      ]
    },
    {
      "content": "JavaScript",
      "pos": [
        11504,
        11514
      ]
    },
    {
      "content": "C",
      "pos": [
        11558,
        11559
      ]
    },
    {
      "content": "VB",
      "pos": [
        11612,
        11614
      ]
    },
    {
      "content": "If you have several tabs within different HTML pages, you can specify the URL too:",
      "pos": [
        11665,
        11747
      ]
    },
    {
      "content": "Track Request",
      "pos": [
        11827,
        11840
      ]
    },
    {
      "content": "Used by the server SDK to log HTTP requests.",
      "pos": [
        11842,
        11886
      ]
    },
    {
      "content": "You can also call it yourself if you want to simulate requests in a context where you don't have the web service module running.",
      "pos": [
        11889,
        12017
      ]
    },
    {
      "content": "C",
      "pos": [
        12020,
        12021
      ]
    },
    {
      "content": "Track Exception",
      "pos": [
        12579,
        12594
      ]
    },
    {
      "content": "Send exceptions to Application Insights: to [count them][metrics], as an indication of the frequency of a problem; and to [examine individual occurrences][diagnostic].",
      "pos": [
        12596,
        12763
      ]
    },
    {
      "content": "The reports include the stack traces.",
      "pos": [
        12764,
        12801
      ]
    },
    {
      "content": "C",
      "pos": [
        12804,
        12805
      ]
    },
    {
      "content": "JavaScript",
      "pos": [
        12917,
        12927
      ]
    },
    {
      "content": "The SDKs catch many exceptions automatically, so you don't always have to call TrackException explicitly.",
      "pos": [
        13028,
        13133
      ]
    },
    {
      "pos": [
        13137,
        13214
      ],
      "content": "ASP.NET: <bpt id=\"p1\">[</bpt>Write code to catch exceptions<ept id=\"p1\">](app-insights-asp-net-exceptions.md)</ept>"
    },
    {
      "pos": [
        13217,
        13326
      ],
      "content": "J2EE: <bpt id=\"p1\">[</bpt>Exceptions are caught automatically<ept id=\"p1\">](app-insights-java-get-started.md#exceptions-and-request-failures)</ept>"
    },
    {
      "pos": [
        13329,
        13410
      ],
      "content": "Windows apps: <bpt id=\"p1\">[</bpt>Crashes are caught automatically<ept id=\"p1\">](app-insights-windows-crashes.md)</ept>"
    },
    {
      "content": "JavaScript: Caught automatically.",
      "pos": [
        13413,
        13446
      ]
    },
    {
      "content": "If you want to disable automatic collection, add a line into the code snippet that you insert in your web pages:",
      "pos": [
        13447,
        13559
      ]
    },
    {
      "content": "Track Trace",
      "pos": [
        13672,
        13683
      ]
    },
    {
      "content": "Use this to help diagnose problems by sending a 'breadcrumb trail' to Application Insights.",
      "pos": [
        13686,
        13777
      ]
    },
    {
      "content": "You can send chunks of diagnostic data, and inspect them in [Diagnostic search][diagnostic].",
      "pos": [
        13778,
        13870
      ]
    },
    {
      "content": "[Log adapters][trace] use this API to send third-party logs to the portal.",
      "pos": [
        13876,
        13950
      ]
    },
    {
      "content": "C",
      "pos": [
        13954,
        13955
      ]
    },
    {
      "content": "The size limit on <ph id=\"ph1\">`message`</ph> is much higher than limit on  properties.",
      "pos": [
        14030,
        14099
      ]
    },
    {
      "content": "You can search on message content, but (unlike property values) you can't filter on it.",
      "pos": [
        14100,
        14187
      ]
    },
    {
      "content": "Track Dependency",
      "pos": [
        14192,
        14208
      ]
    },
    {
      "content": "Use this call to track the response times and success rates of calls to an external piece of code.",
      "pos": [
        14210,
        14308
      ]
    },
    {
      "content": "The results appear in the dependency charts in the portal.",
      "pos": [
        14309,
        14367
      ]
    },
    {
      "content": "Remember that the server SDKs include a <bpt id=\"p1\">[</bpt>dependency module<ept id=\"p1\">](app-insights-dependencies.md)</ept> that discovers and tracks certain dependency calls automatically - for example to databases and REST APIs.",
      "pos": [
        14796,
        14992
      ]
    },
    {
      "content": "You have to install an agent on your server to make the module work.",
      "pos": [
        14993,
        15061
      ]
    },
    {
      "content": "You'd use this call if you want to track calls that aren't caught by the automated tracking, or if you don't want to install the agent.",
      "pos": [
        15062,
        15197
      ]
    },
    {
      "pos": [
        15199,
        15433
      ],
      "content": "To turn off the standard dependency tracking module, edit <bpt id=\"p1\">[</bpt>ApplicationInsights.config<ept id=\"p1\">](app-insights-configuration-with-applicationinsights-config.md)</ept> and delete the reference to <ph id=\"ph1\">`DependencyCollector.DependencyTrackingTelemetryModule`</ph>."
    },
    {
      "content": "Authenticated users",
      "pos": [
        15439,
        15458
      ]
    },
    {
      "content": "In a web app, users are by default identified by cookie.",
      "pos": [
        15460,
        15516
      ]
    },
    {
      "content": "A user might be counted more than once if they access your app from a different machine or browser, or delete cookies.",
      "pos": [
        15517,
        15635
      ]
    },
    {
      "content": "But if users sign in to your app, you can get a more accurate count by setting the authenticated user id in the browser code:",
      "pos": [
        15638,
        15763
      ]
    },
    {
      "content": "JavaScript",
      "pos": [
        15766,
        15776
      ]
    },
    {
      "content": "It isn't necessary to use the user's actual sign-in name.",
      "pos": [
        16016,
        16073
      ]
    },
    {
      "content": "It only has to be an id that is unique to that user.",
      "pos": [
        16074,
        16126
      ]
    },
    {
      "content": "It must not include spaces, or any of the characters <ph id=\"ph1\">`,;=|`</ph>.",
      "pos": [
        16127,
        16187
      ]
    },
    {
      "content": "The user id is also set in a session cookie and sent to the server.",
      "pos": [
        16190,
        16257
      ]
    },
    {
      "content": "If the server SDK is installed, the authenticated user id will be sent as part of the context properties of both client and server telemetry, so that you can filter and search on it.",
      "pos": [
        16258,
        16440
      ]
    },
    {
      "content": "If your app groups users into accounts, you can also pass an identifier for the account (with the same character restrictions).",
      "pos": [
        16442,
        16569
      ]
    },
    {
      "pos": [
        16644,
        16768
      ],
      "content": "In <bpt id=\"p1\">[</bpt>metrics explorer<ept id=\"p1\">](app-insights-metrics-explorer.md)</ept>, you can create a chart of <bpt id=\"p2\">**</bpt>Authenticated Users<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Accounts<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        16775,
        16840
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"defaults\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Set defaults for selected custom telemetry"
    },
    {
      "content": "If you just want to set default property values for some of the custom events that you write, you can set them in a TelemetryClient.",
      "pos": [
        16842,
        16974
      ]
    },
    {
      "content": "They are attached to every telemetry item sent from that client.",
      "pos": [
        16975,
        17039
      ]
    },
    {
      "content": "C",
      "pos": [
        17043,
        17044
      ]
    },
    {
      "content": "VB",
      "pos": [
        17342,
        17344
      ]
    },
    {
      "content": "Java",
      "pos": [
        17577,
        17581
      ]
    },
    {
      "content": "Individual telemetry calls can override the default values in their property dictionaries.",
      "pos": [
        17949,
        18039
      ]
    },
    {
      "pos": [
        18041,
        18130
      ],
      "content": "<bpt id=\"p1\">**</bpt>For JavaScript web clients<ept id=\"p1\">**</ept>, <bpt id=\"p2\">[</bpt>use JavaScript telemetry initializers<ept id=\"p2\">](#js-initializer)</ept>."
    },
    {
      "pos": [
        18136,
        18213
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"ikey\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Set the instrumentation key for selected custom telemetry"
    },
    {
      "content": "C",
      "pos": [
        18216,
        18217
      ]
    },
    {
      "content": "Telemetry Initializers",
      "pos": [
        18344,
        18366
      ]
    },
    {
      "content": "Use telemetry initializers to define global properties that are sent with all telemetry; and to override selected behavior of the standard telemetry modules.",
      "pos": [
        18368,
        18525
      ]
    },
    {
      "content": "For example, the Application Insights for Web package collects telemetry about HTTP requests.",
      "pos": [
        18528,
        18621
      ]
    },
    {
      "content": "By default, it flags as failed any request with a response code &gt;= 400.",
      "pos": [
        18622,
        18693
      ]
    },
    {
      "content": "But if you want to treat 400 as a success, you can provide a telemetry initilizer that sets the Success property.",
      "pos": [
        18694,
        18807
      ]
    },
    {
      "content": "If you provide a telemetry initializer, it is called whenever any of the Track*() methods is called.",
      "pos": [
        18809,
        18909
      ]
    },
    {
      "content": "This includes methods called by the standard telemetry modules.",
      "pos": [
        18910,
        18973
      ]
    },
    {
      "content": "By convention, these modules do not set any property that has already been set by an initializer.",
      "pos": [
        18974,
        19071
      ]
    },
    {
      "content": "Define your initializer",
      "pos": [
        19076,
        19099
      ]
    },
    {
      "content": "C",
      "pos": [
        19104,
        19105
      ]
    },
    {
      "content": "Load your initializer",
      "pos": [
        20380,
        20401
      ]
    },
    {
      "content": "In ApplicationInsights.config:",
      "pos": [
        20405,
        20435
      ]
    },
    {
      "pos": [
        20702,
        20794
      ],
      "content": "<bpt id=\"p1\">*</bpt>Alternatively,<ept id=\"p1\">*</ept> you can instantiate the initializer in code, for example in Global.aspx.cs:"
    },
    {
      "content": "See more of this sample.",
      "pos": [
        20980,
        21004
      ]
    },
    {
      "content": "JavaScript telemetry initializers",
      "pos": [
        21145,
        21178
      ]
    },
    {
      "content": "JavaScript",
      "pos": [
        21181,
        21191
      ]
    },
    {
      "content": "Insert a telemetry initializer immediately after the initialization code that you got from the portal:",
      "pos": [
        21194,
        21296
      ]
    },
    {
      "pos": [
        22640,
        22790
      ],
      "content": "For a summary of the non-custom properties available on the telemetryItem, see the <bpt id=\"p1\">[</bpt>data model<ept id=\"p1\">](app-insights-export-data-model.md/#lttelemetrytypegt)</ept>."
    },
    {
      "content": "You can add as many initializers as you like.",
      "pos": [
        22792,
        22837
      ]
    },
    {
      "pos": [
        22843,
        22898
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"dynamic-ikey\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Dynamic instrumentation key"
    },
    {
      "content": "To avoid mixing up telemetry from development, test and production environments, you can [create separate Application Insights resources][create] and change their keys depending on the environment.",
      "pos": [
        22900,
        23097
      ]
    },
    {
      "content": "Instead of getting the instrumentation key from the configuration file, you can set it in your code.",
      "pos": [
        23099,
        23199
      ]
    },
    {
      "content": "Set the key in an initialization method, such as global.aspx.cs in an ASP.NET service:",
      "pos": [
        23200,
        23286
      ]
    },
    {
      "content": "C",
      "pos": [
        23289,
        23290
      ]
    },
    {
      "content": "JavaScript",
      "pos": [
        23543,
        23553
      ]
    },
    {
      "content": "In web pages, you might want to set it from the web server's state, rather than coding it literally into the script.",
      "pos": [
        23611,
        23727
      ]
    },
    {
      "content": "For example, in a web page generated in an ASP.NET app:",
      "pos": [
        23728,
        23783
      ]
    },
    {
      "content": "JavaScript in Razor",
      "pos": [
        23786,
        23805
      ]
    },
    {
      "content": "Flushing data",
      "pos": [
        24189,
        24202
      ]
    },
    {
      "content": "Normally the SDK sends data at times chosen to minimize impact on the user.",
      "pos": [
        24204,
        24279
      ]
    },
    {
      "content": "However, in some cases you might want to flush the buffer - for example, if you are using the SDK in an application that shuts down.",
      "pos": [
        24280,
        24412
      ]
    },
    {
      "content": "C",
      "pos": [
        24415,
        24416
      ]
    },
    {
      "content": "Note that the function is synchronous.",
      "pos": [
        24444,
        24482
      ]
    },
    {
      "content": "Disable standard telemetry",
      "pos": [
        24489,
        24515
      ]
    },
    {
      "content": "You can [disable selected parts of the standard telemetry][config] by editing <ph id=\"ph1\">`ApplicationInsights.config`</ph>.",
      "pos": [
        24517,
        24624
      ]
    },
    {
      "content": "You could do this, for example, if you want to send your own TrackRequest data.",
      "pos": [
        24625,
        24704
      ]
    },
    {
      "content": "[Learn more][config].",
      "pos": [
        24707,
        24728
      ]
    },
    {
      "pos": [
        24734,
        24768
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"debug\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Developer mode"
    },
    {
      "content": "During debugging, it's useful to have your telemetry expedited through the pipeline so that you can see results immediately.",
      "pos": [
        24770,
        24894
      ]
    },
    {
      "content": "You also get additional messages that help you trace any problems with the telemetry.",
      "pos": [
        24895,
        24980
      ]
    },
    {
      "content": "Switch it off in production, as it may slow down your app.",
      "pos": [
        24981,
        25039
      ]
    },
    {
      "content": "C",
      "pos": [
        25043,
        25044
      ]
    },
    {
      "content": "VB",
      "pos": [
        25127,
        25129
      ]
    },
    {
      "content": "TelemetryContext",
      "pos": [
        25208,
        25224
      ]
    },
    {
      "content": "TelemetryClient has a Context property, which contains a number of values that are sent along with all telemetry data.",
      "pos": [
        25226,
        25344
      ]
    },
    {
      "content": "They are normally set by the standard telemetry modules, but you can also set them yourself.",
      "pos": [
        25345,
        25437
      ]
    },
    {
      "content": "For example:",
      "pos": [
        25438,
        25450
      ]
    },
    {
      "content": "If you set any of these values yourself, consider removing the relevant line from [ApplicationInsights.config][config], so that your values and the standard values don't get confused.",
      "pos": [
        25517,
        25700
      ]
    },
    {
      "pos": [
        25704,
        25752
      ],
      "content": "<bpt id=\"p1\">**</bpt>Component<ept id=\"p1\">**</ept> Identifies the app and its version"
    },
    {
      "pos": [
        25755,
        25899
      ],
      "content": "<bpt id=\"p1\">**</bpt>Device<ept id=\"p1\">**</ept> Data about the device on which the app is running (in web apps, this is the server or client device from which the telemetry is sent)"
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>InstrumentationKey<ept id=\"p1\">**</ept> Identifies the Application Insights resource in Azure where the telemetry will appear.",
      "pos": [
        25902,
        26011
      ]
    },
    {
      "content": "Usually picked up from ApplicationInsights.config",
      "pos": [
        26012,
        26061
      ]
    },
    {
      "pos": [
        26064,
        26126
      ],
      "content": "<bpt id=\"p1\">**</bpt>Location<ept id=\"p1\">**</ept> Identifies the geographic location of the device."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Operation<ept id=\"p1\">**</ept> In web apps, the current HTTP request.",
      "pos": [
        26129,
        26181
      ]
    },
    {
      "content": "In other app types, you can set this to group events together.",
      "pos": [
        26182,
        26244
      ]
    },
    {
      "pos": [
        26248,
        26393
      ],
      "content": "<bpt id=\"p1\">**</bpt>Id<ept id=\"p1\">**</ept>: A generated value that correlates different events, so that when you inspect any event in Diagnostic Search, you can find \"Related items\""
    },
    {
      "pos": [
        26397,
        26458
      ],
      "content": "<bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept>: An identifier, usually the URL of the HTTP request."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>SyntheticSource<ept id=\"p1\">**</ept>: If not null or empty, this string indicates that the source of the request has been identified as a robot or web test.",
      "pos": [
        26463,
        26602
      ]
    },
    {
      "content": "By default it will be excluded from calculations in Metrics Explorer.",
      "pos": [
        26603,
        26672
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> Properties that are sent with all telemetry data.",
      "pos": [
        26675,
        26739
      ]
    },
    {
      "content": "Can be overridden in individual Track* calls.",
      "pos": [
        26740,
        26785
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Session<ept id=\"p1\">**</ept> Identifies the user's session.",
      "pos": [
        26788,
        26830
      ]
    },
    {
      "content": "The Id is set to a generated value, which is changed when the user has not been active for a while.",
      "pos": [
        26831,
        26930
      ]
    },
    {
      "pos": [
        26933,
        26959
      ],
      "content": "<bpt id=\"p1\">**</bpt>User<ept id=\"p1\">**</ept> User information."
    },
    {
      "pos": [
        26966,
        27062
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"default-properties\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Context initializers - Set default properties for all telemetry"
    },
    {
      "content": "You can set up a universal initializer so that all new TelemetryClients automatically use your context.",
      "pos": [
        27064,
        27167
      ]
    },
    {
      "content": "This includes standard telemetry sent by the platform-specific telemetry modules, such as web server request tracking.",
      "pos": [
        27168,
        27286
      ]
    },
    {
      "content": "A typical use is to identify telemetry coming from different versions or components of your app.",
      "pos": [
        27288,
        27384
      ]
    },
    {
      "content": "In the portal, you can filter or group results by the \"Application Version\" property.",
      "pos": [
        27385,
        27470
      ]
    },
    {
      "pos": [
        27472,
        27637
      ],
      "content": "In general, <bpt id=\"p1\">[</bpt>we recommend that you use telemetry initializers rather than context initializers<ept id=\"p1\">](http://apmtips.com/blog/2015/06/09/do-not-use-context-initializers/)</ept>."
    },
    {
      "content": "Define a context initializer",
      "pos": [
        27644,
        27672
      ]
    },
    {
      "content": "C",
      "pos": [
        27676,
        27677
      ]
    },
    {
      "content": "Java",
      "pos": [
        28191,
        28195
      ]
    },
    {
      "content": "Load your context initializer",
      "pos": [
        28570,
        28599
      ]
    },
    {
      "content": "In ApplicationInsights.config:",
      "pos": [
        28601,
        28631
      ]
    },
    {
      "pos": [
        28887,
        28948
      ],
      "content": "<bpt id=\"p1\">*</bpt>Alternatively,<ept id=\"p1\">*</ept> you can instantiate the initializer in code:"
    },
    {
      "content": "C",
      "pos": [
        28951,
        28952
      ]
    },
    {
      "content": "Java",
      "pos": [
        29135,
        29139
      ]
    },
    {
      "content": "Limits",
      "pos": [
        29295,
        29301
      ]
    },
    {
      "content": "There are some limits on the number of metrics and events per application.",
      "pos": [
        29303,
        29377
      ]
    },
    {
      "content": "Up to 500 telemetry data points per second per instrumentation key (that is, per application).",
      "pos": [
        29382,
        29476
      ]
    },
    {
      "content": "This includes both the standard telemetry sent by the SDK modules, and custom events, metrics and other telemetry sent by your code.",
      "pos": [
        29477,
        29609
      ]
    },
    {
      "content": "Maximum of 200 unique metric names and 200 unique property names for your application.",
      "pos": [
        29614,
        29700
      ]
    },
    {
      "content": "Metrics include data send via TrackMetric as well as measurements on other  data types such as Events.",
      "pos": [
        29701,
        29803
      ]
    },
    {
      "content": "Metrics and property names are global per instrumentation key, not scoped to data type.",
      "pos": [
        29805,
        29892
      ]
    },
    {
      "content": "Properties can be used for filtering and group-by only while they have less than 100 unique values for each property.",
      "pos": [
        29897,
        30014
      ]
    },
    {
      "content": "After the unique values exceed 100, the property can still be used for search and filtering but no longer for filters.",
      "pos": [
        30015,
        30133
      ]
    },
    {
      "content": "Standard properties such as Request Name and Page URL are limited to 1000 unique values per week.",
      "pos": [
        30138,
        30235
      ]
    },
    {
      "content": "After 1000 unique values, additional values are marked as \"Other values\".",
      "pos": [
        30236,
        30309
      ]
    },
    {
      "content": "The original value can still be used for full text search and filtering.",
      "pos": [
        30310,
        30382
      ]
    },
    {
      "content": "Q: How long is data kept?",
      "pos": [
        30387,
        30412
      ]
    },
    {
      "content": "See [Data retention and privacy][data].",
      "pos": [
        30419,
        30458
      ]
    },
    {
      "content": "Reference docs",
      "pos": [
        30464,
        30478
      ]
    },
    {
      "content": "ASP.NET reference",
      "pos": [
        30483,
        30500
      ]
    },
    {
      "content": "Java reference",
      "pos": [
        30555,
        30569
      ]
    },
    {
      "content": "JavaScript reference",
      "pos": [
        30631,
        30651
      ]
    },
    {
      "content": "Android SDK",
      "pos": [
        30738,
        30749
      ]
    },
    {
      "content": "iOS SDK",
      "pos": [
        30812,
        30819
      ]
    },
    {
      "content": "SDK Code",
      "pos": [
        30880,
        30888
      ]
    },
    {
      "content": "ASP.NET Core SDK",
      "pos": [
        30893,
        30909
      ]
    },
    {
      "content": "ASP.NET 5",
      "pos": [
        30971,
        30980
      ]
    },
    {
      "content": "Android SDK",
      "pos": [
        31043,
        31054
      ]
    },
    {
      "content": "Java SDK",
      "pos": [
        31117,
        31125
      ]
    },
    {
      "content": "JavaScript SDK",
      "pos": [
        31185,
        31199
      ]
    },
    {
      "content": "iOS SDK",
      "pos": [
        31257,
        31264
      ]
    },
    {
      "content": "All platforms",
      "pos": [
        31323,
        31336
      ]
    },
    {
      "content": "Questions",
      "pos": [
        31413,
        31422
      ]
    },
    {
      "content": "What exceptions might Track_() calls throw?",
      "pos": [
        31427,
        31470
      ]
    },
    {
      "content": "None.",
      "pos": [
        31481,
        31486
      ]
    },
    {
      "content": "You don't need to wrap them in try-catch clauses.",
      "pos": [
        31487,
        31536
      ]
    },
    {
      "content": "If the SDK encounters problems, it will log messages that you will see in the debug console output, and - if the messages get through - in diagnostic search.",
      "pos": [
        31537,
        31694
      ]
    },
    {
      "content": "Is there a REST API?",
      "pos": [
        31701,
        31721
      ]
    },
    {
      "content": "Yes, but we aren't publishing it yet.",
      "pos": [
        31728,
        31765
      ]
    },
    {
      "pos": [
        31770,
        31799
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"next\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Next steps"
    },
    {
      "content": "[Search events and logs][diagnostic]",
      "pos": [
        31802,
        31838
      ]
    },
    {
      "content": "Samples and walkthroughs",
      "pos": [
        31841,
        31865
      ]
    },
    {
      "content": "[Troubleshooting][qna]",
      "pos": [
        31898,
        31920
      ]
    },
    {
      "content": "test",
      "pos": [
        32533,
        32537
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Application Insights API for custom events and metrics\" \n    description=\"Insert a few lines of code in your device or desktop app, web page or service, to track usage and diagnose issues.\" \n    services=\"application-insights\"\n    documentationCenter=\"\" \n    authors=\"alancameronwills\" \n    manager=\"douge\"/>\n \n<tags \n    ms.service=\"application-insights\" \n    ms.workload=\"tbd\" \n    ms.tgt_pltfrm=\"ibiza\" \n    ms.devlang=\"multiple\" \n    ms.topic=\"article\" \n    ms.date=\"08/28/2015\" \n    ms.author=\"awills\"/>\n\n# Application Insights API for custom events and metrics \n\n*Application Insights is in preview.*\n\nInsert a few lines of code in your application to find out what users are doing with it, or to help diagnose issues. You can send telemetry from device and desktop apps, web clients, and web servers. \n\nThe Application Insights data collectors use this API to send standard telemetry such as page views and exception reports, but you can also use it to send your own custom telemetry.\n\n## API summary\n\nThe API is uniform across all platforms, apart from a few small variations.\n\nMethod | Used for\n---|---\n[`TrackPageView`](#page-views) | Pages, screens, blades or forms\n[`TrackEvent`](#track-event) | User actions and other events. Used to track user behavior or to monitor performance.\n[`TrackMetric`](#track-metric) | Performance measurements such as queue lengths not related to specific events\n[`TrackException`](#track-exception)|Log exceptions for diagnosis. Trace where they occur in relation to other events and examine stack traces.\n[`TrackRequest`](#track-request)| Log the frequency and duration of server requests for performance analysis.\n[`TrackTrace`](#track-trace)|Diagnostic log messages. You can also capture 3rd-party logs.\n[`TrackDependency`](#track-dependency)|Log the duration and frequency of calls to external components on which your app depends.\n\nYou can [attach properties and metrics](#properties) to most of these telemetry calls. \n\n\n## <a name=\"prep\"></a>Before you start\n\nIf you haven't done these yet:\n\n* Add the Application Insights SDK to your project:\n * [ASP.NET project][greenbrown]\n * [Windows project][windows]\n * [Java project][java] \n * [JavaScript in each web page][client]   \n\n* In your device or web server code, include:\n\n    *C#:* `using Microsoft.ApplicationInsights;`\n\n    *VB:* `Imports Microsoft.ApplicationInsights`\n\n    *Java:* `import com.microsoft.applicationinsights.TelemetryClient;`\n\n## Construct a TelemetryClient\n\nConstruct an instance of TelemetryClient (except in JavaScript in web pages):\n\n*C#:* \n\n    private TelemetryClient telemetry = new TelemetryClient();\n\n*VB:* \n\n    Private Dim telemetry As New TelemetryClient\n\n*Java*\n\n    private TelemetryClient telemetry = new TelemetryClient();\n\nWe recommend you use one instance of `TelemetryClient` for each request in a web app, or for each session in other apps. You can set properties such as `TelemetryClient.Context.User.Id` to track users and sessions. This information is attached to all events sent by the instance.\n\nTelemetryClient is thread-safe.\n\n\n\n## Track Event\n\nEvents can be displayed in [Metrics Explorer][metrics] as an aggregated count, and you can also display individual occurrences in [Diagnostic Search][diagnostic].  \n\nInsert events in your code to count how often they use a particular feature, how often they achieve particular goals, or make particular choices. \n\nFor example, in a game app, send an event whenever a user wins the game: \n\n*JavaScript*\n\n    appInsights.trackEvent(\"WinGame\");\n\n*C#*\n    \n    telemetry.TrackEvent(\"WinGame\");\n\n*VB*\n\n\n    telemetry.TrackEvent(\"WinGame\")\n\n*Java*\n\n    telemetry.trackEvent(\"WinGame\");\n\n\nClick the Custom Events tile on the overview blade:\n\n![Browse to your application resource in portal.azure.com](./media/app-insights-api-custom-events-metrics/01-custom.png)\n\nClick through to see an overview chart and a complete list.\n\nSelect the chart and group it by Event name to see the relative contributions of the most significant events.\n\n![Select the chart and set Grouping](./media/app-insights-api-custom-events-metrics/02-segment.png)\n\nFrom the list below the chart, select an event name. Click through to see individual occurrences of the event.\n\n![Drill through the events](./media/app-insights-api-custom-events-metrics/03-instances.png)\n\nClick any occurrence to see more detail.\n\n## <a name=\"properties\"></a>Filter, search and segment your data with properties\n\nYou can attach properties and measurements to your events (and also to metrics, page views, exceptions, and other telemetry data).\n\n**Properties** are string values that you can use to filter your telemetry in the usage reports. For example if your app provides several games, you'll want to attach the name of the game to each event, so that you can see which games are more popular. \n\nThere's a limit of about 1k on the string length. (If you want to send large chunks of data, use the message parameter of [TrackTrace](#track-trace).)\n\n**Metrics** are numeric values that can be presented graphically. For example, you might want to see if there's a gradual increase in the scores your gamers achieve. The graphs can be segmented by the properties sent with the event, so that you could get separate or stacked graphs for different games.\n\nMetric values should be >= 0 to be correctly displayed.\n\n\nThere are some [limits on the number of properties, property values, and metrics](#limits) that you can use.\n\n\n*JavaScript*\n\n    appInsights.trackEvent\n      (\"WinGame\",\n         // String properties:\n         {Game: currentGame.name, Difficulty: currentGame.difficulty},\n         // Numeric metrics:\n         {Score: currentGame.score, Opponents: currentGame.opponentCount}\n         );\n\n    appInsights.trackPageView\n        (\"page name\", \"http://fabrikam.com/pageurl.html\",\n          // String properties:\n         {Game: currentGame.name, Difficulty: currentGame.difficulty},\n         // Numeric metrics:\n         {Score: currentGame.score, Opponents: currentGame.opponentCount}\n         );\n          \n\n*C#*\n\n    // Set up some properties and metrics:\n    var properties = new Dictionary <string, string> \n       {{\"game\", currentGame.Name}, {\"difficulty\", currentGame.Difficulty}};\n    var metrics = new Dictionary <string, double>\n       {{\"Score\", currentGame.Score}, {\"Opponents\", currentGame.OpponentCount}};\n\n    // Send the event:\n    telemetry.TrackEvent(\"WinGame\", properties, metrics);\n\n\n*VB*\n\n    ' Set up some properties:\n    Dim properties = New Dictionary (Of String, String)\n    properties.Add(\"game\", currentGame.Name)\n    properties.Add(\"difficulty\", currentGame.Difficulty)\n\n    Dim metrics = New Dictionary (Of String, Double)\n    metrics.Add(\"Score\", currentGame.Score)\n    metrics.Add(\"Opponents\", currentGame.OpponentCount)\n\n    ' Send the event:\n    telemetry.TrackEvent(\"WinGame\", properties, metrics)\n\n\n*Java*\n    \n    Map<String, String> properties = new HashMap<String, String>();\n    properties.put(\"game\", currentGame.getName());\n    properties.put(\"difficulty\", currentGame.getDifficulty());\n    \n    Map<String, Double> metrics = new HashMap<String, Double>();\n    metrics.put(\"Score\", currentGame.getScore());\n    metrics.put(\"Opponents\", currentGame.getOpponentCount());\n    \n    telemetry.trackEvent(\"WinGame\", properties, metrics);\n\n\n> [AZURE.NOTE] Take care not to log personally identifiable information in properties.\n\n**If you used metrics**, open Metric Explorer and select the metric from the Custom group:\n\n![Open metric explorer, select the chart, and select the metric](./media/app-insights-api-custom-events-metrics/03-track-custom.png)\n\n*If your metric doesn't appear, close the selection blade, wait a while, and click Refresh.*\n\n**If you used properties and metrics**, segment the metric by the property:\n\n\n![Set Grouping, then select the property under Group by](./media/app-insights-api-custom-events-metrics/04-segment-metric-event.png)\n\n\n\n**In Diagnostic Search**, you can view the properties and metrics of individual occurrences of an event.\n\n\n![Select an instance, then select '...'](./media/app-insights-api-custom-events-metrics/appinsights-23-customevents-4.png)\n\n\nUse the Search field to see event occurrences with a particular property value.\n\n\n![Type a term into Search](./media/app-insights-api-custom-events-metrics/appinsights-23-customevents-5.png)\n\n[Learn more about search expressions][diagnostic].\n\n#### Alternative way to set properties and metrics\n\nIf it's more convenient, you can collect the parameters of an event in a separate object:\n\n    var event = new EventTelemetry();\n\n    event.Name = \"WinGame\";\n    event.Metrics[\"processingTime\"] = stopwatch.Elapsed.TotalMilliseconds;\n    event.Properties[\"game\"] = currentGame.Name;\n    event.Properties[\"difficulty\"] = currentGame.Difficulty;\n    event.Metrics[\"Score\"] = currentGame.Score;\n    event.Metrics[\"Opponents\"] = currentGame.Opponents.Length;\n\n    telemetry.TrackEvent(event);\n\n\n\n#### <a name=\"timed\"></a> Timing events\n\nSometimes you'd like to chart how long it takes to perform some action. For example, you might like to know how long users take to consider choices in a game. This is a useful example of uses of the measurement parameter.\n\n\n*C#*\n\n    var stopwatch = System.Diagnostics.Stopwatch.StartNew();\n\n    // ... perform the timed action ...\n\n    stopwatch.Stop();\n\n    var metrics = new Dictionary <string, double>\n       {{\"processingTime\", stopwatch.Elapsed.TotalMilliseconds}};\n\n    // Set up some properties:\n    var properties = new Dictionary <string, string> \n       {{\"signalSource\", currentSignalSource.Name}};\n\n    // Send the event:\n    telemetry.TrackEvent(\"SignalProcessed\", properties, metrics);\n\n\n\n## Track Metric\n\nUse TrackMetric to send metrics that are not attached to particular events. For example, you could monitor a queue length at regular intervals. \n\nMetrics are displayed as statistical charts in metric explorer, but unlike events, you can't search for individual occurrences in diagnostic search.\n\nMetric values should be >= 0 to be correctly displayed.\n\n\n*JavaScript*\n\n    appInsights.trackMetric(\"Queue\", queue.Length);\n\n*C#*\n\n    telemetry.TrackMetric(\"Queue\", queue.Length);\n\n*VB*\n\n    telemetry.TrackMetric(\"Queue\", queue.Length)\n\n*Java*\n\n    telemetry.trackMetric(\"Queue\", queue.Length);\n\nIn fact, you might do this in a background thread:\n\n*C#*\n\n    private void Run() {\n     var appInsights = new TelemetryClient();\n     while (true) {\n      Thread.Sleep(60000);\n      appInsights.TrackMetric(\"Queue\", queue.Length);\n     }\n    }\n\n\nTo see the results, open Metrics Explorer and add a new chart. Set it to display your metric.\n\n![Add a new chart or select a chart, and under Custom select your metric](./media/app-insights-api-custom-events-metrics/03-track-custom.png)\n\nThere are some [limits on the number of metrics](#limits) you can use.\n\n## Page views\n\nIn a device or web page app, page view telemetry is sent by default when each screen or page is loaded. But you can change that to track page views at additional or different times. For example, in an app that displays tabs or blades, you might want to track a \"page\" whenever the user opens a new blade. \n\n![Usage lens on Overview blade](./media/app-insights-api-custom-events-metrics/appinsights-47usage-2.png)\n\nUser and session data is sent as properties along with page views, so the user and session charts come alive when there is page view telemetry.\n\n#### Custom page views\n\n*JavaScript*\n\n    appInsights.trackPageView(\"tab1\");\n\n*C#*\n\n    telemetry.TrackPageView(\"GameReviewPage\");\n\n*VB*\n\n    telemetry.TrackPageView(\"GameReviewPage\")\n\n\nIf you have several tabs within different HTML pages, you can specify the URL too:\n\n    appInsights.trackPageView(\"tab1\", \"http://fabrikam.com/page1.htm\");\n\n\n\n## Track Request\n\nUsed by the server SDK to log HTTP requests. \n\nYou can also call it yourself if you want to simulate requests in a context where you don't have the web service module running.\n\n*C#*\n\n    // At start of processing this request:\n\n    // Operation Id and Name are attached to all telemetry and help you identify\n    // telemetry associated with one request:\n    telemetry.Context.Operation.Id = Guid.NewGuid().ToString();\n    telemetry.Context.Operation.Name = requestName;\n    \n    var stopwatch = System.Diagnostics.Stopwatch.StartNew();\n\n    // ... process the request ...\n\n    stopwatch.Stop();\n    telemetryClient.TrackRequest(requestName, DateTime.Now,\n       stopwatch.Elapsed, \n       \"200\", true);  // Response code, success\n\n\n\n## Track Exception\n\nSend exceptions to Application Insights: to [count them][metrics], as an indication of the frequency of a problem; and to [examine individual occurrences][diagnostic]. The reports include the stack traces.\n\n*C#*\n\n    try\n    {\n        ...\n    }\n    catch (Exception ex)\n    {\n       telemetry.TrackException(ex);\n    }\n\n*JavaScript*\n\n    try\n    {\n       ...\n    }\n    catch (ex)\n    {\n       appInsights.trackException(ex);\n    }\n\nThe SDKs catch many exceptions automatically, so you don't always have to call TrackException explicitly.\n\n* ASP.NET: [Write code to catch exceptions](app-insights-asp-net-exceptions.md)\n* J2EE: [Exceptions are caught automatically](app-insights-java-get-started.md#exceptions-and-request-failures)\n* Windows apps: [Crashes are caught automatically](app-insights-windows-crashes.md)\n* JavaScript: Caught automatically. If you want to disable automatic collection, add a line into the code snippet that you insert in your web pages:\n\n    ```\n    ({\n      instrumentationKey: \"your key\"\n      , disableExceptionTracking: true\n    })\n    ```\n\n\n## Track Trace \n\nUse this to help diagnose problems by sending a 'breadcrumb trail' to Application Insights. You can send chunks of diagnostic data, and inspect them in [Diagnostic search][diagnostic]. \n\n \n\n[Log adapters][trace] use this API to send third-party logs to the portal.\n\n\n*C#*\n\n    telemetry.TrackTrace(message, SeverityLevel.Warning, properties);\n\nThe size limit on `message` is much higher than limit on  properties. You can search on message content, but (unlike property values) you can't filter on it.\n\n## Track Dependency\n\nUse this call to track the response times and success rates of calls to an external piece of code. The results appear in the dependency charts in the portal. \n\n```C#\n\n            var success = false;\n            var startTime = DateTime.UtcNow;\n            var timer = System.Diagnostics.Stopwatch.StartNew();\n            try\n            {\n                success = dependency.Call();\n            }\n            finally\n            {\n                timer.Stop();\n                telemetry.TrackDependency(\"myDependency\", \"myCall\", startTime, timer.Elapsed, success);\n            }\n```\n\nRemember that the server SDKs include a [dependency module](app-insights-dependencies.md) that discovers and tracks certain dependency calls automatically - for example to databases and REST APIs. You have to install an agent on your server to make the module work. You'd use this call if you want to track calls that aren't caught by the automated tracking, or if you don't want to install the agent.\n\nTo turn off the standard dependency tracking module, edit [ApplicationInsights.config](app-insights-configuration-with-applicationinsights-config.md) and delete the reference to `DependencyCollector.DependencyTrackingTelemetryModule`.\n\n\n## Authenticated users\n\nIn a web app, users are by default identified by cookie. A user might be counted more than once if they access your app from a different machine or browser, or delete cookies. \n\nBut if users sign in to your app, you can get a more accurate count by setting the authenticated user id in the browser code:\n\n*JavaScript*\n\n```JS\n    // Called when my app has identified the user.\n    function Authenticated(signInId) {\n      var validatedId = signInId.replace(/[,;=| ]+/g, \"_\");\n      appInsights.setAuthenticatedUserContext(validatedId);\n      ...\n    }\n```\n\nIt isn't necessary to use the user's actual sign-in name. It only has to be an id that is unique to that user. It must not include spaces, or any of the characters `,;=|`. \n\nThe user id is also set in a session cookie and sent to the server. If the server SDK is installed, the authenticated user id will be sent as part of the context properties of both client and server telemetry, so that you can filter and search on it.\n\nIf your app groups users into accounts, you can also pass an identifier for the account (with the same character restrictions).\n\n\n      appInsights.setAuthenticatedUserContext(validatedId, accountId);\n\nIn [metrics explorer](app-insights-metrics-explorer.md), you can create a chart of **Authenticated Users** and **Accounts**. \n\n\n## <a name=\"defaults\"></a>Set defaults for selected custom telemetry\n\nIf you just want to set default property values for some of the custom events that you write, you can set them in a TelemetryClient. They are attached to every telemetry item sent from that client. \n\n*C#*\n\n    using Microsoft.ApplicationInsights.DataContracts;\n\n    var gameTelemetry = new TelemetryClient();\n    gameTelemetry.Context.Properties[\"Game\"] = currentGame.Name;\n    // Now all telemetry will automatically be sent with the context property:\n    gameTelemetry.TrackEvent(\"WinGame\");\n    \n*VB*\n\n    Dim gameTelemetry = New TelemetryClient()\n    gameTelemetry.Context.Properties(\"Game\") = currentGame.Name\n    ' Now all telemetry will automatically be sent with the context property:\n    gameTelemetry.TrackEvent(\"WinGame\")\n\n*Java*\n\n    import com.microsoft.applicationinsights.TelemetryClient;\n    import com.microsoft.applicationinsights.TelemetryContext;\n    ...\n\n\n    TelemetryClient gameTelemetry = new TelemetryClient();\n    TelemetryContext context = gameTelemetry.getContext();\n    context.getProperties().put(\"Game\", currentGame.Name);\n    \n    gameTelemetry.TrackEvent(\"WinGame\");\n\n\n    \nIndividual telemetry calls can override the default values in their property dictionaries.\n\n**For JavaScript web clients**, [use JavaScript telemetry initializers](#js-initializer).\n\n\n## <a name=\"ikey\"></a> Set the instrumentation key for selected custom telemetry\n\n*C#*\n    \n    var telemetry = new TelemetryClient();\n    telemetry.Context.InstrumentationKey = \"---my key---\";\n    // ...\n\n\n\n## Telemetry Initializers\n\nUse telemetry initializers to define global properties that are sent with all telemetry; and to override selected behavior of the standard telemetry modules. \n\nFor example, the Application Insights for Web package collects telemetry about HTTP requests. By default, it flags as failed any request with a response code >= 400. But if you want to treat 400 as a success, you can provide a telemetry initilizer that sets the Success property.\n\nIf you provide a telemetry initializer, it is called whenever any of the Track*() methods is called. This includes methods called by the standard telemetry modules. By convention, these modules do not set any property that has already been set by an initializer. \n\n**Define your initializer**\n\n*C#*\n\n```C#\n\n    using System;\n    using Microsoft.ApplicationInsights.Channel;\n    using Microsoft.ApplicationInsights.DataContracts;\n    using Microsoft.ApplicationInsights.Extensibility;\n\n    namespace MvcWebRole.Telemetry\n    {\n      /*\n       * Custom TelemetryInitializer that overrides the default SDK \n       * behavior of treating response codes >= 400 as failed requests\n       * \n       */\n      public class MyTelemetryInitializer : ITelemetryInitializer\n      {\n        public void Initialize(ITelemetry telemetry)\n        {\n            var requestTelemetry = telemetry as RequestTelemetry;\n            // Is this a TrackRequest() ?\n            if (requestTelemetry == null) return;\n            int code;\n            bool parsed = Int32.TryParse(requestTelemetry.ResponseCode, out code);\n            if (!parsed) return;\n            if (code >= 400 && code < 500)\n            {\n                // If we set the Success property, the SDK won't change it:\n                requestTelemetry.Success = true;\n                // Allow us to filter these requests in the portal:\n                requestTelemetry.Context.Properties[\"Overridden400s\"] = \"true\";\n            }\n            // else leave the SDK to set the Success property      \n        }\n      }\n    }\n```\n\n**Load your initializer**\n\nIn ApplicationInsights.config:\n\n    <ApplicationInsights>\n      <TelemetryInitializers>\n        <!-- Fully qualified type name, assembly name: -->\n        <Add Type=\"MvcWebRole.Telemetry.MyTelemetryInitializer, MvcWebRole\"/> \n        ...\n      </TelemetryInitializers>\n    </ApplicationInsights>\n\n*Alternatively,* you can instantiate the initializer in code, for example in Global.aspx.cs:\n\n\n```C#\n    protected void Application_Start()\n    {\n        // ...\n        TelemetryConfiguration.Active.TelemetryInitializers\n        .Add(new MyTelemetryInitializer());\n    }\n```\n\n\n[See more of this sample.](https://github.com/Microsoft/ApplicationInsights-Home/tree/master/Samples/AzureEmailService/MvcWebRole)\n\n<a name=\"js-initializer\"></a>\n### JavaScript telemetry initializers\n\n*JavaScript*\n\nInsert a telemetry initializer immediately after the initialization code that you got from the portal: \n\n```JS\n\n    <script type=\"text/javascript\">\n        // ... initialization code\n        ...({\n            instrumentationKey: \"your instrumentation key\"\n        });\n        window.appInsights = appInsights;\n\n\n        // Adding telemetry initializer.\n        // This is called whenever a new telemetry item\n        // is created.\n\n        appInsights.queue.push(function () {\n            appInsights.context.addTelemetryInitializer(function (envelope) {\n                var telemetryItem = envelope.data.baseData;\n\n                // To check the telemetry items type - for example PageView:\n                if (envelope.name == Microsoft.ApplicationInsights.Telemetry.PageView.envelopeType) {\n                    // this statement removes url from all page view documents\n                    telemetryItem.url = \"URL CENSORED\";\n                }\n\n                // To set custom properties:\n                telemetryItem.properties = telemetryItem.properties || {};\n                telemetryItem.properties[\"globalProperty\"] = \"boo\";\n\n                // To set custom metrics:\n                telemetryItem.measurements = telemetryItem.measurements || {};\n                telemetryItem.measurements[\"globalMetric\"] = 100;\n            });\n        });\n\n        // End of inserted code.\n\n        appInsights.trackPageView();\n    </script>\n```\n\nFor a summary of the non-custom properties available on the telemetryItem, see the [data model](app-insights-export-data-model.md/#lttelemetrytypegt).\n\nYou can add as many initializers as you like. \n\n## <a name=\"dynamic-ikey\"></a> Dynamic instrumentation key\n\nTo avoid mixing up telemetry from development, test and production environments, you can [create separate Application Insights resources][create] and change their keys depending on the environment.\n\nInstead of getting the instrumentation key from the configuration file, you can set it in your code. Set the key in an initialization method, such as global.aspx.cs in an ASP.NET service:\n\n*C#*\n\n    protected void Application_Start()\n    {\n      Microsoft.ApplicationInsights.Extensibility.\n        TelemetryConfiguration.Active.InstrumentationKey = \n          // - for example -\n          WebConfigurationManager.Settings[\"ikey\"];\n      ...\n\n*JavaScript*\n\n    appInsights.config.instrumentationKey = myKey; \n\n\n\nIn web pages, you might want to set it from the web server's state, rather than coding it literally into the script. For example, in a web page generated in an ASP.NET app:\n\n*JavaScript in Razor*\n\n    <script type=\"text/javascript\">\n    // Standard Application Insights web page script:\n    var appInsights = window.appInsights || function(config){ ...\n    // Modify this part:\n    }({instrumentationKey:  \n      // Generate from server property:\n      @Microsoft.ApplicationInsights.Extensibility.\n         TelemetryConfiguration.Active.InstrumentationKey\"\n    }) // ...\n\n\n\n## Flushing data\n\nNormally the SDK sends data at times chosen to minimize impact on the user. However, in some cases you might want to flush the buffer - for example, if you are using the SDK in an application that shuts down.\n\n*C#*\n\n    telemetry.Flush();\n\nNote that the function is synchronous.\n\n\n\n## Disable standard telemetry\n\nYou can [disable selected parts of the standard telemetry][config] by editing `ApplicationInsights.config`. You could do this, for example, if you want to send your own TrackRequest data. \n\n[Learn more][config].\n\n\n## <a name=\"debug\"></a>Developer mode\n\nDuring debugging, it's useful to have your telemetry expedited through the pipeline so that you can see results immediately. You also get additional messages that help you trace any problems with the telemetry. Switch it off in production, as it may slow down your app.\n\n\n*C#*\n    \n    TelemetryConfiguration.Active.TelemetryChannel.DeveloperMode = true;\n\n*VB*\n\n    TelemetryConfiguration.Active.TelemetryChannel.DeveloperMode = True\n\n## TelemetryContext\n\nTelemetryClient has a Context property, which contains a number of values that are sent along with all telemetry data. They are normally set by the standard telemetry modules, but you can also set them yourself. For example:\n\n    telemetryClient.Context.Operation.Name = MyOperationName;\n\nIf you set any of these values yourself, consider removing the relevant line from [ApplicationInsights.config][config], so that your values and the standard values don't get confused.\n\n* **Component** Identifies the app and its version\n* **Device** Data about the device on which the app is running (in web apps, this is the server or client device from which the telemetry is sent)\n* **InstrumentationKey** Identifies the Application Insights resource in Azure where the telemetry will appear. Usually picked up from ApplicationInsights.config\n* **Location** Identifies the geographic location of the device.\n* **Operation** In web apps, the current HTTP request. In other app types, you can set this to group events together.\n * **Id**: A generated value that correlates different events, so that when you inspect any event in Diagnostic Search, you can find \"Related items\"\n * **Name**: An identifier, usually the URL of the HTTP request. \n * **SyntheticSource**: If not null or empty, this string indicates that the source of the request has been identified as a robot or web test. By default it will be excluded from calculations in Metrics Explorer.\n* **Properties** Properties that are sent with all telemetry data. Can be overridden in individual Track* calls.\n* **Session** Identifies the user's session. The Id is set to a generated value, which is changed when the user has not been active for a while.\n* **User** User information. \n\n\n## <a name=\"default-properties\"></a>Context initializers - Set default properties for all telemetry\n\nYou can set up a universal initializer so that all new TelemetryClients automatically use your context. This includes standard telemetry sent by the platform-specific telemetry modules, such as web server request tracking.\n\nA typical use is to identify telemetry coming from different versions or components of your app. In the portal, you can filter or group results by the \"Application Version\" property.\n\nIn general, [we recommend that you use telemetry initializers rather than context initializers](http://apmtips.com/blog/2015/06/09/do-not-use-context-initializers/).\n\n#### Define a context initializer\n\n\n*C#*\n\n```C#\n\n    using System;\n    using Microsoft.ApplicationInsights.Channel;\n    using Microsoft.ApplicationInsights.DataContracts;\n    using Microsoft.ApplicationInsights.Extensibility;\n\n    namespace MyNamespace\n    {\n      // Context initializer class\n      public class MyContextInitializer : IContextInitializer\n      {\n        public void Initialize (TelemetryContext context)\n        {\n            if (context == null) return;\n\n            context.Component.Version = \"v2.1\";\n        }\n      }\n    }\n```\n\n*Java*\n\n```Java\n\n    import com.microsoft.applicationinsights.extensibility.ContextInitializer;\n    import com.microsoft.applicationinsights.telemetry.TelemetryContext;\n\n    public class MyContextInitializer implements ContextInitializer {\n      @Override\n      public void initialize(TelemetryContext context) {\n        context.Component.Version = \"2.1\";\n      }\n    }\n```\n\n#### Load your context initializer\n\nIn ApplicationInsights.config:\n\n    <ApplicationInsights>\n      <ContextInitializers>\n        <!-- Fully qualified type name, assembly name: -->\n        <Add Type=\"MyNamespace.MyContextInitializer, MyAssemblyName\"/> \n        ...\n      </ContextInitializers>\n    </ApplicationInsights>\n\n*Alternatively,* you can instantiate the initializer in code:\n\n*C#*\n\n```C#\n\n    protected void Application_Start()\n    {\n        // ...\n        TelemetryConfiguration.Active.ContextInitializers\n        .Add(new MyContextInitializer());\n    }\n```\n\n*Java*\n\n```Java\n\n    // load the context initializer\n    TelemetryConfiguration.getActive().getContextInitializers().add(new MyContextInitializer());\n```\n\n\n\n\n## Limits\n\nThere are some limits on the number of metrics and events per application.\n\n1. Up to 500 telemetry data points per second per instrumentation key (that is, per application). This includes both the standard telemetry sent by the SDK modules, and custom events, metrics and other telemetry sent by your code.\n1.  Maximum of 200 unique metric names and 200 unique property names for your application. Metrics include data send via TrackMetric as well as measurements on other  data types such as Events.  Metrics and property names are global per instrumentation key, not scoped to data type.\n2.  Properties can be used for filtering and group-by only while they have less than 100 unique values for each property. After the unique values exceed 100, the property can still be used for search and filtering but no longer for filters.\n3.  Standard properties such as Request Name and Page URL are limited to 1000 unique values per week. After 1000 unique values, additional values are marked as \"Other values\". The original value can still be used for full text search and filtering.\n\n* *Q: How long is data kept?*\n\n    See [Data retention and privacy][data].\n\n\n## Reference docs\n\n* [ASP.NET reference](https://msdn.microsoft.com/library/dn817570.aspx)\n* [Java reference](http://dl.windowsazure.com/applicationinsights/javadoc/)\n* [JavaScript reference](https://github.com/Microsoft/ApplicationInsights-JS/blob/master/API-reference.md)\n* [Android SDK](https://github.com/Microsoft/ApplicationInsights-Android)\n* [iOS SDK](https://github.com/Microsoft/ApplicationInsights-iOS)\n\n\n## SDK Code\n\n* [ASP.NET Core SDK](https://github.com/Microsoft/ApplicationInsights-dotnet)\n* [ASP.NET 5](https://github.com/Microsoft/ApplicationInsights-aspnet5)\n* [Android SDK](https://github.com/Microsoft/ApplicationInsights-Android)\n* [Java SDK](https://github.com/Microsoft/ApplicationInsights-Java)\n* [JavaScript SDK](https://github.com/Microsoft/ApplicationInsights-JS)\n* [iOS SDK](https://github.com/Microsoft/ApplicationInsights-iOS)\n* [All platforms](https://github.com/Microsoft?utf8=%E2%9C%93&query=applicationInsights)\n\n## Questions\n\n* *What exceptions might Track_() calls throw?*\n    \n    None. You don't need to wrap them in try-catch clauses. If the SDK encounters problems, it will log messages that you will see in the debug console output, and - if the messages get through - in diagnostic search.\n\n\n\n* *Is there a REST API?*\n\n    Yes, but we aren't publishing it yet.\n\n## <a name=\"next\"></a>Next steps\n\n\n[Search events and logs][diagnostic]\n\n[Samples and walkthroughs](app-insights-code-samples.md)\n\n[Troubleshooting][qna]\n\n\n<!--Link references-->\n\n[client]: app-insights-javascript.md\n[config]: app-insights-configuration-with-applicationinsights-config.md\n[create]: app-insights-create-new-resource.md\n[data]: app-insights-data-retention-privacy.md\n[diagnostic]: app-insights-diagnostic-search.md\n[exceptions]: app-insights-asp-net-exceptions.md\n[greenbrown]: app-insights-start-monitoring-app-health-usage.md\n[java]: app-insights-java-get-started.md\n[metrics]: app-insights-metrics-explorer.md\n[qna]: app-insights-troubleshoot-faq.md\n[trace]: app-insights-search-diagnostic-logs.md\n[windows]: app-insights-windows-get-started.md\n\n \ntest\n"
}