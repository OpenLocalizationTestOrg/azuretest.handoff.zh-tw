{
  "nodes": [
    {
      "content": "Add push notifications to your Mobile Services app (Xamarin.Forms) - Mobile Services",
      "pos": [
        28,
        112
      ]
    },
    {
      "content": "Learn how to use push notifications in Xamarin.Forms apps with Azure Mobile Services.",
      "pos": [
        131,
        216
      ]
    },
    {
      "content": "Add push notifications to your Xamarin.Forms app",
      "pos": [
        546,
        594
      ]
    },
    {
      "content": "Overview",
      "pos": [
        719,
        727
      ]
    },
    {
      "content": "This tutorial shows you how to use Azure Mobile Services to send push notifications to the iOS, Android, and Windows Phone app of your Xamarin.Forms solution.",
      "pos": [
        729,
        887
      ]
    },
    {
      "content": "Start by creating a mobile service.",
      "pos": [
        888,
        923
      ]
    },
    {
      "content": "Then, you'll download a starter sample, register with the appropriate push notification services, and add code to the solution to receive notifications from those services.",
      "pos": [
        924,
        1096
      ]
    },
    {
      "content": "When you complete this tutorial, your mobile service will send a push notification each time a user adds a task in one of the apps.",
      "pos": [
        1099,
        1230
      ]
    },
    {
      "content": "You can find the completed sample here: <bpt id=\"p1\">[</bpt><ept id=\"p1\">Completed Xamarin.Forms Azure Push Notification Sample]</ept>.",
      "pos": [
        1231,
        1328
      ]
    },
    {
      "content": "This tutorial requires the following:",
      "pos": [
        1330,
        1367
      ]
    },
    {
      "content": "An iOS 8 device (you cannot test push notifications in the iOS Simulator)",
      "pos": [
        1371,
        1444
      ]
    },
    {
      "content": "iOS Developer Program membership",
      "pos": [
        1447,
        1479
      ]
    },
    {
      "content": "Xamarin.iOS Studio",
      "pos": [
        1483,
        1501
      ]
    },
    {
      "content": "Azure Mobile Services Component",
      "pos": [
        1506,
        1537
      ]
    },
    {
      "content": "An active Google account",
      "pos": [
        1541,
        1565
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt><ept id=\"p1\">Google Cloud Messaging Client Component]</ept>.",
      "pos": [
        1568,
        1610
      ]
    },
    {
      "content": "You will add this component during the tutorial.",
      "pos": [
        1611,
        1659
      ]
    },
    {
      "content": "In this topic:",
      "pos": [
        1661,
        1675
      ]
    },
    {
      "content": "Create a New Mobile Service",
      "pos": [
        1681,
        1708
      ]
    },
    {
      "content": "Download and Configure the Starter Sample",
      "pos": [
        1731,
        1772
      ]
    },
    {
      "content": "Add push notifications to your Xamarin.Forms.iOS app",
      "pos": [
        1804,
        1856
      ]
    },
    {
      "content": "Add push notifications to your Xamarin.Forms.Android app",
      "pos": [
        1868,
        1924
      ]
    },
    {
      "content": "Add push notifications to your Xamarin.Forms.Windows app",
      "pos": [
        1940,
        1996
      ]
    },
    {
      "content": "Update Azure table insert script to send push notifications to all apps",
      "pos": [
        2012,
        2083
      ]
    },
    {
      "pos": [
        2100,
        2156
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"create-service\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Create a New Mobile Service"
    },
    {
      "content": "To be able to store app data in the new mobile service, you must first create a new table.",
      "pos": [
        2276,
        2366
      ]
    },
    {
      "pos": [
        2373,
        2482
      ],
      "content": "In the Management Portal, click <bpt id=\"p1\">**</bpt>Mobile Services<ept id=\"p1\">**</ept>, and then click the mobile service that you just created."
    },
    {
      "pos": [
        2487,
        2534
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Data<ept id=\"p1\">**</ept> tab, then click <bpt id=\"p2\">**</bpt>+Create<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        2554,
        2600
      ],
      "content": "This displays the <bpt id=\"p1\">**</bpt>Create new table<ept id=\"p1\">**</ept> dialog."
    },
    {
      "pos": [
        2605,
        2668
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Table name<ept id=\"p1\">**</ept> type <bpt id=\"p2\">_</bpt>TodoItem<ept id=\"p2\">_</ept>, then click the check button."
    },
    {
      "pos": [
        2688,
        2845
      ],
      "content": "This creates a new storage table <bpt id=\"p1\">**</bpt>TodoItem<ept id=\"p1\">**</ept> with the default permissions set, which means that any user of the app can access and change data in the table."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The same table name is used in Mobile Services quickstart.",
      "pos": [
        2854,
        2925
      ]
    },
    {
      "content": "However, each table is created in a schema that is specific to a given mobile service.",
      "pos": [
        2926,
        3012
      ]
    },
    {
      "content": "This is to prevent data collisions when multiple mobile services use the same database.",
      "pos": [
        3013,
        3100
      ]
    },
    {
      "pos": [
        3105,
        3177
      ],
      "content": "Click the new <bpt id=\"p1\">**</bpt>TodoItem<ept id=\"p1\">**</ept> table and verify that there are no data rows."
    },
    {
      "pos": [
        3182,
        3301
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Columns<ept id=\"p1\">**</ept> tab and verify that there is only a single <bpt id=\"p2\">**</bpt>id<ept id=\"p2\">**</ept> column, which is automatically created for you."
    },
    {
      "content": "This is the minimum requirement for a table in Mobile Services.",
      "pos": [
        3307,
        3370
      ]
    },
    {
      "pos": [
        3379,
        3567
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> When dynamic schema is enabled on your mobile service, new columns are created automatically when JSON objects are sent to the mobile service by an insert or update operation."
    },
    {
      "content": "You are now ready to use the new mobile service as data storage for the app.",
      "pos": [
        3569,
        3645
      ]
    },
    {
      "pos": [
        3650,
        3729
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"download-starter-sample\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Download and Configure the Starter Sample"
    },
    {
      "content": "We'll add push notifications to an existing sample.",
      "pos": [
        3730,
        3781
      ]
    },
    {
      "pos": [
        3788,
        3874
      ],
      "content": "Download the following sample: <bpt id=\"p1\">[</bpt><ept id=\"p1\">Xamarin.Forms Azure Push Notification Starter Sample]</ept>."
    },
    {
      "content": "In the Management Portal, click <bpt id=\"p1\">**</bpt>Mobile Services<ept id=\"p1\">**</ept>, and then click the mobile service.",
      "pos": [
        3879,
        3966
      ]
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Dashboard<ept id=\"p1\">**</ept> tab and make a note of the <bpt id=\"p2\">**</bpt>Site URL<ept id=\"p2\">**</ept>.",
      "pos": [
        3967,
        4031
      ]
    },
    {
      "content": "Then click <bpt id=\"p1\">**</bpt>Manage Keys<ept id=\"p1\">**</ept> and make a note of the <bpt id=\"p2\">**</bpt>Application Key<ept id=\"p2\">**</ept>.",
      "pos": [
        4032,
        4102
      ]
    },
    {
      "content": "You'll need these values when you access the mobile service from your app code.",
      "pos": [
        4103,
        4182
      ]
    },
    {
      "pos": [
        4187,
        4394
      ],
      "content": "In the  <bpt id=\"p1\">**</bpt>ToDoAzure(Portable)<ept id=\"p1\">**</ept> project of the solution, open the <bpt id=\"p2\">**</bpt>Constants.cs<ept id=\"p2\">**</ept> file, replace <ph id=\"ph1\">`ApplicationURL`</ph> and <ph id=\"ph2\">`ApplicationKey`</ph> with the site URL and application key you obtained in the previous step."
    },
    {
      "pos": [
        4399,
        4469
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"iOS\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add push notifications to your Xamarin.Forms.iOS app"
    },
    {
      "content": "You'll add push notifications to the iOS app by using the Apple Push Notification service (APNS).",
      "pos": [
        4471,
        4568
      ]
    },
    {
      "content": "You'll need an active Google account, and the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Google Cloud Messaging Client Component]</ept>.",
      "pos": [
        4569,
        4657
      ]
    },
    {
      "pos": [
        4660,
        4855
      ],
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> Because of Apple Push Notification service (APNS) requirements, you must deploy and test push notifications on an iOS capable device (iPhone or iPad) instead of in the emulator."
    },
    {
      "content": "APNS uses certificates to authenticate your mobile service.",
      "pos": [
        4857,
        4916
      ]
    },
    {
      "content": "Follow these instructions to create the necessary certificates and upload it to your Mobile Service.",
      "pos": [
        4917,
        5017
      ]
    },
    {
      "content": "For the official APNS feature documentation, see <bpt id=\"p1\">[</bpt><ept id=\"p1\">Apple Push Notification Service]</ept>.",
      "pos": [
        5018,
        5101
      ]
    },
    {
      "pos": [
        5107,
        5179
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"certificates\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Generate the Certificate Signing Request file"
    },
    {
      "content": "First you must generate the Certificate Signing Request (CSR) file, which is used by Apple to generate a signed certificate.",
      "pos": [
        5181,
        5305
      ]
    },
    {
      "pos": [
        5310,
        5359
      ],
      "content": "From Utilities, run the <bpt id=\"p1\">**</bpt>Keychain Access tool<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        5364,
        5494
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Keychain Access<ept id=\"p1\">**</ept>, expand <bpt id=\"p2\">**</bpt>Certificate Assistant<ept id=\"p2\">**</ept>, then click <bpt id=\"p3\">**</bpt>Request a Certificate from a Certificate Authority...<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        5511,
        5653
      ],
      "content": "Enter your <bpt id=\"p1\">**</bpt>User Email Address<ept id=\"p1\">**</ept>, type in a <bpt id=\"p2\">**</bpt>Common Name<ept id=\"p2\">**</ept> value, make sure that <bpt id=\"p3\">**</bpt>Saved to disk<ept id=\"p3\">**</ept> is selected, and then click <bpt id=\"p4\">**</bpt>Continue<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        5670,
        5799
      ],
      "content": "Type a name for the Certificate Signing Request (CSR) file in <bpt id=\"p1\">**</bpt>Save As<ept id=\"p1\">**</ept>, select the location in <bpt id=\"p2\">**</bpt>Where<ept id=\"p2\">**</ept>, then click <bpt id=\"p3\">**</bpt>Save<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Remember the location you chose.",
      "pos": [
        5817,
        5849
      ]
    },
    {
      "content": "Next, you will register your app with Apple, enable push notifications, and upload this exported CSR to create a push certificate.",
      "pos": [
        5851,
        5981
      ]
    },
    {
      "pos": [
        5987,
        6050
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"register\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Register your app for push notifications"
    },
    {
      "content": "To be able to send push notifications to an iOS app from mobile services, you must register your application with Apple and register for push notifications.",
      "pos": [
        6052,
        6208
      ]
    },
    {
      "pos": [
        6213,
        6550
      ],
      "content": "If you have not already registered your app, navigate to the <ph id=\"ph1\">&lt;a href=\"http://go.microsoft.com/fwlink/p/?LinkId=272456\" target=\"_blank\"&gt;</ph>iOS Provisioning Portal<ph id=\"ph2\">&lt;/a&gt;</ph> at the Apple Developer Center, log on with your Apple ID, click <bpt id=\"p1\">**</bpt>Identifiers<ept id=\"p1\">**</ept>, then click <bpt id=\"p2\">**</bpt>App IDs<ept id=\"p2\">**</ept>, and finally click on the <bpt id=\"p3\">**</bpt>+<ept id=\"p3\">**</ept> sign to create an app ID for your app."
    },
    {
      "content": "Type a name for your app in <bpt id=\"p1\">**</bpt>Description<ept id=\"p1\">**</ept>, enter and remember the unique <bpt id=\"p2\">**</bpt>Bundle Identifier<ept id=\"p2\">**</ept>, check the \"Push Notifications\" option in the \"App Services\" section, and then click <bpt id=\"p3\">**</bpt>Continue<ept id=\"p3\">**</ept>.",
      "pos": [
        6569,
        6764
      ]
    },
    {
      "content": "This example uses the ID <bpt id=\"p1\">**</bpt>MobileServices.Quickstart<ept id=\"p1\">**</ept> but you may not reuse this same ID, as app IDs must be unique across all users.",
      "pos": [
        6765,
        6899
      ]
    },
    {
      "content": "As such, it is recommended that you append your full name or initials after the app name.",
      "pos": [
        6900,
        6989
      ]
    },
    {
      "content": "This generates your app ID and requests you to <bpt id=\"p1\">**</bpt>Submit<ept id=\"p1\">**</ept> the information.",
      "pos": [
        7009,
        7083
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Submit<ept id=\"p1\">**</ept>.",
      "pos": [
        7084,
        7101
      ]
    },
    {
      "content": "Once you click <bpt id=\"p1\">**</bpt>Submit<ept id=\"p1\">**</ept>, you will see the <bpt id=\"p2\">**</bpt>Registration complete<ept id=\"p2\">**</ept> screen, as shown below.",
      "pos": [
        7121,
        7214
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Done<ept id=\"p1\">**</ept>.",
      "pos": [
        7215,
        7230
      ]
    },
    {
      "content": "Locate the app ID that you just created, and click on its row.",
      "pos": [
        7249,
        7311
      ]
    },
    {
      "content": "Clicking on the app ID will display details on the app and app ID.",
      "pos": [
        7331,
        7397
      ]
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> button.",
      "pos": [
        7398,
        7428
      ]
    },
    {
      "pos": [
        7447,
        7585
      ],
      "content": "Scroll to the bottom of the screen, and click the <bpt id=\"p1\">**</bpt>Create Certificate...<ept id=\"p1\">**</ept> button under the section <bpt id=\"p2\">**</bpt>Development Push SSL Certificate<ept id=\"p2\">**</ept>."
    },
    {
      "content": "This displays the \"Add iOS Certificate\" assistant.",
      "pos": [
        7605,
        7655
      ]
    },
    {
      "content": "Note: This tutorial uses a development certificate.",
      "pos": [
        7661,
        7712
      ]
    },
    {
      "content": "The same process is used when registering a production certificate.",
      "pos": [
        7713,
        7780
      ]
    },
    {
      "content": "Just make sure that you set the same certificate type when you upload the certificate to Mobile Services.",
      "pos": [
        7781,
        7886
      ]
    },
    {
      "pos": [
        7891,
        7999
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Choose File<ept id=\"p1\">**</ept>, browse to the location where you saved the CSR file earlier, then click <bpt id=\"p2\">**</bpt>Generate<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        8018,
        8116
      ],
      "content": "After the certificate is created by the portal, click the <bpt id=\"p1\">**</bpt>Download<ept id=\"p1\">**</ept> button, and click <bpt id=\"p2\">**</bpt>Done<ept id=\"p2\">**</ept>."
    },
    {
      "content": "This downloads the signing certificate and saves it to your computer in your Downloads folder.",
      "pos": [
        8138,
        8232
      ]
    },
    {
      "pos": [
        8250,
        8360
      ],
      "content": "Note: By default, the downloaded file a development certificate is named <ph id=\"ph1\">&lt;strong&gt;</ph>aps_development.cer<ph id=\"ph2\">&lt;/strong&gt;</ph>."
    },
    {
      "pos": [
        8365,
        8434
      ],
      "content": "Double-click the downloaded push certificate <bpt id=\"p1\">**</bpt>aps_development.cer<ept id=\"p1\">**</ept>."
    },
    {
      "content": "This installs the new certificate in the Keychain, as shown below:",
      "pos": [
        8440,
        8506
      ]
    },
    {
      "pos": [
        8525,
        8676
      ],
      "content": "Note: The name in your certificate might be different, but it will be prefixed with <ph id=\"ph1\">&lt;strong&gt;</ph>Apple Development iOS Push Notification Services:<ph id=\"ph2\">&lt;/strong&gt;</ph>."
    },
    {
      "content": "Later, you will use this certificate to generate a .p12 file and upload it to Mobile Services to enable authentication with APNS.",
      "pos": [
        8678,
        8807
      ]
    },
    {
      "pos": [
        8813,
        8876
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"profile\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Create a provisioning profile for the app"
    },
    {
      "content": "Back in the <ph id=\"ph1\">&lt;a href=\"http://go.microsoft.com/fwlink/p/?LinkId=272456\" target=\"_blank\"&gt;</ph>iOS Provisioning Portal<ph id=\"ph2\">&lt;/a&gt;</ph>, select <bpt id=\"p1\">**</bpt>Provisioning Profiles<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>All<ept id=\"p2\">**</ept>, and then click the <bpt id=\"p3\">**</bpt>+<ept id=\"p3\">**</ept> button to create a new profile.",
      "pos": [
        8881,
        9102
      ]
    },
    {
      "content": "This launches the <bpt id=\"p1\">**</bpt>Add iOS Provisiong Profile<ept id=\"p1\">**</ept> Wizard.",
      "pos": [
        9103,
        9159
      ]
    },
    {
      "pos": [
        9178,
        9286
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>iOS App Development<ept id=\"p1\">**</ept> under <bpt id=\"p2\">**</bpt>Development<ept id=\"p2\">**</ept> as the provisiong profile type, and click <bpt id=\"p3\">**</bpt>Continue<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        9291,
        9413
      ],
      "content": "Next, select the app ID for the Mobile Services Quickstart app from the <bpt id=\"p1\">**</bpt>App ID<ept id=\"p1\">**</ept> drop-down list, and click <bpt id=\"p2\">**</bpt>Continue<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        9432,
        9534
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Select certificates<ept id=\"p1\">**</ept> screen, select the certificate created earlier, and click <bpt id=\"p2\">**</bpt>Continue<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        9553,
        9625
      ],
      "content": "Next, select the <bpt id=\"p1\">**</bpt>Devices<ept id=\"p1\">**</ept> to use for testing, and click <bpt id=\"p2\">**</bpt>Continue<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        9644,
        9741
      ],
      "content": "Finally, pick a name for the profile in <bpt id=\"p1\">**</bpt>Profile Name<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Generate<ept id=\"p2\">**</ept>, and click <bpt id=\"p3\">**</bpt>Done<ept id=\"p3\">**</ept>."
    },
    {
      "content": "This creates a new provisioning profile.",
      "pos": [
        9761,
        9801
      ]
    },
    {
      "pos": [
        9820,
        10023
      ],
      "content": "In Xcode, open the Organizer select the Devices view, select <bpt id=\"p1\">**</bpt>Provisioning Profiles<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Library<ept id=\"p2\">**</ept> section in the left pane, and then click the <bpt id=\"p3\">**</bpt>Refresh<ept id=\"p3\">**</ept> button at the bottom of the middle pane."
    },
    {
      "pos": [
        10029,
        10115
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"configure-mobileServices\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Configure Mobile Services to send push requests"
    },
    {
      "content": "After you have registered your app with APNS and configured your project, you must next configure your mobile service to integrate with APNS.",
      "pos": [
        10117,
        10258
      ]
    },
    {
      "pos": [
        10263,
        10398
      ],
      "content": "In Keychain Access, right-click the new certificate, click <bpt id=\"p1\">**</bpt>Export<ept id=\"p1\">**</ept>, name your file, select the <bpt id=\"p2\">**</bpt>.p12<ept id=\"p2\">**</ept> format, then click <bpt id=\"p3\">**</bpt>Save<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Make a note of the file name and location of the exported certificate.",
      "pos": [
        10417,
        10487
      ]
    },
    {
      "pos": [
        10492,
        10584
      ],
      "content": "Log on to the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Management Portal]</ept>, click <bpt id=\"p2\">**</bpt>Mobile Services<ept id=\"p2\">**</ept>, and then click your app."
    },
    {
      "pos": [
        10602,
        10689
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Push<ept id=\"p1\">**</ept> tab and click <bpt id=\"p2\">**</bpt>Upload<ept id=\"p2\">**</ept> under <bpt id=\"p3\">**</bpt>apple push notification settings<ept id=\"p3\">**</ept>."
    },
    {
      "content": "This displays the Upload Certificate dialog.",
      "pos": [
        10708,
        10752
      ]
    },
    {
      "pos": [
        10757,
        10931
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, select the exported certificate .p12 file, enter the <bpt id=\"p2\">**</bpt>Password<ept id=\"p2\">**</ept>, make sure that the correct <bpt id=\"p3\">**</bpt>Mode<ept id=\"p3\">**</ept> is selected, click the check icon, then click <bpt id=\"p4\">**</bpt>Save<ept id=\"p4\">**</ept>."
    },
    {
      "content": "Your mobile service is now configured to work with APNS.",
      "pos": [
        10946,
        11002
      ]
    },
    {
      "pos": [
        11008,
        11074
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"configure-app\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Configure your Xamarin.iOS application"
    },
    {
      "pos": [
        11079,
        11205
      ],
      "content": "In Xamarin.Studio or Visual Studio, open <bpt id=\"p1\">**</bpt>Info.plist<ept id=\"p1\">**</ept>, and update the <bpt id=\"p2\">**</bpt>Bundle Identifier<ept id=\"p2\">**</ept> with the ID you created earlier."
    },
    {
      "pos": [
        11224,
        11343
      ],
      "content": "Scroll down to <bpt id=\"p1\">**</bpt>Background Modes<ept id=\"p1\">**</ept> and check the <bpt id=\"p2\">**</bpt>Enable Background Modes<ept id=\"p2\">**</ept> box and the <bpt id=\"p3\">**</bpt>Remote notifications<ept id=\"p3\">**</ept> box."
    },
    {
      "pos": [
        11362,
        11438
      ],
      "content": "Double click your project in the Solution Panel to open <bpt id=\"p1\">**</bpt>Project Options<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        11444,
        11599
      ],
      "content": "Choose <bpt id=\"p1\">**</bpt>iOS Bundle Signing<ept id=\"p1\">**</ept> under <bpt id=\"p2\">**</bpt>Build<ept id=\"p2\">**</ept>, and select the corresponding <bpt id=\"p3\">**</bpt>Identity<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>Provisioning profile<ept id=\"p4\">**</ept> you had just set up for this project."
    },
    {
      "content": "This ensures that the Xamarin project uses the new profile for code signing.",
      "pos": [
        11619,
        11695
      ]
    },
    {
      "content": "For the official Xamarin device provisioning documentation, see <bpt id=\"p1\">[</bpt><ept id=\"p1\">Xamarin Device Provisioning]</ept>.",
      "pos": [
        11696,
        11790
      ]
    },
    {
      "pos": [
        11796,
        11853
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"add-push\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add push notifications to your app"
    },
    {
      "pos": [
        11858,
        12037
      ],
      "content": "In Xamarin.Studio or Visual Studio, expand the <bpt id=\"p1\">**</bpt>ToDoAzure.iOS<ept id=\"p1\">**</ept> project, open the <bpt id=\"p2\">**</bpt>AppDelegate<ept id=\"p2\">**</ept> class, and then replace the <bpt id=\"p3\">**</bpt>FinishedLaunching<ept id=\"p3\">**</ept> event with the following code:"
    },
    {
      "pos": [
        12951,
        13027
      ],
      "content": "In <bpt id=\"p1\">**</bpt>AppDelegate<ept id=\"p1\">**</ept>, override the <bpt id=\"p2\">**</bpt>RegisteredForRemoteNotifications<ept id=\"p2\">**</ept> event:"
    },
    {
      "pos": [
        13942,
        14012
      ],
      "content": "In <bpt id=\"p1\">**</bpt>AppDelegate<ept id=\"p1\">**</ept>, override the <bpt id=\"p2\">**</bpt>ReceivedRemoteNotification<ept id=\"p2\">**</ept> event:"
    },
    {
      "content": "Your app is now updated to support push notifications.",
      "pos": [
        14471,
        14525
      ]
    },
    {
      "pos": [
        14531,
        14620
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"update-scripts\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Update the registered insert script in the Management Portal"
    },
    {
      "pos": [
        14625,
        14712
      ],
      "content": "In the Management Portal, click the <bpt id=\"p1\">**</bpt>Data<ept id=\"p1\">**</ept> tab and then click the <bpt id=\"p2\">**</bpt>TodoItem<ept id=\"p2\">**</ept> table."
    },
    {
      "pos": [
        14730,
        14794
      ],
      "content": "In <bpt id=\"p1\">**</bpt>todoitem<ept id=\"p1\">**</ept>, click the <bpt id=\"p2\">**</bpt>Script<ept id=\"p2\">**</ept> tab and select <bpt id=\"p3\">**</bpt>Insert<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        14813,
        14904
      ],
      "content": "This displays the function that is invoked when an insert occurs in the <bpt id=\"p1\">**</bpt>TodoItem<ept id=\"p1\">**</ept> table."
    },
    {
      "pos": [
        14909,
        14986
      ],
      "content": "Replace the insert function with the following code, and then click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>:"
    },
    {
      "content": "This registers a new insert script, which sends a push notification (the inserted text) to the device provided in the insert request.",
      "pos": [
        16097,
        16230
      ]
    },
    {
      "pos": [
        16236,
        16359
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> This script delays sending the notification to give you time to close the app to receive a toast notification."
    },
    {
      "pos": [
        16365,
        16419
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"test\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Test push notifications in your app"
    },
    {
      "pos": [
        16424,
        16560
      ],
      "content": "Press the <bpt id=\"p1\">**</bpt>Run<ept id=\"p1\">**</ept> button to build the project and start the app in an iOS capable device, then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept> to accept push notifications"
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You must explicitly accept push notifications from your app.",
      "pos": [
        16566,
        16639
      ]
    },
    {
      "content": "This request only occurs the first time that the app runs.",
      "pos": [
        16640,
        16698
      ]
    },
    {
      "pos": [
        16703,
        16793
      ],
      "content": "In the app, click the <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> button, add a task title and then click the <bpt id=\"p2\">**</bpt>Save<ept id=\"p2\">**</ept> button."
    },
    {
      "pos": [
        16799,
        16885
      ],
      "content": "Verify that a notification is received, then click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to dismiss the notification."
    },
    {
      "content": "You have successfully completed this tutorial.",
      "pos": [
        16888,
        16934
      ]
    },
    {
      "pos": [
        16939,
        17016
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"Android\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add push notifications to the Xamarin.Forms.Android app"
    },
    {
      "content": "You'll add push notifications to the Android app by using the Google Cloud Messaging (GCM) service.",
      "pos": [
        17018,
        17117
      ]
    },
    {
      "content": "You'll need an active Google account, and the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Google Cloud Messaging Client Component]</ept>.",
      "pos": [
        17118,
        17206
      ]
    },
    {
      "pos": [
        17211,
        17261
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"register\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Enable Google Cloud Messaging"
    },
    {
      "pos": [
        17396,
        17469
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"configure\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Configure your mobile service to send push requests"
    },
    {
      "pos": [
        17590,
        17674
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"update-scripts\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Update the registered insert script to send notifications"
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The following steps show you how to update the script registered to the insert operation on the TodoItem table in the Azure Management Portal.",
      "pos": [
        17677,
        17832
      ]
    },
    {
      "content": "You can also access and edit this mobile service script directly in Visual Studio, in the Azure node of Server Explorer.",
      "pos": [
        17833,
        17953
      ]
    },
    {
      "pos": [
        17956,
        18043
      ],
      "content": "In the Management Portal, click the <bpt id=\"p1\">**</bpt>Data<ept id=\"p1\">**</ept> tab and then click the <bpt id=\"p2\">**</bpt>TodoItem<ept id=\"p2\">**</ept> table."
    },
    {
      "pos": [
        18060,
        18124
      ],
      "content": "In <bpt id=\"p1\">**</bpt>todoitem<ept id=\"p1\">**</ept>, click the <bpt id=\"p2\">**</bpt>Script<ept id=\"p2\">**</ept> tab and select <bpt id=\"p3\">**</bpt>Insert<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        18142,
        18233
      ],
      "content": "This displays the function that is invoked when an insert occurs in the <bpt id=\"p1\">**</bpt>TodoItem<ept id=\"p1\">**</ept> table."
    },
    {
      "pos": [
        18238,
        18315
      ],
      "content": "Replace the insert function with the following code, and then click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>:"
    },
    {
      "content": "This registers a new insert script, which sends a push notification (the inserted text) to the device provided in the insert request.",
      "pos": [
        19427,
        19560
      ]
    },
    {
      "pos": [
        19566,
        19689
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> This script delays sending the notification to give you time to close the app to receive a toast notification."
    },
    {
      "pos": [
        19695,
        19774
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"configure-app\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Configure the existing project for push notifications"
    },
    {
      "pos": [
        19779,
        19923
      ],
      "content": "In the Solution view, expand the <bpt id=\"p1\">**</bpt>Components<ept id=\"p1\">**</ept> folder in the Xamarin.Android app and make sure that Azure Mobile Services package is installed."
    },
    {
      "pos": [
        19929,
        20088
      ],
      "content": "Right-click the <bpt id=\"p1\">**</bpt>Components<ept id=\"p1\">**</ept> folder, click  <bpt id=\"p2\">**</bpt>Get More Components...<ept id=\"p2\">**</ept>, search for the <bpt id=\"p3\">**</bpt>Google Cloud Messaging Client<ept id=\"p3\">**</ept> component and add it to the project."
    },
    {
      "content": "Open the MainActivity.cs project file and add the following using statement to the class:",
      "pos": [
        20094,
        20183
      ]
    },
    {
      "pos": [
        20217,
        20348
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>MainActivity<ept id=\"p1\">**</ept> class, add the following code to the <bpt id=\"p2\">**</bpt>OnCreate<ept id=\"p2\">**</ept> method, after the call to the <bpt id=\"p3\">**</bpt>LoadApplication<ept id=\"p3\">**</ept> method:"
    },
    {
      "pos": [
        21079,
        21147
      ],
      "content": "Your <bpt id=\"p1\">**</bpt>MainActivity<ept id=\"p1\">**</ept> is now prepared for adding push notifications."
    },
    {
      "pos": [
        21152,
        21212
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"add-push\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add push notifications code to your app"
    },
    {
      "pos": [
        21217,
        21303
      ],
      "content": "In the ToDoAzure.Droid project, create a new class in the project called <ph id=\"ph1\">`GcmService`</ph>."
    },
    {
      "pos": [
        21308,
        21367
      ],
      "content": "Add the following using statements to <bpt id=\"p1\">**</bpt>GcmService<ept id=\"p1\">**</ept> class:"
    },
    {
      "pos": [
        21452,
        21557
      ],
      "content": "Add the following permission requests between the <bpt id=\"p1\">**</bpt>using<ept id=\"p1\">**</ept> statements and the <bpt id=\"p2\">**</bpt>namespace<ept id=\"p2\">**</ept> declaration:"
    },
    {
      "pos": [
        22113,
        22176
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>GcmService.cs<ept id=\"p1\">**</ept> project file, add the following class:"
    },
    {
      "pos": [
        22897,
        23058
      ],
      "content": "In the above code, you must replace <bpt id=\"p1\">_</bpt><ph id=\"ph1\">`&lt;PROJECT_NUMBER&gt;`</ph><ept id=\"p1\">_</ept> with the project number assigned by Google when you provisioned your app in the Google developer portal."
    },
    {
      "pos": [
        23064,
        23160
      ],
      "content": "In the GcmService.cs project file, add the following code that defines the <bpt id=\"p1\">**</bpt>GcmService<ept id=\"p1\">**</ept> class:"
    },
    {
      "pos": [
        23432,
        23550
      ],
      "content": "Note that this class derives from <bpt id=\"p1\">**</bpt>GcmServiceBase<ept id=\"p1\">**</ept> and that the <bpt id=\"p2\">**</bpt>Service<ept id=\"p2\">**</ept> attribute must be applied to this class."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>The <bpt id=\"p1\">**</bpt>GcmServiceBase<ept id=\"p1\">**</ept> class implements the <bpt id=\"p2\">**</bpt>OnRegistered()<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>OnUnRegistered()<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>OnMessage()<ept id=\"p4\">**</ept> and <bpt id=\"p5\">**</bpt>OnError()<ept id=\"p5\">**</ept> methods.",
      "pos": [
        23557,
        23697
      ]
    },
    {
      "content": "You must override these methods in the <bpt id=\"p1\">**</bpt>GcmService<ept id=\"p1\">**</ept> class.",
      "pos": [
        23698,
        23758
      ]
    },
    {
      "pos": [
        23763,
        23864
      ],
      "content": "Add the following code to the <bpt id=\"p1\">**</bpt>GcmService<ept id=\"p1\">**</ept> class that overrides the <bpt id=\"p2\">**</bpt>OnRegistered<ept id=\"p2\">**</ept> event handler."
    },
    {
      "content": "This method uses the returned GCM registration ID to register with Azure for push notifications.",
      "pos": [
        24977,
        25073
      ]
    },
    {
      "pos": [
        25079,
        25155
      ],
      "content": "Override the <bpt id=\"p1\">**</bpt>OnMessage<ept id=\"p1\">**</ept> method in <bpt id=\"p2\">**</bpt>GcmService<ept id=\"p2\">**</ept> with the following code:"
    },
    {
      "pos": [
        27393,
        27518
      ],
      "content": "Add the following method overrides for <bpt id=\"p1\">**</bpt>OnUnRegistered()<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>OnError()<ept id=\"p2\">**</ept>, which are required for the project to compile."
    },
    {
      "pos": [
        27701,
        27753
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"test\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Test push notifications in your app"
    },
    {
      "content": "You can test the app by directly attaching an Android phone with a USB cable, or by using a virtual device in the emulator.",
      "pos": [
        27755,
        27878
      ]
    },
    {
      "content": "When you run this app in the emulator, make sure that you use an Android Virtual Device (AVD) that supports Google APIs.",
      "pos": [
        27880,
        28000
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.IMPORTANT]</ph> In order to receive push notifications, you must set up a Google account on your Android Virtual Device (in the emulator, navigate to <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> and click <bpt id=\"p2\">**</bpt>Add Account<ept id=\"p2\">**</ept>).",
      "pos": [
        28004,
        28196
      ]
    },
    {
      "content": "Also, make sure that the emulator is connected to the Internet.",
      "pos": [
        28197,
        28260
      ]
    },
    {
      "pos": [
        28265,
        28366
      ],
      "content": "From <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Open Android Emulator Manager<ept id=\"p2\">**</ept>, select your device, and then click <bpt id=\"p3\">**</bpt>Edit<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        28389,
        28445
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Google APIs<ept id=\"p1\">**</ept> in <bpt id=\"p2\">**</bpt>Target<ept id=\"p2\">**</ept>, then click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>."
    },
    {
      "content": "On the top toolbar, click <bpt id=\"p1\">**</bpt>Run<ept id=\"p1\">**</ept>, and then select your app.",
      "pos": [
        28468,
        28528
      ]
    },
    {
      "content": "This starts the emulator and runs the app.",
      "pos": [
        28529,
        28571
      ]
    },
    {
      "pos": [
        28575,
        28663
      ],
      "content": "The app retrieves the <bpt id=\"p1\">*</bpt>registrationId<ept id=\"p1\">*</ept> from GCM and registers with the Notification Hub."
    },
    {
      "content": "In the app, add a new task.",
      "pos": [
        28668,
        28695
      ]
    },
    {
      "content": "Swipe down from the top of the screen to open the device's Notification Center to see the notification.",
      "pos": [
        28700,
        28803
      ]
    },
    {
      "pos": [
        28822,
        28899
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"Windows\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add push notifications to the Xamarin.Forms.Windows app"
    },
    {
      "content": "This section shows you how to use Azure Mobile Services to send push notifications to the Windows Phone Silverlight app that is included in your Xamarin.Forms solution.",
      "pos": [
        28901,
        29069
      ]
    },
    {
      "pos": [
        29075,
        29143
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"update-app\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Update the app to register for notifications"
    },
    {
      "content": "Before your app can receive push notifications, you must register a notification channel.",
      "pos": [
        29145,
        29234
      ]
    },
    {
      "pos": [
        29239,
        29323
      ],
      "content": "In Visual Studio, open the file App.xaml.cs and add the following <ph id=\"ph1\">`using`</ph> statement:"
    },
    {
      "content": "Add the following to App.xaml.cs:",
      "pos": [
        29373,
        29406
      ]
    },
    {
      "content": "This code retrieves the ChannelURI for the app from the Microsoft Push Notification Service (MPNS) used by Windows Phone 8.x \"Silverlight\", and then registers that ChannelURI for push notifications.",
      "pos": [
        30525,
        30723
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>In this this tutorial, the mobile service sends a toast notification to the device.",
      "pos": [
        30730,
        30825
      ]
    },
    {
      "content": "When you send a tile notification, you must instead call the <bpt id=\"p1\">**</bpt>BindToShellTile<ept id=\"p1\">**</ept> method on the channel.",
      "pos": [
        30826,
        30929
      ]
    },
    {
      "pos": [
        30934,
        31072
      ],
      "content": "At the top of the <bpt id=\"p1\">**</bpt>Application_Launching<ept id=\"p1\">**</ept> event handler in App.xaml.cs, add the following call to the new <bpt id=\"p2\">**</bpt>AcquirePushChannel<ept id=\"p2\">**</ept> method:"
    },
    {
      "content": "This makes sure that registration is requested every time that the page is loaded.",
      "pos": [
        31109,
        31191
      ]
    },
    {
      "content": "In your app, you may only want to make this registration periodically to ensure that the registration is current.",
      "pos": [
        31192,
        31305
      ]
    },
    {
      "content": "Press the <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> key to run the app.",
      "pos": [
        31311,
        31347
      ]
    },
    {
      "content": "A popup dialog with the registration key is displayed.",
      "pos": [
        31348,
        31402
      ]
    },
    {
      "pos": [
        31410,
        31601
      ],
      "content": "In the Solution Explorer, expand <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>, open the WMAppManifest.xml file, click the <bpt id=\"p2\">**</bpt>Capabilities<ept id=\"p2\">**</ept> tab and make sure that the <bpt id=\"p3\">**</bpt>ID___CAP___PUSH_NOTIFICATION<ept id=\"p3\">**</ept> capability is checked."
    },
    {
      "content": "Enable notifications in VS",
      "pos": [
        31609,
        31635
      ]
    },
    {
      "content": "This makes sure that your app can raise toast notifications.",
      "pos": [
        31745,
        31805
      ]
    },
    {
      "pos": [
        31811,
        31887
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"update-scripts\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Update server scripts to send push notifications"
    },
    {
      "content": "Finally, you must update the script registered to the insert operation on the TodoItem table to send notifications.",
      "pos": [
        31889,
        32004
      ]
    },
    {
      "pos": [
        32009,
        32096
      ],
      "content": "In the Management Portal, click the <bpt id=\"p1\">**</bpt>Data<ept id=\"p1\">**</ept> tab and then click the <bpt id=\"p2\">**</bpt>TodoItem<ept id=\"p2\">**</ept> table."
    },
    {
      "pos": [
        32114,
        32178
      ],
      "content": "In <bpt id=\"p1\">**</bpt>todoitem<ept id=\"p1\">**</ept>, click the <bpt id=\"p2\">**</bpt>Script<ept id=\"p2\">**</ept> tab and select <bpt id=\"p3\">**</bpt>Insert<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        32197,
        32288
      ],
      "content": "This displays the function that is invoked when an insert occurs in the <bpt id=\"p1\">**</bpt>TodoItem<ept id=\"p1\">**</ept> table."
    },
    {
      "pos": [
        32293,
        32370
      ],
      "content": "Replace the insert function with the following code, and then click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>:"
    },
    {
      "content": "This registers a new insert script, which sends a push notification (the inserted text) to the device provided in the insert request.",
      "pos": [
        33492,
        33625
      ]
    },
    {
      "pos": [
        33630,
        33727
      ],
      "content": "Click the <bpt id=\"p1\">**</bpt>Push<ept id=\"p1\">**</ept> tab, check <bpt id=\"p2\">**</bpt>Enable unauthenticated push notifications<ept id=\"p2\">**</ept>, then click <bpt id=\"p3\">**</bpt>Save<ept id=\"p3\">**</ept>."
    },
    {
      "content": "This enables the mobile service to connect to MPNS in unauthenticated mode to send push notifications.",
      "pos": [
        33733,
        33835
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>This tutorial uses MPNS in unauthenticated mode.",
      "pos": [
        33842,
        33902
      ]
    },
    {
      "content": "In this mode, MPNS limits the number of notifications that can be sent to a device channel.",
      "pos": [
        33903,
        33994
      ]
    },
    {
      "content": "To remove this restriction, you must generate and upload a certificate by clicking <bpt id=\"p1\">**</bpt>Upload<ept id=\"p1\">**</ept> and selecting the certificate.",
      "pos": [
        33995,
        34119
      ]
    },
    {
      "content": "For more information on generating the certificate, see [Setting up an authenticated web service to send push notifications for Windows Phone].",
      "pos": [
        34120,
        34263
      ]
    },
    {
      "pos": [
        34268,
        34321
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"test\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Test push notifications in your app"
    },
    {
      "content": "In Visual Studio, press the F5 key to run the app.",
      "pos": [
        34326,
        34376
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You may encounter a 401 Unauthorized RegistrationAuthorizationException when testing on the Windows Phone emulator.",
      "pos": [
        34383,
        34511
      ]
    },
    {
      "content": "This can occur during the <ph id=\"ph1\">`RegisterNativeAsync()`</ph> call because of the way the Windows Phone emulator syncs it's clock with the host PC.",
      "pos": [
        34512,
        34647
      ]
    },
    {
      "content": "It can result in a security token that will be rejected.",
      "pos": [
        34648,
        34704
      ]
    },
    {
      "content": "To resolve this simply manually set the clock in the emulator before testing.",
      "pos": [
        34705,
        34782
      ]
    },
    {
      "pos": [
        34787,
        34920
      ],
      "content": "In the app, create a new task with the title <bpt id=\"p1\">**</bpt>Hello push<ept id=\"p1\">**</ept>, then immediately click the start button or back button to leave the app."
    },
    {
      "content": "This sends an insert request to the mobile service to store the added item.",
      "pos": [
        34926,
        35001
      ]
    },
    {
      "content": "Notice that the device receives a toast notification that says <bpt id=\"p1\">**</bpt>hello push<ept id=\"p1\">**</ept>.",
      "pos": [
        35002,
        35080
      ]
    },
    {
      "content": "Toast notification received",
      "pos": [
        35088,
        35115
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph>You will not receive the notification when you are still in the app.",
      "pos": [
        35227,
        35307
      ]
    },
    {
      "content": "To receive a toast notification while the app is active, you must handle the <bpt id=\"p1\">[</bpt>ShellToastNotificationReceived<ept id=\"p1\">](http://msdn.microsoft.com/library/windowsphone/develop/microsoft.phone.notification.httpnotificationchannel.shelltoastnotificationreceived(v=vs.105).aspx)</ept> event.",
      "pos": [
        35308,
        35579
      ]
    }
  ],
  "content": " <properties\n    pageTitle=\"Add push notifications to your Mobile Services app (Xamarin.Forms) - Mobile Services\"\n    description=\"Learn how to use push notifications in Xamarin.Forms apps with Azure Mobile Services.\"\n    documentationCenter=\"xamarin\"\n    authors=\"wesmc7777\"\n    manager=\"dwrede\"\n    services=\"mobile-services\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"mobile-services\"\n    ms.devlang=\"dotnet\"\n    ms.topic=\"article\"\n    ms.tgt_pltfrm=\"mobile-xamarin\"\n    ms.workload=\"mobile\"\n    ms.date=\"06/10/2015\"\n    ms.author=\"normesta\"/>\n\n# Add push notifications to your Xamarin.Forms app\n[AZURE.INCLUDE [mobile-services-selector-get-started-push](../../includes/mobile-services-selector-get-started-push.md)]\n\n##Overview\n\nThis tutorial shows you how to use Azure Mobile Services to send push notifications to the iOS, Android, and Windows Phone app of your Xamarin.Forms solution. Start by creating a mobile service. Then, you'll download a starter sample, register with the appropriate push notification services, and add code to the solution to receive notifications from those services. \n\nWhen you complete this tutorial, your mobile service will send a push notification each time a user adds a task in one of the apps. You can find the completed sample here: [Completed Xamarin.Forms Azure Push Notification Sample].\n\nThis tutorial requires the following:\n\n+ An iOS 8 device (you cannot test push notifications in the iOS Simulator)\n+ iOS Developer Program membership\n+ [Xamarin.iOS Studio]\n+ [Azure Mobile Services Component]\n+ An active Google account\n+ [Google Cloud Messaging Client Component]. You will add this component during the tutorial.\n\nIn this topic:\n\n1. [Create a New Mobile Service](#create-service)\n2. [Download and Configure the Starter Sample](#download-starter-sample)\n4. [Add push notifications to your Xamarin.Forms.iOS app](#iOS)\n5. [Add push notifications to your Xamarin.Forms.Android app](#Android)\n6. [Add push notifications to your Xamarin.Forms.Windows app](#Windows)\n7. [Update Azure table insert script to send push notifications to all apps](#all-apps)\n\n## <a name=\"create-service\"></a>Create a New Mobile Service\n\n[AZURE.INCLUDE [mobile-services-create-new-service-data](../../includes/mobile-services-create-new-service-data.md)]\n\nTo be able to store app data in the new mobile service, you must first create a new table.  \n\n1. In the Management Portal, click **Mobile Services**, and then click the mobile service that you just created.\n\n2. Click the **Data** tab, then click **+Create**.\n\n    ![][123]\n\n    This displays the **Create new table** dialog.\n\n3. In **Table name** type _TodoItem_, then click the check button.\n\n    ![][124]\n\n    This creates a new storage table **TodoItem** with the default permissions set, which means that any user of the app can access and change data in the table. \n\n    > [AZURE.NOTE] The same table name is used in Mobile Services quickstart. However, each table is created in a schema that is specific to a given mobile service. This is to prevent data collisions when multiple mobile services use the same database.\n\n4. Click the new **TodoItem** table and verify that there are no data rows.\n\n5. Click the **Columns** tab and verify that there is only a single **id** column, which is automatically created for you.\n\n    This is the minimum requirement for a table in Mobile Services. \n\n    > [AZURE.NOTE] When dynamic schema is enabled on your mobile service, new columns are created automatically when JSON objects are sent to the mobile service by an insert or update operation.\n\nYou are now ready to use the new mobile service as data storage for the app.\n\n## <a name=\"download-starter-sample\"></a>Download and Configure the Starter Sample\nWe'll add push notifications to an existing sample.\n  \n1. Download the following sample: [Xamarin.Forms Azure Push Notification Starter Sample].\n\n2. In the Management Portal, click **Mobile Services**, and then click the mobile service. Click the **Dashboard** tab and make a note of the **Site URL**. Then click **Manage Keys** and make a note of the **Application Key**. You'll need these values when you access the mobile service from your app code.\n\n3. In the  **ToDoAzure(Portable)** project of the solution, open the **Constants.cs** file, replace `ApplicationURL` and `ApplicationKey` with the site URL and application key you obtained in the previous step.\n\n## <a name=\"iOS\"></a>Add push notifications to your Xamarin.Forms.iOS app\n\nYou'll add push notifications to the iOS app by using the Apple Push Notification service (APNS). You'll need an active Google account, and the [Google Cloud Messaging Client Component].\n\n>[AZURE.IMPORTANT] Because of Apple Push Notification service (APNS) requirements, you must deploy and test push notifications on an iOS capable device (iPhone or iPad) instead of in the emulator.\n\nAPNS uses certificates to authenticate your mobile service. Follow these instructions to create the necessary certificates and upload it to your Mobile Service. For the official APNS feature documentation, see [Apple Push Notification Service].\n\n### <a name=\"certificates\"></a>Generate the Certificate Signing Request file\n\nFirst you must generate the Certificate Signing Request (CSR) file, which is used by Apple to generate a signed certificate.\n\n1. From Utilities, run the **Keychain Access tool**.\n\n2. Click **Keychain Access**, expand **Certificate Assistant**, then click **Request a Certificate from a Certificate Authority...**.\n\n    ![][5]\n\n3. Enter your **User Email Address**, type in a **Common Name** value, make sure that **Saved to disk** is selected, and then click **Continue**.\n\n    ![][6]\n\n4. Type a name for the Certificate Signing Request (CSR) file in **Save As**, select the location in **Where**, then click **Save**.\n\n    ![][7]\n\n    Remember the location you chose.\n\nNext, you will register your app with Apple, enable push notifications, and upload this exported CSR to create a push certificate.\n\n### <a name=\"register\"></a>Register your app for push notifications\n\nTo be able to send push notifications to an iOS app from mobile services, you must register your application with Apple and register for push notifications.\n\n1. If you have not already registered your app, navigate to the <a href=\"http://go.microsoft.com/fwlink/p/?LinkId=272456\" target=\"_blank\">iOS Provisioning Portal</a> at the Apple Developer Center, log on with your Apple ID, click **Identifiers**, then click **App IDs**, and finally click on the **+** sign to create an app ID for your app.\n\n    ![][102]\n\n2. Type a name for your app in **Description**, enter and remember the unique **Bundle Identifier**, check the \"Push Notifications\" option in the \"App Services\" section, and then click **Continue**. This example uses the ID **MobileServices.Quickstart** but you may not reuse this same ID, as app IDs must be unique across all users. As such, it is recommended that you append your full name or initials after the app name.\n\n    ![][103]\n\n    This generates your app ID and requests you to **Submit** the information. Click **Submit**.\n\n    ![][104]\n\n    Once you click **Submit**, you will see the **Registration complete** screen, as shown below. Click **Done**.\n\n    ![][105]\n\n3. Locate the app ID that you just created, and click on its row.\n\n    ![][106]\n\n    Clicking on the app ID will display details on the app and app ID. Click the **Settings** button.\n\n    ![][107]\n\n4. Scroll to the bottom of the screen, and click the **Create Certificate...** button under the section **Development Push SSL Certificate**.\n\n    ![][108]\n\n    This displays the \"Add iOS Certificate\" assistant.\n\n    Note: This tutorial uses a development certificate. The same process is used when registering a production certificate. Just make sure that you set the same certificate type when you upload the certificate to Mobile Services.\n\n5. Click **Choose File**, browse to the location where you saved the CSR file earlier, then click **Generate**.\n\n    ![][110]\n\n6. After the certificate is created by the portal, click the **Download** button, and click **Done**.\n\n    ![][111]  \n\n    This downloads the signing certificate and saves it to your computer in your Downloads folder.\n\n    ![][9]\n\n    Note: By default, the downloaded file a development certificate is named <strong>aps_development.cer</strong>.\n\n7. Double-click the downloaded push certificate **aps_development.cer**.\n\n    This installs the new certificate in the Keychain, as shown below:\n\n    ![][10]\n\n    Note: The name in your certificate might be different, but it will be prefixed with <strong>Apple Development iOS Push Notification Services:</strong>.\n\nLater, you will use this certificate to generate a .p12 file and upload it to Mobile Services to enable authentication with APNS.\n\n### <a name=\"profile\"></a>Create a provisioning profile for the app\n\n1. Back in the <a href=\"http://go.microsoft.com/fwlink/p/?LinkId=272456\" target=\"_blank\">iOS Provisioning Portal</a>, select **Provisioning Profiles**, select **All**, and then click the **+** button to create a new profile. This launches the **Add iOS Provisiong Profile** Wizard.\n\n    ![][112]\n\n2. Select **iOS App Development** under **Development** as the provisiong profile type, and click **Continue**.\n\n3. Next, select the app ID for the Mobile Services Quickstart app from the **App ID** drop-down list, and click **Continue**.\n\n    ![][113]\n\n4. In the **Select certificates** screen, select the certificate created earlier, and click **Continue**.\n\n    ![][114]\n\n5. Next, select the **Devices** to use for testing, and click **Continue**.\n\n    ![][115]\n\n6. Finally, pick a name for the profile in **Profile Name**, click **Generate**, and click **Done**.\n\n    ![][116]\n\n    This creates a new provisioning profile.\n\n    ![][117]\n\n7. In Xcode, open the Organizer select the Devices view, select **Provisioning Profiles** in the **Library** section in the left pane, and then click the **Refresh** button at the bottom of the middle pane.\n\n### <a name=\"configure-mobileServices\"></a>Configure Mobile Services to send push requests\n\nAfter you have registered your app with APNS and configured your project, you must next configure your mobile service to integrate with APNS.\n\n1. In Keychain Access, right-click the new certificate, click **Export**, name your file, select the **.p12** format, then click **Save**.\n\n    ![][28]\n\n    Make a note of the file name and location of the exported certificate.\n\n2. Log on to the [Azure Management Portal], click **Mobile Services**, and then click your app.\n\n    ![][18]\n\n3. Click the **Push** tab and click **Upload** under **apple push notification settings**.\n\n    ![][19]\n\n    This displays the Upload Certificate dialog.\n\n4. Click **File**, select the exported certificate .p12 file, enter the **Password**, make sure that the correct **Mode** is selected, click the check icon, then click **Save**.\n\n    ![][20]\n\nYour mobile service is now configured to work with APNS.\n\n### <a name=\"configure-app\"></a>Configure your Xamarin.iOS application\n\n1. In Xamarin.Studio or Visual Studio, open **Info.plist**, and update the **Bundle Identifier** with the ID you created earlier.\n\n    ![][121]\n\n2. Scroll down to **Background Modes** and check the **Enable Background Modes** box and the **Remote notifications** box.\n\n    ![][122]\n\n3. Double click your project in the Solution Panel to open **Project Options**.\n\n4.  Choose **iOS Bundle Signing** under **Build**, and select the corresponding **Identity** and **Provisioning profile** you had just set up for this project.\n\n    ![][120]\n\n    This ensures that the Xamarin project uses the new profile for code signing. For the official Xamarin device provisioning documentation, see [Xamarin Device Provisioning].\n\n### <a name=\"add-push\"></a>Add push notifications to your app\n\n1. In Xamarin.Studio or Visual Studio, expand the **ToDoAzure.iOS** project, open the **AppDelegate** class, and then replace the **FinishedLaunching** event with the following code:\n\n        public override bool FinishedLaunching(UIApplication app, NSDictionary options)\n        {\n             // registers for push for iOS8\n            var settings = UIUserNotificationSettings.GetSettingsForTypes(\n                UIUserNotificationType.Alert\n                | UIUserNotificationType.Badge\n                | UIUserNotificationType.Sound,\n                new NSSet());\n\n            global::Xamarin.Forms.Forms.Init();\n            instance = this;\n            CurrentPlatform.Init();\n            \n            todoItemManager = new ToDoItemManager();\n            App.SetTodoItemManager(todoItemManager);\n\n\n            UIApplication.SharedApplication.RegisterUserNotificationSettings(settings);\n            UIApplication.SharedApplication.RegisterForRemoteNotifications();\n            \n            LoadApplication(new App());\n            return base.FinishedLaunching(app, options);\n        }\n\n6. In **AppDelegate**, override the **RegisteredForRemoteNotifications** event:\n\n        public override void RegisteredForRemoteNotifications(UIApplication application, NSData deviceToken)\n        {\n            // Modify device token\n            string _deviceToken = deviceToken.Description;\n            _deviceToken = _deviceToken.Trim('<', '>').Replace(\" \", \"\");\n\n            // Get Mobile Services client\n            MobileServiceClient client = todoItemManager.GetClient;\n\n            // Register for push with Mobile Services\n            IEnumerable<string> tag = new List<string>() { \"uniqueTag\" };\n            \n            const string template = \"{\\\"aps\\\":{\\\"alert\\\":\\\"$(message)\\\"}}\";\n\n            var expiryDate = DateTime.Now.AddDays(90).ToString\n                (System.Globalization.CultureInfo.CreateSpecificCulture(\"en-US\"));\n\n            var push = client.GetPush();\n\n            push.RegisterTemplateAsync(_deviceToken, template, expiryDate, \"myTemplate\", tag)\n        }\n\n7. In **AppDelegate**, override the **ReceivedRemoteNotification** event:\n\n        public override void ReceivedRemoteNotification(UIApplication application, NSDictionary userInfo)\n        {\n            NSObject inAppMessage;\n\n            bool success = userInfo.TryGetValue(new NSString(\"inAppMessage\"), out inAppMessage);\n\n            if (success)\n            {\n                var alert = new UIAlertView(\"Got push notification\", inAppMessage.ToString(), null, \"OK\", null);\n                alert.Show();\n            }\n        }\n\nYour app is now updated to support push notifications.\n\n### <a name=\"update-scripts\"></a>Update the registered insert script in the Management Portal\n\n1. In the Management Portal, click the **Data** tab and then click the **TodoItem** table.\n\n    ![][21]\n\n2. In **todoitem**, click the **Script** tab and select **Insert**.\n\n    ![][22]\n\n    This displays the function that is invoked when an insert occurs in the **TodoItem** table.\n\n3. Replace the insert function with the following code, and then click **Save**:\n\n          function insert(item, user, request) {\n          // Execute the request and send notifications.\n             request.execute({\n             success: function() {                      \n              // Create a template-based payload.\n              var payload = '{ \"message\" : \"New item added: ' + item.text + '\" }';            \n\n              // Write the default response and send a notification\n              // to all platforms.            \n              push.send(null, payload, {               \n                  success: function(pushResponse){\n                  console.log(\"Sent push:\", pushResponse);\n                  // Send the default response.\n                  request.respond();\n                  },              \n                  error: function (pushResponse) {\n                      console.log(\"Error Sending push:\", pushResponse);\n                       // Send the an error response.\n                      request.respond(500, { error: pushResponse });\n                      }           \n               });                 \n              }\n           });   \n          }\n\n    This registers a new insert script, which sends a push notification (the inserted text) to the device provided in the insert request.\n\n   >[AZURE.NOTE] This script delays sending the notification to give you time to close the app to receive a toast notification.\n\n### <a name=\"test\"></a>Test push notifications in your app\n\n1. Press the **Run** button to build the project and start the app in an iOS capable device, then click **OK** to accept push notifications\n\n   >[AZURE.NOTE] You must explicitly accept push notifications from your app. This request only occurs the first time that the app runs.\n\n2. In the app, click the **Add** button, add a task title and then click the **Save** button. \n\n3. Verify that a notification is received, then click **OK** to dismiss the notification.\n\n\nYou have successfully completed this tutorial.\n\n## <a name=\"Android\"></a>Add push notifications to the Xamarin.Forms.Android app\n\nYou'll add push notifications to the Android app by using the Google Cloud Messaging (GCM) service. You'll need an active Google account, and the [Google Cloud Messaging Client Component].\n\n###<a id=\"register\"></a>Enable Google Cloud Messaging\n\n[AZURE.INCLUDE [mobile-services-enable-Google-cloud-messaging](../../includes/mobile-services-enable-google-cloud-messaging.md)]\n\n###<a id=\"configure\"></a>Configure your mobile service to send push requests\n\n[AZURE.INCLUDE [mobile-services-android-configure-push](../../includes/mobile-services-android-configure-push.md)]\n\n###<a id=\"update-scripts\"></a>Update the registered insert script to send notifications\n\n>[AZURE.NOTE] The following steps show you how to update the script registered to the insert operation on the TodoItem table in the Azure Management Portal. You can also access and edit this mobile service script directly in Visual Studio, in the Azure node of Server Explorer. \n\nIn the Management Portal, click the **Data** tab and then click the **TodoItem** table.\n\n   ![][21]\n\n2. In **todoitem**, click the **Script** tab and select **Insert**.\n\n   ![][22]\n\n    This displays the function that is invoked when an insert occurs in the **TodoItem** table.\n\n3. Replace the insert function with the following code, and then click **Save**:\n\n          function insert(item, user, request) {\n          // Execute the request and send notifications.\n             request.execute({\n             success: function() {                      \n              // Create a template-based payload.\n              var payload = '{ \"message\" : \"New item added: ' + item.text + '\" }';            \n\n              // Write the default response and send a notification\n              // to all platforms.            \n              push.send(null, payload, {               \n                  success: function(pushResponse){\n                  console.log(\"Sent push:\", pushResponse);\n                  // Send the default response.\n                  request.respond();\n                  },              \n                  error: function (pushResponse) {\n                      console.log(\"Error Sending push:\", pushResponse);\n                       // Send the an error response.\n                      request.respond(500, { error: pushResponse });\n                      }           \n               });                 \n              }\n           });   \n          }\n\n\n    This registers a new insert script, which sends a push notification (the inserted text) to the device provided in the insert request.\n\n   >[AZURE.NOTE] This script delays sending the notification to give you time to close the app to receive a toast notification.\n\n\n###<a id=\"configure-app\"></a>Configure the existing project for push notifications\n\n1. In the Solution view, expand the **Components** folder in the Xamarin.Android app and make sure that Azure Mobile Services package is installed. \n\n2. Right-click the **Components** folder, click  **Get More Components...**, search for the **Google Cloud Messaging Client** component and add it to the project. \n\n1. Open the MainActivity.cs project file and add the following using statement to the class:\n\n        using Gcm.Client;\n\n\n4.  In the **MainActivity** class, add the following code to the **OnCreate** method, after the call to the **LoadApplication** method:\n            \n            try\n            {\n                // Check to ensure everything's setup right\n                GcmClient.CheckDevice(this);\n                GcmClient.CheckManifest(this);\n\n                // Register for push notifications\n                System.Diagnostics.Debug.WriteLine(\"Registering...\");\n                GcmClient.Register(this, PushHandlerBroadcastReceiver.SENDER_IDS);\n            }\n            catch (Java.Net.MalformedURLException)\n            {\n                CreateAndShowDialog(new Exception(\"There was an error creating the Mobile Service. Verify the URL\"), \"Error\");\n            }\n            catch (Exception e)\n            {\n                CreateAndShowDialog(e, \"Error\");\n            }\n\nYour **MainActivity** is now prepared for adding push notifications.\n\n###<a id=\"add-push\"></a>Add push notifications code to your app\n\n5. In the ToDoAzure.Droid project, create a new class in the project called `GcmService`.\n\n5. Add the following using statements to **GcmService** class:\n\n        using Gcm.Client;\n        using Microsoft.WindowsAzure.MobileServices;\n\n6. Add the following permission requests between the **using** statements and the **namespace** declaration:\n\n        [assembly: Permission(Name = \"@PACKAGE_NAME@.permission.C2D_MESSAGE\")]\n        [assembly: UsesPermission(Name = \"@PACKAGE_NAME@.permission.C2D_MESSAGE\")]\n        [assembly: UsesPermission(Name = \"com.google.android.c2dm.permission.RECEIVE\")]\n\n        //GET_ACCOUNTS is only needed for android versions 4.0.3 and below\n        [assembly: UsesPermission(Name = \"android.permission.GET_ACCOUNTS\")]\n        [assembly: UsesPermission(Name = \"android.permission.INTERNET\")]\n        [assembly: UsesPermission(Name = \"android.permission.WAKE_LOCK\")]\n\n7. In the **GcmService.cs** project file, add the following class:\n \n        [BroadcastReceiver(Permission = Gcm.Client.Constants.PERMISSION_GCM_INTENTS)]\n        [IntentFilter(new string[] { Gcm.Client.Constants.INTENT_FROM_GCM_MESSAGE }, Categories = new string[] { \"@PACKAGE_NAME@\" })]\n        [IntentFilter(new string[] { Gcm.Client.Constants.INTENT_FROM_GCM_REGISTRATION_CALLBACK }, Categories = new string[] { \"@PACKAGE_NAME@\" })]\n        [IntentFilter(new string[] { Gcm.Client.Constants.INTENT_FROM_GCM_LIBRARY_RETRY }, Categories = new string[] { \"@PACKAGE_NAME@\" })]\n\n        public class PushHandlerBroadcastReceiver : GcmBroadcastReceiverBase<GcmService>\n        {\n        \n            public static string[] SENDER_IDS = new string[] { \"<PROJECT_NUMBER>\" };\n\n        }\n\n    In the above code, you must replace _`<PROJECT_NUMBER>`_ with the project number assigned by Google when you provisioned your app in the Google developer portal. \n\n8. In the GcmService.cs project file, add the following code that defines the **GcmService** class:\n \n         [Service]\n         public class GcmService : GcmServiceBase\n         {\n             public static string RegistrationID { get; private set; }\n\n             public GcmService()\n                 : base(PushHandlerBroadcastReceiver.SENDER_IDS){}\n         }\n\n\n    Note that this class derives from **GcmServiceBase** and that the **Service** attribute must be applied to this class.\n\n    >[AZURE.NOTE]The **GcmServiceBase** class implements the **OnRegistered()**, **OnUnRegistered()**, **OnMessage()** and **OnError()** methods. You must override these methods in the **GcmService** class.\n\n5. Add the following code to the **GcmService** class that overrides the **OnRegistered** event handler. \n\n        protected override void OnRegistered(Context context, string registrationId)\n        {\n            Log.Verbose(PushHandlerBroadcastReceiver.TAG, \"GCM Registered: \" + registrationId);\n            RegistrationID = registrationId;\n\n            createNotification(\"GcmService Registered...\", \"The device has been Registered, Tap to View!\");\n\n            MobileServiceClient client =  MainActivity.DefaultService.todoItemManager.GetClient;\n            \n            var push = client.GetPush();\n\n            MainActivity.DefaultService.RunOnUiThread(() => Register(push, null));\n\n        }\n        public async void Register(Microsoft.WindowsAzure.MobileServices.Push push, IEnumerable<string> tags)\n        {\n            try\n            {\n                const string template = \"{\\\"data\\\":{\\\"message\\\":\\\"$(message)\\\"}}\";\n\n                await push.RegisterTemplateAsync(RegistrationID, template, \"mytemplate\", tags);\n            }\n            catch (Exception ex)\n            {\n                System.Diagnostics.Debug.WriteLine(ex.Message);\n                Debugger.Break();\n            }\n        }\n\n    This method uses the returned GCM registration ID to register with Azure for push notifications.\n\n10. Override the **OnMessage** method in **GcmService** with the following code:\n\n        protected override void OnMessage(Context context, Intent intent)\n        {\n            Log.Info(PushHandlerBroadcastReceiver.TAG, \"GCM Message Received!\");\n\n            var msg = new StringBuilder();\n\n            if (intent != null && intent.Extras != null)\n            {\n                foreach (var key in intent.Extras.KeySet())\n                    msg.AppendLine(key + \"=\" + intent.Extras.Get(key).ToString());\n            }\n\n            //Store the message\n            var prefs = GetSharedPreferences(context.PackageName, FileCreationMode.Private);\n            var edit = prefs.Edit();\n            edit.PutString(\"last_msg\", msg.ToString());\n            edit.Commit();\n\n            string message = intent.Extras.GetString(\"message\");\n            if (!string.IsNullOrEmpty(message))\n            {\n                createNotification(\"New todo item!\", \"Todo item: \" + message);\n                return;\n            }\n\n            string msg2 = intent.Extras.GetString(\"msg\");\n            if (!string.IsNullOrEmpty(msg2))\n            {\n                createNotification(\"New hub message!\", msg2);\n                return;\n            }\n\n            createNotification(\"Unknown message details\", msg.ToString());\n        }\n\n        void createNotification(string title, string desc)\n        {\n            //Create notification\n            var notificationManager = GetSystemService(Context.NotificationService) as NotificationManager;\n\n            //Create an intent to show ui\n            var uiIntent = new Intent(this, typeof(MainActivity));\n\n            //Create the notification\n            var notification = new Notification(Android.Resource.Drawable.SymActionEmail, title);\n\n            //Auto cancel will remove the notification once the user touches it\n            notification.Flags = NotificationFlags.AutoCancel;\n\n            //Set the notification info\n            //we use the pending intent, passing our ui intent over which will get called\n            //when the notification is tapped.\n            notification.SetLatestEventInfo(this, title, desc, PendingIntent.GetActivity(this, 0, uiIntent, 0));\n\n            //Show the notification\n            notificationManager.Notify(1, notification);\n        }\n\n12. Add the following method overrides for **OnUnRegistered()** and **OnError()**, which are required for the project to compile.\n\n        protected override void OnError(Context context, string errorId)\n        {\n              Log.Error(PushHandlerBroadcastReceiver.TAG, \"GCM Error: \" + errorId);\n        }\n\n###<a id=\"test\"></a>Test push notifications in your app\n\nYou can test the app by directly attaching an Android phone with a USB cable, or by using a virtual device in the emulator.\n\nWhen you run this app in the emulator, make sure that you use an Android Virtual Device (AVD) that supports Google APIs.\n\n> [AZURE.IMPORTANT] In order to receive push notifications, you must set up a Google account on your Android Virtual Device (in the emulator, navigate to **Settings** and click **Add Account**). Also, make sure that the emulator is connected to the Internet.\n\n1. From **Tools**, click **Open Android Emulator Manager**, select your device, and then click **Edit**.\n    \n    ![][125]\n\n2. Select **Google APIs** in **Target**, then click **OK**.\n    \n    ![][126]\n\n3. On the top toolbar, click **Run**, and then select your app. This starts the emulator and runs the app.\n\n  The app retrieves the *registrationId* from GCM and registers with the Notification Hub.\n\n1. In the app, add a new task.\n\n2. Swipe down from the top of the screen to open the device's Notification Center to see the notification.\n\n    ![][127]\n\n## <a name=\"Windows\"></a>Add push notifications to the Xamarin.Forms.Windows app\n\nThis section shows you how to use Azure Mobile Services to send push notifications to the Windows Phone Silverlight app that is included in your Xamarin.Forms solution. \n\n###<a id=\"update-app\"></a> Update the app to register for notifications\n\nBefore your app can receive push notifications, you must register a notification channel.\n\n1. In Visual Studio, open the file App.xaml.cs and add the following `using` statement:\n\n        using Microsoft.Phone.Notification;\n\n3. Add the following to App.xaml.cs:\n    \n        public static HttpNotificationChannel CurrentChannel { get; private set; }\n\n        private void AcquirePushChannel()\n        {\n            CurrentChannel = HttpNotificationChannel.Find(\"MyPushChannel\");\n\n            if (CurrentChannel == null)\n            {\n                CurrentChannel = new HttpNotificationChannel(\"MyPushChannel\");\n                CurrentChannel.Open();\n                CurrentChannel.BindToShellToast();\n            }\n\n            CurrentChannel.ChannelUriUpdated +=\n                new EventHandler<NotificationChannelUriEventArgs>(async (o, args) =>\n                {\n\n                   // Register for notifications using the new channel\n                    const string template =\n                    \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><wp:Notification \" +\n                    \"xmlns:wp=\\\"WPNotification\\\"><wp:Toast><wp:Text1>$(message)</wp:Text1></wp:Toast></wp:Notification>\";\n\n                    await client.GetPush()\n                        .RegisterTemplateAsync(CurrentChannel.ChannelUri.ToString(), template, \"mytemplate\");\n                });\n        }\n\n    This code retrieves the ChannelURI for the app from the Microsoft Push Notification Service (MPNS) used by Windows Phone 8.x \"Silverlight\", and then registers that ChannelURI for push notifications.\n\n    >[AZURE.NOTE]In this this tutorial, the mobile service sends a toast notification to the device. When you send a tile notification, you must instead call the **BindToShellTile** method on the channel.\n\n4. At the top of the **Application_Launching** event handler in App.xaml.cs, add the following call to the new **AcquirePushChannel** method:\n\n        AcquirePushChannel();\n\n    This makes sure that registration is requested every time that the page is loaded. In your app, you may only want to make this registration periodically to ensure that the registration is current. \n\n5. Press the **F5** key to run the app. A popup dialog with the registration key is displayed.\n  \n6.  In the Solution Explorer, expand **Properties**, open the WMAppManifest.xml file, click the **Capabilities** tab and make sure that the **ID___CAP___PUSH_NOTIFICATION** capability is checked.\n\n    ![Enable notifications in VS](./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-app-enable-push-wp8.png)\n\n    This makes sure that your app can raise toast notifications. \n\n###<a id=\"update-scripts\"></a> Update server scripts to send push notifications\n\nFinally, you must update the script registered to the insert operation on the TodoItem table to send notifications.\n\n1. In the Management Portal, click the **Data** tab and then click the **TodoItem** table.\n\n    ![][21]\n\n2. In **todoitem**, click the **Script** tab and select **Insert**.\n\n    ![][22]\n\n    This displays the function that is invoked when an insert occurs in the **TodoItem** table.\n\n3. Replace the insert function with the following code, and then click **Save**:\n          \n          function insert(item, user, request) {\n          // Execute the request and send notifications.\n             request.execute({\n             success: function() {                      \n              // Create a template-based payload.\n              var payload = '{ \"message\" : \"New item added: ' + item.text + '\" }';            \n\n              // Write the default response and send a notification\n              // to all platforms.            \n              push.send(null, payload, {               \n                  success: function(pushResponse){\n                  console.log(\"Sent push:\", pushResponse);\n                  // Send the default response.\n                  request.respond();\n                  },              \n                  error: function (pushResponse) {\n                      console.log(\"Error Sending push:\", pushResponse);\n                       // Send the an error response.\n                      request.respond(500, { error: pushResponse });\n                      }           \n               });                 \n              }\n           });   \n          }\n\n\n    This registers a new insert script, which sends a push notification (the inserted text) to the device provided in the insert request.\n\n3. Click the **Push** tab, check **Enable unauthenticated push notifications**, then click **Save**.\n\n    This enables the mobile service to connect to MPNS in unauthenticated mode to send push notifications.\n\n    >[AZURE.NOTE]This tutorial uses MPNS in unauthenticated mode. In this mode, MPNS limits the number of notifications that can be sent to a device channel. To remove this restriction, you must generate and upload a certificate by clicking **Upload** and selecting the certificate. For more information on generating the certificate, see [Setting up an authenticated web service to send push notifications for Windows Phone].\n\n###<a id=\"test\"></a> Test push notifications in your app\n\n1. In Visual Studio, press the F5 key to run the app.\n\n    >[AZURE.NOTE] You may encounter a 401 Unauthorized RegistrationAuthorizationException when testing on the Windows Phone emulator. This can occur during the `RegisterNativeAsync()` call because of the way the Windows Phone emulator syncs it's clock with the host PC. It can result in a security token that will be rejected. To resolve this simply manually set the clock in the emulator before testing.\n\n5. In the app, create a new task with the title **Hello push**, then immediately click the start button or back button to leave the app.\n\n    This sends an insert request to the mobile service to store the added item. Notice that the device receives a toast notification that says **hello push**.\n\n    ![Toast notification received](./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-quickstart-push5-wp8.png)\n\n    >[AZURE.NOTE]You will not receive the notification when you are still in the app. To receive a toast notification while the app is active, you must handle the [ShellToastNotificationReceived](http://msdn.microsoft.com/library/windowsphone/develop/microsoft.phone.notification.httpnotificationchannel.shelltoastnotificationreceived(v=vs.105).aspx) event.\n   \n<!-- Anchors. -->\n[Generate the certificate signing request]: #certificates\n[Register your app and enable push notifications]: #register\n[Create a provisioning profile for the app]: #profile\n[Configure Mobile Services]: #configure-mobileServices\n[Configure the Xamarin.iOS App]: #configure-app\n[Update scripts to send push notifications]: #update-scripts\n[Add push notifications to the app]: #add-push\n[Insert data to receive notifications]: #test\n\n<!-- Images. -->\n\n[5]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-step5.png\n[6]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-step6.png\n[7]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-step7.png\n\n[9]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-step9.png\n[10]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-step10.png\n\n[17]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-step17.png\n[18]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-selection.png\n[19]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-push-tab-ios.png\n[20]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-push-tab-ios-upload.png\n[21]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-portal-data-tables.png\n[22]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-insert-script-push2.png\n[23]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-quickstart-push1-ios.png\n[24]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-quickstart-push2-ios.png\n[25]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-quickstart-push3-ios.png\n[26]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-quickstart-push4-ios.png\n[28]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-step18.png\n\n[101]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-01.png\n[102]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-02.png\n[103]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-03.png\n[104]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-04.png\n[105]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-05.png\n[106]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-06.png\n[107]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-07.png\n[108]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-08.png\n\n[110]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-10.png\n[111]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-11.png\n[112]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-12.png\n[113]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-13.png\n[114]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-14.png\n[115]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-15.png\n[116]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-16.png\n[117]: ./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-17.png\n\n[120]:./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-20.png\n[121]:./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-21.png\n[122]:./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-services-ios-push-22.png\n[123]:./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-data-tab-empty.png\n[124]:./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/mobile-create-todoitem-table.png\n[125]:./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/notification-hub-create-android-app7.png\n[126]:./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/notification-hub-create-android-app8.png\n[127]:./media/partner-xamarin-mobile-services-xamarin-forms-get-started-push/notification-area-received.png\n\n\n[Xamarin.iOS Studio]: http://xamarin.com/platform\n[Install Xcode]: https://go.microsoft.com/fwLink/p/?LinkID=266532\n[iOS Provisioning Portal]: http://go.microsoft.com/fwlink/p/?LinkId=272456\n[Mobile Services iOS SDK]: https://go.microsoft.com/fwLink/p/?LinkID=266533\n[Apple Push Notification Service]: http://go.microsoft.com/fwlink/p/?LinkId=272584\n[Get started with Mobile Services]: mobile-services-ios-get-started.md\n\n[Xamarin Device Provisioning]: http://developer.xamarin.com/guides/ios/getting_started/installation/device_provisioning/\n\n\n[Azure Management Portal]: https://manage.windowsazure.com/\n[apns object]: http://go.microsoft.com/fwlink/p/?LinkId=272333\n[Azure Mobile Services Component]: http://components.xamarin.com/view/azure-mobile-services/\n[completed example project]: http://go.microsoft.com/fwlink/p/?LinkId=331303\n[Xamarin.iOS]: http://xamarin.com/download\n[Google Cloud Messaging Client Component]: http://components.xamarin.com/view/GCMClient/\n[Xamarin.Forms Azure Push Notification Starter Sample]: https://github.com/Azure/mobile-services-samples/tree/master/TodoListXamarinForms\n[Completed Xamarin.Forms Azure Push Notification Sample]: https://github.com/Azure/mobile-services-samples/tree/master/GettingStartedWithPushXamarinForms\n "
}