{
  "nodes": [
    {
      "content": "Using vault credentials to authenticate with the Azure Backup service",
      "pos": [
        3,
        72
      ]
    },
    {
      "content": "The on-premises server (Windows client or Windows Server or Data Protection Manager server) needs to be authenticated with a backup vault before it can back up data to Azure.",
      "pos": [
        74,
        248
      ]
    },
    {
      "content": "The authentication is achieved using “vault credentials”.",
      "pos": [
        249,
        306
      ]
    },
    {
      "content": "The concept of vault credentials is similar to the concept of a “publish settings” file which is used in Azure PowerShell.",
      "pos": [
        307,
        429
      ]
    },
    {
      "content": "What is the vault credential file?",
      "pos": [
        435,
        469
      ]
    },
    {
      "content": "The vault credentials file is a certificate generated by the portal for each backup vault.",
      "pos": [
        471,
        561
      ]
    },
    {
      "content": "The portal then uploads the public key to the Access Control Service (ACS).",
      "pos": [
        562,
        637
      ]
    },
    {
      "content": "The private key of the certificate is made available to the user as part of the workflow which is given as an input in the machine registration workflow.",
      "pos": [
        638,
        791
      ]
    },
    {
      "content": "This authenticates the machine to send backup data to an identified vault in the Azure Backup service.",
      "pos": [
        792,
        894
      ]
    },
    {
      "content": "The vault credential is used only during the registration workflow.",
      "pos": [
        896,
        963
      ]
    },
    {
      "content": "It is the user’s responsibility to ensure that the vault credentials file is not compromised.",
      "pos": [
        964,
        1057
      ]
    },
    {
      "content": "If it falls in the hands of any rogue-user, the vault credentials file can be used to register other machines against the same vault.",
      "pos": [
        1058,
        1191
      ]
    },
    {
      "content": "However, as the backup data is encrypted using a passphrase which belongs to the customer, existing backup data cannot be compromised.",
      "pos": [
        1192,
        1326
      ]
    },
    {
      "content": "To mitigate this concern, vault credentials are set to expire in 48hrs.",
      "pos": [
        1327,
        1398
      ]
    },
    {
      "content": "You can download the vault credentials of a backup vault any number of times – but only the latest vault credential file is applicable during the registration workflow.",
      "pos": [
        1399,
        1567
      ]
    },
    {
      "content": "Download the vault credential file",
      "pos": [
        1573,
        1607
      ]
    },
    {
      "content": "The vault credential file is downloaded through a secure channel from the Azure portal.",
      "pos": [
        1609,
        1696
      ]
    },
    {
      "content": "The Azure Backup service is unaware of the private key of the certificate and the private key is not persisted in the portal or the service.",
      "pos": [
        1697,
        1837
      ]
    },
    {
      "content": "Use the following steps to download the vault credential file to a local machine.",
      "pos": [
        1838,
        1919
      ]
    },
    {
      "pos": [
        1925,
        1993
      ],
      "content": "Sign in to the <bpt id=\"p1\">[</bpt>Management Portal<ept id=\"p1\">](https://manage.windowsazure.com/)</ept>"
    },
    {
      "content": "Click on <bpt id=\"p1\">**</bpt>Recovery Services<ept id=\"p1\">**</ept> in the left navigation pane and select the backup vault which you have created.",
      "pos": [
        1998,
        2108
      ]
    },
    {
      "content": "Click on the cloud icon to get to the Quick Start view of the backup vault.",
      "pos": [
        2109,
        2184
      ]
    },
    {
      "content": "Quick view",
      "pos": [
        2192,
        2202
      ]
    },
    {
      "content": "On the Quick Start page, click <bpt id=\"p1\">**</bpt>Download vault credentials<ept id=\"p1\">**</ept>.",
      "pos": [
        2260,
        2322
      ]
    },
    {
      "content": "The  portal generates the vault credential file, which is made available for download.",
      "pos": [
        2323,
        2409
      ]
    },
    {
      "content": "Download",
      "pos": [
        2417,
        2425
      ]
    },
    {
      "content": "The portal will generate a vault credential using a combination of the vault name and the current date.",
      "pos": [
        2484,
        2587
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept> to download the vault credentials to the local account's downloads folder, or select Save As from the Save menu to specify a location for the vault credentials.",
      "pos": [
        2588,
        2763
      ]
    },
    {
      "content": "Note",
      "pos": [
        2769,
        2773
      ]
    },
    {
      "content": "Ensure that the vault credentials is saved in a location which can be accessed from your machine.",
      "pos": [
        2776,
        2873
      ]
    },
    {
      "content": "If it is stored in a file share/SMB, check for the access permissions.",
      "pos": [
        2874,
        2944
      ]
    },
    {
      "content": "The vault credentials file is used only during the registration workflow.",
      "pos": [
        2947,
        3020
      ]
    },
    {
      "content": "The vault credentials file expires after 48hrs and can be downloaded from the portal.",
      "pos": [
        3023,
        3108
      ]
    },
    {
      "pos": [
        3111,
        3205
      ],
      "content": "Refer to the Azure Backup <bpt id=\"p1\">[</bpt>FAQ<ept id=\"p1\">](backup-azure-backup-faq.md)</ept> for any questions on the workflow."
    }
  ],
  "content": "## Using vault credentials to authenticate with the Azure Backup service\n\nThe on-premises server (Windows client or Windows Server or Data Protection Manager server) needs to be authenticated with a backup vault before it can back up data to Azure. The authentication is achieved using “vault credentials”. The concept of vault credentials is similar to the concept of a “publish settings” file which is used in Azure PowerShell.\n\n### What is the vault credential file?\n\nThe vault credentials file is a certificate generated by the portal for each backup vault. The portal then uploads the public key to the Access Control Service (ACS). The private key of the certificate is made available to the user as part of the workflow which is given as an input in the machine registration workflow. This authenticates the machine to send backup data to an identified vault in the Azure Backup service.\n\nThe vault credential is used only during the registration workflow. It is the user’s responsibility to ensure that the vault credentials file is not compromised. If it falls in the hands of any rogue-user, the vault credentials file can be used to register other machines against the same vault. However, as the backup data is encrypted using a passphrase which belongs to the customer, existing backup data cannot be compromised. To mitigate this concern, vault credentials are set to expire in 48hrs. You can download the vault credentials of a backup vault any number of times – but only the latest vault credential file is applicable during the registration workflow.\n\n### Download the vault credential file\n\nThe vault credential file is downloaded through a secure channel from the Azure portal. The Azure Backup service is unaware of the private key of the certificate and the private key is not persisted in the portal or the service. Use the following steps to download the vault credential file to a local machine.\n\n1.  Sign in to the [Management Portal](https://manage.windowsazure.com/)\n2.  Click on **Recovery Services** in the left navigation pane and select the backup vault which you have created. Click on the cloud icon to get to the Quick Start view of the backup vault.\n\n    ![Quick view](./media/backup-download-credentials/quickview.png)\n\n3.  On the Quick Start page, click **Download vault credentials**. The  portal generates the vault credential file, which is made available for download.\n\n    ![Download](./media/backup-download-credentials/downloadvc.png)\n\n4.  The portal will generate a vault credential using a combination of the vault name and the current date. Click **Save** to download the vault credentials to the local account's downloads folder, or select Save As from the Save menu to specify a location for the vault credentials.\n\n### Note\n- Ensure that the vault credentials is saved in a location which can be accessed from your machine. If it is stored in a file share/SMB, check for the access permissions.\n- The vault credentials file is used only during the registration workflow.\n- The vault credentials file expires after 48hrs and can be downloaded from the portal.\n- Refer to the Azure Backup [FAQ](backup-azure-backup-faq.md) for any questions on the workflow.\n"
}