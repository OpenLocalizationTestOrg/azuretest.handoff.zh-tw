{
  "nodes": [
    {
      "content": "Storage Analytics | Microsoft Azure",
      "pos": [
        27,
        62
      ]
    },
    {
      "content": "How to manage concurrency for the Blob, Queue, Table, and File services",
      "pos": [
        81,
        152
      ]
    },
    {
      "content": "Storage Analytics",
      "pos": [
        443,
        460
      ]
    },
    {
      "content": "Overview",
      "pos": [
        465,
        473
      ]
    },
    {
      "content": "Azure Storage Analytics performs logging and provides metrics data for a storage account.",
      "pos": [
        475,
        564
      ]
    },
    {
      "content": "You can use this data to trace requests, analyze usage trends, and diagnose issues with your storage account.",
      "pos": [
        565,
        674
      ]
    },
    {
      "content": "To use Storage Analytics, you must enable it individually for each service you want to monitor.",
      "pos": [
        676,
        771
      ]
    },
    {
      "content": "You can enable it from the <bpt id=\"p1\">[</bpt>Azure portal<ept id=\"p1\">](https://manage.windowsazure.com/)</ept>.",
      "pos": [
        772,
        848
      ]
    },
    {
      "content": "For details, see <bpt id=\"p1\">[</bpt>How to monitor a storage account<ept id=\"p1\">](http://www.azure.com/manage/services/storage/how-to-monitor-a-storage-account/)</ept>.",
      "pos": [
        849,
        981
      ]
    },
    {
      "content": "You can also enable Storage Analytics programmatically via the REST API or the client library.",
      "pos": [
        982,
        1076
      ]
    },
    {
      "content": "Use the <bpt id=\"p1\">[</bpt>Get Blob Service Properties<ept id=\"p1\">](https://msdn.microsoft.com/library/hh452239.aspx)</ept>, <bpt id=\"p2\">[</bpt>Get Queue Service Properties<ept id=\"p2\">](https://msdn.microsoft.com/library/hh452243.aspx)</ept>, and <bpt id=\"p3\">[</bpt>Get Table Service Properties<ept id=\"p3\">](https://msdn.microsoft.com/library/hh452238.aspx)</ept> operations to enable Storage Analytics for each service.",
      "pos": [
        1077,
        1389
      ]
    },
    {
      "content": "The aggregated data is stored in a well-known blob (for logging) and in well-known tables (for metrics), which may be accessed using the Blob service and Table service APIs.",
      "pos": [
        1391,
        1564
      ]
    },
    {
      "content": "Storage Analytics has a 20 TB limit on the amount of stored data that is independent of the total limit for your storage account.",
      "pos": [
        1566,
        1695
      ]
    },
    {
      "content": "For more information about billing and data retention policies, see <bpt id=\"p1\">[</bpt>Storage Analytics and Billing<ept id=\"p1\">](https://msdn.microsoft.com/library/hh360997.aspx)</ept>.",
      "pos": [
        1696,
        1846
      ]
    },
    {
      "content": "For more information about storage account limits, see <bpt id=\"p1\">[</bpt>Azure Storage Scalability and Performance Targets<ept id=\"p1\">](https://msdn.microsoft.com/library/dn249410.aspx)</ept>.",
      "pos": [
        1847,
        2004
      ]
    },
    {
      "pos": [
        2006,
        2257
      ],
      "content": "For an in-depth guide on using Storage Analytics and other tools to identify, diagnose, and troubleshoot Azure Storage-related issues, see <bpt id=\"p1\">[</bpt>Monitor, diagnose, and troubleshoot Microsoft Azure Storage<ept id=\"p1\">](storage-monitoring-diagnosing-troubleshooting.md)</ept>."
    },
    {
      "content": "About Storage Analytics logging",
      "pos": [
        2263,
        2294
      ]
    },
    {
      "content": "Storage Analytics logs detailed information about successful and failed requests to a storage service.",
      "pos": [
        2296,
        2398
      ]
    },
    {
      "content": "This information can be used to monitor individual requests and to diagnose issues with a storage service.",
      "pos": [
        2399,
        2505
      ]
    },
    {
      "content": "Requests are logged on a best-effort basis.",
      "pos": [
        2506,
        2549
      ]
    },
    {
      "content": "Log entries are created only if there is storage service activity.",
      "pos": [
        2551,
        2617
      ]
    },
    {
      "content": "For example, if a storage account has activity in its Blob service but not in its Table or Queue services, only logs pertaining to the Blob service will be created.",
      "pos": [
        2618,
        2782
      ]
    },
    {
      "content": "Logging authenticated requests",
      "pos": [
        2788,
        2818
      ]
    },
    {
      "content": "The following types of authenticated requests are logged:",
      "pos": [
        2820,
        2877
      ]
    },
    {
      "content": "Successful requests.",
      "pos": [
        2881,
        2901
      ]
    },
    {
      "content": "Failed requests, including timeout, throttling, network, authorization, and other errors.",
      "pos": [
        2905,
        2994
      ]
    },
    {
      "content": "Requests using a Shared Access Signature (SAS), including failed and successful requests.",
      "pos": [
        2998,
        3087
      ]
    },
    {
      "content": "Requests to analytics data.",
      "pos": [
        3091,
        3118
      ]
    },
    {
      "content": "Requests made by Storage Analytics itself, such as log creation or deletion, are not logged.",
      "pos": [
        3120,
        3212
      ]
    },
    {
      "content": "A full list of the logged data is documented in the <bpt id=\"p1\">[</bpt>Storage Analytics Logged Operations and Status Messages<ept id=\"p1\">](https://msdn.microsoft.com/library/hh343260.aspx)</ept> and <bpt id=\"p2\">[</bpt>Storage Analytics Log Format<ept id=\"p2\">](https://msdn.microsoft.com/library/hh343259.aspx)</ept> topics.",
      "pos": [
        3213,
        3465
      ]
    },
    {
      "content": "Logging anonymous requests",
      "pos": [
        3471,
        3497
      ]
    },
    {
      "content": "The following types of anonymous requests are logged:",
      "pos": [
        3498,
        3551
      ]
    },
    {
      "content": "Successful requests.",
      "pos": [
        3555,
        3575
      ]
    },
    {
      "content": "Server errors.",
      "pos": [
        3579,
        3593
      ]
    },
    {
      "content": "Timeout errors for both client and server.",
      "pos": [
        3597,
        3639
      ]
    },
    {
      "content": "Failed GET requests with error code 304 (Not Modified).",
      "pos": [
        3643,
        3698
      ]
    },
    {
      "content": "All other failed anonymous requests are not logged.",
      "pos": [
        3700,
        3751
      ]
    },
    {
      "content": "A full list of the logged data is documented in the <bpt id=\"p1\">[</bpt>Storage Analytics Logged Operations and Status Messages<ept id=\"p1\">](https://msdn.microsoft.com/library/hh343260.aspx)</ept> and <bpt id=\"p2\">[</bpt>Storage Analytics Log Format<ept id=\"p2\">](](https://msdn.microsoft.com/library/hh343259.aspx))</ept> topics.",
      "pos": [
        3752,
        4007
      ]
    },
    {
      "content": "How logs are stored",
      "pos": [
        4013,
        4032
      ]
    },
    {
      "content": "All logs are stored in block blobs in a container named $logs, which is automatically created when Storage Analytics is enabled for a storage account.",
      "pos": [
        4033,
        4183
      ]
    },
    {
      "content": "The $logs container is located in the blob namespace of the storage account, for example: <ph id=\"ph1\">`http://&lt;accountname&gt;.blob.core.windows.net/$logs`</ph>.",
      "pos": [
        4184,
        4325
      ]
    },
    {
      "content": "This container cannot be deleted once Storage Analytics has been enabled, though its contents can be deleted.",
      "pos": [
        4326,
        4435
      ]
    },
    {
      "content": "[Azure.NOTE] The $logs container is not displayed when a container listing operation is performed, such as the <bpt id=\"p1\">[</bpt>ListContainers<ept id=\"p1\">](https://msdn.microsoft.com/library/ee758348.aspx)</ept> method.",
      "pos": [
        4438,
        4623
      ]
    },
    {
      "content": "It must be accessed directly.",
      "pos": [
        4624,
        4653
      ]
    },
    {
      "content": "For example, you can use the <bpt id=\"p1\">[</bpt>ListBlobs<ept id=\"p1\">](https://msdn.microsoft.com/library/ee772878.aspx)</ept> method to access the blobs in the <ph id=\"ph1\">`$logs`</ph> container.",
      "pos": [
        4654,
        4797
      ]
    },
    {
      "content": "As requests are logged, Storage Analytics will upload intermediate results as blocks.",
      "pos": [
        4798,
        4883
      ]
    },
    {
      "content": "Periodically, Storage Analytics will commit these blocks and make them available as a blob.",
      "pos": [
        4884,
        4975
      ]
    },
    {
      "content": "Duplicate records may exist for logs created in the same hour.",
      "pos": [
        4977,
        5039
      ]
    },
    {
      "content": "You can determine if a record is a duplicate by checking the <bpt id=\"p1\">**</bpt>RequestId<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Operation<ept id=\"p2\">**</ept> number.",
      "pos": [
        5040,
        5140
      ]
    },
    {
      "content": "Log naming conventions",
      "pos": [
        5146,
        5168
      ]
    },
    {
      "content": "Each log will be written in the following format.",
      "pos": [
        5169,
        5218
      ]
    },
    {
      "content": "The following table describes each attribute in the log name.",
      "pos": [
        5270,
        5331
      ]
    },
    {
      "content": "Attribute",
      "pos": [
        5335,
        5344
      ]
    },
    {
      "content": "Description",
      "pos": [
        5355,
        5366
      ]
    },
    {
      "content": "&lt;service-name&gt;",
      "pos": [
        5763,
        5777
      ]
    },
    {
      "content": "The name of the storage service.",
      "pos": [
        5783,
        5815
      ]
    },
    {
      "content": "For example: blob, table, or queue.",
      "pos": [
        5816,
        5851
      ]
    },
    {
      "content": "YYYY",
      "pos": [
        5977,
        5981
      ]
    },
    {
      "content": "The four digit year for the log.",
      "pos": [
        5997,
        6029
      ]
    },
    {
      "content": "For example: 2011.",
      "pos": [
        6030,
        6048
      ]
    },
    {
      "content": "MM",
      "pos": [
        6191,
        6193
      ]
    },
    {
      "content": "The two digit month for the log.",
      "pos": [
        6211,
        6243
      ]
    },
    {
      "content": "For example: 07.",
      "pos": [
        6244,
        6260
      ]
    },
    {
      "content": "DD",
      "pos": [
        6405,
        6407
      ]
    },
    {
      "content": "The two digit month for the log.",
      "pos": [
        6425,
        6457
      ]
    },
    {
      "content": "For example: 07.",
      "pos": [
        6458,
        6474
      ]
    },
    {
      "content": "hh",
      "pos": [
        6619,
        6621
      ]
    },
    {
      "content": "The two digit hour that indicates the starting hour for the logs, in 24 hour UTC format.",
      "pos": [
        6639,
        6727
      ]
    },
    {
      "content": "For example: 18.",
      "pos": [
        6728,
        6744
      ]
    },
    {
      "content": "mm",
      "pos": [
        6833,
        6835
      ]
    },
    {
      "content": "The two digit number that indicates the starting minute for the logs.",
      "pos": [
        6853,
        6922
      ]
    },
    {
      "content": "This value is unsupported in the current version of Storage Analytics, and its value will always be 00.",
      "pos": [
        6923,
        7026
      ]
    },
    {
      "content": "A zero-based counter with six digits that indicates the number of log blobs generated for the storage service in an hour time period.",
      "pos": [
        7055,
        7188
      ]
    },
    {
      "content": "This counter starts at 000000.",
      "pos": [
        7189,
        7219
      ]
    },
    {
      "content": "For example: 000001.",
      "pos": [
        7220,
        7240
      ]
    },
    {
      "content": "The following is a complete sample log name that combines the previous examples.",
      "pos": [
        7248,
        7328
      ]
    },
    {
      "content": "The following is a sample URI that can be used to access the previous log.",
      "pos": [
        7367,
        7441
      ]
    },
    {
      "content": "When a storage request is logged, the resulting log name correlates to the hour when the requested operation completed.",
      "pos": [
        7530,
        7649
      ]
    },
    {
      "content": "For example, if a GetBlob request was completed at 6:30 P.M.",
      "pos": [
        7650,
        7710
      ]
    },
    {
      "content": "on 7/31/2011, the log would be written with the following prefix: <ph id=\"ph1\">`blob/2011/07/31/1800/`</ph>",
      "pos": [
        7711,
        7800
      ]
    },
    {
      "content": "Log metadata",
      "pos": [
        7806,
        7818
      ]
    },
    {
      "content": "All log blobs are stored with metadata that can be used to identify what logging data the blob contains.",
      "pos": [
        7819,
        7923
      ]
    },
    {
      "content": "The following table describes each metadata attribute.",
      "pos": [
        7924,
        7978
      ]
    },
    {
      "content": "Attribute",
      "pos": [
        7982,
        7991
      ]
    },
    {
      "content": "Description",
      "pos": [
        7998,
        8009
      ]
    },
    {
      "content": "LogType",
      "pos": [
        8530,
        8537
      ]
    },
    {
      "content": "Describes whether the log contains information pertaining to read, write, or delete operations.",
      "pos": [
        8546,
        8641
      ]
    },
    {
      "content": "This value can include one type or a combination of all three, separated by commas.",
      "pos": [
        8642,
        8725
      ]
    },
    {
      "content": "Example 1: write Example 2: read,write Example 3: read,write,delete.",
      "pos": [
        8728,
        8796
      ]
    },
    {
      "content": "StartTime",
      "pos": [
        8804,
        8813
      ]
    },
    {
      "content": "The earliest time of an entry in the log, in the form of YYYY-MM-DDThh:mm:ssZ.",
      "pos": [
        8820,
        8898
      ]
    },
    {
      "content": "For example: 2011-07-31T18:21:46Z.",
      "pos": [
        8899,
        8933
      ]
    },
    {
      "content": "EndTime",
      "pos": [
        9078,
        9085
      ]
    },
    {
      "content": "The latest time of an entry in the log, in the form of YYYY-MM-DDThh:mm:ssZ.",
      "pos": [
        9094,
        9170
      ]
    },
    {
      "content": "For example: 2011-07-31T18:22:09Z.",
      "pos": [
        9171,
        9205
      ]
    },
    {
      "content": "LogVersion",
      "pos": [
        9352,
        9362
      ]
    },
    {
      "content": "The version of the log format.",
      "pos": [
        9368,
        9398
      ]
    },
    {
      "content": "Currently the only supported value is 1.0.",
      "pos": [
        9399,
        9441
      ]
    },
    {
      "content": "The following list displays complete sample metadata using the previous examples.",
      "pos": [
        9625,
        9706
      ]
    },
    {
      "content": "LogType=write",
      "pos": [
        9710,
        9723
      ]
    },
    {
      "content": "StartTime=2011-07-31T18:21:46Z",
      "pos": [
        9727,
        9757
      ]
    },
    {
      "content": "EndTime=2011-07-31T18:22:09Z",
      "pos": [
        9761,
        9789
      ]
    },
    {
      "content": "LogVersion=1.0",
      "pos": [
        9793,
        9807
      ]
    },
    {
      "content": "Accessing logging data",
      "pos": [
        9813,
        9835
      ]
    },
    {
      "content": "All data in the <ph id=\"ph1\">`$logs`</ph> container can be accessed by using the Blob service APIs, including the .NET APIs provided by the Azure managed library.",
      "pos": [
        9837,
        9981
      ]
    },
    {
      "content": "The storage account administrator can read and delete logs, but cannot create or update them.",
      "pos": [
        9982,
        10075
      ]
    },
    {
      "content": "Both the log’s metadata and log name can be used when querying for a log.",
      "pos": [
        10076,
        10149
      ]
    },
    {
      "content": "It is possible for a given hour’s logs to appear out of order, but the metadata always specifies the timespan of log entries in a log.",
      "pos": [
        10150,
        10284
      ]
    },
    {
      "content": "Therefore, you can use a combination of log names and metadata when searching for a particular log.",
      "pos": [
        10285,
        10384
      ]
    },
    {
      "content": "About Storage Analytics metrics",
      "pos": [
        10389,
        10420
      ]
    },
    {
      "content": "Storage Analytics can store metrics that include aggregated transaction statistics and capacity data about requests to a storage service.",
      "pos": [
        10422,
        10559
      ]
    },
    {
      "content": "Transactions are reported at both the API operation level as well as at the storage service level, and capacity is reported at the storage service level.",
      "pos": [
        10560,
        10713
      ]
    },
    {
      "content": "Metrics data can be used to analyze storage service usage, diagnose issues with requests made against the storage service, and to improve the performance of applications that use a service.",
      "pos": [
        10714,
        10903
      ]
    },
    {
      "content": "To use Storage Analytics, you must enable it individually for each service you want to monitor.",
      "pos": [
        10905,
        11000
      ]
    },
    {
      "content": "You can enable it from the <bpt id=\"p1\">[</bpt>Azure portal<ept id=\"p1\">](https://manage.windowsazure.com/)</ept>.",
      "pos": [
        11001,
        11077
      ]
    },
    {
      "content": "For details, see <bpt id=\"p1\">[</bpt>How To monitor a storage account<ept id=\"p1\">](../how-to-monitor-a-storage-account.md)</ept>.",
      "pos": [
        11078,
        11170
      ]
    },
    {
      "content": "You can also enable Storage Analytics programmatically via the REST API or the client library.",
      "pos": [
        11171,
        11265
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Use the Get Blob Service Properties, Get Queue Service Properties<ept id=\"p1\">](https://msdn.microsoft.com/library/hh452239.aspx)</ept>, and <bpt id=\"p2\">[</bpt>Get Table Service Properties<ept id=\"p2\">](https://msdn.microsoft.com/library/hh452238.aspx)</ept> operations to enable Storage Analytics for each service.",
      "pos": [
        11266,
        11526
      ]
    },
    {
      "content": "Transaction metrics",
      "pos": [
        11532,
        11551
      ]
    },
    {
      "content": "A robust set of data is recorded at hourly or minute intervals for each storage service and requested API operation, including ingress/egress, availability, errors, and categorized request percentages.",
      "pos": [
        11553,
        11754
      ]
    },
    {
      "content": "You can see a complete list of the transaction details in the <bpt id=\"p1\">[</bpt>Storage Analytics Metrics Table Schema<ept id=\"p1\">](https://msdn.microsoft.com/library/hh343264.aspx)</ept> topic.",
      "pos": [
        11755,
        11914
      ]
    },
    {
      "content": "Transaction data is recorded at two levels – the service level and the API operation level.",
      "pos": [
        11916,
        12007
      ]
    },
    {
      "content": "At the service level, statistics summarizing all requested API operations are written to a table entity every hour even if no requests were made to the service.",
      "pos": [
        12008,
        12168
      ]
    },
    {
      "content": "At the API operation level, statistics are only written to an entity if the operation was requested within that hour.",
      "pos": [
        12169,
        12286
      ]
    },
    {
      "content": "For example, if you perform a <bpt id=\"p1\">**</bpt>GetBlob<ept id=\"p1\">**</ept> operation on your Blob service, Storage Analytics Metrics will log the request and include it in the aggregated data for both the Blob service as well as the <bpt id=\"p2\">**</bpt>GetBlob<ept id=\"p2\">**</ept> operation.",
      "pos": [
        12288,
        12510
      ]
    },
    {
      "content": "However, if no <bpt id=\"p1\">**</bpt>GetBlob<ept id=\"p1\">**</ept> operation is requested during the hour, an entity will not be written to the <ph id=\"ph1\">`$MetricsTransactionsBlob`</ph> for that operation.",
      "pos": [
        12511,
        12661
      ]
    },
    {
      "content": "Transaction metrics are recorded for both user requests and requests made by Storage Analytics itself.",
      "pos": [
        12663,
        12765
      ]
    },
    {
      "content": "For example, requests by Storage Analytics to write logs and table entities are recorded.",
      "pos": [
        12766,
        12855
      ]
    },
    {
      "content": "For more information about how these requests are billed, see <bpt id=\"p1\">[</bpt>Storage Analytics and Billing<ept id=\"p1\">](https://msdn.microsoft.com/library/hh360997.aspx)</ept>.",
      "pos": [
        12856,
        13000
      ]
    },
    {
      "content": "Capacity metrics",
      "pos": [
        13006,
        13022
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Currently, capacity metrics are only available for the Blob service.",
      "pos": [
        13025,
        13106
      ]
    },
    {
      "content": "Capacity metrics for the Table service and Queue service will be available in future versions of Storage Analytics.",
      "pos": [
        13107,
        13222
      ]
    },
    {
      "content": "Capacity data is recorded daily for a storage account’s Blob service, and two table entities are written.",
      "pos": [
        13224,
        13329
      ]
    },
    {
      "content": "One entity provides statistics for user data, and the other provides statistics about the <ph id=\"ph1\">`$logs`</ph> blob container used by Storage Analytics.",
      "pos": [
        13330,
        13469
      ]
    },
    {
      "content": "The <ph id=\"ph1\">`$MetricsCapacityBlob`</ph> table includes the following statistics:",
      "pos": [
        13470,
        13537
      ]
    },
    {
      "pos": [
        13541,
        13630
      ],
      "content": "<bpt id=\"p1\">**</bpt>Capacity<ept id=\"p1\">**</ept>: The amount of storage used by the storage account’s Blob service, in bytes."
    },
    {
      "pos": [
        13634,
        13722
      ],
      "content": "<bpt id=\"p1\">**</bpt>ContainerCount<ept id=\"p1\">**</ept>: The number of blob containers in the storage account’s Blob service."
    },
    {
      "pos": [
        13726,
        13841
      ],
      "content": "<bpt id=\"p1\">**</bpt>ObjectCount<ept id=\"p1\">**</ept>: The number of committed and uncommitted block or page blobs in the storage account’s Blob service."
    },
    {
      "pos": [
        13843,
        13987
      ],
      "content": "For more information about the capacity metrics, see <bpt id=\"p1\">[</bpt>Storage Analytics Metrics Table Schema<ept id=\"p1\">](https://msdn.microsoft.com/library/hh343264.aspx)</ept>."
    },
    {
      "content": "How metrics are stored",
      "pos": [
        13993,
        14015
      ]
    },
    {
      "content": "All metrics data for each of the storage services is stored in three tables reserved for that service: one table for transaction information, one table for minute transaction information, and another table for capacity information.",
      "pos": [
        14017,
        14248
      ]
    },
    {
      "content": "Transaction and minute transaction information consists of request and response data, and capacity information consists of storage usage data.",
      "pos": [
        14249,
        14391
      ]
    },
    {
      "content": "Hour metrics, minute metrics, and capacity for a storage account’s Blob service is can be accessed in tables that are named as described in the following table.",
      "pos": [
        14392,
        14552
      ]
    },
    {
      "content": "Metrics level",
      "pos": [
        14556,
        14569
      ]
    },
    {
      "content": "Table names",
      "pos": [
        14596,
        14607
      ]
    },
    {
      "content": "Supported versions",
      "pos": [
        14724,
        14742
      ]
    },
    {
      "content": "Hourly metrics, primary location",
      "pos": [
        15180,
        15212
      ]
    },
    {
      "content": "$MetricsTransactionsBlob",
      "pos": [
        15221,
        15245
      ]
    },
    {
      "content": "$MetricsTransactionsTable",
      "pos": [
        15251,
        15276
      ]
    },
    {
      "content": "$MetricsTransactionsQueue",
      "pos": [
        15283,
        15308
      ]
    },
    {
      "content": "Versions prior to 2013-08-15 only.",
      "pos": [
        15360,
        15394
      ]
    },
    {
      "content": "While these names are still supported, it’s recommended that you switch to using the tables listed below.",
      "pos": [
        15395,
        15500
      ]
    },
    {
      "content": "Hourly metrics, primary location",
      "pos": [
        15506,
        15538
      ]
    },
    {
      "content": "$MetricsHourPrimaryTransactionsBlob",
      "pos": [
        15546,
        15581
      ]
    },
    {
      "content": "$MetricsHourPrimaryTransactionsTable",
      "pos": [
        15587,
        15623
      ]
    },
    {
      "content": "$MetricsHourPrimaryTransactionsQueue",
      "pos": [
        15629,
        15665
      ]
    },
    {
      "content": "All versions, including 2013-08-15.",
      "pos": [
        15682,
        15717
      ]
    },
    {
      "content": "Minute metrics, primary location",
      "pos": [
        15832,
        15864
      ]
    },
    {
      "content": "$MetricsMinutePrimaryTransactionsBlob",
      "pos": [
        15872,
        15909
      ]
    },
    {
      "content": "$MetricsMinutePrimaryTransactionsTable",
      "pos": [
        15915,
        15953
      ]
    },
    {
      "content": "$MetricsMinutePrimaryTransactionsQueue",
      "pos": [
        15959,
        15997
      ]
    },
    {
      "content": "All versions, including 2013-08-15.",
      "pos": [
        16008,
        16043
      ]
    },
    {
      "content": "Hourly metrics, secondary location",
      "pos": [
        16158,
        16192
      ]
    },
    {
      "content": "$MetricsHourSecondaryTransactionsBlob",
      "pos": [
        16198,
        16235
      ]
    },
    {
      "content": "$MetricsHourSecondaryTransactionsTable",
      "pos": [
        16241,
        16279
      ]
    },
    {
      "content": "$MetricsHourSecondaryTransactionsQueue",
      "pos": [
        16285,
        16323
      ]
    },
    {
      "content": "All versions, including 2013-08-15.",
      "pos": [
        16334,
        16369
      ]
    },
    {
      "content": "Read-access geo-redundant replication must be enabled.",
      "pos": [
        16370,
        16424
      ]
    },
    {
      "content": "Minute metrics, secondary location",
      "pos": [
        16480,
        16514
      ]
    },
    {
      "content": "$MetricsMinuteSecondaryTransactionsBlob",
      "pos": [
        16520,
        16559
      ]
    },
    {
      "content": "$MetricsMinuteSecondaryTransactionsTable",
      "pos": [
        16565,
        16605
      ]
    },
    {
      "content": "$MetricsMinuteSecondaryTransactionsQueue",
      "pos": [
        16611,
        16651
      ]
    },
    {
      "content": "All versions, including 2013-08-15.",
      "pos": [
        16656,
        16691
      ]
    },
    {
      "content": "Read-access geo-redundant replication must be enabled.",
      "pos": [
        16692,
        16746
      ]
    },
    {
      "content": "Capacity (Blob service only)",
      "pos": [
        16802,
        16830
      ]
    },
    {
      "content": "$MetricsCapacityBlob",
      "pos": [
        16842,
        16862
      ]
    },
    {
      "content": "All versions, including 2013-08-15.",
      "pos": [
        16970,
        17005
      ]
    },
    {
      "content": "These tables are automatically created when Storage Analytics is enabled for a storage account.",
      "pos": [
        17120,
        17215
      ]
    },
    {
      "content": "They are accessed via the namespace of the storage account, for example: <ph id=\"ph1\">`https://&lt;accountname&gt;.table.core.windows.net/Tables(\"$MetricsTransactionsBlob\")`</ph>",
      "pos": [
        17216,
        17370
      ]
    },
    {
      "content": "Accessing metrics data",
      "pos": [
        17376,
        17398
      ]
    },
    {
      "content": "All data in the metrics tables can be accessed by using the Table service APIs, including the .NET APIs provided by the Azure managed library.",
      "pos": [
        17400,
        17542
      ]
    },
    {
      "content": "The storage account administrator can read and delete table entities, but cannot create or update them.",
      "pos": [
        17543,
        17646
      ]
    },
    {
      "content": "Billing for Storage Analytics",
      "pos": [
        17651,
        17680
      ]
    },
    {
      "content": "Storage Analytics is enabled by a storage account owner; it is not enabled by default.",
      "pos": [
        17682,
        17768
      ]
    },
    {
      "content": "All metrics data is written by the services of a storage account.",
      "pos": [
        17769,
        17834
      ]
    },
    {
      "content": "As a result, each write operation performed by Storage Analytics is billable.",
      "pos": [
        17835,
        17912
      ]
    },
    {
      "content": "Additionally, the amount of storage used by metrics data is also billable.",
      "pos": [
        17913,
        17987
      ]
    },
    {
      "content": "The following actions performed by Storage Analytics are billable:",
      "pos": [
        17989,
        18055
      ]
    },
    {
      "content": "Requests to create blobs for logging.",
      "pos": [
        18059,
        18096
      ]
    },
    {
      "content": "Requests to create table entities for metrics.",
      "pos": [
        18100,
        18146
      ]
    },
    {
      "content": "If you have configured a data retention policy, you are not charged for delete transactions when Storage Analytics deletes old logging and metrics data.",
      "pos": [
        18148,
        18300
      ]
    },
    {
      "content": "However, delete transactions from a client are billable.",
      "pos": [
        18301,
        18357
      ]
    },
    {
      "content": "For more information about retention policies, see <bpt id=\"p1\">[</bpt>Setting a Storage Analytics Data Retention Policy<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/hh343263.aspx)</ept>.",
      "pos": [
        18358,
        18517
      ]
    },
    {
      "content": "Understanding billable requests",
      "pos": [
        18523,
        18554
      ]
    },
    {
      "content": "Every request made to an account’s storage service is either billable or non-billable.",
      "pos": [
        18556,
        18642
      ]
    },
    {
      "content": "Storage Analytics logs each individual request made to a service, including a status message that indicates how the request was handled.",
      "pos": [
        18643,
        18779
      ]
    },
    {
      "content": "Similarly, Storage Analytics stores metrics for both a service and the API operations of that service, including the percentages and count of certain status messages.",
      "pos": [
        18780,
        18946
      ]
    },
    {
      "content": "Together, these features can help you analyze your billable requests, make improvements on your application, and diagnose issues with requests to your services.",
      "pos": [
        18947,
        19107
      ]
    },
    {
      "content": "For more information about billing, see <bpt id=\"p1\">[</bpt>Understanding Azure Storage Billing - Bandwidth, Transactions, and Capacity<ept id=\"p1\">](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx)</ept>.",
      "pos": [
        19108,
        19375
      ]
    },
    {
      "content": "When looking at Storage Analytics data, you can use the tables in the <bpt id=\"p1\">[</bpt>Storage Analytics Logged Operations and Status Messages<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/hh343260.aspx)</ept> topic to determine what requests are billable.",
      "pos": [
        19377,
        19607
      ]
    },
    {
      "content": "Then you can compare your logs and metrics data to the status messages to see if you were charged for a particular request.",
      "pos": [
        19608,
        19731
      ]
    },
    {
      "content": "You can also use the tables in the previous topic to investigate availability for a storage service or individual API operation.",
      "pos": [
        19732,
        19860
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        19865,
        19875
      ]
    },
    {
      "content": "Setting up Storage Analytics",
      "pos": [
        19881,
        19909
      ]
    },
    {
      "content": "How To monitor a storage account",
      "pos": [
        19913,
        19945
      ]
    },
    {
      "content": "Enabling and Configuring Storage Analytics",
      "pos": [
        19990,
        20032
      ]
    },
    {
      "content": "Storage Analytics logging",
      "pos": [
        20089,
        20114
      ]
    },
    {
      "content": "About Storage Analytics Logging",
      "pos": [
        20120,
        20151
      ]
    },
    {
      "content": "Storage Analytics Log Format",
      "pos": [
        20206,
        20234
      ]
    },
    {
      "content": "Storage Analytics Logged Operations and Status Messages",
      "pos": [
        20289,
        20344
      ]
    },
    {
      "content": "Storage Analytics metrics",
      "pos": [
        20400,
        20425
      ]
    },
    {
      "content": "About Storage Analytics Metrics",
      "pos": [
        20429,
        20460
      ]
    },
    {
      "content": "Storage Analytics Metrics Table Schema",
      "pos": [
        20515,
        20553
      ]
    },
    {
      "content": "Storage Analytics Logged Operations and Status Messages",
      "pos": [
        20608,
        20663
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Storage Analytics | Microsoft Azure\"\n    description=\"How to manage concurrency for the Blob, Queue, Table, and File services\"\n    services=\"storage\"\n    documentationCenter=\"\"\n    authors=\"tamram\"\n    manager=\"adinah\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"storage\"\n    ms.workload=\"storage\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"dotnet\"\n    ms.topic=\"article\"\n    ms.date=\"06/18/2015\"\n    ms.author=\"tamram\"/>\n\n# Storage Analytics\n\n## Overview\n\nAzure Storage Analytics performs logging and provides metrics data for a storage account. You can use this data to trace requests, analyze usage trends, and diagnose issues with your storage account.\n\nTo use Storage Analytics, you must enable it individually for each service you want to monitor. You can enable it from the [Azure portal](https://manage.windowsazure.com/). For details, see [How to monitor a storage account](http://www.azure.com/manage/services/storage/how-to-monitor-a-storage-account/). You can also enable Storage Analytics programmatically via the REST API or the client library. Use the [Get Blob Service Properties](https://msdn.microsoft.com/library/hh452239.aspx), [Get Queue Service Properties](https://msdn.microsoft.com/library/hh452243.aspx), and [Get Table Service Properties](https://msdn.microsoft.com/library/hh452238.aspx) operations to enable Storage Analytics for each service.\n\nThe aggregated data is stored in a well-known blob (for logging) and in well-known tables (for metrics), which may be accessed using the Blob service and Table service APIs.\n\nStorage Analytics has a 20 TB limit on the amount of stored data that is independent of the total limit for your storage account. For more information about billing and data retention policies, see [Storage Analytics and Billing](https://msdn.microsoft.com/library/hh360997.aspx). For more information about storage account limits, see [Azure Storage Scalability and Performance Targets](https://msdn.microsoft.com/library/dn249410.aspx).\n\nFor an in-depth guide on using Storage Analytics and other tools to identify, diagnose, and troubleshoot Azure Storage-related issues, see [Monitor, diagnose, and troubleshoot Microsoft Azure Storage](storage-monitoring-diagnosing-troubleshooting.md).\n\n\n## About Storage Analytics logging\n\nStorage Analytics logs detailed information about successful and failed requests to a storage service. This information can be used to monitor individual requests and to diagnose issues with a storage service. Requests are logged on a best-effort basis.\n\nLog entries are created only if there is storage service activity. For example, if a storage account has activity in its Blob service but not in its Table or Queue services, only logs pertaining to the Blob service will be created.\n\n### Logging authenticated requests\n\nThe following types of authenticated requests are logged:\n\n- Successful requests.\n\n- Failed requests, including timeout, throttling, network, authorization, and other errors.\n\n- Requests using a Shared Access Signature (SAS), including failed and successful requests.\n\n- Requests to analytics data.\n\nRequests made by Storage Analytics itself, such as log creation or deletion, are not logged. A full list of the logged data is documented in the [Storage Analytics Logged Operations and Status Messages](https://msdn.microsoft.com/library/hh343260.aspx) and [Storage Analytics Log Format](https://msdn.microsoft.com/library/hh343259.aspx) topics.\n\n### Logging anonymous requests\nThe following types of anonymous requests are logged:\n\n- Successful requests.\n\n- Server errors.\n\n- Timeout errors for both client and server.\n\n- Failed GET requests with error code 304 (Not Modified).\n\nAll other failed anonymous requests are not logged. A full list of the logged data is documented in the [Storage Analytics Logged Operations and Status Messages](https://msdn.microsoft.com/library/hh343260.aspx) and [Storage Analytics Log Format](](https://msdn.microsoft.com/library/hh343259.aspx)) topics.\n\n### How logs are stored\nAll logs are stored in block blobs in a container named $logs, which is automatically created when Storage Analytics is enabled for a storage account. The $logs container is located in the blob namespace of the storage account, for example: `http://<accountname>.blob.core.windows.net/$logs`. This container cannot be deleted once Storage Analytics has been enabled, though its contents can be deleted.\n\n>[Azure.NOTE] The $logs container is not displayed when a container listing operation is performed, such as the [ListContainers](https://msdn.microsoft.com/library/ee758348.aspx) method. It must be accessed directly. For example, you can use the [ListBlobs](https://msdn.microsoft.com/library/ee772878.aspx) method to access the blobs in the `$logs` container.\nAs requests are logged, Storage Analytics will upload intermediate results as blocks. Periodically, Storage Analytics will commit these blocks and make them available as a blob.\n\nDuplicate records may exist for logs created in the same hour. You can determine if a record is a duplicate by checking the **RequestId** and **Operation** number.\n\n### Log naming conventions\nEach log will be written in the following format.\n\n    <service-name>/YYYY/MM/DD/hhmm/<counter>.log\n\nThe following table describes each attribute in the log name.\n\n| Attribute         | Description                                                                                                                                                                                   |\n|----------------   |--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------   |\n| <service-name>    | The name of the storage service. For example: blob, table, or queue.                                                                                                                          |\n| YYYY              | The four digit year for the log. For example: 2011.                                                                                                                                           |\n| MM                | The two digit month for the log. For example: 07.                                                                                                                                             |\n| DD                | The two digit month for the log. For example: 07.                                                                                                                                             |\n| hh                | The two digit hour that indicates the starting hour for the logs, in 24 hour UTC format. For example: 18.                                                                                     |\n| mm                | The two digit number that indicates the starting minute for the logs. This value is unsupported in the current version of Storage Analytics, and its value will always be 00.     |\n| <counter>         | A zero-based counter with six digits that indicates the number of log blobs generated for the storage service in an hour time period. This counter starts at 000000. For example: 000001.     |\n\nThe following is a complete sample log name that combines the previous examples.\n\n    blob/2011/07/31/1800/000001.log\n\nThe following is a sample URI that can be used to access the previous log.\n\n    https://<accountname>.blob.core.windows.net/$logs/blob/2011/07/31/1800/000001.log\n\nWhen a storage request is logged, the resulting log name correlates to the hour when the requested operation completed. For example, if a GetBlob request was completed at 6:30 P.M. on 7/31/2011, the log would be written with the following prefix: `blob/2011/07/31/1800/`\n\n### Log metadata\nAll log blobs are stored with metadata that can be used to identify what logging data the blob contains. The following table describes each metadata attribute.\n\n| Attribute     | Description                                                                                                                                                                                                                                                   |\n|------------   |-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------    |\n| LogType       | Describes whether the log contains information pertaining to read, write, or delete operations. This value can include one type or a combination of all three, separated by commas.   Example 1: write Example 2: read,write Example 3: read,write,delete.    |\n| StartTime     | The earliest time of an entry in the log, in the form of YYYY-MM-DDThh:mm:ssZ. For example: 2011-07-31T18:21:46Z.                                                                                                                                             |\n| EndTime       | The latest time of an entry in the log, in the form of YYYY-MM-DDThh:mm:ssZ. For example: 2011-07-31T18:22:09Z.                                                                                                                                               |\n| LogVersion    | The version of the log format. Currently the only supported value is 1.0.                                                                                                                                                                                     |\n\nThe following list displays complete sample metadata using the previous examples.\n\n- LogType=write\n\n- StartTime=2011-07-31T18:21:46Z\n\n- EndTime=2011-07-31T18:22:09Z\n\n- LogVersion=1.0\n\n### Accessing logging data\n\nAll data in the `$logs` container can be accessed by using the Blob service APIs, including the .NET APIs provided by the Azure managed library. The storage account administrator can read and delete logs, but cannot create or update them. Both the log’s metadata and log name can be used when querying for a log. It is possible for a given hour’s logs to appear out of order, but the metadata always specifies the timespan of log entries in a log. Therefore, you can use a combination of log names and metadata when searching for a particular log.\n\n## About Storage Analytics metrics\n\nStorage Analytics can store metrics that include aggregated transaction statistics and capacity data about requests to a storage service. Transactions are reported at both the API operation level as well as at the storage service level, and capacity is reported at the storage service level. Metrics data can be used to analyze storage service usage, diagnose issues with requests made against the storage service, and to improve the performance of applications that use a service.\n\nTo use Storage Analytics, you must enable it individually for each service you want to monitor. You can enable it from the [Azure portal](https://manage.windowsazure.com/). For details, see [How To monitor a storage account](../how-to-monitor-a-storage-account.md). You can also enable Storage Analytics programmatically via the REST API or the client library. [Use the Get Blob Service Properties, Get Queue Service Properties](https://msdn.microsoft.com/library/hh452239.aspx), and [Get Table Service Properties](https://msdn.microsoft.com/library/hh452238.aspx) operations to enable Storage Analytics for each service.\n\n### Transaction metrics\n\nA robust set of data is recorded at hourly or minute intervals for each storage service and requested API operation, including ingress/egress, availability, errors, and categorized request percentages. You can see a complete list of the transaction details in the [Storage Analytics Metrics Table Schema](https://msdn.microsoft.com/library/hh343264.aspx) topic.\n\nTransaction data is recorded at two levels – the service level and the API operation level. At the service level, statistics summarizing all requested API operations are written to a table entity every hour even if no requests were made to the service. At the API operation level, statistics are only written to an entity if the operation was requested within that hour.\n\nFor example, if you perform a **GetBlob** operation on your Blob service, Storage Analytics Metrics will log the request and include it in the aggregated data for both the Blob service as well as the **GetBlob** operation. However, if no **GetBlob** operation is requested during the hour, an entity will not be written to the `$MetricsTransactionsBlob` for that operation.\n\nTransaction metrics are recorded for both user requests and requests made by Storage Analytics itself. For example, requests by Storage Analytics to write logs and table entities are recorded. For more information about how these requests are billed, see [Storage Analytics and Billing](https://msdn.microsoft.com/library/hh360997.aspx).\n\n### Capacity metrics\n\n>[AZURE.NOTE] Currently, capacity metrics are only available for the Blob service. Capacity metrics for the Table service and Queue service will be available in future versions of Storage Analytics.\n\nCapacity data is recorded daily for a storage account’s Blob service, and two table entities are written. One entity provides statistics for user data, and the other provides statistics about the `$logs` blob container used by Storage Analytics. The `$MetricsCapacityBlob` table includes the following statistics:\n\n- **Capacity**: The amount of storage used by the storage account’s Blob service, in bytes.\n\n- **ContainerCount**: The number of blob containers in the storage account’s Blob service.\n\n- **ObjectCount**: The number of committed and uncommitted block or page blobs in the storage account’s Blob service.\n\nFor more information about the capacity metrics, see [Storage Analytics Metrics Table Schema](https://msdn.microsoft.com/library/hh343264.aspx).\n\n### How metrics are stored\n\nAll metrics data for each of the storage services is stored in three tables reserved for that service: one table for transaction information, one table for minute transaction information, and another table for capacity information. Transaction and minute transaction information consists of request and response data, and capacity information consists of storage usage data. Hour metrics, minute metrics, and capacity for a storage account’s Blob service is can be accessed in tables that are named as described in the following table.\n\n| Metrics level                         | Table names                                                                                                                   | Supported versions                                                                                                                        |\n|------------------------------------   |-----------------------------------------------------------------------------------------------------------------------------  |---------------------------------------------------------------------------------------------------------------------------------------------- |\n| Hourly metrics, primary location      |  $MetricsTransactionsBlob <br/>$MetricsTransactionsTable <br/> $MetricsTransactionsQueue                                                  | Versions prior to 2013-08-15 only. While these names are still supported, it’s recommended that you switch to using the tables listed below.  |\n| Hourly metrics, primary location      | $MetricsHourPrimaryTransactionsBlob <br/>$MetricsHourPrimaryTransactionsTable <br/>$MetricsHourPrimaryTransactionsQueue               | All versions, including 2013-08-15.                                                                                                               |\n| Minute metrics, primary location      | $MetricsMinutePrimaryTransactionsBlob <br/>$MetricsMinutePrimaryTransactionsTable <br/>$MetricsMinutePrimaryTransactionsQueue         | All versions, including 2013-08-15.                                                                                                               |\n| Hourly metrics, secondary location    | $MetricsHourSecondaryTransactionsBlob <br/>$MetricsHourSecondaryTransactionsTable <br/>$MetricsHourSecondaryTransactionsQueue         | All versions, including 2013-08-15. Read-access geo-redundant replication must be enabled.                                                    |\n| Minute metrics, secondary location    | $MetricsMinuteSecondaryTransactionsBlob <br/>$MetricsMinuteSecondaryTransactionsTable <br/>$MetricsMinuteSecondaryTransactionsQueue   | All versions, including 2013-08-15. Read-access geo-redundant replication must be enabled.                                                    |\n| Capacity (Blob service only)          | $MetricsCapacityBlob                                                                                                          | All versions, including 2013-08-15.                                                                                                               |\n\n\nThese tables are automatically created when Storage Analytics is enabled for a storage account. They are accessed via the namespace of the storage account, for example: `https://<accountname>.table.core.windows.net/Tables(\"$MetricsTransactionsBlob\")`\n\n### Accessing metrics data\n\nAll data in the metrics tables can be accessed by using the Table service APIs, including the .NET APIs provided by the Azure managed library. The storage account administrator can read and delete table entities, but cannot create or update them.\n\n## Billing for Storage Analytics\n\nStorage Analytics is enabled by a storage account owner; it is not enabled by default. All metrics data is written by the services of a storage account. As a result, each write operation performed by Storage Analytics is billable. Additionally, the amount of storage used by metrics data is also billable.\n\nThe following actions performed by Storage Analytics are billable:\n\n- Requests to create blobs for logging.\n\n- Requests to create table entities for metrics.\n\nIf you have configured a data retention policy, you are not charged for delete transactions when Storage Analytics deletes old logging and metrics data. However, delete transactions from a client are billable. For more information about retention policies, see [Setting a Storage Analytics Data Retention Policy](https://msdn.microsoft.com/library/azure/hh343263.aspx).\n\n### Understanding billable requests\n\nEvery request made to an account’s storage service is either billable or non-billable. Storage Analytics logs each individual request made to a service, including a status message that indicates how the request was handled. Similarly, Storage Analytics stores metrics for both a service and the API operations of that service, including the percentages and count of certain status messages. Together, these features can help you analyze your billable requests, make improvements on your application, and diagnose issues with requests to your services. For more information about billing, see [Understanding Azure Storage Billing - Bandwidth, Transactions, and Capacity](http://blogs.msdn.com/b/windowsazurestorage/archive/2010/07/09/understanding-windows-azure-storage-billing-bandwidth-transactions-and-capacity.aspx).\n\nWhen looking at Storage Analytics data, you can use the tables in the [Storage Analytics Logged Operations and Status Messages](https://msdn.microsoft.com/library/azure/hh343260.aspx) topic to determine what requests are billable. Then you can compare your logs and metrics data to the status messages to see if you were charged for a particular request. You can also use the tables in the previous topic to investigate availability for a storage service or individual API operation.\n\n## Next steps\n\n### Setting up Storage Analytics\n- [How To monitor a storage account](../how-to-monitor-a-storage-account.md)\n- [Enabling and Configuring Storage Analytics](https://msdn.microsoft.com/library/hh360996.aspx)\n\n### Storage Analytics logging  \n- [About Storage Analytics Logging](https://msdn.microsoft.com/library/hh343262.aspx)\n- [Storage Analytics Log Format](https://msdn.microsoft.com/library/hh343259.aspx)\n- [Storage Analytics Logged Operations and Status Messages](https://msdn.microsoftcom/library/hh343260.aspx)\n\n### Storage Analytics metrics\n- [About Storage Analytics Metrics](https://msdn.microsoft.com/library/hh343258.aspx)\n- [Storage Analytics Metrics Table Schema](https://msdn.microsoft.com/library/hh343264.aspx)\n- [Storage Analytics Logged Operations and Status Messages](https://msdn.microsoft.com/library/hh343260.aspx)  \n"
}