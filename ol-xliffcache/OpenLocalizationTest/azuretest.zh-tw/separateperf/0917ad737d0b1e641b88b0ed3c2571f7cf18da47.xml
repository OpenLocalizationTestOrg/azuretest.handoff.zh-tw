{
  "nodes": [
    {
      "content": "Build a Java web application using DocumentDB | Microsoft Azure",
      "pos": [
        28,
        91
      ]
    },
    {
      "content": "This tutorial shows you how to use the Azure DocumentDB service to store and access data from a Java application hosted on Azure Websites.",
      "pos": [
        111,
        249
      ]
    },
    {
      "content": "Build a Java web application using DocumentDB",
      "pos": [
        578,
        623
      ]
    },
    {
      "content": "This tutorial shows you how to use the <bpt id=\"p1\">[</bpt>Microsoft Azure DocumentDB<ept id=\"p1\">](https://portal.azure.com/#gallery/Microsoft.DocumentDB)</ept> service to store and access data from a Java application hosted on Azure Websites.",
      "pos": [
        627,
        833
      ]
    },
    {
      "content": "In this topic, you will learn:",
      "pos": [
        834,
        864
      ]
    },
    {
      "content": "How to build a basic JSP application in Eclipse.",
      "pos": [
        868,
        916
      ]
    },
    {
      "pos": [
        919,
        1045
      ],
      "content": "How to work with the Azure DocumentDB service using the <bpt id=\"p1\">[</bpt>DocumentDB Java SDK<ept id=\"p1\">](https://github.com/Azure/azure-documentdb-java)</ept>."
    },
    {
      "content": "This tutorial shows you how to create a web-based task-management application that enables you to create, retrieve, and mark tasks as complete, as shown in the following image.",
      "pos": [
        1047,
        1223
      ]
    },
    {
      "content": "Each of the tasks in the ToDo list are stored as JSON documents in Azure DocumentDB.",
      "pos": [
        1224,
        1308
      ]
    },
    {
      "content": "My ToDo List application",
      "pos": [
        1312,
        1336
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.TIP]</ph> This tutorial assumes that you have prior experience using Java.",
      "pos": [
        1389,
        1465
      ]
    },
    {
      "content": "If you are new to Java or the <bpt id=\"p1\">[</bpt>prerequisite tools<ept id=\"p1\">](#Prerequisites)</ept>, we recommend downloading the complete <bpt id=\"p2\">[</bpt>todo<ept id=\"p2\">](https://github.com/Azure/azure-documentdb-java/tree/master/tutorial/todo)</ept> project from <bpt id=\"p3\">[</bpt>GitHub<ept id=\"p3\">](https://github.com/Azure/azure-documentdb-java)</ept> and building it using <bpt id=\"p4\">[</bpt>the instructions at the end of this article<ept id=\"p4\">](#GetProject)</ept>.",
      "pos": [
        1466,
        1804
      ]
    },
    {
      "content": "Once you have it built, you can review the article to gain insight on the code in the context of the project.",
      "pos": [
        1805,
        1914
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a id=\"Prerequisites\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Prerequisites",
      "pos": [
        1920,
        1959
      ]
    },
    {
      "content": "Before you begin this tutorial, you must have the following:",
      "pos": [
        1963,
        2023
      ]
    },
    {
      "content": "An active Azure account.",
      "pos": [
        2027,
        2051
      ]
    },
    {
      "content": "If you don't have an account, you can create a free trial account in just a couple of minutes.",
      "pos": [
        2052,
        2146
      ]
    },
    {
      "content": "For details, see <bpt id=\"p1\">[</bpt>Azure Free Trial<ept id=\"p1\">](../../pricing/free-trial/)</ept>.",
      "pos": [
        2147,
        2210
      ]
    },
    {
      "pos": [
        2213,
        2313
      ],
      "content": "<bpt id=\"p1\">[</bpt>Java Development Kit (JDK) 7+<ept id=\"p1\">](http://www.oracle.com/technetwork/java/javase/downloads/index.html)</ept>."
    },
    {
      "content": "Eclipse IDE for Java EE Developers.",
      "pos": [
        2317,
        2352
      ]
    },
    {
      "content": "An Azure Website with a Java runtime environment (e.g. Tomcat or Jetty) enabled.",
      "pos": [
        2439,
        2519
      ]
    },
    {
      "pos": [
        2556,
        2858
      ],
      "content": "If you're installing these tools for the first time, coreservlets.com provides a walk-through of the installation process in the Quick Start section of their <bpt id=\"p1\">[</bpt>Tutorial: Installing TomCat7 and Using it with Eclipse<ept id=\"p1\">](http://www.coreservlets.com/Apache-Tomcat-Tutorial/tomcat-7-with-eclipse.html)</ept> article."
    },
    {
      "content": "<ph id=\"ph1\">&lt;a id=\"CreateDB\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 1: Create a DocumentDB database account",
      "pos": [
        2863,
        2928
      ]
    },
    {
      "content": "To provision a DocumentDB database account in Azure:",
      "pos": [
        2932,
        2984
      ]
    },
    {
      "content": "If you don't already have a database account, create one by following the instructions in <bpt id=\"p1\">[</bpt>Create a database account<ept id=\"p1\">](documentdb-create-account.md)</ept>.",
      "pos": [
        2989,
        3137
      ]
    },
    {
      "content": "If you already have an account, proceed to step 2.",
      "pos": [
        3138,
        3188
      ]
    },
    {
      "pos": [
        3192,
        3409
      ],
      "content": "Using the <bpt id=\"p1\">**</bpt>Keys<ept id=\"p1\">**</ept> blade shown in the following illustration, copy your endpoint <bpt id=\"p2\">**</bpt>URI<ept id=\"p2\">**</ept> and the <bpt id=\"p3\">**</bpt>PRIMARY KEY<ept id=\"p3\">**</ept> to your clipboard and keep them handy as we will use these values in the web application we create next."
    },
    {
      "content": "Screen shot of the Azure Preview portal, showing a DocumentDB account, with the ACTIVE hub highlighted, the Keys button highlighted on the DocumentDB account blade, and the URI, PRIMARY KEY and SECONDARY KEY values highlighted on the Keys blade",
      "pos": [
        3413,
        3657
      ]
    },
    {
      "pos": [
        3666,
        3722
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"CreateJSP\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 2: Create the JSP application"
    },
    {
      "content": "To create the JSP application:",
      "pos": [
        3727,
        3757
      ]
    },
    {
      "content": "First, we’ll start off by creating a Java project.",
      "pos": [
        3763,
        3813
      ]
    },
    {
      "content": "Start Eclipse, then click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Dynamic Web Project<ept id=\"p3\">**</ept>.",
      "pos": [
        3814,
        3904
      ]
    },
    {
      "content": "If you don’t see <bpt id=\"p1\">**</bpt>Dynamic Web Project<ept id=\"p1\">**</ept> listed as an available project, do the following: click <bpt id=\"p2\">**</bpt>File<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>New<ept id=\"p3\">**</ept>, click <bpt id=\"p4\">**</bpt>Project<ept id=\"p4\">**</ept>…, expand <bpt id=\"p5\">**</bpt>Web<ept id=\"p5\">**</ept>, click <bpt id=\"p6\">**</bpt>Dynamic Web Project<ept id=\"p6\">**</ept>, and click <bpt id=\"p7\">**</bpt>Next<ept id=\"p7\">**</ept>.",
      "pos": [
        3905,
        4113
      ]
    },
    {
      "content": "Enter a project name in the <bpt id=\"p1\">**</bpt>Project name<ept id=\"p1\">**</ept> box, and in the <bpt id=\"p2\">**</bpt>Target Runtime<ept id=\"p2\">**</ept> drop-down menu, optionally select a value (e.g. Apache Tomcat v7.0), and then click <bpt id=\"p3\">**</bpt>Finish<ept id=\"p3\">**</ept>.",
      "pos": [
        4177,
        4352
      ]
    },
    {
      "content": "Selecting a target runtime enables you to run your project locally through Eclipse.",
      "pos": [
        4353,
        4436
      ]
    },
    {
      "content": "In Eclipse, in the Project Explorer view, expand your project.",
      "pos": [
        4440,
        4502
      ]
    },
    {
      "content": "Right-click <bpt id=\"p1\">**</bpt>WebContent<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>JSP File<ept id=\"p3\">**</ept>.",
      "pos": [
        4503,
        4574
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>New JSP File<ept id=\"p1\">**</ept> dialog box, name the file <bpt id=\"p2\">**</bpt>index.jsp<ept id=\"p2\">**</ept>.",
      "pos": [
        4578,
        4642
      ]
    },
    {
      "content": "Keep the parent folder as <bpt id=\"p1\">**</bpt>WebContent<ept id=\"p1\">**</ept>, as shown in the following illustration, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.",
      "pos": [
        4643,
        4749
      ]
    },
    {
      "pos": [
        4812,
        4946
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Select JSP Template<ept id=\"p1\">**</ept> dialog box, for the purpose of this tutorial select <bpt id=\"p2\">**</bpt>New JSP File (html)<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Finish<ept id=\"p3\">**</ept>."
    },
    {
      "content": "When the index.jsp file opens in Eclipse, add text to display <bpt id=\"p1\">**</bpt>Hello World!<ept id=\"p1\">**</ept> within the existing",
      "pos": [
        4951,
        5049
      ]
    },
    {
      "content": "element.",
      "pos": [
        5057,
        5065
      ]
    },
    {
      "content": "Your updated",
      "pos": [
        5066,
        5078
      ]
    },
    {
      "content": "content should look like the following code:",
      "pos": [
        5086,
        5130
      ]
    },
    {
      "content": "Save the index.jsp file.",
      "pos": [
        5218,
        5242
      ]
    },
    {
      "pos": [
        5247,
        5365
      ],
      "content": "If you set a target runtime in step 2, you can click <bpt id=\"p1\">**</bpt>Project<ept id=\"p1\">**</ept> and then <bpt id=\"p2\">**</bpt>Run<ept id=\"p2\">**</ept> to run your JSP application locally:"
    },
    {
      "pos": [
        5427,
        5489
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"InstallSDK\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 3: Install the DocumentDB Java SDK"
    },
    {
      "pos": [
        5494,
        5618
      ],
      "content": "The easiest way to pull in the DocumentDB Java SDK and its dependencies is through <bpt id=\"p1\">[</bpt>Apache Maven<ept id=\"p1\">](http://maven.apache.org/)</ept>."
    },
    {
      "content": "To do this, you will need to convert your project to a maven project by completing the following steps:",
      "pos": [
        5620,
        5723
      ]
    },
    {
      "pos": [
        5729,
        5835
      ],
      "content": "Right-click your project in the Project Explorer, click <bpt id=\"p1\">**</bpt>Configure<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Convert to Maven Project<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        5839,
        5914
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Create new POM<ept id=\"p1\">**</ept> window, accept the defaults and click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        5918,
        5965
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Project Explorer<ept id=\"p1\">**</ept>, open the pom.xml file."
    },
    {
      "pos": [
        5970,
        6043
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Dependencies<ept id=\"p1\">**</ept> tab, in the <bpt id=\"p2\">**</bpt>Dependencies<ept id=\"p2\">**</ept> pane, click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        6047,
        6101
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Select Dependency<ept id=\"p1\">**</ept> window, do the following:"
    },
    {
      "pos": [
        6105,
        6155
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>GroupId<ept id=\"p1\">**</ept> box, enter com.microsoft.azure."
    },
    {
      "pos": [
        6159,
        6209
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Artifact Id<ept id=\"p1\">**</ept> box enter azure-documentdb."
    },
    {
      "pos": [
        6213,
        6248
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Version<ept id=\"p1\">**</ept> box enter 1.1.0."
    },
    {
      "content": "Or add the dependency XML for GroupId and ArtifactId directly to the pom.xml via a text editor:",
      "pos": [
        6312,
        6407
      ]
    },
    {
      "pos": [
        6598,
        6658
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Ok<ept id=\"p1\">**</ept> and Maven will install the DocumentDB Java SDK."
    },
    {
      "content": "Save the pom.xml file.",
      "pos": [
        6662,
        6684
      ]
    },
    {
      "pos": [
        6688,
        6769
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"UseService\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 4: Using the DocumentDB service in a Java application"
    },
    {
      "content": "First, let's define the TodoItem object:",
      "pos": [
        6777,
        6817
      ]
    },
    {
      "content": "In this project, we are using <bpt id=\"p1\">[</bpt>Project Lombok<ept id=\"p1\">](http://projectlombok.org/)</ept> to generate the constructor, getters, setters, and a builder.",
      "pos": [
        7036,
        7171
      ]
    },
    {
      "content": "Alternatively, you can write this code manually or have the IDE generate it.",
      "pos": [
        7172,
        7248
      ]
    },
    {
      "content": "To invoke the DocumentDB service, you must instantiate a new <bpt id=\"p1\">**</bpt>DocumentClient<ept id=\"p1\">**</ept>.",
      "pos": [
        7253,
        7333
      ]
    },
    {
      "content": "In general, it is best to reuse the <bpt id=\"p1\">**</bpt>DocumentClient<ept id=\"p1\">**</ept> - rather than construct a new client for each subsequent request.",
      "pos": [
        7334,
        7454
      ]
    },
    {
      "content": "We can reuse the client by wrapping the client in a <bpt id=\"p1\">**</bpt>DocumentClientFactory<ept id=\"p1\">**</ept>.",
      "pos": [
        7455,
        7533
      ]
    },
    {
      "content": "This is also where you need to paste the URI and PRIMARY KEY value you saved to your clipboard in <bpt id=\"p1\">[</bpt>step 1<ept id=\"p1\">](#CreateDB)</ept>.",
      "pos": [
        7534,
        7652
      ]
    },
    {
      "content": "Replace [YOUR\\_ENDPOINT\\_HERE] with your URI and replace [YOUR\\_KEY\\_HERE] with your PRIMARY KEY.",
      "pos": [
        7653,
        7750
      ]
    },
    {
      "content": "Now let's create a Data Access Object (DAO) to abstract persisting our ToDo items to DocumentDB.",
      "pos": [
        8272,
        8368
      ]
    },
    {
      "content": "In order to save ToDo items to a collection, the client needs to know which database and collection to persist to (as referenced by self-links).",
      "pos": [
        8374,
        8518
      ]
    },
    {
      "content": "In general, it is best to cache the database and collection when possible to avoid additional round-trips to the database.",
      "pos": [
        8519,
        8641
      ]
    },
    {
      "content": "The following code illustrates how to retrieve our database and collection, if it exists, or create a new one if it doesn't exist:",
      "pos": [
        8647,
        8777
      ]
    },
    {
      "content": "The next step is to write some code to persist the TodoItems in to the collection.",
      "pos": [
        13277,
        13359
      ]
    },
    {
      "content": "In this example, we will use <bpt id=\"p1\">[</bpt>Gson<ept id=\"p1\">](https://code.google.com/p/google-gson/)</ept> to serialize and de-serialize TodoItem Plain Old Java Objects (POJOs) to JSON documents.",
      "pos": [
        13360,
        13524
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Jackson<ept id=\"p1\">](http://jackson.codehaus.org/)</ept> or your own custom serializer are also great alternatives for serializing POJOs.",
      "pos": [
        13525,
        13645
      ]
    },
    {
      "content": "Like DocumentDB databases and collections, documents are also referenced by self-links.",
      "pos": [
        14707,
        14794
      ]
    },
    {
      "content": "The following helper function lets us retrieve documents by another attribute (e.g. \"id\") rather than self-link:",
      "pos": [
        14795,
        14907
      ]
    },
    {
      "content": "We can use the helper method in step 5 to retrieve a TodoItem JSON document by id and then deserialize it to a POJO:",
      "pos": [
        15456,
        15572
      ]
    },
    {
      "content": "We can also use the DocumentClient to get a collection or list of TodoItems using DocumentDB SQL:",
      "pos": [
        16045,
        16142
      ]
    },
    {
      "content": "There are many ways to update a document with the DocumentClient.",
      "pos": [
        16910,
        16975
      ]
    },
    {
      "content": "In our Todo list application, we want to be able to toggle whether a TodoItem is complete.",
      "pos": [
        16976,
        17066
      ]
    },
    {
      "content": "This can be achieved by updating the \"complete\" attribute within the document:",
      "pos": [
        17067,
        17145
      ]
    },
    {
      "content": "Finally, we want the ability to delete a TodoItem from our list.",
      "pos": [
        18125,
        18189
      ]
    },
    {
      "content": "To do this, we can use the helper method we wrote earlier to retrieve the self-link and then tell the client to delete it:",
      "pos": [
        18190,
        18312
      ]
    },
    {
      "pos": [
        18929,
        19001
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"Wire\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph> Step 5: Wiring the rest of the of application together"
    },
    {
      "content": "Now that we've finished the fun bits - all that left is to build a quick user interface and wire it up to our DAO.",
      "pos": [
        19006,
        19120
      ]
    },
    {
      "content": "First, let's start with building a controller to call our DAO:",
      "pos": [
        19125,
        19187
      ]
    },
    {
      "content": "In a more complex application, the controller may house complicated business logic on top of the DAO.",
      "pos": [
        20684,
        20785
      ]
    },
    {
      "content": "Next, we'll create a servlet to route HTTP requests to the controller:",
      "pos": [
        20790,
        20860
      ]
    },
    {
      "content": "We'll need a Web User Interface to display to the user.",
      "pos": [
        23604,
        23659
      ]
    },
    {
      "content": "Let's re-write the index.jsp we created earlier:",
      "pos": [
        23660,
        23708
      ]
    },
    {
      "content": "And finally, write some client-side Javascript to tie the web user interface and the servlet together:",
      "pos": [
        26796,
        26898
      ]
    },
    {
      "content": "Awesome!",
      "pos": [
        32550,
        32558
      ]
    },
    {
      "content": "Now all that's left is to test the application.",
      "pos": [
        32559,
        32606
      ]
    },
    {
      "content": "Run the application locally, and add some Todo items by filling in the item name and category and clicking <bpt id=\"p1\">**</bpt>Add Task<ept id=\"p1\">**</ept>.",
      "pos": [
        32607,
        32727
      ]
    },
    {
      "pos": [
        32732,
        32847
      ],
      "content": "Once the item appears, you can update whether it's complete by toggling the checkbox and clicking <bpt id=\"p1\">**</bpt>Update Tasks<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        32851,
        32919
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"Deploy\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 6: Deploy your application to Azure Websites"
    },
    {
      "content": "Azure Websites makes deploying Java Applications as simple as exporting your application as a WAR file and either uploading it via source control (e.g. GIT) or FTP.",
      "pos": [
        32924,
        33088
      ]
    },
    {
      "pos": [
        33093,
        33229
      ],
      "content": "To export your application as a WAR, right-click on your project in <bpt id=\"p1\">**</bpt>Project Explorer<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Export<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>WAR File<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        33234,
        33281
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>WAR Export<ept id=\"p1\">**</ept> window, do the following:"
    },
    {
      "content": "In the Web project box, enter azure-documentdb-java-sample.",
      "pos": [
        33285,
        33344
      ]
    },
    {
      "content": "In the Destination box, choose a destination to save the WAR file.",
      "pos": [
        33348,
        33414
      ]
    },
    {
      "pos": [
        33418,
        33435
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Now that you have a WAR file in hand, you can simply upload it to your Azure Website's <bpt id=\"p1\">**</bpt>webapps<ept id=\"p1\">**</ept> directory.",
      "pos": [
        33440,
        33549
      ]
    },
    {
      "content": "For instructions on uploading the file, see <bpt id=\"p1\">[</bpt>Adding an application to your Java website on Azure<ept id=\"p1\">](../web-sites-java-add-app.md)</ept>.",
      "pos": [
        33550,
        33678
      ]
    },
    {
      "content": "Once the WAR file is uploaded to the webapps directory, the runtime environment will detect that you've added it and will automatically load it.",
      "pos": [
        33684,
        33828
      ]
    },
    {
      "content": "To view your finished product, navigate to http://YOUR\\_SITE\\_NAME.azurewebsites.net/azure-documentdb-java-sample/ and start adding your tasks!",
      "pos": [
        33832,
        33975
      ]
    },
    {
      "pos": [
        33979,
        34029
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"GetProject\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Get the project from GitHub"
    },
    {
      "content": "All the samples in this tutorial are included in the <bpt id=\"p1\">[</bpt>todo<ept id=\"p1\">](https://github.com/Azure/azure-documentdb-java/tree/master/tutorial/todo)</ept> project on GitHub, which is part of the <bpt id=\"p2\">[</bpt>azure-documentdb-java<ept id=\"p2\">](https://github.com/Azure/azure-documentdb-java)</ept> repository.",
      "pos": [
        34033,
        34290
      ]
    },
    {
      "content": "To import the todo project into Eclipse, ensure you have the software and resources listed in the <bpt id=\"p1\">[</bpt>Prerequisites<ept id=\"p1\">](#Prerequisites)</ept> section, then do the following:",
      "pos": [
        34291,
        34452
      ]
    },
    {
      "content": "Install <bpt id=\"p1\">[</bpt>Project Lombok<ept id=\"p1\">](http://projectlombok.org/)</ept>.",
      "pos": [
        34457,
        34509
      ]
    },
    {
      "content": "Lombok is used to generate constructors, getters, setters in the project.",
      "pos": [
        34510,
        34583
      ]
    },
    {
      "content": "Once you have downloaded the lombok.jar file, double-click it to install it or install it from the command line.",
      "pos": [
        34584,
        34696
      ]
    },
    {
      "content": "If Eclipse is open, close it and restart it to load Lombok.",
      "pos": [
        34701,
        34760
      ]
    },
    {
      "pos": [
        34764,
        34815
      ],
      "content": "In Eclipse, on the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Import<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        34819,
        34913
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Import<ept id=\"p1\">**</ept> window, click <bpt id=\"p2\">**</bpt>Git<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Projects from Git<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>Next<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        34918,
        34982
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Select Repository Source<ept id=\"p1\">**</ept> screen, click <bpt id=\"p2\">**</bpt>Clone URI<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        34986,
        35129
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Source Git Repository<ept id=\"p1\">**</ept> screen, in the <bpt id=\"p2\">**</bpt>URI<ept id=\"p2\">**</ept> box, enter https://github.com/Azure/azure-documentdb-java.git, and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        35133,
        35229
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Branch Selection<ept id=\"p1\">**</ept> screen, ensure that <bpt id=\"p2\">**</bpt>master<ept id=\"p2\">**</ept> is selected, and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        35233,
        35366
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Local Destination<ept id=\"p1\">**</ept> screen, click <bpt id=\"p2\">**</bpt>Browse<ept id=\"p2\">**</ept> to select a folder where the repository can be copied, and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        35370,
        35513
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Select a wizard to use for importing projects<ept id=\"p1\">**</ept> screen, ensure that <bpt id=\"p2\">**</bpt>Import existing projects<ept id=\"p2\">**</ept> is selected, and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."
    },
    {
      "content": "On the <bpt id=\"p1\">**</bpt>Import Projects<ept id=\"p1\">**</ept> screen, unselect the <bpt id=\"p2\">**</bpt>DocumentDB<ept id=\"p2\">**</ept> project, and then click <bpt id=\"p3\">**</bpt>Finish<ept id=\"p3\">**</ept>.",
      "pos": [
        35518,
        35616
      ]
    },
    {
      "content": "The DocumentDB project contains the DocumentDB Java SDK, which we will add as a dependency instead.",
      "pos": [
        35617,
        35716
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Project Explorer<ept id=\"p1\">**</ept>, navigate to azure-documentdb-java-sample\\src\\com.microsoft.azure.documentdb.sample.dao\\DocumentClientFactory.java and replace the HOST and MASTER_KEY values with the URI and PRIMARY KEY for your DocumentDB account, and then save the file.",
      "pos": [
        35721,
        35984
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Step 1. Create a DocumentDB database account<ept id=\"p1\">](#CreateDB)</ept>.",
      "pos": [
        35985,
        36069
      ]
    },
    {
      "pos": [
        36074,
        36211
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Project Explorer<ept id=\"p1\">**</ept>, right click the <bpt id=\"p2\">**</bpt>azure-documentdb-java-sample<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Build Path<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>Configure Build Path<ept id=\"p4\">**</ept>."
    },
    {
      "content": "On the <bpt id=\"p1\">**</bpt>Java Build Path<ept id=\"p1\">**</ept> screen, in the right pane, select the <bpt id=\"p2\">**</bpt>Libraries<ept id=\"p2\">**</ept> tab, and then click <bpt id=\"p3\">**</bpt>Add External JARs<ept id=\"p3\">**</ept>.",
      "pos": [
        36216,
        36337
      ]
    },
    {
      "content": "Navigate to the location of the lombok.jar file, and click <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.",
      "pos": [
        36338,
        36429
      ]
    },
    {
      "pos": [
        36434,
        36541
      ],
      "content": "Use step 12 to open the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window again, and then in the left pane click <bpt id=\"p2\">**</bpt>Targeted Runtimes<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        36546,
        36651
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Targeted Runtimes<ept id=\"p1\">**</ept> screen, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, select <bpt id=\"p3\">**</bpt>Apache Tomcat v7.0<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>OK<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        36656,
        36760
      ],
      "content": "Use step 12 to open the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window again, and then in the left pane click <bpt id=\"p2\">**</bpt>Project Facets<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        36765,
        36865
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Project Facets<ept id=\"p1\">**</ept> screen, select <bpt id=\"p2\">**</bpt>Dynamic Web Module<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Java<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>OK<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        36870,
        37004
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Servers<ept id=\"p1\">**</ept> tab at the bottom of the screen, right-click <bpt id=\"p2\">**</bpt>Tomcat v7.0 Server at localhost<ept id=\"p2\">**</ept> and then click <bpt id=\"p3\">**</bpt>Add and Remove<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        37009,
        37134
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Add and Remove<ept id=\"p1\">**</ept> window, move <bpt id=\"p2\">**</bpt>azure-documentdb-java-sample<ept id=\"p2\">**</ept> to the <bpt id=\"p3\">**</bpt>Configured<ept id=\"p3\">**</ept> box, and then click <bpt id=\"p4\">**</bpt>Finish<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        37140,
        37239
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Server<ept id=\"p1\">**</ept> tab, right-click <bpt id=\"p2\">**</bpt>Tomcat v7.0 Server at localhost<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Restart<ept id=\"p3\">**</ept>."
    },
    {
      "content": "In a browser, navigate to http://localhost:8080/azure-documentdb-java-sample/ and start adding to your task list.",
      "pos": [
        37244,
        37357
      ]
    },
    {
      "content": "Note that if you changed your default port values, change 8080 to the value you selected.",
      "pos": [
        37358,
        37447
      ]
    },
    {
      "pos": [
        37452,
        37562
      ],
      "content": "To deploy your project to an Azure web site, see <bpt id=\"p1\">[</bpt>Step 6. Deploy your application to Azure Websites<ept id=\"p1\">](#Deploy)</ept>."
    },
    {
      "content": "test",
      "pos": [
        37616,
        37620
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Build a Java web application using DocumentDB | Microsoft Azure\" \n    description=\"This tutorial shows you how to use the Azure DocumentDB service to store and access data from a Java application hosted on Azure Websites.\" \n    services=\"documentdb\" \n    documentationCenter=\"java\" \n    authors=\"aliuy\" \n    manager=\"jhubbard\" \n    editor=\"monicar\"/>\n\n<tags \n    ms.service=\"documentdb\" \n    ms.devlang=\"java\" \n    ms.topic=\"hero-article\" \n    ms.tgt_pltfrm=\"NA\" \n    ms.workload=\"data-services\" \n    ms.date=\"07/21/2015\" \n    ms.author=\"andrl\"/>\n\n# Build a Java web application using DocumentDB #\n\nThis tutorial shows you how to use the [Microsoft Azure DocumentDB](https://portal.azure.com/#gallery/Microsoft.DocumentDB) service to store and access data from a Java application hosted on Azure Websites. In this topic, you will learn:\n\n- How to build a basic JSP application in Eclipse.\n- How to work with the Azure DocumentDB service using the [DocumentDB Java SDK](https://github.com/Azure/azure-documentdb-java).\n\nThis tutorial shows you how to create a web-based task-management application that enables you to create, retrieve, and mark tasks as complete, as shown in the following image. Each of the tasks in the ToDo list are stored as JSON documents in Azure DocumentDB.\n\n![My ToDo List application](./media/documentdb-java-application/image1.png)\n\n> [AZURE.TIP] This tutorial assumes that you have prior experience using Java. If you are new to Java or the [prerequisite tools](#Prerequisites), we recommend downloading the complete [todo](https://github.com/Azure/azure-documentdb-java/tree/master/tutorial/todo) project from [GitHub](https://github.com/Azure/azure-documentdb-java) and building it using [the instructions at the end of this article](#GetProject). Once you have it built, you can review the article to gain insight on the code in the context of the project.  \n\n##<a id=\"Prerequisites\"></a>Prerequisites ##\nBefore you begin this tutorial, you must have the following:\n\n- An active Azure account. If you don't have an account, you can create a free trial account in just a couple of minutes. For details, see [Azure Free Trial](../../pricing/free-trial/).\n- [Java Development Kit (JDK) 7+](http://www.oracle.com/technetwork/java/javase/downloads/index.html).\n- [Eclipse IDE for Java EE Developers.](http://www.eclipse.org/downloads/packages/eclipse-ide-java-ee-developers/lunasr1)\n- [An Azure Website with a Java runtime environment (e.g. Tomcat or Jetty) enabled.](../web-sites-java-get-started.md)\n\nIf you're installing these tools for the first time, coreservlets.com provides a walk-through of the installation process in the Quick Start section of their [Tutorial: Installing TomCat7 and Using it with Eclipse](http://www.coreservlets.com/Apache-Tomcat-Tutorial/tomcat-7-with-eclipse.html) article. \n\n##<a id=\"CreateDB\"></a>Step 1: Create a DocumentDB database account ##\nTo provision a DocumentDB database account in Azure:\n\n1. If you don't already have a database account, create one by following the instructions in [Create a database account](documentdb-create-account.md). If you already have an account, proceed to step 2.\n2. Using the **Keys** blade shown in the following illustration, copy your endpoint **URI** and the **PRIMARY KEY** to your clipboard and keep them handy as we will use these values in the web application we create next.\n\n![Screen shot of the Azure Preview portal, showing a DocumentDB account, with the ACTIVE hub highlighted, the Keys button highlighted on the DocumentDB account blade, and the URI, PRIMARY KEY and SECONDARY KEY values highlighted on the Keys blade][1]\n\n\n##<a id=\"CreateJSP\"></a>Step 2: Create the JSP application ##\n\nTo create the JSP application: \n\n1. First, we’ll start off by creating a Java project. Start Eclipse, then click **File**, click **New**, and then click **Dynamic Web Project**. If you don’t see **Dynamic Web Project** listed as an available project, do the following: click **File**, click **New**, click **Project**…, expand **Web**, click **Dynamic Web Project**, and click **Next**. \n\n    ![](./media/documentdb-java-application/image10.png)\n\n2. Enter a project name in the **Project name** box, and in the **Target Runtime** drop-down menu, optionally select a value (e.g. Apache Tomcat v7.0), and then click **Finish**. Selecting a target runtime enables you to run your project locally through Eclipse.\n3. In Eclipse, in the Project Explorer view, expand your project. Right-click **WebContent**, click **New**, and then click **JSP File**.\n4. In the **New JSP File** dialog box, name the file **index.jsp**. Keep the parent folder as **WebContent**, as shown in the following illustration, and then click **Next**.\n\n    ![](./media/documentdb-java-application/image11.png)\n\n5. In the **Select JSP Template** dialog box, for the purpose of this tutorial select **New JSP File (html)**, and then click **Finish**.\n\n6. When the index.jsp file opens in Eclipse, add text to display **Hello World!** within the existing <body> element. Your updated <body> content should look like the following code:\n    \n        <body>\n            <% out.println(\"Hello World!\"); %>\n        </body>\n\n8. Save the index.jsp file. \n9. If you set a target runtime in step 2, you can click **Project** and then **Run** to run your JSP application locally:\n\n    ![](./media/documentdb-java-application/image12.png)\n\n##<a id=\"InstallSDK\"></a>Step 3: Install the DocumentDB Java SDK ##\n\nThe easiest way to pull in the DocumentDB Java SDK and its dependencies is through [Apache Maven](http://maven.apache.org/).\n\nTo do this, you will need to convert your project to a maven project by completing the following steps: \n\n1. Right-click your project in the Project Explorer, click **Configure**, click **Convert to Maven Project**.\n2. In the **Create new POM** window, accept the defaults and click **Finish**.\n3. In **Project Explorer**, open the pom.xml file. \n4. On the **Dependencies** tab, in the **Dependencies** pane, click **Add**.\n4. In the **Select Dependency** window, do the following:\n - In the **GroupId** box, enter com.microsoft.azure.\n - In the **Artifact Id** box enter azure-documentdb.\n - In the **Version** box enter 1.1.0.\n\n    ![](./media/documentdb-java-application/image13.png)\n\n    Or add the dependency XML for GroupId and ArtifactId directly to the pom.xml via a text editor:\n\n        <dependency>\n            <groupId>com.microsoft.azure</groupId>\n            <artifactId>azure-documentdb</artifactId>\n            <version>1.1.0</version>\n        </dependency>\n\n5. Click **Ok** and Maven will install the DocumentDB Java SDK.\n6. Save the pom.xml file.\n\n##<a id=\"UseService\"></a>Step 4: Using the DocumentDB service in a Java application ##\n\n1. First, let's define the TodoItem object:\n\n        @Data\n        @Builder\n        public class TodoItem {\n            private String category;\n            private boolean complete;\n            private String id;\n            private String name;\n        }\n\n    In this project, we are using [Project Lombok](http://projectlombok.org/) to generate the constructor, getters, setters, and a builder. Alternatively, you can write this code manually or have the IDE generate it.\n\n2. To invoke the DocumentDB service, you must instantiate a new **DocumentClient**. In general, it is best to reuse the **DocumentClient** - rather than construct a new client for each subsequent request. We can reuse the client by wrapping the client in a **DocumentClientFactory**. This is also where you need to paste the URI and PRIMARY KEY value you saved to your clipboard in [step 1](#CreateDB). Replace [YOUR\\_ENDPOINT\\_HERE] with your URI and replace [YOUR\\_KEY\\_HERE] with your PRIMARY KEY.\n\n        private static final String HOST = \"[YOUR_ENDPOINT_HERE]\";\n        private static final String MASTER_KEY = \"[YOUR_KEY_HERE]\";\n    \n        private static DocumentClient documentClient;\n    \n        public static DocumentClient getDocumentClient() {\n            if (documentClient == null) {\n                documentClient = new DocumentClient(HOST, MASTER_KEY,\n                        ConnectionPolicy.GetDefault(), ConsistencyLevel.Session);\n            }\n    \n            return documentClient;\n        }\n\n3. Now let's create a Data Access Object (DAO) to abstract persisting our ToDo items to DocumentDB.\n\n    In order to save ToDo items to a collection, the client needs to know which database and collection to persist to (as referenced by self-links). In general, it is best to cache the database and collection when possible to avoid additional round-trips to the database.\n\n    The following code illustrates how to retrieve our database and collection, if it exists, or create a new one if it doesn't exist:\n\n        public class DocDbDao implements TodoDao {\n            // The name of our database.\n            private static final String DATABASE_ID = \"TodoDB\";\n        \n            // The name of our collection.\n            private static final String COLLECTION_ID = \"TodoCollection\";\n        \n            // The DocumentDB Client\n            private static DocumentClient documentClient = DocumentClientFactory\n                    .getDocumentClient();\n        \n            // Cache for the database object, so we don't have to query for it to\n            // retrieve self links.\n            private static Database databaseCache;\n        \n            // Cache for the collection object, so we don't have to query for it to\n            // retrieve self links.\n            private static DocumentCollection collectionCache;\n        \n            private Database getTodoDatabase() {\n                if (databaseCache == null) {\n                    // Get the database if it exists\n                    List<Database> databaseList = documentClient\n                            .queryDatabases(\n                                    \"SELECT * FROM root r WHERE r.id='\" + DATABASE_ID\n                                            + \"'\", null).getQueryIterable().toList();\n        \n                    if (databaseList.size() > 0) {\n                        // Cache the database object so we won't have to query for it\n                        // later to retrieve the selfLink.\n                        databaseCache = databaseList.get(0);\n                    } else {\n                        // Create the database if it doesn't exist.\n                        try {\n                            Database databaseDefinition = new Database();\n                            databaseDefinition.setId(DATABASE_ID);\n        \n                            databaseCache = documentClient.createDatabase(\n                                    databaseDefinition, null).getResource();\n                        } catch (DocumentClientException e) {\n                            // TODO: Something has gone terribly wrong - the app wasn't\n                            // able to query or create the collection.\n                            // Verify your connection, endpoint, and key.\n                            e.printStackTrace();\n                        }\n                    }\n                }\n        \n                return databaseCache;\n            }\n        \n            private DocumentCollection getTodoCollection() {\n                if (collectionCache == null) {\n                    // Get the collection if it exists.\n                    List<DocumentCollection> collectionList = documentClient\n                            .queryCollections(\n                                    getTodoDatabase().getSelfLink(),\n                                    \"SELECT * FROM root r WHERE r.id='\" + COLLECTION_ID\n                                            + \"'\", null).getQueryIterable().toList();\n        \n                    if (collectionList.size() > 0) {\n                        // Cache the collection object so we won't have to query for it\n                        // later to retrieve the selfLink.\n                        collectionCache = collectionList.get(0);\n                    } else {\n                        // Create the collection if it doesn't exist.\n                        try {\n                            DocumentCollection collectionDefinition = new DocumentCollection();\n                            collectionDefinition.setId(COLLECTION_ID);\n\n                            // Configure the new collection performance tier to S1.\n                            RequestOptions requestOptions = new RequestOptions();\n                            requestOptions.setOfferType(\"S1\");\n        \n                            collectionCache = documentClient.createCollection(\n                                    getTodoDatabase().getSelfLink(),\n                                    collectionDefinition, requestOptions).getResource();\n                        } catch (DocumentClientException e) {\n                            // TODO: Something has gone terribly wrong - the app wasn't\n                            // able to query or create the collection.\n                            // Verify your connection, endpoint, and key.\n                            e.printStackTrace();\n                        }\n                    }\n                }\n        \n                return collectionCache;\n            }\n        }\n\n4. The next step is to write some code to persist the TodoItems in to the collection. In this example, we will use [Gson](https://code.google.com/p/google-gson/) to serialize and de-serialize TodoItem Plain Old Java Objects (POJOs) to JSON documents. [Jackson](http://jackson.codehaus.org/) or your own custom serializer are also great alternatives for serializing POJOs.\n\n        // We'll use Gson for POJO <=> JSON serialization for this example.\n        private static Gson gson = new Gson();\n\n        @Override\n        public TodoItem createTodoItem(TodoItem todoItem) {\n            // Serialize the TodoItem as a JSON Document.\n            Document todoItemDocument = new Document(gson.toJson(todoItem));\n    \n            // Annotate the document as a TodoItem for retrieval (so that we can\n            // store multiple entity types in the collection).\n            todoItemDocument.set(\"entityType\", \"todoItem\");\n    \n            try {\n                // Persist the document using the DocumentClient.\n                todoItemDocument = documentClient.createDocument(\n                        getTodoCollection().getSelfLink(), todoItemDocument, null,\n                        false).getResource();\n            } catch (DocumentClientException e) {\n                e.printStackTrace();\n                return null;\n            }\n    \n            return gson.fromJson(todoItemDocument.toString(), TodoItem.class);\n        }\n\n\n\n5. Like DocumentDB databases and collections, documents are also referenced by self-links. The following helper function lets us retrieve documents by another attribute (e.g. \"id\") rather than self-link:\n\n        private Document getDocumentById(String id) {\n            // Retrieve the document using the DocumentClient.\n            List<Document> documentList = documentClient\n                    .queryDocuments(getTodoCollection().getSelfLink(),\n                            \"SELECT * FROM root r WHERE r.id='\" + id + \"'\", null)\n                    .getQueryIterable().toList();\n    \n            if (documentList.size() > 0) {\n                return documentList.get(0);\n            } else {\n                return null;\n            }\n        }\n\n6. We can use the helper method in step 5 to retrieve a TodoItem JSON document by id and then deserialize it to a POJO: \n\n        @Override\n        public TodoItem readTodoItem(String id) {\n            // Retrieve the document by id using our helper method.\n            Document todoItemDocument = getDocumentById(id);\n    \n            if (todoItemDocument != null) {\n                // De-serialize the document in to a TodoItem.\n                return gson.fromJson(todoItemDocument.toString(), TodoItem.class);\n            } else {\n                return null;\n            }\n        }\n\n7. We can also use the DocumentClient to get a collection or list of TodoItems using DocumentDB SQL:\n    \n        @Override\n        public List<TodoItem> readTodoItems() {\n            List<TodoItem> todoItems = new ArrayList<TodoItem>();\n    \n            // Retrieve the TodoItem documents\n            List<Document> documentList = documentClient\n                    .queryDocuments(getTodoCollection().getSelfLink(),\n                            \"SELECT * FROM root r WHERE r.entityType = 'todoItem'\",\n                            null).getQueryIterable().toList();\n    \n            // De-serialize the documents in to TodoItems.\n            for (Document todoItemDocument : documentList) {\n                todoItems.add(gson.fromJson(todoItemDocument.toString(),\n                        TodoItem.class));\n            }\n    \n            return todoItems;\n        }\n\n8. There are many ways to update a document with the DocumentClient. In our Todo list application, we want to be able to toggle whether a TodoItem is complete. This can be achieved by updating the \"complete\" attribute within the document:\n    \n        @Override\n        public TodoItem updateTodoItem(String id, boolean isComplete) {\n            // Retrieve the document from the database\n            Document todoItemDocument = getDocumentById(id);\n    \n            // You can update the document as a JSON document directly.\n            // For more complex operations - you could de-serialize the document in\n            // to a POJO, update the POJO, and then re-serialize the POJO back in to\n            // a document.\n            todoItemDocument.set(\"complete\", isComplete);\n    \n            try {\n                // Persist/replace the updated document.\n                todoItemDocument = documentClient.replaceDocument(todoItemDocument,\n                        null).getResource();\n            } catch (DocumentClientException e) {\n                e.printStackTrace();\n                return null;\n            }\n    \n            return gson.fromJson(todoItemDocument.toString(), TodoItem.class);\n        }\n\n9. Finally, we want the ability to delete a TodoItem from our list. To do this, we can use the helper method we wrote earlier to retrieve the self-link and then tell the client to delete it:\n    \n        @Override\n        public boolean deleteTodoItem(String id) {\n            // DocumentDB refers to documents by self link rather than id.\n    \n            // Query for the document to retrieve the self link.\n            Document todoItemDocument = getDocumentById(id);\n    \n            try {\n                // Delete the document by self link.\n                documentClient.deleteDocument(todoItemDocument.getSelfLink(), null);\n            } catch (DocumentClientException e) {\n                e.printStackTrace();\n                return false;\n            }\n    \n            return true;\n        }\n\n\n##<a id=\"Wire\"></a> Step 5: Wiring the rest of the of application together ##\n\nNow that we've finished the fun bits - all that left is to build a quick user interface and wire it up to our DAO.\n\n1. First, let's start with building a controller to call our DAO:\n\n        public class TodoItemController {\n            public static TodoItemController getInstance() {\n                if (todoItemController == null) {\n                    todoItemController = new TodoItemController(TodoDaoFactory.getDao());\n                }\n                return todoItemController;\n            }\n        \n            private static TodoItemController todoItemController;\n        \n            private final TodoDao todoDao;\n        \n            TodoItemController(TodoDao todoDao) {\n                this.todoDao = todoDao;\n            }\n        \n            public TodoItem createTodoItem(@NonNull String name,\n                    @NonNull String category, boolean isComplete) {\n                TodoItem todoItem = TodoItem.builder().name(name).category(category)\n                        .complete(isComplete).build();\n                return todoDao.createTodoItem(todoItem);\n            }\n        \n            public boolean deleteTodoItem(@NonNull String id) {\n                return todoDao.deleteTodoItem(id);\n            }\n        \n            public TodoItem getTodoItemById(@NonNull String id) {\n                return todoDao.readTodoItem(id);\n            }\n        \n            public List<TodoItem> getTodoItems() {\n                return todoDao.readTodoItems();\n            }\n        \n            public TodoItem updateTodoItem(@NonNull String id, boolean isComplete) {\n                return todoDao.updateTodoItem(id, isComplete);\n            }\n        }\n\n    In a more complex application, the controller may house complicated business logic on top of the DAO.\n\n2. Next, we'll create a servlet to route HTTP requests to the controller:\n\n        public class TodoServlet extends HttpServlet {\n            // API Keys\n            public static final String API_METHOD = \"method\";\n        \n            // API Methods\n            public static final String CREATE_TODO_ITEM = \"createTodoItem\";\n            public static final String GET_TODO_ITEMS = \"getTodoItems\";\n            public static final String UPDATE_TODO_ITEM = \"updateTodoItem\";\n        \n            // API Parameters\n            public static final String TODO_ITEM_ID = \"todoItemId\";\n            public static final String TODO_ITEM_NAME = \"todoItemName\";\n            public static final String TODO_ITEM_CATEGORY = \"todoItemCategory\";\n            public static final String TODO_ITEM_COMPLETE = \"todoItemComplete\";\n        \n            public static final String MESSAGE_ERROR_INVALID_METHOD = \"{'error': 'Invalid method'}\";\n        \n            private static final long serialVersionUID = 1L;\n            private static final Gson gson = new Gson();\n        \n            @Override\n            protected void doGet(HttpServletRequest request,\n                    HttpServletResponse response) throws ServletException, IOException {\n        \n                String apiResponse = MESSAGE_ERROR_INVALID_METHOD;\n        \n                TodoItemController todoItemController = TodoItemController\n                        .getInstance();\n        \n                String id = request.getParameter(TODO_ITEM_ID);\n                String name = request.getParameter(TODO_ITEM_NAME);\n                String category = request.getParameter(TODO_ITEM_CATEGORY);\n                boolean isComplete = StringUtils.equalsIgnoreCase(\"true\",\n                        request.getParameter(TODO_ITEM_COMPLETE)) ? true : false;\n        \n                switch (request.getParameter(API_METHOD)) {\n                case CREATE_TODO_ITEM:\n                    apiResponse = gson.toJson(todoItemController.createTodoItem(name,\n                            category, isComplete));\n                    break;\n                case GET_TODO_ITEMS:\n                    apiResponse = gson.toJson(todoItemController.getTodoItems());\n                    break;\n                case UPDATE_TODO_ITEM:\n                    apiResponse = gson.toJson(todoItemController.updateTodoItem(id,\n                            isComplete));\n                    break;\n                default:\n                    break;\n                }\n        \n                response.getWriter().println(apiResponse);\n            }\n    \n            @Override\n            protected void doPost(HttpServletRequest request,\n                    HttpServletResponse response) throws ServletException, IOException {\n                doGet(request, response);\n            }\n        }\n\n3. We'll need a Web User Interface to display to the user. Let's re-write the index.jsp we created earlier:\n\n        <html>\n        <head>\n          <meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\">\n          <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge;\" />\n          <title>Azure DocumentDB Java Sample</title>\n        \n          <!-- Bootstrap -->\n          <link href=\"//ajax.aspnetcdn.com/ajax/bootstrap/3.2.0/css/bootstrap.min.css\" rel=\"stylesheet\">\n        \n          <style>\n            /* Add padding to body for fixed nav bar */\n            body {\n              padding-top: 50px;\n            }\n          </style>\n        </head>\n        <body>\n          <!-- Nav Bar -->\n          <div class=\"navbar navbar-inverse navbar-fixed-top\" role=\"navigation\">\n            <div class=\"container\">\n              <div class=\"navbar-header\">\n                <a class=\"navbar-brand\" href=\"#\">My Tasks</a>\n              </div>\n            </div>\n          </div>\n        \n          <!-- Body -->\n          <div class=\"container\">\n            <h1>My ToDo List</h1>\n        \n            <hr/>\n        \n            <!-- The ToDo List -->\n            <div class = \"todoList\">\n              <table class=\"table table-bordered table-striped\" id=\"todoItems\">\n                <thead>\n                  <tr>\n                    <th>Name</th>\n                    <th>Category</th>\n                    <th>Complete</th>\n                  </tr>\n                </thead>\n                <tbody>\n                </tbody>\n              </table>\n        \n              <!-- Update Button -->\n              <div class=\"todoUpdatePanel\">\n                <form class=\"form-horizontal\" role=\"form\">\n                  <button type=\"button\" class=\"btn btn-primary\">Update Tasks</button>\n                </form>\n              </div>\n        \n            </div>\n        \n            <hr/>\n        \n            <!-- Item Input Form -->\n            <div class=\"todoForm\">\n              <form class=\"form-horizontal\" role=\"form\">\n                <div class=\"form-group\">\n                  <label for=\"inputItemName\" class=\"col-sm-2\">Task Name</label>\n                  <div class=\"col-sm-10\">\n                    <input type=\"text\" class=\"form-control\" id=\"inputItemName\" placeholder=\"Enter name\">\n                  </div>\n                </div>\n        \n                <div class=\"form-group\">\n                  <label for=\"inputItemCategory\" class=\"col-sm-2\">Task Category</label>\n                  <div class=\"col-sm-10\">\n                    <input type=\"text\" class=\"form-control\" id=\"inputItemCategory\" placeholder=\"Enter category\">\n                  </div>\n                </div>\n        \n                <button type=\"button\" class=\"btn btn-primary\">Add Task</button>\n              </form>\n            </div>\n        \n          </div>\n        \n          <!-- Placed at the end of the document so the pages load faster -->\n          <script src=\"//ajax.aspnetcdn.com/ajax/jQuery/jquery-2.1.1.min.js\"></script>\n          <script src=\"//ajax.aspnetcdn.com/ajax/bootstrap/3.2.0/bootstrap.min.js\"></script>\n          <script src=\"assets/todo.js\"></script>\n        </body>\n        </html>\n\n4. And finally, write some client-side Javascript to tie the web user interface and the servlet together:\n    \n        var todoApp = {\n          /*\n           * API methods to call Java backend.\n           */\n          apiEndpoint: \"api\",\n        \n          createTodoItem: function(name, category, isComplete) {\n            $.post(todoApp.apiEndpoint, {\n                \"method\": \"createTodoItem\",\n                \"todoItemName\": name,\n                \"todoItemCategory\": category,\n                \"todoItemComplete\": isComplete\n              },\n              function(data) {\n                var todoItem = data;\n                todoApp.addTodoItemToTable(todoItem.id, todoItem.name, todoItem.category, todoItem.complete);\n              },\n              \"json\");\n          },\n        \n          getTodoItems: function() {\n            $.post(todoApp.apiEndpoint, {\n                \"method\": \"getTodoItems\"\n              },\n              function(data) {\n                var todoItemArr = data;\n                $.each(todoItemArr, function(index, value) {\n                  todoApp.addTodoItemToTable(value.id, value.name, value.category, value.complete);\n                });\n              },\n              \"json\");\n          },\n        \n          updateTodoItem: function(id, isComplete) {\n            $.post(todoApp.apiEndpoint, {\n                \"method\": \"updateTodoItem\",\n                \"todoItemId\": id,\n                \"todoItemComplete\": isComplete\n              },\n              function(data) {},\n              \"json\");\n          },\n        \n          /*\n           * UI Methods\n           */\n          addTodoItemToTable: function(id, name, category, isComplete) {\n            var rowColor = isComplete ? \"active\" : \"warning\";\n        \n            todoApp.ui_table().append($(\"<tr>\")\n              .append($(\"<td>\").text(name))\n              .append($(\"<td>\").text(category))\n              .append($(\"<td>\")\n                .append($(\"<input>\")\n                  .attr(\"type\", \"checkbox\")\n                  .attr(\"id\", id)\n                  .attr(\"checked\", isComplete)\n                  .attr(\"class\", \"isComplete\")\n                ))\n              .addClass(rowColor)\n            );\n          },\n        \n          /*\n           * UI Bindings\n           */\n          bindCreateButton: function() {\n            todoApp.ui_createButton().click(function() {\n              todoApp.createTodoItem(todoApp.ui_createNameInput().val(), todoApp.ui_createCategoryInput().val(), false);\n              todoApp.ui_createNameInput().val(\"\");\n              todoApp.ui_createCategoryInput().val(\"\");\n            });\n          },\n        \n          bindUpdateButton: function() {\n            todoApp.ui_updateButton().click(function() {\n              // Disable button temporarily.\n              var myButton = $(this);\n              var originalText = myButton.text();\n              $(this).text(\"Updating...\");\n              $(this).prop(\"disabled\", true);\n        \n              // Call api to update todo items.\n              $.each(todoApp.ui_updateId(), function(index, value) {\n                todoApp.updateTodoItem(value.name, value.value);\n                $(value).remove();\n              });\n        \n              // Re-enable button.\n              setTimeout(function() {\n                myButton.prop(\"disabled\", false);\n                myButton.text(originalText);\n              }, 500);\n            });\n          },\n        \n          bindUpdateCheckboxes: function() {\n            todoApp.ui_table().on(\"click\", \".isComplete\", function(event) {\n              var checkboxElement = $(event.currentTarget);\n              var rowElement = $(event.currentTarget).parents('tr');\n              var id = checkboxElement.attr('id');\n              var isComplete = checkboxElement.is(':checked');\n        \n              // Toggle table row color\n              if (isComplete) {\n                rowElement.addClass(\"active\");\n                rowElement.removeClass(\"warning\");\n              } else {\n                rowElement.removeClass(\"active\");\n                rowElement.addClass(\"warning\");\n              }\n        \n              // Update hidden inputs for update panel.\n              todoApp.ui_updateForm().children(\"input[name='\" + id + \"']\").remove();\n        \n              todoApp.ui_updateForm().append($(\"<input>\")\n                .attr(\"type\", \"hidden\")\n                .attr(\"class\", \"updateComplete\")\n                .attr(\"name\", id)\n                .attr(\"value\", isComplete));\n        \n            });\n          },\n        \n          /*\n           * UI Elements\n           */\n          ui_createNameInput: function() {\n            return $(\".todoForm #inputItemName\");\n          },\n        \n          ui_createCategoryInput: function() {\n            return $(\".todoForm #inputItemCategory\");\n          },\n        \n          ui_createButton: function() {\n            return $(\".todoForm button\");\n          },\n        \n          ui_table: function() {\n            return $(\".todoList table tbody\");\n          },\n        \n          ui_updateButton: function() {\n            return $(\".todoUpdatePanel button\");\n          },\n        \n          ui_updateForm: function() {\n            return $(\".todoUpdatePanel form\");\n          },\n        \n          ui_updateId: function() {\n            return $(\".todoUpdatePanel .updateComplete\");\n          },\n        \n          /*\n           * Install the TodoApp\n           */\n          install: function() {\n            todoApp.bindCreateButton();\n            todoApp.bindUpdateButton();\n            todoApp.bindUpdateCheckboxes();\n        \n            todoApp.getTodoItems();\n          }\n        };\n        \n        $(document).ready(function() {\n          todoApp.install();\n        });\n\n5. Awesome! Now all that's left is to test the application. Run the application locally, and add some Todo items by filling in the item name and category and clicking **Add Task**.\n\n6. Once the item appears, you can update whether it's complete by toggling the checkbox and clicking **Update Tasks**.\n\n##<a id=\"Deploy\"></a>Step 6: Deploy your application to Azure Websites ##\n\nAzure Websites makes deploying Java Applications as simple as exporting your application as a WAR file and either uploading it via source control (e.g. GIT) or FTP.\n\n1. To export your application as a WAR, right-click on your project in **Project Explorer**, click **Export**, and then click **WAR File**. \n2. In the **WAR Export** window, do the following:\n - In the Web project box, enter azure-documentdb-java-sample.\n - In the Destination box, choose a destination to save the WAR file.\n - Click **Finish**.\n\n3. Now that you have a WAR file in hand, you can simply upload it to your Azure Website's **webapps** directory. For instructions on uploading the file, see [Adding an application to your Java website on Azure](../web-sites-java-add-app.md).\n\n    Once the WAR file is uploaded to the webapps directory, the runtime environment will detect that you've added it and will automatically load it.\n4. To view your finished product, navigate to http://YOUR\\_SITE\\_NAME.azurewebsites.net/azure-documentdb-java-sample/ and start adding your tasks!\n\n##<a id=\"GetProject\"></a>Get the project from GitHub##\n\nAll the samples in this tutorial are included in the [todo](https://github.com/Azure/azure-documentdb-java/tree/master/tutorial/todo) project on GitHub, which is part of the [azure-documentdb-java](https://github.com/Azure/azure-documentdb-java) repository. To import the todo project into Eclipse, ensure you have the software and resources listed in the [Prerequisites](#Prerequisites) section, then do the following:\n\n1. Install [Project Lombok](http://projectlombok.org/). Lombok is used to generate constructors, getters, setters in the project. Once you have downloaded the lombok.jar file, double-click it to install it or install it from the command line. \n2. If Eclipse is open, close it and restart it to load Lombok.\n3. In Eclipse, on the **File** menu, click **Import**.\n4. In the **Import** window, click **Git**, click **Projects from Git**, and then click **Next**. \n5. On the **Select Repository Source** screen, click **Clone URI**.\n6. On the **Source Git Repository** screen, in the **URI** box, enter https://github.com/Azure/azure-documentdb-java.git, and then click **Next**.\n7. On the **Branch Selection** screen, ensure that **master** is selected, and then click **Next**.\n8. On the **Local Destination** screen, click **Browse** to select a folder where the repository can be copied, and then click **Next**.\n9. On the **Select a wizard to use for importing projects** screen, ensure that **Import existing projects** is selected, and then click **Next**.\n10. On the **Import Projects** screen, unselect the **DocumentDB** project, and then click **Finish**. The DocumentDB project contains the DocumentDB Java SDK, which we will add as a dependency instead.\n11. In **Project Explorer**, navigate to azure-documentdb-java-sample\\src\\com.microsoft.azure.documentdb.sample.dao\\DocumentClientFactory.java and replace the HOST and MASTER_KEY values with the URI and PRIMARY KEY for your DocumentDB account, and then save the file. For more information, see [Step 1. Create a DocumentDB database account](#CreateDB).\n12. In **Project Explorer**, right click the **azure-documentdb-java-sample**, click **Build Path**, and then click **Configure Build Path**.\n13. On the **Java Build Path** screen, in the right pane, select the **Libraries** tab, and then click **Add External JARs**. Navigate to the location of the lombok.jar file, and click **Open**, and then click **OK**.\n14. Use step 12 to open the **Properties** window again, and then in the left pane click **Targeted Runtimes**.\n15. On the **Targeted Runtimes** screen, click **New**, select **Apache Tomcat v7.0**, and then click **OK**.\n16. Use step 12 to open the **Properties** window again, and then in the left pane click **Project Facets**.\n17. On the **Project Facets** screen, select **Dynamic Web Module** and **Java**, and then click **OK**.\n18. On the **Servers** tab at the bottom of the screen, right-click **Tomcat v7.0 Server at localhost** and then click **Add and Remove**.\n19. On the **Add and Remove** window, move **azure-documentdb-java-sample** to the **Configured** box, and then click **Finish**. \n20. In the **Server** tab, right-click **Tomcat v7.0 Server at localhost**, and then click **Restart**.\n21. In a browser, navigate to http://localhost:8080/azure-documentdb-java-sample/ and start adding to your task list. Note that if you changed your default port values, change 8080 to the value you selected.\n22. To deploy your project to an Azure web site, see [Step 6. Deploy your application to Azure Websites](#Deploy). \n\n[1]: media/documentdb-java-application/keys.png\n \n\ntest\n"
}