{
  "nodes": [
    {
      "content": "Build a web application with ASP.NET MVC using DocumentDB | Microsoft Azure",
      "pos": [
        28,
        103
      ]
    },
    {
      "content": "Learn how to use DocumentDB with .NET to build a To Do List web application.",
      "pos": [
        123,
        199
      ]
    },
    {
      "content": "You'll store and access data from an ASP.NET MVC web application hosted on Azure Websites.",
      "pos": [
        200,
        290
      ]
    },
    {
      "pos": [
        632,
        717
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395809351\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Build a web application with ASP.NET MVC using DocumentDB"
    },
    {
      "content": "To highlight how you can efficiently leverage Azure DocumentDB to store and query JSON documents, this article provides an end-to-end walk-through showing you how to build a todo list web application using Azure DocumentDB.",
      "pos": [
        719,
        942
      ]
    },
    {
      "content": "The tasks will be stored as JSON documents in Azure DocumentDB.",
      "pos": [
        943,
        1006
      ]
    },
    {
      "content": "Screen shot of the todo list web application created by this tutorial",
      "pos": [
        1010,
        1079
      ]
    },
    {
      "content": "This walk-through shows you how to use the DocumentDB service provided by Azure to store and access data from an ASP.NET MVC web application hosted on Azure.",
      "pos": [
        1132,
        1289
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.TIP]</ph> This tutorial assumes that you have prior experience using ASP.NET MVC and Azure Websites.",
      "pos": [
        1293,
        1395
      ]
    },
    {
      "content": "If you are new to ASP.NET or the <bpt id=\"p1\">[</bpt>prerequisite tools<ept id=\"p1\">](#_Toc395637760)</ept>, we recommend downloading the complete <bpt id=\"p2\">[</bpt>todo<ept id=\"p2\">](https://github.com/Azure/azure-documentdb-net/tree/master/tutorials/todo)</ept> tutorial project from <bpt id=\"p3\">[</bpt>GitHub<ept id=\"p3\">](https://github.com/Azure/azure-documentdb-net)</ept> and building it using the <bpt id=\"p4\">[</bpt>instructions at the end of this article<ept id=\"p4\">](#GetProject)</ept>.",
      "pos": [
        1396,
        1745
      ]
    },
    {
      "content": "Once you have it built, you can review the article to gain insight on the code in the context of the project.",
      "pos": [
        1746,
        1855
      ]
    },
    {
      "pos": [
        1860,
        1901
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637760\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Prerequisites"
    },
    {
      "content": "Before following the instructions in this article, you should ensure that you have the following:",
      "pos": [
        1903,
        2000
      ]
    },
    {
      "content": "An active Azure account.",
      "pos": [
        2004,
        2028
      ]
    },
    {
      "content": "If you don't have an account, you can create a free trial account in just a couple of minutes.",
      "pos": [
        2029,
        2123
      ]
    },
    {
      "content": "For details, see <bpt id=\"p1\">[</bpt>Azure Free Trial<ept id=\"p1\">](../../pricing/free-trial/)</ept>.",
      "pos": [
        2124,
        2187
      ]
    },
    {
      "pos": [
        2190,
        2260
      ],
      "content": "<bpt id=\"p1\">[</bpt>Visual Studio 2013<ept id=\"p1\">](http://www.visualstudio.com/)</ept> Update 4 or higher."
    },
    {
      "pos": [
        2263,
        2366
      ],
      "content": "Azure SDK for .NET version 2.5.1 or higher, available through the <bpt id=\"p1\">[</bpt>Microsoft Web Platform Installer<ept id=\"p1\">][]</ept>."
    },
    {
      "content": "All the screen shots in this article have been taken using Visual Studio 2013 with Update 4 applied and the Azure SDK for .NET version 2.5.1.",
      "pos": [
        2368,
        2509
      ]
    },
    {
      "content": "If your system is configured with different versions it is possible that your screens and options won't match entirely, but if you meet the above prerequisites this solution should work.",
      "pos": [
        2510,
        2696
      ]
    },
    {
      "pos": [
        2701,
        2773
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637761\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 1: Create a DocumentDB database account"
    },
    {
      "content": "Let's start by creating a DocumentDB account.",
      "pos": [
        2775,
        2820
      ]
    },
    {
      "content": "If you already have an account, you can skip to <bpt id=\"p1\">[</bpt>Create a new ASP.NET MVC application<ept id=\"p1\">](#_Toc395637762)</ept>.",
      "pos": [
        2821,
        2924
      ]
    },
    {
      "content": "We will now walk through how to create a new ASP.NET MVC application from the ground-up.",
      "pos": [
        3096,
        3184
      ]
    },
    {
      "pos": [
        3190,
        3262
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637762\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 2: Create a new ASP.NET MVC application"
    },
    {
      "content": "Now that you have an account, let's create our new ASP.NET project.",
      "pos": [
        3264,
        3331
      ]
    },
    {
      "pos": [
        3336,
        3421
      ],
      "content": "In Visual Studio, on the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, point to <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        3427,
        3466
      ],
      "content": "The <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept> dialog box appears."
    },
    {
      "pos": [
        3470,
        3591
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Project types<ept id=\"p1\">**</ept> pane, expand <bpt id=\"p2\">**</bpt>Templates<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Visual C#<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Web<ept id=\"p4\">**</ept>, and then select <bpt id=\"p5\">**</bpt>ASP.NET Web Application<ept id=\"p5\">**</ept>."
    },
    {
      "content": "Screen shot of the New Project dialog box with the ASP.NET Web Application project type highlighted",
      "pos": [
        3599,
        3698
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> box, type the name of the project.",
      "pos": [
        3755,
        3805
      ]
    },
    {
      "content": "This tutorial uses the name \"todo\".",
      "pos": [
        3806,
        3841
      ]
    },
    {
      "content": "If you choose to use something other than this, then wherever this tutorial talks about the todo namespace, you need to adjust the provided code samples to use whatever you named your application.",
      "pos": [
        3842,
        4038
      ]
    },
    {
      "pos": [
        4044,
        4153
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept> to navigate to the folder where you would like to create the project, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        4159,
        4206
      ],
      "content": "The <bpt id=\"p1\">**</bpt>New ASP.NET Project<ept id=\"p1\">**</ept> dialog box appears."
    },
    {
      "content": "Screen shot of the New ASP.NET Project dialog box with the MVC template highlighted and the Host in the cloud box checked",
      "pos": [
        4214,
        4335
      ]
    },
    {
      "pos": [
        4392,
        4430
      ],
      "content": "In the templates pane, select <bpt id=\"p1\">**</bpt>MVC<ept id=\"p1\">**</ept>."
    },
    {
      "content": "If you plan on hosting your application in Azure then select <bpt id=\"p1\">**</bpt>Host in the cloud<ept id=\"p1\">**</ept> on the lower right to have Azure host the application.",
      "pos": [
        4435,
        4572
      ]
    },
    {
      "content": "We've selected to host in the cloud, and to run the application hosted in an Azure Website.",
      "pos": [
        4573,
        4664
      ]
    },
    {
      "content": "Selecting this option will preprovision an Azure Website for you and make life a lot easier when it comes time to deploy the final working application.",
      "pos": [
        4665,
        4816
      ]
    },
    {
      "content": "If you want to host this elsewhere or don't want to configure Azure upfront, then just clear <bpt id=\"p1\">**</bpt>Host in the Cloud<ept id=\"p1\">**</ept>.",
      "pos": [
        4817,
        4932
      ]
    },
    {
      "pos": [
        4937,
        5035
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> and let Visual Studio do its thing around scaffolding the empty ASP.NET MVC template."
    },
    {
      "content": "If you chose to host this in the cloud you will see at least one additional screen asking you to login to your Azure account and provide some values for your new website.",
      "pos": [
        5041,
        5211
      ]
    },
    {
      "content": "Supply all the additional values and continue.",
      "pos": [
        5212,
        5258
      ]
    },
    {
      "content": "I haven't chosen a \"Database server\" here because we're not using an Azure SQL Database Server here, we're going to be creating a new Azure DocumentDB account later on in the Azure Preview portal.",
      "pos": [
        5265,
        5461
      ]
    },
    {
      "pos": [
        5467,
        5655
      ],
      "content": "For more information about choosing an <bpt id=\"p1\">**</bpt>App Service plan<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Resource group<ept id=\"p2\">**</ept>, see <bpt id=\"p3\">[</bpt>Azure App Service plans in-depth overview<ept id=\"p3\">](azure-web-sites-web-hosting-plans-in-depth-overview.md)</ept>."
    },
    {
      "content": "Screen shot of the Configure Microsoft Azure Website dialog box",
      "pos": [
        5663,
        5726
      ]
    },
    {
      "content": "Once Visual Studio has finished creating the boilerplate MVC application you have an empty ASP.NET application that you can run locally.",
      "pos": [
        5785,
        5921
      ]
    },
    {
      "content": "We'll skip running the project locally because I'm sure we've all seen the ASP.NET \"Hello World\" application.",
      "pos": [
        5927,
        6036
      ]
    },
    {
      "content": "Let's go straight to adding DocumentDB to this project and building our application.",
      "pos": [
        6037,
        6121
      ]
    },
    {
      "pos": [
        6126,
        6192
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637767\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 3: Add DocumentDB to your project"
    },
    {
      "content": "Now that we have most of the ASP.NET MVC plumbing that we need for",
      "pos": [
        6194,
        6260
      ]
    },
    {
      "content": "this solution, let's get to the real purpose of this tutorial, adding Azure DocumentDB to our web application.",
      "pos": [
        6261,
        6371
      ]
    },
    {
      "content": "The DocumentDB .NET SDK is packaged and distributed as a NuGet package.",
      "pos": [
        6376,
        6447
      ]
    },
    {
      "content": "To get the NuGet package in Visual Studio, use the NuGet package manager in Visual Studio by right-clicking on the project in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept> and then clicking <bpt id=\"p2\">**</bpt>Manage NuGet Packages<ept id=\"p2\">**</ept>.",
      "pos": [
        6448,
        6640
      ]
    },
    {
      "content": "Sreen shot of the right-click options for the project in Solution Explorer, with Manage NuGet Packages highlighted.",
      "pos": [
        6648,
        6763
      ]
    },
    {
      "pos": [
        6821,
        6870
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Manage NuGet Packages<ept id=\"p1\">**</ept> dialog box appears."
    },
    {
      "pos": [
        6875,
        6933
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Search Online<ept id=\"p1\">**</ept> box, type <bpt id=\"p2\">***</bpt>Azure DocumentDB<ept id=\"p2\">***</ept>."
    },
    {
      "content": "From the results, install the <bpt id=\"p1\">**</bpt>Microsoft Azure DocumentDB Client Library<ept id=\"p1\">**</ept> package.",
      "pos": [
        6944,
        7028
      ]
    },
    {
      "content": "This will download and install the DocumentDB package as well as all dependencies, like Newtonsoft.Json.",
      "pos": [
        7029,
        7133
      ]
    },
    {
      "content": "Sreen shot of the Manage NuGet Packages window, with the Microsoft Azure DocumentDB Client Library highlighted",
      "pos": [
        7141,
        7251
      ]
    },
    {
      "content": "Alternatively you can use the Package Manager Console to install the package.",
      "pos": [
        7307,
        7384
      ]
    },
    {
      "content": "To do so, on the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>NuGet Package Manager<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Package Manager Console<ept id=\"p3\">**</ept>.",
      "pos": [
        7385,
        7494
      ]
    },
    {
      "content": "At the prompt, type the following.",
      "pos": [
        7495,
        7529
      ]
    },
    {
      "content": "Once the package is installed, your Visual Studio solution should resemble the following with two new references added, Microsoft.Azure.Documents.Client and Newtonsoft.Json.",
      "pos": [
        7586,
        7759
      ]
    },
    {
      "content": "Sreen shot of the two references added to the project in Solution Explorer",
      "pos": [
        7767,
        7841
      ]
    },
    {
      "pos": [
        7898,
        7968
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637763\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 4: Set up the ASP.NET MVC application"
    },
    {
      "content": "Now let's add the models, views, and controllers to this MVC application:",
      "pos": [
        7971,
        8044
      ]
    },
    {
      "pos": [
        8048,
        8078
      ],
      "content": "<bpt id=\"p1\">[</bpt>Add a model<ept id=\"p1\">](#_Toc395637764)</ept>."
    },
    {
      "pos": [
        8081,
        8116
      ],
      "content": "<bpt id=\"p1\">[</bpt>Add a controller<ept id=\"p1\">](#_Toc395637765)</ept>."
    },
    {
      "pos": [
        8119,
        8147
      ],
      "content": "<bpt id=\"p1\">[</bpt>Add views<ept id=\"p1\">](#_Toc395637766)</ept>."
    },
    {
      "pos": [
        8154,
        8193
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637764\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add a model"
    },
    {
      "pos": [
        8195,
        8247
      ],
      "content": "Let's begin by creating the <bpt id=\"p1\">**</bpt>M<ept id=\"p1\">**</ept> in MVC, the model."
    },
    {
      "pos": [
        8253,
        8354
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>Models<ept id=\"p2\">**</ept> folder, click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>Class<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        8360,
        8400
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Add New Item<ept id=\"p1\">**</ept> dialog box appears."
    },
    {
      "pos": [
        8405,
        8455
      ],
      "content": "Name your new class <bpt id=\"p1\">**</bpt>Item.cs<ept id=\"p1\">**</ept> and click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        8461,
        8542
      ],
      "content": "In this new <bpt id=\"p1\">**</bpt>Item.cs<ept id=\"p1\">**</ept> file, add the following after the last <bpt id=\"p2\">*</bpt>using statement<ept id=\"p2\">*</ept>."
    },
    {
      "content": "Now replace this code",
      "pos": [
        8591,
        8612
      ]
    },
    {
      "content": "with the following code.",
      "pos": [
        8674,
        8698
      ]
    },
    {
      "content": "All data in DocumentDB is passed over the wire and stored as JSON.",
      "pos": [
        9176,
        9242
      ]
    },
    {
      "content": "To control the way your objects are serialized/deserialized by JSON.NET you can use the <bpt id=\"p1\">**</bpt>JsonProperty<ept id=\"p1\">**</ept> attribute as demonstrated in the <bpt id=\"p2\">**</bpt>Item<ept id=\"p2\">**</ept> class we just created.",
      "pos": [
        9243,
        9412
      ]
    },
    {
      "content": "You don't <bpt id=\"p1\">**</bpt>have<ept id=\"p1\">**</ept> to do this but I want to ensure that my properties follow the JSON camelCase naming conventions.",
      "pos": [
        9413,
        9528
      ]
    },
    {
      "pos": [
        9539,
        9714
      ],
      "content": "Not only can you control the format of the property name when it goes into JSON, but you can entirely rename your .NET properties like I did with the <bpt id=\"p1\">**</bpt>Description<ept id=\"p1\">**</ept> property."
    },
    {
      "pos": [
        9726,
        9770
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637765\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add a controller"
    },
    {
      "pos": [
        9772,
        9856
      ],
      "content": "That takes care of the <bpt id=\"p1\">**</bpt>M<ept id=\"p1\">**</ept>, now let's create the <bpt id=\"p2\">**</bpt>C<ept id=\"p2\">**</ept> in MVC, a controller class."
    },
    {
      "pos": [
        9861,
        9972
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>Controllers<ept id=\"p2\">**</ept> folder, click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>Controller<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        9978,
        10018
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Add Scaffold<ept id=\"p1\">**</ept> dialog box appears."
    },
    {
      "pos": [
        10023,
        10082
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>MVC 5 Controller - Empty<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Screen shot of the Add Scaffold dialog box with the MVC 5 Controller - Empty option highlighted",
      "pos": [
        10090,
        10185
      ]
    },
    {
      "pos": [
        10242,
        10287
      ],
      "content": "Name your new Controller, <bpt id=\"p1\">**</bpt>ItemController.<ept id=\"p1\">**</ept>"
    },
    {
      "content": "Screen shot of the Add Controller dialog box",
      "pos": [
        10295,
        10339
      ]
    },
    {
      "content": "Once the file is created, your Visual Studio solution should resemble the following with the new ItemController.cs file in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>.",
      "pos": [
        10397,
        10542
      ]
    },
    {
      "content": "The new Item.cs file created earlier is also shown.",
      "pos": [
        10543,
        10594
      ]
    },
    {
      "content": "Screen shot of Solution Explorer with the new ItemController.cs file and Item.cs file highlighted",
      "pos": [
        10602,
        10699
      ]
    },
    {
      "content": "You can close ItemController.cs, we'll come back to it later.",
      "pos": [
        10757,
        10818
      ]
    },
    {
      "pos": [
        10825,
        10862
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637766\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add views"
    },
    {
      "pos": [
        10864,
        10910
      ],
      "content": "Now, let's create the <bpt id=\"p1\">**</bpt>V<ept id=\"p1\">**</ept> in MVC, the views:"
    },
    {
      "pos": [
        10914,
        10958
      ],
      "content": "<bpt id=\"p1\">[</bpt>Add an Item Index view<ept id=\"p1\">](#AddItemIndexView)</ept>."
    },
    {
      "pos": [
        10961,
        11001
      ],
      "content": "<bpt id=\"p1\">[</bpt>Add a New Item view<ept id=\"p1\">](#AddNewIndexView)</ept>."
    },
    {
      "pos": [
        11004,
        11044
      ],
      "content": "<bpt id=\"p1\">[</bpt>Add an Edit Item view<ept id=\"p1\">](#_Toc395888515)</ept>."
    },
    {
      "pos": [
        11052,
        11105
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"AddItemIndexView\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add an Item Index view"
    },
    {
      "pos": [
        11110,
        11325
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, expand the <bpt id=\"p2\">**</bpt>Views<ept id=\"p2\">**</ept>  folder, right-click the empty <bpt id=\"p3\">**</bpt>Item<ept id=\"p3\">**</ept> folder that Visual Studio created for you when you added the <bpt id=\"p4\">**</bpt>ItemController<ept id=\"p4\">**</ept> earlier, click <bpt id=\"p5\">**</bpt>Add<ept id=\"p5\">**</ept>, and then click <bpt id=\"p6\">**</bpt>View<ept id=\"p6\">**</ept>."
    },
    {
      "content": "Screen shot of Solution Explorer showing the Item folder with the Add View commands highlighted",
      "pos": [
        11333,
        11428
      ]
    },
    {
      "pos": [
        11485,
        11534
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Add View<ept id=\"p1\">**</ept> dialog box, do the following:"
    },
    {
      "pos": [
        11541,
        11584
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>View name<ept id=\"p1\">**</ept> box, type <bpt id=\"p2\">***</bpt>Index<ept id=\"p2\">***</ept>."
    },
    {
      "pos": [
        11591,
        11634
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Template<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">***</bpt>List<ept id=\"p2\">***</ept>."
    },
    {
      "pos": [
        11641,
        11701
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Model class<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">***</bpt>Item (todo.Models)<ept id=\"p2\">***</ept>."
    },
    {
      "pos": [
        11708,
        11751
      ],
      "content": "Leave the <bpt id=\"p1\">**</bpt>Data context class<ept id=\"p1\">**</ept> box empty."
    },
    {
      "pos": [
        11759,
        11824
      ],
      "content": "In the layout page box, type <bpt id=\"p1\">***</bpt>~/Views/Shared/_Layout.cshtml<ept id=\"p1\">***</ept>."
    },
    {
      "content": "Screen shot showing the Add View dialog box",
      "pos": [
        11836,
        11879
      ]
    },
    {
      "content": "Once all these values are set, click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> and let Visual Studio create a new template view.",
      "pos": [
        11936,
        12030
      ]
    },
    {
      "content": "Once it is done, it will open the cshtml file  that was created.",
      "pos": [
        12031,
        12095
      ]
    },
    {
      "content": "We can close that file in Visual Studio as we will come back to it later.",
      "pos": [
        12096,
        12169
      ]
    },
    {
      "pos": [
        12176,
        12225
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"AddNewIndexView\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add a New Item view"
    },
    {
      "pos": [
        12227,
        12334
      ],
      "content": "Similar to how we created an <bpt id=\"p1\">**</bpt>Item Index<ept id=\"p1\">**</ept> view, we will now create a new view for creating new <bpt id=\"p2\">**</bpt>Items<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        12339,
        12443
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>Item<ept id=\"p2\">**</ept> folder again, click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>View<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        12448,
        12497
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Add View<ept id=\"p1\">**</ept> dialog box, do the following:"
    },
    {
      "pos": [
        12504,
        12548
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>View name<ept id=\"p1\">**</ept> box, type <bpt id=\"p2\">***</bpt>Create<ept id=\"p2\">***</ept>."
    },
    {
      "pos": [
        12555,
        12600
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Template<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">***</bpt>Create<ept id=\"p2\">***</ept>."
    },
    {
      "pos": [
        12607,
        12667
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Model class<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">***</bpt>Item (todo.Models)<ept id=\"p2\">***</ept>."
    },
    {
      "pos": [
        12674,
        12717
      ],
      "content": "Leave the <bpt id=\"p1\">**</bpt>Data context class<ept id=\"p1\">**</ept> box empty."
    },
    {
      "pos": [
        12724,
        12789
      ],
      "content": "In the layout page box, type <bpt id=\"p1\">***</bpt>~/Views/Shared/_Layout.cshtml<ept id=\"p1\">***</ept>."
    },
    {
      "pos": [
        12796,
        12810
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        12817,
        12866
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395888515\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Add an Edit Item view"
    },
    {
      "pos": [
        12868,
        12949
      ],
      "content": "And finally, add one last view for editing an <bpt id=\"p1\">**</bpt>Item<ept id=\"p1\">**</ept> in the same way as before."
    },
    {
      "pos": [
        12954,
        13058
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>Item<ept id=\"p2\">**</ept> folder again, click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>View<ept id=\"p4\">**</ept>."
    },
    {
      "pos": [
        13063,
        13112
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Add View<ept id=\"p1\">**</ept> dialog box, do the following:"
    },
    {
      "pos": [
        13119,
        13161
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>View name<ept id=\"p1\">**</ept> box, type <bpt id=\"p2\">***</bpt>Edit<ept id=\"p2\">***</ept>."
    },
    {
      "pos": [
        13168,
        13211
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Template<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">***</bpt>Edit<ept id=\"p2\">***</ept>."
    },
    {
      "pos": [
        13218,
        13278
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>Model class<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">***</bpt>Item (todo.Models)<ept id=\"p2\">***</ept>."
    },
    {
      "pos": [
        13285,
        13328
      ],
      "content": "Leave the <bpt id=\"p1\">**</bpt>Data context class<ept id=\"p1\">**</ept> box empty."
    },
    {
      "pos": [
        13336,
        13401
      ],
      "content": "In the layout page box, type <bpt id=\"p1\">***</bpt>~/Views/Shared/_Layout.cshtml<ept id=\"p1\">***</ept>."
    },
    {
      "pos": [
        13408,
        13422
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Once this is done, close all the cshtml documents in Visual Studio as we will return to these views later.",
      "pos": [
        13424,
        13530
      ]
    },
    {
      "pos": [
        13535,
        13591
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637769\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 5: Wiring up DocumentDB"
    },
    {
      "content": "Now that the standard MVC stuff is taken care of, let's turn to adding the code for DocumentDB.",
      "pos": [
        13593,
        13688
      ]
    },
    {
      "content": "In this section, we'll add code to handle the following:",
      "pos": [
        13691,
        13747
      ]
    },
    {
      "pos": [
        13751,
        13794
      ],
      "content": "<bpt id=\"p1\">[</bpt>Listing incomplete Items<ept id=\"p1\">](#_Toc395637770)</ept>."
    },
    {
      "pos": [
        13797,
        13828
      ],
      "content": "<bpt id=\"p1\">[</bpt>Adding Items<ept id=\"p1\">](#_Toc395637771)</ept>."
    },
    {
      "pos": [
        13831,
        13863
      ],
      "content": "<bpt id=\"p1\">[</bpt>Editing Items<ept id=\"p1\">](#_Toc395637772)</ept>."
    },
    {
      "pos": [
        13869,
        13921
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637770\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Listing incomplete Items"
    },
    {
      "content": "The first thing to do here is add a class that contains all the logic to connect to and use DocumentDB.",
      "pos": [
        13923,
        14026
      ]
    },
    {
      "content": "For this tutorial we'll encapsulate all this logic in to a repository class called DocumentDBRepository.",
      "pos": [
        14027,
        14131
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, right-click on the project, click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Class<ept id=\"p3\">**</ept>.",
      "pos": [
        14137,
        14231
      ]
    },
    {
      "content": "Name the new class <bpt id=\"p1\">**</bpt>DocumentDBRepository<ept id=\"p1\">**</ept> and click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>.",
      "pos": [
        14232,
        14294
      ]
    },
    {
      "pos": [
        14300,
        14426
      ],
      "content": "In the newly created <bpt id=\"p1\">**</bpt>DocumentDBRepository<ept id=\"p1\">**</ept> class and add the following <bpt id=\"p2\">*</bpt>using statements<ept id=\"p2\">*</ept> above the <bpt id=\"p3\">*</bpt>namespace<ept id=\"p3\">*</ept> declaration"
    },
    {
      "content": "Now replace this code",
      "pos": [
        14692,
        14713
      ]
    },
    {
      "content": "with the following code.",
      "pos": [
        14783,
        14807
      ]
    },
    {
      "pos": [
        19768,
        19928
      ],
      "content": "We're reading some values from configuration, so open the <bpt id=\"p1\">**</bpt>Web.config<ept id=\"p1\">**</ept> file of your application and add the following lines under the <ph id=\"ph1\">`&lt;AppSettings&gt;`</ph> section."
    },
    {
      "content": "Now, update the values for <bpt id=\"p1\">*</bpt>endpoint<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>authKey<ept id=\"p2\">*</ept> using the Keys blade of the Azure Preview portal.",
      "pos": [
        20266,
        20367
      ]
    },
    {
      "content": "Use the <bpt id=\"p1\">**</bpt>URI<ept id=\"p1\">**</ept> from the Keys blade as the value of the endpoint setting, and use the <bpt id=\"p2\">**</bpt>PRIMARY KEY<ept id=\"p2\">**</ept>, or <bpt id=\"p3\">**</bpt>SECONDARY KEY<ept id=\"p3\">**</ept> from the Keys blade as the value of the authKey setting.",
      "pos": [
        20368,
        20548
      ]
    },
    {
      "content": "The first thing we want to be able to do with a todo list application is to display the incomplete items.",
      "pos": [
        20652,
        20757
      ]
    },
    {
      "content": "Copy and paste the following code snippet anywhere within the <bpt id=\"p1\">**</bpt>DocumentDBRepository<ept id=\"p1\">**</ept> class.",
      "pos": [
        20759,
        20852
      ]
    },
    {
      "pos": [
        21108,
        21226
      ],
      "content": "Open the <bpt id=\"p1\">**</bpt>ItemController<ept id=\"p1\">**</ept> we added earlier and add the following <bpt id=\"p2\">*</bpt>using statements<ept id=\"p2\">*</ept> above the namespace declaration."
    },
    {
      "content": "If your project is not named \"todo\", then you need to update using \"todo.Models\"; to reflect the name of your project.",
      "pos": [
        21324,
        21442
      ]
    },
    {
      "content": "Now replace this code",
      "pos": [
        21448,
        21469
      ]
    },
    {
      "content": "with the following code.",
      "pos": [
        21579,
        21603
      ]
    },
    {
      "content": "At this point your solution should be able to build without any errors.",
      "pos": [
        21778,
        21849
      ]
    },
    {
      "content": "If you ran the application now, you would go to the <bpt id=\"p1\">**</bpt>HomeController<ept id=\"p1\">**</ept> and the <bpt id=\"p2\">**</bpt>Index<ept id=\"p2\">**</ept> view of that controller.",
      "pos": [
        21851,
        21964
      ]
    },
    {
      "content": "This is the default behavior for the MVC template project we chose at the start but we don't want that!",
      "pos": [
        21965,
        22068
      ]
    },
    {
      "content": "Let's change the routing on this MVC application to alter this behavior.",
      "pos": [
        22069,
        22141
      ]
    },
    {
      "pos": [
        22143,
        22266
      ],
      "content": "Open <bpt id=\"p1\">***</bpt>App\\_Start\\RouteConfig.cs<ept id=\"p1\">***</ept> and locate the line starting with \"defaults:\" and change it to resemble the following."
    },
    {
      "pos": [
        22361,
        22558
      ],
      "content": "This now tells ASP.NET MVC that if you have not specified a value in the URL to control the routing behavior that instead of <bpt id=\"p1\">**</bpt>Home<ept id=\"p1\">**</ept>, use <bpt id=\"p2\">**</bpt>Item<ept id=\"p2\">**</ept> as the controller and user <bpt id=\"p3\">**</bpt>Index<ept id=\"p3\">**</ept> as the view."
    },
    {
      "pos": [
        22560,
        22783
      ],
      "content": "Now if you run the application, it will call into your <bpt id=\"p1\">**</bpt>ItemController<ept id=\"p1\">**</ept> which will call in to the repository class and use the GetItems method to return all the incomplete items to the <bpt id=\"p2\">**</bpt>Views<ept id=\"p2\">**</ept>\\\\<bpt id=\"p3\">**</bpt>Item<ept id=\"p3\">**</ept>\\\\<bpt id=\"p4\">**</bpt>Index<ept id=\"p4\">**</ept> view."
    },
    {
      "content": "If you build and run this project now, you should now see something that looks this.",
      "pos": [
        22786,
        22870
      ]
    },
    {
      "content": "Screen shot of the todo list web application created by this tutorial",
      "pos": [
        22878,
        22947
      ]
    },
    {
      "pos": [
        23005,
        23045
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637771\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Adding Items"
    },
    {
      "content": "Let's put some items into our database so we have something more than an empty grid to look at.",
      "pos": [
        23047,
        23142
      ]
    },
    {
      "content": "Let's add some code to  DocumentDBRepository and ItemController to persist the record in DocumentDB.",
      "pos": [
        23144,
        23244
      ]
    },
    {
      "pos": [
        23250,
        23314
      ],
      "content": "Add the following method to your <bpt id=\"p1\">**</bpt>DocumentDBRepository<ept id=\"p1\">**</ept> class."
    },
    {
      "content": "This method simply takes an object passed to it and persists it in DocumentDB.",
      "pos": [
        23488,
        23566
      ]
    },
    {
      "content": "Open the ItemController.cs file and add the following code snippet within the class.",
      "pos": [
        23571,
        23655
      ]
    },
    {
      "content": "This is how ASP.NET MVC knows what to do for the <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept> action.",
      "pos": [
        23656,
        23723
      ]
    },
    {
      "content": "In this case just render the associated Create.cshtml view created earlier.",
      "pos": [
        23724,
        23799
      ]
    },
    {
      "pos": [
        23892,
        23995
      ],
      "content": "We now need some more code in this controller that will accept the submission from the <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept> view."
    },
    {
      "content": "Add the next block of code to the ItemController.cs class that tells ASP.NET MVC what to do with a form POST for this controller.",
      "pos": [
        24000,
        24129
      ]
    },
    {
      "content": "This code calls in to the DocumentDBRepository and uses the CreateItemAsync method to persist the new todo item to the database.",
      "pos": [
        24553,
        24681
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Security Note<ept id=\"p1\">**</ept>: The <bpt id=\"p2\">**</bpt>ValidateAntiForgeryToken<ept id=\"p2\">**</ept> attribute is used here to help protect this application against cross-site request forgery attacks.",
      "pos": [
        24689,
        24840
      ]
    },
    {
      "content": "There is more to it than just adding this attribute, your views need to work with this anti-forgery token as well.",
      "pos": [
        24841,
        24955
      ]
    },
    {
      "content": "For more on the subject, and examples of how to implement this correctly, please see <bpt id=\"p1\">[</bpt>Preventing Cross-Site Request Forgery<ept id=\"p1\">][]</ept>.",
      "pos": [
        24956,
        25083
      ]
    },
    {
      "content": "The source code provided on <bpt id=\"p1\">[</bpt>GitHub<ept id=\"p1\">][]</ept> has the full implementation in place.",
      "pos": [
        25084,
        25160
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Security Note<ept id=\"p1\">**</ept>: We also use the <bpt id=\"p2\">**</bpt>Bind<ept id=\"p2\">**</ept> attribute on the method parameter to help protect against over-posting attacks.",
      "pos": [
        25166,
        25289
      ]
    },
    {
      "content": "For more details please see <bpt id=\"p1\">[</bpt>Basic CRUD Operations in ASP.NET MVC<ept id=\"p1\">][]</ept>.",
      "pos": [
        25290,
        25359
      ]
    },
    {
      "content": "This concludes the code required to add new Items to our database.",
      "pos": [
        25361,
        25427
      ]
    },
    {
      "pos": [
        25434,
        25475
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637772\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Editing Items"
    },
    {
      "content": "There is one last thing for us to do, and that is to add the ability to edit <bpt id=\"p1\">**</bpt>Items<ept id=\"p1\">**</ept> in the database and to mark them as complete.",
      "pos": [
        25477,
        25609
      ]
    },
    {
      "content": "The view for editing was already added to the project, so we just need to add some code to our controller and to the <bpt id=\"p1\">**</bpt>DocumentDBRepository<ept id=\"p1\">**</ept> class again.",
      "pos": [
        25610,
        25764
      ]
    },
    {
      "pos": [
        25769,
        25825
      ],
      "content": "Add the following to the <bpt id=\"p1\">**</bpt>DocumentDBRepository<ept id=\"p1\">**</ept> class."
    },
    {
      "pos": [
        26612,
        26764
      ],
      "content": "The first of these methods, <bpt id=\"p1\">**</bpt>GetItem<ept id=\"p1\">**</ept> fetches an Item from DocumentDB which is passed back to the <bpt id=\"p2\">**</bpt>ItemController<ept id=\"p2\">**</ept> and then on to the <bpt id=\"p3\">**</bpt>Edit<ept id=\"p3\">**</ept> view."
    },
    {
      "pos": [
        26774,
        26929
      ],
      "content": "The second of the methods we just added replaces the <bpt id=\"p1\">**</bpt>Document<ept id=\"p1\">**</ept> in DocumentDB with the version of the <bpt id=\"p2\">**</bpt>Document<ept id=\"p2\">**</ept> passed in from the <bpt id=\"p3\">**</bpt>ItemController<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        26934,
        26984
      ],
      "content": "Add the following to the <bpt id=\"p1\">**</bpt>ItemController<ept id=\"p1\">**</ept> class."
    },
    {
      "content": "The first method handles the Http GET that happens when the user clicks on the <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> link from the <bpt id=\"p2\">**</bpt>Index<ept id=\"p2\">**</ept> view.",
      "pos": [
        27886,
        28003
      ]
    },
    {
      "content": "This method fetches a <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>Document<ept id=\"p2\">**</ept><ept id=\"p1\">](http://msdn.microsoft.com/library/azure/microsoft.azure.documents.document.aspx)</ept> from DocumentDB and passes it to the <bpt id=\"p3\">**</bpt>Edit<ept id=\"p3\">**</ept> view.",
      "pos": [
        28004,
        28173
      ]
    },
    {
      "pos": [
        28179,
        28250
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> view will then do an Http POST to the <bpt id=\"p2\">**</bpt>IndexController<ept id=\"p2\">**</ept>."
    },
    {
      "content": "The second method we added handles passing the updated object to DocumentDB to be persisted in the database.",
      "pos": [
        28261,
        28369
      ]
    },
    {
      "pos": [
        28371,
        28498
      ],
      "content": "That's it, that is everything we need to run our application, list incomplete <bpt id=\"p1\">**</bpt>Items<ept id=\"p1\">**</ept>, add new <bpt id=\"p2\">**</bpt>Items<ept id=\"p2\">**</ept>, and edit <bpt id=\"p3\">**</bpt>Items<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        28503,
        28566
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637773\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 6: Run the application locally"
    },
    {
      "content": "To test the application on your local machine, do the following:",
      "pos": [
        28568,
        28632
      ]
    },
    {
      "content": "Hit F5 in Visual Studio to build the application in debug mode.",
      "pos": [
        28637,
        28700
      ]
    },
    {
      "content": "It should build the application and launch a browser with the empty grid page we saw before:",
      "pos": [
        28701,
        28793
      ]
    },
    {
      "content": "Screen shot of the todo list web application created by this tutorial",
      "pos": [
        28801,
        28870
      ]
    },
    {
      "pos": [
        28928,
        29032
      ],
      "content": "If you run into errors at this point, you can compare your code against the todo tutorial on <bpt id=\"p1\">[</bpt>GitHub<ept id=\"p1\">][]</ept>."
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Create New<ept id=\"p1\">**</ept> link and add values to the <bpt id=\"p2\">**</bpt>Name<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Description<ept id=\"p3\">**</ept> fields.",
      "pos": [
        29037,
        29125
      ]
    },
    {
      "content": "Leave the <bpt id=\"p1\">**</bpt>Completed<ept id=\"p1\">**</ept> check box unselected otherwise the new <bpt id=\"p2\">**</bpt>Item<ept id=\"p2\">**</ept> will be added in a completed state and will not appear on the initial list.",
      "pos": [
        29126,
        29273
      ]
    },
    {
      "content": "Screen shot of the Create view",
      "pos": [
        29281,
        29311
      ]
    },
    {
      "pos": [
        29368,
        29473
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept> and you are redirected back to the <bpt id=\"p2\">**</bpt>Index<ept id=\"p2\">**</ept> view and your <bpt id=\"p3\">**</bpt>Item<ept id=\"p3\">**</ept> appears in the list."
    },
    {
      "content": "Screen shot of the Index view",
      "pos": [
        29481,
        29510
      ]
    },
    {
      "pos": [
        29568,
        29624
      ],
      "content": "Feel free to add a few more <bpt id=\"p1\">**</bpt>Items<ept id=\"p1\">**</ept> to your todo list."
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> next to an <bpt id=\"p2\">**</bpt>Item<ept id=\"p2\">**</ept> on the list and you are taken to the <bpt id=\"p3\">**</bpt>Edit<ept id=\"p3\">**</ept> view where you can update any property of your object, including the <bpt id=\"p4\">**</bpt>Completed<ept id=\"p4\">**</ept> flag.",
      "pos": [
        29629,
        29798
      ]
    },
    {
      "content": "If you mark the <bpt id=\"p1\">**</bpt>Complete<ept id=\"p1\">**</ept> flag and click <bpt id=\"p2\">**</bpt>Save<ept id=\"p2\">**</ept>, the <bpt id=\"p3\">**</bpt>Item<ept id=\"p3\">**</ept> is removed from the list of incomplete tasks.",
      "pos": [
        29799,
        29911
      ]
    },
    {
      "content": "Screen shot of the Index view with the Completed box checked",
      "pos": [
        29919,
        29979
      ]
    },
    {
      "content": "Once you've tested the app, press Ctrl+F5 to stop debugging the app.",
      "pos": [
        30036,
        30104
      ]
    },
    {
      "content": "You're ready to deploy!",
      "pos": [
        30105,
        30128
      ]
    },
    {
      "pos": [
        30132,
        30208
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637774\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 7: Deploy the application to Azure Websites"
    },
    {
      "content": "Now that you have the complete application working correctly with DocumentDB we're going to deploy this web app to Azure Websites.",
      "pos": [
        30210,
        30340
      ]
    },
    {
      "content": "If you selected <bpt id=\"p1\">**</bpt>Host in the cloud<ept id=\"p1\">**</ept> when you created the empty ASP.NET MVC project then Visual Studio makes this really easy and does most of the work for you.",
      "pos": [
        30341,
        30502
      ]
    },
    {
      "pos": [
        30508,
        30632
      ],
      "content": "To publish this application all you need to do is right-click on the project in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept> and click <bpt id=\"p2\">**</bpt>Publish<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Screen shot of the Publish option in Solution Explorer",
      "pos": [
        30640,
        30694
      ]
    },
    {
      "pos": [
        30751,
        30958
      ],
      "content": "Everything should already be configured according to your credentials; in fact the website has already been created in Azure for you at the <bpt id=\"p1\">**</bpt>Destination URL<ept id=\"p1\">**</ept> shown, all you need to do is click <bpt id=\"p2\">**</bpt>Publish<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Screen shot of the Publish Web dialog box",
      "pos": [
        30966,
        31007
      ]
    },
    {
      "content": "In a few seconds, Visual Studio will finish publishing your web application and launch a browser where you can see your handy work running in Azure!",
      "pos": [
        31061,
        31209
      ]
    },
    {
      "pos": [
        31213,
        31251
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637775\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Next steps"
    },
    {
      "content": "Congratulations!",
      "pos": [
        31253,
        31269
      ]
    },
    {
      "content": "You just built your first ASP.NET MVC application using Azure DocumentDB and published it to Azure Websites.",
      "pos": [
        31270,
        31378
      ]
    },
    {
      "content": "The source code for the complete application, including the detail and delete functionality that were not included in this tutorial can be downloaded or cloned from <bpt id=\"p1\">[</bpt>GitHub<ept id=\"p1\">][]</ept>.",
      "pos": [
        31379,
        31555
      ]
    },
    {
      "content": "So if you're interested in adding that to your app, grab the code and add it to this app.",
      "pos": [
        31556,
        31645
      ]
    },
    {
      "pos": [
        31647,
        31888
      ],
      "content": "To add additional functionality to your application, review the APIs available in the <bpt id=\"p1\">[</bpt>Document DB .NET Library<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn783362.aspx)</ept> and feel free to contribute to the DocumentDB .NET Library on <bpt id=\"p2\">[</bpt>GitHub<ept id=\"p2\">][]</ept>."
    },
    {
      "pos": [
        31893,
        31944
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"GetProject\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Get the solution from GitHub"
    },
    {
      "content": "If you're looking to save time and just want to build the complete todo solution, and not  add the code yourself, you're in luck.",
      "pos": [
        31946,
        32075
      ]
    },
    {
      "content": "The complete solution is available on GitHub and you can build it and deploy it in a few minutes using the following instructions.",
      "pos": [
        32076,
        32206
      ]
    },
    {
      "pos": [
        32211,
        32356
      ],
      "content": "Ensure you have the <bpt id=\"p1\">[</bpt>prerequisite software<ept id=\"p1\">](#_Toc395637760)</ept> installed, which includes Visual Studio and Azure SDK for .NET version 2.3 or higher."
    },
    {
      "pos": [
        32361,
        32566
      ],
      "content": "Clone the azure-documentdb-net repository using Git for Windows (<bpt id=\"p1\">[</bpt>http://www.git-scm.com/<ept id=\"p1\">](http://www.git-scm.com/)</ept>), or download the zip file from <bpt id=\"p2\">[</bpt>GitHub<ept id=\"p2\">](https://github.com/Azure/azure-documentdb-net/)</ept>."
    },
    {
      "content": "From Visual Studio, open the todo.sln file from the azure-documentdb-net/tutorials/todo directory.",
      "pos": [
        32571,
        32669
      ]
    },
    {
      "pos": [
        32674,
        32889
      ],
      "content": "To restore the references to the DocumentDB .NET SDK in Visual Studio 2013, right-click the todo solution in <bpt id=\"p1\">**</bpt>Solution Explorer<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Enable NuGet Package Restore<ept id=\"p2\">**</ept>, which will restore the references."
    },
    {
      "pos": [
        32895,
        33072
      ],
      "content": "Retrieve the <bpt id=\"p1\">**</bpt>URI<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>PRIMARY KEY<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>SECONDARY KEY<ept id=\"p3\">**</ept> values from the <bpt id=\"p4\">**</bpt>Keys<ept id=\"p4\">**</ept> blade of your DocumentDB account in the <bpt id=\"p5\">[</bpt>Azure Preview portal<ept id=\"p5\">](https://portal.azure.com/)</ept>."
    },
    {
      "pos": [
        33494,
        33586
      ],
      "content": "In the Web.config file, update the default values for the <bpt id=\"p1\">**</bpt>endpoint<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>authKey<ept id=\"p2\">**</ept> keys."
    },
    {
      "pos": [
        33836,
        33929
      ],
      "content": "Copy the <bpt id=\"p1\">**</bpt>URI<ept id=\"p1\">**</ept> value from the Keys blade and paste it into the <bpt id=\"p2\">**</bpt>endpoint<ept id=\"p2\">**</ept> property value."
    },
    {
      "pos": [
        33937,
        34062
      ],
      "content": "Copy the <bpt id=\"p1\">**</bpt>PRIMARY KEY<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>SECONDARY KEY<ept id=\"p2\">**</ept> value from the <bpt id=\"p3\">**</bpt>Keys<ept id=\"p3\">**</ept> blade and paste it into the <bpt id=\"p4\">**</bpt>authKey<ept id=\"p4\">**</ept> property value."
    },
    {
      "pos": [
        34073,
        34187
      ],
      "content": "You can now <bpt id=\"p1\">[</bpt>run your application locally<ept id=\"p1\">](#_Toc395637773)</ept> and then <bpt id=\"p2\">[</bpt>deploy it to Azure Websites<ept id=\"p2\">](#_Toc395637774)</ept>."
    },
    {
      "content": "test",
      "pos": [
        34734,
        34738
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Build a web application with ASP.NET MVC using DocumentDB | Microsoft Azure\" \n    description=\"Learn how to use DocumentDB with .NET to build a To Do List web application. You'll store and access data from an ASP.NET MVC web application hosted on Azure Websites.\" \n    services=\"documentdb\" \n    documentationCenter=\".net\" \n    authors=\"ryancrawcour\" \n    manager=\"jhubbard\" \n    editor=\"cgronlun\"/>\n\n\n<tags \n    ms.service=\"documentdb\" \n    ms.workload=\"data-services\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"dotnet\" \n    ms.topic=\"hero-article\" \n    ms.date=\"07/24/2015\" \n    ms.author=\"ryancraw\"/>\n\n#<a name=\"_Toc395809351\"></a>Build a web application with ASP.NET MVC using DocumentDB\n\nTo highlight how you can efficiently leverage Azure DocumentDB to store and query JSON documents, this article provides an end-to-end walk-through showing you how to build a todo list web application using Azure DocumentDB. The tasks will be stored as JSON documents in Azure DocumentDB.\n\n![Screen shot of the todo list web application created by this tutorial](./media/documentdb-dotnet-application/image1.png)\n\nThis walk-through shows you how to use the DocumentDB service provided by Azure to store and access data from an ASP.NET MVC web application hosted on Azure.\n\n> [AZURE.TIP] This tutorial assumes that you have prior experience using ASP.NET MVC and Azure Websites. If you are new to ASP.NET or the [prerequisite tools](#_Toc395637760), we recommend downloading the complete [todo](https://github.com/Azure/azure-documentdb-net/tree/master/tutorials/todo) tutorial project from [GitHub](https://github.com/Azure/azure-documentdb-net) and building it using the [instructions at the end of this article](#GetProject). Once you have it built, you can review the article to gain insight on the code in the context of the project.\n\n## <a name=\"_Toc395637760\"></a>Prerequisites\n\nBefore following the instructions in this article, you should ensure that you have the following:\n\n- An active Azure account. If you don't have an account, you can create a free trial account in just a couple of minutes. For details, see [Azure Free Trial](../../pricing/free-trial/).\n- [Visual Studio 2013](http://www.visualstudio.com/) Update 4 or higher.\n- Azure SDK for .NET version 2.5.1 or higher, available through the [Microsoft Web Platform Installer][].\n\nAll the screen shots in this article have been taken using Visual Studio 2013 with Update 4 applied and the Azure SDK for .NET version 2.5.1. If your system is configured with different versions it is possible that your screens and options won't match entirely, but if you meet the above prerequisites this solution should work.\n\n## <a name=\"_Toc395637761\"></a>Step 1: Create a DocumentDB database account\n\nLet's start by creating a DocumentDB account. If you already have an account, you can skip to [Create a new ASP.NET MVC application](#_Toc395637762).\n\n[AZURE.INCLUDE [documentdb-create-dbaccount](../../includes/documentdb-create-dbaccount.md)]\n\n[AZURE.INCLUDE [documentdb-keys](../../includes/documentdb-keys.md)]\n\n<br/>\nWe will now walk through how to create a new ASP.NET MVC application from the ground-up. \n\n## <a name=\"_Toc395637762\"></a>Step 2: Create a new ASP.NET MVC application\n\nNow that you have an account, let's create our new ASP.NET project.\n\n1. In Visual Studio, on the **File** menu, point to **New**, and then click **Project**.\n\n    The **New Project** dialog box appears.\n2. In the **Project types** pane, expand **Templates**, **Visual C#**, **Web**, and then select **ASP.NET Web Application**.\n\n    ![Screen shot of the New Project dialog box with the ASP.NET Web Application project type highlighted](./media/documentdb-dotnet-application/image10.png)\n\n3. In the **Name** box, type the name of the project. This tutorial uses the name \"todo\". If you choose to use something other than this, then wherever this tutorial talks about the todo namespace, you need to adjust the provided code samples to use whatever you named your application. \n\n4. Click **Browse** to navigate to the folder where you would like to create the project, and then click **OK**.\n\n    The **New ASP.NET Project** dialog box appears.\n\n    ![Screen shot of the New ASP.NET Project dialog box with the MVC template highlighted and the Host in the cloud box checked](./media/documentdb-dotnet-application/image11.png)\n\n5. In the templates pane, select **MVC**.\n\n6. If you plan on hosting your application in Azure then select **Host in the cloud** on the lower right to have Azure host the application. We've selected to host in the cloud, and to run the application hosted in an Azure Website. Selecting this option will preprovision an Azure Website for you and make life a lot easier when it comes time to deploy the final working application. If you want to host this elsewhere or don't want to configure Azure upfront, then just clear **Host in the Cloud**.\n\n7. Click **OK** and let Visual Studio do its thing around scaffolding the empty ASP.NET MVC template. \n\n8. If you chose to host this in the cloud you will see at least one additional screen asking you to login to your Azure account and provide some values for your new website. Supply all the additional values and continue. \n\n    I haven't chosen a \"Database server\" here because we're not using an Azure SQL Database Server here, we're going to be creating a new Azure DocumentDB account later on in the Azure Preview portal.\n\n    For more information about choosing an **App Service plan** and **Resource group**, see [Azure App Service plans in-depth overview](azure-web-sites-web-hosting-plans-in-depth-overview.md).\n\n    ![Screen shot of the Configure Microsoft Azure Website dialog box](./media/documentdb-dotnet-application/image11_1.png)\n\n9. Once Visual Studio has finished creating the boilerplate MVC application you have an empty ASP.NET application that you can run locally.\n\n    We'll skip running the project locally because I'm sure we've all seen the ASP.NET \"Hello World\" application. Let's go straight to adding DocumentDB to this project and building our application.\n\n## <a name=\"_Toc395637767\"></a>Step 3: Add DocumentDB to your project\n\nNow that we have most of the ASP.NET MVC plumbing that we need for\nthis solution, let's get to the real purpose of this tutorial, adding Azure DocumentDB to our web application.\n\n1. The DocumentDB .NET SDK is packaged and distributed as a NuGet package. To get the NuGet package in Visual Studio, use the NuGet package manager in Visual Studio by right-clicking on the project in **Solution Explorer** and then clicking **Manage NuGet Packages**.\n\n    ![Sreen shot of the right-click options for the project in Solution Explorer, with Manage NuGet Packages highlighted.](./media/documentdb-dotnet-application/image21.png)\n\n    The **Manage NuGet Packages** dialog box appears.\n\n2. In the **Search Online** box, type ***Azure DocumentDB***. \n    \n    From the results, install the **Microsoft Azure DocumentDB Client Library** package. This will download and install the DocumentDB package as well as all dependencies, like Newtonsoft.Json.\n\n    ![Sreen shot of the Manage NuGet Packages window, with the Microsoft Azure DocumentDB Client Library highlighted](./media/documentdb-dotnet-application/nuget.png)\n\n    Alternatively you can use the Package Manager Console to install the package. To do so, on the **Tools** menu, click **NuGet Package Manager**, and then click **Package Manager Console**. At the prompt, type the following.\n\n        Install-Package Microsoft.Azure.DocumentDB\n\n3. Once the package is installed, your Visual Studio solution should resemble the following with two new references added, Microsoft.Azure.Documents.Client and Newtonsoft.Json.\n\n    ![Sreen shot of the two references added to the project in Solution Explorer](./media/documentdb-dotnet-application/image22.png)\n\n\n##<a name=\"_Toc395637763\"></a>Step 4: Set up the ASP.NET MVC application\n \nNow let's add the models, views, and controllers to this MVC application:\n\n- [Add a model](#_Toc395637764).\n- [Add a controller](#_Toc395637765).\n- [Add views](#_Toc395637766).\n\n\n### <a name=\"_Toc395637764\"></a>Add a model\n\nLet's begin by creating the **M** in MVC, the model. \n\n1. In **Solution Explorer**, right-click the **Models** folder, click **Add**, and then click **Class**.\n\n    The **Add New Item** dialog box appears.\n\n2. Name your new class **Item.cs** and click **Add**. \n\n3. In this new **Item.cs** file, add the following after the last *using statement*.\n        \n        using Newtonsoft.Json;\n    \n4. Now replace this code \n        \n        public class Item\n        {\n        }\n\n    with the following code.\n        \n        public class Item\n        {\n            [JsonProperty(PropertyName=\"id\")]\n            public string Id { get; set; }\n        \n            [JsonProperty(PropertyName=\"name\")]\n            public string Name { get; set; }\n        \n            [JsonProperty(PropertyName = \"desc\")]\n            public string Description { get; set; }\n        \n            [JsonProperty(PropertyName=\"isComplete\")]\n            public bool Completed { get; set; }    \n        }\n\n    All data in DocumentDB is passed over the wire and stored as JSON. To control the way your objects are serialized/deserialized by JSON.NET you can use the **JsonProperty** attribute as demonstrated in the **Item** class we just created. You don't **have** to do this but I want to ensure that my properties follow the JSON camelCase naming conventions. \n    \n    Not only can you control the format of the property name when it goes into JSON, but you can entirely rename your .NET properties like I did with the **Description** property. \n    \n\n### <a name=\"_Toc395637765\"></a>Add a controller\n\nThat takes care of the **M**, now let's create the **C** in MVC, a controller class.\n\n1. In **Solution Explorer**, right-click the **Controllers** folder, click **Add**, and then click **Controller**.\n\n    The **Add Scaffold** dialog box appears.\n\n2. Select **MVC 5 Controller - Empty** and then click **Add**.\n\n    ![Screen shot of the Add Scaffold dialog box with the MVC 5 Controller - Empty option highlighted](./media/documentdb-dotnet-application/image14.png)\n\n3. Name your new Controller, **ItemController.**\n\n    ![Screen shot of the Add Controller dialog box](./media/documentdb-dotnet-application/image15.png)\n\n    Once the file is created, your Visual Studio solution should resemble the following with the new ItemController.cs file in **Solution Explorer**. The new Item.cs file created earlier is also shown.\n\n    ![Screen shot of Solution Explorer with the new ItemController.cs file and Item.cs file highlighted](./media/documentdb-dotnet-application/image16.png)\n\n    You can close ItemController.cs, we'll come back to it later. \n\n### <a name=\"_Toc395637766\"></a>Add views\n\nNow, let's create the **V** in MVC, the views:\n\n- [Add an Item Index view](#AddItemIndexView).\n- [Add a New Item view](#AddNewIndexView).\n- [Add an Edit Item view](#_Toc395888515).\n\n\n#### <a name=\"AddItemIndexView\"></a>Add an Item Index view\n\n1. In **Solution Explorer**, expand the **Views**  folder, right-click the empty **Item** folder that Visual Studio created for you when you added the **ItemController** earlier, click **Add**, and then click **View**.\n\n    ![Screen shot of Solution Explorer showing the Item folder with the Add View commands highlighted](./media/documentdb-dotnet-application/image17.png)\n\n2. In the **Add View** dialog box, do the following:\n    - In the **View name** box, type ***Index***.\n    - In the **Template** box, select ***List***.\n    - In the **Model class** box, select ***Item (todo.Models)***.\n    - Leave the **Data context class** box empty. \n    - In the layout page box, type ***~/Views/Shared/_Layout.cshtml***.\n    \n    ![Screen shot showing the Add View dialog box](./media/documentdb-dotnet-application/image18.png)\n\n3. Once all these values are set, click **Add** and let Visual Studio create a new template view. Once it is done, it will open the cshtml file  that was created. We can close that file in Visual Studio as we will come back to it later.\n\n#### <a name=\"AddNewIndexView\"></a>Add a New Item view\n\nSimilar to how we created an **Item Index** view, we will now create a new view for creating new **Items**.\n\n1. In **Solution Explorer**, right-click the **Item** folder again, click **Add**, and then click **View**.\n\n2. In the **Add View** dialog box, do the following:\n    - In the **View name** box, type ***Create***.\n    - In the **Template** box, select ***Create***.\n    - In the **Model class** box, select ***Item (todo.Models)***.\n    - Leave the **Data context class** box empty.\n    - In the layout page box, type ***~/Views/Shared/_Layout.cshtml***.\n    - Click **Add**.\n\n#### <a name=\"_Toc395888515\"></a>Add an Edit Item view\n\nAnd finally, add one last view for editing an **Item** in the same way as before.\n\n1. In **Solution Explorer**, right-click the **Item** folder again, click **Add**, and then click **View**.\n\n2. In the **Add View** dialog box, do the following:\n    - In the **View name** box, type ***Edit***.\n    - In the **Template** box, select ***Edit***.\n    - In the **Model class** box, select ***Item (todo.Models)***.\n    - Leave the **Data context class** box empty. \n    - In the layout page box, type ***~/Views/Shared/_Layout.cshtml***.\n    - Click **Add**.\n\nOnce this is done, close all the cshtml documents in Visual Studio as we will return to these views later.\n\n## <a name=\"_Toc395637769\"></a>Step 5: Wiring up DocumentDB\n\nNow that the standard MVC stuff is taken care of, let's turn to adding the code for DocumentDB. \n\nIn this section, we'll add code to handle the following:\n\n- [Listing incomplete Items](#_Toc395637770).\n- [Adding Items](#_Toc395637771).\n- [Editing Items](#_Toc395637772).\n\n### <a name=\"_Toc395637770\"></a>Listing incomplete Items\n\nThe first thing to do here is add a class that contains all the logic to connect to and use DocumentDB. For this tutorial we'll encapsulate all this logic in to a repository class called DocumentDBRepository. \n\n1. In **Solution Explorer**, right-click on the project, click **Add**, and then click **Class**. Name the new class **DocumentDBRepository** and click **Add**.\n \n2. In the newly created **DocumentDBRepository** class and add the following *using statements* above the *namespace* declaration\n        \n        using Microsoft.Azure.Documents; \n        using Microsoft.Azure.Documents.Client; \n        using Microsoft.Azure.Documents.Linq; \n        using System.Configuration;\n        using System.Linq.Expressions;\n        using System.Threading.Tasks;\n\n    Now replace this code \n\n        public class DocumentDBRepository\n        {\n        }\n\n    with the following code.\n\n        \n        public static class DocumentDBRepository<T>\n        {\n            //Use the Database if it exists, if not create a new Database\n            private static Database ReadOrCreateDatabase()\n            {\n                var db = Client.CreateDatabaseQuery()\n                                .Where(d => d.Id == DatabaseId)\n                                .AsEnumerable()\n                                .FirstOrDefault();\n                \n                if (db == null)\n                {\n                    db = Client.CreateDatabaseAsync(new Database { Id = DatabaseId }).Result;\n                }\n                \n                return db;\n            }\n            \n            //Use the DocumentCollection if it exists, if not create a new Collection\n            private static DocumentCollection ReadOrCreateCollection(string databaseLink)\n            {\n                var col = Client.CreateDocumentCollectionQuery(databaseLink)\n                                  .Where(c => c.Id == CollectionId)\n                                  .AsEnumerable()\n                                  .FirstOrDefault();\n        \n                if (col == null)\n                {\n                    var collectionSpec = new DocumentCollection { Id = CollectionId };\n                    var requestOptions = new RequestOptions {OfferType = \"S1\" };\n                    \n                    col = Client.CreateDocumentCollectionAsync(databaseLink, collectionSpec, requestOptions).Result;\n                }\n                \n                return col;\n            }\n            \n            //Expose the \"database\" value from configuration as a property for internal use\n            private static string databaseId;\n            private static String DatabaseId\n            {\n                get\n                {\n                    if (string.IsNullOrEmpty(databaseId))\n                    {\n                        databaseId = ConfigurationManager.AppSettings[\"database\"];\n                    }\n                \n                    return databaseId;\n                }\n            }\n            \n            //Expose the \"collection\" value from configuration as a property for internal use\n            private static string collectionId;\n            private static String CollectionId\n            {\n                get\n                {\n                    if (string.IsNullOrEmpty(collectionId))\n                    {\n                        collectionId = ConfigurationManager.AppSettings[\"collection\"];\n                    }\n                \n                    return collectionId;\n                }\n            }\n            \n            //Use the ReadOrCreateDatabase function to get a reference to the database.\n            private static Database database;\n            private static Database Database\n            {\n                get\n                {\n                    if (database == null)\n                    {\n                        database = ReadOrCreateDatabase();\n                    }\n                    \n                    return database;\n                }\n            }\n            \n            //Use the ReadOrCreateCollection function to get a reference to the collection.\n            private static DocumentCollection collection;\n            private static DocumentCollection Collection\n            {\n                get\n                {\n                    if (collection == null)\n                    {\n                        collection = ReadOrCreateCollection(Database.SelfLink);\n                    }\n                    \n                    return collection;\n                }\n            }\n            \n            //This property establishes a new connection to DocumentDB the first time it is used, \n            //and then reuses this instance for the duration of the application avoiding the\n            //overhead of instantiating a new instance of DocumentClient with each request\n            private static DocumentClient client;\n            private static DocumentClient Client\n            {\n                get\n                {\n                    if (client == null)\n                    {\n                        string endpoint = ConfigurationManager.AppSettings[\"endpoint\"];\n                        string authKey = ConfigurationManager.AppSettings[\"authKey\"];\n                        Uri endpointUri = new Uri(endpoint);\n                        client = new DocumentClient(endpointUri, authKey);\n                    }\n                    \n                    return client;\n                }\n            }\n        }\n\n    > [AZURE.TIP] When creating a new DocumentCollection you can supply an optional RequestOptions parameter of OfferType, which allows you to specify the performance level of the new collection. If this parameter is not passed the default offer type will be used. For more on DocumentDB offer types please refer to [DocumentDB Performance Levels](documentdb-performance-levels.md)\n\n3. We're reading some values from configuration, so open the **Web.config** file of your application and add the following lines under the `<AppSettings>` section.\n    \n        <add key=\"endpoint\" value=\"enter the URI from the Keys blade of the Azure Preview portal\"/>\n        <add key=\"authKey\" value=\"enter the PRIMARY KEY, or the SECONDARY KEY, from the Keys blade of the Azure  Preview portal\"/>\n        <add key=\"database\" value=\"ToDoList\"/>\n        <add key=\"collection\" value=\"Items\"/>\n    \n4. Now, update the values for *endpoint* and *authKey* using the Keys blade of the Azure Preview portal. Use the **URI** from the Keys blade as the value of the endpoint setting, and use the **PRIMARY KEY**, or **SECONDARY KEY** from the Keys blade as the value of the authKey setting.\n\n\n    That takes care of wiring up the DocumentDB repository, now let's add our application logic.\n\n5. The first thing we want to be able to do with a todo list application is to display the incomplete items.  Copy and paste the following code snippet anywhere within the **DocumentDBRepository** class.\n\n        public static IEnumerable<T> GetItems(Expression<Func<T, bool>> predicate) \n        {\n            return Client.CreateDocumentQuery<T>(Collection.DocumentsLink) \n                .Where(predicate) \n                .AsEnumerable(); \n        } \n\n6. Open the **ItemController** we added earlier and add the following *using statements* above the namespace declaration.\n\n        using System.Net;\n        using System.Threading.Tasks;\n        using todo.Models;\n\n    If your project is not named \"todo\", then you need to update using \"todo.Models\"; to reflect the name of your project.\n\n    Now replace this code\n\n        //GET: Item\n        public ActionResult Index()\n        {\n            return View();\n        }\n\n    with the following code.\n\n        public ActionResult Index()\n        {\n            var items = DocumentDBRepository<Item>.GetItems(d => !d.Completed);\n            return View(items);\n        }\n    \nAt this point your solution should be able to build without any errors.\n\nIf you ran the application now, you would go to the **HomeController** and the **Index** view of that controller. This is the default behavior for the MVC template project we chose at the start but we don't want that! Let's change the routing on this MVC application to alter this behavior.\n\nOpen ***App\\_Start\\RouteConfig.cs*** and locate the line starting with \"defaults:\" and change it to resemble the following.\n\n        defaults: new { controller = \"Item\", action = \"Index\", id = UrlParameter.Optional }\n\nThis now tells ASP.NET MVC that if you have not specified a value in the URL to control the routing behavior that instead of **Home**, use **Item** as the controller and user **Index** as the view.\n\nNow if you run the application, it will call into your **ItemController** which will call in to the repository class and use the GetItems method to return all the incomplete items to the **Views**\\\\**Item**\\\\**Index** view. \n\nIf you build and run this project now, you should now see something that looks this.    \n\n![Screen shot of the todo list web application created by this tutorial](./media/documentdb-dotnet-application/image23.png)\n\n### <a name=\"_Toc395637771\"></a>Adding Items\n\nLet's put some items into our database so we have something more than an empty grid to look at.\n\nLet's add some code to  DocumentDBRepository and ItemController to persist the record in DocumentDB.\n\n1.  Add the following method to your **DocumentDBRepository** class.\n\n        public static async Task<Document> CreateItemAsync(T item)\n        {\n            return await Client.CreateDocumentAsync(Collection.SelfLink, item);\n        }\n\n    This method simply takes an object passed to it and persists it in DocumentDB.\n\n2. Open the ItemController.cs file and add the following code snippet within the class. This is how ASP.NET MVC knows what to do for the **Create** action. In this case just render the associated Create.cshtml view created earlier.\n\n        public ActionResult Create()\n        { \n            return View(); \n        }\n\n    We now need some more code in this controller that will accept the submission from the **Create** view.\n\n2. Add the next block of code to the ItemController.cs class that tells ASP.NET MVC what to do with a form POST for this controller.\n    \n        [HttpPost]\n        [ValidateAntiForgeryToken]\n        public async Task<ActionResult> Create([Bind(Include =  \"Id,Name,Description,Completed\")] Item item)  \n        {\n            if (ModelState.IsValid)  \n            {  \n                await DocumentDBRepository<Item>.CreateItemAsync(item);\n                return RedirectToAction(\"Index\");  \n            }   \n            return View(item);   \n        }\n    This code calls in to the DocumentDBRepository and uses the CreateItemAsync method to persist the new todo item to the database. \n \n    **Security Note**: The **ValidateAntiForgeryToken** attribute is used here to help protect this application against cross-site request forgery attacks. There is more to it than just adding this attribute, your views need to work with this anti-forgery token as well. For more on the subject, and examples of how to implement this correctly, please see [Preventing Cross-Site Request Forgery][]. The source code provided on [GitHub][] has the full implementation in place.\n\n    **Security Note**: We also use the **Bind** attribute on the method parameter to help protect against over-posting attacks. For more details please see [Basic CRUD Operations in ASP.NET MVC][].\n\nThis concludes the code required to add new Items to our database.\n\n\n### <a name=\"_Toc395637772\"></a>Editing Items\n\nThere is one last thing for us to do, and that is to add the ability to edit **Items** in the database and to mark them as complete. The view for editing was already added to the project, so we just need to add some code to our controller and to the **DocumentDBRepository** class again.\n\n1. Add the following to the **DocumentDBRepository** class.\n\n        public static T GetItem(Expression<Func<T, bool>> predicate)\n        {\n            return Client.CreateDocumentQuery<T>(Collection.DocumentsLink)\n                        .Where(predicate)\n                        .AsEnumerable()\n                        .FirstOrDefault();\n        }       \n\n        public static async Task<Document> UpdateItemAsync(string id, T item)\n        {\n            Document doc = GetDocument(id); \n            return await Client.ReplaceDocumentAsync(doc.SelfLink, item);\n        }\n\n        private static Document GetDocument(string id) \n        { \n            return Client.CreateDocumentQuery(Collection.DocumentsLink) \n                .Where(d => d.Id == id) \n                .AsEnumerable() \n                .FirstOrDefault(); \n        } \n    \n    The first of these methods, **GetItem** fetches an Item from DocumentDB which is passed back to the **ItemController** and then on to the **Edit** view.\n    \n    The second of the methods we just added replaces the **Document** in DocumentDB with the version of the **Document** passed in from the **ItemController**.\n\n2. Add the following to the **ItemController** class.\n\n        [HttpPost]\n        [ValidateAntiForgeryToken]\n        public async Task<ActionResult> Edit([Bind(Include = \"Id,Name,Description,Completed\")] Item item)\n        {\n           if (ModelState.IsValid)\n            {\n                await DocumentDBRepository<Item>.UpdateItemAsync(item.Id, item);\n                return RedirectToAction(\"Index\");\n            }\n\n          return View(item);\n        }\n        \n        public ActionResult Edit(string id)\n        {\n            if (string.IsNullOrEmpty(id))\n            {\n                return new HttpStatusCodeResult(HttpStatusCode.BadRequest);\n            }\n                     \n            Item item = (Item)DocumentDBRepository<Item>.GetItem(d => d.Id == id);\n            \n            if (item == null)\n            {\n                return HttpNotFound();\n            }\n            \n            return View(item);\n        }\n        \n    \n    The first method handles the Http GET that happens when the user clicks on the **Edit** link from the **Index** view. This method fetches a [**Document**](http://msdn.microsoft.com/library/azure/microsoft.azure.documents.document.aspx) from DocumentDB and passes it to the **Edit** view.\n\n    The **Edit** view will then do an Http POST to the **IndexController**. \n    \n    The second method we added handles passing the updated object to DocumentDB to be persisted in the database.\n\nThat's it, that is everything we need to run our application, list incomplete **Items**, add new **Items**, and edit **Items**.\n\n## <a name=\"_Toc395637773\"></a>Step 6: Run the application locally\n\nTo test the application on your local machine, do the following:\n\n1. Hit F5 in Visual Studio to build the application in debug mode. It should build the application and launch a browser with the empty grid page we saw before:\n\n    ![Screen shot of the todo list web application created by this tutorial](./media/documentdb-dotnet-application/image24.png)\n\n    If you run into errors at this point, you can compare your code against the todo tutorial on [GitHub][].\n\n2. Click the **Create New** link and add values to the **Name** and **Description** fields. Leave the **Completed** check box unselected otherwise the new **Item** will be added in a completed state and will not appear on the initial list.\n\n    ![Screen shot of the Create view](./media/documentdb-dotnet-application/image25.png)\n\n3. Click **Create** and you are redirected back to the **Index** view and your **Item** appears in the list.\n\n    ![Screen shot of the Index view](./media/documentdb-dotnet-application/image26.png)\n\n    Feel free to add a few more **Items** to your todo list.\n\n3. Click **Edit** next to an **Item** on the list and you are taken to the **Edit** view where you can update any property of your object, including the **Completed** flag. If you mark the **Complete** flag and click **Save**, the **Item** is removed from the list of incomplete tasks.\n\n    ![Screen shot of the Index view with the Completed box checked](./media/documentdb-dotnet-application/image27.png)\n\n4. Once you've tested the app, press Ctrl+F5 to stop debugging the app. You're ready to deploy!\n\n##<a name=\"_Toc395637774\"></a>Step 7: Deploy the application to Azure Websites\n\nNow that you have the complete application working correctly with DocumentDB we're going to deploy this web app to Azure Websites. If you selected **Host in the cloud** when you created the empty ASP.NET MVC project then Visual Studio makes this really easy and does most of the work for you. \n\n1. To publish this application all you need to do is right-click on the project in **Solution Explorer** and click **Publish**.\n\n    ![Screen shot of the Publish option in Solution Explorer](./media/documentdb-dotnet-application/image28.png)\n\n2. Everything should already be configured according to your credentials; in fact the website has already been created in Azure for you at the **Destination URL** shown, all you need to do is click **Publish**.\n\n    ![Screen shot of the Publish Web dialog box](./media/documentdb-dotnet-application/image29.png)\n\nIn a few seconds, Visual Studio will finish publishing your web application and launch a browser where you can see your handy work running in Azure!\n\n##<a name=\"_Toc395637775\"></a>Next steps\n\nCongratulations! You just built your first ASP.NET MVC application using Azure DocumentDB and published it to Azure Websites. The source code for the complete application, including the detail and delete functionality that were not included in this tutorial can be downloaded or cloned from [GitHub][]. So if you're interested in adding that to your app, grab the code and add it to this app.\n\nTo add additional functionality to your application, review the APIs available in the [Document DB .NET Library](http://msdn.microsoft.com/library/azure/dn783362.aspx) and feel free to contribute to the DocumentDB .NET Library on [GitHub][]. \n\n##<a id=\"GetProject\"></a>Get the solution from GitHub\n\nIf you're looking to save time and just want to build the complete todo solution, and not  add the code yourself, you're in luck. The complete solution is available on GitHub and you can build it and deploy it in a few minutes using the following instructions.\n\n1. Ensure you have the [prerequisite software](#_Toc395637760) installed, which includes Visual Studio and Azure SDK for .NET version 2.3 or higher.\n\n2. Clone the azure-documentdb-net repository using Git for Windows ([http://www.git-scm.com/](http://www.git-scm.com/)), or download the zip file from [GitHub](https://github.com/Azure/azure-documentdb-net/).\n\n2. From Visual Studio, open the todo.sln file from the azure-documentdb-net/tutorials/todo directory.\n\n3. To restore the references to the DocumentDB .NET SDK in Visual Studio 2013, right-click the todo solution in **Solution Explorer**, and then click **Enable NuGet Package Restore**, which will restore the references. \n\n4. Retrieve the **URI** and **PRIMARY KEY** or **SECONDARY KEY** values from the **Keys** blade of your DocumentDB account in the [Azure Preview portal](https://portal.azure.com/). \n\n    \n    If you don't have an account, see [Create a database account](documentdb-create-account.md) to set one up.\n\n    ![Screen shot of the Azure Preview portal, showing a DocumentDB account, with the ACTIVE hub highlighted, the Keys button highlighted on the DocumentDB account blade, and the URI, PRIMARY KEY and SECONDARY KEY values highlighted on the Keys blade](media/documentdb-dotnet-application/keys.png)\n\n5. In the Web.config file, update the default values for the **endpoint** and **authKey** keys.\n\n        <add key=\"endpoint\" value=\"~enter URI for your DocumentDB Account, from Azure Preview portal~\" /> \n        <add key=\"authKey\" value=\"~enter either Primary or Secondary key for your DocumentDB Account, from Azure Preview portal~\" /> \n\n    - Copy the **URI** value from the Keys blade and paste it into the **endpoint** property value. \n    - Copy the **PRIMARY KEY** or **SECONDARY KEY** value from the **Keys** blade and paste it into the **authKey** property value.\n    \n\n\n7. You can now [run your application locally](#_Toc395637773) and then [deploy it to Azure Websites](#_Toc395637774).\n\n\n[\\*]: https://microsoft.sharepoint.com/teams/DocDB/Shared%20Documents/Documentation/Docs.LatestVersions/PicExportError\n[Visual Studio Express]: http://www.visualstudio.com/products/visual-studio-express-vs.aspx\n[Microsoft Web Platform Installer]: http://www.microsoft.com/web/downloads/platform.aspx\n[GitHub]: http://go.microsoft.com/fwlink/?LinkID=509838&clcid=0x409\n[Preventing Cross-Site Request Forgery]: http://go.microsoft.com/fwlink/?LinkID=517254\n[Basic CRUD Operations in ASP.NET MVC]: http://go.microsoft.com/fwlink/?LinkId=317598\n \n\ntest\n"
}