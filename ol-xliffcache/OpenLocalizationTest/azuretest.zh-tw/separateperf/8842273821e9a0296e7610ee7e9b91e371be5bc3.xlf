<?xml version="1.0"?>
<xliff version="1.2" xmlns="urn:oasis:names:tc:xliff:document:1.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:oasis:names:tc:xliff:document:1.2 xliff-core-1.2-transitional.xsd">
  <file datatype="xml" original="md" source-language="en-US" target-language="zh-tw">
    <body>
      <group id="content" extype="content">
        <trans-unit id="101" translate="yes" xml:space="preserve">
          <source>Using elastic database client library with Entity Framework</source>
          <target state="new">Using elastic database client library with Entity Framework</target>
        </trans-unit>
        <trans-unit id="102" translate="yes" xml:space="preserve">
          <source>Elastic database client makes it easy to scale, and Entity Framework is easy to use for coding databases</source>
          <target state="new">Elastic database client makes it easy to scale, and Entity Framework is easy to use for coding databases</target>
        </trans-unit>
        <trans-unit id="103" translate="yes" xml:space="preserve">
          <source>Elastic Database client library with Entity Framework</source>
          <target state="new">Elastic Database client library with Entity Framework</target>
        </trans-unit>
        <trans-unit id="104" translate="yes" xml:space="preserve">
          <source>You can use the elastic database client library with Microsoft’s Entity Framework (EF) to build applications that take advantage of database sharding, facilitating scaling-out your application's data tier.</source>
          <target state="new">You can use the elastic database client library with Microsoft’s Entity Framework (EF) to build applications that take advantage of database sharding, facilitating scaling-out your application's data tier.</target>
        </trans-unit>
        <trans-unit id="105" translate="yes" xml:space="preserve">
          <source>This document shows the changes in an Entity Framework application that are needed to integrate with the elastic database tools' capabilities.</source>
          <target state="new">This document shows the changes in an Entity Framework application that are needed to integrate with the elastic database tools' capabilities.</target>
        </trans-unit>
        <trans-unit id="106" translate="yes" xml:space="preserve">
          <source>The focus is on composing <bpt id="p1">[</bpt>shard map management<ept id="p1">](sql-database-elastic-scale-shard-map-management.md)</ept> and <bpt id="p2">[</bpt>data-dependent routing<ept id="p2">](sql-database-elastic-scale-data-dependent-routing.md)</ept> with the Entity Framework <bpt id="p3">**</bpt>Code First<ept id="p3">**</ept> approach.</source>
          <target state="new">The focus is on composing <bpt id="p1">[</bpt>shard map management<ept id="p1">](sql-database-elastic-scale-shard-map-management.md)</ept> and <bpt id="p2">[</bpt>data-dependent routing<ept id="p2">](sql-database-elastic-scale-data-dependent-routing.md)</ept> with the Entity Framework <bpt id="p3">**</bpt>Code First<ept id="p3">**</ept> approach.</target>
        </trans-unit>
        <trans-unit id="107" translate="yes" xml:space="preserve">
          <source>The <bpt id="p1">[</bpt>Code First – New Database<ept id="p1">](http://msdn.microsoft.com/data/jj193542.aspx)</ept> tutorial for EF serves as our running example throughout this document.</source>
          <target state="new">The <bpt id="p1">[</bpt>Code First – New Database<ept id="p1">](http://msdn.microsoft.com/data/jj193542.aspx)</ept> tutorial for EF serves as our running example throughout this document.</target>
        </trans-unit>
        <trans-unit id="108" translate="yes" xml:space="preserve">
          <source>The sample code accompanying this document is part of elastic database tools' set of samples in the Visual Studio Code Samples.</source>
          <target state="new">The sample code accompanying this document is part of elastic database tools' set of samples in the Visual Studio Code Samples.</target>
        </trans-unit>
        <trans-unit id="109" translate="yes" xml:space="preserve">
          <source>Downloading and Running the Sample Code</source>
          <target state="new">Downloading and Running the Sample Code</target>
        </trans-unit>
        <trans-unit id="110" translate="yes" xml:space="preserve">
          <source>To download the code for this article:</source>
          <target state="new">To download the code for this article:</target>
        </trans-unit>
        <trans-unit id="111" translate="yes" xml:space="preserve">
          <source>Visual Studio 2012 or later is required.</source>
          <target state="new">Visual Studio 2012 or later is required.</target>
        </trans-unit>
        <trans-unit id="112" translate="yes" xml:space="preserve">
          <source>Start Visual Studio.</source>
          <target state="new">Start Visual Studio.</target>
        </trans-unit>
        <trans-unit id="113" translate="yes" xml:space="preserve">
          <source>In Visual Studio, select File -&gt; New Project.</source>
          <target state="new">In Visual Studio, select File -&gt; New Project.</target>
        </trans-unit>
        <trans-unit id="114" translate="yes" xml:space="preserve">
          <source>In the ‘New Project’ dialog, navigate to the <bpt id="p1">**</bpt>Online Samples<ept id="p1">**</ept> for <bpt id="p2">**</bpt>Visual C#<ept id="p2">**</ept> and type "elastic db" into the search box in the upper right.</source>
          <target state="new">In the ‘New Project’ dialog, navigate to the <bpt id="p1">**</bpt>Online Samples<ept id="p1">**</ept> for <bpt id="p2">**</bpt>Visual C#<ept id="p2">**</ept> and type "elastic db" into the search box in the upper right.</target>
        </trans-unit>
        <trans-unit id="115" translate="yes" xml:space="preserve">
          <source>![Entity Framework and elastic database sample app][1]</source>
          <target state="new">![Entity Framework and elastic database sample app][1]</target>
        </trans-unit>
        <trans-unit id="116" translate="yes" xml:space="preserve">
          <source>Select the sample called <bpt id="p1">**</bpt>Elastic DB Tools for Azure SQL – Entity Framework Integration<ept id="p1">**</ept>.</source>
          <target state="new">Select the sample called <bpt id="p1">**</bpt>Elastic DB Tools for Azure SQL – Entity Framework Integration<ept id="p1">**</ept>.</target>
        </trans-unit>
        <trans-unit id="117" translate="yes" xml:space="preserve">
          <source>After accepting the license, the sample loads.</source>
          <target state="new">After accepting the license, the sample loads.</target>
        </trans-unit>
        <trans-unit id="118" translate="yes" xml:space="preserve">
          <source>To run the sample, you need to create three empty databases in Azure SQL Database:</source>
          <target state="new">To run the sample, you need to create three empty databases in Azure SQL Database:</target>
        </trans-unit>
        <trans-unit id="119" translate="yes" xml:space="preserve">
          <source>Shard Map Manager database</source>
          <target state="new">Shard Map Manager database</target>
        </trans-unit>
        <trans-unit id="120" translate="yes" xml:space="preserve">
          <source>Shard 1 database</source>
          <target state="new">Shard 1 database</target>
        </trans-unit>
        <trans-unit id="121" translate="yes" xml:space="preserve">
          <source>Shard 2 database</source>
          <target state="new">Shard 2 database</target>
        </trans-unit>
        <trans-unit id="122" translate="yes" xml:space="preserve">
          <source>Once you have created these databases, fill in the place holders in <bpt id="p1">**</bpt>Program.cs<ept id="p1">**</ept> with your Azure SQL DB server name, the database names and your credentials to connect to the databases.</source>
          <target state="new">Once you have created these databases, fill in the place holders in <bpt id="p1">**</bpt>Program.cs<ept id="p1">**</ept> with your Azure SQL DB server name, the database names and your credentials to connect to the databases.</target>
        </trans-unit>
        <trans-unit id="123" translate="yes" xml:space="preserve">
          <source>Build the solution in Visual Studio.</source>
          <target state="new">Build the solution in Visual Studio.</target>
        </trans-unit>
        <trans-unit id="124" translate="yes" xml:space="preserve">
          <source>Visual Studio will download the required NuGet packages for the elastic database client library, Entity Framework, and Transient Fault handling as part of the build process.</source>
          <target state="new">Visual Studio will download the required NuGet packages for the elastic database client library, Entity Framework, and Transient Fault handling as part of the build process.</target>
        </trans-unit>
        <trans-unit id="125" translate="yes" xml:space="preserve">
          <source>Make sure that restoring NuGet packages is enabled for your solution.</source>
          <target state="new">Make sure that restoring NuGet packages is enabled for your solution.</target>
        </trans-unit>
        <trans-unit id="126" translate="yes" xml:space="preserve">
          <source>You can enable this setting by right-clicking on the solution file in the Visual Studio Solution Explorer.</source>
          <target state="new">You can enable this setting by right-clicking on the solution file in the Visual Studio Solution Explorer.</target>
        </trans-unit>
        <trans-unit id="127" translate="yes" xml:space="preserve">
          <source>Entity Framework workflows</source>
          <target state="new">Entity Framework workflows</target>
        </trans-unit>
        <trans-unit id="128" translate="yes" xml:space="preserve">
          <source>Entity Framework developers rely on one of the following four workflows to build applications and to ensure persistence for application objects:</source>
          <target state="new">Entity Framework developers rely on one of the following four workflows to build applications and to ensure persistence for application objects:</target>
        </trans-unit>
        <trans-unit id="129" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>Code First (New Database)<ept id="p1">**</ept>: The EF developer creates the model in the application code and then EF generates the database from it.</source>
          <target state="new"><bpt id="p1">**</bpt>Code First (New Database)<ept id="p1">**</ept>: The EF developer creates the model in the application code and then EF generates the database from it.</target>
        </trans-unit>
        <trans-unit id="130" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>Code First (Existing Database)<ept id="p1">**</ept>: The developer lets EF generate the application code for the model from an existing database.</source>
          <target state="new"><bpt id="p1">**</bpt>Code First (Existing Database)<ept id="p1">**</ept>: The developer lets EF generate the application code for the model from an existing database.</target>
        </trans-unit>
        <trans-unit id="131" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>Model First<ept id="p1">**</ept>: The developer creates the model in the EF designer and then EF creates the database from the model.</source>
          <target state="new"><bpt id="p1">**</bpt>Model First<ept id="p1">**</ept>: The developer creates the model in the EF designer and then EF creates the database from the model.</target>
        </trans-unit>
        <trans-unit id="132" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>Database First<ept id="p1">**</ept>: The developer uses EF tooling to infer the model from an existing database.</source>
          <target state="new"><bpt id="p1">**</bpt>Database First<ept id="p1">**</ept>: The developer uses EF tooling to infer the model from an existing database.</target>
        </trans-unit>
        <trans-unit id="133" translate="yes" xml:space="preserve">
          <source>All these approaches rely on the DbContext class to transparently manage database connections and database schema for an application.</source>
          <target state="new">All these approaches rely on the DbContext class to transparently manage database connections and database schema for an application.</target>
        </trans-unit>
        <trans-unit id="134" translate="yes" xml:space="preserve">
          <source>As we will discuss in more detail later in the document, different constructors on the DbContext base class allow for different levels of control over connection creation, database bootstrapping and schema creation.</source>
          <target state="new">As we will discuss in more detail later in the document, different constructors on the DbContext base class allow for different levels of control over connection creation, database bootstrapping and schema creation.</target>
        </trans-unit>
        <trans-unit id="135" translate="yes" xml:space="preserve">
          <source>Challenges arise primarily from the fact that the database connection management provided by EF intersects with the connection management capabilities of the data dependent routing interfaces provided by the elastic database client library.</source>
          <target state="new">Challenges arise primarily from the fact that the database connection management provided by EF intersects with the connection management capabilities of the data dependent routing interfaces provided by the elastic database client library.</target>
        </trans-unit>
        <trans-unit id="136" translate="yes" xml:space="preserve">
          <source>Elastic database tools assumptions</source>
          <target state="new">Elastic database tools assumptions</target>
        </trans-unit>
        <trans-unit id="137" translate="yes" xml:space="preserve">
          <source>For term definitions, see <bpt id="p1">[</bpt>Elastic Database tools glossary<ept id="p1">](sql-database-elastic-scale-glossary.md)</ept>.</source>
          <target state="new">For term definitions, see <bpt id="p1">[</bpt>Elastic Database tools glossary<ept id="p1">](sql-database-elastic-scale-glossary.md)</ept>.</target>
        </trans-unit>
        <trans-unit id="138" translate="yes" xml:space="preserve">
          <source>With elastic database client library, you define partitions of your application data called shardlets.</source>
          <target state="new">With elastic database client library, you define partitions of your application data called shardlets.</target>
        </trans-unit>
        <trans-unit id="139" translate="yes" xml:space="preserve">
          <source>Shardlets are identified by a sharding key and are mapped to specific databases.</source>
          <target state="new">Shardlets are identified by a sharding key and are mapped to specific databases.</target>
        </trans-unit>
        <trans-unit id="140" translate="yes" xml:space="preserve">
          <source>An application may have as many databases as needed and distribute the shardlets to provide enough capacity or performance given current business requirements.</source>
          <target state="new">An application may have as many databases as needed and distribute the shardlets to provide enough capacity or performance given current business requirements.</target>
        </trans-unit>
        <trans-unit id="141" translate="yes" xml:space="preserve">
          <source>The mapping of sharding key values to the databases is stored by a shard map provided by the elastic database client APIs.</source>
          <target state="new">The mapping of sharding key values to the databases is stored by a shard map provided by the elastic database client APIs.</target>
        </trans-unit>
        <trans-unit id="142" translate="yes" xml:space="preserve">
          <source>We call this capability <bpt id="p1">**</bpt>Shard Map Management<ept id="p1">**</ept>, or SMM for short.</source>
          <target state="new">We call this capability <bpt id="p1">**</bpt>Shard Map Management<ept id="p1">**</ept>, or SMM for short.</target>
        </trans-unit>
        <trans-unit id="143" translate="yes" xml:space="preserve">
          <source>The shard map also serves as the broker of database connections for requests that carry a sharding key.</source>
          <target state="new">The shard map also serves as the broker of database connections for requests that carry a sharding key.</target>
        </trans-unit>
        <trans-unit id="144" translate="yes" xml:space="preserve">
          <source>We refer to this capability as <bpt id="p1">**</bpt>data-dependent routing<ept id="p1">**</ept>.</source>
          <target state="new">We refer to this capability as <bpt id="p1">**</bpt>data-dependent routing<ept id="p1">**</ept>.</target>
        </trans-unit>
        <trans-unit id="145" translate="yes" xml:space="preserve">
          <source>The shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations (such as relocating data from one shard to another) are happening.</source>
          <target state="new">The shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations (such as relocating data from one shard to another) are happening.</target>
        </trans-unit>
        <trans-unit id="146" translate="yes" xml:space="preserve">
          <source>To do so, the shard maps managed by the client library broker the database connections for an application.</source>
          <target state="new">To do so, the shard maps managed by the client library broker the database connections for an application.</target>
        </trans-unit>
        <trans-unit id="147" translate="yes" xml:space="preserve">
          <source>This allows the shard map functionality to automatically kill a database connection when shard management operations could impact the shardlet that the connection has been created for.</source>
          <target state="new">This allows the shard map functionality to automatically kill a database connection when shard management operations could impact the shardlet that the connection has been created for.</target>
        </trans-unit>
        <trans-unit id="148" translate="yes" xml:space="preserve">
          <source>This approach needs to integrate with some of EF’s functionality, such as creating new connections from an existing one to check for database existence.</source>
          <target state="new">This approach needs to integrate with some of EF’s functionality, such as creating new connections from an existing one to check for database existence.</target>
        </trans-unit>
        <trans-unit id="149" translate="yes" xml:space="preserve">
          <source>In general, our observation has been that the standard DbContext constructors only work reliably for closed database connections that can safely be cloned for EF work.</source>
          <target state="new">In general, our observation has been that the standard DbContext constructors only work reliably for closed database connections that can safely be cloned for EF work.</target>
        </trans-unit>
        <trans-unit id="150" translate="yes" xml:space="preserve">
          <source>The design principle of elastic database instead is to only broker opened connections.</source>
          <target state="new">The design principle of elastic database instead is to only broker opened connections.</target>
        </trans-unit>
        <trans-unit id="151" translate="yes" xml:space="preserve">
          <source>One might think that closing a connection brokered by the client library before handing it over to the EF DbContext may solve this issue.</source>
          <target state="new">One might think that closing a connection brokered by the client library before handing it over to the EF DbContext may solve this issue.</target>
        </trans-unit>
        <trans-unit id="152" translate="yes" xml:space="preserve">
          <source>However, by closing the connection and relying on EF to re-open it, one foregoes the validation and consistency checks performed by the library.</source>
          <target state="new">However, by closing the connection and relying on EF to re-open it, one foregoes the validation and consistency checks performed by the library.</target>
        </trans-unit>
        <trans-unit id="153" translate="yes" xml:space="preserve">
          <source>The migrations functionality in EF, however, uses these connections to manage the underlying database schema in a way that is transparent to the application.</source>
          <target state="new">The migrations functionality in EF, however, uses these connections to manage the underlying database schema in a way that is transparent to the application.</target>
        </trans-unit>
        <trans-unit id="154" translate="yes" xml:space="preserve">
          <source>Ideally, we would like to retain and combine all these capabilities from both the elastic database client library and EF in the same application.</source>
          <target state="new">Ideally, we would like to retain and combine all these capabilities from both the elastic database client library and EF in the same application.</target>
        </trans-unit>
        <trans-unit id="155" translate="yes" xml:space="preserve">
          <source>The following section discusses these properties and requirements in more detail.</source>
          <target state="new">The following section discusses these properties and requirements in more detail.</target>
        </trans-unit>
        <trans-unit id="156" translate="yes" xml:space="preserve">
          <source>Requirements</source>
          <target state="new">Requirements</target>
        </trans-unit>
        <trans-unit id="157" translate="yes" xml:space="preserve">
          <source>When working with both the elastic database client library and Entity Framework APIs, we want to retain the following properties:</source>
          <target state="new">When working with both the elastic database client library and Entity Framework APIs, we want to retain the following properties:</target>
        </trans-unit>
        <trans-unit id="158" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>Scale-out<ept id="p1">**</ept>: To add or remove databases from the data tier of the sharded application as necessary for the capacity demands of the application.</source>
          <target state="new"><bpt id="p1">**</bpt>Scale-out<ept id="p1">**</ept>: To add or remove databases from the data tier of the sharded application as necessary for the capacity demands of the application.</target>
        </trans-unit>
        <trans-unit id="159" translate="yes" xml:space="preserve">
          <source>This means control over the the creation and deletion of databases and using the elastic database shard map manager APIs to manage databases, and mappings of shardlets.</source>
          <target state="new">This means control over the the creation and deletion of databases and using the elastic database shard map manager APIs to manage databases, and mappings of shardlets.</target>
        </trans-unit>
        <trans-unit id="160" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>Consistency<ept id="p1">**</ept>: The application employs sharding, and uses the data dependent routing capabilities of the client library.</source>
          <target state="new"><bpt id="p1">**</bpt>Consistency<ept id="p1">**</ept>: The application employs sharding, and uses the data dependent routing capabilities of the client library.</target>
        </trans-unit>
        <trans-unit id="161" translate="yes" xml:space="preserve">
          <source>To avoid corruption or wrong query results, connections are brokered through the shard map manager.</source>
          <target state="new">To avoid corruption or wrong query results, connections are brokered through the shard map manager.</target>
        </trans-unit>
        <trans-unit id="162" translate="yes" xml:space="preserve">
          <source>This also retains validation and consistency.</source>
          <target state="new">This also retains validation and consistency.</target>
        </trans-unit>
        <trans-unit id="163" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>Code First<ept id="p1">**</ept>: To retain the convenience of EF’s code first paradigm.</source>
          <target state="new"><bpt id="p1">**</bpt>Code First<ept id="p1">**</ept>: To retain the convenience of EF’s code first paradigm.</target>
        </trans-unit>
        <trans-unit id="164" translate="yes" xml:space="preserve">
          <source>In Code First, classes in the application are mapped transparently to the underlying database structures.</source>
          <target state="new">In Code First, classes in the application are mapped transparently to the underlying database structures.</target>
        </trans-unit>
        <trans-unit id="165" translate="yes" xml:space="preserve">
          <source>The application code interacts with DbSets that mask most aspects involved in the underlying database processing.</source>
          <target state="new">The application code interacts with DbSets that mask most aspects involved in the underlying database processing.</target>
        </trans-unit>
        <trans-unit id="166" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>Schema<ept id="p1">**</ept>: Entity Framework handles initial database schema creation and subsequent schema evolution through migrations.</source>
          <target state="new"><bpt id="p1">**</bpt>Schema<ept id="p1">**</ept>: Entity Framework handles initial database schema creation and subsequent schema evolution through migrations.</target>
        </trans-unit>
        <trans-unit id="167" translate="yes" xml:space="preserve">
          <source>By retaining these capabilities, adapting your app is easy as the data evolves.</source>
          <target state="new">By retaining these capabilities, adapting your app is easy as the data evolves.</target>
        </trans-unit>
        <trans-unit id="168" translate="yes" xml:space="preserve">
          <source>The following guidance instructs how to satisfy these requirements for Code First applications using elastic database tools.</source>
          <target state="new">The following guidance instructs how to satisfy these requirements for Code First applications using elastic database tools.</target>
        </trans-unit>
        <trans-unit id="169" translate="yes" xml:space="preserve">
          <source>Data dependent routing using EF DbContext</source>
          <target state="new">Data dependent routing using EF DbContext</target>
        </trans-unit>
        <trans-unit id="170" translate="yes" xml:space="preserve">
          <source>Database connections with Entity Framework are typically managed through subclasses of <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept>.</source>
          <target state="new">Database connections with Entity Framework are typically managed through subclasses of <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept>.</target>
        </trans-unit>
        <trans-unit id="171" translate="yes" xml:space="preserve">
          <source>Create these subclasses by deriving from <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept>.</source>
          <target state="new">Create these subclasses by deriving from <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept>.</target>
        </trans-unit>
        <trans-unit id="172" translate="yes" xml:space="preserve">
          <source>This is where you define your <bpt id="p1">**</bpt>DbSets<ept id="p1">**</ept> that implement the database-backed collections of CLR objects for your application.</source>
          <target state="new">This is where you define your <bpt id="p1">**</bpt>DbSets<ept id="p1">**</ept> that implement the database-backed collections of CLR objects for your application.</target>
        </trans-unit>
        <trans-unit id="173" translate="yes" xml:space="preserve">
          <source>In the context of data dependent routing, we can identify several helpful properties that do not necessarily hold for other EF code first application scenarios:</source>
          <target state="new">In the context of data dependent routing, we can identify several helpful properties that do not necessarily hold for other EF code first application scenarios:</target>
        </trans-unit>
        <trans-unit id="174" translate="yes" xml:space="preserve">
          <source>The database already exists and has been registered in the elastic database shard map.</source>
          <target state="new">The database already exists and has been registered in the elastic database shard map.</target>
        </trans-unit>
        <trans-unit id="175" translate="yes" xml:space="preserve">
          <source>The schema of the application has already been deployed to the database (explained below).</source>
          <target state="new">The schema of the application has already been deployed to the database (explained below).</target>
        </trans-unit>
        <trans-unit id="176" translate="yes" xml:space="preserve">
          <source>Data-dependent routing connections to the database are brokered by the shard map.</source>
          <target state="new">Data-dependent routing connections to the database are brokered by the shard map.</target>
        </trans-unit>
        <trans-unit id="177" translate="yes" xml:space="preserve">
          <source>To integrate <bpt id="p1">**</bpt>DbContexts<ept id="p1">**</ept> with data-dependent routing for scale-out:</source>
          <target state="new">To integrate <bpt id="p1">**</bpt>DbContexts<ept id="p1">**</ept> with data-dependent routing for scale-out:</target>
        </trans-unit>
        <trans-unit id="178" translate="yes" xml:space="preserve">
          <source>Create physical database connections through the elastic database client interfaces of the shard map manager,</source>
          <target state="new">Create physical database connections through the elastic database client interfaces of the shard map manager,</target>
        </trans-unit>
        <trans-unit id="179" translate="yes" xml:space="preserve">
          <source>Wrap the connection with the <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> subclass</source>
          <target state="new">Wrap the connection with the <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> subclass</target>
        </trans-unit>
        <trans-unit id="180" translate="yes" xml:space="preserve">
          <source>Pass the connection down into the <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> base classes to ensure all the processing on the EF side happens as well.</source>
          <target state="new">Pass the connection down into the <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> base classes to ensure all the processing on the EF side happens as well.</target>
        </trans-unit>
        <trans-unit id="181" translate="yes" xml:space="preserve">
          <source>The following code example illustrates this approach.</source>
          <target state="new">The following code example illustrates this approach.</target>
        </trans-unit>
        <trans-unit id="182" translate="yes" xml:space="preserve">
          <source>(This code is also in the accompanying Visual Studio project)</source>
          <target state="new">(This code is also in the accompanying Visual Studio project)</target>
        </trans-unit>
        <trans-unit id="183" translate="yes" xml:space="preserve">
          <source>Main points</source>
          <target state="new">Main points</target>
        </trans-unit>
        <trans-unit id="184" translate="yes" xml:space="preserve">
          <source>A new constructor replaces the default constructor in the DbContext subclass</source>
          <target state="new">A new constructor replaces the default constructor in the DbContext subclass</target>
        </trans-unit>
        <trans-unit id="185" translate="yes" xml:space="preserve">
          <source>The new constructor takes the arguments that are required for data dependent routing through elastic database client library:</source>
          <target state="new">The new constructor takes the arguments that are required for data dependent routing through elastic database client library:</target>
        </trans-unit>
        <trans-unit id="186" translate="yes" xml:space="preserve">
          <source>the shard map to access the data-dependent routing interfaces,</source>
          <target state="new">the shard map to access the data-dependent routing interfaces,</target>
        </trans-unit>
        <trans-unit id="187" translate="yes" xml:space="preserve">
          <source>the sharding key to identify the shardlet,</source>
          <target state="new">the sharding key to identify the shardlet,</target>
        </trans-unit>
        <trans-unit id="188" translate="yes" xml:space="preserve">
          <source>a connection string with the credentials for the data-dependent routing connection to the shard.</source>
          <target state="new">a connection string with the credentials for the data-dependent routing connection to the shard.</target>
        </trans-unit>
        <trans-unit id="189" translate="yes" xml:space="preserve">
          <source>The call to the base class constructor takes a detour into a static method that performs all the steps necessary for data-dependent routing.</source>
          <target state="new">The call to the base class constructor takes a detour into a static method that performs all the steps necessary for data-dependent routing.</target>
        </trans-unit>
        <trans-unit id="190" translate="yes" xml:space="preserve">
          <source>It uses the OpenConnectionForKey call of the elastic database client interfaces on the shard map to establish an open connection.</source>
          <target state="new">It uses the OpenConnectionForKey call of the elastic database client interfaces on the shard map to establish an open connection.</target>
        </trans-unit>
        <trans-unit id="191" translate="yes" xml:space="preserve">
          <source>The shard map creates the open connection to the shard that holds the shardlet for the given sharding key.</source>
          <target state="new">The shard map creates the open connection to the shard that holds the shardlet for the given sharding key.</target>
        </trans-unit>
        <trans-unit id="192" translate="yes" xml:space="preserve">
          <source>This open connection is passed back to the base class constructor of DbContext to indicate that this connection is to be used by EF instead of letting EF create a new connection automatically.</source>
          <target state="new">This open connection is passed back to the base class constructor of DbContext to indicate that this connection is to be used by EF instead of letting EF create a new connection automatically.</target>
        </trans-unit>
        <trans-unit id="193" translate="yes" xml:space="preserve">
          <source>This way the connection has been tagged by the elastic database client API so that it can guarantee consistency under shard map management operations.</source>
          <target state="new">This way the connection has been tagged by the elastic database client API so that it can guarantee consistency under shard map management operations.</target>
        </trans-unit>
        <trans-unit id="194" translate="yes" xml:space="preserve">
          <source>Use the new constructor for your DbContext subclass instead of the default constructor in your code.</source>
          <target state="new">Use the new constructor for your DbContext subclass instead of the default constructor in your code.</target>
        </trans-unit>
        <trans-unit id="195" translate="yes" xml:space="preserve">
          <source>Here is an example:</source>
          <target state="new">Here is an example:</target>
        </trans-unit>
        <trans-unit id="196" translate="yes" xml:space="preserve">
          <source>The new constructor opens the connection to the shard that holds the data for the shardlet identified by the value of <bpt id="p1">**</bpt>tenantid1<ept id="p1">**</ept>.</source>
          <target state="new">The new constructor opens the connection to the shard that holds the data for the shardlet identified by the value of <bpt id="p1">**</bpt>tenantid1<ept id="p1">**</ept>.</target>
        </trans-unit>
        <trans-unit id="197" translate="yes" xml:space="preserve">
          <source>The code in the <bpt id="p1">**</bpt>using<ept id="p1">**</ept> block stays unchanged to access the <bpt id="p2">**</bpt>DbSet<ept id="p2">**</ept> for blogs using EF on the shard for <bpt id="p3">**</bpt>tenantid1<ept id="p3">**</ept>.</source>
          <target state="new">The code in the <bpt id="p1">**</bpt>using<ept id="p1">**</ept> block stays unchanged to access the <bpt id="p2">**</bpt>DbSet<ept id="p2">**</ept> for blogs using EF on the shard for <bpt id="p3">**</bpt>tenantid1<ept id="p3">**</ept>.</target>
        </trans-unit>
        <trans-unit id="198" translate="yes" xml:space="preserve">
          <source>This changes semantics for the code in the using block such that all database operations are now scoped to the one shard where <bpt id="p1">**</bpt>tenantid1<ept id="p1">**</ept> is kept.</source>
          <target state="new">This changes semantics for the code in the using block such that all database operations are now scoped to the one shard where <bpt id="p1">**</bpt>tenantid1<ept id="p1">**</ept> is kept.</target>
        </trans-unit>
        <trans-unit id="199" translate="yes" xml:space="preserve">
          <source>For instance, a LINQ query over the blogs <bpt id="p1">**</bpt>DbSet<ept id="p1">**</ept> would only return blogs stored on the current shard, but not the ones stored on other shards.</source>
          <target state="new">For instance, a LINQ query over the blogs <bpt id="p1">**</bpt>DbSet<ept id="p1">**</ept> would only return blogs stored on the current shard, but not the ones stored on other shards.</target>
        </trans-unit>
        <trans-unit id="200" translate="yes" xml:space="preserve">
          <source>Transient faults handling</source>
          <target state="new">Transient faults handling</target>
        </trans-unit>
        <trans-unit id="201" translate="yes" xml:space="preserve">
          <source>The Microsoft Patterns &amp; Practices team published the <bpt id="p1">[</bpt>The Transient Fault Handling Application Block<ept id="p1">](https://msdn.microsoft.com/library/dn440719.aspx)</ept>.</source>
          <target state="new">The Microsoft Patterns &amp; Practices team published the <bpt id="p1">[</bpt>The Transient Fault Handling Application Block<ept id="p1">](https://msdn.microsoft.com/library/dn440719.aspx)</ept>.</target>
        </trans-unit>
        <trans-unit id="202" translate="yes" xml:space="preserve">
          <source>The library is used with elastic scale client library in combination with EF.</source>
          <target state="new">The library is used with elastic scale client library in combination with EF.</target>
        </trans-unit>
        <trans-unit id="203" translate="yes" xml:space="preserve">
          <source>However, ensure that any transient exception returns to a place where we can ensure that the new constructor is being used after a transient fault so that any new connection attempt is made using the constructors we have tweaked.</source>
          <target state="new">However, ensure that any transient exception returns to a place where we can ensure that the new constructor is being used after a transient fault so that any new connection attempt is made using the constructors we have tweaked.</target>
        </trans-unit>
        <trans-unit id="204" translate="yes" xml:space="preserve">
          <source>Otherwise, a connection to the correct shard is not guaranteed, and there are no assurances the connection is maintained as changes to the shard map occur.</source>
          <target state="new">Otherwise, a connection to the correct shard is not guaranteed, and there are no assurances the connection is maintained as changes to the shard map occur.</target>
        </trans-unit>
        <trans-unit id="205" translate="yes" xml:space="preserve">
          <source>The following code sample illustrates how a SQL retry policy can be used around the new <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> subclass constructors:</source>
          <target state="new">The following code sample illustrates how a SQL retry policy can be used around the new <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> subclass constructors:</target>
        </trans-unit>
        <trans-unit id="206" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>SqlDatabaseUtils.SqlRetryPolicy<ept id="p1">**</ept> in the code above is defined as a <bpt id="p2">**</bpt>SqlDatabaseTransientErrorDetectionStrategy<ept id="p2">**</ept> with a retry count of 10, and 5 seconds wait time between retries.</source>
          <target state="new"><bpt id="p1">**</bpt>SqlDatabaseUtils.SqlRetryPolicy<ept id="p1">**</ept> in the code above is defined as a <bpt id="p2">**</bpt>SqlDatabaseTransientErrorDetectionStrategy<ept id="p2">**</ept> with a retry count of 10, and 5 seconds wait time between retries.</target>
        </trans-unit>
        <trans-unit id="207" translate="yes" xml:space="preserve">
          <source>This approach is similar to the guidance for EF and user-initiated transactions (see <bpt id="p1">[</bpt>Limitations with Retrying Execution Strategies (EF6 onwards)<ept id="p1">](http://msdn.microsoft.com/data/dn307226)</ept>.</source>
          <target state="new">This approach is similar to the guidance for EF and user-initiated transactions (see <bpt id="p1">[</bpt>Limitations with Retrying Execution Strategies (EF6 onwards)<ept id="p1">](http://msdn.microsoft.com/data/dn307226)</ept>.</target>
        </trans-unit>
        <trans-unit id="208" translate="yes" xml:space="preserve">
          <source>Both situations require that the application program controls the scope to which the transient exception returns: to either reopen the transaction, or (as shown) recreate the context from the proper constructor that uses the elastic database client library.</source>
          <target state="new">Both situations require that the application program controls the scope to which the transient exception returns: to either reopen the transaction, or (as shown) recreate the context from the proper constructor that uses the elastic database client library.</target>
        </trans-unit>
        <trans-unit id="209" translate="yes" xml:space="preserve">
          <source>The need to control where transient exceptions take us back in scope also precludes the use of the built-in <bpt id="p1">**</bpt>SqlAzureExecutionStrategy<ept id="p1">**</ept> that comes with EF.</source>
          <target state="new">The need to control where transient exceptions take us back in scope also precludes the use of the built-in <bpt id="p1">**</bpt>SqlAzureExecutionStrategy<ept id="p1">**</ept> that comes with EF.</target>
        </trans-unit>
        <trans-unit id="210" translate="yes" xml:space="preserve">
          <source><bpt id="p1">**</bpt>SqlAzureExecutionStrategy<ept id="p1">**</ept> would reopen a connection but not use <bpt id="p2">**</bpt>OpenConnectionForKey<ept id="p2">**</ept> and therefore bypass all the validation that is performed as part of the <bpt id="p3">**</bpt>OpenConnectionForKey<ept id="p3">**</ept> call.</source>
          <target state="new"><bpt id="p1">**</bpt>SqlAzureExecutionStrategy<ept id="p1">**</ept> would reopen a connection but not use <bpt id="p2">**</bpt>OpenConnectionForKey<ept id="p2">**</ept> and therefore bypass all the validation that is performed as part of the <bpt id="p3">**</bpt>OpenConnectionForKey<ept id="p3">**</ept> call.</target>
        </trans-unit>
        <trans-unit id="211" translate="yes" xml:space="preserve">
          <source>Instead, the code sample uses the built-in <bpt id="p1">**</bpt>DefaultExecutionStrategy<ept id="p1">**</ept> that also comes with EF.</source>
          <target state="new">Instead, the code sample uses the built-in <bpt id="p1">**</bpt>DefaultExecutionStrategy<ept id="p1">**</ept> that also comes with EF.</target>
        </trans-unit>
        <trans-unit id="212" translate="yes" xml:space="preserve">
          <source>As opposed to <bpt id="p1">**</bpt>SqlAzureExecutionStrategy<ept id="p1">**</ept>, it works correctly in combination with the retry policy from Transient Fault Handling.</source>
          <target state="new">As opposed to <bpt id="p1">**</bpt>SqlAzureExecutionStrategy<ept id="p1">**</ept>, it works correctly in combination with the retry policy from Transient Fault Handling.</target>
        </trans-unit>
        <trans-unit id="213" translate="yes" xml:space="preserve">
          <source>The execution policy is set in the <bpt id="p1">**</bpt>ElasticScaleDbConfiguration<ept id="p1">**</ept> class.</source>
          <target state="new">The execution policy is set in the <bpt id="p1">**</bpt>ElasticScaleDbConfiguration<ept id="p1">**</ept> class.</target>
        </trans-unit>
        <trans-unit id="214" translate="yes" xml:space="preserve">
          <source>Note that we decided not to use <bpt id="p1">**</bpt>DefaultSqlExecutionStrategy<ept id="p1">**</ept> since it suggests to use <bpt id="p2">**</bpt>SqlAzureExecutionStrategy<ept id="p2">**</ept> if transient exceptions occur - which would lead to wrong behavior as discussed.</source>
          <target state="new">Note that we decided not to use <bpt id="p1">**</bpt>DefaultSqlExecutionStrategy<ept id="p1">**</ept> since it suggests to use <bpt id="p2">**</bpt>SqlAzureExecutionStrategy<ept id="p2">**</ept> if transient exceptions occur - which would lead to wrong behavior as discussed.</target>
        </trans-unit>
        <trans-unit id="215" translate="yes" xml:space="preserve">
          <source>For more information on the different retry policies and EF, see <bpt id="p1">[</bpt>Connection Resiliency in EF<ept id="p1">](http://msdn.microsoft.com/data/dn456835.aspx)</ept>.</source>
          <target state="new">For more information on the different retry policies and EF, see <bpt id="p1">[</bpt>Connection Resiliency in EF<ept id="p1">](http://msdn.microsoft.com/data/dn456835.aspx)</ept>.</target>
        </trans-unit>
        <trans-unit id="216" translate="yes" xml:space="preserve">
          <source>Constructor rewrites</source>
          <target state="new">Constructor rewrites</target>
        </trans-unit>
        <trans-unit id="217" translate="yes" xml:space="preserve">
          <source>The code examples above illustrate the default constructor re-writes required for your application in order to use  data dependent routing with the Entity Framework.</source>
          <target state="new">The code examples above illustrate the default constructor re-writes required for your application in order to use  data dependent routing with the Entity Framework.</target>
        </trans-unit>
        <trans-unit id="218" translate="yes" xml:space="preserve">
          <source>The following table generalizes this approach to other constructors.</source>
          <target state="new">The following table generalizes this approach to other constructors.</target>
        </trans-unit>
        <trans-unit id="219" translate="yes" xml:space="preserve">
          <source>Current Constructor</source>
          <target state="new">Current Constructor</target>
        </trans-unit>
        <trans-unit id="220" translate="yes" xml:space="preserve">
          <source>Rewritten Constructor for data</source>
          <target state="new">Rewritten Constructor for data</target>
        </trans-unit>
        <trans-unit id="221" translate="yes" xml:space="preserve">
          <source>Base Constructor</source>
          <target state="new">Base Constructor</target>
        </trans-unit>
        <trans-unit id="222" translate="yes" xml:space="preserve">
          <source>Notes</source>
          <target state="new">Notes</target>
        </trans-unit>
        <trans-unit id="223" translate="yes" xml:space="preserve">
          <source>MyContext()</source>
          <target state="new">MyContext()</target>
        </trans-unit>
        <trans-unit id="224" translate="yes" xml:space="preserve">
          <source>ElasticScaleContext(ShardMap, TKey)</source>
          <target state="new">ElasticScaleContext(ShardMap, TKey)</target>
        </trans-unit>
        <trans-unit id="225" translate="yes" xml:space="preserve">
          <source>DbContext(DbConnection, bool)</source>
          <target state="new">DbContext(DbConnection, bool)</target>
        </trans-unit>
        <trans-unit id="226" translate="yes" xml:space="preserve">
          <source>The connection needs to be a function of the shard map and the data-dependent routing key.</source>
          <target state="new">The connection needs to be a function of the shard map and the data-dependent routing key.</target>
        </trans-unit>
        <trans-unit id="227" translate="yes" xml:space="preserve">
          <source>You need to by-pass automatic connection creation by EF and instead use the shard map to broker the connection.</source>
          <target state="new">You need to by-pass automatic connection creation by EF and instead use the shard map to broker the connection.</target>
        </trans-unit>
        <trans-unit id="228" translate="yes" xml:space="preserve">
          <source>MyContext(string)</source>
          <target state="new">MyContext(string)</target>
        </trans-unit>
        <trans-unit id="229" translate="yes" xml:space="preserve">
          <source>ElasticScaleContext(ShardMap, TKey)</source>
          <target state="new">ElasticScaleContext(ShardMap, TKey)</target>
        </trans-unit>
        <trans-unit id="230" translate="yes" xml:space="preserve">
          <source>DbContext(DbConnection, bool)</source>
          <target state="new">DbContext(DbConnection, bool)</target>
        </trans-unit>
        <trans-unit id="231" translate="yes" xml:space="preserve">
          <source>The connection is a function of the shard map and the data-dependent routing key.</source>
          <target state="new">The connection is a function of the shard map and the data-dependent routing key.</target>
        </trans-unit>
        <trans-unit id="232" translate="yes" xml:space="preserve">
          <source>A fixed database name or connection string will not work as they by-pass validation by the shard map.</source>
          <target state="new">A fixed database name or connection string will not work as they by-pass validation by the shard map.</target>
        </trans-unit>
        <trans-unit id="233" translate="yes" xml:space="preserve">
          <source>MyContext(DbCompiledModel)</source>
          <target state="new">MyContext(DbCompiledModel)</target>
        </trans-unit>
        <trans-unit id="234" translate="yes" xml:space="preserve">
          <source>ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</source>
          <target state="new">ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</target>
        </trans-unit>
        <trans-unit id="235" translate="yes" xml:space="preserve">
          <source>DbContext(DbConnection, DbCompiledModel, bool)</source>
          <target state="new">DbContext(DbConnection, DbCompiledModel, bool)</target>
        </trans-unit>
        <trans-unit id="236" translate="yes" xml:space="preserve">
          <source>The connection will get created for the given shard map and sharding key with the model provided.</source>
          <target state="new">The connection will get created for the given shard map and sharding key with the model provided.</target>
        </trans-unit>
        <trans-unit id="237" translate="yes" xml:space="preserve">
          <source>The compiled model will be passed on to the base c’tor.</source>
          <target state="new">The compiled model will be passed on to the base c’tor.</target>
        </trans-unit>
        <trans-unit id="238" translate="yes" xml:space="preserve">
          <source>MyContext(DbConnection, bool)</source>
          <target state="new">MyContext(DbConnection, bool)</target>
        </trans-unit>
        <trans-unit id="239" translate="yes" xml:space="preserve">
          <source>ElasticScaleContext(ShardMap, TKey, bool)</source>
          <target state="new">ElasticScaleContext(ShardMap, TKey, bool)</target>
        </trans-unit>
        <trans-unit id="240" translate="yes" xml:space="preserve">
          <source>DbContext(DbConnection, bool)</source>
          <target state="new">DbContext(DbConnection, bool)</target>
        </trans-unit>
        <trans-unit id="241" translate="yes" xml:space="preserve">
          <source>The connection needs to be inferred from the shard map and the key.</source>
          <target state="new">The connection needs to be inferred from the shard map and the key.</target>
        </trans-unit>
        <trans-unit id="242" translate="yes" xml:space="preserve">
          <source>It cannot be provided as an input (unless that input was already using the shard map and the key).</source>
          <target state="new">It cannot be provided as an input (unless that input was already using the shard map and the key).</target>
        </trans-unit>
        <trans-unit id="243" translate="yes" xml:space="preserve">
          <source>The Boolean will be passed on.</source>
          <target state="new">The Boolean will be passed on.</target>
        </trans-unit>
        <trans-unit id="244" translate="yes" xml:space="preserve">
          <source>MyContext(string, DbCompiledModel)</source>
          <target state="new">MyContext(string, DbCompiledModel)</target>
        </trans-unit>
        <trans-unit id="245" translate="yes" xml:space="preserve">
          <source>ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</source>
          <target state="new">ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</target>
        </trans-unit>
        <trans-unit id="246" translate="yes" xml:space="preserve">
          <source>DbContext(DbConnection, DbCompiledModel, bool)</source>
          <target state="new">DbContext(DbConnection, DbCompiledModel, bool)</target>
        </trans-unit>
        <trans-unit id="247" translate="yes" xml:space="preserve">
          <source>The connection needs to be inferred from the shard map and the key.</source>
          <target state="new">The connection needs to be inferred from the shard map and the key.</target>
        </trans-unit>
        <trans-unit id="248" translate="yes" xml:space="preserve">
          <source>It cannot be provided as an input (unless that input was using the shard map and the key).</source>
          <target state="new">It cannot be provided as an input (unless that input was using the shard map and the key).</target>
        </trans-unit>
        <trans-unit id="249" translate="yes" xml:space="preserve">
          <source>The compiled model will be passed on.</source>
          <target state="new">The compiled model will be passed on.</target>
        </trans-unit>
        <trans-unit id="250" translate="yes" xml:space="preserve">
          <source>MyContext(ObjectContext, bool)</source>
          <target state="new">MyContext(ObjectContext, bool)</target>
        </trans-unit>
        <trans-unit id="251" translate="yes" xml:space="preserve">
          <source>ElasticScaleContext(ShardMap, TKey, ObjectContext, bool)</source>
          <target state="new">ElasticScaleContext(ShardMap, TKey, ObjectContext, bool)</target>
        </trans-unit>
        <trans-unit id="252" translate="yes" xml:space="preserve">
          <source>DbContext(ObjectContext, bool)</source>
          <target state="new">DbContext(ObjectContext, bool)</target>
        </trans-unit>
        <trans-unit id="253" translate="yes" xml:space="preserve">
          <source>The new constructor needs to ensure that any connection in the ObjectContext passed as an input is re-routed to a connection managed by Elastic Scale.</source>
          <target state="new">The new constructor needs to ensure that any connection in the ObjectContext passed as an input is re-routed to a connection managed by Elastic Scale.</target>
        </trans-unit>
        <trans-unit id="254" translate="yes" xml:space="preserve">
          <source>A detailed discussion of ObjectContexts is beyond the scope of this document.</source>
          <target state="new">A detailed discussion of ObjectContexts is beyond the scope of this document.</target>
        </trans-unit>
        <trans-unit id="255" translate="yes" xml:space="preserve">
          <source>MyContext(DbConnection, DbCompiledModel,bool)</source>
          <target state="new">MyContext(DbConnection, DbCompiledModel,bool)</target>
        </trans-unit>
        <trans-unit id="256" translate="yes" xml:space="preserve">
          <source>ElasticScaleContext(ShardMap, TKey, DbCompiledModel, bool)</source>
          <target state="new">ElasticScaleContext(ShardMap, TKey, DbCompiledModel, bool)</target>
        </trans-unit>
        <trans-unit id="257" translate="yes" xml:space="preserve">
          <source>DbContext(DbConnection, DbCompiledModel, bool);</source>
          <target state="new">DbContext(DbConnection, DbCompiledModel, bool);</target>
        </trans-unit>
        <trans-unit id="258" translate="yes" xml:space="preserve">
          <source>The connection needs to be inferred from the shard map and the key.</source>
          <target state="new">The connection needs to be inferred from the shard map and the key.</target>
        </trans-unit>
        <trans-unit id="259" translate="yes" xml:space="preserve">
          <source>The connection cannot be provided as an input (unless that input was already using the shard map and the key).</source>
          <target state="new">The connection cannot be provided as an input (unless that input was already using the shard map and the key).</target>
        </trans-unit>
        <trans-unit id="260" translate="yes" xml:space="preserve">
          <source>Model and Boolean are passed on to the base class constructor.</source>
          <target state="new">Model and Boolean are passed on to the base class constructor.</target>
        </trans-unit>
        <trans-unit id="261" translate="yes" xml:space="preserve">
          <source>Shard schema deployment through EF migrations</source>
          <target state="new">Shard schema deployment through EF migrations</target>
        </trans-unit>
        <trans-unit id="262" translate="yes" xml:space="preserve">
          <source>Automatic schema management is a convenience provided by the Entity Framework.</source>
          <target state="new">Automatic schema management is a convenience provided by the Entity Framework.</target>
        </trans-unit>
        <trans-unit id="263" translate="yes" xml:space="preserve">
          <source>In the context of applications using elastic database tools, we want to retain this capability to automatically provision the schema to newly created shards when databases are added to the sharded application.</source>
          <target state="new">In the context of applications using elastic database tools, we want to retain this capability to automatically provision the schema to newly created shards when databases are added to the sharded application.</target>
        </trans-unit>
        <trans-unit id="264" translate="yes" xml:space="preserve">
          <source>The primary use case is to increase capacity at the data tier for sharded applications using EF.</source>
          <target state="new">The primary use case is to increase capacity at the data tier for sharded applications using EF.</target>
        </trans-unit>
        <trans-unit id="265" translate="yes" xml:space="preserve">
          <source>Relying on EF’s capabilities for schema management reduces the database administration effort with a sharded application built on EF.</source>
          <target state="new">Relying on EF’s capabilities for schema management reduces the database administration effort with a sharded application built on EF.</target>
        </trans-unit>
        <trans-unit id="266" translate="yes" xml:space="preserve">
          <source>Schema deployment through EF migrations works best on <bpt id="p1">**</bpt>unopened connections<ept id="p1">**</ept>.</source>
          <target state="new">Schema deployment through EF migrations works best on <bpt id="p1">**</bpt>unopened connections<ept id="p1">**</ept>.</target>
        </trans-unit>
        <trans-unit id="267" translate="yes" xml:space="preserve">
          <source>This is in contrast to the scenario for data dependent routing that relies on the opened connection provided by the elastic database client API.</source>
          <target state="new">This is in contrast to the scenario for data dependent routing that relies on the opened connection provided by the elastic database client API.</target>
        </trans-unit>
        <trans-unit id="268" translate="yes" xml:space="preserve">
          <source>Another difference is the consistency requirement: While desirable to ensure consistency for all data-dependent routing connections to protect against concurrent shard map manipulation, it is not a concern with initial schema deployment to a new database that has not yet been registered in the shard map, and not yet been allocated to hold shardlets.</source>
          <target state="new">Another difference is the consistency requirement: While desirable to ensure consistency for all data-dependent routing connections to protect against concurrent shard map manipulation, it is not a concern with initial schema deployment to a new database that has not yet been registered in the shard map, and not yet been allocated to hold shardlets.</target>
        </trans-unit>
        <trans-unit id="269" translate="yes" xml:space="preserve">
          <source>We can therefore rely on regular database connections for this scenarios, as opposed to data-dependent routing.</source>
          <target state="new">We can therefore rely on regular database connections for this scenarios, as opposed to data-dependent routing.</target>
        </trans-unit>
        <trans-unit id="270" translate="yes" xml:space="preserve">
          <source>This leads to an approach where schema deployment through EF migrations is tightly coupled with the registration of the new database as a shard in the application’s shard map.</source>
          <target state="new">This leads to an approach where schema deployment through EF migrations is tightly coupled with the registration of the new database as a shard in the application’s shard map.</target>
        </trans-unit>
        <trans-unit id="271" translate="yes" xml:space="preserve">
          <source>This relies on the following prerequisites:</source>
          <target state="new">This relies on the following prerequisites:</target>
        </trans-unit>
        <trans-unit id="272" translate="yes" xml:space="preserve">
          <source>The database has already been created.</source>
          <target state="new">The database has already been created.</target>
        </trans-unit>
        <trans-unit id="273" translate="yes" xml:space="preserve">
          <source>The database is empty – it holds no user schema and no user data.</source>
          <target state="new">The database is empty – it holds no user schema and no user data.</target>
        </trans-unit>
        <trans-unit id="274" translate="yes" xml:space="preserve">
          <source>The database cannot yet be accessed through the elastic database client APIs for data-dependent routing.</source>
          <target state="new">The database cannot yet be accessed through the elastic database client APIs for data-dependent routing.</target>
        </trans-unit>
        <trans-unit id="275" translate="yes" xml:space="preserve">
          <source>With these prerequisites in place, we can create a regular un-opened <bpt id="p1">**</bpt>SqlConnection<ept id="p1">**</ept> to kick off EF migrations for schema deployment.</source>
          <target state="new">With these prerequisites in place, we can create a regular un-opened <bpt id="p1">**</bpt>SqlConnection<ept id="p1">**</ept> to kick off EF migrations for schema deployment.</target>
        </trans-unit>
        <trans-unit id="276" translate="yes" xml:space="preserve">
          <source>The following code sample illustrates this approach.</source>
          <target state="new">The following code sample illustrates this approach.</target>
        </trans-unit>
        <trans-unit id="277" translate="yes" xml:space="preserve">
          <source>This sample shows the method <bpt id="p1">**</bpt>RegisterNewShard<ept id="p1">**</ept> that registers the shard in the shard map, deploys the schema through EF migrations, and stores a mapping of a sharding key to the shard.</source>
          <target state="new">This sample shows the method <bpt id="p1">**</bpt>RegisterNewShard<ept id="p1">**</ept> that registers the shard in the shard map, deploys the schema through EF migrations, and stores a mapping of a sharding key to the shard.</target>
        </trans-unit>
        <trans-unit id="278" translate="yes" xml:space="preserve">
          <source>It relies on a constructor of the <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> subclass (<bpt id="p2">**</bpt>ElasticScaleContext<ept id="p2">**</ept> in the sample) that takes a SQL connection string as input.</source>
          <target state="new">It relies on a constructor of the <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> subclass (<bpt id="p2">**</bpt>ElasticScaleContext<ept id="p2">**</ept> in the sample) that takes a SQL connection string as input.</target>
        </trans-unit>
        <trans-unit id="279" translate="yes" xml:space="preserve">
          <source>The code of this constructor is straight-forward, as the following example shows:</source>
          <target state="new">The code of this constructor is straight-forward, as the following example shows:</target>
        </trans-unit>
        <trans-unit id="280" translate="yes" xml:space="preserve">
          <source>One might have used the version of the constructor inherited from the base class.</source>
          <target state="new">One might have used the version of the constructor inherited from the base class.</target>
        </trans-unit>
        <trans-unit id="281" translate="yes" xml:space="preserve">
          <source>But the code needs to ensure that the default initializer for EF is used when connecting.</source>
          <target state="new">But the code needs to ensure that the default initializer for EF is used when connecting.</target>
        </trans-unit>
        <trans-unit id="282" translate="yes" xml:space="preserve">
          <source>Hence the short detour into the static method before calling into the base class constructor with the connection string.</source>
          <target state="new">Hence the short detour into the static method before calling into the base class constructor with the connection string.</target>
        </trans-unit>
        <trans-unit id="283" translate="yes" xml:space="preserve">
          <source>Note that the registration of shards should run in a different app domain or process to ensure that the initializer settings for EF do not conflict.</source>
          <target state="new">Note that the registration of shards should run in a different app domain or process to ensure that the initializer settings for EF do not conflict.</target>
        </trans-unit>
        <trans-unit id="284" translate="yes" xml:space="preserve">
          <source>Limitations</source>
          <target state="new">Limitations</target>
        </trans-unit>
        <trans-unit id="285" translate="yes" xml:space="preserve">
          <source>The approaches outlined in this document entail a couple of limitations:</source>
          <target state="new">The approaches outlined in this document entail a couple of limitations:</target>
        </trans-unit>
        <trans-unit id="286" translate="yes" xml:space="preserve">
          <source>EF applications that use <bpt id="p1">**</bpt>LocalDb<ept id="p1">**</ept> first need to migrate to a regular SQL Server database before using elastic database client library.</source>
          <target state="new">EF applications that use <bpt id="p1">**</bpt>LocalDb<ept id="p1">**</ept> first need to migrate to a regular SQL Server database before using elastic database client library.</target>
        </trans-unit>
        <trans-unit id="287" translate="yes" xml:space="preserve">
          <source>Scaling out an application through sharding with Elastic Scale is not possible with <bpt id="p1">**</bpt>LocalDb<ept id="p1">**</ept>.</source>
          <target state="new">Scaling out an application through sharding with Elastic Scale is not possible with <bpt id="p1">**</bpt>LocalDb<ept id="p1">**</ept>.</target>
        </trans-unit>
        <trans-unit id="288" translate="yes" xml:space="preserve">
          <source>Note that development can still use <bpt id="p1">**</bpt>LocalDb<ept id="p1">**</ept>.</source>
          <target state="new">Note that development can still use <bpt id="p1">**</bpt>LocalDb<ept id="p1">**</ept>.</target>
        </trans-unit>
        <trans-unit id="289" translate="yes" xml:space="preserve">
          <source>Any changes to the application that imply database schema changes need to go through EF migrations on all shards.</source>
          <target state="new">Any changes to the application that imply database schema changes need to go through EF migrations on all shards.</target>
        </trans-unit>
        <trans-unit id="290" translate="yes" xml:space="preserve">
          <source>The sample code for this document does not demonstrate how to do this.</source>
          <target state="new">The sample code for this document does not demonstrate how to do this.</target>
        </trans-unit>
        <trans-unit id="291" translate="yes" xml:space="preserve">
          <source>Consider using Update-Database with a ConnectionString parameter to iterate over all shards; or extract the T-SQL script for the pending migration using Update-Database with the –Script option and apply the T-SQL script to your shards.</source>
          <target state="new">Consider using Update-Database with a ConnectionString parameter to iterate over all shards; or extract the T-SQL script for the pending migration using Update-Database with the –Script option and apply the T-SQL script to your shards.</target>
        </trans-unit>
        <trans-unit id="292" translate="yes" xml:space="preserve">
          <source>Given a request, it is assumed that all of its database processing is contained within a single shard as identified by the sharding key provided by the request.</source>
          <target state="new">Given a request, it is assumed that all of its database processing is contained within a single shard as identified by the sharding key provided by the request.</target>
        </trans-unit>
        <trans-unit id="293" translate="yes" xml:space="preserve">
          <source>However, this assumption does not always hold true.</source>
          <target state="new">However, this assumption does not always hold true.</target>
        </trans-unit>
        <trans-unit id="294" translate="yes" xml:space="preserve">
          <source>For example, when it is not possible to make a sharding key available.</source>
          <target state="new">For example, when it is not possible to make a sharding key available.</target>
        </trans-unit>
        <trans-unit id="295" translate="yes" xml:space="preserve">
          <source>To address this, the client library provides the <bpt id="p1">**</bpt>MultiShardQuery<ept id="p1">**</ept> class that implements a connection abstraction for querying over several shards.</source>
          <target state="new">To address this, the client library provides the <bpt id="p1">**</bpt>MultiShardQuery<ept id="p1">**</ept> class that implements a connection abstraction for querying over several shards.</target>
        </trans-unit>
        <trans-unit id="296" translate="yes" xml:space="preserve">
          <source>Learning to use the <bpt id="p1">**</bpt>MultiShardQuery<ept id="p1">**</ept> in combination with EF is beyond the scope of this document</source>
          <target state="new">Learning to use the <bpt id="p1">**</bpt>MultiShardQuery<ept id="p1">**</ept> in combination with EF is beyond the scope of this document</target>
        </trans-unit>
        <trans-unit id="297" translate="yes" xml:space="preserve">
          <source>Conclusions</source>
          <target state="new">Conclusions</target>
        </trans-unit>
        <trans-unit id="298" translate="yes" xml:space="preserve">
          <source>Entity Framework applications can easily benefit from the elastic database tools in Azure SQL Database.</source>
          <target state="new">Entity Framework applications can easily benefit from the elastic database tools in Azure SQL Database.</target>
        </trans-unit>
        <trans-unit id="299" translate="yes" xml:space="preserve">
          <source>Through the steps outlined in this document, EF applications can use the elastic database client library's capability for data dependent routing by refactoring constructors of the <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> subclasses used in the EF application.</source>
          <target state="new">Through the steps outlined in this document, EF applications can use the elastic database client library's capability for data dependent routing by refactoring constructors of the <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> subclasses used in the EF application.</target>
        </trans-unit>
        <trans-unit id="300" translate="yes" xml:space="preserve">
          <source>This limits the  changes required to those places where <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> classes already exist.</source>
          <target state="new">This limits the  changes required to those places where <bpt id="p1">**</bpt>DbContext<ept id="p1">**</ept> classes already exist.</target>
        </trans-unit>
        <trans-unit id="301" translate="yes" xml:space="preserve">
          <source>In addition, EF applications can continue to benefit from automatic schema deployment by combining the steps that invoke the necessary EF migrations with the registration of new shards and mappings in the shard map.</source>
          <target state="new">In addition, EF applications can continue to benefit from automatic schema deployment by combining the steps that invoke the necessary EF migrations with the registration of new shards and mappings in the shard map.</target>
        </trans-unit>
      </group>
    </body>
  </file>
  <header xmlns="">
    <xliffext:oltranslationpriority xmlns:xliffext="urn:microsoft:content:schema:xliffextensions">
    </xliffext:oltranslationpriority>
    <xliffext:olfilehash xmlns:xliffext="urn:microsoft:content:schema:xliffextensions">8842273821e9a0296e7610ee7e9b91e371be5bc3</xliffext:olfilehash>
  </header>
</xliff>