{
  "nodes": [
    {
      "content": "How to create a LAMP Stack with Microsoft Azure",
      "pos": [
        27,
        74
      ]
    },
    {
      "content": "Learn how to create a LAMP Stack with Microsoft Azure using Azure virtual machines (VMs) running Linux.",
      "pos": [
        93,
        196
      ]
    },
    {
      "content": "How to create a LAMP Stack with Microsoft Azure",
      "pos": [
        529,
        576
      ]
    },
    {
      "content": "A \"LAMP\" stack is a group of open source software that is typically installed together to enable a server to host dynamic websites and web applications.",
      "pos": [
        578,
        730
      ]
    },
    {
      "content": "This term is actually an acronym that represents the Linux operating system with the Apache web server.",
      "pos": [
        731,
        834
      ]
    },
    {
      "content": "The site data is stored in a MySQL database, and dynamic content is processed by PHP.",
      "pos": [
        835,
        920
      ]
    },
    {
      "content": "In this guide, we'll get a LAMP stack installed on a Linux image and deploy it on Microsoft Azure.",
      "pos": [
        924,
        1022
      ]
    },
    {
      "content": "You will learn:",
      "pos": [
        1026,
        1041
      ]
    },
    {
      "content": "How to create an Azure virtual machine.",
      "pos": [
        1049,
        1088
      ]
    },
    {
      "content": "How to prepare the virtual machine for the LAMP stack.",
      "pos": [
        1093,
        1147
      ]
    },
    {
      "content": "How to install software that is needed by your LAMP server on the virtual machine.",
      "pos": [
        1152,
        1234
      ]
    },
    {
      "content": "It is assumed that the reader already has an Azure subscription.",
      "pos": [
        1236,
        1300
      ]
    },
    {
      "content": "If not you can sign up for a free trial at <bpt id=\"p1\">[</bpt>http://azure.microsoft.com<ept id=\"p1\">](http://azure.microsoft.com)</ept>.",
      "pos": [
        1302,
        1402
      ]
    },
    {
      "content": "If you have an MSDN subscription, see <bpt id=\"p1\">[</bpt>Microsoft Azure Special Pricing: MSDN, MPN, and Bizspark Benefits<ept id=\"p1\">](http://azure.microsoft.com/pricing/member-offers/msdn-benefits/?c=14-39)</ept>.",
      "pos": [
        1403,
        1582
      ]
    },
    {
      "content": "To learn more about Azure, see <bpt id=\"p1\">[</bpt>What is Azure?<ept id=\"p1\">](http://azure.microsoft.com/overview/what-is-azure/)</ept>",
      "pos": [
        1583,
        1682
      ]
    },
    {
      "pos": [
        1684,
        1963
      ],
      "content": "In addition to this topic, if you already have a virtual machine and are just looking for the basics of installing a  LAMP stack on different Linux distributions, refer to <bpt id=\"p1\">[</bpt>Install the LAMP Stack on a Linux virtual machine in Azure<ept id=\"p1\">](virtual-machines-linux-install-lamp-stack.md)</ept>."
    },
    {
      "content": "You can also deploy pre-configured LAMP images from the Azure Marketplace.",
      "pos": [
        1965,
        2039
      ]
    },
    {
      "content": "The following 10 minute video introduces deploying pre-built LAMP images from the Azure Marketplace: (LAMP stack on Azure VMs](https://channel9.msdn.com/Shows/Azure-Friday/LAMP-stack-on-Azure-VMs-with-Guy-Bowerman).",
      "pos": [
        2040,
        2255
      ]
    },
    {
      "content": "Phase 1: Create an image",
      "pos": [
        2259,
        2283
      ]
    },
    {
      "content": "In this phase, you will create a virtual machine using a Linux image in Azure.",
      "pos": [
        2284,
        2362
      ]
    },
    {
      "content": "Step 1: Generate an SSH Authentication Key",
      "pos": [
        2369,
        2411
      ]
    },
    {
      "content": "SSH is an important tool for system administrators.",
      "pos": [
        2412,
        2463
      ]
    },
    {
      "content": "However, relying on a human-determined password for security is not always wise.",
      "pos": [
        2464,
        2544
      ]
    },
    {
      "content": "A strong SSH key allows you to leave remote access open without worrying about passwords.",
      "pos": [
        2545,
        2634
      ]
    },
    {
      "content": "The method consists of authentication with asymmetric cryptography.",
      "pos": [
        2635,
        2702
      ]
    },
    {
      "content": "The user’s private key is the one that grants the authentication.",
      "pos": [
        2703,
        2768
      ]
    },
    {
      "content": "You can even lock the user’s account to disallow password authentication completely.",
      "pos": [
        2769,
        2853
      ]
    },
    {
      "content": "Follow these steps to generate the SSH Authentication Key.",
      "pos": [
        2855,
        2913
      ]
    },
    {
      "pos": [
        2919,
        3089
      ],
      "content": "Download and install puttygen from the following location: <bpt id=\"p1\">[</bpt>http://www.chiark.greenend.org.uk/~sgtatham/<ept id=\"p1\">](http://www.chiark.greenend.org.uk/~sgtatham/)</ept>putty/download.html"
    },
    {
      "content": "Run puttygen.exe.",
      "pos": [
        3094,
        3111
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Generate<ept id=\"p1\">**</ept> to generate the keys.",
      "pos": [
        3116,
        3156
      ]
    },
    {
      "content": "In the process you can increase randomness by moving the mouse over the blank area in the window.",
      "pos": [
        3157,
        3254
      ]
    },
    {
      "content": "After the generate process, Puttygen.exe will show your generated key.",
      "pos": [
        3268,
        3338
      ]
    },
    {
      "content": "For example:",
      "pos": [
        3339,
        3351
      ]
    },
    {
      "content": "Select and copy the public key in <bpt id=\"p1\">**</bpt>Key<ept id=\"p1\">**</ept> and save it in a file named <bpt id=\"p2\">**</bpt>publicKey.pem<ept id=\"p2\">**</ept>.",
      "pos": [
        3365,
        3453
      ]
    },
    {
      "content": "Don’t click <bpt id=\"p1\">**</bpt>Save public key<ept id=\"p1\">**</ept>, because the saved public key’s file format is different from the public key we want.",
      "pos": [
        3454,
        3571
      ]
    },
    {
      "pos": [
        3576,
        3650
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Save private key<ept id=\"p1\">**</ept> and save it in a file named <bpt id=\"p2\">**</bpt>privateKey.ppk<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Step 2: Create the image in the Azure Portal.",
      "pos": [
        3655,
        3700
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">[</bpt>Azure Portal<ept id=\"p1\">](https://portal.azure.com/)</ept>, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept> in the task bar and create an image by following these instructions, choosing the Linux image based on your needs.",
      "pos": [
        3701,
        3879
      ]
    },
    {
      "content": "This example uses the Ubuntu 14.04 image.",
      "pos": [
        3880,
        3921
      ]
    },
    {
      "content": "For <bpt id=\"p1\">**</bpt>Host Name<ept id=\"p1\">**</ept>, specify the name for the URL that you an Internet clients will use to access this virtual machine.",
      "pos": [
        3931,
        4048
      ]
    },
    {
      "content": "Define the last part of the DNS name, for example LAMPDemo, and Azure will generate the URL as Lampdemo.cloudapp.net.",
      "pos": [
        4049,
        4166
      ]
    },
    {
      "pos": [
        4168,
        4255
      ],
      "content": "For <bpt id=\"p1\">**</bpt>User Name<ept id=\"p1\">**</ept>, pick a name that you will later use to login to the virtual machine."
    },
    {
      "pos": [
        4257,
        4393
      ],
      "content": "For <bpt id=\"p1\">**</bpt>SSH Authentication Key<ept id=\"p1\">**</ept>, copy the key value from the <bpt id=\"p2\">**</bpt>publicKey.pem<ept id=\"p2\">**</ept> file, which contains the public key generated by puttygen."
    },
    {
      "pos": [
        4405,
        4467
      ],
      "content": "Configure other settings as needed, and then click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Phase 2: Prepare your virtual machine for the LAMP stack",
      "pos": [
        4471,
        4527
      ]
    },
    {
      "content": "In this phase, you will configure an endpoint for web traffic and then connect to your new virtual machine.",
      "pos": [
        4528,
        4635
      ]
    },
    {
      "content": "Step 1: Open the HTTP port to allow web access",
      "pos": [
        4640,
        4686
      ]
    },
    {
      "content": "Endpoints in Azure consists of a protocol (TCP or UDP), along with a public and private port.",
      "pos": [
        4687,
        4780
      ]
    },
    {
      "content": "The private port is the port that the service is listening on the virtual machine.",
      "pos": [
        4781,
        4863
      ]
    },
    {
      "content": "The public port is the port that the Azure cloud service is listening externally for Internet-based traffic.",
      "pos": [
        4864,
        4972
      ]
    },
    {
      "content": "In some cases, this is the same port number.",
      "pos": [
        4973,
        5017
      ]
    },
    {
      "content": "TCP port 80 is the default port number on which Apache listens.",
      "pos": [
        5021,
        5084
      ]
    },
    {
      "content": "Opening this port with an Azure endpoint will allow you and other Internet clients access to the Apache web server.",
      "pos": [
        5085,
        5200
      ]
    },
    {
      "pos": [
        5204,
        5314
      ],
      "content": "In the Azure Portal, click <bpt id=\"p1\">**</bpt>Browse -&gt; Virtual Machine<ept id=\"p1\">**</ept>, and then click the virtual machine that you created."
    },
    {
      "pos": [
        5324,
        5393
      ],
      "content": "To add an endpoint to a virtual machine, click the <bpt id=\"p1\">**</bpt>Endpoints<ept id=\"p1\">**</ept> box."
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>.",
      "pos": [
        5403,
        5417
      ]
    },
    {
      "content": "When provisioning a new virtual machine you can enable or disable endpoints as needed.",
      "pos": [
        5418,
        5504
      ]
    },
    {
      "content": "Configure the endpoint:",
      "pos": [
        5506,
        5529
      ]
    },
    {
      "pos": [
        5537,
        5582
      ],
      "content": "Type a name for the endpoint in <bpt id=\"p1\">**</bpt>Endpoint<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Type 80 in <bpt id=\"p1\">**</bpt>Public Port<ept id=\"p1\">**</ept>.",
      "pos": [
        5587,
        5614
      ]
    },
    {
      "content": "If you changed the default listen port of Apache, you should update Private Port to be the same as the Apache listen port.",
      "pos": [
        5615,
        5737
      ]
    },
    {
      "content": "Type 80 in <bpt id=\"p1\">**</bpt>Public Port<ept id=\"p1\">**</ept>.",
      "pos": [
        5742,
        5769
      ]
    },
    {
      "content": "By default, HTTP traffic uses port 80.",
      "pos": [
        5770,
        5808
      ]
    },
    {
      "content": "If you set it to 80, don’t need to include the port number in the URL that allows you to access the Apache web service.",
      "pos": [
        5809,
        5928
      ]
    },
    {
      "content": "For example, http://lampdemo.cloudapp.net.",
      "pos": [
        5929,
        5971
      ]
    },
    {
      "content": "If you set the Apache listening port to another value, such as 81, you need to add the port number to the URL to access the Apache web service.",
      "pos": [
        5972,
        6115
      ]
    },
    {
      "content": "For example,  http://lampdemo.cloudapp.net:81/.",
      "pos": [
        6116,
        6163
      ]
    },
    {
      "pos": [
        6173,
        6230
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to add the endpoint to your virtual machine."
    },
    {
      "content": "Step 2: Connect to the image you created",
      "pos": [
        6238,
        6278
      ]
    },
    {
      "content": "You can choose any SSH tool to connect to your new virtual machine.",
      "pos": [
        6279,
        6346
      ]
    },
    {
      "content": "In this example, we use Putty.",
      "pos": [
        6347,
        6377
      ]
    },
    {
      "content": "First, get the DNS name of your virtual machine from the Azure Portal.",
      "pos": [
        6381,
        6451
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Browse -&gt; Virtual machines -&gt;<ept id=\"p1\">**</ept> the name of your virtual machine <bpt id=\"p2\">**</bpt>-&gt; Properties<ept id=\"p2\">**</ept>, and then look in the <bpt id=\"p3\">**</bpt>Domain Name<ept id=\"p3\">**</ept> field of the <bpt id=\"p4\">**</bpt>Properties<ept id=\"p4\">**</ept> tile.",
      "pos": [
        6452,
        6614
      ]
    },
    {
      "content": "Get the port number for SSH connections from the <bpt id=\"p1\">**</bpt>SSH<ept id=\"p1\">**</ept> field.",
      "pos": [
        6616,
        6679
      ]
    },
    {
      "content": "Here is an example.",
      "pos": [
        6682,
        6701
      ]
    },
    {
      "pos": [
        6713,
        6764
      ],
      "content": "Download Putty from <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](http://www.putty.org/)</ept> ."
    },
    {
      "content": "After downloading, click the executable file PUTTY.EXE.",
      "pos": [
        6768,
        6823
      ]
    },
    {
      "content": "Configure the basic options with the host name and port number obtained from the properties of your virtual machine.",
      "pos": [
        6824,
        6940
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        6941,
        6960
      ]
    },
    {
      "content": "In the left pane, click  <bpt id=\"p1\">**</bpt>Connection -&gt; SSH -&gt; Auth<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Browse<ept id=\"p2\">**</ept> to specify the location of the <bpt id=\"p3\">**</bpt>privateKey.ppk<ept id=\"p3\">**</ept> file, which contains the private key generated by puttygen in Phase 1: Create an Image.",
      "pos": [
        6970,
        7188
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        7189,
        7208
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>.",
      "pos": [
        7221,
        7236
      ]
    },
    {
      "content": "You might be alerted by a message box.",
      "pos": [
        7237,
        7275
      ]
    },
    {
      "content": "If you have configured the DNS name and port number correctly, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>.",
      "pos": [
        7276,
        7353
      ]
    },
    {
      "content": "You should see the following.",
      "pos": [
        7365,
        7394
      ]
    },
    {
      "content": "Enter the user name specified when you created the virtual machine in Phase 1: Create an Image.",
      "pos": [
        7405,
        7500
      ]
    },
    {
      "content": "You will see something like the following:",
      "pos": [
        7501,
        7543
      ]
    },
    {
      "content": "Phase 3: Install the LAMP Stack",
      "pos": [
        7558,
        7589
      ]
    },
    {
      "content": "Depending what Linux distribution you used to create your virtual machine, there are different ways to install the LAMP Stack.",
      "pos": [
        7591,
        7717
      ]
    },
    {
      "content": "The following sections contain typical steps on some common Linux OSes.",
      "pos": [
        7718,
        7789
      ]
    },
    {
      "content": "Red Hat, CentOS base",
      "pos": [
        7794,
        7814
      ]
    },
    {
      "content": "Install Apache",
      "pos": [
        7820,
        7834
      ]
    },
    {
      "content": "To install Apache, open terminal and execute this command:",
      "pos": [
        7835,
        7893
      ]
    },
    {
      "content": "Once it installs, start Apache with this command:",
      "pos": [
        7925,
        7974
      ]
    },
    {
      "content": "Test Apache",
      "pos": [
        8011,
        8022
      ]
    },
    {
      "content": "To check if Apache is successfully installed, browse to your Apache server’s DNS name (for the example URL in this article, http://lampdemo.cloudapp.net/).",
      "pos": [
        8023,
        8178
      ]
    },
    {
      "content": "The page should display the words “It works!\"",
      "pos": [
        8179,
        8224
      ]
    },
    {
      "content": "Troubleshooting",
      "pos": [
        8238,
        8253
      ]
    },
    {
      "content": "If Apache is running but you can’t see Apache default page above, you need to check following:",
      "pos": [
        8254,
        8348
      ]
    },
    {
      "content": "Apache web service listening address / port",
      "pos": [
        8356,
        8399
      ]
    },
    {
      "content": "Check your endpoint setting for your Azure virtual machine.",
      "pos": [
        8408,
        8467
      ]
    },
    {
      "content": "Make sure the configuration of the endpoint is appropriate.",
      "pos": [
        8468,
        8527
      ]
    },
    {
      "content": "See the Phase 1: Create an Image instructions in this article.",
      "pos": [
        8528,
        8590
      ]
    },
    {
      "content": "Open /etc/httpd/conf/httpd.conf and then search for the string “Listen”.",
      "pos": [
        8599,
        8671
      ]
    },
    {
      "content": "Ensure that the Apache listening port is same as the Private Port that you configured for your endpoint.",
      "pos": [
        8672,
        8776
      ]
    },
    {
      "content": "The default port for Apache is 80.",
      "pos": [
        8777,
        8811
      ]
    },
    {
      "content": "Here is an example.",
      "pos": [
        8812,
        8831
      ]
    },
    {
      "content": "Firewall, iptables configuration",
      "pos": [
        9146,
        9178
      ]
    },
    {
      "content": "If you can see Apache default page from the local host, then the problem may be that the port upon which Apache is listening is blocked by the firewall.",
      "pos": [
        9181,
        9333
      ]
    },
    {
      "content": "You can use the w3m tool to browse the Apache web page.",
      "pos": [
        9334,
        9389
      ]
    },
    {
      "content": "The following commands install w3m and browse to the Apache default page:",
      "pos": [
        9390,
        9463
      ]
    },
    {
      "content": "If the issue is caused by the firewall or iptables, add the following lines to /etc/sysconfig/iptables:",
      "pos": [
        9541,
        9644
      ]
    },
    {
      "content": "Note that the second line is only needed for https traffic.",
      "pos": [
        9758,
        9817
      ]
    },
    {
      "content": "Make sure that these lines are above any lines that would globally restrict access, such as the following:",
      "pos": [
        9825,
        9931
      ]
    },
    {
      "content": "To make the new settings take effect, use the following command:",
      "pos": [
        10004,
        10068
      ]
    },
    {
      "content": "Install MySQL",
      "pos": [
        10110,
        10123
      ]
    },
    {
      "content": "To install MySQL, open terminal and run these commands:",
      "pos": [
        10124,
        10179
      ]
    },
    {
      "content": "During the installation, MySQL will ask you for your permission twice.",
      "pos": [
        10248,
        10318
      ]
    },
    {
      "content": "After you say yes to both queries, MySQL will install.",
      "pos": [
        10319,
        10373
      ]
    },
    {
      "content": "Configure MySQL",
      "pos": [
        10379,
        10394
      ]
    },
    {
      "content": "After it is done installing, you can set a root MySQL password with the following:",
      "pos": [
        10395,
        10477
      ]
    },
    {
      "content": "The prompt will ask you for your current root password.",
      "pos": [
        10528,
        10583
      ]
    },
    {
      "content": "Since you just installed MySQL, you most likely won’t have one, so leave it blank by pressing ENTER.",
      "pos": [
        10585,
        10685
      ]
    },
    {
      "content": "You will be prompted to set a root password.",
      "pos": [
        10795,
        10839
      ]
    },
    {
      "content": "Go ahead and choose Y and follow the instructions.",
      "pos": [
        10840,
        10890
      ]
    },
    {
      "content": "CentOS automates the process of setting up MySQL, asking you a series of yes or no questions.",
      "pos": [
        10894,
        10987
      ]
    },
    {
      "content": "Those questions are shown below.",
      "pos": [
        10988,
        11020
      ]
    },
    {
      "content": "Choose Y or N for your configuration.",
      "pos": [
        11021,
        11058
      ]
    },
    {
      "content": "At the end, MySQL will reload and implement the new changes.",
      "pos": [
        11059,
        11119
      ]
    },
    {
      "content": "Install PHP",
      "pos": [
        12415,
        12426
      ]
    },
    {
      "content": "PHP is an open source web scripting language that is widely used to build dynamic web pages.",
      "pos": [
        12427,
        12519
      ]
    },
    {
      "content": "To install PHP on your virtual machine, open terminal and run this command:",
      "pos": [
        12523,
        12598
      ]
    },
    {
      "content": "Answer “y” to download software packages.",
      "pos": [
        12640,
        12681
      ]
    },
    {
      "content": "Then answer “y” to Importing GPG key 0xE8562897 \"CentOS-5 Key (CentOS 5 Official Signing Key).",
      "pos": [
        12682,
        12776
      ]
    },
    {
      "content": "PHP will install.",
      "pos": [
        12777,
        12794
      ]
    },
    {
      "content": "Debian, Ubuntu base",
      "pos": [
        13259,
        13278
      ]
    },
    {
      "content": "This has been tested on Ubuntu 14.04.",
      "pos": [
        13279,
        13316
      ]
    },
    {
      "content": "Ubuntu is based on Debian.",
      "pos": [
        13320,
        13346
      ]
    },
    {
      "content": "You can install the LAMP stack in the same way as the Red Hat series.",
      "pos": [
        13347,
        13416
      ]
    },
    {
      "content": "To simplify the steps, use the Tasksel tool.",
      "pos": [
        13417,
        13461
      ]
    },
    {
      "content": "Tasksel is a Debian/Ubuntu tool that installs multiple related packages as a coordinated task onto your system.",
      "pos": [
        13463,
        13574
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Tasksel - Community Help Wiki<ept id=\"p1\">](https://help.ubuntu.com/community/Tasksel)</ept>.",
      "pos": [
        13575,
        13676
      ]
    },
    {
      "content": "Use tasksel to install the required software for the LAMP stack.",
      "pos": [
        13678,
        13742
      ]
    },
    {
      "content": "To download the package lists from the repositories and update them to get information on the newest versions of packages and their dependencies:",
      "pos": [
        13746,
        13891
      ]
    },
    {
      "content": "To Install the Ubuntu LAMP stack using Tasksel:",
      "pos": [
        13927,
        13974
      ]
    },
    {
      "pos": [
        14057,
        14125
      ],
      "content": "Next, go through the wizard and choose your <bpt id=\"p1\">**</bpt>MySQL root password<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Testing LAMP on your Server",
      "pos": [
        14139,
        14166
      ]
    },
    {
      "content": "You can test the LAMP system by creating a quick php info page.",
      "pos": [
        14167,
        14230
      ]
    },
    {
      "content": "First, create a new file:",
      "pos": [
        14232,
        14257
      ]
    },
    {
      "content": "Add the following line:",
      "pos": [
        14301,
        14324
      ]
    },
    {
      "content": "Then, Save and Exit.",
      "pos": [
        14363,
        14383
      ]
    },
    {
      "content": "Restart Apache so that all of the changes take effect on your machine.",
      "pos": [
        14387,
        14457
      ]
    },
    {
      "content": "If the OS of your virtual machine is CentOS, use the following command to restart Apache:",
      "pos": [
        14458,
        14547
      ]
    },
    {
      "content": "If the OS of your virtual machine is Ubuntu, use the following command to restart Apache:",
      "pos": [
        14583,
        14672
      ]
    },
    {
      "content": "Finish up by browsing to your php info page (for the example web server in this topic, the URL would be http://lampdemo.cloudapp.net/info.php).",
      "pos": [
        14712,
        14855
      ]
    },
    {
      "content": "Your browser should look similar to this:",
      "pos": [
        14859,
        14900
      ]
    },
    {
      "content": "Additional steps",
      "pos": [
        14913,
        14929
      ]
    },
    {
      "content": "As general practice, you will change some default settings to prepare for web application deployment.",
      "pos": [
        14931,
        15032
      ]
    },
    {
      "content": "Allow remote access to MySQL",
      "pos": [
        15039,
        15067
      ]
    },
    {
      "content": "If you have more than one VM installed with MySQL and they need to exchange data, you should enable MySQL remote access and grant the proper permissions.",
      "pos": [
        15068,
        15221
      ]
    },
    {
      "content": "Command reference format:",
      "pos": [
        15227,
        15252
      ]
    },
    {
      "content": "Example:",
      "pos": [
        15365,
        15373
      ]
    },
    {
      "content": "You should also change the /etc/mysql/my.cnf profile.",
      "pos": [
        15477,
        15530
      ]
    },
    {
      "content": "If you have lines like this:",
      "pos": [
        15531,
        15559
      ]
    },
    {
      "content": "You should comment them out (add a # at the beginning of the lines), and then restart MySQL.",
      "pos": [
        15615,
        15707
      ]
    },
    {
      "content": "To add an endpoint to allow remote access, refer to instructions in Phase 1: Create an Image to create a new endpoint.",
      "pos": [
        15711,
        15829
      ]
    },
    {
      "content": "The default remote access TCP port number of MySQL is 3306.",
      "pos": [
        15830,
        15889
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        15890,
        15909
      ]
    },
    {
      "content": "Deploy your web applications to the apache server",
      "pos": [
        15923,
        15972
      ]
    },
    {
      "content": "Once you have setup the LAMP stack successfully, you can deploy your existing web application to the Apache web server (your virtual machine).",
      "pos": [
        15973,
        16115
      ]
    },
    {
      "content": "It is the same steps as deploying an existing web application on a physical web server.",
      "pos": [
        16116,
        16203
      ]
    },
    {
      "content": "The root of the webserver is located at <bpt id=\"p1\">**</bpt>/var/www/html<ept id=\"p1\">**</ept>.",
      "pos": [
        16209,
        16267
      ]
    },
    {
      "content": "You should grant privileges to the users who need to upload files to this folder.",
      "pos": [
        16268,
        16349
      ]
    },
    {
      "content": "The following example shows how to add write permission to a group named lampappgroup and put the azureuser user name in this group:",
      "pos": [
        16350,
        16482
      ]
    },
    {
      "pos": [
        16841,
        16926
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You may need to login again if you want modify a file in /var/www/html/."
    },
    {
      "content": "Use any SFTP client (such as FileZilla) to connect to the DNS name of your virtual machine (for example,  lampdemo.cloudapp.net) and navigate to /<bpt id=\"p1\">**</bpt>var/www/html<ept id=\"p1\">**</ept> to publish your site.",
      "pos": [
        16931,
        17115
      ]
    },
    {
      "content": "Common issues and troubleshooting",
      "pos": [
        17131,
        17164
      ]
    },
    {
      "content": "Can't access Virtual Machine with Apache and Moodle from the Internet",
      "pos": [
        17169,
        17238
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Symptom<ept id=\"p1\">**</ept>",
      "pos": [
        17244,
        17255
      ]
    },
    {
      "content": "Apache is running but you can’t see the Apache default page with your browser.",
      "pos": [
        17258,
        17336
      ]
    },
    {
      "content": "Possible root case",
      "pos": [
        17343,
        17361
      ]
    },
    {
      "pos": [
        17372,
        17911
      ],
      "content": "The Apache listening port is not same as the Private Port of your virtual machine's endpoint for web traffic.</br>\nCheck your Public Port and Private Port endpoint settings and make sure the Private Port is same as the Apache listen port. See Phase 1: Create an Image for instructions on configuring endpoints for your virtual machine.</br>\nTo determine the listen port of Apache, open /etc/httpd/conf/httpd.conf (Red Hat release) or /etc/apache2/ports.conf (Debian release), search for the string “Listen”. The default port is 80.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "The Apache listening port is not same as the Private Port of your virtual machine's endpoint for web traffic.",
          "pos": [
            0,
            109
          ]
        },
        {
          "content": "Check your Public Port and Private Port endpoint settings and make sure the Private Port is same as the Apache listen port. See Phase 1: Create an Image for instructions on configuring endpoints for your virtual machine.",
          "pos": [
            115,
            335
          ],
          "nodes": [
            {
              "content": "Check your Public Port and Private Port endpoint settings and make sure the Private Port is same as the Apache listen port.",
              "pos": [
                0,
                123
              ]
            },
            {
              "content": "See Phase 1: Create an Image for instructions on configuring endpoints for your virtual machine.",
              "pos": [
                124,
                220
              ]
            }
          ]
        },
        {
          "content": "To determine the listen port of Apache, open /etc/httpd/conf/httpd.conf (Red Hat release) or /etc/apache2/ports.conf (Debian release), search for the string “Listen”. The default port is 80.",
          "pos": [
            341,
            531
          ],
          "nodes": [
            {
              "content": "To determine the listen port of Apache, open /etc/httpd/conf/httpd.conf (Red Hat release) or /etc/apache2/ports.conf (Debian release), search for the string “Listen”.",
              "pos": [
                0,
                166
              ]
            },
            {
              "content": "The default port is 80.",
              "pos": [
                167,
                190
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        17921,
        18261
      ],
      "content": "The firewall has disabled the listen port of Apache.</br>  \nIf you can see Apache default page from the local host, then the problem is most likely that the port which is listened by Apache is blocked by the firewall. You can use the w3m tool to browse the web page. The following commands install w3m and browse to Apache default page:",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "The firewall has disabled the listen port of Apache.",
          "pos": [
            0,
            52
          ]
        },
        {
          "content": "If you can see Apache default page from the local host, then the problem is most likely that the port which is listened by Apache is blocked by the firewall. You can use the w3m tool to browse the web page. The following commands install w3m and browse to Apache default page:",
          "pos": [
            60,
            336
          ],
          "nodes": [
            {
              "content": "If you can see Apache default page from the local host, then the problem is most likely that the port which is listened by Apache is blocked by the firewall.",
              "pos": [
                0,
                157
              ]
            },
            {
              "content": "You can use the w3m tool to browse the web page.",
              "pos": [
                158,
                206
              ]
            },
            {
              "content": "The following commands install w3m and browse to Apache default page:",
              "pos": [
                207,
                276
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "Solution",
      "pos": [
        18347,
        18355
      ]
    },
    {
      "content": "If the Apache listen port is not same as the Private Port of endpoint for web traffic on the virtual machine, you need change the Private Port of the endpoint to be the same as the Apache listen port.",
      "pos": [
        18367,
        18567
      ]
    },
    {
      "content": "If the issue is caused by the firewall/iptables, add the following lines to /etc/sysconfig/iptables:",
      "pos": [
        18576,
        18676
      ]
    },
    {
      "content": "Note that the second line is only needed for https traffic.",
      "pos": [
        18802,
        18861
      ]
    },
    {
      "content": "Make sure this is above any lines that would globally restrict access, such as the following:",
      "pos": [
        18871,
        18964
      ]
    },
    {
      "content": "To reload the iptables, run the following command:",
      "pos": [
        19045,
        19095
      ]
    },
    {
      "content": "This has been tested on CentOS 6.3.",
      "pos": [
        19147,
        19182
      ]
    },
    {
      "content": "Permission denied when upload you project files to /var/www/html/",
      "pos": [
        19187,
        19252
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Symptom<ept id=\"p1\">**</ept>",
      "pos": [
        19260,
        19271
      ]
    },
    {
      "content": "When you use any SFTP client (such as FileZilla) to connect to your virtual machine and navigate to /var/www/html to publish your site, you get an error message similar to the following:",
      "pos": [
        19274,
        19460
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Possible root case<ept id=\"p1\">**</ept>",
      "pos": [
        19697,
        19719
      ]
    },
    {
      "content": "You have no permissions to access the /var/www/html folder.",
      "pos": [
        19720,
        19779
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Solution<ept id=\"p1\">**</ept>",
      "pos": [
        19786,
        19798
      ]
    },
    {
      "content": "You need get permission from the root account.",
      "pos": [
        19801,
        19847
      ]
    },
    {
      "content": "You can change the ownership of that folder from root to the username you used when provisioning the machine.",
      "pos": [
        19848,
        19957
      ]
    },
    {
      "content": "Here is an example with the azureuser account name:",
      "pos": [
        19958,
        20009
      ]
    },
    {
      "content": "Use the -R option to apply the permissions for all files inside of a directory too.",
      "pos": [
        20066,
        20149
      ]
    },
    {
      "content": "Note that this command also works for directories.",
      "pos": [
        20157,
        20207
      ]
    },
    {
      "content": "The -R option changes the permissions for all files and directories inside of the directory.",
      "pos": [
        20208,
        20300
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        20301,
        20320
      ]
    },
    {
      "content": "This command  changes ownership (both user and group) for all files and directories inside of directory and directory itself.",
      "pos": [
        20378,
        20503
      ]
    },
    {
      "content": "The following command only changes the permission of the folder directory but leaves the files and folders inside the directory alone.",
      "pos": [
        20511,
        20645
      ]
    },
    {
      "content": "Could not reliably determine the server's fully qualified domain name",
      "pos": [
        20699,
        20768
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Symptom<ept id=\"p1\">**</ept>",
      "pos": [
        20774,
        20785
      ]
    },
    {
      "content": "When you restart the Apache server using one of the following commands:",
      "pos": [
        20788,
        20859
      ]
    },
    {
      "content": "or",
      "pos": [
        20929,
        20931
      ]
    },
    {
      "content": "You get the following error:",
      "pos": [
        20999,
        21027
      ]
    },
    {
      "pos": [
        21334,
        21404
      ],
      "content": "**Possible root case**\nYou have not set the server name of Apache.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Possible root case<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            22
          ]
        },
        {
          "content": "You have not set the server name of Apache.",
          "pos": [
            23,
            66
          ]
        }
      ]
    },
    {
      "pos": [
        21410,
        21600
      ],
      "content": "**Solution**  \nInsert a “ServerName localhost” line in either httpd.conf (Red Hat release) or apache2.conf (Debian release) in /etc/apache2 and restart Apache. The notice will disappear.",
      "leadings": [
        "",
        "    "
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Solution<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            12
          ]
        },
        {
          "content": "Insert a “ServerName localhost” line in either httpd.conf (Red Hat release) or apache2.conf (Debian release) in /etc/apache2 and restart Apache. The notice will disappear.",
          "pos": [
            15,
            186
          ],
          "nodes": [
            {
              "content": "Insert a “ServerName localhost” line in either httpd.conf (Red Hat release) or apache2.conf (Debian release) in /etc/apache2 and restart Apache.",
              "pos": [
                0,
                144
              ]
            },
            {
              "content": "The notice will disappear.",
              "pos": [
                145,
                171
              ]
            }
          ]
        }
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"How to create a LAMP Stack with Microsoft Azure\"\n    description=\"Learn how to create a LAMP Stack with Microsoft Azure using Azure virtual machines (VMs) running Linux.\"\n    services=\"virtual-machines\"\n    documentationCenter=\"\"\n    authors=\"NingKuang\"\n    manager=\"timlt\"\n    editor=\"tysonn\"/>\n\n<tags\n    ms.service=\"virtual-machines\"\n    ms.workload=\"infrastructure-services\"\n    ms.tgt_pltfrm=\"vm-linux\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"07/10/2015\"\n    ms.author=\"ningk\"/>\n\n#How to create a LAMP Stack with Microsoft Azure\n\nA \"LAMP\" stack is a group of open source software that is typically installed together to enable a server to host dynamic websites and web applications. This term is actually an acronym that represents the Linux operating system with the Apache web server. The site data is stored in a MySQL database, and dynamic content is processed by PHP.  \n\nIn this guide, we'll get a LAMP stack installed on a Linux image and deploy it on Microsoft Azure.  \n\nYou will learn:  \n\n-   How to create an Azure virtual machine.\n-   How to prepare the virtual machine for the LAMP stack.\n-   How to install software that is needed by your LAMP server on the virtual machine.\n\nIt is assumed that the reader already has an Azure subscription.  If not you can sign up for a free trial at [http://azure.microsoft.com](http://azure.microsoft.com). If you have an MSDN subscription, see [Microsoft Azure Special Pricing: MSDN, MPN, and Bizspark Benefits](http://azure.microsoft.com/pricing/member-offers/msdn-benefits/?c=14-39). To learn more about Azure, see [What is Azure?](http://azure.microsoft.com/overview/what-is-azure/)\n\nIn addition to this topic, if you already have a virtual machine and are just looking for the basics of installing a  LAMP stack on different Linux distributions, refer to [Install the LAMP Stack on a Linux virtual machine in Azure](virtual-machines-linux-install-lamp-stack.md).\n\nYou can also deploy pre-configured LAMP images from the Azure Marketplace. The following 10 minute video introduces deploying pre-built LAMP images from the Azure Marketplace: (LAMP stack on Azure VMs](https://channel9.msdn.com/Shows/Azure-Friday/LAMP-stack-on-Azure-VMs-with-Guy-Bowerman).\n\n##Phase 1: Create an image\nIn this phase, you will create a virtual machine using a Linux image in Azure.  \n\n###Step 1: Generate an SSH Authentication Key\nSSH is an important tool for system administrators. However, relying on a human-determined password for security is not always wise. A strong SSH key allows you to leave remote access open without worrying about passwords. The method consists of authentication with asymmetric cryptography. The user’s private key is the one that grants the authentication. You can even lock the user’s account to disallow password authentication completely.\n\nFollow these steps to generate the SSH Authentication Key.\n\n-   Download and install puttygen from the following location: [http://www.chiark.greenend.org.uk/~sgtatham/](http://www.chiark.greenend.org.uk/~sgtatham/)putty/download.html\n-   Run puttygen.exe.\n-   Click **Generate** to generate the keys. In the process you can increase randomness by moving the mouse over the blank area in the window.  \n![][1]\n-   After the generate process, Puttygen.exe will show your generated key. For example:  \n![][2]\n-   Select and copy the public key in **Key** and save it in a file named **publicKey.pem**. Don’t click **Save public key**, because the saved public key’s file format is different from the public key we want.\n-   Click **Save private key** and save it in a file named **privateKey.ppk**.\n\n###Step 2: Create the image in the Azure Portal.\nIn the [Azure Portal](https://portal.azure.com/), click **New** in the task bar and create an image by following these instructions, choosing the Linux image based on your needs. This example uses the Ubuntu 14.04 image.\n\n![][3]\n\nFor **Host Name**, specify the name for the URL that you an Internet clients will use to access this virtual machine. Define the last part of the DNS name, for example LAMPDemo, and Azure will generate the URL as Lampdemo.cloudapp.net.\n\nFor **User Name**, pick a name that you will later use to login to the virtual machine.\n\nFor **SSH Authentication Key**, copy the key value from the **publicKey.pem** file, which contains the public key generated by puttygen.  \n\n![][4]\n\nConfigure other settings as needed, and then click **Create**.\n\n##Phase 2: Prepare your virtual machine for the LAMP stack\nIn this phase, you will configure an endpoint for web traffic and then connect to your new virtual machine.\n\n###Step 1: Open the HTTP port to allow web access\nEndpoints in Azure consists of a protocol (TCP or UDP), along with a public and private port. The private port is the port that the service is listening on the virtual machine. The public port is the port that the Azure cloud service is listening externally for Internet-based traffic. In some cases, this is the same port number.  \n\nTCP port 80 is the default port number on which Apache listens. Opening this port with an Azure endpoint will allow you and other Internet clients access to the Apache web server.  \n\nIn the Azure Portal, click **Browse -> Virtual Machine**, and then click the virtual machine that you created.\n\n![][5]\n\nTo add an endpoint to a virtual machine, click the **Endpoints** box.\n\n![][6]\n\nClick **Add**. When provisioning a new virtual machine you can enable or disable endpoints as needed.\n\nConfigure the endpoint:  \n\n1.  Type a name for the endpoint in **Endpoint**.\n2.  Type 80 in **Public Port**. If you changed the default listen port of Apache, you should update Private Port to be the same as the Apache listen port.\n3.  Type 80 in **Public Port**. By default, HTTP traffic uses port 80.\nIf you set it to 80, don’t need to include the port number in the URL that allows you to access the Apache web service. For example, http://lampdemo.cloudapp.net.\nIf you set the Apache listening port to another value, such as 81, you need to add the port number to the URL to access the Apache web service. For example,  http://lampdemo.cloudapp.net:81/.\n\n![][7]\n\nClick **OK** to add the endpoint to your virtual machine.\n\n\n\n\n###Step 2: Connect to the image you created\nYou can choose any SSH tool to connect to your new virtual machine. In this example, we use Putty.  \n\nFirst, get the DNS name of your virtual machine from the Azure Portal. Click **Browse -> Virtual machines ->** the name of your virtual machine **-> Properties**, and then look in the **Domain Name** field of the **Properties** tile.\n\nGet the port number for SSH connections from the **SSH** field.   Here is an example.  \n\n![][8]\n\nDownload Putty from [here](http://www.putty.org/) .  \n\nAfter downloading, click the executable file PUTTY.EXE. Configure the basic options with the host name and port number obtained from the properties of your virtual machine. Here is an example:\n\n![][9]\n\nIn the left pane, click  **Connection -> SSH -> Auth** and then click **Browse** to specify the location of the **privateKey.ppk** file, which contains the private key generated by puttygen in Phase 1: Create an Image. Here is an example:  \n\n![][10]\n\nClick **Open**. You might be alerted by a message box. If you have configured the DNS name and port number correctly, click **Yes**.\n\n![][11]\n\n\nYou should see the following.\n\n![][12]\n\nEnter the user name specified when you created the virtual machine in Phase 1: Create an Image. You will see something like the following:  \n\n![][13]\n\n##Phase 3: Install the LAMP Stack\n\nDepending what Linux distribution you used to create your virtual machine, there are different ways to install the LAMP Stack. The following sections contain typical steps on some common Linux OSes.\n\n###Red Hat, CentOS base\n\n####Install Apache\nTo install Apache, open terminal and execute this command:  \n\n    sudo yum install httpd\n\nOnce it installs, start Apache with this command:  \n\n    sudo service httpd start\n####Test Apache\nTo check if Apache is successfully installed, browse to your Apache server’s DNS name (for the example URL in this article, http://lampdemo.cloudapp.net/). The page should display the words “It works!\"\n![][14]\n\n####Troubleshooting\nIf Apache is running but you can’t see Apache default page above, you need to check following:  \n\n-   Apache web service listening address / port\n    -   Check your endpoint setting for your Azure virtual machine. Make sure the configuration of the endpoint is appropriate. See the Phase 1: Create an Image instructions in this article.\n    -   Open /etc/httpd/conf/httpd.conf and then search for the string “Listen”. Ensure that the Apache listening port is same as the Private Port that you configured for your endpoint. The default port for Apache is 80. Here is an example.  \n\n            ……\n            ......\n                # prevent Apache from glomming onto all bound IP addresses (0.0.0.0)\n                #\n                #Listen 12.34.56.78:80\n                Listen 80\n                #\n                # Dynamic Shared Object (DSO) Support\n            ……\n            ……  \n\n-   Firewall, iptables configuration  \nIf you can see Apache default page from the local host, then the problem may be that the port upon which Apache is listening is blocked by the firewall. You can use the w3m tool to browse the Apache web page. The following commands install w3m and browse to the Apache default page:  \n\n        sudo yum  install w3m w3m-img  \n        w3m http://localhost\n\n    If the issue is caused by the firewall or iptables, add the following lines to /etc/sysconfig/iptables:  \n\n        -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT\n        -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT\n\n    Note that the second line is only needed for https traffic.  \n\n    Make sure that these lines are above any lines that would globally restrict access, such as the following:  \n\n        -A INPUT -j REJECT --reject-with icmp-host-prohibited  \n\n    To make the new settings take effect, use the following command:  \n\n        service iptables restart\n\n####Install MySQL\nTo install MySQL, open terminal and run these commands:  \n\n    sudo yum install mysql-server\n    sudo service mysqld start\n\nDuring the installation, MySQL will ask you for your permission twice. After you say yes to both queries, MySQL will install.\n\n####Configure MySQL\nAfter it is done installing, you can set a root MySQL password with the following:  \n\n    sudo /usr/bin/mysql_secure_installation  \n\nThe prompt will ask you for your current root password.\n\nSince you just installed MySQL, you most likely won’t have one, so leave it blank by pressing ENTER.  \n\n    Enter current password for root (enter for none):\n    OK, successfully used password, moving on...  \n\nYou will be prompted to set a root password. Go ahead and choose Y and follow the instructions.  \n\nCentOS automates the process of setting up MySQL, asking you a series of yes or no questions. Those questions are shown below. Choose Y or N for your configuration. At the end, MySQL will reload and implement the new changes.  \n\n    By default, a MySQL installation has an anonymous user, allowing anyone\n    to log into MySQL without having to have a user account created for\n    them.  This is intended only for testing, and to make the installation\n    go a bit smoother.  You should remove them before moving into a\n    production environment.\n\n    Remove anonymous users? [Y/n] y\n     ... Success!\n\n    Normally, root should only be allowed to connect from 'localhost'.  This\n    ensures that someone cannot guess at the root password from the network.\n\n    Disallow root login remotely? [Y/n] y\n    ... Success!\n\n    By default, MySQL comes with a database named 'test' that anyone can\n    access.  This is also intended only for testing, and should be removed\n    before moving into a production environment.\n\n    Remove test database and access to it? [Y/n] y\n     - Dropping test database...\n     ... Success!\n     - Removing privileges on test database...\n     ... Success!\n\n    Reloading the privilege tables will ensure that all changes made so far\n    will take effect immediately.\n\n    Reload privilege tables now? [Y/n] y\n     ... Success!\n\n    Cleaning up...\n\n    All done!  If you've completed all of the above steps, your MySQL\n    installation should now be secure.\n\n    Thanks for using MySQL!  \n\n####Install PHP\nPHP is an open source web scripting language that is widely used to build dynamic web pages.  \n\nTo install PHP on your virtual machine, open terminal and run this command:  \n\n    sudo yum install php php-mysql  \n\nAnswer “y” to download software packages. Then answer “y” to Importing GPG key 0xE8562897 \"CentOS-5 Key (CentOS 5 Official Signing Key). PHP will install.\n\n    warning: rpmts_HdrFromFdno: Header V3 DSA signature: NOKEY, key ID e8562897\n    updates/gpgkey                                                                                                                                                                       | 1.5 kB     00:00\n    Importing GPG key 0xE8562897 \"CentOS-5 Key (CentOS 5 Official Signing Key) <centos-5-key@centos.org>\" from /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-5\n    Is this ok [y/N]: y  \n\n###Debian, Ubuntu base\nThis has been tested on Ubuntu 14.04.  \n\nUbuntu is based on Debian. You can install the LAMP stack in the same way as the Red Hat series. To simplify the steps, use the Tasksel tool.\n\nTasksel is a Debian/Ubuntu tool that installs multiple related packages as a coordinated task onto your system. For more information, see [Tasksel - Community Help Wiki](https://help.ubuntu.com/community/Tasksel).\n\nUse tasksel to install the required software for the LAMP stack.\n\n- To download the package lists from the repositories and update them to get information on the newest versions of packages and their dependencies:  \n\n        sudo apt-get update\n-   To Install the Ubuntu LAMP stack using Tasksel:  \n\n        sudo apt-get install tasksel\n        sudo tasksel install lamp-server\n\nNext, go through the wizard and choose your **MySQL root password**.\n\n![][15]\n\n\n##Testing LAMP on your Server\nYou can test the LAMP system by creating a quick php info page.\n\nFirst, create a new file:  \n\n    sudo nano /var/www/html/info.php  \n\nAdd the following line:  \n\n    <?php\n    phpinfo();\n    ?>  \n\nThen, Save and Exit.  \n\nRestart Apache so that all of the changes take effect on your machine. If the OS of your virtual machine is CentOS, use the following command to restart Apache:  \n\n    sudo service httpd restart\n\nIf the OS of your virtual machine is Ubuntu, use the following command to restart Apache:  \n\n    sudo service apache2 restart  \n\nFinish up by browsing to your php info page (for the example web server in this topic, the URL would be http://lampdemo.cloudapp.net/info.php).  \n\nYour browser should look similar to this:\n\n![][16]\n\n##Additional steps\n\nAs general practice, you will change some default settings to prepare for web application deployment.  \n\n###Allow remote access to MySQL\nIf you have more than one VM installed with MySQL and they need to exchange data, you should enable MySQL remote access and grant the proper permissions.  \n\n**Command reference format:**\n\n    grant [authority] on [databaseName].[tableName] to [username]@[login host] identified by \"[passwd]\"  \n\n**Example:**  \n\n    grant select,insert,update,delete on studentManage.student to user1@\"%\" Identified by \"abc\";\n\nYou should also change the /etc/mysql/my.cnf profile. If you have lines like this:  \n\n    skip-networking\n    bind-address = 127.0.0.1  \n\nYou should comment them out (add a # at the beginning of the lines), and then restart MySQL.  \n\nTo add an endpoint to allow remote access, refer to instructions in Phase 1: Create an Image to create a new endpoint. The default remote access TCP port number of MySQL is 3306. Here is an example:\n\n![][17]\n\n###Deploy your web applications to the apache server\nOnce you have setup the LAMP stack successfully, you can deploy your existing web application to the Apache web server (your virtual machine). It is the same steps as deploying an existing web application on a physical web server.\n\n-   The root of the webserver is located at **/var/www/html**. You should grant privileges to the users who need to upload files to this folder. The following example shows how to add write permission to a group named lampappgroup and put the azureuser user name in this group:  \n\n        sudo groupadd lampappgroup                      # Create a group\n        sudo gpasswd -a azureuser lampappgroup    # Add azureuser to lampappgroup\n        sudo chgrp lampappgroup /var/www/html/  # Change the ownership to group lampappgroup\n        sudo chmod g+w /var/www/html/                 # grant write permission to group lampappgroup\n\n    >[AZURE.NOTE] You may need to login again if you want modify a file in /var/www/html/.\n-   Use any SFTP client (such as FileZilla) to connect to the DNS name of your virtual machine (for example,  lampdemo.cloudapp.net) and navigate to /**var/www/html** to publish your site.  \n![][18]\n\n\n\n##Common issues and troubleshooting\n\n###Can't access Virtual Machine with Apache and Moodle from the Internet\n\n-   **Symptom**  \nApache is running but you can’t see the Apache default page with your browser.\n-   **Possible root case**\n    1.  The Apache listening port is not same as the Private Port of your virtual machine's endpoint for web traffic.</br>\n    Check your Public Port and Private Port endpoint settings and make sure the Private Port is same as the Apache listen port. See Phase 1: Create an Image for instructions on configuring endpoints for your virtual machine.</br>\n    To determine the listen port of Apache, open /etc/httpd/conf/httpd.conf (Red Hat release) or /etc/apache2/ports.conf (Debian release), search for the string “Listen”. The default port is 80.\n\n    2.  The firewall has disabled the listen port of Apache.</br>  \n    If you can see Apache default page from the local host, then the problem is most likely that the port which is listened by Apache is blocked by the firewall. You can use the w3m tool to browse the web page. The following commands install w3m and browse to Apache default page:  \n\n            sudo yum  install w3m w3m-img\n            w3m http://localhost\n\n-   **Solution**\n\n    1.  If the Apache listen port is not same as the Private Port of endpoint for web traffic on the virtual machine, you need change the Private Port of the endpoint to be the same as the Apache listen port.\n    2.  If the issue is caused by the firewall/iptables, add the following lines to /etc/sysconfig/iptables:  \n\n            -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT\n            -A INPUT -p tcp -m tcp --dport 443 -j ACCEPT\n\n        Note that the second line is only needed for https traffic.\n\n        Make sure this is above any lines that would globally restrict access, such as the following:  \n\n            -A INPUT -j REJECT --reject-with icmp-host-prohibited  \n\n        To reload the iptables, run the following command:  \n\n            service iptables restart  \n\n        This has been tested on CentOS 6.3.\n\n###Permission denied when upload you project files to /var/www/html/  \n\n-   **Symptom**  \nWhen you use any SFTP client (such as FileZilla) to connect to your virtual machine and navigate to /var/www/html to publish your site, you get an error message similar to the following:  \n\n        status: Listing directory /var/www/html\n        Command:    put \"C:\\Users\\liang\\Desktop\\info.php\" \"info.php\"\n        Error:  /var/www/html/info.php: open for write: permission denied\n        Error:  File transfer failed\n\n-   **Possible root case**\nYou have no permissions to access the /var/www/html folder.  \n-   **Solution**  \nYou need get permission from the root account. You can change the ownership of that folder from root to the username you used when provisioning the machine. Here is an example with the azureuser account name:  \n\n        sudo chown azureuser -R /var/www/html  \n\n    Use the -R option to apply the permissions for all files inside of a directory too.  \n\n    Note that this command also works for directories. The -R option changes the permissions for all files and directories inside of the directory. Here is an example:  \n\n        sudo chown -R username:group directory  \n\n    This command  changes ownership (both user and group) for all files and directories inside of directory and directory itself.  \n\n    The following command only changes the permission of the folder directory but leaves the files and folders inside the directory alone.  \n\n        sudo chown username:group directory  \n\n###Could not reliably determine the server's fully qualified domain name\n\n-   **Symptom**  \nWhen you restart the Apache server using one of the following commands:  \n\n        sudo /etc/init.d/apache2 restart  # Debian release  \n\n    or\n\n        sudo /etc/init.d/httpd restart   # Red Hat release  \n\n    You get the following error:  \n\n        Restarting web server apache2\n        apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.1.1 for ServerName\n        ... waiting apache2:\n        Could not reliably determine the server's fully qualified domain name, using 127.0.1.1 for ServerName  \n\n-   **Possible root case**\n    You have not set the server name of Apache.\n\n-   **Solution**  \n    Insert a “ServerName localhost” line in either httpd.conf (Red Hat release) or apache2.conf (Debian release) in /etc/apache2 and restart Apache. The notice will disappear.\n\n\n\n[1]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-01.png\n[2]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-02.png\n[3]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-03.png\n[4]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-04.png\n[5]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-05.png\n[6]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-06.png\n[7]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-07.png\n[8]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-08.png\n[9]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-09.png\n[10]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-10.png\n[11]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-11.png\n[12]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-12.png\n[13]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-13.png\n[14]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-14.png\n[15]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-15.png\n[16]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-16.png\n[17]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-17.png\n[18]: ./media/virtual-machines-linux-create-lamp-stack/virtual-machines-linux-create-lamp-stack-18.jpg\n \n"
}