{
  "nodes": [
    {
      "content": "Failover in Site Recovery",
      "pos": [
        27,
        52
      ]
    },
    {
      "content": "Azure Site Recovery coordinates the replication, failover and recovery of virtual machines and physical servers.",
      "pos": [
        72,
        184
      ]
    },
    {
      "content": "Learn about failover to Azure or a secondary datacenter.",
      "pos": [
        185,
        241
      ]
    },
    {
      "content": "Failover in Site Recovery",
      "pos": [
        572,
        597
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>Azure Site Recovery service<ept id=\"p1\">](site-recovery-overview.md)</ept> contributes to a robust business continuity and disaster recovery (BCDR) solution that protects your on-premises physical servers and virtual machines by orchestrating and automating replication and failover to Azure, or to a secondary on-premises datacenter.",
      "pos": [
        599,
        919
      ]
    },
    {
      "content": "This article provides information and instructions for recovering (failing over and failing back) virtual machines and physical servers that are protected with Site Recovery.",
      "pos": [
        920,
        1094
      ]
    },
    {
      "pos": [
        1097,
        1273
      ],
      "content": "If you have any questions after reading this article post them on the <bpt id=\"p1\">[</bpt>Azure Recovery Services Forum<ept id=\"p1\">](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr)</ept>."
    },
    {
      "content": "Overview",
      "pos": [
        1279,
        1287
      ]
    },
    {
      "content": "After you've set up protection for virtual machines and physical servers they begin replicating to the secondary location.",
      "pos": [
        1289,
        1411
      ]
    },
    {
      "content": "After replication is in place you can run failovers as the need arises.",
      "pos": [
        1412,
        1483
      ]
    },
    {
      "content": "Site Recovery supports a number of types of failover.",
      "pos": [
        1484,
        1537
      ]
    },
    {
      "content": "Failover",
      "pos": [
        1541,
        1549
      ]
    },
    {
      "content": "When to run",
      "pos": [
        1556,
        1567
      ]
    },
    {
      "content": "Details",
      "pos": [
        1574,
        1581
      ]
    },
    {
      "content": "Process",
      "pos": [
        1588,
        1595
      ]
    },
    {
      "content": "Test failover",
      "pos": [
        1616,
        1629
      ]
    },
    {
      "content": "Run to validate your replication strategy or perform a disaster recovery drill",
      "pos": [
        1634,
        1712
      ]
    },
    {
      "content": "No data loss or downtime",
      "pos": [
        1718,
        1742
      ]
    },
    {
      "content": "No impact on replication",
      "pos": [
        1749,
        1773
      ]
    },
    {
      "content": "No impact on your production environment",
      "pos": [
        1780,
        1820
      ]
    },
    {
      "content": "Start the failover",
      "pos": [
        1830,
        1848
      ]
    },
    {
      "content": "Specify how test machines will be connected to networks after failover",
      "pos": [
        1855,
        1925
      ]
    },
    {
      "content": "Track progress on the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> tab.",
      "pos": [
        1932,
        1967
      ]
    },
    {
      "content": "Test machines are created and start in the secondary location",
      "pos": [
        1968,
        2029
      ]
    },
    {
      "content": "Azure - connect to the machine in the Azure portal",
      "pos": [
        2036,
        2086
      ]
    },
    {
      "content": "Secondary site - access the machine on the same host and cloud",
      "pos": [
        2093,
        2155
      ]
    },
    {
      "content": "Complete testing and automatically clean up test failover settings.",
      "pos": [
        2162,
        2229
      ]
    },
    {
      "content": "Planned failover",
      "pos": [
        2236,
        2252
      ]
    },
    {
      "content": "Run to meet compliance requirements",
      "pos": [
        2260,
        2295
      ]
    },
    {
      "content": "Run for planned maintenance",
      "pos": [
        2302,
        2329
      ]
    },
    {
      "content": "Run to fail over data to keep workloads running for known outages - such as an expected power failure or severe weather reports",
      "pos": [
        2336,
        2463
      ]
    },
    {
      "content": "Run to failback after failover from primary to secondary",
      "pos": [
        2471,
        2527
      ]
    },
    {
      "content": "No data loss",
      "pos": [
        2533,
        2545
      ]
    },
    {
      "content": "Downtime is incurred during the time it takes to shut down the virtual machine on the primary and bring it up on the secondary location.",
      "pos": [
        2552,
        2688
      ]
    },
    {
      "content": "Virtual machines are impact as  target machines becomes source machines after failover.",
      "pos": [
        2695,
        2782
      ]
    },
    {
      "content": "Start the failover",
      "pos": [
        2792,
        2810
      ]
    },
    {
      "content": "Track progress on the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> tab.",
      "pos": [
        2817,
        2852
      ]
    },
    {
      "content": "Source machines are shut down",
      "pos": [
        2853,
        2882
      ]
    },
    {
      "content": "Replica machines start in the secondary location",
      "pos": [
        2889,
        2937
      ]
    },
    {
      "content": "Azure - connect to the replica machine in the Azure portal",
      "pos": [
        2944,
        3002
      ]
    },
    {
      "content": "Secondary site - access the machine on the same host and in the same cloud",
      "pos": [
        3009,
        3083
      ]
    },
    {
      "content": "Commit the failover",
      "pos": [
        3090,
        3109
      ]
    },
    {
      "content": "Unplanned failover",
      "pos": [
        3116,
        3134
      ]
    },
    {
      "content": "Run this type of failover reactive manner when a primary site becomes inaccessible because of an unexpected incident, such as a power outage or virus attack",
      "pos": [
        3142,
        3298
      ]
    },
    {
      "content": "You can run an unplanned failover can be done even if primary site isn't available.",
      "pos": [
        3305,
        3388
      ]
    },
    {
      "content": "Data loss dependent on replication frequency settings",
      "pos": [
        3397,
        3450
      ]
    },
    {
      "content": "Data will be up-to-date in accordance with the last time it was synchronized",
      "pos": [
        3458,
        3534
      ]
    },
    {
      "content": "Start the failover",
      "pos": [
        3544,
        3562
      ]
    },
    {
      "content": "Track progress on the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> tab.",
      "pos": [
        3569,
        3604
      ]
    },
    {
      "content": "Optionally try to shut down virtual machines and synchronize latest data",
      "pos": [
        3605,
        3677
      ]
    },
    {
      "content": "Replica machines start in the secondary location",
      "pos": [
        3684,
        3732
      ]
    },
    {
      "content": "Azure - connect to the replica machine in the Azure portal",
      "pos": [
        3739,
        3797
      ]
    },
    {
      "content": "Secondary site access the machine on the same host and in the same cloud",
      "pos": [
        3804,
        3876
      ]
    },
    {
      "content": "Commit the failover",
      "pos": [
        3883,
        3902
      ]
    },
    {
      "content": "The types of failovers that are supported depend on your deployment scenario.",
      "pos": [
        3909,
        3986
      ]
    },
    {
      "content": "Failover direction",
      "pos": [
        3990,
        4008
      ]
    },
    {
      "content": "Test failover",
      "pos": [
        4015,
        4028
      ]
    },
    {
      "content": "Planned failover",
      "pos": [
        4035,
        4051
      ]
    },
    {
      "content": "Unplanned failover",
      "pos": [
        4058,
        4076
      ]
    },
    {
      "content": "Primary VMM site to Secondary VMM site",
      "pos": [
        4095,
        4133
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4136,
        4145
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4148,
        4157
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4160,
        4169
      ]
    },
    {
      "content": "Secondary VMM site to Primary VMM site",
      "pos": [
        4171,
        4209
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4212,
        4221
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4224,
        4233
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4236,
        4245
      ]
    },
    {
      "content": "Cloud to Cloud (single VMM server)",
      "pos": [
        4246,
        4280
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4284,
        4293
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4296,
        4305
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4308,
        4317
      ]
    },
    {
      "content": "VMM site to Azure",
      "pos": [
        4318,
        4335
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4338,
        4347
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4350,
        4359
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4362,
        4371
      ]
    },
    {
      "content": "Azure to VMM site",
      "pos": [
        4373,
        4390
      ]
    },
    {
      "content": "Unsupported",
      "pos": [
        4393,
        4404
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4407,
        4416
      ]
    },
    {
      "content": "Unsupported",
      "pos": [
        4419,
        4430
      ]
    },
    {
      "content": "Hyper-V site to Azure",
      "pos": [
        4432,
        4453
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4456,
        4465
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4468,
        4477
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4480,
        4489
      ]
    },
    {
      "content": "Azure to Hyper-V site",
      "pos": [
        4490,
        4511
      ]
    },
    {
      "content": "Unsupported",
      "pos": [
        4514,
        4525
      ]
    },
    {
      "content": "Supported",
      "pos": [
        4528,
        4537
      ]
    },
    {
      "content": "Unsupported",
      "pos": [
        4540,
        4551
      ]
    },
    {
      "content": "VMware site to Azure",
      "pos": [
        4552,
        4572
      ]
    },
    {
      "content": "Unsupported",
      "pos": [
        4575,
        4586
      ]
    },
    {
      "content": "This scenario uses continuous replication so there's no distinction between planned and unplanned failover.",
      "pos": [
        4588,
        4695
      ]
    },
    {
      "content": "You select <bpt id=\"p1\">**</bpt>Failover<ept id=\"p1\">**</ept>",
      "pos": [
        4696,
        4719
      ]
    },
    {
      "content": "NA",
      "pos": [
        4722,
        4724
      ]
    },
    {
      "content": "Physical server to Azure",
      "pos": [
        4725,
        4749
      ]
    },
    {
      "content": "Not supported",
      "pos": [
        4752,
        4765
      ]
    },
    {
      "content": "This scenario uses continuous replication so there's no distinction between planned and unplanned failover.",
      "pos": [
        4768,
        4875
      ]
    },
    {
      "content": "You select <bpt id=\"p1\">**</bpt>Failover<ept id=\"p1\">**</ept>",
      "pos": [
        4876,
        4899
      ]
    },
    {
      "content": "NA",
      "pos": [
        4902,
        4904
      ]
    },
    {
      "content": "Failover and failback",
      "pos": [
        4909,
        4930
      ]
    },
    {
      "content": "You fail over virtual machines to a secondary on-premises site or to Azure, depending on your deployment.",
      "pos": [
        4932,
        5037
      ]
    },
    {
      "content": "A machine that fails over to Azure is created as an Azure virtual machine.",
      "pos": [
        5038,
        5112
      ]
    },
    {
      "content": "You can fail over a single virtual machine or physical server, or a recovery plan.",
      "pos": [
        5113,
        5195
      ]
    },
    {
      "content": "Recovery plans consists of one or more ordered groups that contain protected virtual machines or physical servers.",
      "pos": [
        5196,
        5310
      ]
    },
    {
      "content": "They're used to orchestrate failover of multiple machines which fail over according to the group they're in.",
      "pos": [
        5311,
        5419
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Read more<ept id=\"p1\">](site-recovery-create-recovery-plans.md)</ept> about recovery plans.",
      "pos": [
        5420,
        5493
      ]
    },
    {
      "content": "After failover completes and your machines are up and running in a secondary location note that:",
      "pos": [
        5496,
        5592
      ]
    },
    {
      "content": "If you failed over to Azure, after the failover machines aren't protected or replicating in the primary or secondary location.",
      "pos": [
        5596,
        5722
      ]
    },
    {
      "content": "In Azure the virtual machines are stored in geo-replicated storage which provides resiliency, but not replication.",
      "pos": [
        5723,
        5837
      ]
    },
    {
      "content": "If you did an unplanned failover to a secondary site, after the failover machines in the secondary location aren't protected or replicating.",
      "pos": [
        5840,
        5980
      ]
    },
    {
      "content": "If you did an planned failover to a secondary site, after the failover machines in the secondary location are protected.",
      "pos": [
        5983,
        6103
      ]
    },
    {
      "content": "Failback from secondary site",
      "pos": [
        6111,
        6139
      ]
    },
    {
      "content": "Failback from a secondary site to a primary uses the same process as failover from the primary to secondary.",
      "pos": [
        6141,
        6249
      ]
    },
    {
      "content": "After the failover from primary to secondary datacenter is committed and complete, you can initiate reverse replication when your primary site becomes available.",
      "pos": [
        6250,
        6411
      ]
    },
    {
      "content": "Reverse replication initiates replication between the secondary site and the primary by synchronizing the delta data.",
      "pos": [
        6412,
        6529
      ]
    },
    {
      "content": "Reverse replication brings the virtual machines into a protected state but the secondary datacenter is still the active location.",
      "pos": [
        6530,
        6659
      ]
    },
    {
      "content": "In order to make the primary site into the active location you initiate a planned failover from secondary to primary, followed by another reverse replication.",
      "pos": [
        6660,
        6818
      ]
    },
    {
      "content": "Failback from Azure",
      "pos": [
        6824,
        6843
      ]
    },
    {
      "content": "If you've failed over to Azure your virtual machines are protected by the Azure resiliency features for virtual machines.",
      "pos": [
        6845,
        6966
      ]
    },
    {
      "content": "To make the original primary site into the active location you run a planned failover.",
      "pos": [
        6967,
        7053
      ]
    },
    {
      "content": "You can fail back to the original location or to an alternate location if your original site isn't available.",
      "pos": [
        7054,
        7163
      ]
    },
    {
      "content": "To start replicating again after failback to the primary location you initiate a reverse replication.",
      "pos": [
        7164,
        7265
      ]
    },
    {
      "content": "Failover considerations",
      "pos": [
        7271,
        7294
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>IP address after failover<ept id=\"p1\">**</ept>—By default a failed over machine will have a different IP address than the source machine.",
      "pos": [
        7298,
        7418
      ]
    },
    {
      "content": "If you want to retain the same IP address see:",
      "pos": [
        7419,
        7465
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Secondary site<ept id=\"p1\">**</ept>—If you're failing over to a secondary site and you want to retain an IP address <bpt id=\"p2\">[</bpt>read<ept id=\"p2\">](http://blogs.technet.com/b/scvmm/archive/2014/04/04/retaining-ip-address-after-failover-using-hyper-v-recovery-manager.aspx)</ept> this article.",
      "pos": [
        7473,
        7717
      ]
    },
    {
      "content": "Note that you can retain a public IP address if your ISP supports it.",
      "pos": [
        7718,
        7787
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Azure<ept id=\"p1\">**</ept>—If you're failing over to Azure you can specify the IP address you want to assign in the <bpt id=\"p2\">**</bpt>Configure<ept id=\"p2\">**</ept> tab of the virtual machine properties.",
      "pos": [
        7794,
        7945
      ]
    },
    {
      "content": "You can't retain a public IP address after failover to Azure.",
      "pos": [
        7946,
        8007
      ]
    },
    {
      "content": "You can retain non-RFC 1918 address spaces that are used as internal addresses.",
      "pos": [
        8008,
        8087
      ]
    },
    {
      "pos": [
        8090,
        8188
      ],
      "content": "<bpt id=\"p1\">**</bpt>Partial failover<ept id=\"p1\">**</ept>—If you want to fail over part of a site rather than an entire site note that:"
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Secondary site<ept id=\"p1\">**</ept>—If you fail over part of a primary site to a secondary site and you want to connect back to the primary site, use a site-to-site VPN connection to connect failed over applications on the secondary site to infrastructure components running on the primary site.",
      "pos": [
        8196,
        8474
      ]
    },
    {
      "content": "If an entire subnet fails over you can retain the virtual machine IP address.",
      "pos": [
        8475,
        8552
      ]
    },
    {
      "content": "If you fail over a partial subnet you can't retain the virtual machine IP address because subnets can't be split between sites.",
      "pos": [
        8553,
        8680
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Azure<ept id=\"p1\">**</ept>—If you fail over a partial site to Azure and want to connect back to the primary site, you can use a site-to-site VPN to connect a failed over application in Azure to infrastructure components running on the primary site.",
      "pos": [
        8687,
        8918
      ]
    },
    {
      "content": "Note that if the entire subnet fails over you can retain the virtual machine IP address.",
      "pos": [
        8919,
        9007
      ]
    },
    {
      "content": "If you fail over a partial subnet you can't retain the virtual machine IP address because subnets can't be split between sites.",
      "pos": [
        9008,
        9135
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Drive letter<ept id=\"p1\">**</ept>—If you want to retain the drive letter on virtual machines after failover you can set the SAN policy for the virtual machine to <bpt id=\"p2\">**</bpt>On<ept id=\"p2\">**</ept>.",
      "pos": [
        9140,
        9292
      ]
    },
    {
      "content": "Virtual machine disks come online automatically.",
      "pos": [
        9293,
        9341
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Read more<ept id=\"p1\">](https://technet.microsoft.com/library/gg252636.aspx)</ept>.",
      "pos": [
        9342,
        9407
      ]
    },
    {
      "pos": [
        9410,
        9543
      ],
      "content": "<bpt id=\"p1\">**</bpt>Route client requests<ept id=\"p1\">**</ept>—Site Recovery works with Azure Traffic Manager to route client requests to your application after failover."
    },
    {
      "content": "Run a test failover",
      "pos": [
        9551,
        9570
      ]
    },
    {
      "content": "When you run a test failover you'll be asked to select network settings for test replica machines.",
      "pos": [
        9572,
        9670
      ]
    },
    {
      "content": "You have a number of options.",
      "pos": [
        9671,
        9700
      ]
    },
    {
      "content": "Test failover option",
      "pos": [
        9706,
        9726
      ]
    },
    {
      "content": "Description",
      "pos": [
        9733,
        9744
      ]
    },
    {
      "content": "Failover check",
      "pos": [
        9751,
        9765
      ]
    },
    {
      "content": "Details",
      "pos": [
        9772,
        9779
      ]
    },
    {
      "content": "Fail over to Azure—without network",
      "pos": [
        9800,
        9834
      ]
    },
    {
      "content": "Don't select a target Azure network",
      "pos": [
        9839,
        9874
      ]
    },
    {
      "content": "Failover checks that test virtual machine starts as expected in Azure",
      "pos": [
        9877,
        9946
      ]
    },
    {
      "content": "All test virtual machines in a recover plan are added in a single cloud service and can connect to each other",
      "pos": [
        9952,
        10061
      ]
    },
    {
      "content": "Machines aren't connected to an Azure network after failover.",
      "pos": [
        10068,
        10129
      ]
    },
    {
      "content": "Users can connect to the test machines with a public IP address",
      "pos": [
        10136,
        10199
      ]
    },
    {
      "content": "Fail over to Azure—with network",
      "pos": [
        10206,
        10237
      ]
    },
    {
      "content": "Select a target Azure network",
      "pos": [
        10242,
        10271
      ]
    },
    {
      "content": "Failover checks that test machines are connected to the network",
      "pos": [
        10274,
        10337
      ]
    },
    {
      "content": "Create an Azure network that’s isolated from your Azure production network and set up the infrastructure for the replicated virtual machine to work as expected.",
      "pos": [
        10343,
        10503
      ]
    },
    {
      "content": "The subnet of the test virtual machine is based on subnet on which the failed over virtual machine is expected to connect to if a planned or unplanned failover occurs.",
      "pos": [
        10510,
        10677
      ]
    },
    {
      "content": "Fail over to a secondary VMM site—without network",
      "pos": [
        10684,
        10733
      ]
    },
    {
      "content": "Don't select a VM network",
      "pos": [
        10738,
        10763
      ]
    },
    {
      "content": "Failover checks that test machines are created",
      "pos": [
        10766,
        10812
      ]
    },
    {
      "content": "The test virtual machine will be created on the same host as the host on which the replica virtual machine exists.",
      "pos": [
        10816,
        10930
      ]
    },
    {
      "content": "It isn’t added to the cloud in which the replica virtual machine is located.",
      "pos": [
        10931,
        11007
      ]
    },
    {
      "content": "The failed over machine won’t be connected to any network.",
      "pos": [
        11020,
        11078
      ]
    },
    {
      "content": "The machine can be connected to a VM network after it has been created",
      "pos": [
        11085,
        11155
      ]
    },
    {
      "content": "Fail over to a secondary VMM site—with network",
      "pos": [
        11162,
        11208
      ]
    },
    {
      "content": "Select an existing VM network a",
      "pos": [
        11213,
        11244
      ]
    },
    {
      "content": "Failover checks that virtual machines are created",
      "pos": [
        11247,
        11296
      ]
    },
    {
      "content": "The test virtual machine will be created on the same host as the host on which the replica virtual machine exists.",
      "pos": [
        11302,
        11416
      ]
    },
    {
      "content": "It isn’t added to the cloud in which the replica virtual machine is located.",
      "pos": [
        11417,
        11493
      ]
    },
    {
      "content": "Create a VM network that's isolated from your production network",
      "pos": [
        11500,
        11564
      ]
    },
    {
      "content": "If you're using a VLAN-based network we recommend you create a separate logical network (not used in production) in VMM for this purpose.",
      "pos": [
        11571,
        11708
      ]
    },
    {
      "content": "This logical network is used to create VM networks for the purpose of test failover.",
      "pos": [
        11709,
        11793
      ]
    },
    {
      "content": "The logical network should be associated with at least one of the network adapters of all the Hyper-V servers hosting virtual machines.",
      "pos": [
        11800,
        11935
      ]
    },
    {
      "content": "For VLAN logical networks, the network sites you add to the logical network should be isolated.",
      "pos": [
        11942,
        12037
      ]
    },
    {
      "content": "If you’re using a Windows Network Virtualization–based logical network, Azure Site Recovery automatically creates isolated VM networks.",
      "pos": [
        12044,
        12179
      ]
    },
    {
      "content": "Fail over to a secondary VMM site—create a network",
      "pos": [
        12186,
        12236
      ]
    },
    {
      "pos": [
        12241,
        12381
      ],
      "content": "A temporary test network will be created automatically based on the setting you specify in <bpt id=\"p1\">**</bpt>Logical Network<ept id=\"p1\">**</ept> and its related network sites"
    },
    {
      "content": "Failover checks that virtual machines are created",
      "pos": [
        12384,
        12433
      ]
    },
    {
      "content": "Use this option if the recovery plan uses more than one VM network.",
      "pos": [
        12439,
        12506
      ]
    },
    {
      "content": "If you're using Windows Network Virtualization networks, this option can automatically create VM networks with the same settings (subnets and IP address pools) in the network of the replica virtual machine.",
      "pos": [
        12507,
        12713
      ]
    },
    {
      "content": "These VM networks are cleaned up automatically after the test failover is complete.",
      "pos": [
        12714,
        12797
      ]
    },
    {
      "content": "The test virtual machine will be created on the same host as the host on which the replica virtual machine exists.",
      "pos": [
        12804,
        12918
      ]
    },
    {
      "content": "It isn’t added to the cloud in which the replica virtual machine is located.",
      "pos": [
        12919,
        12995
      ]
    },
    {
      "content": "Note that:",
      "pos": [
        13001,
        13011
      ]
    },
    {
      "content": "When replicating to a secondary site, the type of network used by the replica machine doesn’t need to match the type of logical network used for test failover, but some combinations might not work.",
      "pos": [
        13016,
        13213
      ]
    },
    {
      "content": "If the replica uses DHCP and VLAN-based isolation, the VM network for the replica doesn't need a static IP address pool.",
      "pos": [
        13214,
        13334
      ]
    },
    {
      "content": "So using Windows Network Virtualization for the test failover wouldn't work because no address pools are available.",
      "pos": [
        13335,
        13450
      ]
    },
    {
      "content": "In addition test failover won't work if the replica network is No Isolation and the test network is Windows Network Virtualization.",
      "pos": [
        13451,
        13582
      ]
    },
    {
      "content": "This is because the No Isolation network doesn't have the subnets required to create a Windows Network Virtualization network.",
      "pos": [
        13583,
        13709
      ]
    },
    {
      "content": "The way in which replica virtual machines are connected to mapped VM networks after failover depends on how the VM network is configured in the VMM console:",
      "pos": [
        13712,
        13868
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>VM network configured with no isolation or VLAN isolation<ept id=\"p1\">**</ept>—If DHCP is defined for the VM network, the replica virtual machine will be connected to the VLAN ID using the settings that are specified for the network site in the associated logical network.",
      "pos": [
        13875,
        14130
      ]
    },
    {
      "content": "The virtual machine will receive its IP address from the available DHCP server.",
      "pos": [
        14131,
        14210
      ]
    },
    {
      "content": "You don't need a static IP address pool defined for the target VM network.",
      "pos": [
        14211,
        14285
      ]
    },
    {
      "content": "If a static IP address pool is used for the VM network the replica virtual machine will be connected to the VLAN ID using the settings that are specified for the network site in the associated logical network.",
      "pos": [
        14286,
        14495
      ]
    },
    {
      "content": "The virtual machine will receive its IP address from the pool defined for the VM network.",
      "pos": [
        14496,
        14585
      ]
    },
    {
      "content": "If a static IP address pool isn't defined on the target VM network, IP address allocation will fail.",
      "pos": [
        14586,
        14686
      ]
    },
    {
      "content": "The IP address pool should be created on both the source and target VMM servers that you are going to use for protection and recovery.",
      "pos": [
        14687,
        14821
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>VM network with Windows network virtualization<ept id=\"p1\">**</ept>—If a VM network is configured with this setting a static pool should be defined for the target VM network, regardless of whether the source VM network is configured to use DHCP or a static IP address pool.",
      "pos": [
        14828,
        15084
      ]
    },
    {
      "content": "If you define DHCP, the target VMM server will act as a DHCP server and provide an IP address from the pool that is defined for the target VM network.",
      "pos": [
        15085,
        15235
      ]
    },
    {
      "content": "If use of a static IP address pool is defined for the source server, the target VMM server will allocate an IP address from the pool.",
      "pos": [
        15236,
        15369
      ]
    },
    {
      "content": "In both cases, IP address allocation will fail if a static IP address pool is not defined.",
      "pos": [
        15370,
        15460
      ]
    },
    {
      "content": "Run a test failover from on-premises to Azure",
      "pos": [
        15469,
        15514
      ]
    },
    {
      "content": "This procedure describes how to run a test failover for a recovery plan.",
      "pos": [
        15516,
        15588
      ]
    },
    {
      "content": "Alternatively you can run the failover for a single machine on the <bpt id=\"p1\">**</bpt>Virtual Machines<ept id=\"p1\">**</ept> tab.",
      "pos": [
        15589,
        15681
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Recovery Plans<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">*</bpt>recoveryplan_name<ept id=\"p2\">*</ept>.",
      "pos": [
        15686,
        15734
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Failover<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Test Failover<ept id=\"p2\">**</ept>.",
      "pos": [
        15735,
        15774
      ]
    },
    {
      "pos": [
        15778,
        15899
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Confirm Test Failover<ept id=\"p1\">**</ept> page, specify how replica machines will be connected to an Azure network after failover."
    },
    {
      "pos": [
        15903,
        16104
      ],
      "content": "If you're failing over to Azure and data encryption is enabled for the cloud, in <bpt id=\"p1\">**</bpt>Encryption Key<ept id=\"p1\">**</ept> select the certificate that was issued when you enabled data encryption during Provider installation."
    },
    {
      "content": "Track failover progress on the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> tab.",
      "pos": [
        16109,
        16153
      ]
    },
    {
      "content": "You should be able to see the test replica machine in the Azure portal.",
      "pos": [
        16154,
        16225
      ]
    },
    {
      "content": "You can access replica machines in Azure from your on-premises site initiate an RDP connection to the virtual machine.",
      "pos": [
        16229,
        16347
      ]
    },
    {
      "content": "port 3389 will need to be open on the endpoint for the virtual machine.",
      "pos": [
        16348,
        16419
      ]
    },
    {
      "pos": [
        16423,
        16534
      ],
      "content": "Once you're done, When the failover reaches the <bpt id=\"p1\">**</bpt>Complete testing<ept id=\"p1\">**</ept> phase , click <bpt id=\"p2\">**</bpt>Complete Test<ept id=\"p2\">**</ept> to finish."
    },
    {
      "pos": [
        16538,
        16618
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Notes<ept id=\"p1\">**</ept> record and save any observations associated with the test failover."
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>The test failover is complete<ept id=\"p1\">**</ept> to automatically clean up the test environment.",
      "pos": [
        16622,
        16709
      ]
    },
    {
      "content": "After this is complete the test failover will show the C<bpt id=\"p1\">**</bpt>omplete<ept id=\"p1\">**</ept> status.",
      "pos": [
        16710,
        16785
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If a test failover continues for more than two weeks it'll be completed by force.",
      "pos": [
        16789,
        16883
      ]
    },
    {
      "content": "Any elements or virtual machines created automatically during the test failover will be deleted.",
      "pos": [
        16884,
        16980
      ]
    },
    {
      "content": "Example",
      "pos": [
        16989,
        16996
      ]
    },
    {
      "content": "Run an example test failover as follows:",
      "pos": [
        16998,
        17038
      ]
    },
    {
      "content": "Do a test failover of the Active Directory virtual machine and DNS virtual machine in the same network that you’ll be using for the test failover of the on-premises virtual machine.",
      "pos": [
        17043,
        17224
      ]
    },
    {
      "content": "Note the IP addresses that are allocated to these failed over machines.",
      "pos": [
        17228,
        17299
      ]
    },
    {
      "content": "In the Azure virtual network that'' be used for the test failover, add the IP addresses as the addresses of the DNS and Active Directory servers.",
      "pos": [
        17303,
        17448
      ]
    },
    {
      "content": "Do a test failover of the virtual machine, specifying the Azure network.",
      "pos": [
        17452,
        17524
      ]
    },
    {
      "content": "After validating that the test failure worked as expected, complete the failover for the virtual machines, and then for the Active Directory and DNS virtual machines.",
      "pos": [
        17528,
        17694
      ]
    },
    {
      "content": "Run a test failover from a primary on-premises site to a secondary site",
      "pos": [
        17700,
        17771
      ]
    },
    {
      "content": "You’ll need to do a number of things to run a test failover, including making a copy of Active Directory and placing test DHCP and DNS servers in your test environment.",
      "pos": [
        17773,
        17941
      ]
    },
    {
      "content": "You can do this in a couple of ways:",
      "pos": [
        17942,
        17978
      ]
    },
    {
      "content": "If you want to run a test failover using an existing network, prepare Active Directory, DHCP, and DNS in that network.",
      "pos": [
        17982,
        18100
      ]
    },
    {
      "content": "If you want to run a test failover using the option to create VM networks automatically, add manual step before Group-1 in the recovery plan you’re going to use for the test failover and then add the infrastructure resources to the automatically created network before running the test failover.",
      "pos": [
        18103,
        18398
      ]
    },
    {
      "content": "Prepare Active Directory",
      "pos": [
        18405,
        18429
      ]
    },
    {
      "content": "To run a test failover for application testing, you’ll need a copy of the production Active Directory environment in your test environment.",
      "pos": [
        18430,
        18569
      ]
    },
    {
      "content": "Here's what to do.",
      "pos": [
        18570,
        18588
      ]
    },
    {
      "pos": [
        18593,
        18680
      ],
      "content": "<bpt id=\"p1\">**</bpt>Create a copy<ept id=\"p1\">**</ept>—Create a copy of Active Directory using one of the following methods:"
    },
    {
      "content": "Hyper-V replication—You can start Active Directory replication using Hyper-V replication, just as you do for other virtual machines.",
      "pos": [
        18688,
        18820
      ]
    },
    {
      "content": "When you do a test failover of a recovery plan, you can also do a test failover of the Active Directory virtual machine.",
      "pos": [
        18821,
        18941
      ]
    },
    {
      "content": "Active Directory replication—You can use Active Directory replication to create a copy of your Active Directory installation in your replica site.",
      "pos": [
        18948,
        19094
      ]
    },
    {
      "content": "When you do a test failover of a recovery plan, you can create a copy of the Active Directory virtual machine by taking a snapshot of the replica Active Directory installation.",
      "pos": [
        19095,
        19271
      ]
    },
    {
      "content": "You can use this copy for test failover.",
      "pos": [
        19272,
        19312
      ]
    },
    {
      "content": "After the test failover is done, you can delete the copy of Active Directory.",
      "pos": [
        19313,
        19390
      ]
    },
    {
      "pos": [
        19395,
        19532
      ],
      "content": "<bpt id=\"p1\">**</bpt>Import and export<ept id=\"p1\">**</ept>—You can create a copy of an Active Directory virtual machine by exporting it and then importing it with a new GUID."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Add to the network<ept id=\"p1\">**</ept>—Add Active Directory to the network that is created by the test failover.",
      "pos": [
        19536,
        19632
      ]
    },
    {
      "content": "Note the following:",
      "pos": [
        19633,
        19652
      ]
    },
    {
      "content": "It’s important to ensure that the network to which you’re going to add Active Directory is completely isolated from your production network.",
      "pos": [
        19661,
        19801
      ]
    },
    {
      "content": "If you use a network of the Windows Network type as your test network, the system guarantees the isolation of automatically created VM networks, providing you don't add an external gateway to the network.",
      "pos": [
        19802,
        20006
      ]
    },
    {
      "content": "If you are using VLAN-based isolation, you have to ensure that the VM networks that are created are isolated from your production environment.",
      "pos": [
        20007,
        20149
      ]
    },
    {
      "content": "The sequence of steps that you might have to follow will be slightly different, depending on whether Active Directory and DNS are running on the same virtual machine or on different virtual machines:",
      "pos": [
        20156,
        20355
      ]
    },
    {
      "content": "Same virtual machine—If Active Directory and DNS are on the same virtual machine, you can use the same virtual machine as a DNS resource for the test failover.",
      "pos": [
        20366,
        20525
      ]
    },
    {
      "content": "You can choose to clean up all the entries in DNS and recreate required zones in the DNS.",
      "pos": [
        20526,
        20615
      ]
    },
    {
      "content": "Different virtual machine—If Active Directory and DNS are on different virtual machines, you’ll need to create a DNS resource for the test failover.",
      "pos": [
        20627,
        20775
      ]
    },
    {
      "content": "You can use a fresh DNS server and create all the required zones.",
      "pos": [
        20776,
        20841
      ]
    },
    {
      "content": "For example, if your Active Directory domain is contoso.com, you can create a zone with the name contoso.com.",
      "pos": [
        20842,
        20951
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Update Active Directory in DNS<ept id=\"p1\">**</ept>—In both cases, the entries corresponding to Active Directory must be updated in DNS.",
      "pos": [
        20957,
        21076
      ]
    },
    {
      "content": "Do this as follows:",
      "pos": [
        21077,
        21096
      ]
    },
    {
      "content": "Ensure the following settings are in place before any other virtual machine in the recovery plan comes up:",
      "pos": [
        21104,
        21210
      ]
    },
    {
      "content": "The zone must be named after the forest root name.",
      "pos": [
        21221,
        21271
      ]
    },
    {
      "content": "The zone must be file backed.",
      "pos": [
        21282,
        21311
      ]
    },
    {
      "content": "The zone must be enabled for secure and non-secure updates.",
      "pos": [
        21322,
        21381
      ]
    },
    {
      "content": "If Active Directory and DNS are on two separate virtual machines, the resolver of the Active Directory virtual machine should point to the IP address of the DNS virtual machine.",
      "pos": [
        21392,
        21569
      ]
    },
    {
      "content": "Run the following command in Active Directory: nltest /dsregdns.",
      "pos": [
        21576,
        21640
      ]
    },
    {
      "content": "Prepare DHCP",
      "pos": [
        21647,
        21659
      ]
    },
    {
      "content": "If the virtual machines involved in test failover use DHCP, a test DHCP server should be created within the isolated network that is created for the purpose of test failover.",
      "pos": [
        21661,
        21835
      ]
    },
    {
      "content": "Prepare DNS",
      "pos": [
        21842,
        21853
      ]
    },
    {
      "content": "Prepare a DNS server for the test failover as follows:",
      "pos": [
        21855,
        21909
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>DHCP<ept id=\"p1\">**</ept>—If virtual machines use DHCP, the IP address of the test DNS should be updated on the test DHCP server.",
      "pos": [
        21913,
        22025
      ]
    },
    {
      "content": "If you’re using a network type of Windows Network Virtualization, the VMM server acts as the DHCP server.",
      "pos": [
        22026,
        22131
      ]
    },
    {
      "content": "Therefore, the IP address of DNS should be updated in the static IP address pool that is used for test failover.",
      "pos": [
        22132,
        22244
      ]
    },
    {
      "content": "In this case, the virtual machines will register themselves to the relevant DNS Server.",
      "pos": [
        22245,
        22332
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Static address<ept id=\"p1\">**</ept>—If virtual machines use a static IP address, the IP address of the test DNS server should be updated in the static IP address pools that are used for test failover.",
      "pos": [
        22335,
        22518
      ]
    },
    {
      "content": "You’ll need to update DNS with the IP address of the test virtual machines.",
      "pos": [
        22519,
        22594
      ]
    },
    {
      "content": "You can use the following sample script for this purpose:",
      "pos": [
        22595,
        22652
      ]
    },
    {
      "pos": [
        23016,
        23148
      ],
      "content": "<bpt id=\"p1\">**</bpt>Add zone<ept id=\"p1\">**</ept>—Use the following script to add a zone on the DNS server, allow non-secure updates, and add an entry for itself to DNS:"
    },
    {
      "content": "Run test",
      "pos": [
        23434,
        23442
      ]
    },
    {
      "content": "This procedure describes how to run an unplanned failover for a recovery plan.",
      "pos": [
        23444,
        23522
      ]
    },
    {
      "content": "Alternatively you can run the failover for a single virtual machine or physical server on the <bpt id=\"p1\">**</bpt>Virtual Machines<ept id=\"p1\">**</ept> tab.",
      "pos": [
        23523,
        23642
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Recovery Plans<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">*</bpt>recoveryplan_name<ept id=\"p2\">*</ept>.",
      "pos": [
        23647,
        23695
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Failover<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Test Failover<ept id=\"p2\">**</ept>.",
      "pos": [
        23696,
        23735
      ]
    },
    {
      "pos": [
        23739,
        23863
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Confirm Test Failover<ept id=\"p1\">**</ept> page, specify how virtual machines should be connected to networks after the test failover."
    },
    {
      "content": "Track failover progress on the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> tab.",
      "pos": [
        23867,
        23911
      ]
    },
    {
      "content": "When the failover reaches the** Complete testing** phase, click <bpt id=\"p1\">**</bpt>Complete Test<ept id=\"p1\">**</ept> to finish up the test failover.",
      "pos": [
        23912,
        24025
      ]
    },
    {
      "pos": [
        24029,
        24115
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Notes<ept id=\"p1\">**</ept> to record and save any observations associated with the test failover."
    },
    {
      "content": "After it's complete verify that the virtual machines start successfully.",
      "pos": [
        24119,
        24191
      ]
    },
    {
      "content": "After verifying that virtual machines start successfully, complete the test failover to clean up the isolated environment.",
      "pos": [
        24195,
        24317
      ]
    },
    {
      "content": "If you chose to automatically create VM networks, cleanup deletes all the test virtual machines and test networks.",
      "pos": [
        24318,
        24432
      ]
    },
    {
      "content": "Note that if a test failover continues for more than two weeks it’s completed by force and any elements or virtual machines created automatically during the test failover are deleted.",
      "pos": [
        24434,
        24617
      ]
    },
    {
      "content": "Run a planned failover (primary to secondary)",
      "pos": [
        24624,
        24669
      ]
    },
    {
      "content": "This procedure describes how to run a planned failover for a recovery plan.",
      "pos": [
        24672,
        24747
      ]
    },
    {
      "content": "Alternatively you can run the failover for a single virtual machine on the <bpt id=\"p1\">**</bpt>Virtual Machines<ept id=\"p1\">**</ept> tab.",
      "pos": [
        24748,
        24848
      ]
    },
    {
      "content": "Before you start make sure all the virtual machines you want to fail over have completed initial replication.",
      "pos": [
        24853,
        24962
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Recovery Plans<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">*</bpt>recoveryplan_name<ept id=\"p2\">*</ept>.",
      "pos": [
        24966,
        25014
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Failover<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Planned Failover<ept id=\"p2\">**</ept>.",
      "pos": [
        25015,
        25057
      ]
    },
    {
      "content": "On the **Confirm Planned Failover **page, choose the source and target locations.",
      "pos": [
        25062,
        25143
      ]
    },
    {
      "content": "Note the failover direction.",
      "pos": [
        25144,
        25172
      ]
    },
    {
      "content": "If previous failovers worked as expected and all of the virtual machine servers are located on either the source or target location, the failover direction details are for information only.",
      "pos": [
        25180,
        25369
      ]
    },
    {
      "content": "If virtual machines are active on both the source and target locations, the <bpt id=\"p1\">**</bpt>Change Direction<ept id=\"p1\">**</ept> button appears.",
      "pos": [
        25377,
        25489
      ]
    },
    {
      "content": "Use this button to change and specify the direction in which the failover should occur.",
      "pos": [
        25490,
        25577
      ]
    },
    {
      "pos": [
        25582,
        25801
      ],
      "content": "If you're failing over to Azure and data encryption is enabled for the cloud, in <bpt id=\"p1\">**</bpt>Encryption Key<ept id=\"p1\">**</ept> select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server."
    },
    {
      "content": "When a planned failover begins the first step is to shut down the virtual machines to ensure no data loss.",
      "pos": [
        25806,
        25912
      ]
    },
    {
      "content": "You can follow the failover progress on the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> tab.",
      "pos": [
        25913,
        25970
      ]
    },
    {
      "content": "If an error occurs in the failover (either on a virtual machine or in a script that is included in the recovery plan), the planned failover of a recovery plan stops.",
      "pos": [
        25971,
        26136
      ]
    },
    {
      "content": "You can initiate the failover again.",
      "pos": [
        26137,
        26173
      ]
    },
    {
      "content": "After replica virtual machines are created they're in a commit pending state.",
      "pos": [
        26177,
        26254
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Commit<ept id=\"p1\">**</ept> to commit the failover.",
      "pos": [
        26255,
        26295
      ]
    },
    {
      "content": "After replication is complete the virtual machines start up at the secondary location.",
      "pos": [
        26300,
        26386
      ]
    },
    {
      "content": "Run an unplanned failover",
      "pos": [
        26392,
        26417
      ]
    },
    {
      "content": "This procedure describes how to run an unplanned failover for a recovery plan.",
      "pos": [
        26419,
        26497
      ]
    },
    {
      "content": "Alternatively you can run the failover for a single virtual machine or physical server on the <bpt id=\"p1\">**</bpt>Virtual Machines<ept id=\"p1\">**</ept> tab.",
      "pos": [
        26498,
        26617
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Recovery Plans<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">*</bpt>recoveryplan_name<ept id=\"p2\">*</ept>.",
      "pos": [
        26622,
        26670
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Failover<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Unplanned Failover<ept id=\"p2\">**</ept>.",
      "pos": [
        26671,
        26715
      ]
    },
    {
      "content": "On the **Confirm Unplanned Failover **page, choose the source and target locations.",
      "pos": [
        26720,
        26803
      ]
    },
    {
      "content": "Note the failover direction.",
      "pos": [
        26804,
        26832
      ]
    },
    {
      "content": "If previous failovers worked as expected and all of the virtual machine servers are located on either the source or target location, the failover direction details are for information only.",
      "pos": [
        26840,
        27029
      ]
    },
    {
      "content": "If virtual machines are active on both the source and target locations, the <bpt id=\"p1\">**</bpt>Change Direction<ept id=\"p1\">**</ept> button appears.",
      "pos": [
        27037,
        27149
      ]
    },
    {
      "content": "Use this button to change and specify the direction in which the failover should occur.",
      "pos": [
        27150,
        27237
      ]
    },
    {
      "pos": [
        27242,
        27461
      ],
      "content": "If you're failing over to Azure and data encryption is enabled for the cloud, in <bpt id=\"p1\">**</bpt>Encryption Key<ept id=\"p1\">**</ept> select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server."
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Shut down virtual machines and synchronize the latest data<ept id=\"p1\">**</ept> to specify that Site Recovery should try to shut down the protected virtual machines and synchronize the data so that the latest version of the data will be failed over.",
      "pos": [
        27466,
        27705
      ]
    },
    {
      "content": "If you don’t select this option or the attempt doesn’t succeed the failover will be from the latest available recovery point for the virtual machine.",
      "pos": [
        27706,
        27855
      ]
    },
    {
      "content": "You can follow the failover progress on the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> tab.",
      "pos": [
        27859,
        27916
      ]
    },
    {
      "content": "Note that even if errors occur during an unplanned failover, the recovery plan runs until it is complete.",
      "pos": [
        27917,
        28022
      ]
    },
    {
      "content": "After the failover, the virtual machines are in a <bpt id=\"p1\">**</bpt>commit pending<ept id=\"p1\">**</ept> state.",
      "pos": [
        28026,
        28101
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Commit<ept id=\"p1\">**</ept> to commit the failover.",
      "pos": [
        28102,
        28142
      ]
    },
    {
      "content": "If you set up replication to use multiple recovery points, in Change Recovery Point you can select to use a recovery point that isn't the latest (latest is used by default).",
      "pos": [
        28146,
        28319
      ]
    },
    {
      "content": "After you commit additional recovery points will be removed.",
      "pos": [
        28320,
        28380
      ]
    },
    {
      "content": "After replication is complete the virtual machines start up and are running at the secondary location.",
      "pos": [
        28384,
        28486
      ]
    },
    {
      "content": "However they aren’t protected or replicating.",
      "pos": [
        28487,
        28532
      ]
    },
    {
      "content": "When the primary site is available again with the same underlying infrastructure, click <bpt id=\"p1\">**</bpt>Reverse Replicate<ept id=\"p1\">**</ept> to begin reverse replication.",
      "pos": [
        28533,
        28672
      ]
    },
    {
      "content": "This ensures that all the data is replicated back to the primary site, and that the virtual machine is ready for failover again.",
      "pos": [
        28673,
        28801
      ]
    },
    {
      "content": "Reverse replication after an unplanned failover incurs an overhead in data transfer.",
      "pos": [
        28802,
        28886
      ]
    },
    {
      "content": "The transfer will use the same method that is configured for initial replication settings for the cloud.",
      "pos": [
        28887,
        28991
      ]
    },
    {
      "content": "Failback from secondary to primary",
      "pos": [
        28996,
        29030
      ]
    },
    {
      "content": "After failover from the primary to secondary location, replicated virtual machines aren't protected by Site Recovery, and the secondary location is now acting as the primary.",
      "pos": [
        29033,
        29207
      ]
    },
    {
      "content": "Follow these procedures to fail back to the original primary site.",
      "pos": [
        29208,
        29274
      ]
    },
    {
      "content": "This procedure describes how to run a planned failover for a recovery plan.",
      "pos": [
        29275,
        29350
      ]
    },
    {
      "content": "Alternatively you can run the failover for a single virtual machine on the <bpt id=\"p1\">**</bpt>Virtual Machines<ept id=\"p1\">**</ept> tab.",
      "pos": [
        29351,
        29451
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Recovery Plans<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">*</bpt>recoveryplan_name<ept id=\"p2\">*</ept>.",
      "pos": [
        29456,
        29504
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Failover<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Planned Failover<ept id=\"p2\">**</ept>.",
      "pos": [
        29505,
        29547
      ]
    },
    {
      "content": "On the **Confirm Planned Failover **page, choose the source and target locations.",
      "pos": [
        29551,
        29632
      ]
    },
    {
      "content": "Note the failover direction.",
      "pos": [
        29633,
        29661
      ]
    },
    {
      "content": "If the failover from primary worked as expect and all virtual machines are in the secondary location this is for information only.",
      "pos": [
        29662,
        29792
      ]
    },
    {
      "pos": [
        29796,
        29874
      ],
      "content": "If you're failing back from Azure select settings in <bpt id=\"p1\">**</bpt>Data Synchronization<ept id=\"p1\">**</ept>:"
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Synchronize the data before the failover<ept id=\"p1\">**</ept>—This option minimizes downtime for virtual machines as it synchronizes without shutting them down.",
      "pos": [
        29882,
        30025
      ]
    },
    {
      "content": "It does the following:",
      "pos": [
        30026,
        30048
      ]
    },
    {
      "content": "Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.",
      "pos": [
        30059,
        30161
      ]
    },
    {
      "content": "The machine continues running in Azure.",
      "pos": [
        30162,
        30201
      ]
    },
    {
      "content": "Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.",
      "pos": [
        30212,
        30296
      ]
    },
    {
      "content": "The final set of changes are transferred to the on-premises server and the on-premises virtual machine is started up.",
      "pos": [
        30297,
        30414
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> We recommend you use this option if you've been running Azure for a while (a month or more) This option performs synchronization without shutting down virtual machines.",
      "pos": [
        30426,
        30607
      ]
    },
    {
      "content": "It doesn't do a resynchronization, but performs a full failback.",
      "pos": [
        30608,
        30672
      ]
    },
    {
      "content": "This option doesn't perform any checksum calculations.",
      "pos": [
        30673,
        30727
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Synchronize the data during failover only<ept id=\"p1\">**</ept>—Use this option if you've only been running on Azure for a short amount of time.",
      "pos": [
        30735,
        30861
      ]
    },
    {
      "content": "this option is faster because it resynchronizes instead of doing a full failback.",
      "pos": [
        30862,
        30943
      ]
    },
    {
      "content": "It performs a fast checksum calculation and only downloads changed blocks.",
      "pos": [
        30944,
        31018
      ]
    },
    {
      "pos": [
        31023,
        31242
      ],
      "content": "If you're failing over to Azure and data encryption is enabled for the cloud, in <bpt id=\"p1\">**</bpt>Encryption Key<ept id=\"p1\">**</ept> select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server."
    },
    {
      "pos": [
        31247,
        31367
      ],
      "content": "By default the last recovery point is used, but in <bpt id=\"p1\">**</bpt>Change Recovery Point<ept id=\"p1\">**</ept> you can specify a different recovery point."
    },
    {
      "content": "Click the checkmark to start the failback.",
      "pos": [
        31372,
        31414
      ]
    },
    {
      "content": "You can follow the failover progress on the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> tab.",
      "pos": [
        31416,
        31473
      ]
    },
    {
      "content": "f you selected the option to synchronize the data before the failover, once the initial data synchronization is complete and you're ready to shut down the virtual machines in Azure, click <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> &gt;",
      "pos": [
        31478,
        31676
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Complete Failover<ept id=\"p1\">**</ept>.",
      "pos": [
        31705,
        31727
      ]
    },
    {
      "content": "This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine, and starts it.",
      "pos": [
        31728,
        31842
      ]
    },
    {
      "content": "You can now log onto the virtual machine to validate it's available as expected.",
      "pos": [
        31846,
        31926
      ]
    },
    {
      "content": "The virtual machine is in a commit pending state.",
      "pos": [
        31931,
        31980
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Commit<ept id=\"p1\">**</ept> to commit the failover.",
      "pos": [
        31981,
        32021
      ]
    },
    {
      "pos": [
        32026,
        32152
      ],
      "content": "Now in order to complete the failback click <bpt id=\"p1\">**</bpt>Reverse Replicate<ept id=\"p1\">**</ept> to start protecting the virtual machine in the primary site."
    },
    {
      "content": "Failback to an alternate location",
      "pos": [
        32159,
        32192
      ]
    },
    {
      "content": "If you've deployed protection between a <bpt id=\"p1\">[</bpt>Hyper-V site and Azure<ept id=\"p1\">](site-recovery-hyper-v-site-to-azure.md)</ept> you have to ability to failback from Azure to an alternate on-premises location.",
      "pos": [
        32194,
        32379
      ]
    },
    {
      "content": "This is useful if you need to set up new on-premises hardware.",
      "pos": [
        32380,
        32442
      ]
    },
    {
      "content": "Here's how you do it.",
      "pos": [
        32443,
        32464
      ]
    },
    {
      "content": "If you're setting up new hardware install Windows Server 2012 R2 and the Hyper-V role on the server.",
      "pos": [
        32469,
        32569
      ]
    },
    {
      "content": "Create a virtual network switch with the same name that you had on the original server.",
      "pos": [
        32573,
        32660
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Protected Items<ept id=\"p1\">**</ept> -&gt; <bpt id=\"p2\">**</bpt>Protection Group<ept id=\"p2\">**</ept> -&gt;",
      "pos": [
        32664,
        32717
      ]
    },
    {
      "content": "-&gt;",
      "pos": [
        32740,
        32742
      ]
    },
    {
      "content": "you want to fail back, and select <bpt id=\"p1\">**</bpt>Planned Failover<ept id=\"p1\">**</ept>.",
      "pos": [
        32764,
        32819
      ]
    },
    {
      "pos": [
        32823,
        32922
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Confirm Planned Failover<ept id=\"p1\">**</ept> select <bpt id=\"p2\">**</bpt>Create on-premises virtual machine if it does not exist<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        32927,
        33026
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Host Name<ept id=\"p1\">**</ept> select the new Hyper-V host server on which you want to place the virtual machine."
    },
    {
      "content": "In Data Synchronization we recommend you select  the option <bpt id=\"p1\">**</bpt>Synchronize the data before the failover<ept id=\"p1\">**</ept>.",
      "pos": [
        33030,
        33135
      ]
    },
    {
      "content": "This minimizes downtime for virtual machines as it synchronizes without shutting them down.",
      "pos": [
        33136,
        33227
      ]
    },
    {
      "content": "It does the following:",
      "pos": [
        33228,
        33250
      ]
    },
    {
      "content": "Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host.",
      "pos": [
        33258,
        33360
      ]
    },
    {
      "content": "The machine continues running in Azure.",
      "pos": [
        33361,
        33400
      ]
    },
    {
      "content": "Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there.",
      "pos": [
        33407,
        33491
      ]
    },
    {
      "content": "The final set of changes are transferred to the on-premises server and the on-premises virtual machine is started up.",
      "pos": [
        33492,
        33609
      ]
    },
    {
      "content": "Click the checkmark to begin the failover (failback).",
      "pos": [
        33618,
        33671
      ]
    },
    {
      "content": "After the initial synchronization finishes and you're ready to shut down the virtual machine in Azure, click <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> &gt;",
      "pos": [
        33675,
        33794
      ]
    },
    {
      "content": "&gt; <bpt id=\"p1\">**</bpt>Complete Failover<ept id=\"p1\">**</ept>.",
      "pos": [
        33818,
        33842
      ]
    },
    {
      "content": "This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine and starts it.",
      "pos": [
        33843,
        33956
      ]
    },
    {
      "content": "You can log onto the on-premises virtual machine to verify everything is working as expected.",
      "pos": [
        33960,
        34053
      ]
    },
    {
      "content": "Then click <bpt id=\"p1\">**</bpt>Commit<ept id=\"p1\">**</ept> to finish the failover.",
      "pos": [
        34054,
        34099
      ]
    },
    {
      "pos": [
        34104,
        34184
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Reverse Replicate<ept id=\"p1\">**</ept> to start protecting the on-premises virtual machine."
    }
  ],
  "content": "<properties\n    pageTitle=\"Failover in Site Recovery\" \n    description=\"Azure Site Recovery coordinates the replication, failover and recovery of virtual machines and physical servers. Learn about failover to Azure or a secondary datacenter.\" \n    services=\"site-recovery\" \n    documentationCenter=\"\" \n    authors=\"rayne-wiselman\" \n    manager=\"jwhit\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"site-recovery\" \n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.tgt_pltfrm=\"na\"\n    ms.workload=\"storage-backup-recovery\" \n    ms.date=\"08/05/2015\" \n    ms.author=\"raynew\"/>\n\n# Failover in Site Recovery\n\nThe [Azure Site Recovery service](site-recovery-overview.md) contributes to a robust business continuity and disaster recovery (BCDR) solution that protects your on-premises physical servers and virtual machines by orchestrating and automating replication and failover to Azure, or to a secondary on-premises datacenter. This article provides information and instructions for recovering (failing over and failing back) virtual machines and physical servers that are protected with Site Recovery. \n\nIf you have any questions after reading this article post them on the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).\n\n\n## Overview\n\nAfter you've set up protection for virtual machines and physical servers they begin replicating to the secondary location. After replication is in place you can run failovers as the need arises. Site Recovery supports a number of types of failover.\n\n**Failover** | **When to run** | **Details** | **Process**\n---|---|---|---\n**Test failover** | Run to validate your replication strategy or perform a disaster recovery drill | <p>No data loss or downtime</p><p>No impact on replication</p><p>No impact on your production environment</p> | <p>Start the failover</p><p>Specify how test machines will be connected to networks after failover</p><p>Track progress on the **Jobs** tab. Test machines are created and start in the secondary location</p><p>Azure - connect to the machine in the Azure portal</p><p>Secondary site - access the machine on the same host and cloud</p><p>Complete testing and automatically clean up test failover settings.</p>\n**Planned failover** | <p>Run to meet compliance requirements</p><p>Run for planned maintenance</p><p>Run to fail over data to keep workloads running for known outages - such as an expected power failure or severe weather reports</p> <p>Run to failback after failover from primary to secondary | <p>No data loss</p><p>Downtime is incurred during the time it takes to shut down the virtual machine on the primary and bring it up on the secondary location.</p><p>Virtual machines are impact as  target machines becomes source machines after failover.</p> | <p>Start the failover</p><p>Track progress on the **Jobs** tab. Source machines are shut down</p><p>Replica machines start in the secondary location</p><p>Azure - connect to the replica machine in the Azure portal</p><p>Secondary site - access the machine on the same host and in the same cloud</p><p>Commit the failover</p>\n**Unplanned failover** | <p>Run this type of failover reactive manner when a primary site becomes inaccessible because of an unexpected incident, such as a power outage or virus attack</p><p>You can run an unplanned failover can be done even if primary site isn't available.<p> | <p>Data loss dependent on replication frequency settings</p> <p>Data will be up-to-date in accordance with the last time it was synchronized</p> | <p>Start the failover</p><p>Track progress on the **Jobs** tab. Optionally try to shut down virtual machines and synchronize latest data</p><p>Replica machines start in the secondary location</p><p>Azure - connect to the replica machine in the Azure portal</p><p>Secondary site access the machine on the same host and in the same cloud</p><p>Commit the failover</p>\n\n\nThe types of failovers that are supported depend on your deployment scenario.\n\n**Failover direction** | **Test failover** | **Planned failover** | **Unplanned failover**\n---|---|---|---\nPrimary VMM site to Secondary VMM site | Supported | Supported | Supported \nSecondary VMM site to Primary VMM site | Supported | Supported | Supported\nCloud to Cloud (single VMM server) |  Supported | Supported | Supported\nVMM site to Azure | Supported | Supported | Supported \nAzure to VMM site | Unsupported | Supported | Unsupported \nHyper-V site to Azure | Supported | Supported | Supported\nAzure to Hyper-V site | Unsupported | Supported | Unsupported\nVMware site to Azure | Unsupported |This scenario uses continuous replication so there's no distinction between planned and unplanned failover. You select **Failover** | NA\nPhysical server to Azure | Not supported | This scenario uses continuous replication so there's no distinction between planned and unplanned failover. You select **Failover** | NA\n\n## Failover and failback\n\nYou fail over virtual machines to a secondary on-premises site or to Azure, depending on your deployment. A machine that fails over to Azure is created as an Azure virtual machine. You can fail over a single virtual machine or physical server, or a recovery plan. Recovery plans consists of one or more ordered groups that contain protected virtual machines or physical servers. They're used to orchestrate failover of multiple machines which fail over according to the group they're in. [Read more](site-recovery-create-recovery-plans.md) about recovery plans. \n\nAfter failover completes and your machines are up and running in a secondary location note that:\n\n- If you failed over to Azure, after the failover machines aren't protected or replicating in the primary or secondary location. In Azure the virtual machines are stored in geo-replicated storage which provides resiliency, but not replication.\n- If you did an unplanned failover to a secondary site, after the failover machines in the secondary location aren't protected or replicating.\n- If you did an planned failover to a secondary site, after the failover machines in the secondary location are protected.\n \n\n### Failback from secondary site\n\nFailback from a secondary site to a primary uses the same process as failover from the primary to secondary. After the failover from primary to secondary datacenter is committed and complete, you can initiate reverse replication when your primary site becomes available. Reverse replication initiates replication between the secondary site and the primary by synchronizing the delta data. Reverse replication brings the virtual machines into a protected state but the secondary datacenter is still the active location. In order to make the primary site into the active location you initiate a planned failover from secondary to primary, followed by another reverse replication.\n\n### Failback from Azure\n\nIf you've failed over to Azure your virtual machines are protected by the Azure resiliency features for virtual machines. To make the original primary site into the active location you run a planned failover. You can fail back to the original location or to an alternate location if your original site isn't available. To start replicating again after failback to the primary location you initiate a reverse replication.\n\n### Failover considerations\n\n- **IP address after failover**—By default a failed over machine will have a different IP address than the source machine. If you want to retain the same IP address see: \n    - **Secondary site**—If you're failing over to a secondary site and you want to retain an IP address [read](http://blogs.technet.com/b/scvmm/archive/2014/04/04/retaining-ip-address-after-failover-using-hyper-v-recovery-manager.aspx) this article. Note that you can retain a public IP address if your ISP supports it.\n    - **Azure**—If you're failing over to Azure you can specify the IP address you want to assign in the **Configure** tab of the virtual machine properties. You can't retain a public IP address after failover to Azure. You can retain non-RFC 1918 address spaces that are used as internal addresses.\n- **Partial failover**—If you want to fail over part of a site rather than an entire site note that: \n    - **Secondary site**—If you fail over part of a primary site to a secondary site and you want to connect back to the primary site, use a site-to-site VPN connection to connect failed over applications on the secondary site to infrastructure components running on the primary site. If an entire subnet fails over you can retain the virtual machine IP address. If you fail over a partial subnet you can't retain the virtual machine IP address because subnets can't be split between sites.\n    - **Azure**—If you fail over a partial site to Azure and want to connect back to the primary site, you can use a site-to-site VPN to connect a failed over application in Azure to infrastructure components running on the primary site. Note that if the entire subnet fails over you can retain the virtual machine IP address. If you fail over a partial subnet you can't retain the virtual machine IP address because subnets can't be split between sites.\n \n- **Drive letter**—If you want to retain the drive letter on virtual machines after failover you can set the SAN policy for the virtual machine to **On**. Virtual machine disks come online automatically. [Read more](https://technet.microsoft.com/library/gg252636.aspx).\n- **Route client requests**—Site Recovery works with Azure Traffic Manager to route client requests to your application after failover.\n\n\n\n\n## Run a test failover\n\nWhen you run a test failover you'll be asked to select network settings for test replica machines. You have a number of options.  \n\n**Test failover option** | **Description** | **Failover check** | **Details**\n---|---|---|---\n**Fail over to Azure—without network** | Don't select a target Azure network | Failover checks that test virtual machine starts as expected in Azure | <p>All test virtual machines in a recover plan are added in a single cloud service and can connect to each other</p><p>Machines aren't connected to an Azure network after failover.</p><p>Users can connect to the test machines with a public IP address</p>\n**Fail over to Azure—with network** | Select a target Azure network | Failover checks that test machines are connected to the network | <p>Create an Azure network that’s isolated from your Azure production network and set up the infrastructure for the replicated virtual machine to work as expected.</p><p>The subnet of the test virtual machine is based on subnet on which the failed over virtual machine is expected to connect to if a planned or unplanned failover occurs.</p>\n**Fail over to a secondary VMM site—without network** | Don't select a VM network | Failover checks that test machines are created <p>The test virtual machine will be created on the same host as the host on which the replica virtual machine exists. It isn’t added to the cloud in which the replica virtual machine is located.</p></p>| <p>The failed over machine won’t be connected to any network.</p><p>The machine can be connected to a VM network after it has been created</p>\n**Fail over to a secondary VMM site—with network** | Select an existing VM network a | Failover checks that virtual machines are created | <p>The test virtual machine will be created on the same host as the host on which the replica virtual machine exists. It isn’t added to the cloud in which the replica virtual machine is located.</p><p>Create a VM network that's isolated from your production network</p><p>If you're using a VLAN-based network we recommend you create a separate logical network (not used in production) in VMM for this purpose. This logical network is used to create VM networks for the purpose of test failover.</p><p>The logical network should be associated with at least one of the network adapters of all the Hyper-V servers hosting virtual machines.</p><p>For VLAN logical networks, the network sites you add to the logical network should be isolated.</p><p>If you’re using a Windows Network Virtualization–based logical network, Azure Site Recovery automatically creates isolated VM networks.</p>\n**Fail over to a secondary VMM site—create a network** | A temporary test network will be created automatically based on the setting you specify in **Logical Network** and its related network sites | Failover checks that virtual machines are created | <p>Use this option if the recovery plan uses more than one VM network. If you're using Windows Network Virtualization networks, this option can automatically create VM networks with the same settings (subnets and IP address pools) in the network of the replica virtual machine. These VM networks are cleaned up automatically after the test failover is complete.</p><p>The test virtual machine will be created on the same host as the host on which the replica virtual machine exists. It isn’t added to the cloud in which the replica virtual machine is located.</p>\n\nNote that: \n\n- When replicating to a secondary site, the type of network used by the replica machine doesn’t need to match the type of logical network used for test failover, but some combinations might not work. If the replica uses DHCP and VLAN-based isolation, the VM network for the replica doesn't need a static IP address pool. So using Windows Network Virtualization for the test failover wouldn't work because no address pools are available. In addition test failover won't work if the replica network is No Isolation and the test network is Windows Network Virtualization. This is because the No Isolation network doesn't have the subnets required to create a Windows Network Virtualization network.\n- The way in which replica virtual machines are connected to mapped VM networks after failover depends on how the VM network is configured in the VMM console:\n    - **VM network configured with no isolation or VLAN isolation**—If DHCP is defined for the VM network, the replica virtual machine will be connected to the VLAN ID using the settings that are specified for the network site in the associated logical network. The virtual machine will receive its IP address from the available DHCP server. You don't need a static IP address pool defined for the target VM network. If a static IP address pool is used for the VM network the replica virtual machine will be connected to the VLAN ID using the settings that are specified for the network site in the associated logical network. The virtual machine will receive its IP address from the pool defined for the VM network. If a static IP address pool isn't defined on the target VM network, IP address allocation will fail. The IP address pool should be created on both the source and target VMM servers that you are going to use for protection and recovery.\n    - **VM network with Windows network virtualization**—If a VM network is configured with this setting a static pool should be defined for the target VM network, regardless of whether the source VM network is configured to use DHCP or a static IP address pool. If you define DHCP, the target VMM server will act as a DHCP server and provide an IP address from the pool that is defined for the target VM network. If use of a static IP address pool is defined for the source server, the target VMM server will allocate an IP address from the pool. In both cases, IP address allocation will fail if a static IP address pool is not defined.\n\n\n\n\n### Run a test failover from on-premises to Azure\n\nThis procedure describes how to run a test failover for a recovery plan. Alternatively you can run the failover for a single machine on the **Virtual Machines** tab.\n\n1. Select **Recovery Plans** > *recoveryplan_name*. Click **Failover** > **Test Failover**.\n2. On the **Confirm Test Failover** page, specify how replica machines will be connected to an Azure network after failover.\n3. If you're failing over to Azure and data encryption is enabled for the cloud, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation. \n4. Track failover progress on the **Jobs** tab. You should be able to see the test replica machine in the Azure portal.\n5. You can access replica machines in Azure from your on-premises site initiate an RDP connection to the virtual machine. port 3389 will need to be open on the endpoint for the virtual machine.\n5. Once you're done, When the failover reaches the **Complete testing** phase , click **Complete Test** to finish.\n5. In **Notes** record and save any observations associated with the test failover.\n8. Click **The test failover is complete** to automatically clean up the test environment. After this is complete the test failover will show the C**omplete** status.\n\n> [AZURE.NOTE] If a test failover continues for more than two weeks it'll be completed by force. Any elements or virtual machines created automatically during the test failover will be deleted.\n  \n#### Example\n\nRun an example test failover as follows:\n\n1. Do a test failover of the Active Directory virtual machine and DNS virtual machine in the same network that you’ll be using for the test failover of the on-premises virtual machine.\n2. Note the IP addresses that are allocated to these failed over machines.\n3. In the Azure virtual network that'' be used for the test failover, add the IP addresses as the addresses of the DNS and Active Directory servers.\n4. Do a test failover of the virtual machine, specifying the Azure network.\n5. After validating that the test failure worked as expected, complete the failover for the virtual machines, and then for the Active Directory and DNS virtual machines.\n\n### Run a test failover from a primary on-premises site to a secondary site\n\nYou’ll need to do a number of things to run a test failover, including making a copy of Active Directory and placing test DHCP and DNS servers in your test environment. You can do this in a couple of ways:\n\n- If you want to run a test failover using an existing network, prepare Active Directory, DHCP, and DNS in that network.\n- If you want to run a test failover using the option to create VM networks automatically, add manual step before Group-1 in the recovery plan you’re going to use for the test failover and then add the infrastructure resources to the automatically created network before running the test failover.\n\n#### Prepare Active Directory\nTo run a test failover for application testing, you’ll need a copy of the production Active Directory environment in your test environment. Here's what to do.\n\n1. **Create a copy**—Create a copy of Active Directory using one of the following methods:\n\n    - Hyper-V replication—You can start Active Directory replication using Hyper-V replication, just as you do for other virtual machines. When you do a test failover of a recovery plan, you can also do a test failover of the Active Directory virtual machine.\n    - Active Directory replication—You can use Active Directory replication to create a copy of your Active Directory installation in your replica site. When you do a test failover of a recovery plan, you can create a copy of the Active Directory virtual machine by taking a snapshot of the replica Active Directory installation. You can use this copy for test failover. After the test failover is done, you can delete the copy of Active Directory.\n\n2. **Import and export**—You can create a copy of an Active Directory virtual machine by exporting it and then importing it with a new GUID.\n3. **Add to the network**—Add Active Directory to the network that is created by the test failover. Note the following: \n\n    - It’s important to ensure that the network to which you’re going to add Active Directory is completely isolated from your production network. If you use a network of the Windows Network type as your test network, the system guarantees the isolation of automatically created VM networks, providing you don't add an external gateway to the network. If you are using VLAN-based isolation, you have to ensure that the VM networks that are created are isolated from your production environment.\n    - The sequence of steps that you might have to follow will be slightly different, depending on whether Active Directory and DNS are running on the same virtual machine or on different virtual machines:\n        - Same virtual machine—If Active Directory and DNS are on the same virtual machine, you can use the same virtual machine as a DNS resource for the test failover. You can choose to clean up all the entries in DNS and recreate required zones in the DNS. \n        - Different virtual machine—If Active Directory and DNS are on different virtual machines, you’ll need to create a DNS resource for the test failover. You can use a fresh DNS server and create all the required zones. For example, if your Active Directory domain is contoso.com, you can create a zone with the name contoso.com. \n\n4. **Update Active Directory in DNS**—In both cases, the entries corresponding to Active Directory must be updated in DNS. Do this as follows:\n\n    - Ensure the following settings are in place before any other virtual machine in the recovery plan comes up:\n        - The zone must be named after the forest root name.\n        - The zone must be file backed.\n        - The zone must be enabled for secure and non-secure updates.\n        - If Active Directory and DNS are on two separate virtual machines, the resolver of the Active Directory virtual machine should point to the IP address of the DNS virtual machine.\n    - Run the following command in Active Directory: nltest /dsregdns.\n\n#### Prepare DHCP\n\nIf the virtual machines involved in test failover use DHCP, a test DHCP server should be created within the isolated network that is created for the purpose of test failover.\n\n#### Prepare DNS\n\nPrepare a DNS server for the test failover as follows:\n\n- **DHCP**—If virtual machines use DHCP, the IP address of the test DNS should be updated on the test DHCP server. If you’re using a network type of Windows Network Virtualization, the VMM server acts as the DHCP server. Therefore, the IP address of DNS should be updated in the static IP address pool that is used for test failover. In this case, the virtual machines will register themselves to the relevant DNS Server.\n- **Static address**—If virtual machines use a static IP address, the IP address of the test DNS server should be updated in the static IP address pools that are used for test failover. You’ll need to update DNS with the IP address of the test virtual machines. You can use the following sample script for this purpose: \n\n        Param(\n        [string]$Zone,\n        [string]$name,\n        [string]$IP\n        )\n        $Record = Get-DnsServerResourceRecord -ZoneName $zone -Name $name\n        $newrecord = $record.clone()\n        $newrecord.RecordData[0].IPv4Address  =  $IP\n        Set-DnsServerResourceRecord -zonename $zone -OldInputObject $record -NewInputObject $Newrecord\n\n- **Add zone**—Use the following script to add a zone on the DNS server, allow non-secure updates, and add an entry for itself to DNS:\n\n        dnscmd /zoneadd contoso.com  /Primary \n        dnscmd /recordadd contoso.com  contoso.com. SOA %computername%.contoso.com. hostmaster. 1 15 10 1 1 \n        dnscmd /recordadd contoso.com %computername%  A <IP_OF_DNS_VM> \n        dnscmd /config contoso.com /allowupdate 1\n\n#### Run test\n\nThis procedure describes how to run an unplanned failover for a recovery plan. Alternatively you can run the failover for a single virtual machine or physical server on the **Virtual Machines** tab.\n\n1. Select **Recovery Plans** > *recoveryplan_name*. Click **Failover** > **Test Failover**.\n2. On the **Confirm Test Failover** page, specify how virtual machines should be connected to networks after the test failover.\n3. Track failover progress on the **Jobs** tab. When the failover reaches the** Complete testing** phase, click **Complete Test** to finish up the test failover.\n4. Click **Notes** to record and save any observations associated with the test failover.\n4. After it's complete verify that the virtual machines start successfully.\n5. After verifying that virtual machines start successfully, complete the test failover to clean up the isolated environment. If you chose to automatically create VM networks, cleanup deletes all the test virtual machines and test networks.\n\nNote that if a test failover continues for more than two weeks it’s completed by force and any elements or virtual machines created automatically during the test failover are deleted.  \n\n## Run a planned failover (primary to secondary)\n\n This procedure describes how to run a planned failover for a recovery plan. Alternatively you can run the failover for a single virtual machine on the **Virtual Machines** tab.\n\n1. Before you start make sure all the virtual machines you want to fail over have completed initial replication.\n2. Select **Recovery Plans** > *recoveryplan_name*. Click **Failover** > **Planned Failover**. \n3. On the **Confirm Planned Failover **page, choose the source and target locations. Note the failover direction.\n\n    - If previous failovers worked as expected and all of the virtual machine servers are located on either the source or target location, the failover direction details are for information only. \n    - If virtual machines are active on both the source and target locations, the **Change Direction** button appears. Use this button to change and specify the direction in which the failover should occur.\n\n5. If you're failing over to Azure and data encryption is enabled for the cloud, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server. \n6. When a planned failover begins the first step is to shut down the virtual machines to ensure no data loss. You can follow the failover progress on the **Jobs** tab. If an error occurs in the failover (either on a virtual machine or in a script that is included in the recovery plan), the planned failover of a recovery plan stops. You can initiate the failover again.\n8. After replica virtual machines are created they're in a commit pending state. Click **Commit** to commit the failover. \n9. After replication is complete the virtual machines start up at the secondary location. \n\n## Run an unplanned failover\n\nThis procedure describes how to run an unplanned failover for a recovery plan. Alternatively you can run the failover for a single virtual machine or physical server on the **Virtual Machines** tab.\n\n1. Select **Recovery Plans** > *recoveryplan_name*. Click **Failover** > **Unplanned Failover**. \n3. On the **Confirm Unplanned Failover **page, choose the source and target locations. Note the failover direction.\n\n    - If previous failovers worked as expected and all of the virtual machine servers are located on either the source or target location, the failover direction details are for information only. \n    - If virtual machines are active on both the source and target locations, the **Change Direction** button appears. Use this button to change and specify the direction in which the failover should occur.\n\n4. If you're failing over to Azure and data encryption is enabled for the cloud, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server. \n5. Select **Shut down virtual machines and synchronize the latest data** to specify that Site Recovery should try to shut down the protected virtual machines and synchronize the data so that the latest version of the data will be failed over. If you don’t select this option or the attempt doesn’t succeed the failover will be from the latest available recovery point for the virtual machine.\n6. You can follow the failover progress on the **Jobs** tab. Note that even if errors occur during an unplanned failover, the recovery plan runs until it is complete.\n7. After the failover, the virtual machines are in a **commit pending** state. Click **Commit** to commit the failover.\n8. If you set up replication to use multiple recovery points, in Change Recovery Point you can select to use a recovery point that isn't the latest (latest is used by default). After you commit additional recovery points will be removed.\n9. After replication is complete the virtual machines start up and are running at the secondary location. However they aren’t protected or replicating. When the primary site is available again with the same underlying infrastructure, click **Reverse Replicate** to begin reverse replication. This ensures that all the data is replicated back to the primary site, and that the virtual machine is ready for failover again. Reverse replication after an unplanned failover incurs an overhead in data transfer. The transfer will use the same method that is configured for initial replication settings for the cloud.\n\n## Failback from secondary to primary\n\n After failover from the primary to secondary location, replicated virtual machines aren't protected by Site Recovery, and the secondary location is now acting as the primary. Follow these procedures to fail back to the original primary site. This procedure describes how to run a planned failover for a recovery plan. Alternatively you can run the failover for a single virtual machine on the **Virtual Machines** tab.\n\n1. Select **Recovery Plans** > *recoveryplan_name*. Click **Failover** > **Planned Failover**.\n2. On the **Confirm Planned Failover **page, choose the source and target locations. Note the failover direction. If the failover from primary worked as expect and all virtual machines are in the secondary location this is for information only.\n3. If you're failing back from Azure select settings in **Data Synchronization**:\n\n    - **Synchronize the data before the failover**—This option minimizes downtime for virtual machines as it synchronizes without shutting them down. It does the following:\n        - Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host. The machine continues running in Azure.\n        - Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there. The final set of changes are transferred to the on-premises server and the on-premises virtual machine is started up.\n    \n    > [AZURE.NOTE] We recommend you use this option if you've been running Azure for a while (a month or more) This option performs synchronization without shutting down virtual machines. It doesn't do a resynchronization, but performs a full failback. This option doesn't perform any checksum calculations.\n\n    - **Synchronize the data during failover only**—Use this option if you've only been running on Azure for a short amount of time. this option is faster because it resynchronizes instead of doing a full failback. It performs a fast checksum calculation and only downloads changed blocks.\n\n5. If you're failing over to Azure and data encryption is enabled for the cloud, in **Encryption Key** select the certificate that was issued when you enabled data encryption during Provider installation on the VMM server. \n5. By default the last recovery point is used, but in **Change Recovery Point** you can specify a different recovery point. \n6. Click the checkmark to start the failback.  You can follow the failover progress on the **Jobs** tab. \n7. f you selected the option to synchronize the data before the failover, once the initial data synchronization is complete and you're ready to shut down the virtual machines in Azure, click **Jobs** > <planned failover job name> **Complete Failover**. This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine, and starts it.\n8. You can now log onto the virtual machine to validate it's available as expected. \n9. The virtual machine is in a commit pending state. Click **Commit** to commit the failover.\n10. Now in order to complete the failback click **Reverse Replicate** to start protecting the virtual machine in the primary site.\n\n\n\n## Failback to an alternate location\n\nIf you've deployed protection between a [Hyper-V site and Azure](site-recovery-hyper-v-site-to-azure.md) you have to ability to failback from Azure to an alternate on-premises location. This is useful if you need to set up new on-premises hardware. Here's how you do it.\n\n1. If you're setting up new hardware install Windows Server 2012 R2 and the Hyper-V role on the server.\n2. Create a virtual network switch with the same name that you had on the original server.\n3. Select **Protected Items** -> **Protection Group** -> <ProtectionGroupName> -> <VirtualMachineName> you want to fail back, and select **Planned Failover**.\n4. In **Confirm Planned Failover** select **Create on-premises virtual machine if it does not exist**. \n5. In **Host Name** select the new Hyper-V host server on which you want to place the virtual machine.\n6. In Data Synchronization we recommend you select  the option **Synchronize the data before the failover**. This minimizes downtime for virtual machines as it synchronizes without shutting them down. It does the following:\n\n    - Phase 1: Takes snapshot of the virtual machine in Azure and copies it to the on-premises Hyper-V host. The machine continues running in Azure.\n    - Phase 2: Shuts down the virtual machine in Azure so that no new changes occur there. The final set of changes are transferred to the on-premises server and the on-premises virtual machine is started up.\n    \n7. Click the checkmark to begin the failover (failback).\n8. After the initial synchronization finishes and you're ready to shut down the virtual machine in Azure, click **Jobs** > <planned failover job> > **Complete Failover**. This shuts down the Azure machine, transfers the latest changes to the on-premises virtual machine and starts it.\n9. You can log onto the on-premises virtual machine to verify everything is working as expected. Then click **Commit** to finish the failover.\n10. Click **Reverse Replicate** to start protecting the on-premises virtual machine.\n\n "
}