{
  "nodes": [
    {
      "content": "Create your first search solution using Azure Search",
      "pos": [
        28,
        80
      ]
    },
    {
      "content": "Create your first search solution using Azure Search",
      "pos": [
        100,
        152
      ]
    },
    {
      "content": "Create your first search solution using Azure Search",
      "pos": [
        460,
        512
      ]
    },
    {
      "content": "This sample demonstrates a search application for the Adventure Works bicycle company.",
      "pos": [
        514,
        600
      ]
    },
    {
      "content": "After completing this tutorial, you’ll have an online product catalog with a rich search experience that includes faceted navigation, multiple sort options for your search results, and type-ahead query suggestions.",
      "pos": [
        601,
        815
      ]
    },
    {
      "content": "The demo gets you started with Azure Search by walking you through these exercises:",
      "pos": [
        828,
        911
      ]
    },
    {
      "content": "Create an Azure Search index.",
      "pos": [
        917,
        946
      ]
    },
    {
      "content": "Load documents (data) into the Azure Search index from a SQL Server database.",
      "pos": [
        951,
        1028
      ]
    },
    {
      "content": "Build an ASP.NET MVC4 Application that utilizes Azure Search to:",
      "pos": [
        1033,
        1097
      ]
    },
    {
      "content": "Search and display results from an Azure Search index",
      "pos": [
        1106,
        1159
      ]
    },
    {
      "content": "Show type-ahead suggestions in a Search box while entering a search term",
      "pos": [
        1168,
        1240
      ]
    },
    {
      "content": "Filter search results using faceting",
      "pos": [
        1249,
        1285
      ]
    },
    {
      "content": "Prerequisites",
      "pos": [
        1310,
        1323
      ]
    },
    {
      "content": "An <bpt id=\"p1\">[</bpt>Azure subscription<ept id=\"p1\">](../includes/free-trial-note.md)</ept>.",
      "pos": [
        1329,
        1385
      ]
    },
    {
      "content": "If you aren't ready to sign up for a trial subscription, you can skip this tutorial and opt for <bpt id=\"p1\">[</bpt>Try Azure App Service<ept id=\"p1\">](https://tryappservice.azure.com/)</ept> instead.",
      "pos": [
        1386,
        1548
      ]
    },
    {
      "content": "This alternative option gives you Azure Search with an ASP.NET Web app for free - one hour per session - no subscription required.",
      "pos": [
        1549,
        1679
      ]
    },
    {
      "content": "Visual Studio 2012 or higher with ASP.NET MVC 4 and SQL Server installed.",
      "pos": [
        1684,
        1757
      ]
    },
    {
      "content": "You can download the free Express editions if you don't already have the software installed: <bpt id=\"p1\">[</bpt>Visual Studio 2013 Express<ept id=\"p1\">](http://www.visualstudio.com/products/visual-studio-express-vs.aspx)</ept> and <bpt id=\"p2\">[</bpt>Microsoft SQL Server 2014 Express<ept id=\"p2\">](http://msdn.microsoft.com/evalcenter/dn434042.aspx)</ept>.",
      "pos": [
        1758,
        2040
      ]
    },
    {
      "content": "An Azure Search service.",
      "pos": [
        2045,
        2069
      ]
    },
    {
      "content": "You'll need the Search service name, plus the admin key.",
      "pos": [
        2070,
        2126
      ]
    },
    {
      "content": "See <bpt id=\"p1\">[</bpt>Create an Azure Search service in the portal<ept id=\"p1\">](search-create-service-portal.md)</ept> for details.",
      "pos": [
        2127,
        2223
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Adventure Works Azure Search Demo project on CodePlex<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkID=510972)</ept>.",
      "pos": [
        2228,
        2333
      ]
    },
    {
      "content": "On the Source tab, click <bpt id=\"p1\">**</bpt>Download<ept id=\"p1\">**</ept> to get a zip file of the solution.",
      "pos": [
        2334,
        2406
      ]
    },
    {
      "content": "This solution contains two projects:",
      "pos": [
        2423,
        2459
      ]
    },
    {
      "pos": [
        2465,
        2580
      ],
      "content": "<bpt id=\"p1\">**</bpt>CatalogIndex<ept id=\"p1\">**</ept> creates an Azure Search index and loads data from a SQL Server database included with the project."
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>AdventureWorksWeb<ept id=\"p1\">**</ept> is an MVC4-based application that queries the Azure Search index.",
      "pos": [
        2585,
        2672
      ]
    },
    {
      "content": "This tutorial assumes that you have a working knowledge of ASP.NET MVC.",
      "pos": [
        2673,
        2744
      ]
    },
    {
      "content": "Create an Azure Search index",
      "pos": [
        2768,
        2796
      ]
    },
    {
      "pos": [
        2798,
        2949
      ],
      "content": "In this step, you will use <bpt id=\"p1\">**</bpt>CatalogIndex<ept id=\"p1\">**</ept> to create a new Azure Search index called \"catalog\" based on data in an AdventureWorks SQL Server database."
    },
    {
      "pos": [
        2955,
        3048
      ],
      "content": "In Visual Studio, open up the Azure Search Demo solution named <bpt id=\"p1\">**</bpt>AdventureWorksCatalog.sln<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        3055,
        3245
      ],
      "content": "Right-click <bpt id=\"p1\">**</bpt>CatalogIndexer<ept id=\"p1\">**</ept> in Solution Explorer and select <bpt id=\"p2\">**</bpt>Set as startup project<ept id=\"p2\">**</ept> so that this application runs, rather than the <bpt id=\"p3\">**</bpt>AdventureWorksWeb<ept id=\"p3\">**</ept> project, when you press <bpt id=\"p4\">**</bpt>F5<ept id=\"p4\">**</ept>."
    },
    {
      "content": "Open <bpt id=\"p1\">**</bpt>App.config<ept id=\"p1\">**</ept> in this project and update the values for \"SearchServiceName\" and \"SearchServiceApiKey\" to those of your Azure Search service.",
      "pos": [
        3250,
        3396
      ]
    },
    {
      "content": "For Search service name, if your service is \"mysearch.search.windows.net\", you would enter \"mysearch\".",
      "pos": [
        3397,
        3499
      ]
    },
    {
      "content": "Optionally, App.config includes an entry for \"SourceSqlConnectionString\" that assumes SQL Server 2014 Express LocalDB (Server=(LocalDB)\\v11.0).",
      "pos": [
        3504,
        3647
      ]
    },
    {
      "content": "If you’re using a different edition of SQL Server, update the server name accordingly.",
      "pos": [
        3648,
        3734
      ]
    },
    {
      "content": "For example, if you have a local default instance, you can use (local) or localhost.",
      "pos": [
        3735,
        3819
      ]
    },
    {
      "pos": [
        3824,
        3844
      ],
      "content": "Save <bpt id=\"p1\">**</bpt>App.config<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        3849,
        3884
      ],
      "content": "Press <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> to launch the project."
    },
    {
      "content": "A command prompt should open with the following text: \"Creating index...\"",
      "pos": [
        3886,
        3959
      ]
    },
    {
      "content": "After a few moments, it should complete with the text: \"Complete.",
      "pos": [
        3961,
        4026
      ]
    },
    {
      "content": "Press",
      "pos": [
        4028,
        4033
      ]
    },
    {
      "content": "to continue:\"",
      "pos": [
        4042,
        4055
      ]
    },
    {
      "content": "Press <bpt id=\"p1\">**</bpt>Enter<ept id=\"p1\">**</ept> to close the application.",
      "pos": [
        4068,
        4109
      ]
    },
    {
      "content": "At this point, you have successfully created the Azure Search index.",
      "pos": [
        4110,
        4178
      ]
    },
    {
      "pos": [
        4183,
        4671
      ],
      "content": "[AZURE.NOTE] If you get errors that include \"invalid value for key 'attachdbfilename'\" or some other database attachment error, you might be running into UAC conflicts. For the purposes of this demo, work around these errors by doing the following: \nCopy the solution to a new or existing folder (such as Temp) that provides access to authenticated users. \nUse **Run as Administrator** to start Visual Studio. \nOpen the solution, build it, and then press **F5** to create the index.",
      "leadings": [
        "",
        "> ",
        "> ",
        "> "
      ],
      "nodes": [
        {
          "content": "[AZURE.NOTE] If you get errors that include \"invalid value for key 'attachdbfilename'\" or some other database attachment error, you might be running into UAC conflicts. For the purposes of this demo, work around these errors by doing the following:",
          "pos": [
            0,
            248
          ],
          "nodes": [
            {
              "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you get errors that include \"invalid value for key 'attachdbfilename'\" or some other database attachment error, you might be running into UAC conflicts.",
              "pos": [
                0,
                168
              ]
            },
            {
              "content": "For the purposes of this demo, work around these errors by doing the following:",
              "pos": [
                169,
                248
              ]
            }
          ]
        },
        {
          "content": "Copy the solution to a new or existing folder (such as Temp) that provides access to authenticated users.",
          "pos": [
            250,
            355
          ]
        },
        {
          "content": "Use <bpt id=\"p1\">**</bpt>Run as Administrator<ept id=\"p1\">**</ept> to start Visual Studio.",
          "pos": [
            357,
            409
          ]
        },
        {
          "content": "Open the solution, build it, and then press <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> to create the index.",
          "pos": [
            411,
            482
          ]
        }
      ]
    },
    {
      "content": "To verify index creation and document upload, go to your Search service dashboard in the <bpt id=\"p1\">[</bpt>Azure management portal<ept id=\"p1\">](https://portal.azure.com)</ept>.",
      "pos": [
        4673,
        4814
      ]
    },
    {
      "content": "In Usage, the index count should be up by one, and you should have 294 documents, one for each product in the database.",
      "pos": [
        4815,
        4934
      ]
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Indexes<ept id=\"p1\">**</ept> tile to show the index list.",
      "pos": [
        4936,
        4986
      ]
    },
    {
      "content": "The indexes list slides out to show the new index and document count.",
      "pos": [
        4987,
        5056
      ]
    },
    {
      "content": "Note that you can have up to three indexes at the Free pricing tier.",
      "pos": [
        5057,
        5125
      ]
    },
    {
      "content": "If you already had three indexes, you would need to delete one to free up space for any new ones.",
      "pos": [
        5126,
        5223
      ]
    },
    {
      "content": "Explore CatalogIndexer",
      "pos": [
        5259,
        5281
      ]
    },
    {
      "pos": [
        5283,
        5369
      ],
      "content": "Let’s take a closer look at the <bpt id=\"p1\">**</bpt>CatalogIndexer<ept id=\"p1\">**</ept> project to understand how it works."
    },
    {
      "pos": [
        5375,
        5467
      ],
      "content": "Open <bpt id=\"p1\">**</bpt>Program.cs<ept id=\"p1\">**</ept> from the Solution Explorer and go to the <ph id=\"ph1\">`Main(string[] args)`</ph> function."
    },
    {
      "pos": [
        5473,
        5701
      ],
      "content": "Notice how this function builds up a Uri called <ph id=\"ph1\">`_serviceURI`</ph> based on your specific Azure Search service and then creates an HttpClient called <ph id=\"ph2\">`_httpClient`</ph> that makes use of your API Key to authenticate to this Search service."
    },
    {
      "pos": [
        5707,
        5843
      ],
      "content": "<ph id=\"ph1\">`ChangeEnumeratorSql`</ph> and <ph id=\"ph2\">`ChangeSet`</ph> are used to enumerate the data from the Products table in your SQL Server AdventureWorks database."
    },
    {
      "pos": [
        5850,
        5979
      ],
      "content": "Based on the data that is collected from this table, <ph id=\"ph1\">`ApplyChanges`</ph> is then called to apply this data to your Azure Search index."
    },
    {
      "content": "Move to <ph id=\"ph1\">`ApplyChanges`</ph> in the same file.",
      "pos": [
        5985,
        6025
      ]
    },
    {
      "content": "Notice how this function deletes the index if it already exists (<ph id=\"ph1\">`DeleteCatalogIndex`</ph>) and then creates a new index called \"catalog\" (<ph id=\"ph2\">`CreateCatalogIndex`</ph>).",
      "pos": [
        6026,
        6182
      ]
    },
    {
      "content": "Move to the <ph id=\"ph1\">`CreateCatalogIndex`</ph> function, and notice how the index is created with a schema that matches the columns from the Products table in SQL Server.",
      "pos": [
        6190,
        6346
      ]
    },
    {
      "content": "Each field has a Type (i.e., <ph id=\"ph1\">`Edm.String`</ph> or <ph id=\"ph2\">`Edm.Double`</ph>) as well as attributes that define what these fields are used for.",
      "pos": [
        6347,
        6471
      ]
    },
    {
      "content": "Refer to the <bpt id=\"p1\">[</bpt>Azure Search REST API documentation<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn798935.aspx)</ept> for more details on these attributes.",
      "pos": [
        6472,
        6615
      ]
    },
    {
      "content": "Go back to the <ph id=\"ph1\">`ApplyChanges`</ph> function.",
      "pos": [
        6621,
        6660
      ]
    },
    {
      "content": "Notice how this function loops through all of the data in the enumerated changes <ph id=\"ph1\">`ChangeSet`</ph>.",
      "pos": [
        6661,
        6754
      ]
    },
    {
      "content": "Rather than applying the changes one by one, they are batched into groups of 1000 and then applied to the Search service.",
      "pos": [
        6755,
        6876
      ]
    },
    {
      "content": "This is much more efficient than applying the documents one by one.",
      "pos": [
        6877,
        6944
      ]
    },
    {
      "content": "Now that you've seen how to create and populate an index using relational data from SQL Server, let’s take a look at how to build a product catalog that uses our search data.",
      "pos": [
        6946,
        7120
      ]
    },
    {
      "content": "Build an MVC4 Application using Azure Search",
      "pos": [
        7144,
        7188
      ]
    },
    {
      "content": "In this step, you’ll build and run the search application in a web browser.",
      "pos": [
        7190,
        7265
      ]
    },
    {
      "pos": [
        7271,
        7364
      ],
      "content": "In Visual Studio, open up the Azure Search Demo Solution named <bpt id=\"p1\">**</bpt>AdventureWorksCatalog.sln<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        7372,
        7469
      ],
      "content": "Right-click <bpt id=\"p1\">**</bpt>AdventureWorksWeb<ept id=\"p1\">**</ept> in the Solution Explorer and select <bpt id=\"p2\">**</bpt>Set as startup project<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Open <bpt id=\"p1\">**</bpt>Web.config<ept id=\"p1\">**</ept> in this project and update the values for \"SearchServiceName\" and \"SearchServiceApiKey\" to those of your Azure Search service.",
      "pos": [
        7475,
        7621
      ]
    },
    {
      "content": "For Search service name, if your service is \"mysearch.search.windows.net\", you would enter \"mysearch\".",
      "pos": [
        7622,
        7724
      ]
    },
    {
      "pos": [
        7730,
        7750
      ],
      "content": "Save <bpt id=\"p1\">**</bpt>Web.config<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Press <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> to launch the project.",
      "pos": [
        7756,
        7791
      ]
    },
    {
      "content": "Follow these <bpt id=\"p1\">[</bpt>Troubleshooting<ept id=\"p1\">](#err-mvc)</ept> steps if you get a build error.",
      "pos": [
        7792,
        7864
      ]
    },
    {
      "pos": [
        7884,
        7960
      ],
      "content": "Leave the search box empty, and click <bpt id=\"p1\">**</bpt>Search<ept id=\"p1\">**</ept> to return all 294 products."
    },
    {
      "content": "Notice the list of facets along on the left side.",
      "pos": [
        7966,
        8015
      ]
    },
    {
      "content": "Try clicking one of the facets.",
      "pos": [
        8016,
        8047
      ]
    },
    {
      "content": "Search is re-executed, but this time it adds the facet you chose to filter the results.",
      "pos": [
        8048,
        8135
      ]
    },
    {
      "content": "You may want to add a breakpoint to the first line in the <bpt id=\"p1\">**</bpt>HomeController.cs<ept id=\"p1\">**</ept> <ph id=\"ph1\">`Search`</ph> function to step through (F11) each line.",
      "pos": [
        8136,
        8266
      ]
    },
    {
      "content": "Enter a search term, such as \"mountain bikes\".",
      "pos": [
        8272,
        8318
      ]
    },
    {
      "content": "As you type, notice the drop-down list of suggested queries.",
      "pos": [
        8319,
        8379
      ]
    },
    {
      "content": "The screenshot from the start of this demo appears again below, as a reminder of what was covered.",
      "pos": [
        8394,
        8492
      ]
    },
    {
      "content": "In the previous sections, we discussed faceted navigation (on the left), the document count at the top of the page, suggestions, and the sort options for sorting by relevance, list, or price.",
      "pos": [
        8493,
        8684
      ]
    },
    {
      "content": "Explore AdventureWorksWeb",
      "pos": [
        8720,
        8745
      ]
    },
    {
      "content": "The project AdventureWorksWeb shows us how ASP.NET MVC 4 can be used to interact with Azure Search from a web application.",
      "pos": [
        8747,
        8869
      ]
    },
    {
      "content": "In this section, we’ll review individual parts of the application code to see what they do.",
      "pos": [
        8870,
        8961
      ]
    },
    {
      "pos": [
        8967,
        9065
      ],
      "content": "In Solution Explorer, expand <bpt id=\"p1\">**</bpt>AdventureWorksWeb<ept id=\"p1\">**</ept> | <bpt id=\"p2\">**</bpt>Controller<ept id=\"p2\">**</ept> and open <bpt id=\"p3\">**</bpt>HomeController.cs<ept id=\"p3\">**</ept>"
    },
    {
      "content": "This is the MVC controller that manages the interaction from the Index view.",
      "pos": [
        9071,
        9147
      ]
    },
    {
      "content": "At the top of the controller, you will notice a reference to <ph id=\"ph1\">`CatalogSearch _catalogSearch`</ph> which creates a HttpClient connection object to your Azure Search service.",
      "pos": [
        9149,
        9315
      ]
    },
    {
      "content": "The code for this <ph id=\"ph1\">`CatalogSearch`</ph> is located in <bpt id=\"p1\">**</bpt>CatalogSeach.cs<ept id=\"p1\">**</ept>",
      "pos": [
        9316,
        9383
      ]
    },
    {
      "pos": [
        9388,
        9447
      ],
      "content": "Within <bpt id=\"p1\">**</bpt>HomeController.cs<ept id=\"p1\">**</ept>, there are two main functions:"
    },
    {
      "pos": [
        9453,
        9628
      ],
      "content": "<bpt id=\"p1\">**</bpt>Search<ept id=\"p1\">**</ept>: When the user clicks on the search button or chooses a facet, this function is called to retrieve the results and send them back to the Index view to be displayed."
    },
    {
      "pos": [
        9634,
        9792
      ],
      "content": "<bpt id=\"p1\">**</bpt>Suggest<ept id=\"p1\">**</ept>: As the user is typing in the Search box, this function is called to return a list of suggestions based on the content in your Azure Search index."
    },
    {
      "content": "Let’s drill into these two functions in more detail.",
      "pos": [
        9794,
        9846
      ]
    },
    {
      "content": "In <bpt id=\"p1\">**</bpt>HomeController.cs<ept id=\"p1\">**</ept> <ph id=\"ph1\">`Search`</ph> function, you will notice a call to <ph id=\"ph2\">`_catalogSearch.Search`</ph>, which includes the connection object to your Azure Search service.",
      "pos": [
        9854,
        10015
      ]
    },
    {
      "content": "When you call the Search function located in <bpt id=\"p1\">**</bpt>CatalogSearch.cs<ept id=\"p1\">**</ept>, you can see that it utilizes these parameters to build out an Azure Search query.",
      "pos": [
        10016,
        10164
      ]
    },
    {
      "content": "The results of the query are stored in a JSON object called <ph id=\"ph1\">`result`</ph> and then passed back to the <ph id=\"ph2\">`Index`</ph> view where the results are parsed and displayed in the web page.",
      "pos": [
        10165,
        10334
      ]
    },
    {
      "pos": [
        10340,
        10443
      ],
      "content": "Open <bpt id=\"p1\">**</bpt>Index.cshtml<ept id=\"p1\">**</ept> under Views | Home, you will notice the code that is used to parse these results."
    },
    {
      "content": "Stop the application if it’s still running, and open <bpt id=\"p1\">**</bpt>Index.cshtml<ept id=\"p1\">**</ept> file under Views | Home.",
      "pos": [
        10449,
        10543
      ]
    },
    {
      "content": "At the end of this file, you will see a JavaScript function that uses <ph id=\"ph1\">`JQuery $(function ())`</ph>.",
      "pos": [
        10545,
        10639
      ]
    },
    {
      "content": "This function is called when the page loads.",
      "pos": [
        10640,
        10684
      ]
    },
    {
      "content": "It uses the JQuery autocomplete function and links this function as a callback from the search text box, identified as \"q\".",
      "pos": [
        10685,
        10808
      ]
    },
    {
      "content": "Whenever someone types into the text box, this autosuggest function is called which in turn calls /home/suggest with what is entered.",
      "pos": [
        10809,
        10942
      ]
    },
    {
      "content": "<ph id=\"ph1\">`/home/suggest`</ph> is a reference to the function in <bpt id=\"p1\">**</bpt>HomeController.cs<ept id=\"p1\">**</ept> called <ph id=\"ph2\">`Suggest`</ph>.",
      "pos": [
        10944,
        11033
      ]
    },
    {
      "content": "Open <bpt id=\"p1\">**</bpt>HomeController.cs<ept id=\"p1\">**</ept> and move to the Suggest function.",
      "pos": [
        11039,
        11099
      ]
    },
    {
      "content": "This code is very similar to the Search function that uses the <ph id=\"ph1\">`_catalogSearch`</ph> object to call a function in <bpt id=\"p1\">**</bpt>CatalogSearch.cs<ept id=\"p1\">**</ept> called <ph id=\"ph2\">`Suggest`</ph>.",
      "pos": [
        11100,
        11247
      ]
    },
    {
      "content": "Rather than making a search query, the <ph id=\"ph1\">`Suggest`</ph> function makes a call to the <bpt id=\"p1\">[</bpt>Suggestions API<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn798936.aspx)</ept>.",
      "pos": [
        11248,
        11399
      ]
    },
    {
      "content": "This uses the terms entered in the text box and build out a list of potential suggestions.",
      "pos": [
        11400,
        11490
      ]
    },
    {
      "content": "The values are returned to the <bpt id=\"p1\">**</bpt>Index.cshtml<ept id=\"p1\">**</ept> file that are automatically listed in the Search box as type-ahead options.",
      "pos": [
        11491,
        11614
      ]
    },
    {
      "content": "You might be asking yourself at this point how Azure Search knows what fields to build suggestions over.",
      "pos": [
        11616,
        11720
      ]
    },
    {
      "content": "The answer to this is back when you created the Index.",
      "pos": [
        11721,
        11775
      ]
    },
    {
      "content": "In the <ph id=\"ph1\">`CreateCatalogIndex`</ph>  function within the file Program.cs of the <bpt id=\"p1\">**</bpt>CatalogIndexer<ept id=\"p1\">**</ept> project, there is an attribute called <ph id=\"ph2\">`Suggestions`</ph>.",
      "pos": [
        11776,
        11919
      ]
    },
    {
      "content": "Whenever this attribute is set to <ph id=\"ph1\">`True`</ph>, it means that Azure Search can use it as a field for retrieving suggestions",
      "pos": [
        11921,
        12038
      ]
    },
    {
      "content": "Let’s give this a try.",
      "pos": [
        12040,
        12062
      ]
    },
    {
      "pos": [
        12070,
        12149
      ],
      "content": "Once again, build the application and then press <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> to run the application."
    },
    {
      "content": "In the search box type in the word \"Road\".",
      "pos": [
        12155,
        12197
      ]
    },
    {
      "content": "After a second, you should see a list of items display below the text box with Suggestions that a user could potentially choose.",
      "pos": [
        12199,
        12327
      ]
    },
    {
      "pos": [
        12331,
        12500
      ],
      "content": "You might want to add a breakpoint to the <ph id=\"ph1\">`Suggest`</ph> function within <bpt id=\"p1\">**</bpt>HomeController.cs<ept id=\"p1\">**</ept> and step through (F11) each call that is made to build out the Suggestion list."
    },
    {
      "content": "This concludes the demo.",
      "pos": [
        12502,
        12526
      ]
    },
    {
      "content": "You have now walked through all of the main operations that you'll need to know before building out an ASP.NET MVC4 application using Azure Search.",
      "pos": [
        12527,
        12674
      ]
    },
    {
      "content": "How to resolve \"Could not load file or assembly 'System.Web.Mvc\"",
      "pos": [
        12701,
        12765
      ]
    },
    {
      "content": "When building AdventureWorksWeb, if you get \"Could not load file or assembly 'System.Web.Mvc, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35' or one of its dependencies\", try these steps to resolve the error.",
      "pos": [
        12767,
        12994
      ]
    },
    {
      "pos": [
        12999,
        13100
      ],
      "content": "Open the Package Manager Console: <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> | <bpt id=\"p2\">**</bpt>NuGet Package Manager<ept id=\"p2\">**</ept> | <bpt id=\"p3\">**</bpt>Package Manager Console<ept id=\"p3\">**</ept>"
    },
    {
      "content": "At the PM&gt; prompt, enter \"Update-package -reinstall Microsoft.AspNet.Mvc\"",
      "pos": [
        13104,
        13177
      ]
    },
    {
      "pos": [
        13181,
        13234
      ],
      "content": "When asked to reload the file, choose <bpt id=\"p1\">**</bpt>Yes to All<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        13238,
        13280
      ],
      "content": "Rebuild the solution and try <bpt id=\"p1\">**</bpt>F5<ept id=\"p1\">**</ept> again."
    },
    {
      "content": "Next steps",
      "pos": [
        13310,
        13320
      ]
    },
    {
      "content": "For additional self-study, consider adding a Details page that opens when a user clicks one of the Search results.",
      "pos": [
        13322,
        13436
      ]
    },
    {
      "content": "To prepare, you could do the following:",
      "pos": [
        13437,
        13476
      ]
    },
    {
      "pos": [
        13482,
        13690
      ],
      "content": "Read up on the <bpt id=\"p1\">[</bpt>Lookup API<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn798929.aspx)</ept> that allows you to make a query to Azure Search to bring back a specific document (for example you could pass the productID)."
    },
    {
      "content": "Try adding a new function in the <bpt id=\"p1\">**</bpt>HomeController.cs<ept id=\"p1\">**</ept> file called Details.",
      "pos": [
        13695,
        13770
      ]
    },
    {
      "content": "Add a corresponding <bpt id=\"p1\">**</bpt>Details.cshtml<ept id=\"p1\">**</ept> view that receives the results of this Lookup and displays the results.",
      "pos": [
        13771,
        13881
      ]
    },
    {
      "pos": [
        13886,
        14169
      ],
      "content": "Check out this additional code sample and video on geospatial search: <bpt id=\"p1\">[</bpt>Channel 9 - Azure Search and Geospatial Data<ept id=\"p1\">](http://channel9.msdn.com/Shows/Data-Exposed/Azure-Search-and-Geospatial-Data)</ept> and <bpt id=\"p2\">[</bpt>CodePlex: Azure Search GeoSearch Sample<ept id=\"p2\">](http://azuresearchgeospatial.codeplex.com)</ept>"
    },
    {
      "pos": [
        14171,
        14282
      ],
      "content": "You can also review the <bpt id=\"p1\">[</bpt>Azure Search REST API<ept id=\"p1\">](http://msdn.microsoft.com/library/azure/dn798935.aspx)</ept> on MSDN."
    }
  ],
  "content": "<properties \n    pageTitle=\"Create your first search solution using Azure Search\" \n    description=\"Create your first search solution using Azure Search\" \n    services=\"search\" \n    documentationCenter=\"\" \n    authors=\"HeidiSteen\" \n    manager=\"mblythe\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"search\" \n    ms.devlang=\"rest-api\" \n    ms.workload=\"search\" \n    ms.topic=\"article\" \n    ms.tgt_pltfrm=\"na\" \n    ms.date=\"07/08/2015\" \n    ms.author=\"heidist\"/>\n\n# Create your first search solution using Azure Search\n\nThis sample demonstrates a search application for the Adventure Works bicycle company. After completing this tutorial, you’ll have an online product catalog with a rich search experience that includes faceted navigation, multiple sort options for your search results, and type-ahead query suggestions.\n\n   ![][7]\n\nThe demo gets you started with Azure Search by walking you through these exercises:\n\n+   Create an Azure Search index.\n+   Load documents (data) into the Azure Search index from a SQL Server database.\n+   Build an ASP.NET MVC4 Application that utilizes Azure Search to:\n    +   Search and display results from an Azure Search index\n    +   Show type-ahead suggestions in a Search box while entering a search term\n    +   Filter search results using faceting\n\n\n<a id=\"sub-1\"></a>\n## Prerequisites\n\n+   An [Azure subscription](../includes/free-trial-note.md). If you aren't ready to sign up for a trial subscription, you can skip this tutorial and opt for [Try Azure App Service](https://tryappservice.azure.com/) instead. This alternative option gives you Azure Search with an ASP.NET Web app for free - one hour per session - no subscription required.\n+   Visual Studio 2012 or higher with ASP.NET MVC 4 and SQL Server installed. You can download the free Express editions if you don't already have the software installed: [Visual Studio 2013 Express](http://www.visualstudio.com/products/visual-studio-express-vs.aspx) and [Microsoft SQL Server 2014 Express](http://msdn.microsoft.com/evalcenter/dn434042.aspx).\n+   An Azure Search service. You'll need the Search service name, plus the admin key. See [Create an Azure Search service in the portal](search-create-service-portal.md) for details.\n+   [Adventure Works Azure Search Demo project on CodePlex](http://go.microsoft.com/fwlink/p/?LinkID=510972). On the Source tab, click **Download** to get a zip file of the solution. \n\n    ![][12]\n\n\nThis solution contains two projects:\n\n+   **CatalogIndex** creates an Azure Search index and loads data from a SQL Server database included with the project.\n+   **AdventureWorksWeb** is an MVC4-based application that queries the Azure Search index. This tutorial assumes that you have a working knowledge of ASP.NET MVC.\n\n<a id=\"sub-2\"></a>\n## Create an Azure Search index\n\nIn this step, you will use **CatalogIndex** to create a new Azure Search index called \"catalog\" based on data in an AdventureWorks SQL Server database.\n\n1.  In Visual Studio, open up the Azure Search Demo solution named **AdventureWorksCatalog.sln**.  \n2.  Right-click **CatalogIndexer** in Solution Explorer and select **Set as startup project** so that this application runs, rather than the **AdventureWorksWeb** project, when you press **F5**.\n3.  Open **App.config** in this project and update the values for \"SearchServiceName\" and \"SearchServiceApiKey\" to those of your Azure Search service. For Search service name, if your service is \"mysearch.search.windows.net\", you would enter \"mysearch\".\n4.  Optionally, App.config includes an entry for \"SourceSqlConnectionString\" that assumes SQL Server 2014 Express LocalDB (Server=(LocalDB)\\v11.0). If you’re using a different edition of SQL Server, update the server name accordingly. For example, if you have a local default instance, you can use (local) or localhost.\n5.  Save **App.config**.\n6.  Press **F5** to launch the project.\n\nA command prompt should open with the following text: \"Creating index...\"\n\nAfter a few moments, it should complete with the text: \"Complete.  Press <enter> to continue:\"\n\n   ![][8]\n\nPress **Enter** to close the application. At this point, you have successfully created the Azure Search index. \n\n> [AZURE.NOTE] If you get errors that include \"invalid value for key 'attachdbfilename'\" or some other database attachment error, you might be running into UAC conflicts. For the purposes of this demo, work around these errors by doing the following: \n> Copy the solution to a new or existing folder (such as Temp) that provides access to authenticated users. \n> Use **Run as Administrator** to start Visual Studio. \n> Open the solution, build it, and then press **F5** to create the index.\n\nTo verify index creation and document upload, go to your Search service dashboard in the [Azure management portal](https://portal.azure.com). In Usage, the index count should be up by one, and you should have 294 documents, one for each product in the database.\n\nClick the **Indexes** tile to show the index list. The indexes list slides out to show the new index and document count. Note that you can have up to three indexes at the Free pricing tier. If you already had three indexes, you would need to delete one to free up space for any new ones.\n\n   ![][9]\n\n\n<a id=\"sub-3\"></a>\n## Explore CatalogIndexer\n\nLet’s take a closer look at the **CatalogIndexer** project to understand how it works.\n\n1.  Open **Program.cs** from the Solution Explorer and go to the `Main(string[] args)` function.\n\n    Notice how this function builds up a Uri called `_serviceURI` based on your specific Azure Search service and then creates an HttpClient called `_httpClient` that makes use of your API Key to authenticate to this Search service.\n\n2.  `ChangeEnumeratorSql` and `ChangeSet` are used to enumerate the data from the Products table in your SQL Server AdventureWorks database. \n\n3.  Based on the data that is collected from this table, `ApplyChanges` is then called to apply this data to your Azure Search index.\n\n4.  Move to `ApplyChanges` in the same file. Notice how this function deletes the index if it already exists (`DeleteCatalogIndex`) and then creates a new index called \"catalog\" (`CreateCatalogIndex`).  \n\n5.  Move to the `CreateCatalogIndex` function, and notice how the index is created with a schema that matches the columns from the Products table in SQL Server. Each field has a Type (i.e., `Edm.String` or `Edm.Double`) as well as attributes that define what these fields are used for. Refer to the [Azure Search REST API documentation](http://msdn.microsoft.com/library/azure/dn798935.aspx) for more details on these attributes.\n\n6.  Go back to the `ApplyChanges` function. Notice how this function loops through all of the data in the enumerated changes `ChangeSet`. Rather than applying the changes one by one, they are batched into groups of 1000 and then applied to the Search service. This is much more efficient than applying the documents one by one.\n\nNow that you've seen how to create and populate an index using relational data from SQL Server, let’s take a look at how to build a product catalog that uses our search data.\n\n<a id=\"sub-4\"></a>\n## Build an MVC4 Application using Azure Search\n\nIn this step, you’ll build and run the search application in a web browser.\n\n1.  In Visual Studio, open up the Azure Search Demo Solution named **AdventureWorksCatalog.sln**.  \n\n2.  Right-click **AdventureWorksWeb** in the Solution Explorer and select **Set as startup project**.\n\n3.  Open **Web.config** in this project and update the values for \"SearchServiceName\" and \"SearchServiceApiKey\" to those of your Azure Search service. For Search service name, if your service is \"mysearch.search.windows.net\", you would enter \"mysearch\".\n\n4.  Save **Web.config**.\n\n5.  Press **F5** to launch the project. Follow these [Troubleshooting](#err-mvc) steps if you get a build error. \n\n    ![][10]\n\n6.  Leave the search box empty, and click **Search** to return all 294 products.\n\n7.  Notice the list of facets along on the left side. Try clicking one of the facets. Search is re-executed, but this time it adds the facet you chose to filter the results. You may want to add a breakpoint to the first line in the **HomeController.cs** `Search` function to step through (F11) each line.\n\n7.  Enter a search term, such as \"mountain bikes\". As you type, notice the drop-down list of suggested queries.\n\n    ![][11]\n\nThe screenshot from the start of this demo appears again below, as a reminder of what was covered. In the previous sections, we discussed faceted navigation (on the left), the document count at the top of the page, suggestions, and the sort options for sorting by relevance, list, or price.\n\n   ![][7]\n\n\n<a id=\"sub-5\"></a>\n## Explore AdventureWorksWeb\n\nThe project AdventureWorksWeb shows us how ASP.NET MVC 4 can be used to interact with Azure Search from a web application. In this section, we’ll review individual parts of the application code to see what they do.\n\n1.  In Solution Explorer, expand **AdventureWorksWeb** | **Controller** and open **HomeController.cs**\n\n    This is the MVC controller that manages the interaction from the Index view.  At the top of the controller, you will notice a reference to `CatalogSearch _catalogSearch` which creates a HttpClient connection object to your Azure Search service. The code for this `CatalogSearch` is located in **CatalogSeach.cs**\n\n2. Within **HomeController.cs**, there are two main functions:\n\n    **Search**: When the user clicks on the search button or chooses a facet, this function is called to retrieve the results and send them back to the Index view to be displayed.\n\n    **Suggest**: As the user is typing in the Search box, this function is called to return a list of suggestions based on the content in your Azure Search index.\n\nLet’s drill into these two functions in more detail.  \n\n3.  In **HomeController.cs** `Search` function, you will notice a call to `_catalogSearch.Search`, which includes the connection object to your Azure Search service. When you call the Search function located in **CatalogSearch.cs**, you can see that it utilizes these parameters to build out an Azure Search query. The results of the query are stored in a JSON object called `result` and then passed back to the `Index` view where the results are parsed and displayed in the web page.\n\n4.  Open **Index.cshtml** under Views | Home, you will notice the code that is used to parse these results.\n\n5.  Stop the application if it’s still running, and open **Index.cshtml** file under Views | Home.  At the end of this file, you will see a JavaScript function that uses `JQuery $(function ())`. This function is called when the page loads. It uses the JQuery autocomplete function and links this function as a callback from the search text box, identified as \"q\". Whenever someone types into the text box, this autosuggest function is called which in turn calls /home/suggest with what is entered.  `/home/suggest` is a reference to the function in **HomeController.cs** called `Suggest`.\n\n6.  Open **HomeController.cs** and move to the Suggest function. This code is very similar to the Search function that uses the `_catalogSearch` object to call a function in **CatalogSearch.cs** called `Suggest`. Rather than making a search query, the `Suggest` function makes a call to the [Suggestions API](http://msdn.microsoft.com/library/azure/dn798936.aspx). This uses the terms entered in the text box and build out a list of potential suggestions. The values are returned to the **Index.cshtml** file that are automatically listed in the Search box as type-ahead options.\n\nYou might be asking yourself at this point how Azure Search knows what fields to build suggestions over. The answer to this is back when you created the Index. In the `CreateCatalogIndex`  function within the file Program.cs of the **CatalogIndexer** project, there is an attribute called `Suggestions`.  Whenever this attribute is set to `True`, it means that Azure Search can use it as a field for retrieving suggestions\n\nLet’s give this a try.  \n\n7.  Once again, build the application and then press **F5** to run the application.\n\n8.  In the search box type in the word \"Road\".  After a second, you should see a list of items display below the text box with Suggestions that a user could potentially choose.  \n\nYou might want to add a breakpoint to the `Suggest` function within **HomeController.cs** and step through (F11) each call that is made to build out the Suggestion list.\n\nThis concludes the demo. You have now walked through all of the main operations that you'll need to know before building out an ASP.NET MVC4 application using Azure Search.\n\n\n<a id=\"err-mvc\"></a>\n## How to resolve \"Could not load file or assembly 'System.Web.Mvc\"\n\nWhen building AdventureWorksWeb, if you get \"Could not load file or assembly 'System.Web.Mvc, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35' or one of its dependencies\", try these steps to resolve the error.\n\n1. Open the Package Manager Console: **Tools** | **NuGet Package Manager** | **Package Manager Console**\n2. At the PM> prompt, enter \"Update-package -reinstall Microsoft.AspNet.Mvc\"\n3. When asked to reload the file, choose **Yes to All**.\n4. Rebuild the solution and try **F5** again.\n\n\n<a id=\"next-steps\"></a>\n## Next steps\n\nFor additional self-study, consider adding a Details page that opens when a user clicks one of the Search results. To prepare, you could do the following:\n\n+   Read up on the [Lookup API](http://msdn.microsoft.com/library/azure/dn798929.aspx) that allows you to make a query to Azure Search to bring back a specific document (for example you could pass the productID).\n+   Try adding a new function in the **HomeController.cs** file called Details. Add a corresponding **Details.cshtml** view that receives the results of this Lookup and displays the results.\n+   Check out this additional code sample and video on geospatial search: [Channel 9 - Azure Search and Geospatial Data](http://channel9.msdn.com/Shows/Data-Exposed/Azure-Search-and-Geospatial-Data) and [CodePlex: Azure Search GeoSearch Sample](http://azuresearchgeospatial.codeplex.com)\n\nYou can also review the [Azure Search REST API](http://msdn.microsoft.com/library/azure/dn798935.aspx) on MSDN.\n\n\n<!--Anchors-->\n[Prerequisites]: #sub-1\n[Create an Azure Search index]: #sub-2\n[Explore CatalogIndexer]: #sub-3\n[Build an MVC4 Application using Azure Search]: #sub-4\n[Explore AdventureWorksWeb]: #sub-5\n[Next steps]: #next-steps\n\n\n<!--Image references-->\n[7]: ./media/search-create-first-solution/AzureSearch_Create1_WebApp.PNG\n[8]: ./media/search-create-first-solution/AzureSearch_Create1_ConsoleMsg.PNG\n[9]: ./media/search-create-first-solution/AzureSearch_Create1_DashboardIndexes.PNG\n[10]: ./media/search-create-first-solution/AzureSearch_Create1_WebAppEmpty.PNG\n[11]: ./media/search-create-first-solution/AzureSearch_Create1_Suggestions.PNG\n[12]: ./media/search-create-first-solution/AzureSearch_Create1_CodeplexDownload.PNG"
}