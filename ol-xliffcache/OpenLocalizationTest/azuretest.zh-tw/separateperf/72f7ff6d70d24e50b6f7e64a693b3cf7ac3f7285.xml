{
  "nodes": [
    {
      "content": "Deploy and manage Azure virtual machines using Resource Manager templates and PowerShell",
      "pos": [
        27,
        115
      ]
    },
    {
      "content": "Easily deploy the most common set of configurations for Azure virtual machines and manage them using Resource Manager templates and PowerShell.",
      "pos": [
        134,
        277
      ]
    },
    {
      "content": "Deploy and manage virtual machines using Azure Resource Manager templates and PowerShell",
      "pos": [
        600,
        688
      ]
    },
    {
      "content": "[AZURE.SELECTOR]",
      "pos": [
        692,
        708
      ]
    },
    {
      "content": "Azure preview portal",
      "pos": [
        712,
        732
      ]
    },
    {
      "content": "Azure portal",
      "pos": [
        775,
        787
      ]
    },
    {
      "content": "PowerShell: Resource Manager deployment",
      "pos": [
        845,
        884
      ]
    },
    {
      "content": "PowerShell: Classic deployment",
      "pos": [
        940,
        970
      ]
    },
    {
      "content": "This article shows you how to use Azure Resource Manager templates and PowerShell to automate common tasks for deploying and managing Azure virtual machines.",
      "pos": [
        1029,
        1186
      ]
    },
    {
      "content": "For more templates you can use, see <bpt id=\"p1\">[</bpt>Azure Quickstart Templates<ept id=\"p1\">](http://azure.microsoft.com/documentation/templates/)</ept> and <bpt id=\"p2\">[</bpt>App Frameworks<ept id=\"p2\">](virtual-machines-app-frameworks.md)</ept>.",
      "pos": [
        1187,
        1362
      ]
    },
    {
      "content": "Deploy a Windows virtual machine",
      "pos": [
        1367,
        1399
      ]
    },
    {
      "content": "Create a custom virtual machine image",
      "pos": [
        1416,
        1453
      ]
    },
    {
      "content": "Deploy a multi-virtual-machine application that uses a virtual network and an external load balancer",
      "pos": [
        1469,
        1569
      ]
    },
    {
      "content": "Remove a resource group",
      "pos": [
        1584,
        1607
      ]
    },
    {
      "content": "Sign in to a virtual machine",
      "pos": [
        1623,
        1651
      ]
    },
    {
      "content": "Display information about a virtual machine",
      "pos": [
        1664,
        1707
      ]
    },
    {
      "content": "Start a virtual machine",
      "pos": [
        1724,
        1747
      ]
    },
    {
      "content": "Stop a virtual machine",
      "pos": [
        1760,
        1782
      ]
    },
    {
      "content": "Restart a virtual machine",
      "pos": [
        1794,
        1819
      ]
    },
    {
      "content": "Delete a virtual machine",
      "pos": [
        1834,
        1858
      ]
    },
    {
      "content": "Before you get started, make sure you have Azure PowerShell ready to go.",
      "pos": [
        1870,
        1942
      ]
    },
    {
      "content": "Understanding Azure Resource templates and resource groups",
      "pos": [
        2043,
        2101
      ]
    },
    {
      "content": "Most applications that are deployed and run in Microsoft Azure are built from a combination of different cloud resource types (such as one or more virtual machines and storage accounts, a SQL database, or a virtual network).",
      "pos": [
        2103,
        2327
      ]
    },
    {
      "content": "Azure Resource Manager templates make it possible for you to deploy and manage these different resources together by using a JSON description of the resources and associated configuration and deployment parameters.",
      "pos": [
        2328,
        2542
      ]
    },
    {
      "content": "After you have defined a JSON-based resource template, you can execute it and use a PowerShell command to deploy the defined resources in Azure.",
      "pos": [
        2544,
        2688
      ]
    },
    {
      "content": "You can run these commands either separately in the PowerShell command shell, or you can integrate them with a script that contains additional automation logic.",
      "pos": [
        2689,
        2849
      ]
    },
    {
      "content": "The resources you create using Azure Resource Manager templates will be deployed to either a new or existing Azure resource group.",
      "pos": [
        2851,
        2981
      ]
    },
    {
      "content": "An <bpt id=\"p1\">*</bpt>Azure resource group<ept id=\"p1\">*</ept> allows you to manage multiple deployed resources together as a logical group; this allows you to manage the overall lifecycle of the group/application and provide management APIs that allow you to:",
      "pos": [
        2982,
        3205
      ]
    },
    {
      "content": "Stop, start, or delete all of the resources within the group at once.",
      "pos": [
        3209,
        3278
      ]
    },
    {
      "content": "Apply Role-Based Access Control (RBAC) rules to lock down security permissions on them.",
      "pos": [
        3281,
        3368
      ]
    },
    {
      "content": "Audit operations.",
      "pos": [
        3371,
        3388
      ]
    },
    {
      "content": "Tag resources with additional metadata for better tracking.",
      "pos": [
        3391,
        3450
      ]
    },
    {
      "content": "You can learn more about Azure Resource Manager <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](virtual-machines-azurerm-versus-azuresm.md)</ept>.",
      "pos": [
        3452,
        3551
      ]
    },
    {
      "content": "If you're interested in authoring templates, see <bpt id=\"p1\">[</bpt>Authoring Azure Resource Manager templates<ept id=\"p1\">](resource-group-authoring-templates.md)</ept>.",
      "pos": [
        3552,
        3685
      ]
    },
    {
      "pos": [
        3690,
        3750
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"windowsvm\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Deploy a Windows virtual machine"
    },
    {
      "content": "Use the instructions in this section to deploy a new Azure virtual machine using a Resource Manager template and Azure PowerShell.",
      "pos": [
        3752,
        3882
      ]
    },
    {
      "content": "This template creates a single virtual machine in a new virtual network with a single subnet.",
      "pos": [
        3883,
        3976
      ]
    },
    {
      "content": "Follow these steps to create a Windows virtual machine using a Resource Manager template in the GitHub template repository with Azure PowerShell.",
      "pos": [
        4053,
        4198
      ]
    },
    {
      "content": "Step 1: Examine the JSON file for the template",
      "pos": [
        4204,
        4250
      ]
    },
    {
      "content": "Here is the content of the JSON file for the template.",
      "pos": [
        4252,
        4306
      ]
    },
    {
      "content": "Step 2: Create the virtual machine with the template",
      "pos": [
        11407,
        11459
      ]
    },
    {
      "content": "Fill in an Azure deployment name, resource group name, and Azure datacenter location, and then run these commands.",
      "pos": [
        11461,
        11575
      ]
    },
    {
      "content": "When you run the <bpt id=\"p1\">**</bpt>New-AzureResourceGroupDeployment<ept id=\"p1\">**</ept> command, you will be prompted to supply the values of parameters in the \"parameters\" section of the JSON file.",
      "pos": [
        11999,
        12163
      ]
    },
    {
      "content": "When you have specified all the needed parameter values, the command creates the resource group and the virtual machine.",
      "pos": [
        12164,
        12284
      ]
    },
    {
      "content": "Here is an example.",
      "pos": [
        12286,
        12305
      ]
    },
    {
      "content": "You will see something like this:",
      "pos": [
        12685,
        12718
      ]
    },
    {
      "content": "You now have a new Windows virtual machine named MyWindowsVM in your new resource group.",
      "pos": [
        14834,
        14922
      ]
    },
    {
      "pos": [
        14927,
        14991
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"customvm\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Create a custom virtual machine image"
    },
    {
      "content": "Use the instructions in this sections to create a custom virtual machine image in Azure with a Resource Manager template by using Azure PowerShell.",
      "pos": [
        14993,
        15140
      ]
    },
    {
      "content": "This template creates a single virtual machine from a specified virtual hard disk (VHD).",
      "pos": [
        15141,
        15229
      ]
    },
    {
      "content": "Step 1: Examine the JSON file for the template",
      "pos": [
        15235,
        15281
      ]
    },
    {
      "content": "Here are the contents of the JSON file for the template.",
      "pos": [
        15283,
        15339
      ]
    },
    {
      "content": "Step 2: Obtain the VHD",
      "pos": [
        17956,
        17978
      ]
    },
    {
      "pos": [
        17980,
        18125
      ],
      "content": "For a Windows-based virtual machine, see <bpt id=\"p1\">[</bpt>Create and upload a Windows Server VHD to Azure<ept id=\"p1\">](virtual-machines-create-upload-vhd-windows-server.md)</ept>."
    },
    {
      "pos": [
        18127,
        18252
      ],
      "content": "For a Linux-based virtual machine, see <bpt id=\"p1\">[</bpt>Create and upload a Linux VHD in Azure<ept id=\"p1\">](virtual-machines-linux-create-upload-vhd.md)</ept>."
    },
    {
      "content": "Step 3: Create the virtual machine with the template",
      "pos": [
        18258,
        18310
      ]
    },
    {
      "content": "To create an new virtual machine based on the VHD, replace the elements within the \"&lt; &gt;\" with your specific information and run these commands:",
      "pos": [
        18312,
        18455
      ]
    },
    {
      "content": "You will be prompted to supply the values of parameters in the \"parameters\" section of the JSON file.",
      "pos": [
        18885,
        18986
      ]
    },
    {
      "content": "When you have specified all the parameter values, Azure Resource Manager creates the resource group and the virtual machine.",
      "pos": [
        18987,
        19111
      ]
    },
    {
      "content": "Here is an example:",
      "pos": [
        19113,
        19132
      ]
    },
    {
      "content": "You will receive the following type of information:",
      "pos": [
        19519,
        19570
      ]
    },
    {
      "pos": [
        19867,
        19993
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"multivm\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Deploy a multi-virtual-machine application that uses a virtual network and an external load balancer"
    },
    {
      "content": "Use the instructions in these sections to deploy a multi-virtual-machine application that uses a virtual network and a load balancer with a Resource Manager template using Azure PowerShell.",
      "pos": [
        19995,
        20184
      ]
    },
    {
      "content": "This template creates two virtual machines in a new virtual network with a single subnet in a new cloud service, and adds them to an external load-balanced set for incoming traffic to TCP port 80.",
      "pos": [
        20185,
        20381
      ]
    },
    {
      "content": "Follow these steps to deploy a multi-virtual-machine application that uses a virtual network and a load balancer using a Resource Manager template in the GitHub template repository by using Azure PowerShell commands.",
      "pos": [
        20461,
        20677
      ]
    },
    {
      "content": "Step 1: Examine the JSON file for the template",
      "pos": [
        20683,
        20729
      ]
    },
    {
      "content": "Here are the contents of the JSON file for the template.",
      "pos": [
        20731,
        20787
      ]
    },
    {
      "content": "Step 2: Create the deployment with the template",
      "pos": [
        33179,
        33226
      ]
    },
    {
      "content": "Fill in an Azure deployment name, resource group name, Azure location, and then run these commands.",
      "pos": [
        33228,
        33327
      ]
    },
    {
      "content": "When you run the <bpt id=\"p1\">**</bpt>New-AzureResourceGroupDeployment<ept id=\"p1\">**</ept> command, you will be prompted to supply the values of parameters of the JSON file.",
      "pos": [
        33760,
        33896
      ]
    },
    {
      "content": "When you have specified all the parameter values, the command creates the resource group and the deployment.",
      "pos": [
        33897,
        34005
      ]
    },
    {
      "content": "You would see something like this.",
      "pos": [
        34394,
        34428
      ]
    },
    {
      "pos": [
        34741,
        34791
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"removerg\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Remove a resource group"
    },
    {
      "content": "You can remove any resource group you have created with the <bpt id=\"p1\">**</bpt>Remove-AzureResourceGroup<ept id=\"p1\">**</ept> command.",
      "pos": [
        34793,
        34891
      ]
    },
    {
      "content": "Replace everything within the quotes, including the &lt; and &gt; characters, with the correct name.",
      "pos": [
        34893,
        34987
      ]
    },
    {
      "content": "You will see information like this:",
      "pos": [
        35051,
        35086
      ]
    },
    {
      "pos": [
        35226,
        35286
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"logon\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Sign in to a Windows virtual machine"
    },
    {
      "pos": [
        35288,
        35419
      ],
      "content": "For the detailed steps, see <bpt id=\"p1\">[</bpt>How to Log on to a virtual machine running Windows Server<ept id=\"p1\">](virtual-machines-log-on-windows-server.md)</ept>."
    },
    {
      "pos": [
        35424,
        35495
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"displayvm\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Display information about a virtual machine"
    },
    {
      "content": "You can see information about a virtual machine using the <bpt id=\"p1\">**</bpt>Get-AzureVM<ept id=\"p1\">**</ept> command.",
      "pos": [
        35497,
        35579
      ]
    },
    {
      "content": "This command returns a virtual machine object that can be manipulated using various other cmdlets to update the state of the virtual machine.",
      "pos": [
        35580,
        35721
      ]
    },
    {
      "content": "Replace everything within the quotes, including the &lt; and &gt; characters, with the correct names.",
      "pos": [
        35722,
        35817
      ]
    },
    {
      "content": "You will see information about your virtual machine like this:",
      "pos": [
        35897,
        35959
      ]
    },
    {
      "pos": [
        39082,
        39129
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"start\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Start a virtual machine"
    },
    {
      "content": "You can start a virtual machine using the <bpt id=\"p1\">**</bpt>Start-AzureVM<ept id=\"p1\">**</ept> command.",
      "pos": [
        39131,
        39199
      ]
    },
    {
      "content": "Replace everything within the quotes, including the &lt; and &gt; characters, with the correct names.",
      "pos": [
        39201,
        39296
      ]
    },
    {
      "content": "You will see information like this:",
      "pos": [
        39378,
        39413
      ]
    },
    {
      "pos": [
        39772,
        39817
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"stop\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Stop a virtual machine"
    },
    {
      "content": "You can stop a virtual machine using the <bpt id=\"p1\">**</bpt>Stop-AzureVM<ept id=\"p1\">**</ept> command.",
      "pos": [
        39819,
        39885
      ]
    },
    {
      "content": "Replace everything within the quotes, including the &lt; and &gt; characters, with the correct names.",
      "pos": [
        39887,
        39982
      ]
    },
    {
      "content": "You will see information like this:",
      "pos": [
        40063,
        40098
      ]
    },
    {
      "pos": [
        40641,
        40692
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"restart\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Restart a virtual machine"
    },
    {
      "content": "You can restart a virtual machine using the <bpt id=\"p1\">**</bpt>Restart-AzureVM<ept id=\"p1\">**</ept> command.",
      "pos": [
        40694,
        40766
      ]
    },
    {
      "content": "Replace everything within the quotes, including the &lt; and &gt; characters, with the correct name.",
      "pos": [
        40767,
        40861
      ]
    },
    {
      "content": "You will see information like this:",
      "pos": [
        40945,
        40980
      ]
    },
    {
      "pos": [
        41339,
        41388
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"delete\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>TASK: Delete a virtual machine"
    },
    {
      "content": "You can delete a virtual machine using the <bpt id=\"p1\">**</bpt>Remove-AzureVM<ept id=\"p1\">**</ept> command.",
      "pos": [
        41390,
        41460
      ]
    },
    {
      "content": "Replace everything within the quotes, including the &lt; and &gt; characters, with the correct name.",
      "pos": [
        41461,
        41555
      ]
    },
    {
      "content": "You can use the <bpt id=\"p1\">**</bpt>-Force<ept id=\"p1\">**</ept> parameter to skip the confirmation prompt.",
      "pos": [
        41557,
        41626
      ]
    },
    {
      "content": "You will see information like this:",
      "pos": [
        41709,
        41744
      ]
    },
    {
      "content": "Additional resources",
      "pos": [
        42288,
        42308
      ]
    },
    {
      "content": "Azure compute, network and storage providers under Azure Resource Manager",
      "pos": [
        42311,
        42384
      ]
    },
    {
      "content": "Azure Resource Manager overview",
      "pos": [
        42432,
        42463
      ]
    },
    {
      "content": "Deploy and Manage Virtual Machines using Azure Resource Manager Templates and the Azure CLI",
      "pos": [
        42495,
        42586
      ]
    },
    {
      "content": "Virtual machines documentation",
      "pos": [
        42640,
        42670
      ]
    },
    {
      "content": "How to install and configure Azure PowerShell",
      "pos": [
        42743,
        42788
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Deploy and manage Azure virtual machines using Resource Manager templates and PowerShell\"\n    description=\"Easily deploy the most common set of configurations for Azure virtual machines and manage them using Resource Manager templates and PowerShell.\"\n    services=\"virtual-machines\"\n    documentationCenter=\"\"\n    authors=\"davidmu1\"\n    manager=\"timlt\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"virtual-machines\"\n    ms.workload=\"infrastructure-services\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"08/25/2015\"\n    ms.author=\"davidmu\"/>\n\n# Deploy and manage virtual machines using Azure Resource Manager templates and PowerShell\n\n> [AZURE.SELECTOR]\n- [Azure preview portal](virtual-machines-windows-tutorial.md)\n- [Azure portal](virtual-machines-windows-tutorial-classic-portal.md)\n- [PowerShell: Resource Manager deployment](virtual-machines-deploy-rmtemplates-powershell.md)\n- [PowerShell: Classic deployment](virtual-machines-ps-create-preconfigure-windows-vms.md)\n\nThis article shows you how to use Azure Resource Manager templates and PowerShell to automate common tasks for deploying and managing Azure virtual machines. For more templates you can use, see [Azure Quickstart Templates](http://azure.microsoft.com/documentation/templates/) and [App Frameworks](virtual-machines-app-frameworks.md).\n\n- [Deploy a Windows virtual machine](#windowsvm)\n- [Create a custom virtual machine image](#customvm)\n- [Deploy a multi-virtual-machine application that uses a virtual network and an external load balancer](#multivm)\n- [Remove a resource group](#removerg)\n- [Sign in to a virtual machine](#logon)\n- [Display information about a virtual machine](#displayvm)\n- [Start a virtual machine](#start)\n- [Stop a virtual machine](#stop)\n- [Restart a virtual machine](#restart)\n- [Delete a virtual machine](#delete)\n\nBefore you get started, make sure you have Azure PowerShell ready to go.\n\n[AZURE.INCLUDE [arm-getting-setup-powershell](../../includes/arm-getting-setup-powershell.md)]\n\n## Understanding Azure Resource templates and resource groups\n\nMost applications that are deployed and run in Microsoft Azure are built from a combination of different cloud resource types (such as one or more virtual machines and storage accounts, a SQL database, or a virtual network). Azure Resource Manager templates make it possible for you to deploy and manage these different resources together by using a JSON description of the resources and associated configuration and deployment parameters.\n\nAfter you have defined a JSON-based resource template, you can execute it and use a PowerShell command to deploy the defined resources in Azure. You can run these commands either separately in the PowerShell command shell, or you can integrate them with a script that contains additional automation logic.\n\nThe resources you create using Azure Resource Manager templates will be deployed to either a new or existing Azure resource group. An *Azure resource group* allows you to manage multiple deployed resources together as a logical group; this allows you to manage the overall lifecycle of the group/application and provide management APIs that allow you to:\n\n- Stop, start, or delete all of the resources within the group at once.\n- Apply Role-Based Access Control (RBAC) rules to lock down security permissions on them.\n- Audit operations.\n- Tag resources with additional metadata for better tracking.\n\nYou can learn more about Azure Resource Manager [here](virtual-machines-azurerm-versus-azuresm.md). If you're interested in authoring templates, see [Authoring Azure Resource Manager templates](resource-group-authoring-templates.md).\n\n## <a id=\"windowsvm\"></a>TASK: Deploy a Windows virtual machine\n\nUse the instructions in this section to deploy a new Azure virtual machine using a Resource Manager template and Azure PowerShell. This template creates a single virtual machine in a new virtual network with a single subnet.\n\n![](./media/virtual-machines-deploy-rmtemplates-powershell/windowsvm.png)\n\nFollow these steps to create a Windows virtual machine using a Resource Manager template in the GitHub template repository with Azure PowerShell.\n\n### Step 1: Examine the JSON file for the template\n\nHere is the content of the JSON file for the template.\n\n    {\n    \"$schema\": \"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#\",\n    \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"newStorageAccountName\": {\n            \"type\": \"string\",\n            \"metadata\": {\n                \"Description\": \"Unique DNS name for the storage account where the virtual machine's disks will be placed.\"\n            }\n        },\n        \"adminUsername\": {\n            \"type\": \"string\",\n            \"metadata\": {\n               \"Description\": \"User name for the virtual machine.\"\n            }\n        },\n        \"adminPassword\": {\n            \"type\": \"securestring\",\n            \"metadata\": {\n                \"Description\": \"Password for the virtual machine.\"\n            }\n        },\n        \"dnsNameForPublicIP\": {\n            \"type\": \"string\",\n            \"metadata\": {\n                  \"Description\": \"Unique DNS name for the public IP used to access the virtual machine.\"\n            }\n        },\n        \"windowsOSVersion\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"2012-R2-Datacenter\",\n            \"allowedValues\": [\n                \"2008-R2-SP1\",\n                \"2012-Datacenter\",\n                \"2012-R2-Datacenter\",\n                \"Windows-Server-Technical-Preview\"\n            ],\n            \"metadata\": {\n                \"Description\": \"The Windows version for the virtual machine. This will pick a fully patched image of this given Windows version. Allowed values: 2008-R2-SP1, 2012-Datacenter, 2012-R2-Datacenter, Windows-Server-Technical-Preview.\"\n            }\n        }\n    },\n    \"variables\": {\n        \"location\": \"West US\",\n        \"imagePublisher\": \"MicrosoftWindowsServer\",\n        \"imageOffer\": \"WindowsServer\",\n        \"OSDiskName\": \"osdiskforwindowssimple\",\n        \"nicName\": \"myVMNic\",\n        \"addressPrefix\": \"10.0.0.0/16\",\n        \"subnetName\": \"Subnet\",\n        \"subnetPrefix\": \"10.0.0.0/24\",\n        \"storageAccountType\": \"Standard_LRS\",\n        \"publicIPAddressName\": \"myPublicIP\",\n        \"publicIPAddressType\": \"Dynamic\",\n        \"vmStorageAccountContainerName\": \"vhds\",\n        \"vmName\": \"MyWindowsVM\",\n        \"vmSize\": \"Standard_D1\",\n        \"virtualNetworkName\": \"MyVNET\",\n        \"vnetID\": \"[resourceId('Microsoft.Network/virtualNetworks',variables('virtualNetworkName'))]\",\n        \"subnetRef\": \"[concat(variables('vnetID'),'/subnets/',variables('subnetName'))]\"\n    },\n    \"resources\": [\n        {\n            \"type\": \"Microsoft.Storage/storageAccounts\",\n            \"name\": \"[parameters('newStorageAccountName')]\",\n            \"apiVersion\": \"2015-05-01-preview\",\n            \"location\": \"[variables('location')]\",\n            \"properties\": {\n                \"accountType\": \"[variables('storageAccountType')]\"\n            }\n        },\n        {\n            \"apiVersion\": \"2015-05-01-preview\",\n            \"type\": \"Microsoft.Network/publicIPAddresses\",\n            \"name\": \"[variables('publicIPAddressName')]\",\n            \"location\": \"[variables('location')]\",\n            \"properties\": {\n                \"publicIPAllocationMethod\": \"[variables('publicIPAddressType')]\",\n                \"dnsSettings\": {\n                    \"domainNameLabel\": \"[parameters('dnsNameForPublicIP')]\"\n                }\n            }\n        },\n        {\n            \"apiVersion\": \"2015-05-01-preview\",\n            \"type\": \"Microsoft.Network/virtualNetworks\",\n            \"name\": \"[variables('virtualNetworkName')]\",\n            \"location\": \"[variables('location')]\",\n            \"properties\": {\n                \"addressSpace\": {\n                    \"addressPrefixes\": [\n                        \"[variables('addressPrefix')]\"\n                    ]\n                },\n                \"subnets\": [\n                    {\n                        \"name\": \"[variables('subnetName')]\",\n                        \"properties\": {\n                            \"addressPrefix\": \"[variables('subnetPrefix')]\"\n                        }\n                    }\n                ]\n            }\n        },\n        {\n            \"apiVersion\": \"2015-05-01-preview\",\n            \"type\": \"Microsoft.Network/networkInterfaces\",\n            \"name\": \"[variables('nicName')]\",\n            \"location\": \"[variables('location')]\",\n            \"dependsOn\": [\n                \"[concat('Microsoft.Network/publicIPAddresses/', variables('publicIPAddressName'))]\",\n                \"[concat('Microsoft.Network/virtualNetworks/', variables('virtualNetworkName'))]\"\n            ],\n            \"properties\": {\n                \"ipConfigurations\": [\n                    {\n                        \"name\": \"ipconfig1\",\n                        \"properties\": {\n                            \"privateIPAllocationMethod\": \"Dynamic\",\n                            \"publicIPAddress\": {\n                                \"id\": \"[resourceId('Microsoft.Network/publicIPAddresses',variables('publicIPAddressName'))]\"\n                            },\n                            \"subnet\": {\n                                \"id\": \"[variables('subnetRef')]\"\n                            }\n                        }\n                    }\n                ]\n            }\n        },\n        {\n            \"apiVersion\": \"2015-05-01-preview\",\n            \"type\": \"Microsoft.Compute/virtualMachines\",\n            \"name\": \"[variables('vmName')]\",\n            \"location\": \"[variables('location')]\",\n            \"dependsOn\": [\n                \"[concat('Microsoft.Storage/storageAccounts/', parameters('newStorageAccountName'))]\",\n                \"[concat('Microsoft.Network/networkInterfaces/', variables('nicName'))]\"\n            ],\n            \"properties\": {\n                \"hardwareProfile\": {\n                    \"vmSize\": \"[variables('vmSize')]\"\n                },\n                \"osProfile\": {\n                    \"computername\": \"[variables('vmName')]\",\n                    \"adminUsername\": \"[parameters('adminUsername')]\",\n                    \"adminPassword\": \"[parameters('adminPassword')]\"\n                },\n                \"storageProfile\": {\n                    \"imageReference\": {\n                        \"publisher\": \"[variables('imagePublisher')]\",\n                        \"offer\": \"[variables('imageOffer')]\",\n                        \"sku\" : \"[parameters('windowsOSVersion')]\",\n                        \"version\":\"latest\"\n                    },\n                   \"osDisk\" : {\n                        \"name\": \"osdisk\",\n                        \"vhd\": {\n                            \"uri\": \"[concat('http://',parameters('newStorageAccountName'),'.blob.core.windows.net/',variables('vmStorageAccountContainerName'),'/',variables('OSDiskName'),'.vhd')]\"\n                        },\n                        \"caching\": \"ReadWrite\",\n                        \"createOption\": \"FromImage\"\n                    }\n                },\n                \"networkProfile\": {\n                    \"networkInterfaces\": [\n                        {\n                            \"id\": \"[resourceId('Microsoft.Network/networkInterfaces',variables('nicName'))]\"\n                        }\n                    ]\n                }\n            }\n        }\n    ]\n    }\n\n\n### Step 2: Create the virtual machine with the template\n\nFill in an Azure deployment name, resource group name, and Azure datacenter location, and then run these commands.\n\n    $deployName=\"<deployment name>\"\n    $RGName=\"<resource group name>\"\n    $locName=\"<Azure location, such as West US>\"\n    $templateURI=\"https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-simple-windows-vm/azuredeploy.json\"\n    New-AzureResourceGroup -Name $RGName -Location $locName\n    New-AzureResourceGroupDeployment -Name $deployName -ResourceGroupName $RGName -TemplateUri $templateURI\n\nWhen you run the **New-AzureResourceGroupDeployment** command, you will be prompted to supply the values of parameters in the \"parameters\" section of the JSON file. When you have specified all the needed parameter values, the command creates the resource group and the virtual machine.\n\nHere is an example.\n\n    $deployName=\"TestDeployment\"\n    $RGName=\"TestRG\"\n    $locname=\"West US\"\n    $templateURI=\"https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-simple-windows-vm/azuredeploy.json\"\n    New-AzureResourceGroup -Name $RGName -Location $locName\n    New-AzureResourceGroupDeployment -Name $deployName -ResourceGroupName $RGName -TemplateUri $templateURI\n\nYou will see something like this:\n\n    cmdlet New-AzureResourceGroupDeployment at command pipeline position 1\n    Supply values for the following parameters:\n    (Type !? for Help.)\n    newStorageAccountName: newsaacct\n    adminUsername: WinAdmin1\n    adminPassword: *********\n    dnsNameForPublicIP: contoso\n    VERBOSE: 10:56:59 AM - Template is valid.\n    VERBOSE: 10:56:59 AM - Create template deployment 'TestDeployment'.\n    VERBOSE: 10:57:08 AM - Resource Microsoft.Network/virtualNetworks 'MyVNET' provisioning status is succeeded\n    VERBOSE: 10:57:11 AM - Resource Microsoft.Network/publicIPAddresses 'myPublicIP' provisioning status is running\n    VERBOSE: 10:57:11 AM - Resource Microsoft.Storage/storageAccounts 'newsaacct' provisioning status is running\n    VERBOSE: 10:57:38 AM - Resource Microsoft.Storage/storageAccounts 'newsaacct' provisioning status is succeeded\n    VERBOSE: 10:57:40 AM - Resource Microsoft.Network/publicIPAddresses 'myPublicIP' provisioning status is succeeded\n    VERBOSE: 10:57:45 AM - Resource Microsoft.Compute/virtualMachines 'MyWindowsVM' provisioning status is running\n    VERBOSE: 10:57:45 AM - Resource Microsoft.Network/networkInterfaces 'myVMNic' provisioning status is succeeded\n    VERBOSE: 11:01:59 AM - Resource Microsoft.Compute/virtualMachines 'MyWindowsVM' provisioning status is succeeded\n\n\n    DeploymentName    : TestDeployment\n    ResourceGroupName : TestRG\n    ProvisioningState : Succeeded\n    Timestamp         : 4/28/2015 6:02:13 PM\n    Mode              : Incremental\n    TemplateLink      :\n    Parameters        :\n                        Name             Type                       Value\n                        ===============  =========================  ==========\n                        newStorageAccountName  String                     newsaacct\n                        adminUsername    String                     WinAdmin1\n                        adminPassword    SecureString\n                        dnsNameForPublicIP  String                     contoso9875\n                        windowsOSVersion  String                     2012-R2-Datacenter\n\n    Outputs           :\n\nYou now have a new Windows virtual machine named MyWindowsVM in your new resource group.\n\n## <a id=\"customvm\"></a>TASK: Create a custom virtual machine image\n\nUse the instructions in this sections to create a custom virtual machine image in Azure with a Resource Manager template by using Azure PowerShell. This template creates a single virtual machine from a specified virtual hard disk (VHD).\n\n### Step 1: Examine the JSON file for the template\n\nHere are the contents of the JSON file for the template.\n\n    {\n        \"$schema\": \"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json\",\n        \"contentVersion\": \"1.0.0.0\",\n        \"parameters\": {\n            \"osDiskVhdUri\": {\n                \"type\": \"string\",\n                \"metadata\": {\n                    \"Description\": \"Uri of the existing VHD\"\n                }\n            },\n            \"osType\": {\n                \"type\": \"string\",\n                \"allowedValues\": [\n                    \"windows\",\n                    \"linux\"\n                ],\n                \"metadata\": {\n                    \"Description\": \"Type of OS on the existing vhd\"\n                }\n            },\n            \"location\": {\n                \"type\": \"String\",\n                \"defaultValue\": \"West US\",\n                \"metadata\": {\n                    \"Description\": \"Location to create the VM in\"\n                }\n            },\n            \"vmSize\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"Standard_A2\",\n                \"metadata\": {\n                    \"Description\": \"Size of the VM\"\n                }\n            },\n            \"vmName\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"myVM\",\n                \"metadata\": {\n                    \"Description\": \"Name of the VM\"\n                }\n            },\n            \"nicName\": {\n                \"type\": \"string\",\n                \"defaultValue\": \"myNIC\",\n                \"metadata\": {\n                    \"Description\": \"NIC to attach the new VM to\"\n                }\n            }\n        },\n        \"resources\": [{\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"type\": \"Microsoft.Compute/virtualMachines\",\n            \"name\": \"[parameters('vmName')]\",\n            \"location\": \"[parameters('location')]\",\n            \"properties\": {\n                \"hardwareProfile\": {\n                    \"vmSize\": \"[parameters('vmSize')]\"\n                },\n                \"storageProfile\": {\n                    \"osDisk\": {\n                        \"name\": \"[concat(parameters('vmName'),'-osDisk')]\",\n                        \"osType\": \"[parameters('osType')]\",\n                        \"caching\": \"ReadWrite\",\n                        \"vhd\": {\n                            \"uri\": \"[parameters('osDiskVhdUri')]\"\n                        }\n                    }\n                },\n                \"networkProfile\": {\n                    \"networkInterfaces\": [{\n                        \"id\": \"[resourceId('Microsoft.Network/networkInterfaces',parameters('nicName'))]\"\n                    }]\n                }\n            }\n        }]\n    }\n\n### Step 2: Obtain the VHD\n\nFor a Windows-based virtual machine, see [Create and upload a Windows Server VHD to Azure](virtual-machines-create-upload-vhd-windows-server.md).\n\nFor a Linux-based virtual machine, see [Create and upload a Linux VHD in Azure](virtual-machines-linux-create-upload-vhd.md).\n\n### Step 3: Create the virtual machine with the template\n\nTo create an new virtual machine based on the VHD, replace the elements within the \"< >\" with your specific information and run these commands:\n\n    $deployName=\"<deployment name>\"\n    $RGName=\"<resource group name>\"\n    $locName=\"<Azure location, such as West US>\"\n    $templateURI=\"https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-vm-from-specialized-vhd/azuredeploy.json\"\n    New-AzureResourceGroup -Name $RGName -Location $locName\n    New-AzureResourceGroupDeployment -Name $deployName -ResourceGroupName $RGName -TemplateUri $templateURI\n\nYou will be prompted to supply the values of parameters in the \"parameters\" section of the JSON file. When you have specified all the parameter values, Azure Resource Manager creates the resource group and the virtual machine.\n\nHere is an example:\n\n    $deployName=\"TestDeployment\"\n    $RGName=\"TestRG\"\n    $locname=\"West US\"\n    $templateURI=\"https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-vm-from-specialized-vhd/azuredeploy.json\"\n    New-AzureResourceGroup -Name $RGName -Location $locName\n    New-AzureResourceGroupDeployment -Name $deployName -ResourceGroupName $RGName -TemplateUri $templateURI\n\n\nYou will receive the following type of information:\n\n    cmdlet New-AzureResourceGroup at command pipeline position 1\n    Supply values for the following parameters:\n    (Type !? for Help.)\n    osDiskVhdUri: http://saacct.blob.core.windows.net/vhds/osdiskforwindows.vhd\n    osType: windows\n    location: West US\n    vmSize: Standard_A3\n    ...\n\n## <a id=\"multivm\"></a>TASK: Deploy a multi-virtual-machine application that uses a virtual network and an external load balancer\n\nUse the instructions in these sections to deploy a multi-virtual-machine application that uses a virtual network and a load balancer with a Resource Manager template using Azure PowerShell. This template creates two virtual machines in a new virtual network with a single subnet in a new cloud service, and adds them to an external load-balanced set for incoming traffic to TCP port 80.\n\n![](./media/virtual-machines-deploy-rmtemplates-powershell/multivmextlb.png)\n\nFollow these steps to deploy a multi-virtual-machine application that uses a virtual network and a load balancer using a Resource Manager template in the GitHub template repository by using Azure PowerShell commands.\n\n### Step 1: Examine the JSON file for the template\n\nHere are the contents of the JSON file for the template.\n\n    {\n    \"$schema\": \"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json\",\n        \"contentVersion\": \"1.0.0.0\",\n    \"parameters\": {\n        \"region\": {\n            \"type\": \"string\"\n        },\n        \"storageAccountName\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"uniqueStorageAccountName\"\n        },\n        \"adminUsername\": {\n            \"type\": \"string\"\n        },\n        \"adminPassword\": {\n            \"type\": \"securestring\"\n        },\n        \"dnsNameforLBIP\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"uniqueDnsNameforLBIP\"\n        },\n        \"backendPort\": {\n            \"type\": \"int\",\n            \"defaultValue\": 3389\n        },\n        \"vmNamePrefix\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"myVM\"\n        },\n        \"vmSourceImageName\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-R2-201412.01-en.us-127GB.vhd\"\n        },\n        \"lbName\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"myLB\"\n        },\n        \"nicNamePrefix\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"nic\"\n        },\n        \"publicIPAddressName\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"myPublicIP\"\n        },\n        \"vnetName\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"myVNET\"\n        },\n        \"vmSize\": {\n            \"type\": \"string\",\n            \"defaultValue\": \"Standard_A1\",\n            \"allowedValues\": [\n                \"Standard_A0\",\n                \"Standard_A1\",\n                \"Standard_A2\",\n                \"Standard_A3\",\n                \"Standard_A4\"\n            ]\n        }\n    },\n    \"variables\": {\n        \"storageAccountType\": \"Standard_LRS\",\n        \"vmStorageAccountContainerName\": \"vhds\",\n        \"availabilitySetName\": \"myAvSet\",\n        \"addressPrefix\": \"10.0.0.0/16\",\n        \"subnetName\": \"Subnet-1\",\n        \"subnetPrefix\": \"10.0.0.0/24\",\n        \"publicIPAddressType\": \"Dynamic\",\n        \"vnetID\": \"[resourceId('Microsoft.Network/virtualNetworks',parameters('vnetName'))]\",\n        \"subnetRef\": \"[concat(variables('vnetID'),'/subnets/',variables ('subnetName'))]\",\n        \"publicIPAddressID\": \"[resourceId('Microsoft.Network/publicIPAddresses',parameters('publicIPAddressName'))]\",\n        \"lbID\": \"[resourceId('Microsoft.Network/loadBalancers',parameters('lbName'))]\",\n        \"numberOfInstances\": 2,\n        \"nicId1\": \"[resourceId('Microsoft.Network/networkInterfaces',concat(parameters('nicNamePrefix'), 0))]\",\n        \"nicId2\": \"[resourceId('Microsoft.Network/networkInterfaces',concat(parameters('nicNamePrefix'), 1))]\",\n        \"frontEndIPConfigID\": \"[concat(variables('lbID'),'/frontendIPConfigurations/LBFE')]\",\n        \"backEndIPConfigID1\": \"[concat(variables('nicId1'),'/ipConfigurations/ipconfig1')]\",\n        \"backEndIPConfigID2\": \"[concat(variables('nicId2'),'/ipConfigurations/ipconfig1')]\",\n        \"sourceImageName\": \"[concat('/', subscription().subscriptionId,'/services/images/',parameters('vmSourceImageName'))]\",\n        \"lbPoolID\": \"[concat(variables('lbID'),'/backendAddressPools/LBBE')]\",\n        \"lbProbeID\": \"[concat(variables('lbID'),'/probes/tcpProbe')]\"\n    },\n    \"resources\": [\n        {\n            \"type\": \"Microsoft.Storage/storageAccounts\",\n            \"name\": \"[parameters('storageAccountName')]\",\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"location\": \"[parameters('region')]\",\n            \"properties\": {\n                \"accountType\": \"[variables('storageAccountType')]\"\n            }\n        },\n        {\n            \"type\": \"Microsoft.Compute/availabilitySets\",\n            \"name\": \"[variables('availabilitySetName')]\",\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"location\": \"[parameters('region')]\",\n            \"properties\": {}\n        },\n        {\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"type\": \"Microsoft.Network/publicIPAddresses\",\n            \"name\": \"[parameters('publicIPAddressName')]\",\n            \"location\": \"[parameters('region')]\",\n            \"properties\": {\n                \"publicIPAllocationMethod\": \"[variables('publicIPAddressType')]\",\n                \"dnsSettings\": {\n                    \"domainNameLabel\": \"[parameters('dnsNameforLBIP')]\"\n                }\n            }\n        },\n        {\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"type\": \"Microsoft.Network/virtualNetworks\",\n            \"name\": \"[parameters('vnetName')]\",\n            \"location\": \"[parameters('region')]\",\n            \"properties\": {\n                \"addressSpace\": {\n                    \"addressPrefixes\": [\n                        \"[variables('addressPrefix')]\"\n                    ]\n                },\n                \"subnets\": [\n                    {\n                        \"name\": \"[variables('subnetName')]\",\n                        \"properties\": {\n                            \"addressPrefix\": \"[variables('subnetPrefix')]\"\n                        }\n                    }\n                ]\n            }\n        },\n        {\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"type\": \"Microsoft.Network/networkInterfaces\",\n            \"name\": \"[concat(parameters('nicNamePrefix'), copyindex())]\",\n            \"location\": \"[parameters('region')]\",\n            \"copy\": {\n                \"name\": \"nicLoop\",\n                \"count\": \"[variables('numberOfInstances')]\"\n            },\n            \"dependsOn\": [\n                \"[concat('Microsoft.Network/virtualNetworks/', parameters('vnetName'))]\"\n            ],\n            \"properties\": {\n                \"ipConfigurations\": [\n                    {\n                        \"name\": \"ipconfig1\",\n                        \"properties\": {\n                            \"privateIPAllocationMethod\": \"Dynamic\",\n                            \"subnet\": {\n                                \"id\": \"[variables('subnetRef')]\"\n                            }\n                        }\n                    }\n                ]\n            }\n        },\n        {\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"name\": \"[parameters('lbName')]\",\n            \"type\": \"Microsoft.Network/loadBalancers\",\n            \"location\": \"[parameters('region')]\",\n            \"dependsOn\": [\n                \"nicLoop\",\n                \"[concat('Microsoft.Network/publicIPAddresses/', parameters('publicIPAddressName'))]\"\n            ],\n            \"properties\": {\n                \"frontendIPConfigurations\": [\n                    {\n                        \"name\": \"LBFE\",\n                        \"properties\": {\n                            \"publicIPAddress\": {\n                                \"id\": \"[variables('publicIPAddressID')]\"\n                            }\n                        }\n                    }\n                ],\n                \"backendAddressPools\": [\n                    {\n                        \"name\": \"LBBE\",\n                        \"properties\": {\n                            \"backendIPConfigurations\": [\n                                {\n                                    \"id\": \"[variables('backEndIPConfigID1')]\"\n                                },\n                                {\n                                    \"id\": \"[variables('backEndIPConfigID2')]\"\n                                }\n                            ]\n                        }\n                    }\n                ],\n                \"inboundNatRules\": [\n                    {\n                        \"name\": \"RDP-VM1\",\n                        \"properties\": {\n                            \"frontendIPConfigurations\": [\n                                {\n                                    \"id\": \"[variables('frontEndIPConfigID')]\"\n                                }\n                            ],\n                            \"backendIPConfiguration\": {\n                                \"id\": \"[variables('backEndIPConfigID1')]\"\n                            },\n                            \"protocol\": \"tcp\",\n                            \"frontendPort\": 50001,\n                            \"backendPort\": 3389,\n                            \"enableFloatingIP\": false\n                        }\n                    },\n                    {\n                        \"name\": \"RDP-VM2\",\n                        \"properties\": {\n                            \"frontendIPConfigurations\": [\n                                {\n                                    \"id\": \"[variables('frontEndIPConfigID')]\"\n                                }\n                            ],\n                            \"backendIPConfiguration\": {\n                                \"id\": \"[variables('backEndIPConfigID2')]\"\n                            },\n                            \"protocol\": \"tcp\",\n                            \"frontendPort\": 50002,\n                            \"backendPort\": 3389,\n                            \"enableFloatingIP\": false\n                        }\n                    }\n                ],\n                \"loadBalancingRules\": [\n                    {\n                        \"name\": \"LBRule\",\n                        \"properties\": {\n                            \"frontendIPConfigurations\": [\n                                {\n                                    \"id\": \"[variables('frontEndIPConfigID')]\"\n                                }\n                            ],\n                            \"backendAddressPool\": {\n                                \"id\": \"[variables('lbPoolID')]\"\n                            },\n                            \"protocol\": \"tcp\",\n                            \"frontendPort\": 80,\n                            \"backendPort\": 80,\n                            \"enableFloatingIP\": false,\n                            \"idleTimeoutInMinutes\": 5,\n                            \"probe\": {\n                                \"id\": \"[variables('lbProbeID')]\"\n                            }\n                        }\n                    }\n                ],\n                \"probes\": [\n                    {\n                        \"name\": \"tcpProbe\",\n                        \"properties\": {\n                            \"protocol\": \"tcp\",\n                            \"port\": 80,\n                            \"intervalInSeconds\": \"5\",\n                            \"numberOfProbes\": \"2\"\n                        }\n                    }\n                ]\n            }\n        },\n        {\n            \"apiVersion\": \"2014-12-01-preview\",\n            \"type\": \"Microsoft.Compute/virtualMachines\",\n            \"name\": \"[concat(parameters('vmNamePrefix'), copyindex())]\",\n            \"copy\": {\n                \"name\": \"virtualMachineLoop\",\n                \"count\": \"[variables('numberOfInstances')]\"\n            },\n            \"location\": \"[parameters('region')]\",\n            \"dependsOn\": [\n                \"[concat('Microsoft.Storage/storageAccounts/', parameters('storageAccountName'))]\",\n                \"[concat('Microsoft.Network/networkInterfaces/', parameters('nicNamePrefix'), copyindex())]\",\n                \"[concat('Microsoft.Compute/availabilitySets/', variables('availabilitySetName'))]\"\n            ],\n            \"properties\": {\n                \"availabilitySet\": {\n                    \"id\": \"[resourceId('Microsoft.Compute/availabilitySets',variables('availabilitySetName'))]\"\n                },\n                \"hardwareProfile\": {\n                    \"vmSize\": \"[parameters('vmSize')]\"\n                },\n                \"osProfile\": {\n                    \"computername\": \"[concat(parameters('vmNamePrefix'), copyIndex())]\",\n                    \"adminUsername\": \"[parameters('adminUsername')]\",\n                    \"adminPassword\": \"[parameters('adminPassword')]\"\n                },\n                \"storageProfile\": {\n                    \"sourceImage\": {\n                        \"id\": \"[variables('sourceImageName')]\"\n                    },\n                    \"destinationVhdsContainer\": \"[concat('http://',parameters('storageAccountName'),'.blob.core.windows.net/',variables('vmStorageAccountContainerName'),'/')]\"\n                },\n                \"networkProfile\": {\n                    \"networkInterfaces\": [\n                        {\n                            \"id\": \"[resourceId('Microsoft.Network/networkInterfaces',concat(parameters('nicNamePrefix'),copyindex()))]\"\n                        }\n                    ]\n                }\n            }\n        }\n    ]\n    }\n\n\n### Step 2: Create the deployment with the template\n\nFill in an Azure deployment name, resource group name, Azure location, and then run these commands.\n\n    $deployName=\"<deployment name>\"\n    $RGName=\"<resource group name>\"\n    $locName=\"<Azure location, such as West US>\"\n    $templateURI=\"https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-2-vms-loadbalancer-lbrules/azuredeploy.json\"\n    New-AzureResourceGroup -Name $RGName -Location $locName\n    New-AzureResourceGroupDeployment -Name $deployName -ResourceGroupName $RGName -TemplateUri $templateURI\n\nWhen you run the **New-AzureResourceGroupDeployment** command, you will be prompted to supply the values of parameters of the JSON file. When you have specified all the parameter values, the command creates the resource group and the deployment.\n\n    $deployName=\"TestDeployment\"\n    $RGName=\"TestRG\"\n    $locname=\"West US\"\n    $templateURI=\"https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-2-vms-loadbalancer-lbrules/azuredeploy.json\"\n    New-AzureResourceGroup -Name $RGName -Location $locName\n    New-AzureResourceGroupDeployment -Name $deployName -ResourceGroupName $RGName -TemplateUri $templateURI\n\nYou would see something like this.\n\n    cmdlet New-AzureResourceGroup at command pipeline position 1\n    Supply values for the following parameters:\n    (Type !? for Help.)\n    newStorageAccountName: saTest\n    adminUserName: WebAdmin1\n    adminPassword: *******\n    dnsNameforLBIP: web07\n    backendPort: 80\n    vmNamePrefix: WEBFARM\n    ...\n\n## <a id=\"removerg\"></a>TASK: Remove a resource group\n\nYou can remove any resource group you have created with the **Remove-AzureResourceGroup** command.  Replace everything within the quotes, including the < and > characters, with the correct name.\n\n    Remove-AzureResourceGroup  -Name \"<resource group name>\"\n\nYou will see information like this:\n\n    Confirm\n    Are you sure you want to remove resource group 'BuildRG'\n    [Y] Yes  [N] No  [S] Suspend  [?] Help (default is \"Y\"):\n\n## <a id=\"logon\"></a>TASK: Sign in to a Windows virtual machine\n\nFor the detailed steps, see [How to Log on to a virtual machine running Windows Server](virtual-machines-log-on-windows-server.md).\n\n## <a id=\"displayvm\"></a>TASK: Display information about a virtual machine\n\nYou can see information about a virtual machine using the **Get-AzureVM** command. This command returns a virtual machine object that can be manipulated using various other cmdlets to update the state of the virtual machine. Replace everything within the quotes, including the < and > characters, with the correct names.\n\n    Get-AzureVM -ResourceGroupName \"<resource group name>\" -Name \"<VM name>\"\n\nYou will see information about your virtual machine like this:\n\n    AvailabilitySetReference : null\n    Extensions               : []\n    HardwareProfile          : {\n                                 \"VirtualMachineSize\": \"Standard_D1\"\n                               }\n    Id                       : /subscriptions/fd92919d-eeca-4f5b-840a-e45c6770d92e/resourceGroups/BuildRG/providers/Microso\n                               ft.Compute/virtualMachines/MyWindowsVM\n    InstanceView             : null\n    Location                 : westus\n    Name                     : MyWindowsVM\n    NetworkProfile           : {\n                                 \"NetworkInterfaces\": [\n                                   {\n                                     \"Primary\": null,\n                                     \"ReferenceUri\": \"/subscriptions/fd92919d-eeca-4f5b-840a-e45c6770d92e/resourceGroups/Bu\n                               ildRG/providers/Microsoft.Network/networkInterfaces/myVMNic\"\n                                   }\n                                 ]\n                               }\n    OSProfile                : {\n                                 \"AdminPassword\": null,\n                                 \"AdminUsername\": \"WinAdmin1\",\n                                 \"ComputerName\": \"MyWindowsVM\",\n                                 \"CustomData\": null,\n                                 \"LinuxConfiguration\": null,\n                                 \"Secrets\": [],\n                                 \"WindowsConfiguration\": {\n                                   \"AdditionalUnattendContents\": [],\n                                   \"EnableAutomaticUpdates\": true,\n                                   \"ProvisionVMAgent\": true,\n                                   \"TimeZone\": null,\n                                   \"WinRMConfiguration\": null\n                                 }\n                               }\n    Plan                     : null\n    ProvisioningState        : Succeeded\n    StorageProfile           : {\n                                 \"DataDisks\": [],\n                                 \"ImageReference\": {\n                                   \"Offer\": \"WindowsServer\",\n                                   \"Publisher\": \"MicrosoftWindowsServer\",\n                                   \"Sku\": \"2012-R2-Datacenter\",\n                                   \"Version\": \"latest\"\n                                 },\n                                 \"OSDisk\": {\n                                   \"OperatingSystemType\": \"Windows\",\n                                   \"Caching\": \"ReadWrite\",\n                                   \"CreateOption\": \"FromImage\",\n                                   \"Name\": \"osdisk\",\n                                   \"SourceImage\": null,\n                                   \"VirtualHardDisk\": {\n                                     \"Uri\": \"http://buildsaacct.blob.core.windows.net/vhds/osdiskforwindowssimple.vhd\"\n                                   }\n                                 },\n                                 \"SourceImage\": null\n                               }\n    Tags                     : {}\n    Type                     : Microsoft.Compute/virtualMachines\n\n\n## <a id=\"start\"></a>TASK: Start a virtual machine\n\nYou can start a virtual machine using the **Start-AzureVM** command.  Replace everything within the quotes, including the < and > characters, with the correct names.\n\n    Start-AzureVM -ResourceGroupName \"<resource group name>\" -Name \"<VM name>\"\n\nYou will see information like this:\n\n    EndTime             : 4/28/2015 11:11:41 AM -07:00\n    Error               :\n    Output              :\n    StartTime           : 4/28/2015 11:10:35 AM -07:00\n    Status              : Succeeded\n    TrackingOperationId : e1705973-d266-467e-8655-920016145347\n    RequestId           : aac41de1-b85d-4429-9a3d-040b922d2e6d\n    StatusCode          : OK\n\n## <a id=\"stop\"></a>TASK: Stop a virtual machine\n\nYou can stop a virtual machine using the **Stop-AzureVM** command.  Replace everything within the quotes, including the < and > characters, with the correct names.\n\n    Stop-AzureVM -ResourceGroupName \"<resource group name>\" -Name \"<VM name>\"\n\nYou will see information like this:\n\n    Virtual machine stopping operation\n    This cmdlet will stop the specified virtual machine. Do you want to continue?\n    [Y] Yes  [N] No  [S] Suspend  [?] Help (default is \"Y\"):\n\n\n    EndTime             : 4/28/2015 11:09:08 AM -07:00\n    Error               :\n    Output              :\n    StartTime           : 4/28/2015 11:06:55 AM -07:00\n    Status              : Succeeded\n    TrackingOperationId : 0c94dc74-c553-412c-a187-108bdb29657e\n    RequestId           : 5cc9ddba-0643-4b5e-82b6-287b321394ee\n    StatusCode          : OK\n\n## <a id=\"restart\"></a>TASK: Restart a virtual machine\n\nYou can restart a virtual machine using the **Restart-AzureVM** command. Replace everything within the quotes, including the < and > characters, with the correct name.\n\n    Restart-AzureVM -ResourceGroupName \"<resource group name>\" -Name \"<VM name>\"\n\nYou will see information like this:\n\n    EndTime             : 4/28/2015 11:16:26 AM -07:00\n    Error               :\n    Output              :\n    StartTime           : 4/28/2015 11:16:25 AM -07:00\n    Status              : Succeeded\n    TrackingOperationId : 390571e0-c804-43ce-88c5-f98e0feb588e\n    RequestId           : 7dac33e3-0164-4a08-be33-96205284cb0b\n    StatusCode          : OK\n\n## <a id=\"delete\"></a>TASK: Delete a virtual machine\n\nYou can delete a virtual machine using the **Remove-AzureVM** command. Replace everything within the quotes, including the < and > characters, with the correct name.  You can use the **-Force** parameter to skip the confirmation prompt.\n\n    Remove-AzureVM -ResourceGroupName \"<resource group name>\" –Name \"<VM name>\"\n\nYou will see information like this:\n\n    Virtual machine removal operation\n    This cmdlet will remove the specified virtual machine. Do you want to continue?\n    [Y] Yes  [N] No  [S] Suspend  [?] Help (default is \"Y\"):\n\n\n    EndTime             : 4/28/2015 11:21:55 AM -07:00\n    Error               :\n    Output              :\n    StartTime           : 4/28/2015 11:20:13 AM -07:00\n    Status              : Succeeded\n    TrackingOperationId : f74fad9e-f6bc-46ae-82b1-bfad3952aa44\n    RequestId           : 6a30d2e0-63ca-43cf-975b-058631e048e7\n    StatusCode          : OK\n\n## Additional resources\n\n[Azure compute, network and storage providers under Azure Resource Manager](virtual-machines-azurerm-versus-azuresm.md)\n\n[Azure Resource Manager overview](resource-group-overview.md)\n\n[Deploy and Manage Virtual Machines using Azure Resource Manager Templates and the Azure CLI](virtual-machines-deploy-rmtemplates-azure-cli.md)\n\n[Virtual machines documentation](http://azure.microsoft.com/documentation/services/virtual-machines/)\n\n[How to install and configure Azure PowerShell](install-configure-powershell.md)\n"
}