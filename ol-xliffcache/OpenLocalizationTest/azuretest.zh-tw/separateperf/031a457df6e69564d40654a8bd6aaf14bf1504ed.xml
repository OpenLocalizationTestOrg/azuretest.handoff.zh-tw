{
  "nodes": [
    {
      "content": "Use Script Action to install Solr on Hadoop cluster | Microsoft Azure",
      "pos": [
        28,
        97
      ]
    },
    {
      "content": "Learn how to customize HDInsight cluster with Solr.",
      "pos": [
        117,
        168
      ]
    },
    {
      "content": "You'll use a Script Action configuration option to use a script to install Solr.",
      "pos": [
        169,
        249
      ]
    },
    {
      "content": "Install and use Solr on HDInsight Hadoop clusters",
      "pos": [
        565,
        614
      ]
    },
    {
      "content": "You can install Solr on any type of cluster in Hadoop on Azure HDInsight by using <bpt id=\"p1\">**</bpt>Script Action<ept id=\"p1\">**</ept> cluster customization.",
      "pos": [
        616,
        738
      ]
    },
    {
      "content": "Script Action lets you run scripts to customize a cluster, only when the cluster is being created.",
      "pos": [
        739,
        837
      ]
    },
    {
      "content": "For more information, see <bpt id=\"p1\">[</bpt>Customize HDInsight cluster using script action<ept id=\"p1\">][hdinsight-cluster-customize]</ept>.",
      "pos": [
        838,
        943
      ]
    },
    {
      "content": "Install Solr on HDInsight clusters",
      "pos": [
        1032,
        1066
      ]
    },
    {
      "content": "In this topic, you will learn how to install Solr by using Script Action.",
      "pos": [
        1103,
        1176
      ]
    },
    {
      "content": "Solr is a powerful search platform and provides enterprise-level search capabilities on data managed by Hadoop.",
      "pos": [
        1177,
        1288
      ]
    },
    {
      "content": "Once you have installed Solr on HDInsight cluster, you'll also learn how to search data by using Solr.",
      "pos": [
        1289,
        1391
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The sample script used in this topic creates a Solr cluster with a specific configuration.",
      "pos": [
        1395,
        1498
      ]
    },
    {
      "content": "If you want to configure the Solr cluster with different collections, shards, schemas, replicas, etc., you must modify the script and Solr binaries accordingly.",
      "pos": [
        1499,
        1659
      ]
    },
    {
      "pos": [
        1665,
        1699
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"whatis\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>What is Solr?"
    },
    {
      "content": "<ph id=\"ph1\">&lt;a href=\"http://lucene.apache.org/solr/features.html\" target=\"_blank\"&gt;</ph>Apache Solr<ph id=\"ph2\">&lt;/a&gt;</ph> is an enterprise search platform that enables powerful full-text search on data.",
      "pos": [
        1701,
        1867
      ]
    },
    {
      "content": "While Hadoop enables storing and managing vast amounts of data, Apache Solr provides the search capabilities to quickly retrieve the data.",
      "pos": [
        1868,
        2006
      ]
    },
    {
      "content": "This topic provides instructions on how to customize an HDInsight cluster to install Solr.",
      "pos": [
        2007,
        2097
      ]
    },
    {
      "pos": [
        2105,
        2149
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"install\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How do I install Solr?"
    },
    {
      "content": "A sample script to install Solr on an HDInsight cluster is available from a read-only Azure storage blob at <bpt id=\"p1\">[</bpt>https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1<ept id=\"p1\">](https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1)</ept>.",
      "pos": [
        2151,
        2442
      ]
    },
    {
      "content": "This section provides instructions on how to use the sample script while provisioning the cluster by using the Azure portal.",
      "pos": [
        2443,
        2567
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The sample script works only with HDInsight cluster version 3.1.",
      "pos": [
        2573,
        2650
      ]
    },
    {
      "content": "For more information on HDInsight cluster versions, see <bpt id=\"p1\">[</bpt>HDInsight cluster versions<ept id=\"p1\">](hdinsight-component-versioning.md)</ept>.",
      "pos": [
        2651,
        2771
      ]
    },
    {
      "pos": [
        2777,
        2947
      ],
      "content": "Start provisioning a cluster by using the <bpt id=\"p1\">**</bpt>CUSTOM CREATE<ept id=\"p1\">**</ept> option, as described at <bpt id=\"p2\">[</bpt>Provisioning a cluster using custom options<ept id=\"p2\">](hdinsight-provision-clusters.md#portal)</ept>."
    },
    {
      "pos": [
        2952,
        3085
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Script Actions<ept id=\"p1\">**</ept> page of the wizard, click <bpt id=\"p2\">**</bpt>add script action<ept id=\"p2\">**</ept> to provide details about the script action, as shown below:"
    },
    {
      "content": "Use Script Action to customize a cluster",
      "pos": [
        3093,
        3133
      ]
    },
    {
      "pos": [
        3256,
        4121
      ],
      "content": "<table border='1'>\n     <tr><th>Property</th><th>Value</th></tr>\n     <tr><td>Name</td>\n         <td>Specify a name for the script action. For example, <b>Install Solr</b>.</td></tr>\n     <tr><td>Script URI</td>\n         <td>Specify the Uniform Resource Identifier (URI) to the script that is invoked to customize the cluster. For example, <i>https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1</i></td></tr>\n     <tr><td>Node Type</td>\n         <td>Specify the nodes on which the customization script is run. You can choose <b>All nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes only</b>.\n     <tr><td>Parameters</td>\n         <td>Specify the parameters, if required by the script. The script to install Solr does not require any parameters, so you can leave this blank.</td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Property",
          "pos": [
            32,
            40
          ]
        },
        {
          "content": "Value",
          "pos": [
            49,
            54
          ]
        },
        {
          "content": "Name",
          "pos": [
            78,
            82
          ]
        },
        {
          "content": "Specify a name for the script action. For example, <b>Install Solr</b>.",
          "pos": [
            101,
            172
          ],
          "nodes": [
            {
              "content": "Specify a name for the script action.",
              "pos": [
                0,
                37
              ]
            },
            {
              "content": "For example, <ph id=\"ph1\">&lt;b&gt;</ph>Install Solr<ph id=\"ph2\">&lt;/b&gt;</ph>.",
              "pos": [
                38,
                71
              ]
            }
          ]
        },
        {
          "content": "Script URI",
          "pos": [
            196,
            206
          ]
        },
        {
          "content": "Specify the Uniform Resource Identifier (URI) to the script that is invoked to customize the cluster. For example, <i>https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1</i>",
          "pos": [
            225,
            436
          ],
          "nodes": [
            {
              "content": "Specify the Uniform Resource Identifier (URI) to the script that is invoked to customize the cluster.",
              "pos": [
                0,
                101
              ]
            },
            {
              "content": "For example, <ph id=\"ph1\">&lt;i&gt;</ph>https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1<ph id=\"ph2\">&lt;/i&gt;</ph>",
              "pos": [
                102,
                211
              ]
            }
          ]
        },
        {
          "content": "Node Type",
          "pos": [
            460,
            469
          ]
        },
        {
          "content": "Specify the nodes on which the customization script is run. You can choose <b>All nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes only</b>.",
          "pos": [
            488,
            633
          ],
          "nodes": [
            {
              "content": "Specify the nodes on which the customization script is run.",
              "pos": [
                0,
                59
              ]
            },
            {
              "content": "You can choose <ph id=\"ph1\">&lt;b&gt;</ph>All nodes<ph id=\"ph2\">&lt;/b&gt;</ph>, <ph id=\"ph3\">&lt;b&gt;</ph>Head nodes only<ph id=\"ph4\">&lt;/b&gt;</ph>, or <ph id=\"ph5\">&lt;b&gt;</ph>Worker nodes only<ph id=\"ph6\">&lt;/b&gt;</ph>.",
              "pos": [
                60,
                145
              ]
            }
          ]
        },
        {
          "content": "Parameters",
          "pos": [
            647,
            657
          ]
        },
        {
          "content": "Specify the parameters, if required by the script. The script to install Solr does not require any parameters, so you can leave this blank.",
          "pos": [
            676,
            815
          ],
          "nodes": [
            {
              "content": "Specify the parameters, if required by the script.",
              "pos": [
                0,
                50
              ]
            },
            {
              "content": "The script to install Solr does not require any parameters, so you can leave this blank.",
              "pos": [
                51,
                139
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "You can add more than one script action to install multiple components on the cluster.",
      "pos": [
        4131,
        4217
      ]
    },
    {
      "content": "After you have added the scripts, click the checkmark to start provisioning the cluster.",
      "pos": [
        4218,
        4306
      ]
    },
    {
      "content": "You can also use the script to install Solr on HDInsight by using Azure PowerShell or the HDInsight .NET SDK.",
      "pos": [
        4308,
        4417
      ]
    },
    {
      "content": "Instructions for these procedures are provided later in this topic.",
      "pos": [
        4418,
        4485
      ]
    },
    {
      "pos": [
        4490,
        4543
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"usesolr\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>How do I use Solr in HDInsight?"
    },
    {
      "content": "You must start with indexing Solr with some data files.",
      "pos": [
        4545,
        4600
      ]
    },
    {
      "content": "You can then use Solr to run search queries on the indexed data.",
      "pos": [
        4601,
        4665
      ]
    },
    {
      "content": "Perform the following steps to use Solr in an HDInsight cluster:",
      "pos": [
        4666,
        4730
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Use Remote Desktop Protocol (RDP) to remote into the HDInsight cluster with Solr installed<ept id=\"p1\">**</ept>.",
      "pos": [
        4735,
        4830
      ]
    },
    {
      "content": "From the Azure portal, enable Remote Desktop for the cluster you created with Solr installed, and then remote into the cluster.",
      "pos": [
        4831,
        4958
      ]
    },
    {
      "content": "For instructions, see <ph id=\"ph1\">&lt;a href=\"http://azure.microsoft.com/documentation/articles/hdinsight-administer-use-management-portal/#rdp\" target=\"_blank\"&gt;</ph>Connect to HDInsight clusters using RDP<ph id=\"ph2\">&lt;/a&gt;</ph>.",
      "pos": [
        4959,
        5149
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Index Solr by uploading data files<ept id=\"p1\">**</ept>.",
      "pos": [
        5154,
        5193
      ]
    },
    {
      "content": "When you index Solr, you put documents in it that you may need to search on.",
      "pos": [
        5194,
        5270
      ]
    },
    {
      "content": "To index Solr, use RDP to remote into the cluster, navigate to the desktop, open the Hadoop command line, and navigate to <bpt id=\"p1\">**</bpt>C:\\apps\\dist\\solr-4.7.2\\example\\exampledocs<ept id=\"p1\">**</ept>.",
      "pos": [
        5271,
        5441
      ]
    },
    {
      "content": "Run the following command:",
      "pos": [
        5442,
        5468
      ]
    },
    {
      "content": "You'll see the following output on the console:",
      "pos": [
        5528,
        5575
      ]
    },
    {
      "content": "The post.jar utility indexes Solr with two sample documents, <bpt id=\"p1\">**</bpt>solr.xml<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>monitor.xml<ept id=\"p2\">**</ept>.",
      "pos": [
        5779,
        5873
      ]
    },
    {
      "content": "The post.jar utility and the sample documents are available with Solr installation.",
      "pos": [
        5874,
        5957
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Use the Solr dashboard to search within the indexed documents<ept id=\"p1\">**</ept>.",
      "pos": [
        5962,
        6028
      ]
    },
    {
      "content": "In the RDP session to the HDInsight cluster, open Internet Explorer, and launch the Solr dashboard at <bpt id=\"p1\">**</bpt>http://headnodehost:8983/solr/#/<ept id=\"p1\">**</ept>.",
      "pos": [
        6029,
        6168
      ]
    },
    {
      "content": "From the left pane, from the <bpt id=\"p1\">**</bpt>Core Selector<ept id=\"p1\">**</ept> drop-down, select <bpt id=\"p2\">**</bpt>collection1<ept id=\"p2\">**</ept>, and within that, click <bpt id=\"p3\">**</bpt>Query<ept id=\"p3\">**</ept>.",
      "pos": [
        6169,
        6284
      ]
    },
    {
      "content": "As an example, to select and return all the docs in Solr, provide the following values:",
      "pos": [
        6285,
        6372
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>q<ept id=\"p1\">**</ept> text box, enter <bpt id=\"p2\">**</bpt>\\*:<ept id=\"p2\">**</ept>\\*.",
      "pos": [
        6380,
        6419
      ]
    },
    {
      "content": "This will return all the documents that are indexed in Solr.",
      "pos": [
        6420,
        6480
      ]
    },
    {
      "content": "If you want to search for a specific string within the documents, you can enter that string here.",
      "pos": [
        6481,
        6578
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>wt<ept id=\"p1\">**</ept> text box, select the output format.",
      "pos": [
        6586,
        6635
      ]
    },
    {
      "content": "Default is <bpt id=\"p1\">**</bpt>json<ept id=\"p1\">**</ept>.",
      "pos": [
        6636,
        6656
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Execute Query<ept id=\"p1\">**</ept>.",
      "pos": [
        6657,
        6681
      ]
    },
    {
      "content": "Use Script Action to customize a cluster",
      "pos": [
        6693,
        6733
      ]
    },
    {
      "content": "The output returns the two docs that we used for indexing Solr.",
      "pos": [
        6847,
        6910
      ]
    },
    {
      "content": "The output resembles the following:",
      "pos": [
        6911,
        6946
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Recommended: Back up the indexed data from Solr to Azure Blob storage associated with the HDInsight cluster<ept id=\"p1\">**</ept>.",
      "pos": [
        9134,
        9246
      ]
    },
    {
      "content": "As a good practice, you should back up the indexed data from the Solr cluster nodes onto Azure Blob storage.",
      "pos": [
        9247,
        9355
      ]
    },
    {
      "content": "Perform the following steps to do so:",
      "pos": [
        9356,
        9393
      ]
    },
    {
      "content": "From the RDP session, open Internet Explorer, and point to the following URL:",
      "pos": [
        9402,
        9479
      ]
    },
    {
      "content": "You should see a response like this:",
      "pos": [
        9556,
        9592
      ]
    },
    {
      "content": "In the remote session, navigate to {SOLR_HOME}\\{Collection}\\data.",
      "pos": [
        9890,
        9955
      ]
    },
    {
      "content": "For the cluster created via the sample script, this should be <bpt id=\"p1\">**</bpt>C:\\apps\\dist\\solr-4.7.2\\example\\solr\\collection1\\data<ept id=\"p1\">**</ept>.",
      "pos": [
        9956,
        10076
      ]
    },
    {
      "content": "At this location, you should see a snapshot folder created with a name similar to <bpt id=\"p1\">*</bpt><bpt id=\"p2\">*</bpt>snapshot.<ept id=\"p2\">*</ept>timestamp<ept id=\"p1\">*</ept>**.",
      "pos": [
        10077,
        10184
      ]
    },
    {
      "content": "Zip the snapshot folder and upload it to Azure Blob storage.",
      "pos": [
        10197,
        10257
      ]
    },
    {
      "content": "From the Hadoop command line, navigate to the location of the snapshot folder by using the following command:",
      "pos": [
        10258,
        10367
      ]
    },
    {
      "content": "This command copies the snapshot to /example/data/ under the container within the default Storage account associated with the cluster.",
      "pos": [
        10456,
        10590
      ]
    },
    {
      "pos": [
        10595,
        10684
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"usingPS\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Install Solr on HDInsight Hadoop clusters by using Azure PowerShell"
    },
    {
      "content": "In this section we use the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&lt;a href = \"http://msdn.microsoft.com/library/dn858088.aspx\" target=\"_blank\"&gt;</ph>Add-AzureHDInsightScriptAction<ph id=\"ph2\">&lt;/a&gt;</ph><ept id=\"p1\">**</ept> cmdlet to invoke scripts by using Script Action to customize a cluster.",
      "pos": [
        10686,
        10899
      ]
    },
    {
      "content": "Before proceeding, make sure you have installed and configured Azure PowerShell.",
      "pos": [
        10900,
        10980
      ]
    },
    {
      "content": "For information on configuring a workstation to run HDInsight Windows PowerShell cmdlets, see <bpt id=\"p1\">[</bpt>Install and configure Azure PowerShell<ept id=\"p1\">][powershell-install-configure]</ept>.",
      "pos": [
        10981,
        11146
      ]
    },
    {
      "content": "Perform the following steps:",
      "pos": [
        11148,
        11176
      ]
    },
    {
      "content": "Open an Azure PowerShell window and declare the following variables:",
      "pos": [
        11181,
        11249
      ]
    },
    {
      "content": "Specify the configuration values such as nodes in the cluster and the default storage to be used.",
      "pos": [
        12039,
        12136
      ]
    },
    {
      "content": "Use the <bpt id=\"p1\">**</bpt>Add-AzureHDInsightScriptAction<ept id=\"p1\">**</ept> cmdlet to add a script action to the cluster configuration.",
      "pos": [
        12575,
        12677
      ]
    },
    {
      "content": "Later, when the cluster is being created, the script action gets executed.",
      "pos": [
        12678,
        12752
      ]
    },
    {
      "pos": [
        13043,
        13120
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Add-AzureHDInsightScriptAction<ept id=\"p1\">**</ept> cmdlet takes the following parameters:"
    },
    {
      "pos": [
        13126,
        15520
      ],
      "content": "<table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n <tr>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Parameter</th>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:550px; padding-left:5px; padding-right:5px;\">Definition</th></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Config</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Configuration object to which script action information is added.</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name of the script action.</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">ClusterRoleCollection</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Nodes on which the customization script is run. The valid values are HeadNode (to install on the head node) or DataNode (to install on all the data nodes). You can use either or both values.</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Uri</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">URI to the script that is executed.</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters required by the script. The sample script used in this topic does not require any parameters, and hence you do not see this parameter in the snippet above.\n </td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Parameter",
          "pos": [
            264,
            273
          ]
        },
        {
          "content": "Definition",
          "pos": [
            432,
            442
          ]
        },
        {
          "content": "Config",
          "pos": [
            580,
            586
          ]
        },
        {
          "content": "Configuration object to which script action information is added.",
          "pos": [
            732,
            797
          ]
        },
        {
          "content": "Name",
          "pos": [
            935,
            939
          ]
        },
        {
          "content": "Name of the script action.",
          "pos": [
            1066,
            1092
          ]
        },
        {
          "content": "ClusterRoleCollection",
          "pos": [
            1230,
            1251
          ]
        },
        {
          "content": "Nodes on which the customization script is run. The valid values are HeadNode (to install on the head node) or DataNode (to install on all the data nodes). You can use either or both values.",
          "pos": [
            1378,
            1568
          ],
          "nodes": [
            {
              "content": "Nodes on which the customization script is run.",
              "pos": [
                0,
                47
              ]
            },
            {
              "content": "The valid values are HeadNode (to install on the head node) or DataNode (to install on all the data nodes).",
              "pos": [
                48,
                155
              ]
            },
            {
              "content": "You can use either or both values.",
              "pos": [
                156,
                190
              ]
            }
          ]
        },
        {
          "content": "Uri",
          "pos": [
            1706,
            1709
          ]
        },
        {
          "content": "URI to the script that is executed.",
          "pos": [
            1836,
            1871
          ]
        },
        {
          "content": "Parameters",
          "pos": [
            2009,
            2019
          ]
        },
        {
          "content": "Parameters required by the script. The sample script used in this topic does not require any parameters, and hence you do not see this parameter in the snippet above.",
          "pos": [
            2146,
            2312
          ],
          "nodes": [
            {
              "content": "Parameters required by the script.",
              "pos": [
                0,
                34
              ]
            },
            {
              "content": "The sample script used in this topic does not require any parameters, and hence you do not see this parameter in the snippet above.",
              "pos": [
                35,
                166
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "Finally, start provisioning a customized cluster with Solr installed.",
      "pos": [
        15529,
        15598
      ]
    },
    {
      "content": "When prompted, enter the credentials for the cluster.",
      "pos": [
        15774,
        15827
      ]
    },
    {
      "content": "It can take several minutes before the cluster is created.",
      "pos": [
        15828,
        15886
      ]
    },
    {
      "pos": [
        15892,
        15978
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"usingSDK\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Install Solr on HDInsight Hadoop clusters by using the .NET SDK"
    },
    {
      "content": "The HDInsight .NET SDK provides .NET client libraries that make it easier to work with HDInsight from a .NET Framework application.",
      "pos": [
        15980,
        16111
      ]
    },
    {
      "content": "This section provides instructions on how to use Script Action from the SDK to provision a cluster that has Solr installed.",
      "pos": [
        16112,
        16235
      ]
    },
    {
      "content": "The following procedures must be performed:",
      "pos": [
        16236,
        16279
      ]
    },
    {
      "content": "Install the HDInsight .NET SDK",
      "pos": [
        16283,
        16313
      ]
    },
    {
      "content": "Create a self-signed certificate",
      "pos": [
        16316,
        16348
      ]
    },
    {
      "content": "Create a console application",
      "pos": [
        16351,
        16379
      ]
    },
    {
      "content": "Run the application",
      "pos": [
        16382,
        16401
      ]
    },
    {
      "content": "To install the HDInsight .NET SDK",
      "pos": [
        16406,
        16439
      ]
    },
    {
      "content": "You can install the latest published build of the SDK from <bpt id=\"p1\">[</bpt>NuGet<ept id=\"p1\">](http://nuget.codeplex.com/wikipage?title=Getting%20Started)</ept>.",
      "pos": [
        16443,
        16570
      ]
    },
    {
      "content": "The instructions will be shown in the next procedure.",
      "pos": [
        16571,
        16624
      ]
    },
    {
      "content": "To create a self-signed certificate",
      "pos": [
        16628,
        16663
      ]
    },
    {
      "content": "Create a self-signed certificate, install it on your workstation, and upload it to your Azure subscription.",
      "pos": [
        16667,
        16774
      ]
    },
    {
      "content": "For instructions, see <bpt id=\"p1\">[</bpt>Create a self-signed certificate<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=511138)</ept>.",
      "pos": [
        16775,
        16879
      ]
    },
    {
      "content": "To create a Visual Studio application",
      "pos": [
        16885,
        16922
      ]
    },
    {
      "content": "Open Visual Studio 2013.",
      "pos": [
        16929,
        16953
      ]
    },
    {
      "pos": [
        16958,
        17024
      ],
      "content": "From the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Project<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        17029,
        17087
      ],
      "content": "From <bpt id=\"p1\">**</bpt>New Project<ept id=\"p1\">**</ept>, type or select the following values:"
    },
    {
      "pos": [
        17097,
        18488
      ],
      "content": "<table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n <tr>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Property</th>\n <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Value</th></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Category</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Templates/Visual C#/Windows</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Template</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Console Application</td></tr>\n <tr>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">CreateSolrCluster</td></tr>\n </table>",
      "leadings": [
        "",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "Property",
          "pos": [
            264,
            272
          ]
        },
        {
          "content": "Value",
          "pos": [
            430,
            435
          ]
        },
        {
          "content": "Category",
          "pos": [
            573,
            581
          ]
        },
        {
          "content": "Templates/Visual C#/Windows",
          "pos": [
            727,
            754
          ]
        },
        {
          "content": "Template",
          "pos": [
            892,
            900
          ]
        },
        {
          "content": "Console Application",
          "pos": [
            1027,
            1046
          ]
        },
        {
          "content": "Name",
          "pos": [
            1184,
            1188
          ]
        },
        {
          "content": "CreateSolrCluster",
          "pos": [
            1315,
            1332
          ]
        }
      ]
    },
    {
      "pos": [
        18493,
        18528
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to create the project."
    },
    {
      "pos": [
        18533,
        18634
      ],
      "content": "From the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Nuget Package Manager<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Package Manager Console<ept id=\"p3\">**</ept>."
    },
    {
      "content": "Run the following command in the console to install the package:",
      "pos": [
        18639,
        18703
      ]
    },
    {
      "content": "This command adds the .NET libraries and references to them from the current Visual Studio project.",
      "pos": [
        18778,
        18877
      ]
    },
    {
      "pos": [
        18887,
        18950
      ],
      "content": "From Solution Explorer, double-click <bpt id=\"p1\">**</bpt>Program.cs<ept id=\"p1\">**</ept> to open it."
    },
    {
      "content": "Add the following using statements to the top of the file:",
      "pos": [
        18955,
        19013
      ]
    },
    {
      "content": "In the Main() function, copy and paste the following code, and provide values for the variables:",
      "pos": [
        19299,
        19395
      ]
    },
    {
      "pos": [
        21042,
        21287
      ],
      "content": "Append the following code to the Main() function to use the <bpt id=\"p1\">[</bpt>ScriptAction<ept id=\"p1\">](http://msdn.microsoft.com/library/microsoft.windowsazure.management.hdinsight.clusterprovisioning.data.scriptaction.aspx)</ept> class to invoke a custom script to install Solr."
    },
    {
      "content": "Finally, create the cluster.",
      "pos": [
        21817,
        21845
      ]
    },
    {
      "content": "Save changes to the application and build the solution.",
      "pos": [
        21895,
        21950
      ]
    },
    {
      "content": "To run the application",
      "pos": [
        21955,
        21977
      ]
    },
    {
      "content": "Open a Windows PowerShell or Azure PowerShell console, navigate to the location where you saved the Visual Studio project, navigate to the \\bin\\debug directory within the project, and then run the following command:",
      "pos": [
        21981,
        22196
      ]
    },
    {
      "content": "Provide a cluster name and press ENTER to provision a cluster with Solr installed.",
      "pos": [
        22238,
        22320
      ]
    },
    {
      "content": "See also",
      "pos": [
        22326,
        22334
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Install and use Spark on HDInsight clusters<ept id=\"p1\">][hdinsight-install-spark]</ept>.",
      "pos": [
        22339,
        22410
      ]
    },
    {
      "content": "Use cluster customization to install Spark on HDInsight Hadoop clusters.",
      "pos": [
        22411,
        22483
      ]
    },
    {
      "content": "Spark is an open-source parallel processing framework that supports in-memory processing to boost the performance of big-data analytic applications.",
      "pos": [
        22484,
        22632
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Install R on HDInsight clusters<ept id=\"p1\">][hdinsight-install-r]</ept>.",
      "pos": [
        22635,
        22690
      ]
    },
    {
      "content": "Use cluster customization to install R on HDInsight Hadoop clusters.",
      "pos": [
        22691,
        22759
      ]
    },
    {
      "content": "R is an open-source language and environment for statistical computing.",
      "pos": [
        22760,
        22831
      ]
    },
    {
      "content": "It provides hundreds of built-in statistical functions and its own programming language that combines aspects of functional and object-oriented programming.",
      "pos": [
        22832,
        22988
      ]
    },
    {
      "content": "It also provides extensive graphical capabilities.",
      "pos": [
        22989,
        23039
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Install Giraph on HDInsight clusters<ept id=\"p1\">](hdinsight-hadoop-giraph-install.md)</ept>.",
      "pos": [
        23042,
        23117
      ]
    },
    {
      "content": "Use cluster customization to install Giraph on HDInsight Hadoop clusters.",
      "pos": [
        23118,
        23191
      ]
    },
    {
      "content": "Giraph allows you to perform graph processing by using Hadoop, and can be used with Azure HDInsight.",
      "pos": [
        23192,
        23292
      ]
    },
    {
      "content": "test",
      "pos": [
        23603,
        23607
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Use Script Action to install Solr on Hadoop cluster | Microsoft Azure\" \n    description=\"Learn how to customize HDInsight cluster with Solr. You'll use a Script Action configuration option to use a script to install Solr.\" \n    services=\"hdinsight\" \n    documentationCenter=\"\" \n    authors=\"nitinme\" \n    manager=\"paulettm\" \n    editor=\"cgronlun\"/>\n\n<tags \n    ms.service=\"hdinsight\" \n    ms.workload=\"big-data\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"08/07/2015\" \n    ms.author=\"nitinme\"/>\n\n# Install and use Solr on HDInsight Hadoop clusters\n\nYou can install Solr on any type of cluster in Hadoop on Azure HDInsight by using **Script Action** cluster customization. Script Action lets you run scripts to customize a cluster, only when the cluster is being created. For more information, see [Customize HDInsight cluster using script action][hdinsight-cluster-customize].\n\n[AZURE.INCLUDE [hdinsight-azure-portal](../../includes/hdinsight-azure-portal.md)]\n\n* [Install Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md)\n\nIn this topic, you will learn how to install Solr by using Script Action. Solr is a powerful search platform and provides enterprise-level search capabilities on data managed by Hadoop. Once you have installed Solr on HDInsight cluster, you'll also learn how to search data by using Solr.\n\n> [AZURE.NOTE] The sample script used in this topic creates a Solr cluster with a specific configuration. If you want to configure the Solr cluster with different collections, shards, schemas, replicas, etc., you must modify the script and Solr binaries accordingly.\n\n\n## <a name=\"whatis\"></a>What is Solr?\n\n<a href=\"http://lucene.apache.org/solr/features.html\" target=\"_blank\">Apache Solr</a> is an enterprise search platform that enables powerful full-text search on data. While Hadoop enables storing and managing vast amounts of data, Apache Solr provides the search capabilities to quickly retrieve the data. This topic provides instructions on how to customize an HDInsight cluster to install Solr.   \n\n## <a name=\"install\"></a>How do I install Solr?\n\nA sample script to install Solr on an HDInsight cluster is available from a read-only Azure storage blob at [https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1](https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1). This section provides instructions on how to use the sample script while provisioning the cluster by using the Azure portal. \n\n\n> [AZURE.NOTE] The sample script works only with HDInsight cluster version 3.1. For more information on HDInsight cluster versions, see [HDInsight cluster versions](hdinsight-component-versioning.md).\n\n\n1. Start provisioning a cluster by using the **CUSTOM CREATE** option, as described at [Provisioning a cluster using custom options](hdinsight-provision-clusters.md#portal). \n2. On the **Script Actions** page of the wizard, click **add script action** to provide details about the script action, as shown below:\n\n    ![Use Script Action to customize a cluster](./media/hdinsight-hadoop-solr-install-v1/hdi-script-action-solr.png \"Use Script Action to customize a cluster\")\n    \n    <table border='1'>\n        <tr><th>Property</th><th>Value</th></tr>\n        <tr><td>Name</td>\n            <td>Specify a name for the script action. For example, <b>Install Solr</b>.</td></tr>\n        <tr><td>Script URI</td>\n            <td>Specify the Uniform Resource Identifier (URI) to the script that is invoked to customize the cluster. For example, <i>https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1</i></td></tr>\n        <tr><td>Node Type</td>\n            <td>Specify the nodes on which the customization script is run. You can choose <b>All nodes</b>, <b>Head nodes only</b>, or <b>Worker nodes only</b>.\n        <tr><td>Parameters</td>\n            <td>Specify the parameters, if required by the script. The script to install Solr does not require any parameters, so you can leave this blank.</td></tr>\n    </table>    \n\n    You can add more than one script action to install multiple components on the cluster. After you have added the scripts, click the checkmark to start provisioning the cluster.\n\nYou can also use the script to install Solr on HDInsight by using Azure PowerShell or the HDInsight .NET SDK. Instructions for these procedures are provided later in this topic.\n\n## <a name=\"usesolr\"></a>How do I use Solr in HDInsight?\n\nYou must start with indexing Solr with some data files. You can then use Solr to run search queries on the indexed data. Perform the following steps to use Solr in an HDInsight cluster:\n\n1. **Use Remote Desktop Protocol (RDP) to remote into the HDInsight cluster with Solr installed**. From the Azure portal, enable Remote Desktop for the cluster you created with Solr installed, and then remote into the cluster. For instructions, see <a href=\"http://azure.microsoft.com/documentation/articles/hdinsight-administer-use-management-portal/#rdp\" target=\"_blank\">Connect to HDInsight clusters using RDP</a>.\n\n2. **Index Solr by uploading data files**. When you index Solr, you put documents in it that you may need to search on. To index Solr, use RDP to remote into the cluster, navigate to the desktop, open the Hadoop command line, and navigate to **C:\\apps\\dist\\solr-4.7.2\\example\\exampledocs**. Run the following command: \n    \n        java -jar post.jar solr.xml monitor.xml\n\n    You'll see the following output on the console:\n\n        POSTing file solr.xml\n        POSTing file monitor.xml\n        2 files indexed.\n        COMMITting Solr index changes to http://localhost:8983/solr/update..\n        Time spent: 0:00:01.624\n\n    The post.jar utility indexes Solr with two sample documents, **solr.xml** and **monitor.xml**. The post.jar utility and the sample documents are available with Solr installation.\n\n3. **Use the Solr dashboard to search within the indexed documents**. In the RDP session to the HDInsight cluster, open Internet Explorer, and launch the Solr dashboard at **http://headnodehost:8983/solr/#/**. From the left pane, from the **Core Selector** drop-down, select **collection1**, and within that, click **Query**. As an example, to select and return all the docs in Solr, provide the following values:\n    1. In the **q** text box, enter **\\*:**\\*. This will return all the documents that are indexed in Solr. If you want to search for a specific string within the documents, you can enter that string here.\n    2. In the **wt** text box, select the output format. Default is **json**. Click **Execute Query**.\n\n        ![Use Script Action to customize a cluster](./media/hdinsight-hadoop-solr-install-v1/hdi-solr-dashboard-query.png \"Run a query on Solr dashboard\")\n    \n    The output returns the two docs that we used for indexing Solr. The output resembles the following:\n\n            \"response\": {\n                \"numFound\": 2,\n                \"start\": 0,\n                \"maxScore\": 1,\n                \"docs\": [\n                  {\n                    \"id\": \"SOLR1000\",\n                    \"name\": \"Solr, the Enterprise Search Server\",\n                    \"manu\": \"Apache Software Foundation\",\n                    \"cat\": [\n                      \"software\",\n                      \"search\"\n                    ],\n                    \"features\": [\n                      \"Advanced Full-Text Search Capabilities using Lucene\",\n                      \"Optimized for High Volume Web Traffic\",\n                      \"Standards Based Open Interfaces - XML and HTTP\",\n                      \"Comprehensive HTML Administration Interfaces\",\n                      \"Scalability - Efficient Replication to other Solr Search Servers\",\n                      \"Flexible and Adaptable with XML configuration and Schema\",\n                      \"Good unicode support: héllo (hello with an accent over the e)\"\n                    ],\n                    \"price\": 0,\n                    \"price_c\": \"0,USD\",\n                    \"popularity\": 10,\n                    \"inStock\": true,\n                    \"incubationdate_dt\": \"2006-01-17T00:00:00Z\",\n                    \"_version_\": 1486960636996878300\n                  },\n                  {\n                    \"id\": \"3007WFP\",\n                    \"name\": \"Dell Widescreen UltraSharp 3007WFP\",\n                    \"manu\": \"Dell, Inc.\",\n                    \"manu_id_s\": \"dell\",\n                    \"cat\": [\n                      \"electronics and computer1\"\n                    ],\n                    \"features\": [\n                      \"30\\\" TFT active matrix LCD, 2560 x 1600, .25mm dot pitch, 700:1 contrast\"\n                    ],\n                    \"includes\": \"USB cable\",\n                    \"weight\": 401.6,\n                    \"price\": 2199,\n                    \"price_c\": \"2199,USD\",\n                    \"popularity\": 6,\n                    \"inStock\": true,\n                    \"store\": \"43.17614,-90.57341\",\n                    \"_version_\": 1486960637584081000\n                  }\n                ]\n              }\n   \n\n4. **Recommended: Back up the indexed data from Solr to Azure Blob storage associated with the HDInsight cluster**. As a good practice, you should back up the indexed data from the Solr cluster nodes onto Azure Blob storage. Perform the following steps to do so:\n\n    1. From the RDP session, open Internet Explorer, and point to the following URL:\n\n            http://localhost:8983/solr/replication?command=backup\n\n        You should see a response like this:\n\n            <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n            <response>\n              <lst name=\"responseHeader\">\n                <int name=\"status\">0</int>\n                <int name=\"QTime\">9</int>\n              </lst>\n              <str name=\"status\">OK</str>\n            </response>\n\n    2. In the remote session, navigate to {SOLR_HOME}\\{Collection}\\data. For the cluster created via the sample script, this should be **C:\\apps\\dist\\solr-4.7.2\\example\\solr\\collection1\\data**. At this location, you should see a snapshot folder created with a name similar to **snapshot.*timestamp***.\n    \n    3. Zip the snapshot folder and upload it to Azure Blob storage. From the Hadoop command line, navigate to the location of the snapshot folder by using the following command:\n\n              hadoop fs -CopyFromLocal snapshot._timestamp_.zip /example/data\n\n        This command copies the snapshot to /example/data/ under the container within the default Storage account associated with the cluster.\n\n## <a name=\"usingPS\"></a>Install Solr on HDInsight Hadoop clusters by using Azure PowerShell\n\nIn this section we use the **<a href = \"http://msdn.microsoft.com/library/dn858088.aspx\" target=\"_blank\">Add-AzureHDInsightScriptAction</a>** cmdlet to invoke scripts by using Script Action to customize a cluster. Before proceeding, make sure you have installed and configured Azure PowerShell. For information on configuring a workstation to run HDInsight Windows PowerShell cmdlets, see [Install and configure Azure PowerShell][powershell-install-configure].\n\nPerform the following steps:\n\n1. Open an Azure PowerShell window and declare the following variables:\n\n        # PROVIDE VALUES FOR THESE VARIABLES\n        $subscriptionName = \"<SubscriptionName>\"        # Name of the Azure subscription\n        $clusterName = \"<HDInsightClusterName>\"         # HDInsight cluster name\n        $storageAccountName = \"<StorageAccountName>\"    # Azure Storage account that hosts the default container\n        $storageAccountKey = \"<StorageAccountKey>\"      # Key for the Storage account\n        $containerName = $clusterName\n        $location = \"<MicrosoftDataCenter>\"             # Location of the HDInsight cluster. It must be in the same data center as the Storage account.\n        $clusterNodes = <ClusterSizeInNumbers>          # Number of nodes in the HDInsight cluster\n        $version = \"<HDInsightClusterVersion>\"          # For example, \"3.1\"\n    \n2. Specify the configuration values such as nodes in the cluster and the default storage to be used.\n\n        # Specify the configuration options\n        Select-AzureSubscription $subscriptionName\n        $config = New-AzureHDInsightClusterConfig -ClusterSizeInNodes $clusterNodes\n        $config.DefaultStorageAccount.StorageAccountName=\"$storageAccountName.blob.core.windows.net\"\n        $config.DefaultStorageAccount.StorageAccountKey=$storageAccountKey\n        $config.DefaultStorageAccount.StorageContainerName=$containerName\n    \n3. Use the **Add-AzureHDInsightScriptAction** cmdlet to add a script action to the cluster configuration. Later, when the cluster is being created, the script action gets executed. \n\n        # Add the script action to the cluster configuration\n        $config = Add-AzureHDInsightScriptAction -Config $config -Name \"Install Solr\" -ClusterRoleCollection HeadNode,DataNode -Uri https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1\n\n    The **Add-AzureHDInsightScriptAction** cmdlet takes the following parameters:\n\n    <table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n    <tr>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Parameter</th>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:550px; padding-left:5px; padding-right:5px;\">Definition</th></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Config</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Configuration object to which script action information is added.</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name of the script action.</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">ClusterRoleCollection</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Nodes on which the customization script is run. The valid values are HeadNode (to install on the head node) or DataNode (to install on all the data nodes). You can use either or both values.</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Uri</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">URI to the script that is executed.</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Parameters required by the script. The sample script used in this topic does not require any parameters, and hence you do not see this parameter in the snippet above.\n    </td></tr>\n    </table>\n    \n4. Finally, start provisioning a customized cluster with Solr installed.  \n    \n        # Start provisioning a cluster with Solr installed\n        New-AzureHDInsightCluster -Config $config -Name $clusterName -Location $location -Version $version \n\nWhen prompted, enter the credentials for the cluster. It can take several minutes before the cluster is created.\n\n\n## <a name=\"usingSDK\"></a>Install Solr on HDInsight Hadoop clusters by using the .NET SDK\n\nThe HDInsight .NET SDK provides .NET client libraries that make it easier to work with HDInsight from a .NET Framework application. This section provides instructions on how to use Script Action from the SDK to provision a cluster that has Solr installed. The following procedures must be performed:\n\n- Install the HDInsight .NET SDK\n- Create a self-signed certificate\n- Create a console application\n- Run the application\n\n\n**To install the HDInsight .NET SDK**\n\nYou can install the latest published build of the SDK from [NuGet](http://nuget.codeplex.com/wikipage?title=Getting%20Started). The instructions will be shown in the next procedure.\n\n**To create a self-signed certificate**\n\nCreate a self-signed certificate, install it on your workstation, and upload it to your Azure subscription. For instructions, see [Create a self-signed certificate](http://go.microsoft.com/fwlink/?LinkId=511138). \n\n\n**To create a Visual Studio application**\n\n1. Open Visual Studio 2013.\n\n2. From the **File** menu, click **New**, and then click **Project**.\n\n3. From **New Project**, type or select the following values:\n    \n    <table style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse;\">\n    <tr>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Property</th>\n    <th style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; width:90px; padding-left:5px; padding-right:5px;\">Value</th></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Category</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px; padding-right:5px;\">Templates/Visual C#/Windows</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Template</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Console Application</td></tr>\n    <tr>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">Name</td>\n    <td style=\"border-color: #c6c6c6; border-width: 2px; border-style: solid; border-collapse: collapse; padding-left:5px;\">CreateSolrCluster</td></tr>\n    </table>\n\n4. Click **OK** to create the project.\n\n5. From the **Tools** menu, click **Nuget Package Manager**, and then click **Package Manager Console**.\n\n6. Run the following command in the console to install the package:\n\n        Install-Package Microsoft.WindowsAzure.Management.HDInsight\n\n    This command adds the .NET libraries and references to them from the current Visual Studio project.\n\n    \n7. From Solution Explorer, double-click **Program.cs** to open it.\n\n8. Add the following using statements to the top of the file:\n\n        using System.Security.Cryptography.X509Certificates;\n        using Microsoft.WindowsAzure.Management.HDInsight;\n        using Microsoft.WindowsAzure.Management.HDInsight.ClusterProvisioning;\n        using Microsoft.WindowsAzure.Management.HDInsight.Framework.Logging;\n    \n9. In the Main() function, copy and paste the following code, and provide values for the variables:\n        \n        var clusterName = args[0];\n\n        // Provide values for the variables\n        string thumbprint = \"<CertificateThumbprint>\";  \n        string subscriptionId = \"<AzureSubscriptionID>\";\n        string location = \"<MicrosoftDataCenterLocation>\";\n        string storageaccountname = \"<AzureStorageAccountName>.blob.core.windows.net\";\n        string storageaccountkey = \"<AzureStorageAccountKey>\";\n        string username = \"<HDInsightUsername>\";\n        string password = \"<HDInsightUserPassword>\";\n        int clustersize = <NumberOfNodesInTheCluster>;\n\n        // Provide the certificate thumbprint to retrieve the certificate from the certificate store \n        X509Store store = new X509Store();\n        store.Open(OpenFlags.ReadOnly);\n        X509Certificate2 cert = store.Certificates.Cast<X509Certificate2>().First(item => item.Thumbprint == thumbprint);\n\n        // Create an HDInsight client object\n        HDInsightCertificateCredential creds = new HDInsightCertificateCredential(new Guid(subscriptionId), cert);\n        var client = HDInsightClient.Connect(creds);\n        client.IgnoreSslErrors = true;\n        \n        // Provide the cluster information\n        var clusterInfo = new ClusterCreateParameters()\n        {\n            Name = clusterName,\n            Location = location,\n            DefaultStorageAccountName = storageaccountname,\n            DefaultStorageAccountKey = storageaccountkey,\n            DefaultStorageContainer = clusterName,\n            UserName = username,\n            Password = password,\n            ClusterSizeInNodes = clustersize,\n            Version = \"3.1\"\n        };        \n\n10. Append the following code to the Main() function to use the [ScriptAction](http://msdn.microsoft.com/library/microsoft.windowsazure.management.hdinsight.clusterprovisioning.data.scriptaction.aspx) class to invoke a custom script to install Solr.\n\n        // Add the script action to install Solr\n        clusterInfo.ConfigActions.Add(new ScriptAction(\n          \"Install Solr\", // Name of the config action\n          new ClusterNodeType[] { ClusterNodeType.HeadNode, ClusterNodeType.DataNode }, // List of nodes to install Solr on\n          new Uri(\"https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1\"), // Location of the script to install Solr\n          null //Because the script used does not require any parameters\n        ));\n\n11. Finally, create the cluster.\n\n        client.CreateCluster(clusterInfo);\n\n11. Save changes to the application and build the solution. \n\n**To run the application**\n\nOpen a Windows PowerShell or Azure PowerShell console, navigate to the location where you saved the Visual Studio project, navigate to the \\bin\\debug directory within the project, and then run the following command:\n\n    .\\CreateSolrCluster <cluster-name>\n\nProvide a cluster name and press ENTER to provision a cluster with Solr installed.\n\n\n## See also##\n- [Install and use Spark on HDInsight clusters][hdinsight-install-spark]. Use cluster customization to install Spark on HDInsight Hadoop clusters. Spark is an open-source parallel processing framework that supports in-memory processing to boost the performance of big-data analytic applications.\n- [Install R on HDInsight clusters][hdinsight-install-r]. Use cluster customization to install R on HDInsight Hadoop clusters. R is an open-source language and environment for statistical computing. It provides hundreds of built-in statistical functions and its own programming language that combines aspects of functional and object-oriented programming. It also provides extensive graphical capabilities.\n- [Install Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md). Use cluster customization to install Giraph on HDInsight Hadoop clusters. Giraph allows you to perform graph processing by using Hadoop, and can be used with Azure HDInsight.\n\n\n\n[powershell-install-configure]: ../install-configure-powershell.md\n[hdinsight-provision]: hdinsight-provision-clusters.md\n[hdinsight-install-r]: hdinsight-hadoop-r-scripts.md\n[hdinsight-install-spark]: hdinsight-hadoop-spark-install.md\n[hdinsight-cluster-customize]: hdinsight-hadoop-customize-cluster.md\n \ntest\n"
}