{
  "nodes": [
    {
      "content": "Build a Node.js web application using DocumentDB | Microsoft Azure",
      "pos": [
        28,
        94
      ]
    },
    {
      "content": "Learn how to use Microsoft Azure DocumentDB to store and access data from a Node.js Express web application hosted on Azure Websites.",
      "pos": [
        114,
        247
      ]
    },
    {
      "pos": [
        591,
        667
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395783175\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Build a Node.js web application using DocumentDB"
    },
    {
      "content": "This tutorial shows you how to use the Azure DocumentDB service to store and access data from a Node.js Express application hosted on Azure Websites.",
      "pos": [
        669,
        818
      ]
    },
    {
      "content": "We recommend getting started by watching the following video, where we show you how to provision an Azure DocumentDB database account and store JSON documents in your Node.js application.",
      "pos": [
        820,
        1007
      ]
    },
    {
      "content": "Then, return to this article, where you'll learn the answers to the following questions:",
      "pos": [
        1095,
        1183
      ]
    },
    {
      "content": "How do I work with DocumentDB using the documentdb npm module?",
      "pos": [
        1187,
        1249
      ]
    },
    {
      "content": "How do I deploy the web application to Azure Websites?",
      "pos": [
        1252,
        1306
      ]
    },
    {
      "content": "By following this tutorial, you will build a simple web-based",
      "pos": [
        1308,
        1369
      ]
    },
    {
      "content": "task-management application that allows creating, retrieving and",
      "pos": [
        1370,
        1434
      ]
    },
    {
      "content": "completing of tasks.",
      "pos": [
        1435,
        1455
      ]
    },
    {
      "content": "The tasks will be stored as JSON documents in Azure",
      "pos": [
        1456,
        1507
      ]
    },
    {
      "content": "DocumentDB.",
      "pos": [
        1508,
        1519
      ]
    },
    {
      "content": "Screen shot of the My Todo List application created in this tutorial",
      "pos": [
        1523,
        1591
      ]
    },
    {
      "content": "Don't have time to complete the tutorial and just want to get the complete solution from GitHub?",
      "pos": [
        1644,
        1740
      ]
    },
    {
      "content": "Not a problem, get it <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](https://github.com/Azure/azure-documentdb-node/tree/master/tutorial/todo)</ept>.",
      "pos": [
        1741,
        1844
      ]
    },
    {
      "pos": [
        1849,
        1890
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395783176\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Prerequisites"
    },
    {
      "pos": [
        1894,
        1997
      ],
      "content": "<ph id=\"ph1\">[AZURE.TIP]</ph> This tutorial assumes that you have some prior experience using Node.js and Azure Websites."
    },
    {
      "content": "Before following the instructions in this article, you should ensure",
      "pos": [
        1999,
        2067
      ]
    },
    {
      "content": "that you have the following:",
      "pos": [
        2068,
        2096
      ]
    },
    {
      "content": "An active Azure account.",
      "pos": [
        2100,
        2124
      ]
    },
    {
      "content": "If you don't have an account, you can create a free trial account in just a couple of minutes.",
      "pos": [
        2125,
        2219
      ]
    },
    {
      "content": "For details, see <bpt id=\"p1\">[</bpt>Azure Free Trial<ept id=\"p1\">](../../pricing/free-trial/)</ept>.",
      "pos": [
        2220,
        2283
      ]
    },
    {
      "pos": [
        2286,
        2325
      ],
      "content": "<bpt id=\"p1\">[</bpt>Node.js<ept id=\"p1\">][]</ept> version v0.10.29 or higher."
    },
    {
      "pos": [
        2328,
        2458
      ],
      "content": "<bpt id=\"p1\">[</bpt>Express generator<ept id=\"p1\">](http://www.expressjs.com/starter/generator.html)</ept> (you can install this via <ph id=\"ph1\">`npm install express-generator -g`</ph>)"
    },
    {
      "pos": [
        2461,
        2469
      ],
      "content": "<bpt id=\"p1\">[</bpt>Git<ept id=\"p1\">][]</ept>."
    },
    {
      "pos": [
        2474,
        2546
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637761\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 1: Create a DocumentDB database account"
    },
    {
      "content": "Let's start by creating a DocumentDB account.",
      "pos": [
        2548,
        2593
      ]
    },
    {
      "content": "If you already have an account, you can skip to <bpt id=\"p1\">[</bpt>Step 2: Create a new Node.js application<ept id=\"p1\">](#_Toc395783178)</ept>.",
      "pos": [
        2594,
        2701
      ]
    },
    {
      "pos": [
        2870,
        2938
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395783178\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 2: Create a new Node.js application"
    },
    {
      "pos": [
        2940,
        3046
      ],
      "content": "Now let's create a basic Hello World Node.js project using the <bpt id=\"p1\">[</bpt>Express<ept id=\"p1\">](http://expressjs.com/)</ept> framework."
    },
    {
      "content": "Open your favorite terminal.",
      "pos": [
        3051,
        3079
      ]
    },
    {
      "pos": [
        3084,
        3156
      ],
      "content": "Use the express generator to generate a new application called <bpt id=\"p1\">**</bpt>todo<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        3183,
        3241
      ],
      "content": "Open your new <bpt id=\"p1\">**</bpt>todo<ept id=\"p1\">**</ept> directory and install dependencies."
    },
    {
      "content": "Run your new application.",
      "pos": [
        3283,
        3308
      ]
    },
    {
      "pos": [
        3332,
        3447
      ],
      "content": "You can you view your new application by navigating your browser to <bpt id=\"p1\">[</bpt>http://localhost:3000<ept id=\"p1\">](http://localhost:3000)</ept>."
    },
    {
      "content": "Screenshot of the Hello World application in a browser window",
      "pos": [
        3455,
        3516
      ]
    },
    {
      "pos": [
        3573,
        3635
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395783179\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 3: Install additional modules"
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>package.json<ept id=\"p1\">**</ept> file is one of the files created in the root of the",
      "pos": [
        3637,
        3709
      ]
    },
    {
      "content": "project.",
      "pos": [
        3710,
        3718
      ]
    },
    {
      "content": "This file contains a list of additional modules that are",
      "pos": [
        3719,
        3775
      ]
    },
    {
      "content": "required for your Node.js application.",
      "pos": [
        3776,
        3814
      ]
    },
    {
      "content": "Later, when you deploy this",
      "pos": [
        3815,
        3842
      ]
    },
    {
      "content": "application to an Azure Websites, this file is used to determine",
      "pos": [
        3843,
        3907
      ]
    },
    {
      "content": "which modules need to be installed on Azure to support your application.",
      "pos": [
        3908,
        3980
      ]
    },
    {
      "content": "We still need to install two more packages for this tutorial.",
      "pos": [
        3981,
        4042
      ]
    },
    {
      "pos": [
        4047,
        4106
      ],
      "content": "Back in the terminal, install the <bpt id=\"p1\">**</bpt>async<ept id=\"p1\">**</ept> module via npm."
    },
    {
      "content": "Install the <bpt id=\"p1\">**</bpt>documentdb<ept id=\"p1\">**</ept> module via npm.",
      "pos": [
        4145,
        4187
      ]
    },
    {
      "content": "This is the module where all the DocumentDB magic happens.",
      "pos": [
        4188,
        4246
      ]
    },
    {
      "content": "A quick check of the <bpt id=\"p1\">**</bpt>package.json<ept id=\"p1\">**</ept> file of the application should show the additional modules.",
      "pos": [
        4290,
        4387
      ]
    },
    {
      "content": "This file will tell Azure which packages to download and install when running your application.",
      "pos": [
        4388,
        4483
      ]
    },
    {
      "content": "It should resemble the example below.",
      "pos": [
        4484,
        4521
      ]
    },
    {
      "content": "Screenshot of the package.json tab",
      "pos": [
        4529,
        4563
      ]
    },
    {
      "pos": [
        4721,
        4807
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395783180\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 4: Using the DocumentDB service in a node application"
    },
    {
      "content": "That takes care of all the initial setup and configuration, now let’s get down to why we’re here, and that’s to write some code using Azure DocumentDB.",
      "pos": [
        4809,
        4960
      ]
    },
    {
      "content": "Create the model",
      "pos": [
        4966,
        4982
      ]
    },
    {
      "pos": [
        4987,
        5053
      ],
      "content": "In the project directory, create a new directory named <bpt id=\"p1\">**</bpt>models<ept id=\"p1\">**</ept>."
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>models<ept id=\"p1\">**</ept> directory, create a new file named <bpt id=\"p2\">**</bpt>taskDao.js<ept id=\"p2\">**</ept>.",
      "pos": [
        5057,
        5125
      ]
    },
    {
      "content": "This file will contain the model for the tasks created by our application.",
      "pos": [
        5126,
        5200
      ]
    },
    {
      "content": "In the same <bpt id=\"p1\">**</bpt>models<ept id=\"p1\">**</ept> directory, create another new file named <bpt id=\"p2\">**</bpt>docdbUtils.js<ept id=\"p2\">**</ept>.",
      "pos": [
        5204,
        5286
      ]
    },
    {
      "content": "This file will contain some useful, reusable, code that we will use throughout our application.",
      "pos": [
        5287,
        5382
      ]
    },
    {
      "pos": [
        5387,
        5434
      ],
      "content": "Copy the following code in to <bpt id=\"p1\">**</bpt>docdbUtils.js<ept id=\"p1\">**</ept>"
    },
    {
      "pos": [
        8061,
        8444
      ],
      "content": "[AZURE.TIP] createCollection takes an optional requestOptions parameter that can be used to specify the Offer Type for the Collection. If no requestOptions.offerType value is supplied then the Collection will be created using the default Offer Type.\nFor more information on DocumentDB Offer Types please refer to [Performance levels in DocumentDB](documentdb-performance-levels.md)",
      "leadings": [
        "",
        "> "
      ],
      "nodes": [
        {
          "content": "[AZURE.TIP] createCollection takes an optional requestOptions parameter that can be used to specify the Offer Type for the Collection. If no requestOptions.offerType value is supplied then the Collection will be created using the default Offer Type.",
          "pos": [
            0,
            249
          ],
          "nodes": [
            {
              "content": "<ph id=\"ph1\">[AZURE.TIP]</ph> createCollection takes an optional requestOptions parameter that can be used to specify the Offer Type for the Collection.",
              "pos": [
                0,
                134
              ]
            },
            {
              "content": "If no requestOptions.offerType value is supplied then the Collection will be created using the default Offer Type.",
              "pos": [
                135,
                249
              ]
            }
          ]
        },
        {
          "content": "For more information on DocumentDB Offer Types please refer to <bpt id=\"p1\">[</bpt>Performance levels in DocumentDB<ept id=\"p1\">](documentdb-performance-levels.md)</ept>",
          "pos": [
            250,
            381
          ]
        }
      ]
    },
    {
      "pos": [
        8458,
        8500
      ],
      "content": "Save and close the <bpt id=\"p1\">**</bpt>docdbUtils.js<ept id=\"p1\">**</ept> file."
    },
    {
      "pos": [
        8505,
        8654
      ],
      "content": "At the beginning of the <bpt id=\"p1\">**</bpt>taskDao.js<ept id=\"p1\">**</ept> file, add the following code to reference the <bpt id=\"p2\">**</bpt>DocumentDBClient<ept id=\"p2\">**</ept> and the <bpt id=\"p3\">**</bpt>docdbUtils.js<ept id=\"p3\">**</ept> we created above:"
    },
    {
      "content": "Next, you will add code to define and export the Task object.",
      "pos": [
        8779,
        8840
      ]
    },
    {
      "content": "This is responsible for initializing our Task object and setting up the Database and Document Collection we will use.",
      "pos": [
        8841,
        8958
      ]
    },
    {
      "content": "Next, add the following code to define additional methods on the Task object, which allow interactions with data stored in DocumentDB.",
      "pos": [
        9289,
        9423
      ]
    },
    {
      "pos": [
        12567,
        12606
      ],
      "content": "Save and close the <bpt id=\"p1\">**</bpt>taskDao.js<ept id=\"p1\">**</ept> file."
    },
    {
      "content": "Create the controller",
      "pos": [
        12613,
        12634
      ]
    },
    {
      "pos": [
        12639,
        12724
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>routes<ept id=\"p1\">**</ept> directory of your project, create a new file named <bpt id=\"p2\">**</bpt>tasklist.js<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Add the following code to <bpt id=\"p1\">**</bpt>tasklist.js<ept id=\"p1\">**</ept>.",
      "pos": [
        12729,
        12771
      ]
    },
    {
      "content": "This loads the DocumentDBClient and async modules, which are used by <bpt id=\"p1\">**</bpt>tasklist.js<ept id=\"p1\">**</ept>.",
      "pos": [
        12772,
        12857
      ]
    },
    {
      "content": "This also defined the <bpt id=\"p1\">**</bpt>TaskList<ept id=\"p1\">**</ept> function, which is passed an instance of the <bpt id=\"p2\">**</bpt>Task<ept id=\"p2\">**</ept> object we defined earlier:",
      "pos": [
        12858,
        12973
      ]
    },
    {
      "pos": [
        13220,
        13340
      ],
      "content": "Continue adding to the <bpt id=\"p1\">**</bpt>tasklist.js<ept id=\"p1\">**</ept> file by adding the methods used to <bpt id=\"p2\">**</bpt>showTasks, addTask<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>completeTasks<ept id=\"p3\">**</ept>:"
    },
    {
      "pos": [
        15254,
        15294
      ],
      "content": "Save and close the <bpt id=\"p1\">**</bpt>tasklist.js<ept id=\"p1\">**</ept> file."
    },
    {
      "content": "Add config.js",
      "pos": [
        15301,
        15314
      ]
    },
    {
      "pos": [
        15319,
        15383
      ],
      "content": "In your project directory create a new file named <bpt id=\"p1\">**</bpt>config.js<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Add the following to <bpt id=\"p1\">**</bpt>config.js<ept id=\"p1\">**</ept>.",
      "pos": [
        15387,
        15422
      ]
    },
    {
      "content": "This defines configuration settings and values needed for our application.",
      "pos": [
        15423,
        15497
      ]
    },
    {
      "pos": [
        15910,
        16109
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>config.js<ept id=\"p1\">**</ept> file, update the values of HOST and AUTH_KEY using the values found in the Keys blade of your DocumentDB account on the <bpt id=\"p2\">[</bpt>Microsoft Azure Preview portal<ept id=\"p2\">](http://portal.azure.com)</ept>:"
    },
    {
      "pos": [
        16114,
        16152
      ],
      "content": "Save and close the <bpt id=\"p1\">**</bpt>config.js<ept id=\"p1\">**</ept> file."
    },
    {
      "content": "Modify app.js",
      "pos": [
        16159,
        16172
      ]
    },
    {
      "content": "In the project directory, open the <bpt id=\"p1\">**</bpt>app.js<ept id=\"p1\">**</ept> file.",
      "pos": [
        16177,
        16228
      ]
    },
    {
      "content": "This file was created earlier when the Express web application was created.",
      "pos": [
        16229,
        16304
      ]
    },
    {
      "pos": [
        16308,
        16355
      ],
      "content": "Add the following code to the top of <bpt id=\"p1\">**</bpt>app.js<ept id=\"p1\">**</ept>"
    },
    {
      "content": "This code defines the config file to be used, and proceeds to read values out of this file in to some variables we will use soon.",
      "pos": [
        16580,
        16709
      ]
    },
    {
      "pos": [
        16713,
        16764
      ],
      "content": "Replace the following two lines in <bpt id=\"p1\">**</bpt>app.js<ept id=\"p1\">**</ept> file:"
    },
    {
      "content": "with the following snippet:",
      "pos": [
        16838,
        16865
      ]
    },
    {
      "pos": [
        17344,
        17585
      ],
      "content": "These lines define a new instance of our <bpt id=\"p1\">**</bpt>TaskDao<ept id=\"p1\">**</ept> object, with a new connection to DocumentDB (using the values read from the <bpt id=\"p2\">**</bpt>config.js<ept id=\"p2\">**</ept>), initialize the task object and then bind form actions to methods on our <bpt id=\"p3\">**</bpt>TaskList<ept id=\"p3\">**</ept> controller."
    },
    {
      "pos": [
        17591,
        17658
      ],
      "content": "Finally, save and close the <bpt id=\"p1\">**</bpt>app.js<ept id=\"p1\">**</ept> file, we're just about done."
    },
    {
      "pos": [
        17664,
        17722
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395783181\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 5: Build a user interface"
    },
    {
      "content": "Now let’s turn our attention to building the user interface so a user can actually interact with our application.",
      "pos": [
        17724,
        17837
      ]
    },
    {
      "content": "The Express application we created uses <bpt id=\"p1\">**</bpt>Jade<ept id=\"p1\">**</ept> as the view engine.",
      "pos": [
        17838,
        17906
      ]
    },
    {
      "content": "For more information on Jade please refer to <bpt id=\"p1\">[</bpt>http://jade-lang.com/<ept id=\"p1\">](http://jade-lang.com/)</ept>.",
      "pos": [
        17907,
        17999
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>layout.jade<ept id=\"p1\">**</ept> file in the <bpt id=\"p2\">**</bpt>views<ept id=\"p2\">**</ept> directory is used as a global template for other <bpt id=\"p3\">**</bpt>.jade<ept id=\"p3\">**</ept> files.",
      "pos": [
        18004,
        18111
      ]
    },
    {
      "content": "In this step you will modify it to use <bpt id=\"p1\">[</bpt>Twitter Bootstrap<ept id=\"p1\">](https://github.com/twbs/bootstrap)</ept>, which is a toolkit that makes it easy to design a nice looking website.",
      "pos": [
        18112,
        18278
      ]
    },
    {
      "pos": [
        18283,
        18387
      ],
      "content": "Open the <bpt id=\"p1\">**</bpt>layout.jade<ept id=\"p1\">**</ept> file found in the <bpt id=\"p2\">**</bpt>views<ept id=\"p2\">**</ept> folder and replace the contents with the following;"
    },
    {
      "pos": [
        18990,
        19215
      ],
      "content": "This effectively tells the **Jade** engine to render some HTML for our application and creates a **block** called **content** where we can supply the layout for our content pages.\n Save and close this **layout.jade** file.",
      "leadings": [
        "",
        "   "
      ],
      "nodes": [
        {
          "content": "This effectively tells the <bpt id=\"p1\">**</bpt>Jade<ept id=\"p1\">**</ept> engine to render some HTML for our application and creates a <bpt id=\"p2\">**</bpt>block<ept id=\"p2\">**</ept> called <bpt id=\"p3\">**</bpt>content<ept id=\"p3\">**</ept> where we can supply the layout for our content pages.",
          "pos": [
            0,
            179
          ]
        },
        {
          "content": "Save and close this <bpt id=\"p1\">**</bpt>layout.jade<ept id=\"p1\">**</ept> file.",
          "pos": [
            181,
            222
          ]
        }
      ]
    },
    {
      "pos": [
        19220,
        19356
      ],
      "content": "Now open the <bpt id=\"p1\">**</bpt>index.jade<ept id=\"p1\">**</ept> file, the view that will be used by our application, and replace the content of the file with the following:"
    },
    {
      "pos": [
        20678,
        20795
      ],
      "content": "This extends layout, and provides content for the <bpt id=\"p1\">**</bpt>content<ept id=\"p1\">**</ept> placeholder we saw in the <bpt id=\"p2\">**</bpt>layout.jade<ept id=\"p2\">**</ept> file earlier."
    },
    {
      "pos": [
        20805,
        21146
      ],
      "content": "In this layout we created two HTML forms. \n The first form contains a table for our data and a button that allows us to update items by posting to **/completetask** method of our controller.\n The second form contains two input fields and a button that allows us to create a new item by posting to **/addtask** method of our controller.",
      "leadings": [
        "",
        "   ",
        "   "
      ],
      "nodes": [
        {
          "content": "In this layout we created two HTML forms.",
          "pos": [
            0,
            41
          ]
        },
        {
          "content": "The first form contains a table for our data and a button that allows us to update items by posting to <bpt id=\"p1\">**</bpt>/completetask<ept id=\"p1\">**</ept> method of our controller.",
          "pos": [
            44,
            190
          ]
        },
        {
          "content": "The second form contains two input fields and a button that allows us to create a new item by posting to <bpt id=\"p1\">**</bpt>/addtask<ept id=\"p1\">**</ept> method of our controller.",
          "pos": [
            192,
            335
          ]
        }
      ]
    },
    {
      "content": "This should be all that we need for our application to work.",
      "pos": [
        21156,
        21216
      ]
    },
    {
      "pos": [
        21221,
        21325
      ],
      "content": "Open the <bpt id=\"p1\">**</bpt>style.css<ept id=\"p1\">**</ept> file in <bpt id=\"p2\">**</bpt>public\\stylesheets<ept id=\"p2\">**</ept> directory and replace the code with the following:"
    },
    {
      "pos": [
        21708,
        21747
      ],
      "content": "Save and close this <bpt id=\"p1\">**</bpt>style.css<ept id=\"p1\">**</ept> file."
    },
    {
      "pos": [
        21752,
        21816
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395783181\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 6: Run your application locally"
    },
    {
      "pos": [
        21821,
        21990
      ],
      "content": "To test the application on your local machine, run <ph id=\"ph1\">`npm start`</ph> in a terminal to start your application, and launch a browser with a page that looks like the image below:"
    },
    {
      "content": "Screenshot of the MyTodo List application in a browser window",
      "pos": [
        21998,
        22059
      ]
    },
    {
      "content": "Use the provided fields for Item, Item Name and Category to enter",
      "pos": [
        22117,
        22182
      ]
    },
    {
      "content": "information, and then click <bpt id=\"p1\">**</bpt>Add Item<ept id=\"p1\">**</ept>.",
      "pos": [
        22183,
        22224
      ]
    },
    {
      "content": "The page should update to display the newly created item in the ToDo",
      "pos": [
        22229,
        22297
      ]
    },
    {
      "content": "list.",
      "pos": [
        22298,
        22303
      ]
    },
    {
      "content": "Screenshot of the application with a new item in the ToDo list",
      "pos": [
        22311,
        22373
      ]
    },
    {
      "content": "To complete a task, simply check the checkbox in the Complete column,",
      "pos": [
        22430,
        22499
      ]
    },
    {
      "content": "and then click <bpt id=\"p1\">**</bpt>Update tasks<ept id=\"p1\">**</ept>.",
      "pos": [
        22500,
        22532
      ]
    },
    {
      "pos": [
        22537,
        22614
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395783182\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Step 7: Deploy your application to Azure Websites"
    },
    {
      "content": "If you haven't already, enable a git repository for your Azure Website.",
      "pos": [
        22619,
        22690
      ]
    },
    {
      "content": "You can find instructions on how to do this <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](../web-sites-publish-source-control-git.md#step4)</ept>.",
      "pos": [
        22691,
        22792
      ]
    },
    {
      "content": "Add your Azure Website as a git remote.",
      "pos": [
        22797,
        22836
      ]
    },
    {
      "content": "Deploy by pushing to the remote.",
      "pos": [
        22956,
        22988
      ]
    },
    {
      "content": "In a few seconds, git will finish publishing your web",
      "pos": [
        23024,
        23077
      ]
    },
    {
      "content": "application and launch a browser where you can see your handy work",
      "pos": [
        23078,
        23144
      ]
    },
    {
      "content": "running in Azure!",
      "pos": [
        23145,
        23162
      ]
    },
    {
      "pos": [
        23167,
        23205
      ],
      "content": "<ph id=\"ph1\">&lt;a name=\"_Toc395637775\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Next steps"
    },
    {
      "content": "Congratulations!",
      "pos": [
        23207,
        23223
      ]
    },
    {
      "content": "You have just built your first Node.js Express Web",
      "pos": [
        23224,
        23274
      ]
    },
    {
      "content": "Application using Azure DocumentDB and published it to Azure Websites.",
      "pos": [
        23275,
        23345
      ]
    },
    {
      "pos": [
        23347,
        23501
      ],
      "content": "The source code for the complete reference application can be downloaded <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](https://github.com/Azure/azure-documentdb-node/tree/master/tutorial/todo)</ept>."
    },
    {
      "content": "test",
      "pos": [
        23567,
        23571
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Build a Node.js web application using DocumentDB | Microsoft Azure\" \n    description=\"Learn how to use Microsoft Azure DocumentDB to store and access data from a Node.js Express web application hosted on Azure Websites.\" \n    services=\"documentdb\" \n    documentationCenter=\"nodejs\" \n    authors=\"ryancrawcour\" \n    manager=\"jhubbard\" \n    editor=\"cgronlun\"/>\n\n<tags \n    ms.service=\"documentdb\" \n    ms.workload=\"data-services\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"nodejs\" \n    ms.topic=\"hero-article\" \n    ms.date=\"07/24/2015\" \n    ms.author=\"ryancraw\"/>\n\n# <a name=\"_Toc395783175\"></a>Build a Node.js web application using DocumentDB\n\nThis tutorial shows you how to use the Azure DocumentDB service to store and access data from a Node.js Express application hosted on Azure Websites.\n\nWe recommend getting started by watching the following video, where we show you how to provision an Azure DocumentDB database account and store JSON documents in your Node.js application. \n\n> [AZURE.VIDEO azure-demo-getting-started-with-azure-documentdb-on-nodejs-in-linux]\n\nThen, return to this article, where you'll learn the answers to the following questions:\n\n- How do I work with DocumentDB using the documentdb npm module?\n- How do I deploy the web application to Azure Websites?\n\nBy following this tutorial, you will build a simple web-based\ntask-management application that allows creating, retrieving and\ncompleting of tasks. The tasks will be stored as JSON documents in Azure\nDocumentDB.\n\n![Screen shot of the My Todo List application created in this tutorial](./media/documentdb-nodejs-application/image1.png)\n\nDon't have time to complete the tutorial and just want to get the complete solution from GitHub? Not a problem, get it [here](https://github.com/Azure/azure-documentdb-node/tree/master/tutorial/todo).\n\n## <a name=\"_Toc395783176\"></a>Prerequisites\n\n> [AZURE.TIP] This tutorial assumes that you have some prior experience using Node.js and Azure Websites.\n\nBefore following the instructions in this article, you should ensure\nthat you have the following:\n\n- An active Azure account. If you don't have an account, you can create a free trial account in just a couple of minutes. For details, see [Azure Free Trial](../../pricing/free-trial/).\n- [Node.js][] version v0.10.29 or higher.\n- [Express generator](http://www.expressjs.com/starter/generator.html) (you can install this via `npm install express-generator -g`)\n- [Git][].\n\n## <a name=\"_Toc395637761\"></a>Step 1: Create a DocumentDB database account\n\nLet's start by creating a DocumentDB account. If you already have an account, you can skip to [Step 2: Create a new Node.js application](#_Toc395783178).\n\n[AZURE.INCLUDE [documentdb-create-dbaccount](../../includes/documentdb-create-dbaccount.md)]\n\n[AZURE.INCLUDE [documentdb-keys](../../includes/documentdb-keys.md)]\n\n## <a name=\"_Toc395783178\"></a>Step 2: Create a new Node.js application\n\nNow let's create a basic Hello World Node.js project using the [Express](http://expressjs.com/) framework.\n\n1. Open your favorite terminal.\n\n2. Use the express generator to generate a new application called **todo**.\n\n        express todo\n\n3. Open your new **todo** directory and install dependencies.\n\n        cd todo\n        npm install\n\n4. Run your new application.\n\n        npm start\n\n5. You can you view your new application by navigating your browser to [http://localhost:3000](http://localhost:3000).\n\n    ![Screenshot of the Hello World application in a browser window](./media/documentdb-nodejs-application/image12.png)\n\n## <a name=\"_Toc395783179\"></a>Step 3: Install additional modules\n\nThe **package.json** file is one of the files created in the root of the\nproject. This file contains a list of additional modules that are\nrequired for your Node.js application. Later, when you deploy this\napplication to an Azure Websites, this file is used to determine\nwhich modules need to be installed on Azure to support your application. We still need to install two more packages for this tutorial.\n\n1. Back in the terminal, install the **async** module via npm.\n\n        npm install async --save\n\n1. Install the **documentdb** module via npm. This is the module where all the DocumentDB magic happens.\n\n        npm install documentdb --save\n\n3. A quick check of the **package.json** file of the application should show the additional modules. This file will tell Azure which packages to download and install when running your application. It should resemble the example below.\n\n    ![Screenshot of the package.json tab](./media/documentdb-nodejs-application/image17.png)\n\n       This tells Node (and Azure later) that your application depends on these additional modules.\n\n## <a name=\"_Toc395783180\"></a>Step 4: Using the DocumentDB service in a node application\n\nThat takes care of all the initial setup and configuration, now let’s get down to why we’re here, and that’s to write some code using Azure DocumentDB.\n\n### Create the model\n\n1. In the project directory, create a new directory named **models**.\n2. In the **models** directory, create a new file named **taskDao.js**. This file will contain the model for the tasks created by our application.\n3. In the same **models** directory, create another new file named **docdbUtils.js**. This file will contain some useful, reusable, code that we will use throughout our application. \n4. Copy the following code in to **docdbUtils.js**\n\n        var DocumentDBClient = require('documentdb').DocumentClient;\n            \n        var DocDBUtils = {\n            getOrCreateDatabase: function (client, databaseId, callback) {\n                var querySpec = {\n                    query: 'SELECT * FROM root r WHERE r.id=@id',\n                    parameters: [{\n                        name: '@id',\n                        value: databaseId\n                    }]\n                };\n        \n                client.queryDatabases(querySpec).toArray(function (err, results) {\n                    if (err) {\n                        callback(err);\n        \n                    } else {\n                        if (results.length === 0) {\n                            var databaseSpec = {\n                                id: databaseId\n                            };\n        \n                            client.createDatabase(databaseSpec, function (err, created) {\n                                callback(null, created);\n                            });\n        \n                        } else {\n                            callback(null, results[0]);\n                        }\n                    }\n                });\n            },\n        \n            getOrCreateCollection: function (client, databaseLink, collectionId, callback) {\n                var querySpec = {\n                    query: 'SELECT * FROM root r WHERE r.id=@id',\n                    parameters: [{\n                        name: '@id',\n                        value: collectionId\n                    }]\n                };             \n                \n                client.queryCollections(databaseLink, querySpec).toArray(function (err, results) {\n                    if (err) {\n                        callback(err);\n        \n                    } else {        \n                        if (results.length === 0) {\n                            var collectionSpec = {\n                                id: collectionId\n                            };\n                            \n                            var requestOptions = {\n                                offerType: 'S1'\n                            };\n                            \n                            client.createCollection(databaseLink, collectionSpec, requestOptions, function (err, created) {\n                                callback(null, created);\n                            });\n        \n                        } else {\n                            callback(null, results[0]);\n                        }\n                    }\n                });\n            }\n        };\n                \n        module.exports = DocDBUtils;\n\n> [AZURE.TIP] createCollection takes an optional requestOptions parameter that can be used to specify the Offer Type for the Collection. If no requestOptions.offerType value is supplied then the Collection will be created using the default Offer Type.\n> For more information on DocumentDB Offer Types please refer to [Performance levels in DocumentDB](documentdb-performance-levels.md) \n        \n3. Save and close the **docdbUtils.js** file.\n\n4. At the beginning of the **taskDao.js** file, add the following code to reference the **DocumentDBClient** and the **docdbUtils.js** we created above:\n\n        var DocumentDBClient = require('documentdb').DocumentClient;\n        var docdbUtils = require('./docdbUtils');\n\n4. Next, you will add code to define and export the Task object. This is responsible for initializing our Task object and setting up the Database and Document Collection we will use.\n\n        function TaskDao(documentDBClient, databaseId, collectionId) {\n          this.client = documentDBClient;\n          this.databaseId = databaseId;\n          this.collectionId = collectionId;\n        \n          this.database = null;\n          this.collection = null;\n        }\n        \n        module.exports = TaskDao;\n\n5. Next, add the following code to define additional methods on the Task object, which allow interactions with data stored in DocumentDB.\n\n        TaskDao.prototype = {\n            init: function (callback) {\n                var self = this;\n        \n                docdbUtils.getOrCreateDatabase(self.client, self.databaseId, function (err, db) {\n                    if (err) {\n                        callback(err);\n\n                    } else {\n                        self.database = db;\n                        docdbUtils.getOrCreateCollection(self.client, self.database._self, self.collectionId, function (err, coll) {\n                            if (err) {\n                                callback(err);\n        \n                            } else {\n                                self.collection = coll;\n                            }\n                        });\n                    }\n                });\n            },\n        \n            find: function (querySpec, callback) {\n                var self = this;\n        \n                self.client.queryDocuments(self.collection._self, querySpec).toArray(function (err, results) {\n                    if (err) {\n                        callback(err);\n        \n                    } else {\n                        callback(null, results);\n                    }\n                });\n            },\n        \n            addItem: function (item, callback) {\n                var self = this;\n        \n                item.date = Date.now();\n                item.completed = false;\n        \n                self.client.createDocument(self.collection._self, item, function (err, doc) {\n                    if (err) {\n                        callback(err);\n        \n                    } else {\n                        callback(null, doc);\n                    }\n                });\n            },\n        \n            updateItem: function (itemId, callback) {\n                var self = this;\n        \n                self.getItem(itemId, function (err, doc) {\n                    if (err) {\n                        callback(err);\n        \n                    } else {\n                        doc.completed = true;\n        \n                        self.client.replaceDocument(doc._self, doc, function (err, replaced) {\n                            if (err) {\n                                callback(err);\n        \n                            } else {\n                                callback(null, replaced);\n                            }\n                        });\n                    }\n                });\n            },\n        \n            getItem: function (itemId, callback) {\n                var self = this;\n        \n                var querySpec = {\n                    query: 'SELECT * FROM root r WHERE r.id=@id',\n                    parameters: [{\n                        name: '@id',\n                        value: itemId\n                    }]\n                };\n        \n                self.client.queryDocuments(self.collection._self, querySpec).toArray(function (err, results) {\n                    if (err) {\n                        callback(err);\n        \n                    } else {\n                        callback(null, results[0]);\n                    }\n                });\n            }\n        };\n\n6. Save and close the **taskDao.js** file. \n\n### Create the controller\n\n1. In the **routes** directory of your project, create a new file named **tasklist.js**. \n2. Add the following code to **tasklist.js**. This loads the DocumentDBClient and async modules, which are used by **tasklist.js**. This also defined the **TaskList** function, which is passed an instance of the **Task** object we defined earlier:\n\n        var DocumentDBClient = require('documentdb').DocumentClient;\n        var async = require('async');\n        \n        function TaskList(taskDao) {\n          this.taskDao = taskDao;\n        }\n        \n        module.exports = TaskList;\n\n3. Continue adding to the **tasklist.js** file by adding the methods used to **showTasks, addTask**, and **completeTasks**:\n        \n        TaskList.prototype = {\n            showTasks: function (req, res) {\n                var self = this;\n        \n                var querySpec = {\n                    query: 'SELECT * FROM root r WHERE r.completed=@completed',\n                    parameters: [{\n                        name: '@completed',\n                        value: false\n                    }]\n                };\n        \n                self.taskDao.find(querySpec, function (err, items) {\n                    if (err) {\n                        throw (err);\n                    }\n        \n                    res.render('index', {\n                        title: 'My ToDo List ',\n                        tasks: items\n                    });\n                });\n            },\n        \n            addTask: function (req, res) {\n                var self = this;\n                var item = req.body;\n        \n                self.taskDao.addItem(item, function (err) {\n                    if (err) {\n                        throw (err);\n                    }\n        \n                    res.redirect('/');\n                });\n            },\n        \n            completeTask: function (req, res) {\n                var self = this;\n                var completedTasks = Object.keys(req.body);\n        \n                async.forEach(completedTasks, function taskIterator(completedTask, callback) {\n                    self.taskDao.updateItem(completedTask, function (err) {\n                        if (err) {\n                            callback(err);\n                        } else {\n                            callback(null);\n                        }\n                    });\n                }, function goHome(err) {\n                    if (err) {\n                        throw err;\n                    } else {\n                        res.redirect('/');\n                    }\n                });\n            }\n        };\n\n\n4. Save and close the **tasklist.js** file.\n \n### Add config.js\n\n1. In your project directory create a new file named **config.js**.\n2. Add the following to **config.js**. This defines configuration settings and values needed for our application.\n\n        var config = {}\n        \n        config.host = process.env.HOST || \"[the URI value from the DocumentDB Keys blade on http://portal.azure.com]\";\n        config.authKey = process.env.AUTH_KEY || \"[the PRIMARY KEY value from the DocumentDB Keys blade on http://portal.azure.com]\";\n        config.databaseId = \"ToDoList\";\n        config.collectionId = \"Items\";\n        \n        module.exports = config;\n\n3. In the **config.js** file, update the values of HOST and AUTH_KEY using the values found in the Keys blade of your DocumentDB account on the [Microsoft Azure Preview portal](http://portal.azure.com):\n\n4. Save and close the **config.js** file.\n \n### Modify app.js\n\n1. In the project directory, open the **app.js** file. This file was created earlier when the Express web application was created.\n2. Add the following code to the top of **app.js**\n    \n        var DocumentDBClient = require('documentdb').DocumentClient;\n        var config = require('./config');\n        var TaskList = require('./routes/tasklist');\n        var TaskDao = require('./models/taskDao');\n\n3. This code defines the config file to be used, and proceeds to read values out of this file in to some variables we will use soon.\n4. Replace the following two lines in **app.js** file:\n\n        app.use('/', routes);\n        app.use('/users', users); \n\n      with the following snippet:\n\n        var docDbClient = new DocumentDBClient(config.host, {\n            masterKey: config.authKey\n        });\n        var taskDao = new TaskDao(docDbClient, config.databaseId, config.collectionId);\n        var taskList = new TaskList(taskDao);\n        taskDao.init();\n        \n        app.get('/', taskList.showTasks.bind(taskList));\n        app.post('/addtask', taskList.addTask.bind(taskList));\n        app.post('/completetask', taskList.completeTask.bind(taskList));\n\n\n6. These lines define a new instance of our **TaskDao** object, with a new connection to DocumentDB (using the values read from the **config.js**), initialize the task object and then bind form actions to methods on our **TaskList** controller. \n\n7. Finally, save and close the **app.js** file, we're just about done.\n \n## <a name=\"_Toc395783181\"></a>Step 5: Build a user interface\n\nNow let’s turn our attention to building the user interface so a user can actually interact with our application. The Express application we created uses **Jade** as the view engine. For more information on Jade please refer to [http://jade-lang.com/](http://jade-lang.com/).\n\n1. The **layout.jade** file in the **views** directory is used as a global template for other **.jade** files. In this step you will modify it to use [Twitter Bootstrap](https://github.com/twbs/bootstrap), which is a toolkit that makes it easy to design a nice looking website. \n2. Open the **layout.jade** file found in the **views** folder and replace the contents with the following;\n    \n        doctype html\n        html\n          head\n            title= title\n            link(rel='stylesheet', href='//ajax.aspnetcdn.com/ajax/bootstrap/3.3.2/css/bootstrap.min.css')\n            link(rel='stylesheet', href='/stylesheets/style.css')\n          body\n            nav.navbar.navbar-inverse.navbar-fixed-top\n              div.navbar-header\n                a.navbar-brand(href='#') My Tasks\n            block content\n            script(src='//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.11.2.min.js')\n            script(src='//ajax.aspnetcdn.com/ajax/bootstrap/3.3.2/bootstrap.min.js')\n\n\n\n    This effectively tells the **Jade** engine to render some HTML for our application and creates a **block** called **content** where we can supply the layout for our content pages.\n    Save and close this **layout.jade** file.\n\n4. Now open the **index.jade** file, the view that will be used by our application, and replace the content of the file with the following:\n\n        extends layout\n        \n        block content\n          h1 #{title}\n          br\n        \n          form(action=\"/completetask\", method=\"post\")\n            table.table.table-striped.table-bordered\n              tr\n                td Name\n                td Category\n                td Date\n                td Complete\n              if (typeof tasks === \"undefined\")\n                tr\n                  td\n              else\n                each task in tasks\n                  tr\n                    td #{task.name}\n                    td #{task.category}\n                    - var date  = new Date(task.date);\n                    - var day   = date.getDate();\n                    - var month = date.getMonth() + 1;\n                    - var year  = date.getFullYear();\n                    td #{month + \"/\" + day + \"/\" + year}\n                    td\n                      input(type=\"checkbox\", name=\"#{task.id}\", value=\"#{!task.completed}\", checked=task.completed)\n            button.btn(type=\"submit\") Update tasks\n          hr\n          form.well(action=\"/addtask\", method=\"post\")\n            label Item Name:\n            input(name=\"name\", type=\"textbox\")\n            label Item Category:\n            input(name=\"category\", type=\"textbox\")\n            br\n            button.btn(type=\"submit\") Add item\n\n    This extends layout, and provides content for the **content** placeholder we saw in the **layout.jade** file earlier.\n    \n    In this layout we created two HTML forms. \n    The first form contains a table for our data and a button that allows us to update items by posting to **/completetask** method of our controller.\n    The second form contains two input fields and a button that allows us to create a new item by posting to **/addtask** method of our controller.\n    \n    This should be all that we need for our application to work.\n\n5. Open the **style.css** file in **public\\stylesheets** directory and replace the code with the following:\n\n        body {\n          padding: 50px;\n          font: 14px \"Lucida Grande\", Helvetica, Arial, sans-serif;\n        }\n        a {\n          color: #00B7FF;\n        }\n        .well label {\n          display: block;\n        }\n        .well input {\n          margin-bottom: 5px;\n        }\n        .btn {\n          margin-top: 5px;\n          border: outset 1px #C8C8C8;\n        }\n\n    Save and close this **style.css** file.\n\n## <a name=\"_Toc395783181\"></a>Step 6: Run your application locally\n\n1. To test the application on your local machine, run `npm start` in a terminal to start your application, and launch a browser with a page that looks like the image below:\n\n    ![Screenshot of the MyTodo List application in a browser window](./media/documentdb-nodejs-application/image18.png)\n\n\n2. Use the provided fields for Item, Item Name and Category to enter\ninformation, and then click **Add Item**.\n\n3. The page should update to display the newly created item in the ToDo\nlist.\n\n    ![Screenshot of the application with a new item in the ToDo list](./media/documentdb-nodejs-application/image19.png)\n\n4. To complete a task, simply check the checkbox in the Complete column,\nand then click **Update tasks**.\n\n## <a name=\"_Toc395783182\"></a>Step 7: Deploy your application to Azure Websites\n\n1. If you haven't already, enable a git repository for your Azure Website. You can find instructions on how to do this [here](../web-sites-publish-source-control-git.md#step4).\n\n2. Add your Azure Website as a git remote.\n\n        git remote add azure https://username@your-azure-website.scm.azurewebsites.net:443/your-azure-website.git\n\n3. Deploy by pushing to the remote.\n\n        git push azure master\n\n4. In a few seconds, git will finish publishing your web\napplication and launch a browser where you can see your handy work\nrunning in Azure!\n\n## <a name=\"_Toc395637775\"></a>Next steps\n\nCongratulations! You have just built your first Node.js Express Web\nApplication using Azure DocumentDB and published it to Azure Websites.\n\nThe source code for the complete reference application can be downloaded [here](https://github.com/Azure/azure-documentdb-node/tree/master/tutorial/todo).\n\n  [Node.js]: http://nodejs.org/\n  [Git]: http://git-scm.com/\n \n\ntest\n"
}