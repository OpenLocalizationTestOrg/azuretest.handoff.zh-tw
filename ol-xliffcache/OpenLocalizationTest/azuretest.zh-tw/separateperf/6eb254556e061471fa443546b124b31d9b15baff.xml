{
  "nodes": [
    {
      "content": "What is a Cloud Service Model and Package in Azure",
      "pos": [
        28,
        78
      ]
    },
    {
      "content": "Describes the cloud service model (.csdef, .cscfg) and package (.cspkg) in Azure",
      "pos": [
        98,
        178
      ]
    },
    {
      "content": "What is the Cloud Service Model and how do I package it?",
      "pos": [
        485,
        541
      ]
    },
    {
      "content": "A cloud service is created from three components, the service definition <bpt id=\"p1\">_</bpt>(.csdef)<ept id=\"p1\">_</ept>, the service config <bpt id=\"p2\">_</bpt>(.cscfg)<ept id=\"p2\">_</ept>, and a service package <bpt id=\"p3\">_</bpt>(.cspkg)<ept id=\"p3\">_</ept>.",
      "pos": [
        542,
        691
      ]
    },
    {
      "content": "Both the <bpt id=\"p1\">**</bpt>ServiceDefinition.csdef<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>ServiceConfig.cscfg<ept id=\"p2\">**</ept> files are XML-based and describe the structure of the cloud service and how it's configured; collectively called the model.",
      "pos": [
        692,
        880
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>ServicePackage.cspkg<ept id=\"p1\">**</ept> is a zip file that is generated from the <bpt id=\"p2\">**</bpt>ServiceDefinition.csdef<ept id=\"p2\">**</ept> and among other things, contains all of the required binary-based dependencies.",
      "pos": [
        881,
        1058
      ]
    },
    {
      "content": "Azure creates a cloud service from both the <bpt id=\"p1\">**</bpt>ServicePackage.cspkg<ept id=\"p1\">**</ept> and the <bpt id=\"p2\">**</bpt>ServiceConfig.cscfg<ept id=\"p2\">**</ept>.",
      "pos": [
        1059,
        1160
      ]
    },
    {
      "pos": [
        1162,
        1307
      ],
      "content": "Once the cloud service is running in Azure, you can reconfigure it through the <bpt id=\"p1\">**</bpt>ServiceConfig.cscfg<ept id=\"p1\">**</ept> file, but you cannot alter the definition."
    },
    {
      "content": "What would you like to know more about?",
      "pos": [
        1312,
        1351
      ]
    },
    {
      "pos": [
        1355,
        1459
      ],
      "content": "I want to know more about the <bpt id=\"p1\">[</bpt>ServiceDefinition.csdef<ept id=\"p1\">](#csdef)</ept> and <bpt id=\"p2\">[</bpt>ServiceConfig.cscfg<ept id=\"p2\">](#cscfg)</ept> files."
    },
    {
      "pos": [
        1462,
        1550
      ],
      "content": "I already know about that, give me <bpt id=\"p1\">[</bpt>some examples<ept id=\"p1\">](#next-steps)</ept> on what I can configure."
    },
    {
      "pos": [
        1553,
        1605
      ],
      "content": "I want to create the <bpt id=\"p1\">[</bpt>ServicePackage.cspkg<ept id=\"p1\">](#cspkg)</ept>."
    },
    {
      "content": "I am using Visual Studio and I want to...",
      "pos": [
        1609,
        1650
      ]
    },
    {
      "content": "Create a new cloud service",
      "pos": [
        1658,
        1684
      ]
    },
    {
      "content": "Reconfigure an existing cloud service",
      "pos": [
        1704,
        1741
      ]
    },
    {
      "content": "Deploy a Cloud Service project",
      "pos": [
        1766,
        1796
      ]
    },
    {
      "content": "Remote desktop into a cloud service instance",
      "pos": [
        1816,
        1860
      ]
    },
    {
      "content": "ServiceDefinition.csdef",
      "pos": [
        1902,
        1925
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>ServiceDefinition.csdef<ept id=\"p1\">**</ept> file specifies the settings that are used by Azure to configure a cloud service.",
      "pos": [
        1926,
        2038
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>Azure Service Definition Schema (.csdef File)<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/ee758711.aspx)</ept> provides the allowable format for a service definition file.",
      "pos": [
        2039,
        2207
      ]
    },
    {
      "content": "The following example shows the settings that can be defined for the Web and Worker roles:",
      "pos": [
        2208,
        2298
      ]
    },
    {
      "content": "You can refer to the [Service Definition Schema][] for a better understanding of the XML schema used here, however, here is a quick explanation of some of the elements:",
      "pos": [
        3934,
        4102
      ]
    },
    {
      "pos": [
        4105,
        4200
      ],
      "content": "**Sites**  \nContains the definitions for websites or web applications that are hosted in IIS7.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Sites<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            9
          ]
        },
        {
          "content": "Contains the definitions for websites or web applications that are hosted in IIS7.",
          "pos": [
            12,
            94
          ]
        }
      ]
    },
    {
      "pos": [
        4204,
        4308
      ],
      "content": "**InputEndpoints**  \nContains the definitions for endpoints that are used to contact the cloud service.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>InputEndpoints<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            18
          ]
        },
        {
          "content": "Contains the definitions for endpoints that are used to contact the cloud service.",
          "pos": [
            21,
            103
          ]
        }
      ]
    },
    {
      "pos": [
        4312,
        4439
      ],
      "content": "**InternalEndpoints**  \nContains the definitions for endpoints that are used by role instances to communicate with each other.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>InternalEndpoints<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            21
          ]
        },
        {
          "content": "Contains the definitions for endpoints that are used by role instances to communicate with each other.",
          "pos": [
            24,
            126
          ]
        }
      ]
    },
    {
      "pos": [
        4443,
        4537
      ],
      "content": "**ConfigurationSettings**  \nContains the setting definitions for features of a specific role.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>ConfigurationSettings<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            25
          ]
        },
        {
          "content": "Contains the setting definitions for features of a specific role.",
          "pos": [
            28,
            93
          ]
        }
      ]
    },
    {
      "pos": [
        4541,
        4729
      ],
      "content": "**Certificates**  \nContains the definitions for certificates that are needed for a role. The previous code example shows a certificate that is used for the configuration of Azure Connect.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Certificates<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            16
          ]
        },
        {
          "content": "Contains the definitions for certificates that are needed for a role. The previous code example shows a certificate that is used for the configuration of Azure Connect.",
          "pos": [
            19,
            187
          ],
          "nodes": [
            {
              "content": "Contains the definitions for certificates that are needed for a role.",
              "pos": [
                0,
                69
              ]
            },
            {
              "content": "The previous code example shows a certificate that is used for the configuration of Azure Connect.",
              "pos": [
                70,
                168
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        4733,
        4942
      ],
      "content": "**LocalResources**  \nContains the definitions for local storage resources. A local storage resource is a reserved directory in the file system of the virtual machine in which an instance of a role is running.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>LocalResources<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            18
          ]
        },
        {
          "content": "Contains the definitions for local storage resources. A local storage resource is a reserved directory in the file system of the virtual machine in which an instance of a role is running.",
          "pos": [
            21,
            208
          ],
          "nodes": [
            {
              "content": "Contains the definitions for local storage resources.",
              "pos": [
                0,
                53
              ]
            },
            {
              "content": "A local storage resource is a reserved directory in the file system of the virtual machine in which an instance of a role is running.",
              "pos": [
                54,
                187
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        4946,
        5100
      ],
      "content": "**Imports**  \nContains the definitions for imported modules. The previous code example shows the modules for Remote Desktop Connection and Azure Connect.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Imports<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            11
          ]
        },
        {
          "content": "Contains the definitions for imported modules. The previous code example shows the modules for Remote Desktop Connection and Azure Connect.",
          "pos": [
            14,
            153
          ],
          "nodes": [
            {
              "content": "Contains the definitions for imported modules.",
              "pos": [
                0,
                46
              ]
            },
            {
              "content": "The previous code example shows the modules for Remote Desktop Connection and Azure Connect.",
              "pos": [
                47,
                139
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        5104,
        5220
      ],
      "content": "**Startup**  \nContains tasks that are run when the role starts. The tasks are defined in a .cmd or executable file.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Startup<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            11
          ]
        },
        {
          "content": "Contains tasks that are run when the role starts. The tasks are defined in a .cmd or executable file.",
          "pos": [
            14,
            115
          ],
          "nodes": [
            {
              "content": "Contains tasks that are run when the role starts.",
              "pos": [
                0,
                49
              ]
            },
            {
              "content": "The tasks are defined in a .cmd or executable file.",
              "pos": [
                50,
                101
              ]
            }
          ]
        }
      ]
    },
    {
      "content": "ServiceConfiguration.cscfg",
      "pos": [
        5248,
        5274
      ]
    },
    {
      "content": "The configuration of the settings for your cloud service is determined by the values in the <bpt id=\"p1\">**</bpt>ServiceConfiguration.cscfg<ept id=\"p1\">**</ept> file.",
      "pos": [
        5275,
        5403
      ]
    },
    {
      "content": "You specify the number of instances that you want to deploy for each role in this file.",
      "pos": [
        5404,
        5491
      ]
    },
    {
      "content": "The values for the configuration settings that you defined in the service definition file are added to the service configuration file.",
      "pos": [
        5492,
        5626
      ]
    },
    {
      "content": "The thumbprints for any management certificates that are associated with the cloud service are also added to the file.",
      "pos": [
        5627,
        5745
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>Azure Service Configuration Schema (.cscfg File)<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/ee758710.aspx)</ept> provides the allowable format for a service configuration file.",
      "pos": [
        5746,
        5920
      ]
    },
    {
      "content": "The service configuration file is not packaged with the application, but is uploaded to Azure as a separate file and is used to configure the cloud service.",
      "pos": [
        5922,
        6078
      ]
    },
    {
      "content": "You can upload a new service configuration file without redeploying your cloud service.",
      "pos": [
        6079,
        6166
      ]
    },
    {
      "content": "The configuration values for the cloud service can be changed while the cloud service is running.",
      "pos": [
        6167,
        6264
      ]
    },
    {
      "content": "The following example shows the configuration settings that can be defined for the Web and Worker roles:",
      "pos": [
        6265,
        6369
      ]
    },
    {
      "pos": [
        7035,
        7247
      ],
      "content": "You can refer to the <bpt id=\"p1\">[</bpt>Service Configuration Schema<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/ee758710.aspx)</ept> for better understanding the XML schema used here, however, here is a quick explanation of the elements:"
    },
    {
      "pos": [
        7250,
        7772
      ],
      "content": "**Instances**  \nConfigures the number of running instances for the role. To prevent your cloud service from potentially becoming unavailable during upgrades, it is recommend that you deploy more than one instance of your web-facing roles. By doing this, you are adhering to the guidelines in the [Azure Compute Service Level Agreement (SLA)](http://azure.microsoft.com/support/legal/sla/), which guarantees 99.95% external connectivity for Internet-facing roles when two or more role instances are deployed for a service.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Instances<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            13
          ]
        },
        {
          "content": "Configures the number of running instances for the role. To prevent your cloud service from potentially becoming unavailable during upgrades, it is recommend that you deploy more than one instance of your web-facing roles. By doing this, you are adhering to the guidelines in the [Azure Compute Service Level Agreement (SLA)](http://azure.microsoft.com/support/legal/sla/), which guarantees 99.95% external connectivity for Internet-facing roles when two or more role instances are deployed for a service.",
          "pos": [
            16,
            521
          ],
          "nodes": [
            {
              "content": "Configures the number of running instances for the role.",
              "pos": [
                0,
                56
              ]
            },
            {
              "content": "To prevent your cloud service from potentially becoming unavailable during upgrades, it is recommend that you deploy more than one instance of your web-facing roles.",
              "pos": [
                57,
                222
              ]
            },
            {
              "content": "By doing this, you are adhering to the guidelines in the <bpt id=\"p1\">[</bpt>Azure Compute Service Level Agreement (SLA)<ept id=\"p1\">](http://azure.microsoft.com/support/legal/sla/)</ept>, which guarantees 99.95% external connectivity for Internet-facing roles when two or more role instances are deployed for a service.",
              "pos": [
                223,
                505
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        7776,
        7970
      ],
      "content": "**ConfigurationSettings**  \nConfigures the settings for the running instances for a role. The name of the `<Setting>` elements must match the setting definitions in the service definition file.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>ConfigurationSettings<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            25
          ]
        },
        {
          "content": "Configures the settings for the running instances for a role. The name of the `<Setting>` elements must match the setting definitions in the service definition file.",
          "pos": [
            28,
            193
          ],
          "nodes": [
            {
              "content": "Configures the settings for the running instances for a role.",
              "pos": [
                0,
                61
              ]
            },
            {
              "content": "The name of the <ph id=\"ph1\">`&lt;Setting&gt;`</ph> elements must match the setting definitions in the service definition file.",
              "pos": [
                62,
                165
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        7973,
        8238
      ],
      "content": "**Certificates**  \nConfigures the certificates that are used by the service. The previous code example shows how to define the certificate for the RemoteAccess module. The value of the *thumbprint* attribute must be set to the thumbprint of the certificate to use.",
      "leadings": [
        "",
        ">"
      ],
      "nodes": [
        {
          "content": "<bpt id=\"p1\">**</bpt>Certificates<ept id=\"p1\">**</ept>",
          "pos": [
            0,
            16
          ]
        },
        {
          "content": "Configures the certificates that are used by the service. The previous code example shows how to define the certificate for the RemoteAccess module. The value of the *thumbprint* attribute must be set to the thumbprint of the certificate to use.",
          "pos": [
            19,
            264
          ],
          "nodes": [
            {
              "content": "Configures the certificates that are used by the service.",
              "pos": [
                0,
                57
              ]
            },
            {
              "content": "The previous code example shows how to define the certificate for the RemoteAccess module.",
              "pos": [
                58,
                148
              ]
            },
            {
              "content": "The value of the <bpt id=\"p1\">*</bpt>thumbprint<ept id=\"p1\">*</ept> attribute must be set to the thumbprint of the certificate to use.",
              "pos": [
                149,
                245
              ]
            }
          ]
        }
      ]
    },
    {
      "pos": [
        8248,
        8469
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The thumbprint for the certificate can be added to the configuration file by using a text editor, or the value can be added on the <bpt id=\"p1\">**</bpt>Certificates<ept id=\"p1\">**</ept> tab of the <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept> page of the role in Visual Studio."
    },
    {
      "content": "Defining ports for role instances",
      "pos": [
        8476,
        8509
      ]
    },
    {
      "content": "Azure allows only one entry point to a web role.",
      "pos": [
        8510,
        8558
      ]
    },
    {
      "content": "This means that all traffic occurs through one IP address.",
      "pos": [
        8559,
        8617
      ]
    },
    {
      "content": "You can configure your websites to share a port by configuring the host header to direct the request to the correct location.",
      "pos": [
        8618,
        8743
      ]
    },
    {
      "content": "You can also configure your applications to listen to well-known ports on the IP address.",
      "pos": [
        8744,
        8833
      ]
    },
    {
      "content": "The following sample shows the configuration for a web role with a website and web application.",
      "pos": [
        8835,
        8930
      ]
    },
    {
      "content": "The website is configured as the default entry location on port 80, and the web applications are configured to receive requests from an alternate host header that is called “mail.mysite.cloudapp.net”.",
      "pos": [
        8931,
        9131
      ]
    },
    {
      "content": "Changing the configuration of a role",
      "pos": [
        10257,
        10293
      ]
    },
    {
      "content": "You can update the configuration of your cloud service while it is running in Azure, without taking the service offline.",
      "pos": [
        10294,
        10414
      ]
    },
    {
      "content": "To change configuration information, you can either upload a new configuration file, or edit the configuration file in place and apply it to your running service.",
      "pos": [
        10415,
        10577
      ]
    },
    {
      "content": "The following changes can be made to the configuration of a service:",
      "pos": [
        10578,
        10646
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Changing the values of configuration settings<ept id=\"p1\">**</ept>",
      "pos": [
        10650,
        10699
      ]
    },
    {
      "content": "When a configuration setting changes, a role instance can choose to apply the change while the instance is online, or to recycle the instance gracefully and apply the change while the instance is offline.",
      "pos": [
        10702,
        10906
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Changing the service topology of role instances<ept id=\"p1\">**</ept>",
      "pos": [
        10910,
        10961
      ]
    },
    {
      "content": "Topology changes do not affect running instances, except where an instance is being removed.",
      "pos": [
        10964,
        11056
      ]
    },
    {
      "content": "All remaining instances generally do not need to be recycled; however, you can choose to recycle role instances in response to a topology change.",
      "pos": [
        11057,
        11202
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Changing the certificate thumbprint<ept id=\"p1\">**</ept>",
      "pos": [
        11206,
        11245
      ]
    },
    {
      "content": "You can only update a certificate when a role instance is offline.",
      "pos": [
        11248,
        11314
      ]
    },
    {
      "content": "If a certificate is added, deleted, or changed while a role instance is online, Azure gracefully takes the instance offline to update the certificate and bring it back online after the change is complete.",
      "pos": [
        11315,
        11519
      ]
    },
    {
      "content": "Handling configuration changes with Service Runtime Events",
      "pos": [
        11525,
        11583
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>Azure Runtime Library<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/dn511024.aspx)</ept> includes the <bpt id=\"p2\">[</bpt>Microsoft.WindowsAzure.ServiceRuntime<ept id=\"p2\">](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.aspx)</ept> namespace, which provides classes for interacting with the Azure environment from code running in an instance of a role.",
      "pos": [
        11584,
        11926
      ]
    },
    {
      "content": "The <bpt id=\"p1\">[</bpt>RoleEnvironment<ept id=\"p1\">](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.aspx)</ept> class defines the following events that are raised before and after a configuration change:",
      "pos": [
        11927,
        12141
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt><bpt id=\"p2\">[</bpt>Changing<ept id=\"p2\">](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.changing.aspx)</ept> event<ept id=\"p1\">**</ept>",
      "pos": [
        12145,
        12275
      ]
    },
    {
      "content": "This occurs before the configuration change is applied to a specified instance of a role giving you a chance to take down the role instances if required.",
      "pos": [
        12278,
        12431
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt><bpt id=\"p2\">[</bpt>Changed<ept id=\"p2\">](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.changed.aspx)</ept> event<ept id=\"p1\">**</ept>",
      "pos": [
        12434,
        12562
      ]
    },
    {
      "content": "Occurs after the configuration change is applied to a specified instance of a role.",
      "pos": [
        12565,
        12648
      ]
    },
    {
      "pos": [
        12652,
        12819
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Because certificate changes always take the instances of a role offline, they do not raise the RoleEnvironment.Changing or RoleEnvironment.Changed events."
    },
    {
      "content": "ServicePackage.cspkg",
      "pos": [
        12845,
        12865
      ]
    },
    {
      "content": "To deploy an application as a cloud service in Azure, you must first package the application in the appropriate format.",
      "pos": [
        12866,
        12985
      ]
    },
    {
      "content": "You can use the <bpt id=\"p1\">**</bpt>CSPack<ept id=\"p1\">**</ept> command-line tool (installed with the <bpt id=\"p2\">[</bpt>Azure SDK<ept id=\"p2\">](http://azure.microsoft.com/downloads/)</ept>) to create the package file as an alternative to Visual Studio.",
      "pos": [
        12986,
        13165
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>CSPack<ept id=\"p1\">**</ept> uses the contents of the service definition file and service configuration file to define the contents of the package.",
      "pos": [
        13168,
        13297
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>CSPack<ept id=\"p1\">**</ept> generates an application package file (.cspkg) that you can upload to Azure by using the <bpt id=\"p2\">[</bpt>Azure Management Portal<ept id=\"p2\">](cloud-services-how-to-create-deploy/#how-to-deploy-a-cloud-service)</ept>.",
      "pos": [
        13298,
        13492
      ]
    },
    {
      "content": "By default, the package is named <ph id=\"ph1\">`[ServiceDefinitionFileName].cspkg`</ph>, but you can specify a different name by using the <ph id=\"ph2\">`/out`</ph> option of <bpt id=\"p1\">**</bpt>CSPack<ept id=\"p1\">**</ept>.",
      "pos": [
        13493,
        13641
      ]
    },
    {
      "content": "Location of the CSPack tool (on windows)",
      "pos": [
        13650,
        13690
      ]
    },
    {
      "content": "SDK Version",
      "pos": [
        13693,
        13704
      ]
    },
    {
      "content": "Path",
      "pos": [
        13707,
        13711
      ]
    },
    {
      "content": "1.7+",
      "pos": [
        13739,
        13743
      ]
    },
    {
      "content": "C:\\\\Program Files\\\\Microsoft SDKs\\\\Azure\\\\.NET SDK\\\\\\[sdk-version\\]\\\\bin\\\\",
      "pos": [
        13753,
        13827
      ]
    },
    {
      "content": "&amp;lt;1.6",
      "pos": [
        13832,
        13839
      ]
    },
    {
      "content": "C:\\\\Program Files\\\\Azure SDK\\\\\\[sdk-version\\]\\\\bin\\\\",
      "pos": [
        13849,
        13901
      ]
    },
    {
      "content": "CSPack.exe (on windows) is available by running the <bpt id=\"p1\">**</bpt>Microsoft Azure Command Prompt<ept id=\"p1\">**</ept> shortcut that is installed with the SDK.",
      "pos": [
        13919,
        14046
      ]
    },
    {
      "content": "Run the CSPack.exe program by itself to see documentation about all of the possible switches and commands.",
      "pos": [
        14054,
        14160
      ]
    },
    {
      "content": "Run your cloud service locally in the <bpt id=\"p1\">**</bpt>Microsoft Azure Compute Emulator<ept id=\"p1\">**</ept>, use the <bpt id=\"p2\">**</bpt>/copyonly<ept id=\"p2\">**</ept> option This option copies the binary files for the application to a directory layout from which they can be run in the compute emulator.",
      "pos": [
        14182,
        14416
      ]
    },
    {
      "content": "Example command to package a cloud service",
      "pos": [
        14422,
        14464
      ]
    },
    {
      "content": "The following example creates an application package that contains the information for a web role.",
      "pos": [
        14465,
        14563
      ]
    },
    {
      "content": "The command specifies the service definition file to use, the directory where binary files can be found, and the name of the package file.",
      "pos": [
        14564,
        14702
      ]
    },
    {
      "content": "If the application contains both a web role and a worker role, the following command is used:",
      "pos": [
        14895,
        14988
      ]
    },
    {
      "content": "Where the variables are defined as follows:",
      "pos": [
        15252,
        15295
      ]
    },
    {
      "content": "Variable",
      "pos": [
        15299,
        15307
      ]
    },
    {
      "content": "Value",
      "pos": [
        15327,
        15332
      ]
    },
    {
      "content": "\\[DirectoryName\\]",
      "pos": [
        15375,
        15392
      ]
    },
    {
      "content": "The subdirectory under the root project directory that contains the .csdef file of the Azure project.",
      "pos": [
        15403,
        15504
      ]
    },
    {
      "content": "\\[ServiceDefinition\\]",
      "pos": [
        15508,
        15529
      ]
    },
    {
      "content": "The name of the service definition file.",
      "pos": [
        15536,
        15576
      ]
    },
    {
      "content": "By default, this file is named ServiceDefinition.csdef.",
      "pos": [
        15577,
        15632
      ]
    },
    {
      "content": "\\[OutputFileName\\]",
      "pos": [
        15638,
        15656
      ]
    },
    {
      "content": "The name for the generated package file.",
      "pos": [
        15666,
        15706
      ]
    },
    {
      "content": "Typically, this is set to the name of the application.",
      "pos": [
        15707,
        15761
      ]
    },
    {
      "content": "If no file name is specified, the application package is created as \\[ApplicationName\\].cspkg.",
      "pos": [
        15762,
        15856
      ]
    },
    {
      "content": "\\[RoleName\\]",
      "pos": [
        15860,
        15872
      ]
    },
    {
      "content": "The name of the role as defined in the service definition file.",
      "pos": [
        15888,
        15951
      ]
    },
    {
      "content": "\\[RoleBinariesDirectory]",
      "pos": [
        15955,
        15979
      ]
    },
    {
      "content": "The location of the binary files for the role.",
      "pos": [
        15982,
        16028
      ]
    },
    {
      "content": "\\[VirtualPath\\]",
      "pos": [
        16032,
        16047
      ]
    },
    {
      "content": "The physical directories for each virtual path defined in the Sites section of the service definition.",
      "pos": [
        16060,
        16162
      ]
    },
    {
      "content": "\\[PhysicalPath\\]",
      "pos": [
        16166,
        16182
      ]
    },
    {
      "content": "The physical directories of the contents for each virtual path defined in the site node of the service definition.",
      "pos": [
        16194,
        16308
      ]
    },
    {
      "content": "\\[RoleAssemblyName\\]",
      "pos": [
        16312,
        16332
      ]
    },
    {
      "content": "The name of the binary file for the role.",
      "pos": [
        16340,
        16381
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        16389,
        16399
      ]
    },
    {
      "content": "I'm creating a cloud service package and I want to...",
      "pos": [
        16401,
        16454
      ]
    },
    {
      "content": "Setup remote desktop for a cloud service instance",
      "pos": [
        16670,
        16719
      ]
    },
    {
      "content": "Deploy a Cloud Service project",
      "pos": [
        16739,
        16769
      ]
    },
    {
      "content": "I am using Visual Studio and I want to...",
      "pos": [
        16780,
        16821
      ]
    },
    {
      "content": "Create a new cloud service",
      "pos": [
        16826,
        16852
      ]
    },
    {
      "content": "Reconfigure an existing cloud service",
      "pos": [
        16868,
        16905
      ]
    },
    {
      "content": "Deploy a Cloud Service project",
      "pos": [
        16926,
        16956
      ]
    },
    {
      "content": "Setup remote desktop for a cloud service instance",
      "pos": [
        16972,
        17021
      ]
    },
    {
      "content": "test",
      "pos": [
        17036,
        17040
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"What is a Cloud Service Model and Package in Azure\" \n    description=\"Describes the cloud service model (.csdef, .cscfg) and package (.cspkg) in Azure\" \n    services=\"cloud-services\" \n    documentationCenter=\"\" \n    authors=\"Thraka\" \n    manager=\"timlt\" \n    editor=\"\"/>\n<tags \n    ms.service=\"cloud-services\" \n    ms.workload=\"tbd\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"07/06/2015\" \n    ms.author=\"adegeo\"/>\n\n# What is the Cloud Service Model and how do I package it?\nA cloud service is created from three components, the service definition _(.csdef)_, the service config _(.cscfg)_, and a service package _(.cspkg)_. Both the **ServiceDefinition.csdef** and **ServiceConfig.cscfg** files are XML-based and describe the structure of the cloud service and how it's configured; collectively called the model. The **ServicePackage.cspkg** is a zip file that is generated from the **ServiceDefinition.csdef** and among other things, contains all of the required binary-based dependencies. Azure creates a cloud service from both the **ServicePackage.cspkg** and the **ServiceConfig.cscfg**.\n\nOnce the cloud service is running in Azure, you can reconfigure it through the **ServiceConfig.cscfg** file, but you cannot alter the definition.\n\n## What would you like to know more about?\n\n* I want to know more about the [ServiceDefinition.csdef](#csdef) and [ServiceConfig.cscfg](#cscfg) files.\n* I already know about that, give me [some examples](#next-steps) on what I can configure.\n* I want to create the [ServicePackage.cspkg](#cspkg). \n* I am using Visual Studio and I want to...\n    * [Create a new cloud service][vs_create]\n    * [Reconfigure an existing cloud service][vs_reconfigure]\n    * [Deploy a Cloud Service project][vs_deploy]\n    * [Remote desktop into a cloud service instance][remotedesktop]\n\n<a name=\"csdef\"></a>\n## ServiceDefinition.csdef\nThe **ServiceDefinition.csdef** file specifies the settings that are used by Azure to configure a cloud service. The [Azure Service Definition Schema (.csdef File)](https://msdn.microsoft.com/library/azure/ee758711.aspx) provides the allowable format for a service definition file. The following example shows the settings that can be defined for the Web and Worker roles:\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<ServiceDefinition name=\"MyServiceName\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2008/10/ServiceDefinition\">\n  <WebRole name=\"WebRole1\" vmsize=\"Medium\">\n    <Sites>\n      <Site name=\"Web\">\n        <Bindings>\n          <Binding name=\"HttpIn\" endpointName=\"HttpIn\" />\n        </Bindings>\n      </Site>\n    </Sites>\n    <Endpoints>\n      <InputEndpoint name=\"HttpIn\" protocol=\"http\" port=\"80\" />\n      <InternalEndpoint name=\"InternalHttpIn\" protocol=\"http\" />\n    </Endpoints>\n    <Certificates>\n      <Certificate name=\"Certificate1\" storeLocation=\"LocalMachine\" storeName=\"My\" />\n    </Certificates>\n    <Imports>\n      <Import moduleName=\"Connect\" />\n      <Import moduleName=\"Diagnostics\" />\n      <Import moduleName=\"RemoteAccess\" />\n      <Import moduleName=\"RemoteForwarder\" />\n    </Imports>\n    <LocalResources>\n      <LocalStorage name=\"localStoreOne\" sizeInMB=\"10\" />\n      <LocalStorage name=\"localStoreTwo\" sizeInMB=\"10\" cleanOnRoleRecycle=\"false\" />\n    </LocalResources>\n    <Startup>\n      <Task commandLine=\"Startup.cmd\" executionContext=\"limited\" taskType=\"simple\" />\n    </Startup>\n  </WebRole>\n\n  <WorkerRole name=\"WorkerRole1\">\n    <ConfigurationSettings>\n      <Setting name=\"DiagnosticsConnectionString\" />\n    </ConfigurationSettings>\n    <Imports>\n      <Import moduleName=\"RemoteAccess\" />\n      <Import moduleName=\"RemoteForwarder\" />\n    </Imports>\n    <Endpoints>\n      <InputEndpoint name=\"Endpoint1\" protocol=\"tcp\" port=\"10000\" />\n      <InternalEndpoint name=\"Endpoint2\" protocol=\"tcp\" />\n    </Endpoints>\n  </WorkerRole>\n</ServiceDefinition>\n```\n\nYou can refer to the [Service Definition Schema][] for a better understanding of the XML schema used here, however, here is a quick explanation of some of the elements:\n\n>**Sites**  \n>Contains the definitions for websites or web applications that are hosted in IIS7.\n>\n>**InputEndpoints**  \n>Contains the definitions for endpoints that are used to contact the cloud service.\n>\n>**InternalEndpoints**  \n>Contains the definitions for endpoints that are used by role instances to communicate with each other.\n>\n>**ConfigurationSettings**  \n>Contains the setting definitions for features of a specific role.\n>\n>**Certificates**  \n>Contains the definitions for certificates that are needed for a role. The previous code example shows a certificate that is used for the configuration of Azure Connect.\n>\n>**LocalResources**  \n>Contains the definitions for local storage resources. A local storage resource is a reserved directory in the file system of the virtual machine in which an instance of a role is running.\n>\n>**Imports**  \n>Contains the definitions for imported modules. The previous code example shows the modules for Remote Desktop Connection and Azure Connect.\n>\n>**Startup**  \n>Contains tasks that are run when the role starts. The tasks are defined in a .cmd or executable file.\n\n\n\n<a name=\"cscfg\"></a>\n## ServiceConfiguration.cscfg\nThe configuration of the settings for your cloud service is determined by the values in the **ServiceConfiguration.cscfg** file. You specify the number of instances that you want to deploy for each role in this file. The values for the configuration settings that you defined in the service definition file are added to the service configuration file. The thumbprints for any management certificates that are associated with the cloud service are also added to the file. The [Azure Service Configuration Schema (.cscfg File)](https://msdn.microsoft.com/library/azure/ee758710.aspx) provides the allowable format for a service configuration file.\n\nThe service configuration file is not packaged with the application, but is uploaded to Azure as a separate file and is used to configure the cloud service. You can upload a new service configuration file without redeploying your cloud service. The configuration values for the cloud service can be changed while the cloud service is running. The following example shows the configuration settings that can be defined for the Web and Worker roles:\n\n```xml\n<?xml version=\"1.0\"?>\n<ServiceConfiguration serviceName=\"MyServiceName\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2008/10/ServiceConfiguration\">\n  <Role name=\"WebRole1\">\n    <Instances count=\"2\" />\n    <ConfigurationSettings>\n      <Setting name=\"SettingName\" value=\"SettingValue\" />\n    </ConfigurationSettings>\n\n    <Certificates>\n      <Certificate name=\"CertificateName\" thumbprint=\"CertThumbprint\" thumbprintAlgorithm=\"sha1\" />\n      <Certificate name=\"Microsoft.WindowsAzure.Plugins.RemoteAccess.PasswordEncryption\"\n         thumbprint=\"CertThumbprint\" thumbprintAlgorithm=\"sha1\" />\n    </Certificates>\n  </Role>\n</ServiceConfiguration>\n```\n\nYou can refer to the [Service Configuration Schema](https://msdn.microsoft.com/library/azure/ee758710.aspx) for better understanding the XML schema used here, however, here is a quick explanation of the elements:\n\n>**Instances**  \n>Configures the number of running instances for the role. To prevent your cloud service from potentially becoming unavailable during upgrades, it is recommend that you deploy more than one instance of your web-facing roles. By doing this, you are adhering to the guidelines in the [Azure Compute Service Level Agreement (SLA)](http://azure.microsoft.com/support/legal/sla/), which guarantees 99.95% external connectivity for Internet-facing roles when two or more role instances are deployed for a service. \n\n>**ConfigurationSettings**  \n>Configures the settings for the running instances for a role. The name of the `<Setting>` elements must match the setting definitions in the service definition file.\n\n>**Certificates**  \n>Configures the certificates that are used by the service. The previous code example shows how to define the certificate for the RemoteAccess module. The value of the *thumbprint* attribute must be set to the thumbprint of the certificate to use.\n\n<p/>\n\n >[AZURE.NOTE] The thumbprint for the certificate can be added to the configuration file by using a text editor, or the value can be added on the **Certificates** tab of the **Properties** page of the role in Visual Studio.\n\n\n\n## Defining ports for role instances\nAzure allows only one entry point to a web role. This means that all traffic occurs through one IP address. You can configure your websites to share a port by configuring the host header to direct the request to the correct location. You can also configure your applications to listen to well-known ports on the IP address.\n\nThe following sample shows the configuration for a web role with a website and web application. The website is configured as the default entry location on port 80, and the web applications are configured to receive requests from an alternate host header that is called “mail.mysite.cloudapp.net”.\n\n```xml\n<WebRole>\n  <ConfigurationSettings>\n    <Setting name=\"DiagnosticsConnectionString\" />\n  </ConfigurationSettings>\n  <Endpoints>\n    <InputEndpoint name=\"HttpIn\" protocol=\"http\" port=\"80\" />\n    <InputEndpoint name=\"Https\" protocol=\"https\" port=\"443\" certificate=\"SSL\"/>\n    <InputEndpoint name=\"NetTcp\" protocol=\"tcp\" port=\"808\" certificate=\"SSL\"/>\n  </Endpoints>\n  <LocalResources>\n    <LocalStorage name=\"Sites\" cleanOnRoleRecycle=\"true\" sizeInMB=\"100\" />\n  </LocalResources>\n  <Site name=\"Mysite\" packageDir=\"Sites\\Mysite\">\n    <Bindings>\n      <Binding name=\"http\" endpointName=\"HttpIn\" />\n      <Binding name=\"https\" endpointName=\"Https\" />\n      <Binding name=\"tcp\" endpointName=\"NetTcp\" />\n    </Bindings>\n  </Site>\n  <Site name=\"MailSite\" packageDir=\"MailSite\">\n    <Bindings>\n      <Binding name=\"mail\" endpointName=\"HttpIn\" hostheader=\"mail.mysite.cloudapp.net\" />\n    </Bindings>\n    <VirtualDirectory name=\"artifacts\" />\n    <VirtualApplication name=\"storageproxy\">\n      <VirtualDirectory name=\"packages\" packageDir=\"Sites\\storageProxy\\packages\"/>\n    </VirtualApplication>\n  </Site>\n</WebRole>\n```\n\n\n## Changing the configuration of a role\nYou can update the configuration of your cloud service while it is running in Azure, without taking the service offline. To change configuration information, you can either upload a new configuration file, or edit the configuration file in place and apply it to your running service. The following changes can be made to the configuration of a service:\n\n- **Changing the values of configuration settings**  \nWhen a configuration setting changes, a role instance can choose to apply the change while the instance is online, or to recycle the instance gracefully and apply the change while the instance is offline.\n\n- **Changing the service topology of role instances**  \nTopology changes do not affect running instances, except where an instance is being removed. All remaining instances generally do not need to be recycled; however, you can choose to recycle role instances in response to a topology change.\n\n- **Changing the certificate thumbprint**  \nYou can only update a certificate when a role instance is offline. If a certificate is added, deleted, or changed while a role instance is online, Azure gracefully takes the instance offline to update the certificate and bring it back online after the change is complete.\n\n### Handling configuration changes with Service Runtime Events\nThe [Azure Runtime Library](https://msdn.microsoft.com/library/azure/dn511024.aspx) includes the [Microsoft.WindowsAzure.ServiceRuntime](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.aspx) namespace, which provides classes for interacting with the Azure environment from code running in an instance of a role. The [RoleEnvironment](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.aspx) class defines the following events that are raised before and after a configuration change:\n\n- **[Changing](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.changing.aspx) event**  \nThis occurs before the configuration change is applied to a specified instance of a role giving you a chance to take down the role instances if required.\n- **[Changed](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.changed.aspx) event**  \nOccurs after the configuration change is applied to a specified instance of a role.\n\n> [AZURE.NOTE] Because certificate changes always take the instances of a role offline, they do not raise the RoleEnvironment.Changing or RoleEnvironment.Changed events.\n\n<a name=\"cspkg\"></a>\n## ServicePackage.cspkg\nTo deploy an application as a cloud service in Azure, you must first package the application in the appropriate format. You can use the **CSPack** command-line tool (installed with the [Azure SDK](http://azure.microsoft.com/downloads/)) to create the package file as an alternative to Visual Studio. \n\n**CSPack** uses the contents of the service definition file and service configuration file to define the contents of the package. **CSPack** generates an application package file (.cspkg) that you can upload to Azure by using the [Azure Management Portal](cloud-services-how-to-create-deploy/#how-to-deploy-a-cloud-service). By default, the package is named `[ServiceDefinitionFileName].cspkg`, but you can specify a different name by using the `/out` option of **CSPack**.\n\n###### Location of the CSPack tool (on windows)\n| SDK Version | Path |\n| ----------- | ---- |\n| 1.7+        | C:\\\\Program Files\\\\Microsoft SDKs\\\\Azure\\\\.NET SDK\\\\\\[sdk-version\\]\\\\bin\\\\ |\n| &lt;1.6        | C:\\\\Program Files\\\\Azure SDK\\\\\\[sdk-version\\]\\\\bin\\\\ |\n\n>[AZURE.NOTE]\nCSPack.exe (on windows) is available by running the **Microsoft Azure Command Prompt** shortcut that is installed with the SDK.  \n>  \n>Run the CSPack.exe program by itself to see documentation about all of the possible switches and commands.\n\n<p />\n\n>[AZURE.TIP]\nRun your cloud service locally in the **Microsoft Azure Compute Emulator**, use the **/copyonly** option This option copies the binary files for the application to a directory layout from which they can be run in the compute emulator.\n\n### Example command to package a cloud service\nThe following example creates an application package that contains the information for a web role. The command specifies the service definition file to use, the directory where binary files can be found, and the name of the package file.\n\n    cspack [DirectoryName]\\[ServiceDefinition]\n           /role:[RoleName];[RoleBinariesDirectory]\n           /sites:[RoleName];[VirtualPath];[PhysicalPath]\n           /out:[OutputFileName]\n\nIf the application contains both a web role and a worker role, the following command is used:\n\n    cspack [DirectoryName]\\[ServiceDefinition]\n           /out:[OutputFileName]\n           /role:[RoleName];[RoleBinariesDirectory]\n           /sites:[RoleName];[VirtualPath];[PhysicalPath]\n           /role:[RoleName];[RoleBinariesDirectory];[RoleAssemblyName]\n\nWhere the variables are defined as follows:\n\n| Variable                  | Value |\n| ------------------------- | ----- |\n| \\[DirectoryName\\]         | The subdirectory under the root project directory that contains the .csdef file of the Azure project.|\n| \\[ServiceDefinition\\]     | The name of the service definition file. By default, this file is named ServiceDefinition.csdef.  |\n| \\[OutputFileName\\]        | The name for the generated package file. Typically, this is set to the name of the application. If no file name is specified, the application package is created as \\[ApplicationName\\].cspkg.|\n| \\[RoleName\\]              | The name of the role as defined in the service definition file.|\n| \\[RoleBinariesDirectory] | The location of the binary files for the role.|\n| \\[VirtualPath\\]           | The physical directories for each virtual path defined in the Sites section of the service definition.|\n| \\[PhysicalPath\\]          | The physical directories of the contents for each virtual path defined in the site node of the service definition.|\n| \\[RoleAssemblyName\\]      | The name of the binary file for the role.| \n\n\n## Next steps\n\nI'm creating a cloud service package and I want to...\n\n<!--\n* [Configure Sizes for Cloud Services](!!!!!https://msdn.microsoft.com/library/azure/ee814754.aspx)  \n* [Configure Local Storage Resources](!!!!!https://msdn.microsoft.com/library/azure/ee758708.aspx)\n-->\n\n* [Setup remote desktop for a cloud service instance][remotedesktop]\n* [Deploy a Cloud Service project][deploy]\n\nI am using Visual Studio and I want to...\n\n* [Create a new cloud service][vs_create]\n* [Reconfigure an existing cloud service][vs_reconfigure]\n* [Deploy a Cloud Service project][vs_deploy]\n* [Setup remote desktop for a cloud service instance][vs_remote]\n\n\n[deploy]: cloud-services-how-to-create-deploy-portal.md\n[remotedesktop]: cloud-services-role-enable-remote-desktop.md\n[vs_remote]: https://msdn.microsoft.com/en-us/library/gg443832.aspx\n[vs_deploy]: https://msdn.microsoft.com/en-us/library/ee460772.aspx\n[vs_reconfigure]: https://msdn.microsoft.com/library/ee405486.aspx\n[vs_create]: https://msdn.microsoft.com/en-us/library/ee405487.aspx\ntest\n"
}