{
  "nodes": [
    {
      "content": "Linux Agent User Guide for Azure",
      "pos": [
        28,
        60
      ]
    },
    {
      "content": "Learn how to install and configure Linux Agent (waagent) to manage your virtual machine's interaction with Azure Fabric Controller.",
      "pos": [
        80,
        211
      ]
    },
    {
      "content": "Azure Linux Agent User Guide",
      "pos": [
        550,
        578
      ]
    },
    {
      "content": "Introduction",
      "pos": [
        582,
        594
      ]
    },
    {
      "content": "The Azure Linux Agent (/usr/sbin/waagent) manages interaction between a virtual machine and the Azure Fabric Controller.",
      "pos": [
        596,
        716
      ]
    },
    {
      "content": "It does the following:",
      "pos": [
        717,
        739
      ]
    },
    {
      "content": "Image Provisioning",
      "pos": [
        745,
        763
      ]
    },
    {
      "content": "Create a user account",
      "pos": [
        770,
        791
      ]
    },
    {
      "content": "Configure SSH authentication types",
      "pos": [
        796,
        830
      ]
    },
    {
      "content": "Deploy SSH public keys and key pairs",
      "pos": [
        835,
        871
      ]
    },
    {
      "content": "Sets the host name",
      "pos": [
        876,
        894
      ]
    },
    {
      "content": "Publishes the host name to the platform DNS",
      "pos": [
        899,
        942
      ]
    },
    {
      "content": "Reports SSH host key fingerprint to the platform",
      "pos": [
        947,
        995
      ]
    },
    {
      "content": "Manages the resource disk",
      "pos": [
        1000,
        1025
      ]
    },
    {
      "content": "Formats and mounts the resource disk",
      "pos": [
        1030,
        1066
      ]
    },
    {
      "content": "Configures swap space",
      "pos": [
        1071,
        1092
      ]
    },
    {
      "content": "Networking",
      "pos": [
        1097,
        1107
      ]
    },
    {
      "content": "Manages routes to improve compatibility with platform DHCP servers",
      "pos": [
        1114,
        1180
      ]
    },
    {
      "content": "Ensures the stability of the network interface name",
      "pos": [
        1185,
        1236
      ]
    },
    {
      "content": "Kernel",
      "pos": [
        1241,
        1247
      ]
    },
    {
      "content": "Configures virtual NUMA",
      "pos": [
        1254,
        1277
      ]
    },
    {
      "content": "Consumes Hyper-V entropy for /dev/random",
      "pos": [
        1282,
        1322
      ]
    },
    {
      "content": "Configures SCSI timeouts for the root device (which could be remote)",
      "pos": [
        1327,
        1395
      ]
    },
    {
      "content": "Diagnostics",
      "pos": [
        1400,
        1411
      ]
    },
    {
      "content": "Redirects the console to the serial port",
      "pos": [
        1418,
        1458
      ]
    },
    {
      "content": "SCVMM Deployments",
      "pos": [
        1463,
        1480
      ]
    },
    {
      "content": "Detects and bootstraps the VMM agent for Linux when running in a System Center Virtual Machine Manager 2012 R2 environment",
      "pos": [
        1489,
        1611
      ]
    },
    {
      "content": "VM Extension",
      "pos": [
        1616,
        1628
      ]
    },
    {
      "content": "Inject component authored by Microsoft and Partners into Linux VM (IaaS) to enable software and configuration automation",
      "pos": [
        1637,
        1757
      ]
    },
    {
      "pos": [
        1764,
        1903
      ],
      "content": "VM Extension reference implementation on <bpt id=\"p1\">[</bpt>https://github.com/Azure/azure-linux-extensions<ept id=\"p1\">](https://github.com/Azure/azure-linux-extensions)</ept>"
    },
    {
      "content": "Communication",
      "pos": [
        1908,
        1921
      ]
    },
    {
      "content": "The information flow from the platform to the agent occurs via two channels:",
      "pos": [
        1923,
        1999
      ]
    },
    {
      "content": "A boot-time attached DVD for IaaS deployments.",
      "pos": [
        2003,
        2049
      ]
    },
    {
      "content": "This DVD includes an OVF-compliant configuration file that includes all provisioning information other than the actual SSH keypairs.",
      "pos": [
        2050,
        2182
      ]
    },
    {
      "content": "A TCP endpoint exposing a REST API used to obtain deployment and topology configuration.",
      "pos": [
        2186,
        2274
      ]
    },
    {
      "content": "Getting the Linux Agent",
      "pos": [
        2279,
        2302
      ]
    },
    {
      "content": "You can get the Latest Linux Agent directly from:",
      "pos": [
        2303,
        2352
      ]
    },
    {
      "content": "The different Distribution providers endorsing Linux on Azure",
      "pos": [
        2357,
        2418
      ]
    },
    {
      "pos": [
        2463,
        2571
      ],
      "content": "or from the <bpt id=\"p1\">[</bpt>GitHub Open Source Repository for the Azure Linux Agent<ept id=\"p1\">](https://github.com/Azure/WALinuxAgent)</ept>"
    },
    {
      "content": "Requirements",
      "pos": [
        2577,
        2589
      ]
    },
    {
      "content": "The following systems have been tested and are known to work with the Azure Linux Agent.",
      "pos": [
        2590,
        2678
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Please note that this list may differ from the official list of supported systems on the Microsoft Azure Platform<ept id=\"p1\">**</ept>, as described here:",
      "pos": [
        2679,
        2816
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>http://support.microsoft.com/kb/2805216<ept id=\"p1\">](http://support.microsoft.com/kb/2805216)</ept>",
      "pos": [
        2817,
        2899
      ]
    },
    {
      "content": "Supported Linux Distributions",
      "pos": [
        2904,
        2933
      ]
    },
    {
      "content": "CoreOS",
      "pos": [
        2937,
        2943
      ]
    },
    {
      "content": "CentOS 6.2+",
      "pos": [
        2946,
        2957
      ]
    },
    {
      "content": "Debian 7.0+",
      "pos": [
        2960,
        2971
      ]
    },
    {
      "content": "Ubuntu 12.04+",
      "pos": [
        2974,
        2987
      ]
    },
    {
      "content": "openSUSE 12.3+",
      "pos": [
        2990,
        3004
      ]
    },
    {
      "content": "SLES 11 SP2+",
      "pos": [
        3007,
        3019
      ]
    },
    {
      "content": "Oracle Linux 6.4+",
      "pos": [
        3022,
        3039
      ]
    },
    {
      "content": "Other Supported Systems:",
      "pos": [
        3041,
        3065
      ]
    },
    {
      "content": "FreeBSD 9+ (Azure Linux Agent v2.0.10+)",
      "pos": [
        3069,
        3108
      ]
    },
    {
      "content": "The Linux agent depends on some system packages in order to function properly:",
      "pos": [
        3111,
        3189
      ]
    },
    {
      "content": "Python 2.6+",
      "pos": [
        3193,
        3204
      ]
    },
    {
      "content": "Openssl 1.0+",
      "pos": [
        3207,
        3219
      ]
    },
    {
      "content": "Openssh 5.3+",
      "pos": [
        3222,
        3234
      ]
    },
    {
      "content": "Filesystem utilities: sfdisk, fdisk, mkfs, parted",
      "pos": [
        3237,
        3286
      ]
    },
    {
      "content": "Password tools: chpasswd, sudo",
      "pos": [
        3289,
        3319
      ]
    },
    {
      "content": "Text processing tools: sed, grep",
      "pos": [
        3322,
        3354
      ]
    },
    {
      "content": "Network tools: ip-route",
      "pos": [
        3357,
        3380
      ]
    },
    {
      "content": "Installation",
      "pos": [
        3385,
        3397
      ]
    },
    {
      "content": "Installation using an RPM or a DEB package from your distribution's package repository is the preferred method of installing and upgrading the Azure Linux Agent.",
      "pos": [
        3399,
        3560
      ]
    },
    {
      "content": "If installing manually, the 'waagent' script should be copied to /usr/sbin/waagent and installed by running:",
      "pos": [
        3562,
        3670
      ]
    },
    {
      "content": "The agent's log file is kept at /var/log/waagent.log.",
      "pos": [
        3760,
        3813
      ]
    },
    {
      "content": "Command Line Options",
      "pos": [
        3818,
        3838
      ]
    },
    {
      "content": "Flags",
      "pos": [
        3843,
        3848
      ]
    },
    {
      "content": "verbose: Increase verbosity of specified command",
      "pos": [
        3852,
        3900
      ]
    },
    {
      "content": "force: Skip interactive confirmation for some commands",
      "pos": [
        3903,
        3957
      ]
    },
    {
      "content": "Commands",
      "pos": [
        3962,
        3970
      ]
    },
    {
      "content": "help: Lists the supported commands and flags.",
      "pos": [
        3974,
        4019
      ]
    },
    {
      "content": "install: Manual installation of the agent",
      "pos": [
        4023,
        4064
      ]
    },
    {
      "content": "Checks the system for required dependencies",
      "pos": [
        4068,
        4111
      ]
    },
    {
      "content": "Creates the SysV init script (/etc/init.d/waagent), the logrotate configuration file (/etc/logrotate.d/waagent and configures the image to run the init script on boot",
      "pos": [
        4116,
        4282
      ]
    },
    {
      "content": "Writes sample configuration file to /etc/waagent.conf",
      "pos": [
        4287,
        4340
      ]
    },
    {
      "content": "Any existing configuration file is moved to /etc/waagent.conf.old",
      "pos": [
        4345,
        4410
      ]
    },
    {
      "content": "Detects kernel version and applies the VNUMA workaround if necessary",
      "pos": [
        4415,
        4483
      ]
    },
    {
      "content": "Moves udev rules that may interfere with networking (/lib/udev/rules.d/75-persistent-net-generator.rules, /etc/udev/rules.d/70-persistent-net.rules) to /var/lib/waagent/",
      "pos": [
        4488,
        4657
      ]
    },
    {
      "content": "uninstall: Remove waagent and associated files",
      "pos": [
        4663,
        4709
      ]
    },
    {
      "content": "Unregisters the init script from the system and deletes it",
      "pos": [
        4713,
        4771
      ]
    },
    {
      "content": "Deletes the logrotate configuration and the waagent config file in /etc/waagent.conf",
      "pos": [
        4776,
        4860
      ]
    },
    {
      "content": "Restores any moved udev rules that were moved during installation",
      "pos": [
        4865,
        4930
      ]
    },
    {
      "content": "Automatic reverting of the VNUMA workaround is not supported, please edit the GRUB configuration files by hand to re-enable NUMA if required.",
      "pos": [
        4935,
        5076
      ]
    },
    {
      "content": "deprovision: Attempt to clean the system and make it suitable for re-provisioning.",
      "pos": [
        5080,
        5162
      ]
    },
    {
      "content": "This operation deleted the following:",
      "pos": [
        5163,
        5200
      ]
    },
    {
      "content": "All SSH host keys (if Provisioning.RegenerateSshHostKeyPair is 'y' in the configuration file)",
      "pos": [
        5204,
        5297
      ]
    },
    {
      "content": "Nameserver configuration in /etc/resolv.conf",
      "pos": [
        5302,
        5346
      ]
    },
    {
      "content": "Root password from /etc/shadow (if Provisioning.DeleteRootPassword is 'y' in the configuration file)",
      "pos": [
        5351,
        5451
      ]
    },
    {
      "content": "Cached DHCP client leases",
      "pos": [
        5456,
        5481
      ]
    },
    {
      "content": "Resets host name to localhost.localdomain",
      "pos": [
        5486,
        5527
      ]
    },
    {
      "pos": [
        5530,
        5661
      ],
      "content": "<bpt id=\"p1\">**</bpt>Warning:<ept id=\"p1\">**</ept> Deprovision does not guarantee that the image is cleared of all sensitive information and suitable for redistribution."
    },
    {
      "content": "deprovision+user: Performs everything under -deprovision (above) and also deletes the last provisioned user account (obtained from /var/lib/waagent) and associated data.",
      "pos": [
        5665,
        5834
      ]
    },
    {
      "content": "This parameter is when de-provisioning an image that was previously provisioning on Azure so it may be captured and re-used.",
      "pos": [
        5835,
        5959
      ]
    },
    {
      "content": "version: Displays the version of waagent",
      "pos": [
        5963,
        6003
      ]
    },
    {
      "pos": [
        6007,
        6201
      ],
      "content": "serialconsole: Configures GRUB to mark ttyS0 (the first serial port) as\n the boot console. This ensures that kernel bootup logs are sent to the\n serial port and made available for debugging.",
      "leadings": [
        "",
        "  ",
        "  "
      ],
      "nodes": [
        {
          "content": "serialconsole: Configures GRUB to mark ttyS0 (the first serial port) as",
          "pos": [
            0,
            71
          ]
        },
        {
          "content": "the boot console. This ensures that kernel bootup logs are sent to the",
          "pos": [
            73,
            143
          ],
          "nodes": [
            {
              "content": "the boot console.",
              "pos": [
                0,
                17
              ]
            },
            {
              "content": "This ensures that kernel bootup logs are sent to the",
              "pos": [
                18,
                70
              ]
            }
          ]
        },
        {
          "content": "serial port and made available for debugging.",
          "pos": [
            145,
            190
          ]
        }
      ]
    },
    {
      "pos": [
        6205,
        6346
      ],
      "content": "daemon: Run waagent as a daemon to manage interaction with the platform.\n This argument is specified to waagent in the waagent init script.",
      "leadings": [
        "",
        "  "
      ],
      "nodes": [
        {
          "content": "daemon: Run waagent as a daemon to manage interaction with the platform.",
          "pos": [
            0,
            72
          ]
        },
        {
          "content": "This argument is specified to waagent in the waagent init script.",
          "pos": [
            74,
            139
          ]
        }
      ]
    },
    {
      "content": "Configuration",
      "pos": [
        6350,
        6363
      ]
    },
    {
      "content": "A configuration file (/etc/waagent.conf) controls the actions of waagent.",
      "pos": [
        6365,
        6438
      ]
    },
    {
      "content": "A sample configuration file is shown below:",
      "pos": [
        6440,
        6483
      ]
    },
    {
      "content": "The various configuration options are described in detail below.",
      "pos": [
        7086,
        7150
      ]
    },
    {
      "content": "Configuration options are of three types; Boolean, String or Integer.",
      "pos": [
        7151,
        7220
      ]
    },
    {
      "content": "The Boolean configuration options can be specified as \"y\" or \"n\".",
      "pos": [
        7221,
        7286
      ]
    },
    {
      "content": "The special keyword \"None\" may be used for some string type configuration entries as detailed below.",
      "pos": [
        7287,
        7387
      ]
    },
    {
      "content": "Role.StateConsumer:",
      "pos": [
        7391,
        7410
      ]
    },
    {
      "content": "Type: String",
      "pos": [
        7414,
        7426
      ]
    },
    {
      "content": "Default: None",
      "pos": [
        7429,
        7442
      ]
    },
    {
      "content": "If a path to an executable program is specified, it is invoked when waagent has provisioned the image and the \"Ready\" state is about to be reported to the Fabric.",
      "pos": [
        7444,
        7606
      ]
    },
    {
      "content": "The argument specified to the program will be \"Ready\".",
      "pos": [
        7607,
        7661
      ]
    },
    {
      "content": "The agent will not wait for the program to return before continuing.",
      "pos": [
        7662,
        7730
      ]
    },
    {
      "content": "Role.ConfigurationConsumer:",
      "pos": [
        7734,
        7761
      ]
    },
    {
      "content": "Type: String",
      "pos": [
        7765,
        7777
      ]
    },
    {
      "content": "Default: None",
      "pos": [
        7780,
        7793
      ]
    },
    {
      "content": "If a path to an executable program is specified, the program is invoked when the Fabric indicates that a configuration file is available for the virtual machine.",
      "pos": [
        7795,
        7956
      ]
    },
    {
      "content": "The path to the XML configuration file is provided as an argument to the executable.",
      "pos": [
        7957,
        8041
      ]
    },
    {
      "content": "This may be invoked multiple times whenever the configuration file changes.",
      "pos": [
        8042,
        8117
      ]
    },
    {
      "content": "A sample file is provided in the Appendix.",
      "pos": [
        8118,
        8160
      ]
    },
    {
      "content": "The current path of this file is /var/lib/waagent/HostingEnvironmentConfig.xml.",
      "pos": [
        8161,
        8240
      ]
    },
    {
      "content": "Role.TopologyConsumer:",
      "pos": [
        8244,
        8266
      ]
    },
    {
      "content": "Type: String",
      "pos": [
        8270,
        8282
      ]
    },
    {
      "content": "Default: None",
      "pos": [
        8285,
        8298
      ]
    },
    {
      "content": "If a path to an executable program is specified, the program is invoked when the Fabric indicates that a new network topology layout is available for the virtual machine.The path to the XML configuration file is provided as an argument to the executable.",
      "pos": [
        8300,
        8554
      ]
    },
    {
      "content": "This may be invoked multiple times whenever the network topology changes (due to service healing for example).",
      "pos": [
        8555,
        8665
      ]
    },
    {
      "content": "A sample file is provided in the Appendix.",
      "pos": [
        8666,
        8708
      ]
    },
    {
      "content": "The current location of this file is /var/lib/waagent/SharedConfig.xml.",
      "pos": [
        8709,
        8780
      ]
    },
    {
      "content": "Provisioning.Enabled:",
      "pos": [
        8784,
        8805
      ]
    },
    {
      "content": "Type: Boolean",
      "pos": [
        8809,
        8822
      ]
    },
    {
      "content": "Default: y",
      "pos": [
        8825,
        8835
      ]
    },
    {
      "content": "This allows the user to enable or disable the provisioning functionality in the agent.",
      "pos": [
        8837,
        8923
      ]
    },
    {
      "content": "Valid values are \"y\" or \"n\".",
      "pos": [
        8924,
        8952
      ]
    },
    {
      "content": "If provisioning is disabled, SSH host and user keys in the image are preserved and any configuration specified in the Azure provisioning API is ignored.",
      "pos": [
        8953,
        9105
      ]
    },
    {
      "pos": [
        9107,
        9208
      ],
      "content": "<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> this parameter defaults to \"n\" on Ubuntu Cloud Images that use cloud-init for provisioning."
    },
    {
      "content": "Provisioning.DeleteRootPassword:",
      "pos": [
        9212,
        9244
      ]
    },
    {
      "content": "Type: Boolean",
      "pos": [
        9248,
        9261
      ]
    },
    {
      "content": "Default: n",
      "pos": [
        9264,
        9274
      ]
    },
    {
      "content": "If set, the root password in the /etc/shadow file is erased during the provisioning process.",
      "pos": [
        9276,
        9368
      ]
    },
    {
      "content": "Provisioning.RegenerateSshHostKeyPair:",
      "pos": [
        9372,
        9410
      ]
    },
    {
      "content": "Type: Boolean",
      "pos": [
        9414,
        9427
      ]
    },
    {
      "content": "Default: y",
      "pos": [
        9430,
        9440
      ]
    },
    {
      "content": "If set, all SSH host key pairs (ecdsa, dsa and rsa) are deleted during the provisioning process from /etc/ssh/.",
      "pos": [
        9442,
        9553
      ]
    },
    {
      "content": "And a single fresh key pair is generated.",
      "pos": [
        9554,
        9595
      ]
    },
    {
      "content": "The encryption type for the fresh key pair is configurable by the Provisioning.SshHostKeyPairType entry.",
      "pos": [
        9597,
        9701
      ]
    },
    {
      "content": "Please note that some distributions will re-create SSH key pairs for any missing encryption types when the SSH daemon is restarted (for example, upon a reboot).",
      "pos": [
        9702,
        9862
      ]
    },
    {
      "content": "Provisioning.SshHostKeyPairType:",
      "pos": [
        9866,
        9898
      ]
    },
    {
      "content": "Type: String",
      "pos": [
        9902,
        9914
      ]
    },
    {
      "content": "Default: rsa",
      "pos": [
        9917,
        9929
      ]
    },
    {
      "content": "This can be set to an encryption algorithm type that is supported by the SSH daemon on the virtual machine.",
      "pos": [
        9931,
        10038
      ]
    },
    {
      "content": "The typically supported values are \"rsa\", \"dsa\" and \"ecdsa\".",
      "pos": [
        10039,
        10099
      ]
    },
    {
      "content": "Note that \"putty.exe\" on Windows does not support \"ecdsa\".",
      "pos": [
        10100,
        10158
      ]
    },
    {
      "content": "So, if you intend to use putty.exe on Windows to connect to a Linux deployment, please use \"rsa\" or \"dsa\".",
      "pos": [
        10159,
        10265
      ]
    },
    {
      "content": "Provisioning.MonitorHostName:",
      "pos": [
        10269,
        10298
      ]
    },
    {
      "content": "Type: Boolean",
      "pos": [
        10302,
        10315
      ]
    },
    {
      "content": "Default: y",
      "pos": [
        10318,
        10328
      ]
    },
    {
      "content": "If set, waagent will monitor the Linux virtual machine for hostname changes (as returned by the \"hostname\" command) and automatically update the networking configuration in the image to reflect the change.",
      "pos": [
        10330,
        10535
      ]
    },
    {
      "content": "In order to push the name change to the DNS servers, networking will be restarted in the virtual machine.",
      "pos": [
        10536,
        10641
      ]
    },
    {
      "content": "This will result in brief loss of Internet connectivity.",
      "pos": [
        10642,
        10698
      ]
    },
    {
      "content": "ResourceDisk.Format:",
      "pos": [
        10702,
        10722
      ]
    },
    {
      "content": "Type: Boolean",
      "pos": [
        10726,
        10739
      ]
    },
    {
      "content": "Default: y",
      "pos": [
        10742,
        10752
      ]
    },
    {
      "content": "If set, the resource disk provided by the platform will be formatted and mounted by waagent if the filesystem type requested by the user in \"ResourceDisk.Filesystem\" is anything other than \"ntfs\".",
      "pos": [
        10754,
        10950
      ]
    },
    {
      "content": "A single partition of type Linux (83) will be made available on the disk.",
      "pos": [
        10951,
        11024
      ]
    },
    {
      "content": "Note that this partition will not be formatted if it can be successfully mounted.",
      "pos": [
        11025,
        11106
      ]
    },
    {
      "content": "ResourceDisk.Filesystem:",
      "pos": [
        11110,
        11134
      ]
    },
    {
      "content": "Type: String",
      "pos": [
        11138,
        11150
      ]
    },
    {
      "content": "Default: ext4",
      "pos": [
        11153,
        11166
      ]
    },
    {
      "content": "This specifies the filesystem type for the resource disk.",
      "pos": [
        11168,
        11225
      ]
    },
    {
      "content": "Supported values vary by Linux distribution.",
      "pos": [
        11226,
        11270
      ]
    },
    {
      "content": "If the string is X, then mkfs.X should be present on the Linux image.",
      "pos": [
        11271,
        11340
      ]
    },
    {
      "content": "SLES 11 images should typically use 'ext3'.",
      "pos": [
        11341,
        11384
      ]
    },
    {
      "content": "FreeBSD images should use 'ufs2' here.",
      "pos": [
        11385,
        11423
      ]
    },
    {
      "content": "ResourceDisk.MountPoint:",
      "pos": [
        11427,
        11451
      ]
    },
    {
      "content": "Type: String",
      "pos": [
        11455,
        11467
      ]
    },
    {
      "content": "Default: /mnt/resource",
      "pos": [
        11470,
        11492
      ]
    },
    {
      "content": "This specifies the path at which the resource disk is mounted.",
      "pos": [
        11495,
        11557
      ]
    },
    {
      "content": "Note that the resource disk is a <bpt id=\"p1\">*</bpt>temporary<ept id=\"p1\">*</ept> disk, and might be emptied when the VM is deprovisioned.",
      "pos": [
        11558,
        11659
      ]
    },
    {
      "content": "ResourceDisk.EnableSwap:",
      "pos": [
        11663,
        11687
      ]
    },
    {
      "content": "Type: Boolean",
      "pos": [
        11691,
        11704
      ]
    },
    {
      "content": "Default: n",
      "pos": [
        11707,
        11717
      ]
    },
    {
      "content": "If set, a swap file (/swapfile) is created on the resource disk and added to the system swap space.",
      "pos": [
        11720,
        11819
      ]
    },
    {
      "content": "ResourceDisk.SwapSizeMB:",
      "pos": [
        11823,
        11847
      ]
    },
    {
      "content": "Type: Integer",
      "pos": [
        11851,
        11864
      ]
    },
    {
      "content": "Default: 0",
      "pos": [
        11867,
        11877
      ]
    },
    {
      "content": "The size of the swap file in megabytes.",
      "pos": [
        11879,
        11918
      ]
    },
    {
      "content": "LBProbeResponder:",
      "pos": [
        11922,
        11939
      ]
    },
    {
      "content": "Type: Boolean",
      "pos": [
        11943,
        11956
      ]
    },
    {
      "content": "Default: y",
      "pos": [
        11959,
        11969
      ]
    },
    {
      "content": "If set, waagent will respond to load balancer probes from the platform (if present).",
      "pos": [
        11971,
        12055
      ]
    },
    {
      "content": "Logs.Verbose:",
      "pos": [
        12059,
        12072
      ]
    },
    {
      "content": "Type: Boolean",
      "pos": [
        12076,
        12089
      ]
    },
    {
      "content": "Default: n",
      "pos": [
        12092,
        12102
      ]
    },
    {
      "content": "If set, log verbosity is boosted.",
      "pos": [
        12104,
        12137
      ]
    },
    {
      "content": "Waagent logs to /var/log/waagent.log and leverages the system logrotate functionality to rotate logs.",
      "pos": [
        12138,
        12239
      ]
    },
    {
      "content": "OS.RootDeviceScsiTimeout:",
      "pos": [
        12243,
        12268
      ]
    },
    {
      "content": "Type: Integer",
      "pos": [
        12272,
        12285
      ]
    },
    {
      "content": "Default: 300",
      "pos": [
        12288,
        12300
      ]
    },
    {
      "content": "This configures the SCSI timeout in seconds on the OS disk and data drives.",
      "pos": [
        12302,
        12377
      ]
    },
    {
      "content": "If not set, the system defaults are used.",
      "pos": [
        12378,
        12419
      ]
    },
    {
      "content": "OS.OpensslPath:",
      "pos": [
        12423,
        12438
      ]
    },
    {
      "content": "Type: String",
      "pos": [
        12442,
        12454
      ]
    },
    {
      "content": "Default: None",
      "pos": [
        12457,
        12470
      ]
    },
    {
      "content": "This can be used to specify an alternate path for the openssl binary to use for cryptographic operations.",
      "pos": [
        12472,
        12577
      ]
    },
    {
      "content": "Ubuntu Cloud Images",
      "pos": [
        12583,
        12602
      ]
    },
    {
      "content": "Note that Ubuntu Cloud Images utilize <bpt id=\"p1\">[</bpt>cloud-init<ept id=\"p1\">](https://launchpad.net/ubuntu/+source/cloud-init)</ept> to perform many configuration tasks that would otherwise be managed by the Azure Linux Agent.",
      "pos": [
        12604,
        12797
      ]
    },
    {
      "content": "Please note the following differences:",
      "pos": [
        12799,
        12837
      ]
    },
    {
      "pos": [
        12842,
        12956
      ],
      "content": "<bpt id=\"p1\">**</bpt>Provisioning.Enabled<ept id=\"p1\">**</ept> defaults to \"n\" on Ubuntu Cloud Images that use cloud-init to perform provisioning tasks."
    },
    {
      "content": "The following configuration parameters have no effect on Ubuntu Cloud Images that use cloud-init to manage the resource disk and swap space:",
      "pos": [
        12960,
        13100
      ]
    },
    {
      "content": "ResourceDisk.Format",
      "pos": [
        13107,
        13126
      ]
    },
    {
      "content": "ResourceDisk.Filesystem",
      "pos": [
        13134,
        13157
      ]
    },
    {
      "content": "ResourceDisk.MountPoint",
      "pos": [
        13165,
        13188
      ]
    },
    {
      "content": "ResourceDisk.EnableSwap",
      "pos": [
        13196,
        13219
      ]
    },
    {
      "content": "ResourceDisk.SwapSizeMB",
      "pos": [
        13227,
        13250
      ]
    },
    {
      "content": "Please see the following resources to configure the resource disk mount point and swap space on Ubuntu Cloud Images during provisioning:",
      "pos": [
        13256,
        13392
      ]
    },
    {
      "content": "Ubuntu Wiki: Configure Swap Partitions",
      "pos": [
        13398,
        13436
      ]
    },
    {
      "content": "Injecting Custom Data into an Azure Virtual Machine",
      "pos": [
        13501,
        13552
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Linux Agent User Guide for Azure\" \n    description=\"Learn how to install and configure Linux Agent (waagent) to manage your virtual machine's interaction with Azure Fabric Controller.\" \n    services=\"virtual-machines\" \n    documentationCenter=\"\" \n    authors=\"szarkos\" \n    manager=\"timlt\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"virtual-machines\" \n    ms.workload=\"infrastructure-services\" \n    ms.tgt_pltfrm=\"vm-linux\" \n    ms.devlang=\"na\" \n    ms.topic=\"article\" \n    ms.date=\"07/30/2015\" \n    ms.author=\"szark\"/>\n\n\n\n#Azure Linux Agent User Guide\n\n##Introduction\n\nThe Azure Linux Agent (/usr/sbin/waagent) manages interaction between a virtual machine and the Azure Fabric Controller. It does the following:\n\n* **Image Provisioning**\n  - Create a user account\n  - Configure SSH authentication types\n  - Deploy SSH public keys and key pairs\n  - Sets the host name\n  - Publishes the host name to the platform DNS\n  - Reports SSH host key fingerprint to the platform\n  - Manages the resource disk\n  - Formats and mounts the resource disk\n  - Configures swap space\n* **Networking**\n  - Manages routes to improve compatibility with platform DHCP servers\n  - Ensures the stability of the network interface name\n* **Kernel**\n  - Configures virtual NUMA\n  - Consumes Hyper-V entropy for /dev/random\n  - Configures SCSI timeouts for the root device (which could be remote)\n* **Diagnostics**\n  - Redirects the console to the serial port\n* **SCVMM Deployments**\n    - Detects and bootstraps the VMM agent for Linux when running in a System Center Virtual Machine Manager 2012 R2 environment\n* **VM Extension**\n    - Inject component authored by Microsoft and Partners into Linux VM (IaaS) to enable software and configuration automation\n    - VM Extension reference implementation on [https://github.com/Azure/azure-linux-extensions](https://github.com/Azure/azure-linux-extensions)\n\n\n##Communication\n\nThe information flow from the platform to the agent occurs via two channels:\n\n* A boot-time attached DVD for IaaS deployments. This DVD includes an OVF-compliant configuration file that includes all provisioning information other than the actual SSH keypairs.\n\n* A TCP endpoint exposing a REST API used to obtain deployment and topology configuration.\n\n###Getting the Linux Agent\nYou can get the Latest Linux Agent directly from:\n\n- [The different Distribution providers endorsing Linux on Azure](http://support.microsoft.com/kb/2805216)\n- or from the [GitHub Open Source Repository for the Azure Linux Agent](https://github.com/Azure/WALinuxAgent)\n\n\n## Requirements\nThe following systems have been tested and are known to work with the Azure Linux Agent. **Please note that this list may differ from the official list of supported systems on the Microsoft Azure Platform**, as described here:\n[http://support.microsoft.com/kb/2805216](http://support.microsoft.com/kb/2805216)\n\n###Supported Linux Distributions\n\n* CoreOS\n* CentOS 6.2+\n* Debian 7.0+\n* Ubuntu 12.04+\n* openSUSE 12.3+\n* SLES 11 SP2+\n* Oracle Linux 6.4+\n\nOther Supported Systems:\n\n* FreeBSD 9+ (Azure Linux Agent v2.0.10+)\n\n\nThe Linux agent depends on some system packages in order to function properly:\n\n* Python 2.6+\n* Openssl 1.0+\n* Openssh 5.3+\n* Filesystem utilities: sfdisk, fdisk, mkfs, parted\n* Password tools: chpasswd, sudo\n* Text processing tools: sed, grep\n* Network tools: ip-route\n\n\n##Installation\n\nInstallation using an RPM or a DEB package from your distribution's package repository is the preferred method of installing and upgrading the Azure Linux Agent.\n\nIf installing manually, the 'waagent' script should be copied to /usr/sbin/waagent and installed by running: \n\n    # sudo chmod 755 /usr/sbin/waagent\n    # sudo /usr/sbin/waagent -install -verbose\n\nThe agent's log file is kept at /var/log/waagent.log.\n\n\n##Command Line Options\n\n###Flags\n\n- verbose: Increase verbosity of specified command\n- force: Skip interactive confirmation for some commands\n\n###Commands\n\n- help: Lists the supported commands and flags.\n\n- install: Manual installation of the agent\n * Checks the system for required dependencies\n\n * Creates the SysV init script (/etc/init.d/waagent), the logrotate configuration file (/etc/logrotate.d/waagent and configures the image to run the init script on boot\n\n * Writes sample configuration file to /etc/waagent.conf\n\n * Any existing configuration file is moved to /etc/waagent.conf.old\n\n * Detects kernel version and applies the VNUMA workaround if necessary\n\n * Moves udev rules that may interfere with networking (/lib/udev/rules.d/75-persistent-net-generator.rules, /etc/udev/rules.d/70-persistent-net.rules) to /var/lib/waagent/  \n\n- uninstall: Remove waagent and associated files\n * Unregisters the init script from the system and deletes it\n\n * Deletes the logrotate configuration and the waagent config file in /etc/waagent.conf\n\n * Restores any moved udev rules that were moved during installation\n\n * Automatic reverting of the VNUMA workaround is not supported, please edit the GRUB configuration files by hand to re-enable NUMA if required.\n\n- deprovision: Attempt to clean the system and make it suitable for re-provisioning. This operation deleted the following:\n * All SSH host keys (if Provisioning.RegenerateSshHostKeyPair is 'y' in the configuration file)\n\n * Nameserver configuration in /etc/resolv.conf\n\n * Root password from /etc/shadow (if Provisioning.DeleteRootPassword is 'y' in the configuration file)\n\n * Cached DHCP client leases\n\n * Resets host name to localhost.localdomain\n\n **Warning:** Deprovision does not guarantee that the image is cleared of all sensitive information and suitable for redistribution.\n\n- deprovision+user: Performs everything under -deprovision (above) and also deletes the last provisioned user account (obtained from /var/lib/waagent) and associated data. This parameter is when de-provisioning an image that was previously provisioning on Azure so it may be captured and re-used.\n\n- version: Displays the version of waagent\n\n- serialconsole: Configures GRUB to mark ttyS0 (the first serial port) as\n   the boot console. This ensures that kernel bootup logs are sent to the\n   serial port and made available for debugging.\n\n- daemon: Run waagent as a daemon to manage interaction with the platform.\n   This argument is specified to waagent in the waagent init script.\n\n##Configuration\n\nA configuration file (/etc/waagent.conf) controls the actions of waagent. \nA sample configuration file is shown below:\n    \n    #\n    # Azure Linux Agent Configuration   \n    #\n    Role.StateConsumer=None \n    Role.ConfigurationConsumer=None \n    Role.TopologyConsumer=None\n    Provisioning.Enabled=y\n    Provisioning.DeleteRootPassword=n\n    Provisioning.RegenerateSshHostKeyPair=y\n    Provisioning.SshHostKeyPairType=rsa\n    Provisioning.MonitorHostName=y\n    ResourceDisk.Format=y\n    ResourceDisk.Filesystem=ext4\n    ResourceDisk.MountPoint=/mnt/resource \n    ResourceDisk.EnableSwap=n \n    ResourceDisk.SwapSizeMB=0\n    LBProbeResponder=y\n    Logs.Verbose=n\n    OS.RootDeviceScsiTimeout=300\n    OS.OpensslPath=None\n\nThe various configuration options are described in detail below. Configuration options are of three types; Boolean, String or Integer. The Boolean configuration options can be specified as \"y\" or \"n\". The special keyword \"None\" may be used for some string type configuration entries as detailed below.\n\n**Role.StateConsumer:**\n\nType: String  \nDefault: None\n\nIf a path to an executable program is specified, it is invoked when waagent has provisioned the image and the \"Ready\" state is about to be reported to the Fabric. The argument specified to the program will be \"Ready\". The agent will not wait for the program to return before continuing.\n\n**Role.ConfigurationConsumer:**\n\nType: String  \nDefault: None\n\nIf a path to an executable program is specified, the program is invoked when the Fabric indicates that a configuration file is available for the virtual machine. The path to the XML configuration file is provided as an argument to the executable. This may be invoked multiple times whenever the configuration file changes. A sample file is provided in the Appendix. The current path of this file is /var/lib/waagent/HostingEnvironmentConfig.xml.\n\n**Role.TopologyConsumer:**\n\nType: String  \nDefault: None\n\nIf a path to an executable program is specified, the program is invoked when the Fabric indicates that a new network topology layout is available for the virtual machine.The path to the XML configuration file is provided as an argument to the executable. This may be invoked multiple times whenever the network topology changes (due to service healing for example). A sample file is provided in the Appendix. The current location of this file is /var/lib/waagent/SharedConfig.xml.\n\n**Provisioning.Enabled:**\n\nType: Boolean  \nDefault: y\n\nThis allows the user to enable or disable the provisioning functionality in the agent. Valid values are \"y\" or \"n\". If provisioning is disabled, SSH host and user keys in the image are preserved and any configuration specified in the Azure provisioning API is ignored.\n\n**Note:** this parameter defaults to \"n\" on Ubuntu Cloud Images that use cloud-init for provisioning.\n\n**Provisioning.DeleteRootPassword:**\n\nType: Boolean  \nDefault: n\n\nIf set, the root password in the /etc/shadow file is erased during the provisioning process.\n\n**Provisioning.RegenerateSshHostKeyPair:**\n\nType: Boolean  \nDefault: y\n\nIf set, all SSH host key pairs (ecdsa, dsa and rsa) are deleted during the provisioning process from /etc/ssh/. And a single fresh key pair is generated.\n\nThe encryption type for the fresh key pair is configurable by the Provisioning.SshHostKeyPairType entry. Please note that some distributions will re-create SSH key pairs for any missing encryption types when the SSH daemon is restarted (for example, upon a reboot).\n\n**Provisioning.SshHostKeyPairType:**\n\nType: String  \nDefault: rsa\n\nThis can be set to an encryption algorithm type that is supported by the SSH daemon on the virtual machine. The typically supported values are \"rsa\", \"dsa\" and \"ecdsa\". Note that \"putty.exe\" on Windows does not support \"ecdsa\". So, if you intend to use putty.exe on Windows to connect to a Linux deployment, please use \"rsa\" or \"dsa\".\n\n**Provisioning.MonitorHostName:**\n\nType: Boolean  \nDefault: y\n\nIf set, waagent will monitor the Linux virtual machine for hostname changes (as returned by the \"hostname\" command) and automatically update the networking configuration in the image to reflect the change. In order to push the name change to the DNS servers, networking will be restarted in the virtual machine. This will result in brief loss of Internet connectivity.\n\n**ResourceDisk.Format:**\n\nType: Boolean  \nDefault: y\n\nIf set, the resource disk provided by the platform will be formatted and mounted by waagent if the filesystem type requested by the user in \"ResourceDisk.Filesystem\" is anything other than \"ntfs\". A single partition of type Linux (83) will be made available on the disk. Note that this partition will not be formatted if it can be successfully mounted.\n\n**ResourceDisk.Filesystem:**\n\nType: String  \nDefault: ext4\n\nThis specifies the filesystem type for the resource disk. Supported values vary by Linux distribution. If the string is X, then mkfs.X should be present on the Linux image. SLES 11 images should typically use 'ext3'. FreeBSD images should use 'ufs2' here.\n\n**ResourceDisk.MountPoint:**\n\nType: String  \nDefault: /mnt/resource \n\nThis specifies the path at which the resource disk is mounted. Note that the resource disk is a *temporary* disk, and might be emptied when the VM is deprovisioned.\n\n**ResourceDisk.EnableSwap:**\n\nType: Boolean  \nDefault: n \n\nIf set, a swap file (/swapfile) is created on the resource disk and added to the system swap space.\n\n**ResourceDisk.SwapSizeMB:**\n\nType: Integer  \nDefault: 0\n\nThe size of the swap file in megabytes.\n\n**LBProbeResponder:**\n\nType: Boolean  \nDefault: y\n\nIf set, waagent will respond to load balancer probes from the platform (if present).\n\n**Logs.Verbose:**\n\nType: Boolean  \nDefault: n\n\nIf set, log verbosity is boosted. Waagent logs to /var/log/waagent.log and leverages the system logrotate functionality to rotate logs.\n\n**OS.RootDeviceScsiTimeout:**\n\nType: Integer  \nDefault: 300\n\nThis configures the SCSI timeout in seconds on the OS disk and data drives. If not set, the system defaults are used.\n\n**OS.OpensslPath:**\n\nType: String  \nDefault: None\n\nThis can be used to specify an alternate path for the openssl binary to use for cryptographic operations.\n\n\n\n##Ubuntu Cloud Images\n\nNote that Ubuntu Cloud Images utilize [cloud-init](https://launchpad.net/ubuntu/+source/cloud-init) to perform many configuration tasks that would otherwise be managed by the Azure Linux Agent.  Please note the following differences:\n\n\n- **Provisioning.Enabled** defaults to \"n\" on Ubuntu Cloud Images that use cloud-init to perform provisioning tasks.\n\n- The following configuration parameters have no effect on Ubuntu Cloud Images that use cloud-init to manage the resource disk and swap space:\n\n - **ResourceDisk.Format**\n - **ResourceDisk.Filesystem**\n - **ResourceDisk.MountPoint**\n - **ResourceDisk.EnableSwap**\n - **ResourceDisk.SwapSizeMB**\n\n- Please see the following resources to configure the resource disk mount point and swap space on Ubuntu Cloud Images during provisioning:\n\n - [Ubuntu Wiki: Configure Swap Partitions](http://go.microsoft.com/fwlink/?LinkID=532955&clcid=0x409)\n - [Injecting Custom Data into an Azure Virtual Machine](virtual-machines-how-to-inject-custom-data.md)\n\n "
}