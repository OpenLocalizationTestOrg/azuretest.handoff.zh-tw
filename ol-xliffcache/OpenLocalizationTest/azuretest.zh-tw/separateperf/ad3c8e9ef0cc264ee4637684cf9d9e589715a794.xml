{
  "nodes": [
    {
      "content": "DPM Protection of SharePoint farm to Azure | Microsoft Azure",
      "pos": [
        27,
        87
      ]
    },
    {
      "content": "This article provides an overview of DPM Protection of SharePoint farm to Azure",
      "pos": [
        106,
        185
      ]
    },
    {
      "content": "Backing up a SharePoint farm to Azure",
      "pos": [
        506,
        543
      ]
    },
    {
      "content": "You back up a SharePoint farm to Azure using System Center Data Protection Manager (DPM) in much the same way you back up other data sources.",
      "pos": [
        544,
        685
      ]
    },
    {
      "content": "Azure provides  flexibility in the backup schedule to create daily, weekly, monthly or yearly backup points and gives you varying retention policy options for various backup points.",
      "pos": [
        686,
        867
      ]
    },
    {
      "content": "DPM provides you capability to store local disk copies for quicker recovery time objectives (RTO) and to Azure for a cost effective long term retention target.",
      "pos": [
        868,
        1027
      ]
    },
    {
      "content": "SharePoint supported versions and related protection scenarios",
      "pos": [
        1032,
        1094
      ]
    },
    {
      "content": "Azure Backup for DPM supports the following scenarios.",
      "pos": [
        1095,
        1149
      ]
    },
    {
      "content": "Workload",
      "pos": [
        1153,
        1161
      ]
    },
    {
      "content": "Version",
      "pos": [
        1164,
        1171
      ]
    },
    {
      "content": "SharePoint deployment",
      "pos": [
        1174,
        1195
      ]
    },
    {
      "content": "DPM deployment type",
      "pos": [
        1198,
        1217
      ]
    },
    {
      "content": "DPM - System Center 2012 R2",
      "pos": [
        1220,
        1247
      ]
    },
    {
      "content": "Protection and Recovery",
      "pos": [
        1250,
        1273
      ]
    },
    {
      "content": "SharePoint",
      "pos": [
        1403,
        1413
      ]
    },
    {
      "content": "SharePoint 2013, SharePoint 2010, SharePoint 2007, SharePoint 3.0",
      "pos": [
        1416,
        1481
      ]
    },
    {
      "content": "SharePoint deployed as a physical server or Hyper-V/VmWare virtual machine",
      "pos": [
        1484,
        1558
      ]
    },
    {
      "content": "--------------",
      "pos": [
        1564,
        1578
      ]
    },
    {
      "content": "SQL AlwaysOn",
      "pos": [
        1584,
        1596
      ]
    },
    {
      "content": "Physical server or on-premises Hyper-V Virtual Machine",
      "pos": [
        1599,
        1653
      ]
    },
    {
      "content": "Supports back up to Azure from Update Rollup 5",
      "pos": [
        1656,
        1702
      ]
    },
    {
      "content": "Protect SharePoint Farm Recover: Farm, database, file or list item from disk and recovery farm and database from Azure",
      "pos": [
        1705,
        1823
      ]
    },
    {
      "content": "Before you start",
      "pos": [
        1830,
        1846
      ]
    },
    {
      "content": "There are a few things you need to ensure before backing up a SharePoint farm to Azure.",
      "pos": [
        1847,
        1934
      ]
    },
    {
      "content": "Prerequisites",
      "pos": [
        1940,
        1953
      ]
    },
    {
      "content": "Before you proceed, ensure that all the  <bpt id=\"p1\">[</bpt>prerequisites<ept id=\"p1\">](backup-azure-dpm-introduction.md#prerequisites)</ept> for using Microsoft Azure Backup to protect workloads have been met.",
      "pos": [
        1954,
        2127
      ]
    },
    {
      "content": "The prerequisites cover tasks such as: creating a backup vault, downloading vault credentials, installing the Azure Backup Agent and registering the server with the vault.",
      "pos": [
        2128,
        2299
      ]
    },
    {
      "content": "DPM agent",
      "pos": [
        2305,
        2314
      ]
    },
    {
      "content": "The DPM agent must be installed on the SharePoint server, SQL servers, and any other servers that are part of the SharePoint farm.",
      "pos": [
        2315,
        2445
      ]
    },
    {
      "content": "For more information about setting up the protection agent, see <bpt id=\"p1\">[</bpt>Setup Protection Agent<ept id=\"p1\">](https://technet.microsoft.com/library/hh758039.aspx)</ept>.",
      "pos": [
        2446,
        2588
      ]
    },
    {
      "content": "The only exception is that you only install the agent on a single Web Front End (WFE) server.",
      "pos": [
        2589,
        2682
      ]
    },
    {
      "content": "DPM only needs the agent on one WFE server to serve as the entry point for protection.",
      "pos": [
        2683,
        2769
      ]
    },
    {
      "content": "SharePoint farm",
      "pos": [
        2775,
        2790
      ]
    },
    {
      "content": "For every 10 million items in the farm, there must be at least 2 GB of space on the volume where the DPM folder is located.",
      "pos": [
        2791,
        2914
      ]
    },
    {
      "content": "This space is required for catalog generation.",
      "pos": [
        2915,
        2961
      ]
    },
    {
      "content": "For DPM to recover specific items (site collections, sites, lists, document libraries, folders, individual documents, and list items), catalog generation creates a list of the URLs contained within each content database.",
      "pos": [
        2962,
        3182
      ]
    },
    {
      "content": "You can view the list of URLs in the recoverable item pane in the Recovery task area of DPM Administrator Console.",
      "pos": [
        3183,
        3297
      ]
    },
    {
      "content": "SQL Server",
      "pos": [
        3303,
        3313
      ]
    },
    {
      "content": "DPM runs as a Local System and to back up SQL Server databases it needs sysadmin privileges on that account for the SQL server.",
      "pos": [
        3314,
        3441
      ]
    },
    {
      "content": "Set NT AUTHORITY\\SYSTEM to <bpt id=\"p1\">*</bpt>sysadmin<ept id=\"p1\">*</ept> on the SQL Server you want to back up.",
      "pos": [
        3442,
        3518
      ]
    },
    {
      "content": "In the SharePoint farm, if you have SQL Server databases that are configured with SQL Server aliases, install the SQL Server client components on the front-end Web server that DPM will protect.",
      "pos": [
        3520,
        3713
      ]
    },
    {
      "content": "SharePoint Server",
      "pos": [
        3719,
        3736
      ]
    },
    {
      "content": "While performance depends on many factors such as size of SharePoint farm, as general guidance one DPM Server can be used to protect a 25TB SharePoint farm.",
      "pos": [
        3737,
        3893
      ]
    },
    {
      "content": "DPM Update Rollup 5",
      "pos": [
        3899,
        3918
      ]
    },
    {
      "content": "To begin protection of a SharePoint farm to Azure, you need to install DPM Update Rollup 5 or higher.",
      "pos": [
        3919,
        4020
      ]
    },
    {
      "content": "Update Rollup 5 provides the ability to protect a SharePoint farm (configured using SQL AlwaysOn) to Azure.",
      "pos": [
        4021,
        4128
      ]
    },
    {
      "content": "For more information see <bpt id=\"p1\">[</bpt>installing DPM Update Rollup 5<ept id=\"p1\">]( http://blogs.technet.com/b/dpm/archive/2015/02/11/update-rollup-5-for-system-center-2012-r2-data-protection-manager-is-now-available.aspx)</ept>",
      "pos": [
        4129,
        4326
      ]
    },
    {
      "content": "What's not supported",
      "pos": [
        4332,
        4352
      ]
    },
    {
      "content": "Protecting a SharePoint farm does not protect search indexes or application service databases.",
      "pos": [
        4356,
        4450
      ]
    },
    {
      "content": "You will need to configure the protection of these databases separately.",
      "pos": [
        4451,
        4523
      ]
    },
    {
      "content": "DPM does not provide backup of SharePoint SQL databases hosted on Scale out file server (SOFS) shares.",
      "pos": [
        4527,
        4629
      ]
    },
    {
      "content": "Configure SharePoint Protection",
      "pos": [
        4634,
        4665
      ]
    },
    {
      "pos": [
        4666,
        4818
      ],
      "content": "You must configure the SharePoint VSS Writer service (WSS Writer service) using <bpt id=\"p1\">**</bpt>ConfigureSharePoint.exe<ept id=\"p1\">**</ept> before you can protect SharePoint using DPM."
    },
    {
      "content": "You can find <bpt id=\"p1\">**</bpt>ConfigureSharePoint.exe<ept id=\"p1\">**</ept> in the [DPM Installation Path]\\bin folder on the front-end Web server.",
      "pos": [
        4820,
        4931
      ]
    },
    {
      "content": "This tool provides the protection agent with the credentials for the SharePoint farm.",
      "pos": [
        4932,
        5017
      ]
    },
    {
      "content": "You run it on a single WFE server.",
      "pos": [
        5018,
        5052
      ]
    },
    {
      "content": "If you have multiple WFE servers select just one when you configure a protection group.",
      "pos": [
        5053,
        5140
      ]
    },
    {
      "content": "To configure the SharePoint VSS Writer service",
      "pos": [
        5146,
        5192
      ]
    },
    {
      "content": "On the WFE server, at a command prompt, go to [DPM installation location]\\bin\\",
      "pos": [
        5196,
        5274
      ]
    },
    {
      "content": "Run ConfigureSharePoint -EnableSharePointProtection",
      "pos": [
        5278,
        5329
      ]
    },
    {
      "content": "Enter the farm administrator credentials.",
      "pos": [
        5333,
        5374
      ]
    },
    {
      "content": "This account should be a member of the local Administrator group on the WFE server.",
      "pos": [
        5375,
        5458
      ]
    },
    {
      "content": "If the farm administrator isn’t a local admin grant the following permissions on the WFE server:",
      "pos": [
        5459,
        5555
      ]
    },
    {
      "content": "Grant the WSS_Admin_WPG group full control to the DPM folder (%Program Files%\\Microsoft Data Protection Manager\\DPM).",
      "pos": [
        5560,
        5677
      ]
    },
    {
      "content": "Grant the WSS_Admin_WPG group read access to the DPM Registry key (HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Microsoft Data Protection Manager).",
      "pos": [
        5682,
        5822
      ]
    },
    {
      "pos": [
        5825,
        5958
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You’ll need to rerun ConfigureSharePoint.exe whenever there’s a change in the SharePoint farm administrator credentials."
    },
    {
      "content": "Back up a SharePoint farm using DPM",
      "pos": [
        5963,
        5998
      ]
    },
    {
      "content": "Once you have configured DPM and the SharePoint farm as explained above, SharePoint can be protected by DPM.",
      "pos": [
        5999,
        6107
      ]
    },
    {
      "content": "To protect a SharePoint farm",
      "pos": [
        6113,
        6141
      ]
    },
    {
      "pos": [
        6145,
        6314
      ],
      "content": "From the **Protection** tab of the DPM Administrator Console, click **New**.\n ![New Protection Tab](./media/backup-azure-backup-sharepoint/dpm-new-protection-tab.png)",
      "leadings": [
        "",
        "   "
      ],
      "nodes": [
        {
          "content": "From the <bpt id=\"p1\">**</bpt>Protection<ept id=\"p1\">**</ept> tab of the DPM Administrator Console, click <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept>.",
          "pos": [
            0,
            76
          ]
        },
        {
          "content": "<ph id=\"ph1\"> ![</ph>New Protection Tab<ph id=\"ph2\">](./media/backup-azure-backup-sharepoint/dpm-new-protection-tab.png)</ph>",
          "pos": [
            77,
            166
          ]
        }
      ]
    },
    {
      "pos": [
        6319,
        6451
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Select Protection Group Type<ept id=\"p1\">**</ept> screen of the <bpt id=\"p2\">**</bpt>Create New Protection Group<ept id=\"p2\">**</ept> wizard, select <bpt id=\"p3\">**</bpt>Servers<ept id=\"p3\">**</ept> and click <bpt id=\"p4\">**</bpt>Next<ept id=\"p4\">**</ept>."
    },
    {
      "content": "Select Protection Group type",
      "pos": [
        6459,
        6487
      ]
    },
    {
      "pos": [
        6566,
        6691
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Select Group Members<ept id=\"p1\">**</ept> screen, select the check box for the SharePoint server you want to protect and click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>"
    },
    {
      "content": "Select group members",
      "pos": [
        6699,
        6719
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> With the DPM agent installed, you can see the server in the wizard.",
      "pos": [
        6793,
        6873
      ]
    },
    {
      "content": "DPM also shows its structure.",
      "pos": [
        6874,
        6903
      ]
    },
    {
      "content": "Because ConfigureSharePoint.exe was run, DPM communicates with the SharePoint VSS Writer and its corresponding SQL databases and recognizes the SharePoint farm structure (the associated content databases and any corresponding items).",
      "pos": [
        6904,
        7137
      ]
    },
    {
      "content": "On the <bpt id=\"p1\">**</bpt>Select Data Protection Method<ept id=\"p1\">**</ept> screen, enter the name of the <bpt id=\"p2\">*</bpt>Protection Group<ept id=\"p2\">*</ept> and select your preferred <bpt id=\"p3\">*</bpt>protection methods<ept id=\"p3\">*</ept>.",
      "pos": [
        7142,
        7279
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        7280,
        7295
      ]
    },
    {
      "content": "Select data protection method",
      "pos": [
        7303,
        7332
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Choosing disk protection helps to meet recovery time objectives with short recovery times.",
      "pos": [
        7415,
        7518
      ]
    },
    {
      "content": "Azure is a cost effective long-term protection target compared to tapes.",
      "pos": [
        7519,
        7591
      ]
    },
    {
      "content": "For more information see this <bpt id=\"p1\">[</bpt>article<ept id=\"p1\">](https://azure.microsoft.com/documentation/articles/backup-azure-backup-cloud-as-tape/)</ept>",
      "pos": [
        7592,
        7718
      ]
    },
    {
      "pos": [
        7723,
        7851
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Specify Short-Term Goals<ept id=\"p1\">**</ept> screen, select your preferred <bpt id=\"p2\">*</bpt>retention range<ept id=\"p2\">*</ept> and identify when you want backups to occur."
    },
    {
      "content": "Specify short-term goals",
      "pos": [
        7859,
        7883
      ]
    },
    {
      "pos": [
        7961,
        8176
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Since recovery is most often required for data less than five days old, we selected a retention range of 5 days on disk and ensured that the backup happens during non-production hours, for this example."
    },
    {
      "pos": [
        8181,
        8270
      ],
      "content": "Review the storage pool disk space allocated for the protection group and click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "content": "For every protection group, DPM allocates disk space to store and manage replicas.",
      "pos": [
        8275,
        8357
      ]
    },
    {
      "content": "At this point, DPM must create a copy of the selected data.",
      "pos": [
        8358,
        8417
      ]
    },
    {
      "content": "Select how and when you want the replica created and click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        8418,
        8486
      ]
    },
    {
      "content": "Choose replica creation method",
      "pos": [
        8494,
        8524
      ]
    },
    {
      "pos": [
        8607,
        8702
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> To ensure network traffic is not effected, select a time outside production hours."
    },
    {
      "content": "DPM ensures data integrity by performing consistency checks on the replica.",
      "pos": [
        8707,
        8782
      ]
    },
    {
      "content": "There are two available options.",
      "pos": [
        8783,
        8815
      ]
    },
    {
      "content": "You can define a schedule for running consistency checks, or allow DPM to run consistency checks automatically on the replica whenever it becomes inconsistent.",
      "pos": [
        8816,
        8975
      ]
    },
    {
      "content": "Select your preferred option and click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        8976,
        9024
      ]
    },
    {
      "content": "Consistency Check",
      "pos": [
        9032,
        9049
      ]
    },
    {
      "pos": [
        9117,
        9233
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Specify Online Protection Data<ept id=\"p1\">**</ept> screen, select the SharePoint farm you want to protect and click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."
    },
    {
      "content": "DPM SharePoint Protection1",
      "pos": [
        9241,
        9267
      ]
    },
    {
      "pos": [
        9344,
        9444
      ],
      "content": "On the <bpt id=\"p1\">**</bpt>Specify Online Backup Schedule<ept id=\"p1\">**</ept> screen, select your preferred schedule and click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Online_backup_schedule",
      "pos": [
        9452,
        9474
      ]
    },
    {
      "pos": [
        9557,
        9625
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> DPM allows 2 daily backups at different times to Azure."
    },
    {
      "pos": [
        9631,
        9810
      ],
      "content": "Depending on the backup schedule you selected, on the <bpt id=\"p1\">**</bpt>Specify Online Retention Policy<ept id=\"p1\">**</ept> screen, select the retention policy for daily, weekly, monthly, and yearly backup points."
    },
    {
      "content": "Online_retention_policy",
      "pos": [
        9818,
        9841
      ]
    },
    {
      "pos": [
        9918,
        10062
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> DPM uses a Grandfather-father-son retention scheme in which a different retention policy can be chosen for different backup points."
    },
    {
      "content": "Similar to disk, an initial reference point replica needs to be created in Azure.",
      "pos": [
        10068,
        10149
      ]
    },
    {
      "content": "Select your preferred option for creating the initial backup copy to Azure and click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        10150,
        10244
      ]
    },
    {
      "content": "Online_replica",
      "pos": [
        10252,
        10266
      ]
    },
    {
      "content": "Review your selected settings on the <bpt id=\"p1\">**</bpt>Summary<ept id=\"p1\">**</ept> page and click <bpt id=\"p2\">**</bpt>Create Group<ept id=\"p2\">**</ept>.",
      "pos": [
        10336,
        10417
      ]
    },
    {
      "content": "You will see a success message once the protection group has been created.",
      "pos": [
        10418,
        10492
      ]
    },
    {
      "content": "Summary",
      "pos": [
        10500,
        10507
      ]
    },
    {
      "content": "Restore a SharePoint item from disk using DPM",
      "pos": [
        10565,
        10610
      ]
    },
    {
      "content": "In the example below, the <bpt id=\"p1\">*</bpt>Recovering SharePoint item<ept id=\"p1\">*</ept> has been accidentally deleted and needs to be recovered.",
      "pos": [
        10611,
        10722
      ]
    },
    {
      "content": "<ph id=\"ph1\">![</ph>DPM SharePoint Protection4<ph id=\"ph2\">](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection5.png)</ph>",
      "pos": [
        10723,
        10823
      ]
    },
    {
      "content": "Open the <bpt id=\"p1\">**</bpt>DPM Administrator Console<ept id=\"p1\">**</ept>.",
      "pos": [
        10828,
        10867
      ]
    },
    {
      "content": "All SharePoint farms protected by DPM are shown in the Protection tab.",
      "pos": [
        10868,
        10938
      ]
    },
    {
      "content": "DPM SharePoint Protection3",
      "pos": [
        10946,
        10972
      ]
    },
    {
      "pos": [
        11049,
        11107
      ],
      "content": "To begin recovering the item, select the <bpt id=\"p1\">**</bpt>Recovery<ept id=\"p1\">**</ept> tab."
    },
    {
      "content": "DPM SharePoint Protection5",
      "pos": [
        11115,
        11141
      ]
    },
    {
      "pos": [
        11218,
        11342
      ],
      "content": "You can search SharePoint for the <bpt id=\"p1\">*</bpt>Recovering SharePoint item<ept id=\"p1\">*</ept> using a wild card based search within a recovery point range."
    },
    {
      "content": "DPM SharePoint Protection6",
      "pos": [
        11350,
        11376
      ]
    },
    {
      "pos": [
        11453,
        11551
      ],
      "content": "Select the appropriate recovery point from the search results, right click, and select <bpt id=\"p1\">**</bpt>Recover<ept id=\"p1\">**</ept>"
    },
    {
      "content": "You can also navigate through various recovery points and select a database or item to recover.",
      "pos": [
        11556,
        11651
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>date &gt; Recovery time<ept id=\"p1\">**</ept> then select the correct <bpt id=\"p2\">**</bpt>database &gt; SharePoint farm &gt; recovery point &gt; item<ept id=\"p2\">**</ept>.",
      "pos": [
        11652,
        11763
      ]
    },
    {
      "content": "DPM SharePoint Protection7",
      "pos": [
        11771,
        11797
      ]
    },
    {
      "content": "Right click the item and select <bpt id=\"p1\">**</bpt>Recover<ept id=\"p1\">**</ept> to open the <bpt id=\"p2\">**</bpt>Recovery Wizard<ept id=\"p2\">**</ept>.",
      "pos": [
        11874,
        11950
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        11951,
        11966
      ]
    },
    {
      "content": "Review Recovery Selection",
      "pos": [
        11974,
        11999
      ]
    },
    {
      "pos": [
        12075,
        12142
      ],
      "content": "Select the type of recovery you want to perform and click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Recovery Type",
      "pos": [
        12150,
        12163
      ]
    },
    {
      "pos": [
        12236,
        12311
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Example above shows recovery item to original SharePoint site."
    },
    {
      "pos": [
        12316,
        12364
      ],
      "content": "Select the <bpt id=\"p1\">**</bpt>Recovery Process<ept id=\"p1\">**</ept> you want to use."
    },
    {
      "pos": [
        12371,
        12521
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Recover witahout using a recovery farm<ept id=\"p1\">**</ept> if the SharePoint farm has not changed and is the same as the recovery point that is being restored."
    },
    {
      "pos": [
        12528,
        12641
      ],
      "content": "Select <bpt id=\"p1\">**</bpt>Recover using a recovery farm<ept id=\"p1\">**</ept> if the SharePoint farm has changed since the recovery point was created."
    },
    {
      "content": "Recovery Process",
      "pos": [
        12649,
        12665
      ]
    },
    {
      "content": "Provide a staging SQL instance location for recovering the database temporarily, and provide a staging file share on the DPM Server and SharePoint server to recover the item.",
      "pos": [
        12732,
        12906
      ]
    },
    {
      "content": "Staging Location1",
      "pos": [
        12914,
        12931
      ]
    },
    {
      "content": "DPM attaches the content database, which is hosting the SharePoint item, to the temporary SQL Instance.",
      "pos": [
        13000,
        13103
      ]
    },
    {
      "content": "From the content database the DPM Server recovers the item and puts it on the staging file location on the DPM server.",
      "pos": [
        13104,
        13222
      ]
    },
    {
      "content": "The item recovered on the staging location, on the DPM server, now needs to be exported to the staging location on the SharePoint farm.",
      "pos": [
        13223,
        13358
      ]
    },
    {
      "content": "Staging Location2",
      "pos": [
        13366,
        13383
      ]
    },
    {
      "content": "Select <bpt id=\"p1\">**</bpt>Specify recovery options<ept id=\"p1\">**</ept> and apply security settings to the SharePoint farm or apply the security settings of the recovery point.",
      "pos": [
        13452,
        13592
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.",
      "pos": [
        13593,
        13608
      ]
    },
    {
      "content": "Recovery Options",
      "pos": [
        13616,
        13632
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> You can choose to throttle the network bandwidth usage.",
      "pos": [
        13701,
        13769
      ]
    },
    {
      "content": "This minimizes impact to the production server during production hours.",
      "pos": [
        13770,
        13841
      ]
    },
    {
      "pos": [
        13847,
        13930
      ],
      "content": "Review the summary information and click <bpt id=\"p1\">**</bpt>Recover<ept id=\"p1\">**</ept> to begin recovery of the file."
    },
    {
      "content": "Recovery summary",
      "pos": [
        13938,
        13954
      ]
    },
    {
      "pos": [
        14022,
        14130
      ],
      "content": "Now select the <bpt id=\"p1\">**</bpt>Monitoring<ept id=\"p1\">**</ept> tab in the <bpt id=\"p2\">**</bpt>DPM Administrator Console<ept id=\"p2\">**</ept> to view the <bpt id=\"p3\">*</bpt>Status<ept id=\"p3\">*</ept> of the recovery."
    },
    {
      "content": "Recovery Status",
      "pos": [
        14138,
        14153
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> The file is now restored.",
      "pos": [
        14225,
        14263
      ]
    },
    {
      "content": "You can refresh the SharePoint site to check the restored file.",
      "pos": [
        14264,
        14327
      ]
    },
    {
      "content": "Restore a SharePoint database from Azure using DPM",
      "pos": [
        14332,
        14382
      ]
    },
    {
      "content": "To recover a SharePoint content database, navigate through various recovery points (as shown above) and select the recovery point to you want to recover.",
      "pos": [
        14387,
        14540
      ]
    },
    {
      "content": "DPM SharePoint Protection8",
      "pos": [
        14548,
        14574
      ]
    },
    {
      "content": "Double-click the SharePoint recovery point to show the available SharePoint catalog information.",
      "pos": [
        14651,
        14747
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Since the SharePoint farm is protected for long term retention in Azure, no catalog information (meta data) is available on the DPM Server.",
      "pos": [
        14755,
        14907
      ]
    },
    {
      "content": "As a result, whenever a point-in-time SharePoint content database needs to be recovered you need to re-catalog the SharePoint farm.",
      "pos": [
        14908,
        15039
      ]
    },
    {
      "pos": [
        15044,
        15065
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Re-catalog<ept id=\"p1\">**</ept>."
    },
    {
      "content": "DPM SharePoint Protection10",
      "pos": [
        15073,
        15100
      ]
    },
    {
      "pos": [
        15179,
        15225
      ],
      "content": "The <bpt id=\"p1\">**</bpt>Cloud Recatalog<ept id=\"p1\">**</ept> status window appears."
    },
    {
      "content": "DPM SharePoint Protection11",
      "pos": [
        15233,
        15260
      ]
    },
    {
      "content": "Once cataloging is complete, the status changes to <bpt id=\"p1\">*</bpt>Success<ept id=\"p1\">*</ept>.",
      "pos": [
        15339,
        15400
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept>.",
      "pos": [
        15401,
        15417
      ]
    },
    {
      "content": "DPM SharePoint Protection12",
      "pos": [
        15425,
        15452
      ]
    },
    {
      "content": "Click the SharePoint object shown in DPM <bpt id=\"p1\">**</bpt>Recovery<ept id=\"p1\">**</ept> tab to get the content database structure.",
      "pos": [
        15530,
        15626
      ]
    },
    {
      "content": "Right click &gt; <bpt id=\"p1\">**</bpt>Recover<ept id=\"p1\">**</ept>.",
      "pos": [
        15627,
        15653
      ]
    },
    {
      "content": "DPM SharePoint Protection13",
      "pos": [
        15661,
        15688
      ]
    },
    {
      "pos": [
        15766,
        15918
      ],
      "content": "At this point, follow the <bpt id=\"p1\">[</bpt>recovery steps above<ept id=\"p1\">](#restore-a-sharepoint-item-from-disk-using-dpm)</ept> for recovering a Sharepoint content database from disk."
    },
    {
      "content": "FAQs",
      "pos": [
        15923,
        15927
      ]
    },
    {
      "content": "Q: Which versions of DPM support SQL 2014 and SQL 2012 (SP2)",
      "pos": [
        15928,
        15988
      ]
    },
    {
      "content": "A: DPM 2012 R2 with Update Rollup 4 supports the same",
      "pos": [
        15993,
        16046
      ]
    },
    {
      "content": "Q: Can I recover SharePoint item to the original location if SharePoint is configured using SQL AlwaysOn (with protection on disk)?",
      "pos": [
        16048,
        16179
      ]
    },
    {
      "content": "A: Yes the item can be recovered to the original SharePoint site",
      "pos": [
        16184,
        16248
      ]
    },
    {
      "content": "Q: Can I recover a SharePoint database to the original location if SharePoint is configured using SQL AlwaysOn?",
      "pos": [
        16250,
        16361
      ]
    },
    {
      "content": "A: Since SharePoint databases are configured in SQL AlwaysOn, they cannot be modified unless the availability group (AG) is removed.",
      "pos": [
        16366,
        16498
      ]
    },
    {
      "content": "As a result DPM cannot restore database to original location.",
      "pos": [
        16499,
        16560
      ]
    },
    {
      "content": "You can recovery SQL database to another SQL instance.",
      "pos": [
        16561,
        16615
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        16620,
        16630
      ]
    },
    {
      "pos": [
        16633,
        16868
      ],
      "content": "Learn more about DPM Protection of SharePoint - see <bpt id=\"p1\">[</bpt>Video Series - DPM Protection of SharePoint<ept id=\"p1\">](http://channel9.msdn.com/Series/Azure-Backup/Microsoft-SCDPM-Protection-of-SharePoint-1-of-2-How-to-create-a-SharePoint-Protection-Group)</ept>"
    },
    {
      "pos": [
        16871,
        16995
      ],
      "content": "Review <bpt id=\"p1\">[</bpt>Release Notes for System Center 2012 - Data Protection Manager<ept id=\"p1\">](https://technet.microsoft.com/library/jj860415.aspx)</ept>"
    },
    {
      "pos": [
        16998,
        17127
      ],
      "content": "Review <bpt id=\"p1\">[</bpt>Release Notes for Data Protection Manager in System Center 2012 SP1<ept id=\"p1\">](https://technet.microsoft.com/library/jj860394.aspx)</ept>"
    },
    {
      "content": "test",
      "pos": [
        17129,
        17133
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"DPM Protection of SharePoint farm to Azure | Microsoft Azure\"\n    description=\"This article provides an overview of DPM Protection of SharePoint farm to Azure\"\n    services=\"backup\"\n    documentationCenter=\"\"\n    authors=\"SamirMehta\"\n    manager=\"shreeshd\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"backup\"\n    ms.workload=\"storage-backup-recovery\"\n    ms.tgt_pltfrm=\"na\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"07/14/2015\"\n    ms.author=\"sammehta\"; \"jimpark\"/>\n\n\n# Backing up a SharePoint farm to Azure\nYou back up a SharePoint farm to Azure using System Center Data Protection Manager (DPM) in much the same way you back up other data sources. Azure provides  flexibility in the backup schedule to create daily, weekly, monthly or yearly backup points and gives you varying retention policy options for various backup points. DPM provides you capability to store local disk copies for quicker recovery time objectives (RTO) and to Azure for a cost effective long term retention target.\n\n## SharePoint supported versions and related protection scenarios\nAzure Backup for DPM supports the following scenarios.\n\n| Workload | Version | SharePoint deployment | DPM deployment type | DPM - System Center 2012 R2 | Protection and Recovery |\n| -------- | ------- | --------------------- | ------------------- | --------------------------- | ----------------------- |\n| SharePoint | SharePoint 2013, SharePoint 2010, SharePoint 2007, SharePoint 3.0 | SharePoint deployed as a physical server or Hyper-V/VmWare virtual machine <br> -------------- <br> SQL AlwaysOn | Physical server or on-premises Hyper-V Virtual Machine | Supports back up to Azure from Update Rollup 5 | Protect SharePoint Farm Recover: Farm, database, file or list item from disk and recovery farm and database from Azure |\n\n## Before you start\nThere are a few things you need to ensure before backing up a SharePoint farm to Azure.\n\n### Prerequisites\nBefore you proceed, ensure that all the  [prerequisites](backup-azure-dpm-introduction.md#prerequisites) for using Microsoft Azure Backup to protect workloads have been met. The prerequisites cover tasks such as: creating a backup vault, downloading vault credentials, installing the Azure Backup Agent and registering the server with the vault.\n\n### DPM agent\nThe DPM agent must be installed on the SharePoint server, SQL servers, and any other servers that are part of the SharePoint farm. For more information about setting up the protection agent, see [Setup Protection Agent](https://technet.microsoft.com/library/hh758039.aspx). The only exception is that you only install the agent on a single Web Front End (WFE) server. DPM only needs the agent on one WFE server to serve as the entry point for protection.\n\n### SharePoint farm\nFor every 10 million items in the farm, there must be at least 2 GB of space on the volume where the DPM folder is located. This space is required for catalog generation. For DPM to recover specific items (site collections, sites, lists, document libraries, folders, individual documents, and list items), catalog generation creates a list of the URLs contained within each content database. You can view the list of URLs in the recoverable item pane in the Recovery task area of DPM Administrator Console.\n\n### SQL Server\nDPM runs as a Local System and to back up SQL Server databases it needs sysadmin privileges on that account for the SQL server. Set NT AUTHORITY\\SYSTEM to *sysadmin* on the SQL Server you want to back up.\n\nIn the SharePoint farm, if you have SQL Server databases that are configured with SQL Server aliases, install the SQL Server client components on the front-end Web server that DPM will protect.\n\n### SharePoint Server\nWhile performance depends on many factors such as size of SharePoint farm, as general guidance one DPM Server can be used to protect a 25TB SharePoint farm.\n\n### DPM Update Rollup 5\nTo begin protection of a SharePoint farm to Azure, you need to install DPM Update Rollup 5 or higher. Update Rollup 5 provides the ability to protect a SharePoint farm (configured using SQL AlwaysOn) to Azure.\nFor more information see [installing DPM Update Rollup 5]( http://blogs.technet.com/b/dpm/archive/2015/02/11/update-rollup-5-for-system-center-2012-r2-data-protection-manager-is-now-available.aspx)\n\n### What's not supported\n1. Protecting a SharePoint farm does not protect search indexes or application service databases. You will need to configure the protection of these databases separately.\n2. DPM does not provide backup of SharePoint SQL databases hosted on Scale out file server (SOFS) shares.\n\n## Configure SharePoint Protection\nYou must configure the SharePoint VSS Writer service (WSS Writer service) using **ConfigureSharePoint.exe** before you can protect SharePoint using DPM.\n\nYou can find **ConfigureSharePoint.exe** in the [DPM Installation Path]\\bin folder on the front-end Web server. This tool provides the protection agent with the credentials for the SharePoint farm. You run it on a single WFE server. If you have multiple WFE servers select just one when you configure a protection group.\n\n### To configure the SharePoint VSS Writer service\n1. On the WFE server, at a command prompt, go to [DPM installation location]\\bin\\\n2. Run ConfigureSharePoint -EnableSharePointProtection\n3. Enter the farm administrator credentials. This account should be a member of the local Administrator group on the WFE server. If the farm administrator isn’t a local admin grant the following permissions on the WFE server:\n  - Grant the WSS_Admin_WPG group full control to the DPM folder (%Program Files%\\Microsoft Data Protection Manager\\DPM).\n  - Grant the WSS_Admin_WPG group read access to the DPM Registry key (HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Microsoft Data Protection Manager).\n\n>[AZURE.NOTE] You’ll need to rerun ConfigureSharePoint.exe whenever there’s a change in the SharePoint farm administrator credentials.\n\n## Back up a SharePoint farm using DPM\nOnce you have configured DPM and the SharePoint farm as explained above, SharePoint can be protected by DPM.\n\n### To protect a SharePoint farm\n1. From the **Protection** tab of the DPM Administrator Console, click **New**.\n    ![New Protection Tab](./media/backup-azure-backup-sharepoint/dpm-new-protection-tab.png)\n\n2. On the **Select Protection Group Type** screen of the **Create New Protection Group** wizard, select **Servers** and click **Next**.\n\n    ![Select Protection Group type](./media/backup-azure-backup-sharepoint/select-protection-group-type.png)\n\n3. On the **Select Group Members** screen, select the check box for the SharePoint server you want to protect and click **Next**\n\n    ![Select group members](./media/backup-azure-backup-sharepoint/select-group-members2.png)\n\n    >[AZURE.NOTE] With the DPM agent installed, you can see the server in the wizard. DPM also shows its structure. Because ConfigureSharePoint.exe was run, DPM communicates with the SharePoint VSS Writer and its corresponding SQL databases and recognizes the SharePoint farm structure (the associated content databases and any corresponding items).\n\n4. On the **Select Data Protection Method** screen, enter the name of the *Protection Group* and select your preferred *protection methods*. Click **Next**.\n\n    ![Select data protection method](./media/backup-azure-backup-sharepoint/select-data-protection-method1.png)\n\n    >[AZURE.NOTE] Choosing disk protection helps to meet recovery time objectives with short recovery times. Azure is a cost effective long-term protection target compared to tapes. For more information see this [article](https://azure.microsoft.com/documentation/articles/backup-azure-backup-cloud-as-tape/)\n\n5. On the **Specify Short-Term Goals** screen, select your preferred *retention range* and identify when you want backups to occur.\n\n    ![Specify short-term goals](./media/backup-azure-backup-sharepoint/specify-short-term-goals2.png)\n\n    >[AZURE.NOTE] Since recovery is most often required for data less than five days old, we selected a retention range of 5 days on disk and ensured that the backup happens during non-production hours, for this example.\n\n6. Review the storage pool disk space allocated for the protection group and click **Next**.\n\n7. For every protection group, DPM allocates disk space to store and manage replicas. At this point, DPM must create a copy of the selected data. Select how and when you want the replica created and click **Next**.\n\n    ![Choose replica creation method](./media/backup-azure-backup-sharepoint/choose-replica-creation-method.png)\n\n    >[AZURE.NOTE] To ensure network traffic is not effected, select a time outside production hours.\n\n8. DPM ensures data integrity by performing consistency checks on the replica. There are two available options. You can define a schedule for running consistency checks, or allow DPM to run consistency checks automatically on the replica whenever it becomes inconsistent. Select your preferred option and click **Next**.\n\n    ![Consistency Check](./media/backup-azure-backup-sharepoint/consistency-check.png)\n\n9. On the **Specify Online Protection Data** screen, select the SharePoint farm you want to protect and click **Next**.\n\n    ![DPM SharePoint Protection1](./media/backup-azure-backup-sharepoint/select-online-protection1.png)\n\n10. On the **Specify Online Backup Schedule** screen, select your preferred schedule and click **Next**.\n\n    ![Online_backup_schedule](./media/backup-azure-backup-sharepoint/specify-online-backup-schedule.png)\n\n    >[AZURE.NOTE] DPM allows 2 daily backups at different times to Azure.\n\n11. Depending on the backup schedule you selected, on the **Specify Online Retention Policy** screen, select the retention policy for daily, weekly, monthly, and yearly backup points.\n\n    ![Online_retention_policy](./media/backup-azure-backup-sharepoint/specify-online-retention.png)\n\n    >[AZURE.NOTE] DPM uses a Grandfather-father-son retention scheme in which a different retention policy can be chosen for different backup points.\n\n12. Similar to disk, an initial reference point replica needs to be created in Azure. Select your preferred option for creating the initial backup copy to Azure and click **Next**.\n\n    ![Online_replica](./media/backup-azure-backup-sharepoint/online-replication.png)\n\n13. Review your selected settings on the **Summary** page and click **Create Group**. You will see a success message once the protection group has been created.\n\n    ![Summary](./media/backup-azure-backup-sharepoint/summary.png)\n\n## Restore a SharePoint item from disk using DPM\nIn the example below, the *Recovering SharePoint item* has been accidentally deleted and needs to be recovered.\n![DPM SharePoint Protection4](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection5.png)\n\n1. Open the **DPM Administrator Console**. All SharePoint farms protected by DPM are shown in the Protection tab.\n\n    ![DPM SharePoint Protection3](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection4.png)\n\n2. To begin recovering the item, select the **Recovery** tab.\n\n    ![DPM SharePoint Protection5](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection6.png)\n\n3. You can search SharePoint for the *Recovering SharePoint item* using a wild card based search within a recovery point range.\n\n    ![DPM SharePoint Protection6](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection7.png)\n\n4. Select the appropriate recovery point from the search results, right click, and select **Recover**\n\n5. You can also navigate through various recovery points and select a database or item to recover. Select **date > Recovery time** then select the correct **database > SharePoint farm > recovery point > item**.\n\n    ![DPM SharePoint Protection7](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection8.png)\n\n6. Right click the item and select **Recover** to open the **Recovery Wizard**. Click **Next**.\n\n    ![Review Recovery Selection](./media/backup-azure-backup-sharepoint/review-recovery-selection.png)\n\n7. Select the type of recovery you want to perform and click **Next**.\n\n    ![Recovery Type](./media/backup-azure-backup-sharepoint/select-recovery-type.png)\n\n    >[AZURE.NOTE] Example above shows recovery item to original SharePoint site.\n\n8. Select the **Recovery Process** you want to use.\n    - Select **Recover witahout using a recovery farm** if the SharePoint farm has not changed and is the same as the recovery point that is being restored.\n    - Select **Recover using a recovery farm** if the SharePoint farm has changed since the recovery point was created.\n\n    ![Recovery Process](./media/backup-azure-backup-sharepoint/recovery-process.png)\n\n9. Provide a staging SQL instance location for recovering the database temporarily, and provide a staging file share on the DPM Server and SharePoint server to recover the item.\n\n    ![Staging Location1](./media/backup-azure-backup-sharepoint/staging-location1.png)\n\n    DPM attaches the content database, which is hosting the SharePoint item, to the temporary SQL Instance. From the content database the DPM Server recovers the item and puts it on the staging file location on the DPM server. The item recovered on the staging location, on the DPM server, now needs to be exported to the staging location on the SharePoint farm.\n\n    ![Staging Location2](./media/backup-azure-backup-sharepoint/staging-location2.png)\n\n10. Select **Specify recovery options** and apply security settings to the SharePoint farm or apply the security settings of the recovery point. Click **Next**.\n\n    ![Recovery Options](./media/backup-azure-backup-sharepoint/recovery-options.png)\n\n    >[AZURE.NOTE] You can choose to throttle the network bandwidth usage. This minimizes impact to the production server during production hours.\n\n11. Review the summary information and click **Recover** to begin recovery of the file.\n\n    ![Recovery summary](./media/backup-azure-backup-sharepoint/recovery-summary.png)\n\n12. Now select the **Monitoring** tab in the **DPM Administrator Console** to view the *Status* of the recovery.\n\n    ![Recovery Status](./media/backup-azure-backup-sharepoint/recovery-monitoring.png)\n\n    >[AZURE.NOTE] The file is now restored. You can refresh the SharePoint site to check the restored file.\n\n## Restore a SharePoint database from Azure using DPM\n\n1. To recover a SharePoint content database, navigate through various recovery points (as shown above) and select the recovery point to you want to recover.\n\n    ![DPM SharePoint Protection8](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection9.png)\n\n2. Double-click the SharePoint recovery point to show the available SharePoint catalog information.\n\n    > [AZURE.NOTE] Since the SharePoint farm is protected for long term retention in Azure, no catalog information (meta data) is available on the DPM Server. As a result, whenever a point-in-time SharePoint content database needs to be recovered you need to re-catalog the SharePoint farm.\n\n3. Click **Re-catalog**.\n\n    ![DPM SharePoint Protection10](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection12.png)\n\n    The **Cloud Recatalog** status window appears.\n\n    ![DPM SharePoint Protection11](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection13.png)\n\n    Once cataloging is complete, the status changes to *Success*. Click **Close**.\n\n    ![DPM SharePoint Protection12](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection14.png)\n\n4. Click the SharePoint object shown in DPM **Recovery** tab to get the content database structure. Right click > **Recover**.\n\n    ![DPM SharePoint Protection13](./media/backup-azure-backup-sharepoint/dpm-sharepoint-protection15.png)\n\n5. At this point, follow the [recovery steps above](#restore-a-sharepoint-item-from-disk-using-dpm) for recovering a Sharepoint content database from disk.\n\n## FAQs\nQ: Which versions of DPM support SQL 2014 and SQL 2012 (SP2)<br>\nA: DPM 2012 R2 with Update Rollup 4 supports the same\n\nQ: Can I recover SharePoint item to the original location if SharePoint is configured using SQL AlwaysOn (with protection on disk)?<br>\nA: Yes the item can be recovered to the original SharePoint site\n\nQ: Can I recover a SharePoint database to the original location if SharePoint is configured using SQL AlwaysOn?<br>\nA: Since SharePoint databases are configured in SQL AlwaysOn, they cannot be modified unless the availability group (AG) is removed. As a result DPM cannot restore database to original location. You can recovery SQL database to another SQL instance.\n\n## Next steps\n- Learn more about DPM Protection of SharePoint - see [Video Series - DPM Protection of SharePoint](http://channel9.msdn.com/Series/Azure-Backup/Microsoft-SCDPM-Protection-of-SharePoint-1-of-2-How-to-create-a-SharePoint-Protection-Group)\n- Review [Release Notes for System Center 2012 - Data Protection Manager](https://technet.microsoft.com/library/jj860415.aspx)\n- Review [Release Notes for Data Protection Manager in System Center 2012 SP1](https://technet.microsoft.com/library/jj860394.aspx)\n\ntest\n"
}