{
  "nodes": [
    {
      "content": "Base Configuration Test Environment",
      "pos": [
        27,
        62
      ]
    },
    {
      "content": "Learn how to create a simple dev/test environment that simulates a simplified intranet in Microsoft Azure.",
      "pos": [
        81,
        187
      ]
    },
    {
      "content": "Base Configuration test environment",
      "pos": [
        560,
        595
      ]
    },
    {
      "content": "This article provides you with step-by-step instructions to create the Base Configuration test environment in a Azure Virtual Network, using virtual machines created in Service Management.",
      "pos": [
        597,
        785
      ]
    },
    {
      "content": "You can use the resulting test environment:",
      "pos": [
        787,
        830
      ]
    },
    {
      "content": "For application development and testing.",
      "pos": [
        834,
        874
      ]
    },
    {
      "pos": [
        877,
        1011
      ],
      "content": "For the <bpt id=\"p1\">[</bpt>simulated hybrid cloud environment<ept id=\"p1\">](../virtual-network/virtual-networks-setup-simulated-hybrid-cloud-environment-testing.md)</ept>."
    },
    {
      "content": "To extend it with additional virtual machines and Azure services for a test environment of your own design.",
      "pos": [
        1014,
        1121
      ]
    },
    {
      "content": "The Base Configuration test environment consists of the Corpnet subnet in a cloud-only virtual network named TestLab that simulates a simplified, private intranet connected to the Internet.",
      "pos": [
        1123,
        1312
      ]
    },
    {
      "content": "It contains:",
      "pos": [
        1394,
        1406
      ]
    },
    {
      "content": "One Azure virtual machine running Windows Server 2012 R2 named DC1 that is configured as an intranet domain controller and Domain Name System (DNS) server.",
      "pos": [
        1410,
        1565
      ]
    },
    {
      "content": "One Azure virtual machine running Windows Server 2012 R2 named APP1 that is configured as a general application and web server.",
      "pos": [
        1568,
        1695
      ]
    },
    {
      "content": "One Azure virtual machine running Windows Server 2012 R2 named CLIENT1 that will act as an intranet client.",
      "pos": [
        1698,
        1805
      ]
    },
    {
      "content": "This configuration allows DC1, APP1, CLIENT1, and additional Corpnet subnet computers to be:",
      "pos": [
        1807,
        1899
      ]
    },
    {
      "content": "Connected to the Internet to install updates, access Internet resources in real time, and participate in public cloud technologies such as Microsoft Office 365 and other Azure services.",
      "pos": [
        1905,
        2090
      ]
    },
    {
      "content": "Remotely managed using Remote Desktop Connections from your computer that is connected to the Internet or your organization network.",
      "pos": [
        2093,
        2225
      ]
    },
    {
      "content": "There are four phases to setting up the Corpnet subnet of the Windows Server 2012 R2 Base Configuration test environment in Azure.",
      "pos": [
        2227,
        2357
      ]
    },
    {
      "content": "Create the virtual network.",
      "pos": [
        2363,
        2390
      ]
    },
    {
      "content": "Configure DC1.",
      "pos": [
        2395,
        2409
      ]
    },
    {
      "content": "Configure APP1.",
      "pos": [
        2414,
        2429
      ]
    },
    {
      "content": "Configure CLIENT1.",
      "pos": [
        2434,
        2452
      ]
    },
    {
      "content": "If you do not already have an Azure account, you can sign up for a free trial at <bpt id=\"p1\">[</bpt>Try Azure<ept id=\"p1\">](http://azure.microsoft.com/pricing/free-trial/)</ept>.",
      "pos": [
        2454,
        2595
      ]
    },
    {
      "content": "If you have an MSDN Subscription, see <bpt id=\"p1\">[</bpt>Azure benefit for MSDN subscribers<ept id=\"p1\">](http://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/)</ept>.",
      "pos": [
        2596,
        2744
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> Virtual machines in Azure incur an ongoing monetary cost when they are running.",
      "pos": [
        2748,
        2840
      ]
    },
    {
      "content": "This cost is billed against your free trial, MSDN subscription, or paid subscription.",
      "pos": [
        2841,
        2926
      ]
    },
    {
      "content": "For more information about the costs of running Azure virtual machines, see <bpt id=\"p1\">[</bpt>Virtual Machines Pricing Details<ept id=\"p1\">](http://azure.microsoft.com/pricing/details/virtual-machines/)</ept> and <bpt id=\"p2\">[</bpt>Azure Pricing Calculator<ept id=\"p2\">](http://azure.microsoft.com/pricing/calculator/)</ept>.",
      "pos": [
        2927,
        3179
      ]
    },
    {
      "content": "To keep costs down, see <bpt id=\"p1\">[</bpt>Minimizing the costs of test environment virtual machines in Azure<ept id=\"p1\">](#costs)</ept>.",
      "pos": [
        3180,
        3281
      ]
    },
    {
      "content": "Base Configuration test environment with Azure Resource Manager",
      "pos": [
        3418,
        3481
      ]
    },
    {
      "content": "Phase 1: Create the virtual network",
      "pos": [
        3562,
        3597
      ]
    },
    {
      "content": "First, you create the TestLab virtual network that will host the Corpnet subnet of the base configuration.",
      "pos": [
        3599,
        3705
      ]
    },
    {
      "pos": [
        3711,
        3826
      ],
      "content": "In the task bar of the Azure Management Portal, click <bpt id=\"p1\">**</bpt>New &gt; Network Services &gt; Virtual Network &gt; Custom Create<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        3831,
        3897
      ],
      "content": "On the Virtual Network Details page, type <bpt id=\"p1\">**</bpt>TestLab<ept id=\"p1\">**</ept> in <bpt id=\"p2\">**</bpt>Name<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        3902,
        3949
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Location<ept id=\"p1\">**</ept>, select the appropriate region."
    },
    {
      "content": "Click the Next arrow.",
      "pos": [
        3954,
        3975
      ]
    },
    {
      "pos": [
        3980,
        4155
      ],
      "content": "On the DNS Servers and VPN Connectivity page, in <bpt id=\"p1\">**</bpt>DNS servers<ept id=\"p1\">**</ept>, type <bpt id=\"p2\">**</bpt>DC1<ept id=\"p2\">**</ept> in <bpt id=\"p3\">**</bpt>Select or enter name<ept id=\"p3\">**</ept>, type <bpt id=\"p4\">**</bpt>10.0.0.4<ept id=\"p4\">**</ept> in <bpt id=\"p5\">**</bpt>IP address<ept id=\"p5\">**</ept>, and then click the Next arrow."
    },
    {
      "pos": [
        4160,
        4277
      ],
      "content": "On the Virtual Network Address Spaces page, in <bpt id=\"p1\">**</bpt>Subnets<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Subnet-1<ept id=\"p2\">**</ept> and replace the name with <bpt id=\"p3\">**</bpt>Corpnet<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        4282,
        4365
      ],
      "content": "In the <bpt id=\"p1\">**</bpt>CIDR (Address Count)<ept id=\"p1\">**</ept> column for the Corpnet subnet, click <bpt id=\"p2\">**</bpt>/24 (256)<ept id=\"p2\">**</ept>."
    },
    {
      "content": "Click the Complete icon.",
      "pos": [
        4370,
        4394
      ]
    },
    {
      "content": "Wait until the virtual network is created before continuing.",
      "pos": [
        4395,
        4455
      ]
    },
    {
      "content": "Next, use the instructions in <bpt id=\"p1\">[</bpt>How to install and configure Azure PowerShell<ept id=\"p1\">](../install-configure-powershell.md)</ept> to install Azure PowerShell on your local computer.",
      "pos": [
        4457,
        4622
      ]
    },
    {
      "content": "Open an Azure PowerShell command prompt.",
      "pos": [
        4623,
        4663
      ]
    },
    {
      "content": "First, select the correct Azure subscription with these commands.",
      "pos": [
        4665,
        4730
      ]
    },
    {
      "content": "Replace everything within the quotes, including the &lt; and &gt; characters, with the correct name.",
      "pos": [
        4731,
        4825
      ]
    },
    {
      "pos": [
        4926,
        5055
      ],
      "content": "You can get the subscription name from the <bpt id=\"p1\">**</bpt>SubscriptionName<ept id=\"p1\">**</ept> property of the display of the <bpt id=\"p2\">**</bpt>Get-AzureSubscription<ept id=\"p2\">**</ept> command."
    },
    {
      "content": "Next, you create an Azure cloud service.",
      "pos": [
        5057,
        5097
      ]
    },
    {
      "content": "The cloud service acts as a security boundary and logical container for the virtual machines placed in the virtual network.",
      "pos": [
        5098,
        5221
      ]
    },
    {
      "content": "It also provides a way for you to remotely connect to and manage the virtual machines on the Corpnet subnet.",
      "pos": [
        5222,
        5330
      ]
    },
    {
      "content": "You must pick a unique name for your cloud service.",
      "pos": [
        5332,
        5383
      ]
    },
    {
      "content": "The cloud service name can contain only letters, numbers, and hyphens.",
      "pos": [
        5385,
        5455
      ]
    },
    {
      "content": "The first and last character in the field must be a letter or number.",
      "pos": [
        5456,
        5525
      ]
    },
    {
      "content": "*",
      "pos": [
        5525,
        5526
      ]
    },
    {
      "content": "For example, you could name your cloud service TestLab-<bpt id=\"p1\">*</bpt>UniqueSequence<ept id=\"p1\">*</ept>, in which <bpt id=\"p2\">*</bpt>UniqueSequence<ept id=\"p2\">*</ept> is an abbreviation of your organization.",
      "pos": [
        5528,
        5667
      ]
    },
    {
      "content": "For example, if your organization is named Tailspin Toys, you could name the cloud service TestLab-Tailspin.",
      "pos": [
        5668,
        5776
      ]
    },
    {
      "content": "You can test for the uniqueness of the name with this Azure PowerShell command.",
      "pos": [
        5778,
        5857
      ]
    },
    {
      "content": "If this command returns \"False\", your proposed name is unique.",
      "pos": [
        5918,
        5980
      ]
    },
    {
      "content": "Then, create the cloud service with these commands.",
      "pos": [
        5981,
        6032
      ]
    },
    {
      "content": "Record the actual name of your cloud service.",
      "pos": [
        6180,
        6225
      ]
    },
    {
      "content": "Next, you configure a storage account that will contain the disks for your virtual machines and extra data disks.",
      "pos": [
        6227,
        6340
      ]
    },
    {
      "content": "You must pick a unique name that contains only lowercase letters and numbers.",
      "pos": [
        6342,
        6419
      ]
    },
    {
      "content": "You can test for the uniqueness of the storage account name with this Azure PowerShell command.",
      "pos": [
        6421,
        6516
      ]
    },
    {
      "content": "If this command returns \"False\", your proposed name is unique.",
      "pos": [
        6579,
        6641
      ]
    },
    {
      "content": "Then, create the storage account and set the subscription to use it with these commands.",
      "pos": [
        6642,
        6730
      ]
    },
    {
      "content": "This is your current configuration.",
      "pos": [
        6942,
        6977
      ]
    },
    {
      "content": "Phase 2: Configure DC1",
      "pos": [
        7062,
        7084
      ]
    },
    {
      "content": "DC1 is a domain controller for the corp.contoso.com Active Directory Domain Services (AD DS) domain and a DNS server for the virtual machines of the TestLab virtual network.",
      "pos": [
        7086,
        7259
      ]
    },
    {
      "content": "First, fill in the name of your cloud service and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for DC1.",
      "pos": [
        7261,
        7435
      ]
    },
    {
      "content": "Next, connect to the DC1 virtual machine.",
      "pos": [
        8256,
        8297
      ]
    },
    {
      "pos": [
        8303,
        8460
      ],
      "content": "In the Azure Management Portal, click <bpt id=\"p1\">**</bpt>Virtual Machines<ept id=\"p1\">**</ept> in the left pane, and then click <bpt id=\"p2\">**</bpt>Started<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Status<ept id=\"p3\">**</ept> column for the DC1 virtual machine."
    },
    {
      "pos": [
        8467,
        8502
      ],
      "content": "In the task bar, click <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        8507,
        8553
      ],
      "content": "When prompted to open DC1.rdp, click <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        8558,
        8636
      ],
      "content": "When prompted with a Remote Desktop Connection message box, click <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept>."
    },
    {
      "content": "When prompted for credentials, use the following:",
      "pos": [
        8641,
        8690
      ]
    },
    {
      "pos": [
        8693,
        8742
      ],
      "content": "Name: <bpt id=\"p1\">**</bpt>DC1\\\\<ept id=\"p1\">**</ept>[Local administrator account name]"
    },
    {
      "content": "Password: [Local administrator account password]",
      "pos": [
        8745,
        8793
      ]
    },
    {
      "pos": [
        8798,
        8898
      ],
      "content": "When prompted with a Remote Desktop Connection message box referring to certificates, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Next, add an extra data disk as a new volume with the drive letter F:.",
      "pos": [
        8900,
        8970
      ]
    },
    {
      "pos": [
        8976,
        9074
      ],
      "content": "In the left pane of Server Manager, click <bpt id=\"p1\">**</bpt>File and Storage Services<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Disks<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        9079,
        9186
      ],
      "content": "In the contents pane, in the <bpt id=\"p1\">**</bpt>Disks<ept id=\"p1\">**</ept> group, click <bpt id=\"p2\">**</bpt>disk 2<ept id=\"p2\">**</ept> (with the <bpt id=\"p3\">**</bpt>Partition<ept id=\"p3\">**</ept> set to <bpt id=\"p4\">**</bpt>Unknown<ept id=\"p4\">**</ept>)."
    },
    {
      "pos": [
        9191,
        9238
      ],
      "content": "Click <bpt id=\"p1\">**</bpt>Tasks<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>New Volume<ept id=\"p2\">**</ept>."
    },
    {
      "pos": [
        9243,
        9313
      ],
      "content": "On the Before you begin page of the New Volume Wizard, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "content": "On the Select the server and disk page, click <bpt id=\"p1\">**</bpt>Disk 2<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>.",
      "pos": [
        9318,
        9400
      ]
    },
    {
      "content": "When prompted, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.",
      "pos": [
        9401,
        9429
      ]
    },
    {
      "pos": [
        9434,
        9493
      ],
      "content": "On the Specify the size of the volume page, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        9498,
        9561
      ],
      "content": "On the Assign to a drive letter or folder page, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        9566,
        9622
      ],
      "content": "On the Select file system settings page, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        9627,
        9676
      ],
      "content": "On the Confirm selections page, click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        9681,
        9712
      ],
      "content": "When complete, click <bpt id=\"p1\">**</bpt>Close<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Next, configure DC1 as a domain controller and DNS server for the corp.contoso.com domain.",
      "pos": [
        9714,
        9804
      ]
    },
    {
      "content": "Run these commands at an administrator-level Windows PowerShell command prompt.",
      "pos": [
        9805,
        9884
      ]
    },
    {
      "content": "After DC1 restarts, reconnect to the DC1 virtual machine.",
      "pos": [
        10076,
        10133
      ]
    },
    {
      "pos": [
        10139,
        10271
      ],
      "content": "On the virtual machines page of the Azure Management Portal, click <bpt id=\"p1\">**</bpt>Running<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>Status<ept id=\"p2\">**</ept> column for the DC1 virtual machine."
    },
    {
      "pos": [
        10276,
        10311
      ],
      "content": "In the task bar, click <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        10316,
        10362
      ],
      "content": "When prompted to open DC1.rdp, click <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        10367,
        10445
      ],
      "content": "When prompted with a Remote Desktop Connection message box, click <bpt id=\"p1\">**</bpt>Connect<ept id=\"p1\">**</ept>."
    },
    {
      "content": "When prompted for credentials, use the following:",
      "pos": [
        10450,
        10499
      ]
    },
    {
      "pos": [
        10502,
        10552
      ],
      "content": "Name: <bpt id=\"p1\">**</bpt>CORP\\\\<ept id=\"p1\">**</ept>[Local administrator account name]"
    },
    {
      "content": "Password: [Local administrator account password]",
      "pos": [
        10555,
        10603
      ]
    },
    {
      "pos": [
        10608,
        10706
      ],
      "content": "When prompted by a Remote Desktop Connection message box referring to certificates, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Next, create a user account in Active Directory that will be used when logging in to CORP domain member computers.",
      "pos": [
        10708,
        10822
      ]
    },
    {
      "content": "Run these commands one at a time at an administrator-level Windows PowerShell command prompt.",
      "pos": [
        10823,
        10916
      ]
    },
    {
      "content": "Note that the first command results in a prompt to supply the User1 account password.",
      "pos": [
        11321,
        11406
      ]
    },
    {
      "content": "Because this account will be used for remote desktop connections for all CORP domain member computers, choose a strong password.",
      "pos": [
        11407,
        11535
      ]
    },
    {
      "content": "To check its strength, see <bpt id=\"p1\">[</bpt>Password Checker: Using Strong Passwords<ept id=\"p1\">](https://www.microsoft.com/security/pc-security/password-checker.aspx)</ept>.",
      "pos": [
        11536,
        11676
      ]
    },
    {
      "content": "Record the User1 account password and store it in a secured location.",
      "pos": [
        11677,
        11746
      ]
    },
    {
      "content": "Reconnect to the DC1 virtual machine using the CORP\\User1 account.",
      "pos": [
        11748,
        11814
      ]
    },
    {
      "content": "Next, to allow traffic for the Ping tool, run this command at an administrator-level Windows PowerShell command prompt.",
      "pos": [
        11816,
        11935
      ]
    },
    {
      "content": "This is your current configuration.",
      "pos": [
        12043,
        12078
      ]
    },
    {
      "content": "Phase 3: Configure APP1",
      "pos": [
        12163,
        12186
      ]
    },
    {
      "content": "APP1 provides web and file sharing services.",
      "pos": [
        12188,
        12232
      ]
    },
    {
      "content": "First, fill in the name of your cloud service and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for APP1.",
      "pos": [
        12234,
        12409
      ]
    },
    {
      "content": "Next, connect to the APP1 virtual machine using the CORP\\User1 credentials and open an administrator-level Windows PowerShell command prompt.",
      "pos": [
        13325,
        13466
      ]
    },
    {
      "pos": [
        13468,
        13626
      ],
      "content": "To check name resolution and network communication between APP1 and DC1, run the <bpt id=\"p1\">**</bpt>ping dc1.corp.contoso.com<ept id=\"p1\">**</ept> command and verify that there are four replies."
    },
    {
      "content": "Next, make APP1 a web server with this command at the Windows PowerShell command prompt.",
      "pos": [
        13628,
        13716
      ]
    },
    {
      "content": "Next, create a shared folder and a text file within the folder on APP1 with these commands.",
      "pos": [
        13784,
        13875
      ]
    },
    {
      "content": "This is your current configuration.",
      "pos": [
        14065,
        14100
      ]
    },
    {
      "content": "Phase 4: Configure CLIENT1",
      "pos": [
        14185,
        14211
      ]
    },
    {
      "content": "CLIENT1 acts as a typical laptop, tablet, or desktop computer on the Contoso intranet.",
      "pos": [
        14213,
        14299
      ]
    },
    {
      "content": "First, fill in the name of your cloud service and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for CLIENT1.",
      "pos": [
        14301,
        14479
      ]
    },
    {
      "content": "Next, connect to the CLIENT1 virtual machine using the CORP\\User1 credentials.",
      "pos": [
        15401,
        15479
      ]
    },
    {
      "pos": [
        15481,
        15681
      ],
      "content": "To check name resolution and network communication between CLIENT1 and DC1, run the <bpt id=\"p1\">**</bpt>ping dc1.corp.contoso.com<ept id=\"p1\">**</ept> command at a Windows PowerShell command prompt and verify that there are four replies."
    },
    {
      "content": "Next, verify that you can access web and file share resources on APP1 from CLIENT1.",
      "pos": [
        15683,
        15766
      ]
    },
    {
      "pos": [
        15772,
        15832
      ],
      "content": "In Server Manager, in the tree pane, click <bpt id=\"p1\">**</bpt>Local Server<ept id=\"p1\">**</ept>."
    },
    {
      "pos": [
        15837,
        15928
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Properties for CLIENT1<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>On<ept id=\"p2\">**</ept> next to <bpt id=\"p3\">**</bpt>IE Enhanced Security Configuration<ept id=\"p3\">**</ept>."
    },
    {
      "pos": [
        15933,
        16065
      ],
      "content": "In <bpt id=\"p1\">**</bpt>Internet Explorer Enhanced Security Configuration<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Off<ept id=\"p2\">**</ept> for <bpt id=\"p3\">**</bpt>Administrators<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>Users<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>OK<ept id=\"p5\">**</ept>."
    },
    {
      "pos": [
        16070,
        16144
      ],
      "content": "From the Start screen, click <bpt id=\"p1\">**</bpt>Internet Explorer<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."
    },
    {
      "content": "In the Address bar, type <bpt id=\"p1\">**</bpt>http://app1.corp.contoso.com/<ept id=\"p1\">**</ept>, and then press ENTER.",
      "pos": [
        16149,
        16230
      ]
    },
    {
      "content": "You should see the default Internet Information Services web page for APP1.",
      "pos": [
        16232,
        16307
      ]
    },
    {
      "content": "From the desktop taskbar, click the File Explorer icon.",
      "pos": [
        16312,
        16367
      ]
    },
    {
      "pos": [
        16372,
        16437
      ],
      "content": "In the address bar, type <bpt id=\"p1\">**</bpt>\\\\\\app1\\Files<ept id=\"p1\">**</ept>, and then press ENTER."
    },
    {
      "content": "You should see a folder window with the contents of the Files shared folder.",
      "pos": [
        16442,
        16518
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Files<ept id=\"p1\">**</ept> shared folder window, double-click the <bpt id=\"p2\">**</bpt>Example.txt<ept id=\"p2\">**</ept> file.",
      "pos": [
        16523,
        16600
      ]
    },
    {
      "content": "You should see the contents of the Example.txt file.",
      "pos": [
        16601,
        16653
      ]
    },
    {
      "pos": [
        16658,
        16734
      ],
      "content": "Close the <bpt id=\"p1\">**</bpt>example.txt - Notepad<ept id=\"p1\">**</ept> and the <bpt id=\"p2\">**</bpt>Files<ept id=\"p2\">**</ept> shared folder windows."
    },
    {
      "content": "This is your final configuration.",
      "pos": [
        16736,
        16769
      ]
    },
    {
      "pos": [
        16851,
        17112
      ],
      "content": "Your base configuration in Azure is now ready for application development and testing or for additional test environments, such as the <bpt id=\"p1\">[</bpt>simulated hybrid cloud environment<ept id=\"p1\">](../virtual-network/virtual-networks-setup-simulated-hybrid-cloud-environment-testing.md)</ept>."
    },
    {
      "content": "Additional resources",
      "pos": [
        17117,
        17137
      ]
    },
    {
      "content": "Hybrid cloud test environments",
      "pos": [
        17140,
        17170
      ]
    },
    {
      "content": "Base Configuration test environment with Azure Resource Manager",
      "pos": [
        17253,
        17316
      ]
    },
    {
      "pos": [
        17396,
        17480
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"costs\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Minimizing the costs of test environment virtual machines in Azure"
    },
    {
      "content": "To minimize the cost of running the test environment virtual machines, you can do one of the following:",
      "pos": [
        17482,
        17585
      ]
    },
    {
      "content": "Create the test environment and perform your needed testing and demonstration as quickly as possible.",
      "pos": [
        17589,
        17690
      ]
    },
    {
      "content": "When complete, delete the test environment virtual machines.",
      "pos": [
        17691,
        17751
      ]
    },
    {
      "content": "Shut down your test environment virtual machines into a deallocated state.",
      "pos": [
        17754,
        17828
      ]
    },
    {
      "content": "To shut down the virtual machines with Azure PowerShell, fill in the cloud service name and run these commands.",
      "pos": [
        17830,
        17941
      ]
    },
    {
      "content": "To ensure that your virtual machines work properly when starting all of them from the Stopped (Deallocated) state, you should start them in the following order:",
      "pos": [
        18184,
        18344
      ]
    },
    {
      "content": "DC1",
      "pos": [
        18350,
        18353
      ]
    },
    {
      "content": "APP1",
      "pos": [
        18358,
        18362
      ]
    },
    {
      "content": "CLIENT1",
      "pos": [
        18367,
        18374
      ]
    },
    {
      "content": "To start the virtual machines in order with Azure PowerShell, fill in the cloud service name and run these commands.",
      "pos": [
        18376,
        18492
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Base Configuration Test Environment\"\n    description=\"Learn how to create a simple dev/test environment that simulates a simplified intranet in Microsoft Azure.\"\n    documentationCenter=\"\"\n    services=\"virtual-machines\"\n    authors=\"JoeDavies-MSFT\"\n    manager=\"timlt\"\n    editor=\"\"\n    tags=\"azure-service-management\"/>\n\n<tags\n    ms.service=\"virtual-machines\"\n    ms.workload=\"infrastructure-services\"\n    ms.tgt_pltfrm=\"vm-windows\"\n    ms.devlang=\"na\"\n    ms.topic=\"article\"\n    ms.date=\"07/07/2015\"\n    ms.author=\"josephd\"/>\n\n# Base Configuration test environment\n\nThis article provides you with step-by-step instructions to create the Base Configuration test environment in a Azure Virtual Network, using virtual machines created in Service Management.\n\nYou can use the resulting test environment:\n\n- For application development and testing.\n- For the [simulated hybrid cloud environment](../virtual-network/virtual-networks-setup-simulated-hybrid-cloud-environment-testing.md).\n- To extend it with additional virtual machines and Azure services for a test environment of your own design.\n\nThe Base Configuration test environment consists of the Corpnet subnet in a cloud-only virtual network named TestLab that simulates a simplified, private intranet connected to the Internet.\n\n![](./media/virtual-machines-base-configuration-test-environment/BC_TLG04.png)\n\nIt contains:\n\n- One Azure virtual machine running Windows Server 2012 R2 named DC1 that is configured as an intranet domain controller and Domain Name System (DNS) server.\n- One Azure virtual machine running Windows Server 2012 R2 named APP1 that is configured as a general application and web server.\n- One Azure virtual machine running Windows Server 2012 R2 named CLIENT1 that will act as an intranet client.\n\nThis configuration allows DC1, APP1, CLIENT1, and additional Corpnet subnet computers to be:  \n\n- Connected to the Internet to install updates, access Internet resources in real time, and participate in public cloud technologies such as Microsoft Office 365 and other Azure services.\n- Remotely managed using Remote Desktop Connections from your computer that is connected to the Internet or your organization network.\n\nThere are four phases to setting up the Corpnet subnet of the Windows Server 2012 R2 Base Configuration test environment in Azure.\n\n1.  Create the virtual network.\n2.  Configure DC1.\n3.  Configure APP1.\n4.  Configure CLIENT1.\n\nIf you do not already have an Azure account, you can sign up for a free trial at [Try Azure](http://azure.microsoft.com/pricing/free-trial/). If you have an MSDN Subscription, see [Azure benefit for MSDN subscribers](http://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/).\n\n> [AZURE.NOTE] Virtual machines in Azure incur an ongoing monetary cost when they are running. This cost is billed against your free trial, MSDN subscription, or paid subscription. For more information about the costs of running Azure virtual machines, see [Virtual Machines Pricing Details](http://azure.microsoft.com/pricing/details/virtual-machines/) and [Azure Pricing Calculator](http://azure.microsoft.com/pricing/calculator/). To keep costs down, see [Minimizing the costs of test environment virtual machines in Azure](#costs).\n\n[AZURE.INCLUDE [service-management-pointer-to-resource-manager](../../includes/service-management-pointer-to-resource-manager.md)]\n\n- [Base Configuration test environment with Azure Resource Manager](virtual-machines-base-configuration-test-environment-resource-manager.md)\n\n\n## Phase 1: Create the virtual network\n\nFirst, you create the TestLab virtual network that will host the Corpnet subnet of the base configuration.\n\n1.  In the task bar of the Azure Management Portal, click **New > Network Services > Virtual Network > Custom Create**.\n2.  On the Virtual Network Details page, type **TestLab** in **Name**.\n3.  In **Location**, select the appropriate region.\n4.  Click the Next arrow.\n5.  On the DNS Servers and VPN Connectivity page, in **DNS servers**, type **DC1** in **Select or enter name**, type **10.0.0.4** in **IP address**, and then click the Next arrow.\n6.  On the Virtual Network Address Spaces page, in **Subnets**, click **Subnet-1** and replace the name with **Corpnet**.\n7.  In the **CIDR (Address Count)** column for the Corpnet subnet, click **/24 (256)**.\n8.  Click the Complete icon. Wait until the virtual network is created before continuing.\n\nNext, use the instructions in [How to install and configure Azure PowerShell](../install-configure-powershell.md) to install Azure PowerShell on your local computer. Open an Azure PowerShell command prompt.\n\nFirst, select the correct Azure subscription with these commands. Replace everything within the quotes, including the < and > characters, with the correct name.\n\n    $subscr=\"<Subscription name>\"\n    Select-AzureSubscription -SubscriptionName $subscr –Current\n\nYou can get the subscription name from the **SubscriptionName** property of the display of the **Get-AzureSubscription** command.\n\nNext, you create an Azure cloud service. The cloud service acts as a security boundary and logical container for the virtual machines placed in the virtual network. It also provides a way for you to remotely connect to and manage the virtual machines on the Corpnet subnet.\n\nYou must pick a unique name for your cloud service. *The cloud service name can contain only letters, numbers, and hyphens. The first and last character in the field must be a letter or number.*\n\nFor example, you could name your cloud service TestLab-*UniqueSequence*, in which *UniqueSequence* is an abbreviation of your organization. For example, if your organization is named Tailspin Toys, you could name the cloud service TestLab-Tailspin.\n\nYou can test for the uniqueness of the name with this Azure PowerShell command.\n\n    Test-AzureName -Service <Proposed cloud service name>\n\nIf this command returns \"False\", your proposed name is unique. Then, create the cloud service with these commands.\n\n    $loc=\"<the same location (region) as your TestLab virtual network>\"\n    New-AzureService -Service <Unique cloud service name> -Location $loc\n\nRecord the actual name of your cloud service.\n\nNext, you configure a storage account that will contain the disks for your virtual machines and extra data disks. *You must pick a unique name that contains only lowercase letters and numbers.* You can test for the uniqueness of the storage account name with this Azure PowerShell command.\n\n    Test-AzureName -Storage <Proposed storage account name>\n\nIf this command returns \"False\", your proposed name is unique. Then, create the storage account and set the subscription to use it with these commands.\n\n    $stAccount=\"<your storage account name>\"\n    New-AzureStorageAccount -StorageAccountName $stAccount -Location $loc\n    Set-AzureSubscription -SubscriptionName $subscr -CurrentStorageAccountName $stAccount\n\nThis is your current configuration.\n\n![](./media/virtual-machines-base-configuration-test-environment/BC_TLG01.png)\n\n## Phase 2: Configure DC1\n\nDC1 is a domain controller for the corp.contoso.com Active Directory Domain Services (AD DS) domain and a DNS server for the virtual machines of the TestLab virtual network.\n\nFirst, fill in the name of your cloud service and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for DC1.\n\n    $serviceName=\"<your cloud service name>\"\n    $cred=Get-Credential –Message \"Type the name and password of the local administrator account for DC1.\"\n    $image= Get-AzureVMImage | where { $_.ImageFamily -eq \"Windows Server 2012 R2 Datacenter\" } | sort PublishedDate -Descending | select -ExpandProperty ImageName -First 1\n    $vm1=New-AzureVMConfig -Name DC1 -InstanceSize Small -ImageName $image\n    $vm1 | Add-AzureProvisioningConfig -Windows -AdminUsername $cred.GetNetworkCredential().Username -Password $cred.GetNetworkCredential().Password\n    $vm1 | Add-AzureDataDisk -CreateNew -DiskSizeInGB 20 -DiskLabel \"AD\" -LUN 0 -HostCaching None\n    $vm1 | Set-AzureSubnet -SubnetNames Corpnet\n    $vm1 | Set-AzureStaticVNetIP -IPAddress 10.0.0.4\n    New-AzureVM –ServiceName $serviceName -VMs $vm1 -VNetName TestLab\n\nNext, connect to the DC1 virtual machine.\n\n1.  In the Azure Management Portal, click **Virtual Machines** in the left pane, and then click **Started** in the **Status** column for the DC1 virtual machine.  \n2.  In the task bar, click **Connect**.\n3.  When prompted to open DC1.rdp, click **Open**.\n4.  When prompted with a Remote Desktop Connection message box, click **Connect**.\n5.  When prompted for credentials, use the following:\n- Name: **DC1\\\\**[Local administrator account name]\n- Password: [Local administrator account password]\n6.  When prompted with a Remote Desktop Connection message box referring to certificates, click **Yes**.\n\nNext, add an extra data disk as a new volume with the drive letter F:.\n\n1.  In the left pane of Server Manager, click **File and Storage Services**, and then click **Disks**.\n2.  In the contents pane, in the **Disks** group, click **disk 2** (with the **Partition** set to **Unknown**).\n3.  Click **Tasks**, and then click **New Volume**.\n4.  On the Before you begin page of the New Volume Wizard, click **Next**.\n5.  On the Select the server and disk page, click **Disk 2**, and then click **Next**. When prompted, click **OK**.\n6.  On the Specify the size of the volume page, click **Next**.\n7.  On the Assign to a drive letter or folder page, click **Next**.\n8.  On the Select file system settings page, click **Next**.\n9.  On the Confirm selections page, click **Create**.\n10. When complete, click **Close**.\n\nNext, configure DC1 as a domain controller and DNS server for the corp.contoso.com domain. Run these commands at an administrator-level Windows PowerShell command prompt.\n\n    Install-WindowsFeature AD-Domain-Services -IncludeManagementTools\n    Install-ADDSForest -DomainName corp.contoso.com -DatabasePath \"F:\\NTDS\" -SysvolPath \"F:\\SYSVOL\" -LogPath \"F:\\Logs\"\n\nAfter DC1 restarts, reconnect to the DC1 virtual machine.\n\n1.  On the virtual machines page of the Azure Management Portal, click **Running** in the **Status** column for the DC1 virtual machine.\n2.  In the task bar, click **Connect**.\n3.  When prompted to open DC1.rdp, click **Open**.\n4.  When prompted with a Remote Desktop Connection message box, click **Connect**.\n5.  When prompted for credentials, use the following:\n- Name: **CORP\\\\**[Local administrator account name]\n- Password: [Local administrator account password]\n6.  When prompted by a Remote Desktop Connection message box referring to certificates, click **Yes**.\n\nNext, create a user account in Active Directory that will be used when logging in to CORP domain member computers. Run these commands one at a time at an administrator-level Windows PowerShell command prompt.\n\n    New-ADUser -SamAccountName User1 -AccountPassword (read-host \"Set user password\" -assecurestring) -name \"User1\" -enabled $true -PasswordNeverExpires $true -ChangePasswordAtLogon $false\n    Add-ADPrincipalGroupMembership -Identity \"CN=User1,CN=Users,DC=corp,DC=contoso,DC=com\" -MemberOf \"CN=Enterprise Admins,CN=Users,DC=corp,DC=contoso,DC=com\",\"CN=Domain Admins,CN=Users,DC=corp,DC=contoso,DC=com\"\n\nNote that the first command results in a prompt to supply the User1 account password. Because this account will be used for remote desktop connections for all CORP domain member computers, choose a strong password. To check its strength, see [Password Checker: Using Strong Passwords](https://www.microsoft.com/security/pc-security/password-checker.aspx). Record the User1 account password and store it in a secured location.\n\nReconnect to the DC1 virtual machine using the CORP\\User1 account.\n\nNext, to allow traffic for the Ping tool, run this command at an administrator-level Windows PowerShell command prompt.\n\n    Set-NetFirewallRule -DisplayName \"File and Printer Sharing (Echo Request - ICMPv4-In)\" -enabled True\n\nThis is your current configuration.\n\n![](./media/virtual-machines-base-configuration-test-environment/BC_TLG02.png)\n\n## Phase 3: Configure APP1\n\nAPP1 provides web and file sharing services.\n\nFirst, fill in the name of your cloud service and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for APP1.\n\n    $serviceName=\"<your cloud service name>\"\n    $cred1=Get-Credential –Message \"Type the name and password of the local administrator account for APP1.\"\n    $cred2=Get-Credential –UserName \"CORP\\User1\" –Message \"Now type the password for the CORP\\User1 account.\"\n    $image= Get-AzureVMImage | where { $_.ImageFamily -eq \"Windows Server 2012 R2 Datacenter\" } | sort PublishedDate -Descending | select -ExpandProperty ImageName -First 1\n    $vm1=New-AzureVMConfig -Name APP1 -InstanceSize Small -ImageName $image\n    $vm1 | Add-AzureProvisioningConfig -AdminUsername $cred1.GetNetworkCredential().Username -Password $cred1.GetNetworkCredential().Password -WindowsDomain -Domain \"CORP\" -DomainUserName \"User1\" -DomainPassword $cred2.GetNetworkCredential().Password -JoinDomain \"corp.contoso.com\"\n    $vm1 | Set-AzureSubnet -SubnetNames Corpnet\n    New-AzureVM –ServiceName $serviceName -VMs $vm1 -VNetName TestLab\n\nNext, connect to the APP1 virtual machine using the CORP\\User1 credentials and open an administrator-level Windows PowerShell command prompt.\n\nTo check name resolution and network communication between APP1 and DC1, run the **ping dc1.corp.contoso.com** command and verify that there are four replies.\n\nNext, make APP1 a web server with this command at the Windows PowerShell command prompt.\n\n    Install-WindowsFeature Web-WebServer –IncludeManagementTools\n\nNext, create a shared folder and a text file within the folder on APP1 with these commands.\n\n    New-Item -path c:\\files -type directory\n    Write-Output \"This is a shared file.\" | out-file c:\\files\\example.txt\n    New-SmbShare -name files -path c:\\files -changeaccess CORP\\User1\n\nThis is your current configuration.\n\n![](./media/virtual-machines-base-configuration-test-environment/BC_TLG03.png)\n\n## Phase 4: Configure CLIENT1\n\nCLIENT1 acts as a typical laptop, tablet, or desktop computer on the Contoso intranet.\n\nFirst, fill in the name of your cloud service and run these commands at the Azure PowerShell command prompt on your local computer to create an Azure Virtual Machine for CLIENT1.\n\n    $serviceName=\"<your cloud service name>\"\n    $cred1=Get-Credential –Message \"Type the name and password of the local administrator account for CLIENT1.\"\n    $cred2=Get-Credential –UserName \"CORP\\User1\" –Message \"Now type the password for the CORP\\User1 account.\"\n    $image= Get-AzureVMImage | where { $_.ImageFamily -eq \"Windows Server 2012 R2 Datacenter\" } | sort PublishedDate -Descending | select -ExpandProperty ImageName -First 1\n    $vm1=New-AzureVMConfig -Name CLIENT1 -InstanceSize Small -ImageName $image\n    $vm1 | Add-AzureProvisioningConfig -AdminUsername $cred1.GetNetworkCredential().Username -Password $cred1.GetNetworkCredential().Password -WindowsDomain -Domain \"CORP\" -DomainUserName \"User1\" -DomainPassword $cred2.GetNetworkCredential().Password -JoinDomain \"corp.contoso.com\"\n    $vm1 | Set-AzureSubnet -SubnetNames Corpnet\n    New-AzureVM –ServiceName $serviceName -VMs $vm1 -VNetName TestLab\n\nNext, connect to the CLIENT1 virtual machine using the CORP\\User1 credentials.\n\nTo check name resolution and network communication between CLIENT1 and DC1, run the **ping dc1.corp.contoso.com** command at a Windows PowerShell command prompt and verify that there are four replies.\n\nNext, verify that you can access web and file share resources on APP1 from CLIENT1.\n\n1.  In Server Manager, in the tree pane, click **Local Server**.\n2.  In **Properties for CLIENT1**, click **On** next to **IE Enhanced Security Configuration**.\n3.  In **Internet Explorer Enhanced Security Configuration**, click **Off** for **Administrators** and **Users**, and then click **OK**.\n4.  From the Start screen, click **Internet Explorer**, and then click **OK**.\n5.  In the Address bar, type **http://app1.corp.contoso.com/**, and then press ENTER.  You should see the default Internet Information Services web page for APP1.\n6.  From the desktop taskbar, click the File Explorer icon.\n7.  In the address bar, type **\\\\\\app1\\Files**, and then press ENTER.\n8.  You should see a folder window with the contents of the Files shared folder.\n9.  In the **Files** shared folder window, double-click the **Example.txt** file. You should see the contents of the Example.txt file.\n10. Close the **example.txt - Notepad** and the **Files** shared folder windows.\n\nThis is your final configuration.\n\n![](./media/virtual-machines-base-configuration-test-environment/BC_TLG04.png)\n\nYour base configuration in Azure is now ready for application development and testing or for additional test environments, such as the [simulated hybrid cloud environment](../virtual-network/virtual-networks-setup-simulated-hybrid-cloud-environment-testing.md).\n\n## Additional resources\n\n[Hybrid cloud test environments](../virtual-network/virtual-networks-setup-hybrid-cloud-environment-testing.md)\n\n[Base Configuration test environment with Azure Resource Manager](virtual-machines-base-configuration-test-environment-resource-manager.md)\n\n## <a id=\"costs\"></a>Minimizing the costs of test environment virtual machines in Azure\n\nTo minimize the cost of running the test environment virtual machines, you can do one of the following:\n\n- Create the test environment and perform your needed testing and demonstration as quickly as possible. When complete, delete the test environment virtual machines.\n- Shut down your test environment virtual machines into a deallocated state.\n\nTo shut down the virtual machines with Azure PowerShell, fill in the cloud service name and run these commands.\n\n    $serviceName=\"<your cloud service name>\"\n    Stop-AzureVM -ServiceName $serviceName -Name \"CLIENT1\"\n    Stop-AzureVM -ServiceName $serviceName -Name \"APP1\"\n    Stop-AzureVM -ServiceName $serviceName -Name \"DC1\" -Force -StayProvisioned\n\n\nTo ensure that your virtual machines work properly when starting all of them from the Stopped (Deallocated) state, you should start them in the following order:\n\n1.  DC1\n2.  APP1\n3.  CLIENT1\n\nTo start the virtual machines in order with Azure PowerShell, fill in the cloud service name and run these commands.\n\n    $serviceName=\"<your cloud service name>\"\n    Start-AzureVM -ServiceName $serviceName -Name \"DC1\"\n    Start-AzureVM -ServiceName $serviceName -Name \"APP1\"\n    Start-AzureVM -ServiceName $serviceName -Name \"CLIENT1\"\n"
}