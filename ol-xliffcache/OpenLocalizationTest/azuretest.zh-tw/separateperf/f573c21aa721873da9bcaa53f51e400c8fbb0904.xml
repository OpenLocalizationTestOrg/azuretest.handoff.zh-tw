{
  "nodes": [
    {
      "content": "Enterprise-class WordPress on Azure App Service",
      "pos": [
        27,
        74
      ]
    },
    {
      "content": "Learn how to host an enterprise-class WordPress site on Azure App Service",
      "pos": [
        93,
        166
      ]
    },
    {
      "content": "Enterprise-class WordPress on Azure App Service",
      "pos": [
        470,
        517
      ]
    },
    {
      "content": "Azure App Service provides a scalable, secure and easy to use environment for mission critical, large scale <bpt id=\"p1\">[</bpt>WordPress<ept id=\"p1\">][wordpress]</ept> sites.",
      "pos": [
        519,
        656
      ]
    },
    {
      "content": "Microsoft itself runs enterprise-class sites such as the <bpt id=\"p1\">[</bpt>Office<ept id=\"p1\">][officeblog]</ept> and <bpt id=\"p2\">[</bpt>Bing<ept id=\"p2\">][bingblog]</ept> blogs.",
      "pos": [
        657,
        762
      ]
    },
    {
      "content": "This document shows you how you can use Azure App Service Web Apps to establish and maintain an enterprise-class, cloud-based WordPress site that can handle a large volume of visitors.",
      "pos": [
        763,
        947
      ]
    },
    {
      "content": "Architecture and planning",
      "pos": [
        952,
        977
      ]
    },
    {
      "content": "A basic WordPress installation has only two requirements.",
      "pos": [
        979,
        1036
      ]
    },
    {
      "pos": [
        1040,
        1258
      ],
      "content": "<bpt id=\"p1\">**</bpt>MySQL Database<ept id=\"p1\">**</ept> - available through <bpt id=\"p2\">[</bpt>ClearDB in the Azure Marketplace<ept id=\"p2\">][cdbnstore]</ept>, or you can manage your own MySQL installation on Azure Virtual Machines using either <bpt id=\"p3\">[</bpt>Windows<ept id=\"p3\">][mysqlwindows]</ept> or <bpt id=\"p4\">[</bpt>Linux<ept id=\"p4\">][mysqllinux]</ept>."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> ClearDB provides several MySQL configurations, with different performance characteristics for each configuration.",
      "pos": [
        1266,
        1392
      ]
    },
    {
      "content": "See the <bpt id=\"p1\">[</bpt>Azure Store<ept id=\"p1\">][cdbnstore]</ept> for information on offerings provided through the Azure store or <bpt id=\"p2\">[</bpt>ClearDB pricing<ept id=\"p2\">](http://www.cleardb.com/pricing.view)</ept> for offerings directly from ClearDB.",
      "pos": [
        1393,
        1582
      ]
    },
    {
      "pos": [
        1586,
        1694
      ],
      "content": "<bpt id=\"p1\">**</bpt>PHP 5.2.4 or greater<ept id=\"p1\">**</ept> - Azure App Service currently provide <bpt id=\"p2\">[</bpt>PHP versions 5.3, 5.4, and 5.5<ept id=\"p2\">][phpwebsite]</ept>."
    },
    {
      "pos": [
        1702,
        1817
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> We recommend always running on the latest version of PHP to ensure you have the latest security fixes."
    },
    {
      "content": "Basic deployment",
      "pos": [
        1822,
        1838
      ]
    },
    {
      "content": "Using just the basic requirements, you could create a basic solution within an Azure region.",
      "pos": [
        1840,
        1932
      ]
    },
    {
      "content": "an Azure web app and MySQL Database hosted in a single Azure region",
      "pos": [
        1936,
        2003
      ]
    },
    {
      "content": "While this would allow you to scale out your application by creating multiple Web Apps instances of the site, everything is hosted within the data centers in a specific geographic region.",
      "pos": [
        2021,
        2208
      ]
    },
    {
      "content": "Visitors from outside this region may see slow response times when using the site, and if the data centers in this region go down, so does your application.",
      "pos": [
        2209,
        2365
      ]
    },
    {
      "content": "Multi-region deployment",
      "pos": [
        2371,
        2394
      ]
    },
    {
      "content": "Using Azure <bpt id=\"p1\">[</bpt>Traffic Manager<ept id=\"p1\">][trafficmanager]</ept>, it's possible to scale your WordPress site across multiple geographic regions while providing only one URL for visitors.",
      "pos": [
        2396,
        2563
      ]
    },
    {
      "content": "All visitors come in through Traffic Manager and are then routed to a region based on the load balancing configuration.",
      "pos": [
        2564,
        2683
      ]
    },
    {
      "content": "an Azure web app, hosted in multiple regions, using CDBR High Availability router to route to MySQL across regions",
      "pos": [
        2687,
        2801
      ]
    },
    {
      "content": "Within each region, the WordPress site would still be scaled across multiple Web Apps instances, but this scaling is region specific; high traffic regions can be scaled differently than low traffic ones.",
      "pos": [
        2826,
        3029
      ]
    },
    {
      "pos": [
        3031,
        3199
      ],
      "content": "Replication and routing to multiple MySQL Databases can be done using ClearDB's <bpt id=\"p1\">[</bpt>CDBR High Availability Router<ept id=\"p1\">][cleardbscale]</ept> (shown left,) or <bpt id=\"p2\">[</bpt>MySQL Cluster CGE<ept id=\"p2\">][cge]</ept>."
    },
    {
      "content": "Multi-region deployment with media storage and caching",
      "pos": [
        3204,
        3258
      ]
    },
    {
      "content": "If the site will accept uploads, or host media files, use Azure Blob storage.",
      "pos": [
        3260,
        3337
      ]
    },
    {
      "content": "If you need caching, consider <bpt id=\"p1\">[</bpt>Redis cache<ept id=\"p1\">][rediscache]</ept>, <bpt id=\"p2\">[</bpt>Memcache Cloud<ept id=\"p2\">](http://azure.microsoft.com/gallery/store/garantiadata/memcached/)</ept>, <bpt id=\"p3\">[</bpt>MemCachier<ept id=\"p3\">](http://azure.microsoft.com/gallery/store/memcachier/memcachier/)</ept>, or one of the other caching offerings in the <bpt id=\"p4\">[</bpt>Azure Store<ept id=\"p4\">](http://azure.microsoft.com/gallery/store/)</ept>.",
      "pos": [
        3338,
        3660
      ]
    },
    {
      "content": "an Azure web app, hosted in multiple regions, using CDBR High Availability router for MySQL, with Managed Cache, Blob storage, and CDN",
      "pos": [
        3664,
        3798
      ]
    },
    {
      "content": "Blob storage is geo-distributed across regions by default, so you don't have to worry about replicating files across all sites.",
      "pos": [
        3822,
        3949
      ]
    },
    {
      "content": "You can be also enable the Azure <bpt id=\"p1\">[</bpt>Content Distribution Network (CDN)<ept id=\"p1\">][cdn]</ept> for Blob storage, which distributes files to end nodes closer to your visitors.",
      "pos": [
        3950,
        4104
      ]
    },
    {
      "content": "Planning",
      "pos": [
        4109,
        4117
      ]
    },
    {
      "content": "Additional requirements",
      "pos": [
        4123,
        4146
      ]
    },
    {
      "content": "To do this...",
      "pos": [
        4148,
        4161
      ]
    },
    {
      "content": "Use this...",
      "pos": [
        4164,
        4175
      ]
    },
    {
      "content": "Upload or store large files",
      "pos": [
        4215,
        4242
      ]
    },
    {
      "content": "WordPress plugin for using Blob storage",
      "pos": [
        4248,
        4287
      ]
    },
    {
      "content": "Send email",
      "pos": [
        4306,
        4316
      ]
    },
    {
      "pos": [
        4321,
        4408
      ],
      "content": "<bpt id=\"p1\">[</bpt>SendGrid<ept id=\"p1\">][storesendgrid]</ept> and the <bpt id=\"p2\">[</bpt>WordPress plugin for using SendGrid<ept id=\"p2\">][sendgridplugin]</ept>"
    },
    {
      "content": "Custom domain names",
      "pos": [
        4411,
        4430
      ]
    },
    {
      "content": "Configure a custom domain name in Azure App Service",
      "pos": [
        4436,
        4487
      ]
    },
    {
      "content": "HTTPS",
      "pos": [
        4505,
        4510
      ]
    },
    {
      "content": "Enable HTTPS for a web app in Azure App Service",
      "pos": [
        4516,
        4563
      ]
    },
    {
      "content": "Pre-production validation",
      "pos": [
        4586,
        4611
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Set up staging environments for web apps in Azure App Service<ept id=\"p1\">][staging]</ept>",
      "pos": [
        4616,
        4688
      ]
    },
    {
      "content": "Note that switching a web app from staging to production also moves the WordPress configuration.",
      "pos": [
        4692,
        4788
      ]
    },
    {
      "content": "You should ensure that all settings are updated to the requirements for your production app before switching the staged app into production.",
      "pos": [
        4789,
        4929
      ]
    },
    {
      "content": "Monitoring and troubleshooting",
      "pos": [
        4936,
        4966
      ]
    },
    {
      "pos": [
        4971,
        5091
      ],
      "content": "<bpt id=\"p1\">[</bpt>Enable diagnostics logging for web apps in Azure App Service<ept id=\"p1\">][log]</ept> and <bpt id=\"p2\">[</bpt>Monitor Web Apps in Azure App Service<ept id=\"p2\">][monitor]</ept>"
    },
    {
      "content": "Deploy your site",
      "pos": [
        5094,
        5110
      ]
    },
    {
      "content": "Deploy a web app in Azure App Service",
      "pos": [
        5116,
        5153
      ]
    },
    {
      "content": "Availability and disaster recovery",
      "pos": [
        5168,
        5202
      ]
    },
    {
      "content": "To do this...",
      "pos": [
        5204,
        5217
      ]
    },
    {
      "content": "Use this...",
      "pos": [
        5220,
        5231
      ]
    },
    {
      "pos": [
        5269,
        5319
      ],
      "content": "<bpt id=\"p1\">**</bpt>Load balance sites<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>geo-distribute sites<ept id=\"p2\">**</ept>"
    },
    {
      "content": "Route traffic with Azure Traffic Manager",
      "pos": [
        5323,
        5363
      ]
    },
    {
      "content": "Backup and restore",
      "pos": [
        5383,
        5401
      ]
    },
    {
      "pos": [
        5406,
        5508
      ],
      "content": "<bpt id=\"p1\">[</bpt>Back up a web app in Azure App Service<ept id=\"p1\">][backup]</ept> and <bpt id=\"p2\">[</bpt>Restore a web app in Azure App Service<ept id=\"p2\">][restore]</ept>"
    },
    {
      "content": "Performance",
      "pos": [
        5514,
        5525
      ]
    },
    {
      "content": "Performance in the cloud is achieved primarily through caching and scale out; however the memory, bandwidth, and other attributes of Web Apps hosting should also be taken into consideration.",
      "pos": [
        5527,
        5717
      ]
    },
    {
      "content": "To do this...",
      "pos": [
        5719,
        5732
      ]
    },
    {
      "content": "Use this...",
      "pos": [
        5735,
        5746
      ]
    },
    {
      "content": "Understand App Service instance capabilities",
      "pos": [
        5786,
        5830
      ]
    },
    {
      "content": "Pricing details, including capabilities of App Service tiers",
      "pos": [
        5837,
        5897
      ]
    },
    {
      "content": "Cache resources",
      "pos": [
        5917,
        5932
      ]
    },
    {
      "pos": [
        5937,
        6150
      ],
      "content": "<bpt id=\"p1\">[</bpt>Redis cache<ept id=\"p1\">][rediscache]</ept>, <bpt id=\"p2\">[</bpt>Memcache Cloud<ept id=\"p2\">](/gallery/store/garantiadata/memcached/)</ept>, <bpt id=\"p3\">[</bpt>MemCachier<ept id=\"p3\">](/gallery/store/memcachier/memcachier/)</ept>, or one of the other caching offerings in the <bpt id=\"p4\">[</bpt>Azure Store<ept id=\"p4\">](/gallery/store/)</ept>"
    },
    {
      "content": "Scale your application",
      "pos": [
        6153,
        6175
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Scale a web app in Azure App Service<ept id=\"p1\">][websitescale]</ept> and <bpt id=\"p2\">[</bpt>ClearDB High Availability Routing<ept id=\"p2\">][cleardbscale]</ept>.",
      "pos": [
        6180,
        6287
      ]
    },
    {
      "content": "If you choose to host and manage your own MySQL installation, you should consider <bpt id=\"p1\">[</bpt>MySQL Cluster CGE<ept id=\"p1\">][cge]</ept> for scale out",
      "pos": [
        6288,
        6408
      ]
    },
    {
      "content": "Migration",
      "pos": [
        6414,
        6423
      ]
    },
    {
      "content": "There are two methods of migrating an existing WordPress site to Azure App Service.",
      "pos": [
        6425,
        6508
      ]
    },
    {
      "pos": [
        6512,
        6702
      ],
      "content": "<bpt id=\"p1\">**</bpt><bpt id=\"p2\">[</bpt>WordPress export<ept id=\"p2\">][export]</ept><ept id=\"p1\">**</ept> - This exports the content of your blog, which can then be imported to a new WordPress site on Azure App Service using the <bpt id=\"p3\">[</bpt>WordPress importer plugin<ept id=\"p3\">][import]</ept>."
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> While this process allows you to migrate your content, it does not migrate any plugins, themes or other customizations.",
      "pos": [
        6710,
        6842
      ]
    },
    {
      "content": "These must be installed again manually.",
      "pos": [
        6843,
        6882
      ]
    },
    {
      "pos": [
        6886,
        7191
      ],
      "content": "<bpt id=\"p1\">**</bpt>Manual migration<ept id=\"p1\">**</ept> - <bpt id=\"p2\">[</bpt>Back up your site<ept id=\"p2\">][wordpressbackup]</ept> and <bpt id=\"p3\">[</bpt>database<ept id=\"p3\">][wordpressdbbackup]</ept>, then manually restore it to a web app in Azure App Service and associated MySQL database to migrate highly customized sites and avoid the tedium of manually installing plugins, themes, and other customizations."
    },
    {
      "content": "Step-by-step instructions",
      "pos": [
        7196,
        7221
      ]
    },
    {
      "content": "Create a new WordPress site",
      "pos": [
        7227,
        7254
      ]
    },
    {
      "pos": [
        7259,
        7453
      ],
      "content": "Use the <bpt id=\"p1\">[</bpt>Azure Marketplace<ept id=\"p1\">][cdbnstore]</ept> to create a MySQL database of the size you identified in the <bpt id=\"p2\">[</bpt>Architecture and planning<ept id=\"p2\">](#planning)</ept> section, in the region(s) that you will host your site."
    },
    {
      "content": "Follow the steps in <bpt id=\"p1\">[</bpt>Create a WordPress web app in Azure App Service<ept id=\"p1\">][createwordpress]</ept> to create a new WordPress web app.",
      "pos": [
        7458,
        7579
      ]
    },
    {
      "content": "When creating the web app, select <bpt id=\"p1\">**</bpt>Use an existing MySQL Database<ept id=\"p1\">**</ept> and select the database created in step 1.",
      "pos": [
        7580,
        7691
      ]
    },
    {
      "pos": [
        7693,
        7867
      ],
      "content": "If you are migrating an existing WordPress site, see <bpt id=\"p1\">[</bpt>Migrate an existing WordPress site to Azure<ept id=\"p1\">](#Migrate-an-existing-WordPress-site-to-Azure)</ept> after creating a new web app."
    },
    {
      "content": "Migrate an existing WordPress site to Azure",
      "pos": [
        7873,
        7916
      ]
    },
    {
      "pos": [
        7918,
        8033
      ],
      "content": "As mentioned in the <bpt id=\"p1\">[</bpt>Architecture and planning<ept id=\"p1\">](#planning)</ept> section, there are two ways to migrate a WordPress site."
    },
    {
      "pos": [
        8037,
        8146
      ],
      "content": "<bpt id=\"p1\">**</bpt>export and import<ept id=\"p1\">**</ept> - for sites without a lot of customization, or where you just want to move the content."
    },
    {
      "pos": [
        8150,
        8247
      ],
      "content": "<bpt id=\"p1\">**</bpt>backup and restore<ept id=\"p1\">**</ept> - for sites with a lot of customization where you want to move everything."
    },
    {
      "content": "Use one of the following sections to migrate your site.",
      "pos": [
        8249,
        8304
      ]
    },
    {
      "content": "The export and import method",
      "pos": [
        8310,
        8338
      ]
    },
    {
      "pos": [
        8343,
        8403
      ],
      "content": "Use <bpt id=\"p1\">[</bpt>WordPress export<ept id=\"p1\">][export]</ept> to export your existing site."
    },
    {
      "pos": [
        8408,
        8520
      ],
      "content": "Create a new web app using the steps in the <bpt id=\"p1\">[</bpt>Create a new WordPress site<ept id=\"p1\">](#Create-a-new-WordPress-site)</ept> section."
    },
    {
      "content": "Login to your WordPress site on Web Apps and click on <bpt id=\"p1\">**</bpt>Plugins<ept id=\"p1\">**</ept> -&gt; <bpt id=\"p2\">**</bpt>Add New<ept id=\"p2\">**</ept>.",
      "pos": [
        8525,
        8606
      ]
    },
    {
      "content": "Search for, and install, the <bpt id=\"p1\">**</bpt>WordPress Importer<ept id=\"p1\">**</ept> plugin.",
      "pos": [
        8607,
        8666
      ]
    },
    {
      "pos": [
        8671,
        8818
      ],
      "content": "After the importer plugin has been installed, click on <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> -&gt; <bpt id=\"p2\">**</bpt>Import<ept id=\"p2\">**</ept>, and then select <bpt id=\"p3\">**</bpt>WordPress<ept id=\"p3\">**</ept> to use the WordPress importer plugin."
    },
    {
      "content": "On the <bpt id=\"p1\">**</bpt>Import WordPress<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Choose File<ept id=\"p2\">**</ept>.",
      "pos": [
        8823,
        8879
      ]
    },
    {
      "content": "Browse to the WXR file exported from your existing WordPress site, and then choose <bpt id=\"p1\">**</bpt>Upload file and import<ept id=\"p1\">**</ept>.",
      "pos": [
        8880,
        8990
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Submit<ept id=\"p1\">**</ept>.",
      "pos": [
        8995,
        9012
      ]
    },
    {
      "content": "You will be prompted that the import was successful.",
      "pos": [
        9013,
        9065
      ]
    },
    {
      "pos": [
        9070,
        9194
      ],
      "content": "Once you have completed all these steps, restart your site from its web app blade in the <bpt id=\"p1\">[</bpt>Azure preview portal<ept id=\"p1\">][mgmtportal]</ept>."
    },
    {
      "content": "After importing the site, you may need to perform the following steps to enable settings not contained in the import file.",
      "pos": [
        9196,
        9318
      ]
    },
    {
      "content": "If you were using this...",
      "pos": [
        9320,
        9345
      ]
    },
    {
      "content": "Do this...",
      "pos": [
        9348,
        9358
      ]
    },
    {
      "content": "Permalinks",
      "pos": [
        9393,
        9403
      ]
    },
    {
      "pos": [
        9408,
        9531
      ],
      "content": "From the WordPress dashboard of the new site, click <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> -&gt; <bpt id=\"p2\">**</bpt>Permalinks<ept id=\"p2\">**</ept> and then update the Permalinks structure"
    },
    {
      "content": "image/media links",
      "pos": [
        9534,
        9551
      ]
    },
    {
      "pos": [
        9556,
        9699
      ],
      "content": "To update links to the new location, use the <bpt id=\"p1\">[</bpt>Velvet Blues Update URLs plugin<ept id=\"p1\">][velvet]</ept>, a search and replace tool, or manually in your database"
    },
    {
      "content": "Themes",
      "pos": [
        9702,
        9708
      ]
    },
    {
      "pos": [
        9713,
        9782
      ],
      "content": "Go to <bpt id=\"p1\">**</bpt>Appearance<ept id=\"p1\">**</ept> -&gt; <bpt id=\"p2\">**</bpt>Theme<ept id=\"p2\">**</ept> and update the site theme as needed"
    },
    {
      "content": "Menus",
      "pos": [
        9785,
        9790
      ]
    },
    {
      "content": "If your theme supports menus, links to your home page may still have the old sub-directory embedded in them.",
      "pos": [
        9795,
        9903
      ]
    },
    {
      "content": "Go to <bpt id=\"p1\">**</bpt>Appearance<ept id=\"p1\">**</ept> -&gt; <bpt id=\"p2\">**</bpt>Menus<ept id=\"p2\">**</ept> and update them",
      "pos": [
        9904,
        9953
      ]
    },
    {
      "content": "The backup and restore method",
      "pos": [
        9959,
        9988
      ]
    },
    {
      "pos": [
        9993,
        10092
      ],
      "content": "Back up your existing WordPress site using the information at <bpt id=\"p1\">[</bpt>WordPress backups<ept id=\"p1\">][wordpressbackup]</ept>."
    },
    {
      "pos": [
        10097,
        10199
      ],
      "content": "Back up your existing database using the information at <bpt id=\"p1\">[</bpt>Backing up your database<ept id=\"p1\">][wordpressdbbackup]</ept>."
    },
    {
      "content": "Create a new database and restore the backup.",
      "pos": [
        10204,
        10249
      ]
    },
    {
      "pos": [
        10258,
        10405
      ],
      "content": "Purchase a new database from the <bpt id=\"p1\">[</bpt>Azure Marketplace<ept id=\"p1\">][cdbnstore]</ept>, or setup a  MySQL database on a <bpt id=\"p2\">[</bpt>Windows<ept id=\"p2\">][mysqlwindows]</ept> or <bpt id=\"p3\">[</bpt>Linux<ept id=\"p3\">][mysqllinux]</ept> VM."
    },
    {
      "pos": [
        10414,
        10533
      ],
      "content": "Using a MySQL client like <bpt id=\"p1\">[</bpt>MySQL Workbench<ept id=\"p1\">][workbench]</ept>, connect to the new database and import your WordPress database."
    },
    {
      "content": "Update the database to change the domain entries to your new Azure App Service domain.",
      "pos": [
        10542,
        10628
      ]
    },
    {
      "content": "For example, mywordpress.azurewebsites.net.",
      "pos": [
        10629,
        10672
      ]
    },
    {
      "content": "Use the <bpt id=\"p1\">[</bpt>Search and Replace for WordPress Databases Script<ept id=\"p1\">][searchandreplace]</ept> to safely change all instances.",
      "pos": [
        10673,
        10782
      ]
    },
    {
      "content": "Create a new web app in the Azure Portal and publish the WordPress backup.",
      "pos": [
        10787,
        10861
      ]
    },
    {
      "content": "Create a new web app in the <bpt id=\"p1\">[</bpt>Azure preview portal<ept id=\"p1\">][mgmtportal]</ept> with a database using <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept> -&gt; <bpt id=\"p3\">**</bpt>Web + Mobile<ept id=\"p3\">**</ept> -&gt; <bpt id=\"p4\">**</bpt>Azure Marketplace<ept id=\"p4\">**</ept> -&gt; <bpt id=\"p5\">**</bpt>Web Apps<ept id=\"p5\">**</ept> -&gt; <bpt id=\"p6\">**</bpt>Web app + SQL<ept id=\"p6\">**</ept> (or <bpt id=\"p7\">**</bpt>Web app + MySQL<ept id=\"p7\">**</ept>) -&gt; <bpt id=\"p8\">**</bpt>Create<ept id=\"p8\">**</ept>.",
      "pos": [
        10870,
        11084
      ]
    },
    {
      "content": "Configure all the required settings to create an empty web app.",
      "pos": [
        11085,
        11148
      ]
    },
    {
      "content": "In your WordPress backup, locate the <bpt id=\"p1\">**</bpt>wp-config.php<ept id=\"p1\">**</ept> file and open it in an editor.",
      "pos": [
        11157,
        11242
      ]
    },
    {
      "content": "Replace the following entries with the information for your new MySQL database.",
      "pos": [
        11243,
        11322
      ]
    },
    {
      "pos": [
        11334,
        11377
      ],
      "content": "<bpt id=\"p1\">**</bpt>DB_NAME<ept id=\"p1\">**</ept> - the user name of the database"
    },
    {
      "pos": [
        11389,
        11444
      ],
      "content": "<bpt id=\"p1\">**</bpt>DB_USER<ept id=\"p1\">**</ept> - the user name used to access the database"
    },
    {
      "pos": [
        11456,
        11491
      ],
      "content": "<bpt id=\"p1\">**</bpt>DB_PASSWORD<ept id=\"p1\">**</ept> - the user password"
    },
    {
      "pos": [
        11501,
        11573
      ],
      "content": "After changing these entries, save and close the <bpt id=\"p1\">**</bpt>wp-config.php<ept id=\"p1\">**</ept> file."
    },
    {
      "pos": [
        11582,
        11774
      ],
      "content": "Use the <bpt id=\"p1\">[</bpt>Deploy a web app in Azure App Service<ept id=\"p1\">][deploy]</ept> information to enable the deployment method you wish to use, and then deploy your WordPress backup to your web app in Azure App Service."
    },
    {
      "content": "Once the WordPress site has been deployed, you should be able to access the new site (as an App Service web app) using the *.azurewebsite.net URL for the site.",
      "pos": [
        11779,
        11938
      ]
    },
    {
      "content": "Configure your site",
      "pos": [
        11943,
        11962
      ]
    },
    {
      "content": "After the WordPress site has been created or migrated, use the following information to improve performance or enable additional functionality.",
      "pos": [
        11964,
        12107
      ]
    },
    {
      "content": "To do this...",
      "pos": [
        12109,
        12122
      ]
    },
    {
      "content": "Use this...",
      "pos": [
        12125,
        12136
      ]
    },
    {
      "content": "Set App Service plan mode, size, and enable scaling",
      "pos": [
        12167,
        12218
      ]
    },
    {
      "content": "Scale a web app in Azure App Service",
      "pos": [
        12224,
        12260
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>Enable persistent database connections<ept id=\"p1\">**</ept>",
      "pos": [
        12276,
        12318
      ]
    },
    {
      "content": "By default, WordPress does not use persistent database connections, which may cause your connection to the database to become throttled after multiple connections.",
      "pos": [
        12322,
        12485
      ]
    },
    {
      "content": "Edit the <ph id=\"ph1\">&lt;strong&gt;</ph>wp-includes/wp-db.php<ph id=\"ph2\">&lt;/strong&gt;</ph> file.",
      "pos": [
        12504,
        12557
      ]
    },
    {
      "content": "Find the following line.",
      "pos": [
        12573,
        12597
      ]
    },
    {
      "content": "Replace the previous line with the following.",
      "pos": [
        12730,
        12775
      ]
    },
    {
      "content": "Find the following line.",
      "pos": [
        13002,
        13026
      ]
    },
    {
      "content": "Replace the above line with the following.",
      "pos": [
        13161,
        13203
      ]
    },
    {
      "content": "Save the file <ph id=\"ph1\">&lt;strong&gt;</ph>wp-includes/wp-db.php<ph id=\"ph2\">&lt;/strong&gt;</ph> file and redeploy the site.",
      "pos": [
        13329,
        13409
      ]
    },
    {
      "content": "These changes may be overwritten when WordPress is updated.",
      "pos": [
        13481,
        13540
      ]
    },
    {
      "content": "WordPress defaults to automatic updates, which can be disabled by editing the <ph id=\"ph1\">&lt;strong&gt;</ph>wp-config.php<ph id=\"ph2\">&lt;/strong&gt;</ph> file and adding <ph id=\"ph3\">&lt;code&gt;</ph><ph id=\"ph4\">define ( 'WP_AUTO_UPDATE_CORE', false );</ph><ph id=\"ph5\">&lt;/code&gt;</ph>",
      "pos": [
        13547,
        13725
      ]
    },
    {
      "content": "Another way of addressing updates would be to use a WebJob that monitors the <ph id=\"ph1\">&lt;strong&gt;</ph>wp-db.php<ph id=\"ph2\">&lt;/strong&gt;</ph> file and performs the above modifications each time the file is updated.",
      "pos": [
        13732,
        13908
      ]
    },
    {
      "content": "See <ph id=\"ph1\">&lt;a href=\"http://www.hanselman.com/blog/IntroducingWindowsAzureWebJobs.aspx\"&gt;</ph>Introduction to WebJobs<ph id=\"ph2\">&lt;/a&gt;</ph> for more information.",
      "pos": [
        13909,
        14038
      ]
    },
    {
      "content": "Improve performance",
      "pos": [
        14051,
        14070
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a href=\"http://ppe.blogs.msdn.com/b/windowsazure/archive/2013/11/18/disabling-arr-s-instance-affinity-in-windows-azure-web-sites.aspx\"&gt;</ph>Disable the ARR cookie<ph id=\"ph2\">&lt;/a&gt;</ph> - can improve performance when running WordPress on multiple Web Apps instances",
      "pos": [
        14086,
        14328
      ]
    },
    {
      "content": "Enable caching.",
      "pos": [
        14344,
        14359
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a href=\"http://msdn.microsoft.com/library/azure/dn690470.aspx\"&gt;</ph>Redis cache<ph id=\"ph2\">&lt;/a&gt;</ph> (preview) can be used with the <ph id=\"ph3\">&lt;a href=\"https://wordpress.org/plugins/redis-object-cache/\"&gt;</ph>Redis object cache WordPress plugin<ph id=\"ph4\">&lt;/a&gt;</ph>, or use one of the other caching offerings from the <ph id=\"ph5\">&lt;a href=\"/gallery/store/\"&gt;</ph>Azure Store<ph id=\"ph6\">&lt;/a&gt;</ph>",
      "pos": [
        14360,
        14664
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a href=\"http://ruslany.net/2010/03/make-wordpress-faster-on-iis-with-wincache-1-1/\"&gt;</ph>How to make WordPress faster with Wincache<ph id=\"ph2\">&lt;/a&gt;</ph> - Wincache is enabled by default for Web Apps",
      "pos": [
        14680,
        14857
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a href=\"../web-sites-scale/\"&gt;</ph>Scale a web app in Azure App Service<ph id=\"ph2\">&lt;/a&gt;</ph> and use <ph id=\"ph3\">&lt;a href=\"http://www.cleardb.com/developers/cdbr/introduction\"&gt;</ph>ClearDB High Availability Routing<ph id=\"ph4\">&lt;/a&gt;</ph> or <ph id=\"ph5\">&lt;a href=\"http://www.mysql.com/products/cluster/\"&gt;</ph>MySQL Cluster CGE<ph id=\"ph6\">&lt;/a&gt;</ph>",
      "pos": [
        14873,
        15125
      ]
    },
    {
      "content": "Use blobs for storage",
      "pos": [
        15142,
        15163
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a href=\"../storage-create-storage-account/\"&gt;</ph>Create an Azure Storage account<ph id=\"ph2\">&lt;/a&gt;</ph>",
      "pos": [
        15179,
        15259
      ]
    },
    {
      "content": "Learn how to <ph id=\"ph1\">&lt;a href=\"../cdn-how-to-use/\"&gt;</ph>Use the Content Distribution Network (CDN)<ph id=\"ph2\">&lt;/a&gt;</ph> to geo-distribute data stored in blobs.",
      "pos": [
        15275,
        15403
      ]
    },
    {
      "content": "Install and configure the <ph id=\"ph1\">&lt;a href=\"https://wordpress.org/plugins/windows-azure-storage/\"&gt;</ph>Azure Storage for WordPress plugin<ph id=\"ph2\">&lt;/a&gt;</ph>.",
      "pos": [
        15419,
        15547
      ]
    },
    {
      "content": "For detailed setup and configuration information for the plugin, see the <ph id=\"ph1\">&lt;a href=\"http://plugins.svn.wordpress.org/windows-azure-storage/trunk/UserGuide.docx\"&gt;</ph>user guide<ph id=\"ph2\">&lt;/a&gt;</ph>.",
      "pos": [
        15554,
        15728
      ]
    },
    {
      "content": "Enable email",
      "pos": [
        15746,
        15758
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a href=\"/gallery/store/sendgrid/sendgrid-azure/\"&gt;</ph>Enable SendGrid using the Azure Store<ph id=\"ph2\">&lt;/a&gt;</ph>",
      "pos": [
        15774,
        15865
      ]
    },
    {
      "content": "<ph id=\"ph1\">&lt;a href=\"http://wordpress.org/plugins/sendgrid-email-delivery-simplified/\"&gt;</ph>Install the SendGrid plugin for WordPress<ph id=\"ph2\">&lt;/a&gt;</ph>",
      "pos": [
        15881,
        16001
      ]
    },
    {
      "content": "Configure a custom domain name",
      "pos": [
        16018,
        16048
      ]
    },
    {
      "content": "Configure a custom domain name in Azure App Service",
      "pos": [
        16054,
        16105
      ]
    },
    {
      "content": "Enable HTTPS for a custom domain name",
      "pos": [
        16123,
        16160
      ]
    },
    {
      "content": "Enable HTTPS for a web app in Azure App Service",
      "pos": [
        16166,
        16213
      ]
    },
    {
      "content": "Load balance or geo-distribute your site",
      "pos": [
        16236,
        16276
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Route traffic with Azure Traffic Manager<ept id=\"p1\">][trafficmanager]</ept>.",
      "pos": [
        16281,
        16340
      ]
    },
    {
      "content": "If you are using a custom domain, see <bpt id=\"p1\">[</bpt>Configure a custom domain name in Azure App Service<ept id=\"p1\">][customdomain]</ept> for information on using Traffic Manager with custom domain names",
      "pos": [
        16341,
        16512
      ]
    },
    {
      "content": "Enable automated backups",
      "pos": [
        16515,
        16539
      ]
    },
    {
      "content": "Back up a web app in Azure App Service",
      "pos": [
        16545,
        16583
      ]
    },
    {
      "content": "Enable diagnostic logging",
      "pos": [
        16595,
        16620
      ]
    },
    {
      "content": "Enable diagnostics logging for web apps in Azure App Service",
      "pos": [
        16626,
        16686
      ]
    },
    {
      "content": "Next Steps",
      "pos": [
        16697,
        16707
      ]
    },
    {
      "content": "WordPress optimization",
      "pos": [
        16712,
        16734
      ]
    },
    {
      "content": "Convert WordPress to Multisite in Azure App Service",
      "pos": [
        16791,
        16842
      ]
    },
    {
      "content": "ClearDB upgrade wizard for Azure",
      "pos": [
        16894,
        16926
      ]
    },
    {
      "content": "Hosting WordPress in a subfolder of your web app in Azure App Service",
      "pos": [
        16976,
        17045
      ]
    },
    {
      "content": "Step-By-Step: Create a WordPress site using Azure",
      "pos": [
        17172,
        17221
      ]
    },
    {
      "content": "Host your existing WordPress blog on Azure",
      "pos": [
        17348,
        17390
      ]
    },
    {
      "content": "Enabling pretty permalinks in WordPress",
      "pos": [
        17517,
        17556
      ]
    },
    {
      "content": "How to migrate and run your WordPress blog on Azure App Service",
      "pos": [
        17658,
        17721
      ]
    },
    {
      "content": "How to run WordPress on Azure App Service for free",
      "pos": [
        17830,
        17880
      ]
    },
    {
      "content": "WordPress on Azure in 2 minutes or less",
      "pos": [
        17948,
        17987
      ]
    },
    {
      "content": "Moving a WordPress blog to Azure - Part 1: Creating a WordPress blog on Azure",
      "pos": [
        18059,
        18136
      ]
    },
    {
      "content": "Moving a WordPress blog to Azure - Part 2: Transferring your content",
      "pos": [
        18226,
        18294
      ]
    },
    {
      "content": "Moving a WordPress blog to Azure - Part 3: Setting up your custom domain",
      "pos": [
        18403,
        18475
      ]
    },
    {
      "content": "Moving a WordPress blog to Azure - Part 4: Pretty permalinks and URL Rewrite rules",
      "pos": [
        18595,
        18677
      ]
    },
    {
      "content": "Moving a WordPress blog to Azure - Part 5: Moving from a subfolder to the root",
      "pos": [
        18807,
        18885
      ]
    },
    {
      "content": "How to set up a WordPress web app in your Azure account",
      "pos": [
        19011,
        19066
      ]
    },
    {
      "content": "Propping up WordPress on Azure",
      "pos": [
        19177,
        19207
      ]
    },
    {
      "content": "Tips for WordPress on Azure",
      "pos": [
        19258,
        19285
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you want to get started with Azure App Service before signing up for an Azure account, go to <bpt id=\"p1\">[</bpt>Try App Service<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=523751)</ept>, where you can immediately create a short-lived starter web app in App Service.",
      "pos": [
        19333,
        19586
      ]
    },
    {
      "content": "No credit cards required; no commitments.",
      "pos": [
        19587,
        19628
      ]
    },
    {
      "content": "What's changed",
      "pos": [
        19633,
        19647
      ]
    },
    {
      "pos": [
        19650,
        19818
      ],
      "content": "For a guide to the change from Websites to App Service see: <bpt id=\"p1\">[</bpt>Azure App Service and Its Impact on Existing Azure Services<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529714)</ept>"
    },
    {
      "pos": [
        19821,
        19980
      ],
      "content": "For a guide to the change of the portal to the preview portal see: <bpt id=\"p1\">[</bpt>Reference for navigating the preview portal<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529715)</ept>"
    },
    {
      "content": "test",
      "pos": [
        22416,
        22420
      ]
    }
  ],
  "content": "<properties\n    pageTitle=\"Enterprise-class WordPress on Azure App Service\"\n    description=\"Learn how to host an enterprise-class WordPress site on Azure App Service\"\n    services=\"app-service\\web\"\n    documentationCenter=\"\"\n    authors=\"tfitzmac\"\n    manager=\"wpickett\"\n    editor=\"\"/>\n\n<tags\n    ms.service=\"app-service-web\"\n    ms.devlang=\"php\"\n    ms.topic=\"article\"\n    ms.tgt_pltfrm=\"na\"\n    ms.workload=\"web\"\n    ms.date=\"08/03/2015\"\n    ms.author=\"tomfitz\"/>\n\n#Enterprise-class WordPress on Azure App Service\n\nAzure App Service provides a scalable, secure and easy to use environment for mission critical, large scale [WordPress][wordpress] sites. Microsoft itself runs enterprise-class sites such as the [Office][officeblog] and [Bing][bingblog] blogs. This document shows you how you can use Azure App Service Web Apps to establish and maintain an enterprise-class, cloud-based WordPress site that can handle a large volume of visitors.\n\n## Architecture and planning\n\nA basic WordPress installation has only two requirements.\n\n* **MySQL Database** - available through [ClearDB in the Azure Marketplace][cdbnstore], or you can manage your own MySQL installation on Azure Virtual Machines using either [Windows][mysqlwindows] or [Linux][mysqllinux].\n\n    > [AZURE.NOTE] ClearDB provides several MySQL configurations, with different performance characteristics for each configuration. See the [Azure Store][cdbnstore] for information on offerings provided through the Azure store or [ClearDB pricing](http://www.cleardb.com/pricing.view) for offerings directly from ClearDB.\n\n* **PHP 5.2.4 or greater** - Azure App Service currently provide [PHP versions 5.3, 5.4, and 5.5][phpwebsite].\n\n    > [AZURE.NOTE] We recommend always running on the latest version of PHP to ensure you have the latest security fixes.\n\n###Basic deployment\n\nUsing just the basic requirements, you could create a basic solution within an Azure region.\n\n![an Azure web app and MySQL Database hosted in a single Azure region][basic-diagram]\n\nWhile this would allow you to scale out your application by creating multiple Web Apps instances of the site, everything is hosted within the data centers in a specific geographic region. Visitors from outside this region may see slow response times when using the site, and if the data centers in this region go down, so does your application.\n\n\n###Multi-region deployment\n\nUsing Azure [Traffic Manager][trafficmanager], it's possible to scale your WordPress site across multiple geographic regions while providing only one URL for visitors. All visitors come in through Traffic Manager and are then routed to a region based on the load balancing configuration.\n\n![an Azure web app, hosted in multiple regions, using CDBR High Availability router to route to MySQL across regions][multi-region-diagram]\n\nWithin each region, the WordPress site would still be scaled across multiple Web Apps instances, but this scaling is region specific; high traffic regions can be scaled differently than low traffic ones.\n\nReplication and routing to multiple MySQL Databases can be done using ClearDB's [CDBR High Availability Router][cleardbscale] (shown left,) or [MySQL Cluster CGE][cge].\n\n###Multi-region deployment with media storage and caching\n\nIf the site will accept uploads, or host media files, use Azure Blob storage. If you need caching, consider [Redis cache][rediscache], [Memcache Cloud](http://azure.microsoft.com/gallery/store/garantiadata/memcached/), [MemCachier](http://azure.microsoft.com/gallery/store/memcachier/memcachier/), or one of the other caching offerings in the [Azure Store](http://azure.microsoft.com/gallery/store/).\n\n![an Azure web app, hosted in multiple regions, using CDBR High Availability router for MySQL, with Managed Cache, Blob storage, and CDN][performance-diagram]\n\nBlob storage is geo-distributed across regions by default, so you don't have to worry about replicating files across all sites. You can be also enable the Azure [Content Distribution Network (CDN)][cdn] for Blob storage, which distributes files to end nodes closer to your visitors.\n\n###Planning\n\n####Additional requirements\n\nTo do this... | Use this...\n------------------------|-----------\n**Upload or store large files** | [WordPress plugin for using Blob storage][storageplugin]\n**Send email** | [SendGrid][storesendgrid] and the [WordPress plugin for using SendGrid][sendgridplugin]\n**Custom domain names** | [Configure a custom domain name in Azure App Service][customdomain]\n**HTTPS** | [Enable HTTPS for a web app in Azure App Service][httpscustomdomain]\n**Pre-production validation** | [Set up staging environments for web apps in Azure App Service][staging] <p>Note that switching a web app from staging to production also moves the WordPress configuration. You should ensure that all settings are updated to the requirements for your production app before switching the staged app into production.</p>\n**Monitoring and troubleshooting** | [Enable diagnostics logging for web apps in Azure App Service][log] and [Monitor Web Apps in Azure App Service][monitor]\n**Deploy your site** | [Deploy a web app in Azure App Service][deploy]\n\n####Availability and disaster recovery\n\nTo do this... | Use this...\n------------------------|-----------\n**Load balance sites** or **geo-distribute sites** | [Route traffic with Azure Traffic Manager][trafficmanager]\n**Backup and restore** | [Back up a web app in Azure App Service][backup] and [Restore a web app in Azure App Service][restore]\n\n####Performance\n\nPerformance in the cloud is achieved primarily through caching and scale out; however the memory, bandwidth, and other attributes of Web Apps hosting should also be taken into consideration.\n\nTo do this... | Use this...\n------------------------|-----------\n**Understand App Service instance capabilities** |  [Pricing details, including capabilities of App Service tiers][websitepricing]\n**Cache resources** | [Redis cache][rediscache], [Memcache Cloud](/gallery/store/garantiadata/memcached/), [MemCachier](/gallery/store/memcachier/memcachier/), or one of the other caching offerings in the [Azure Store](/gallery/store/)\n**Scale your application** | [Scale a web app in Azure App Service][websitescale] and [ClearDB High Availability Routing][cleardbscale]. If you choose to host and manage your own MySQL installation, you should consider [MySQL Cluster CGE][cge] for scale out\n\n####Migration\n\nThere are two methods of migrating an existing WordPress site to Azure App Service.\n\n* **[WordPress export][export]** - This exports the content of your blog, which can then be imported to a new WordPress site on Azure App Service using the [WordPress importer plugin][import].\n\n    > [AZURE.NOTE] While this process allows you to migrate your content, it does not migrate any plugins, themes or other customizations. These must be installed again manually.\n\n* **Manual migration** - [Back up your site][wordpressbackup] and [database][wordpressdbbackup], then manually restore it to a web app in Azure App Service and associated MySQL database to migrate highly customized sites and avoid the tedium of manually installing plugins, themes, and other customizations.\n\n## Step-by-step instructions\n\n### Create a new WordPress site\n\n1. Use the [Azure Marketplace][cdbnstore] to create a MySQL database of the size you identified in the [Architecture and planning](#planning) section, in the region(s) that you will host your site.\n\n2. Follow the steps in [Create a WordPress web app in Azure App Service][createwordpress] to create a new WordPress web app. When creating the web app, select **Use an existing MySQL Database** and select the database created in step 1.\n\nIf you are migrating an existing WordPress site, see [Migrate an existing WordPress site to Azure](#Migrate-an-existing-WordPress-site-to-Azure) after creating a new web app.\n\n### Migrate an existing WordPress site to Azure\n\nAs mentioned in the [Architecture and planning](#planning) section, there are two ways to migrate a WordPress site.\n\n* **export and import** - for sites without a lot of customization, or where you just want to move the content.\n\n* **backup and restore** - for sites with a lot of customization where you want to move everything.\n\nUse one of the following sections to migrate your site.\n\n####The export and import method\n\n1. Use [WordPress export][export] to export your existing site.\n\n2. Create a new web app using the steps in the [Create a new WordPress site](#Create-a-new-WordPress-site) section.\n\n3. Login to your WordPress site on Web Apps and click on **Plugins** -> **Add New**. Search for, and install, the **WordPress Importer** plugin.\n\n4. After the importer plugin has been installed, click on **Tools** -> **Import**, and then select **WordPress** to use the WordPress importer plugin.\n\n5. On the **Import WordPress** page, click **Choose File**. Browse to the WXR file exported from your existing WordPress site, and then choose **Upload file and import**.\n\n6. Click **Submit**. You will be prompted that the import was successful.\n\n8. Once you have completed all these steps, restart your site from its web app blade in the [Azure preview portal][mgmtportal].\n\nAfter importing the site, you may need to perform the following steps to enable settings not contained in the import file.\n\nIf you were using this... | Do this...\n------------------ | ----------\n**Permalinks** | From the WordPress dashboard of the new site, click **Settings** -> **Permalinks** and then update the Permalinks structure\n**image/media links** | To update links to the new location, use the [Velvet Blues Update URLs plugin][velvet], a search and replace tool, or manually in your database\n**Themes** | Go to **Appearance** -> **Theme** and update the site theme as needed\n**Menus** | If your theme supports menus, links to your home page may still have the old sub-directory embedded in them. Go to **Appearance** -> **Menus** and update them\n\n####The backup and restore method\n\n1. Back up your existing WordPress site using the information at [WordPress backups][wordpressbackup].\n\n2. Back up your existing database using the information at [Backing up your database][wordpressdbbackup].\n\n3. Create a new database and restore the backup.\n\n    1. Purchase a new database from the [Azure Marketplace][cdbnstore], or setup a  MySQL database on a [Windows][mysqlwindows] or [Linux][mysqllinux] VM.\n\n    2. Using a MySQL client like [MySQL Workbench][workbench], connect to the new database and import your WordPress database.\n\n    3. Update the database to change the domain entries to your new Azure App Service domain. For example, mywordpress.azurewebsites.net. Use the [Search and Replace for WordPress Databases Script][searchandreplace] to safely change all instances.\n\n4. Create a new web app in the Azure Portal and publish the WordPress backup.\n\n    1. Create a new web app in the [Azure preview portal][mgmtportal] with a database using **New** -> **Web + Mobile** -> **Azure Marketplace** -> **Web Apps** -> **Web app + SQL** (or **Web app + MySQL**) -> **Create**. Configure all the required settings to create an empty web app.\n\n    2. In your WordPress backup, locate the **wp-config.php** file and open it in an editor. Replace the following entries with the information for your new MySQL database.\n\n        * **DB_NAME** - the user name of the database\n\n        * **DB_USER** - the user name used to access the database\n\n        * **DB_PASSWORD** - the user password\n\n        After changing these entries, save and close the **wp-config.php** file.\n\n    3. Use the [Deploy a web app in Azure App Service][deploy] information to enable the deployment method you wish to use, and then deploy your WordPress backup to your web app in Azure App Service.\n\n5. Once the WordPress site has been deployed, you should be able to access the new site (as an App Service web app) using the *.azurewebsite.net URL for the site.\n\n###Configure your site\n\nAfter the WordPress site has been created or migrated, use the following information to improve performance or enable additional functionality.\n\nTo do this... | Use this...\n------------- | -----------\n**Set App Service plan mode, size, and enable scaling** | [Scale a web app in Azure App Service][websitescale]\n**Enable persistent database connections** <p>By default, WordPress does not use persistent database connections, which may cause your connection to the database to become throttled after multiple connections.</p>  | <ol><li><p>Edit the <strong>wp-includes/wp-db.php</strong> file.</p></li><li><p>Find the following line.</p><code>$this->dbh = mysql_connect( $this->dbhost, $this->dbuser, $this->dbpassword, $new_link, $client_flags );</code></li><li><p>Replace the previous line with the following.</p><code>$this->dbh = mysql_pconnect( $this->dbhost, $this->dbuser, $this->dbpassword,  $client_flags ); <br/>if ( false !== $error_reporting ) { /br/>&nbsp;&nbsp;error_reporting( $error_reporting ); <br/>} </code></li><li><p>Find the following line.</p><code>$this->dbh = @mysql_connect( $this->dbhost, $this->dbuser, $this->dbpassword, $new_link, $client_flags ); </code></li><li><p>Replace the above line with the following.</p><code>$this->dbh = @mysql_pconnect( $this->dbhost, $this->dbuser, $this->dbpassword,  $client_flags ); </code></li><li><p>Save the file <strong>wp-includes/wp-db.php</strong> file and redeploy the site.</p></li></ol><div class=\"wa-note\"><span class=\"wa-icon-bulb\"></span><p>These changes may be overwritten when WordPress is updated.</p><p>WordPress defaults to automatic updates, which can be disabled by editing the <strong>wp-config.php</strong> file and adding <code>define ( 'WP_AUTO_UPDATE_CORE', false );</code></p><p>Another way of addressing updates would be to use a WebJob that monitors the <strong>wp-db.php</strong> file and performs the above modifications each time the file is updated. See <a href=\"http://www.hanselman.com/blog/IntroducingWindowsAzureWebJobs.aspx\">Introduction to WebJobs</a> for more information.</p></div>\n**Improve performance** | <ul><li><p><a href=\"http://ppe.blogs.msdn.com/b/windowsazure/archive/2013/11/18/disabling-arr-s-instance-affinity-in-windows-azure-web-sites.aspx\">Disable the ARR cookie</a> - can improve performance when running WordPress on multiple Web Apps instances</p></li><li><p>Enable caching. <a href=\"http://msdn.microsoft.com/library/azure/dn690470.aspx\">Redis cache</a> (preview) can be used with the <a href=\"https://wordpress.org/plugins/redis-object-cache/\">Redis object cache WordPress plugin</a>, or use one of the other caching offerings from the <a href=\"/gallery/store/\">Azure Store</a></p></li><li><p><a href=\"http://ruslany.net/2010/03/make-wordpress-faster-on-iis-with-wincache-1-1/\">How to make WordPress faster with Wincache</a> - Wincache is enabled by default for Web Apps</p></li><li><p><a href=\"../web-sites-scale/\">Scale a web app in Azure App Service</a> and use <a href=\"http://www.cleardb.com/developers/cdbr/introduction\">ClearDB High Availability Routing</a> or <a href=\"http://www.mysql.com/products/cluster/\">MySQL Cluster CGE</a></p></li></ul>\n**Use blobs for storage** | <ol><li><p><a href=\"../storage-create-storage-account/\">Create an Azure Storage account</a></p></li><li><p>Learn how to <a href=\"../cdn-how-to-use/\">Use the Content Distribution Network (CDN)</a> to geo-distribute data stored in blobs.</p></li><li><p>Install and configure the <a href=\"https://wordpress.org/plugins/windows-azure-storage/\">Azure Storage for WordPress plugin</a>.</p><p>For detailed setup and configuration information for the plugin, see the <a href=\"http://plugins.svn.wordpress.org/windows-azure-storage/trunk/UserGuide.docx\">user guide</a>.</p> </li></ol>\n**Enable email** | <ol><li><p><a href=\"/gallery/store/sendgrid/sendgrid-azure/\">Enable SendGrid using the Azure Store</a></p></li><li><p><a href=\"http://wordpress.org/plugins/sendgrid-email-delivery-simplified/\">Install the SendGrid plugin for WordPress</a></p></li></ol>\n**Configure a custom domain name** | [Configure a custom domain name in Azure App Service][customdomain]\n**Enable HTTPS for a custom domain name** | [Enable HTTPS for a web app in Azure App Service][httpscustomdomain]\n**Load balance or geo-distribute your site** | [Route traffic with Azure Traffic Manager][trafficmanager]. If you are using a custom domain, see [Configure a custom domain name in Azure App Service][customdomain] for information on using Traffic Manager with custom domain names\n**Enable automated backups** | [Back up a web app in Azure App Service][backup]\n**Enable diagnostic logging** | [Enable diagnostics logging for web apps in Azure App Service][log]\n\n## Next Steps\n\n* [WordPress optimization](http://codex.wordpress.org/WordPress_Optimization)\n\n* [Convert WordPress to Multisite in Azure App Service](web-sites-php-convert-wordpress-multisite.md)\n\n* [ClearDB upgrade wizard for Azure](http://www.cleardb.com/store/azure/upgrade)\n\n* [Hosting WordPress in a subfolder of your web app in Azure App Service](http://blogs.msdn.com/b/webapps/archive/2013/02/13/hosting-wordpress-in-a-subfolder-of-your-windows-azure-web-site.aspx)\n\n* [Step-By-Step: Create a WordPress site using Azure](http://blogs.technet.com/b/blainbar/archive/2013/08/07/article-create-a-wordpress-site-using-windows-azure-read-on.aspx)\n\n* [Host your existing WordPress blog on Azure](http://blogs.msdn.com/b/msgulfcommunity/archive/2013/08/26/migrating-a-self-hosted-wordpress-blog-to-windows-azure.aspx)\n\n* [Enabling pretty permalinks in WordPress](http://www.iis.net/learn/extensions/url-rewrite-module/enabling-pretty-permalinks-in-wordpress)\n\n* [How to migrate and run your WordPress blog on Azure App Service](http://www.kefalidis.me/2012/06/how-to-migrate-and-run-your-wordpress-blog-on-windows-azure-websites/)\n\n* [How to run WordPress on Azure App Service for free](http://architects.dzone.com/articles/how-run-wordpress-azure)\n\n* [WordPress on Azure in 2 minutes or less](http://www.sitepoint.com/wordpress-windows-azure-2-minutes-less/)\n\n* [Moving a WordPress blog to Azure - Part 1: Creating a WordPress blog on Azure](http://www.davebost.com/2013/07/10/moving-a-wordpress-blog-to-windows-azure-part-1)\n\n* [Moving a WordPress blog to Azure - Part 2: Transferring your content](http://www.davebost.com/2013/07/11/moving-a-wordpress-blog-to-windows-azure-transferring-your-content)\n\n* [Moving a WordPress blog to Azure - Part 3: Setting up your custom domain](http://www.davebost.com/2013/07/11/moving-a-wordpress-blog-to-windows-azure-part-3-setting-up-your-custom-domain)\n\n* [Moving a WordPress blog to Azure - Part 4: Pretty permalinks and URL Rewrite rules](http://www.davebost.com/2013/07/11/moving-a-wordpress-blog-to-windows-azure-part-4-pretty-permalinks-and-url-rewrite-rules)\n\n* [Moving a WordPress blog to Azure - Part 5: Moving from a subfolder to the root](http://www.davebost.com/2013/07/11/moving-a-wordpress-blog-to-windows-azure-part-5-moving-from-a-subfolder-to-the-root)\n\n* [How to set up a WordPress web app in your Azure account](http://www.itexperience.net/2014/01/20/how-to-set-up-a-wordpress-website-in-your-windows-azure-account/)\n\n* [Propping up WordPress on Azure](http://www.johnpapa.net/wordpress-on-azure/)\n\n* [Tips for WordPress on Azure](http://www.johnpapa.net/azurecleardbmysql/)\n\n>[AZURE.NOTE] If you want to get started with Azure App Service before signing up for an Azure account, go to [Try App Service](http://go.microsoft.com/fwlink/?LinkId=523751), where you can immediately create a short-lived starter web app in App Service. No credit cards required; no commitments.\n\n## What's changed\n* For a guide to the change from Websites to App Service see: [Azure App Service and Its Impact on Existing Azure Services](http://go.microsoft.com/fwlink/?LinkId=529714)\n* For a guide to the change of the portal to the preview portal see: [Reference for navigating the preview portal](http://go.microsoft.com/fwlink/?LinkId=529715)\n\n[performance-diagram]: ./media/web-sites-php-enterprise-wordpress/performance-diagram.png\n[basic-diagram]: ./media/web-sites-php-enterprise-wordpress/basic-diagram.png\n[multi-region-diagram]: ./media/web-sites-php-enterprise-wordpress/multi-region-diagram.png\n[wordpress]: http://www.microsoft.com/web/wordpress\n[officeblog]: http://blogs.office.com/\n[bingblog]: http://blogs.bing.com/\n[cdbnstore]: http://www.cleardb.com/store/azure\n[storageplugin]: https://wordpress.org/plugins/windows-azure-storage/\n[sendgridplugin]: http://wordpress.org/plugins/sendgrid-email-delivery-simplified/\n[phpwebsite]: web-sites-php-configure.md\n[customdomain]: web-sites-custom-domain-name.md\n[trafficmanager]: /blog/2014/03/27/azure-traffic-manager-can-now-integrate-with-azure-web-sites/\n[backup]: web-sites-backup.md\n[restore]: web-sites-restore.md\n[rediscache]: http://msdn.microsoft.com/library/azure/dn690470.aspx\n[managedcache]: http://msdn.microsoft.com/library/azure/dn386122.aspx\n[websitescale]: web-sites-scale.md\n[managedcachescale]: http://msdn.microsoft.com/library/azure/dn386113.aspx\n[cleardbscale]: http://www.cleardb.com/developers/cdbr/introduction\n[staging]: web-sites-staged-publishing.md\n[monitor]: web-sites-monitor.md\n[log]: web-sites-enable-diagnostic-log.md\n[httpscustomdomain]: web-sites-configure-ssl-certificate.md\n[mysqlwindows]: ../virtual-machines-mysql-windows-server-2008r2.md\n[mysqllinux]: ../virtual-machines-linux-mysql-use-opensuse.md\n[cge]: http://www.mysql.com/products/cluster/\n[websitepricing]: /pricing/details/app-service/\n[export]: http://en.support.wordpress.com/export/\n[import]: http://wordpress.org/plugins/wordpress-importer/\n[wordpressbackup]: http://wordpress.org/plugins/wordpress-importer/\n[wordpressdbbackup]: http://codex.wordpress.org/Backing_Up_Your_Database\n[createwordpress]: web-sites-php-web-site-gallery.md\n[velvet]: https://wordpress.org/plugins/velvet-blues-update-urls/\n[mgmtportal]: https://portal.azure.com/\n[wordpressbackup]: http://codex.wordpress.org/WordPress_Backups\n[wordpressdbbackup]: http://codex.wordpress.org/Backing_Up_Your_Database\n[workbench]: http://www.mysql.com/products/workbench/\n[searchandreplace]: http://interconnectit.com/124/search-and-replace-for-wordpress-databases/\n[deploy]: web-sites-deploy.md\n[posh]: ../install-configure-powershell.md\n[Azure CLI]: ../xplat-cli.md\n[storesendgrid]: /gallery/store/sendgrid/sendgrid-azure/\n[cdn]: ../cdn-how-to-use.md\n \n\ntest\n"
}