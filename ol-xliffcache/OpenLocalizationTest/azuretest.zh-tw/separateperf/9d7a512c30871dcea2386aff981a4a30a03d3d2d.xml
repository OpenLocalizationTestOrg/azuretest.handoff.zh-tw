{
  "nodes": [
    {
      "content": "How to use Table storage from Java | Microsoft Azure",
      "pos": [
        28,
        80
      ]
    },
    {
      "content": "Learn how to use the table storage service in Azure.",
      "pos": [
        100,
        152
      ]
    },
    {
      "content": "Code samples are written in Java code.",
      "pos": [
        153,
        191
      ]
    },
    {
      "content": "How to use Table storage from Java",
      "pos": [
        507,
        541
      ]
    },
    {
      "content": "Overview",
      "pos": [
        646,
        654
      ]
    },
    {
      "content": "This guide will show you how to perform common scenarios using the Azure Table storage service.",
      "pos": [
        656,
        751
      ]
    },
    {
      "content": "The samples are written in Java and use the <bpt id=\"p1\">[</bpt>Azure Storage SDK for Java<ept id=\"p1\">][]</ept>.",
      "pos": [
        752,
        827
      ]
    },
    {
      "content": "The scenarios covered include <bpt id=\"p1\">**</bpt>creating<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>listing<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>deleting<ept id=\"p3\">**</ept> tables, as well as <bpt id=\"p4\">**</bpt>inserting<ept id=\"p4\">**</ept>, <bpt id=\"p5\">**</bpt>querying<ept id=\"p5\">**</ept>, <bpt id=\"p6\">**</bpt>modifying<ept id=\"p6\">**</ept>, and <bpt id=\"p7\">**</bpt>deleting<ept id=\"p7\">**</ept> entities in a table.",
      "pos": [
        828,
        1002
      ]
    },
    {
      "content": "For more information on tables, see the <bpt id=\"p1\">[</bpt>Next steps<ept id=\"p1\">](#NextSteps)</ept> section.",
      "pos": [
        1003,
        1076
      ]
    },
    {
      "content": "Note: An SDK is available for developers who are using Azure Storage on Android devices.",
      "pos": [
        1078,
        1166
      ]
    },
    {
      "content": "For more information, see the <bpt id=\"p1\">[</bpt>Azure Storage SDK for Android<ept id=\"p1\">][]</ept>.",
      "pos": [
        1167,
        1231
      ]
    },
    {
      "content": "Create a Java application",
      "pos": [
        1437,
        1462
      ]
    },
    {
      "content": "In this guide, you will use storage features which can be run within a Java application locally, or in code running within a web role or worker role in Azure.",
      "pos": [
        1464,
        1622
      ]
    },
    {
      "content": "To do so, you will need to install the Java Development Kit (JDK) and create an Azure storage account in your Azure subscription.",
      "pos": [
        1624,
        1753
      ]
    },
    {
      "content": "Once you have done so, you will need to verify that your development system meets the minimum requirements and dependencies which are listed in the <bpt id=\"p1\">[</bpt>Azure Storage SDK for Java<ept id=\"p1\">][]</ept> repository on GitHub.",
      "pos": [
        1754,
        1954
      ]
    },
    {
      "content": "If your system meets those requirements, you can follow the instructions for downloading and installing the Azure Storage Libraries for Java on your system from that repository.",
      "pos": [
        1955,
        2132
      ]
    },
    {
      "content": "Once you have completed those tasks, you will be able to create a Java application which uses the examples in this article.",
      "pos": [
        2133,
        2256
      ]
    },
    {
      "content": "Configure your application to access table storage",
      "pos": [
        2261,
        2311
      ]
    },
    {
      "content": "Add the following import statements to the top of the Java file where you want to use Microsoft Azure storage APIs to access tables:",
      "pos": [
        2313,
        2445
      ]
    },
    {
      "content": "Setup an Azure storage connection string",
      "pos": [
        2655,
        2695
      ]
    },
    {
      "content": "An Azure storage client uses a storage connection string to store endpoints and credentials for accessing data management services.",
      "pos": [
        2697,
        2828
      ]
    },
    {
      "content": "When running in a client application, you must provide the storage connection string in the following format, using the name of your storage account and the Primary access key for the storage account listed in the Management Portal for the <bpt id=\"p1\">*</bpt>AccountName<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>AccountKey<ept id=\"p2\">*</ept> values.",
      "pos": [
        2829,
        3107
      ]
    },
    {
      "content": "This example shows how you can declare a static field to hold the connection string:",
      "pos": [
        3108,
        3192
      ]
    },
    {
      "content": "In an application running within a role in Microsoft Azure, this string can be stored in the service configuration file, <bpt id=\"p1\">*</bpt>ServiceConfiguration.cscfg<ept id=\"p1\">*</ept>, and can be accessed with a call to the <bpt id=\"p2\">**</bpt>RoleEnvironment.getConfigurationSettings<ept id=\"p2\">**</ept> method.",
      "pos": [
        3445,
        3687
      ]
    },
    {
      "content": "Here's an example of getting the connection string from a <bpt id=\"p1\">**</bpt>Setting<ept id=\"p1\">**</ept> element named <bpt id=\"p2\">*</bpt>StorageConnectionString<ept id=\"p2\">*</ept> in the service configuration file:",
      "pos": [
        3688,
        3832
      ]
    },
    {
      "content": "The following samples assume that you have used one of these two methods to get the storage connection string.",
      "pos": [
        4012,
        4122
      ]
    },
    {
      "content": "How to: Create a table",
      "pos": [
        4127,
        4149
      ]
    },
    {
      "content": "A <bpt id=\"p1\">**</bpt>CloudTableClient<ept id=\"p1\">**</ept> object lets you get reference objects for tables",
      "pos": [
        4151,
        4222
      ]
    },
    {
      "content": "and entities.",
      "pos": [
        4223,
        4236
      ]
    },
    {
      "content": "The following code creates a <bpt id=\"p1\">**</bpt>CloudTableClient<ept id=\"p1\">**</ept> object",
      "pos": [
        4237,
        4293
      ]
    },
    {
      "content": "and uses it to create a new <bpt id=\"p1\">**</bpt>CloudTable<ept id=\"p1\">**</ept> object which represents a table named \"people\".",
      "pos": [
        4294,
        4384
      ]
    },
    {
      "content": "(Note: There are additional ways to create <bpt id=\"p1\">**</bpt>CloudStorageAccount<ept id=\"p1\">**</ept> objects; for more information, see <bpt id=\"p2\">**</bpt>CloudStorageAccount<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">[</bpt><ept id=\"p3\">Azure Storage Client SDK Reference]</ept>.)",
      "pos": [
        4385,
        4556
      ]
    },
    {
      "content": "How to: List the tables",
      "pos": [
        5159,
        5182
      ]
    },
    {
      "pos": [
        5184,
        5303
      ],
      "content": "To get a list of tables, call the <bpt id=\"p1\">**</bpt>CloudTableClient.listTables()<ept id=\"p1\">**</ept> method to retrieve an iterable list of table names."
    },
    {
      "content": "How to: Add an entity to a table",
      "pos": [
        5917,
        5949
      ]
    },
    {
      "content": "Entities map to Java objects using a custom class implementing <bpt id=\"p1\">**</bpt>TableEntity<ept id=\"p1\">**</ept>.",
      "pos": [
        5951,
        6030
      ]
    },
    {
      "content": "For convenience, the <bpt id=\"p1\">**</bpt>TableServiceEntity<ept id=\"p1\">**</ept> class implements <bpt id=\"p2\">**</bpt>TableEntity<ept id=\"p2\">**</ept> and uses reflection to map properties to getter and setter methods named for the properties.",
      "pos": [
        6031,
        6200
      ]
    },
    {
      "content": "To add an entity to a table, first create a class that defines the properties of your entity.",
      "pos": [
        6201,
        6294
      ]
    },
    {
      "content": "The following code defines an entity class which uses the customer's first name as the row key, and last name as the partition key.",
      "pos": [
        6295,
        6426
      ]
    },
    {
      "content": "Together, an entity's partition and row key uniquely identify the entity in the table.",
      "pos": [
        6427,
        6513
      ]
    },
    {
      "content": "Entities with the same partition key can be queried faster than those with different partition keys.",
      "pos": [
        6514,
        6614
      ]
    },
    {
      "content": "Table operations involving entities require a <bpt id=\"p1\">**</bpt>TableOperation<ept id=\"p1\">**</ept> object.",
      "pos": [
        7326,
        7398
      ]
    },
    {
      "content": "This object defines the operation to be performed on an entity, which can be executed with a <bpt id=\"p1\">**</bpt>CloudTable<ept id=\"p1\">**</ept> object.",
      "pos": [
        7399,
        7514
      ]
    },
    {
      "content": "The following code creates a new instance of the <bpt id=\"p1\">**</bpt>CustomerEntity<ept id=\"p1\">**</ept> class with some customer data to be stored.",
      "pos": [
        7515,
        7626
      ]
    },
    {
      "content": "The code next calls <bpt id=\"p1\">**</bpt>TableOperation.insertOrReplace<ept id=\"p1\">**</ept> to create a <bpt id=\"p2\">**</bpt>TableOperation<ept id=\"p2\">**</ept> object to insert an entity into a table, and associates the new <bpt id=\"p3\">**</bpt>CustomerEntity<ept id=\"p3\">**</ept> with it.",
      "pos": [
        7627,
        7804
      ]
    },
    {
      "content": "Finally, the code calls the <bpt id=\"p1\">**</bpt>execute<ept id=\"p1\">**</ept> method on the <bpt id=\"p2\">**</bpt>CloudTable<ept id=\"p2\">**</ept> object, specifying the \"people\" table and the new <bpt id=\"p3\">**</bpt>TableOperation<ept id=\"p3\">**</ept>, which then sends a request to the storage service to insert the new customer entity into the \"people\" table, or replace the entity if it already exists.",
      "pos": [
        7805,
        8096
      ]
    },
    {
      "content": "How to: Insert a batch of entities",
      "pos": [
        9147,
        9181
      ]
    },
    {
      "content": "You can insert a batch of entities to the table service in one write operation.",
      "pos": [
        9183,
        9262
      ]
    },
    {
      "content": "The following code creates a <bpt id=\"p1\">**</bpt>TableBatchOperation<ept id=\"p1\">**</ept> object, then adds three insert operations to it.",
      "pos": [
        9263,
        9364
      ]
    },
    {
      "content": "Each insert operation is added by creating a new entity object, setting its values, and then calling the <bpt id=\"p1\">**</bpt>insert<ept id=\"p1\">**</ept> method on the <bpt id=\"p2\">**</bpt>TableBatchOperation<ept id=\"p2\">**</ept> object to associate the entity with a new insert operation.",
      "pos": [
        9365,
        9578
      ]
    },
    {
      "content": "Then the code calls <bpt id=\"p1\">**</bpt>execute<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>CloudTable<ept id=\"p2\">**</ept> object, specifying the \"people\" table and the <bpt id=\"p3\">**</bpt>TableBatchOperation<ept id=\"p3\">**</ept> object, which sends the batch of table operations to the storage service in a single request.",
      "pos": [
        9579,
        9796
      ]
    },
    {
      "content": "Some things to note on batch operations:",
      "pos": [
        11388,
        11428
      ]
    },
    {
      "content": "You can perform up to 100 insert, delete, merge, replace, insert or merge, and insert or replace operations in any combination in a single batch.",
      "pos": [
        11432,
        11577
      ]
    },
    {
      "content": "A batch operation can have a retrieve operation, if it is the only operation in the batch.",
      "pos": [
        11580,
        11670
      ]
    },
    {
      "content": "All entities in a single batch operation must have the same partition key.",
      "pos": [
        11673,
        11747
      ]
    },
    {
      "content": "A batch operation is limited to a 4MB data payload.",
      "pos": [
        11750,
        11801
      ]
    },
    {
      "content": "How to: Retrieve all entities in a partition",
      "pos": [
        11806,
        11850
      ]
    },
    {
      "content": "To query a table for entities in a partition, you can use a <bpt id=\"p1\">**</bpt>TableQuery<ept id=\"p1\">**</ept>.",
      "pos": [
        11852,
        11927
      ]
    },
    {
      "content": "Call <bpt id=\"p1\">**</bpt>TableQuery.from<ept id=\"p1\">**</ept> to create a query on a particular table that returns a specified result type.",
      "pos": [
        11928,
        12030
      ]
    },
    {
      "content": "The following code specifies a filter for entities where 'Smith' is the partition key.",
      "pos": [
        12031,
        12117
      ]
    },
    {
      "content": "<bpt id=\"p1\">**</bpt>TableQuery.generateFilterCondition<ept id=\"p1\">**</ept> is a helper method to create filters for queries.",
      "pos": [
        12118,
        12206
      ]
    },
    {
      "content": "Call <bpt id=\"p1\">**</bpt>where<ept id=\"p1\">**</ept> on the reference returned by the <bpt id=\"p2\">**</bpt>TableQuery.from<ept id=\"p2\">**</ept> method to apply the filter to the query.",
      "pos": [
        12207,
        12315
      ]
    },
    {
      "content": "When the query is executed with a call to <bpt id=\"p1\">**</bpt>execute<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>CloudTable<ept id=\"p2\">**</ept> object, it returns an <bpt id=\"p3\">**</bpt>Iterator<ept id=\"p3\">**</ept> with the <bpt id=\"p4\">**</bpt>CustomerEntity<ept id=\"p4\">**</ept> result type specified.",
      "pos": [
        12316,
        12477
      ]
    },
    {
      "content": "You can then use the <bpt id=\"p1\">**</bpt>Iterator<ept id=\"p1\">**</ept> returned in a for each loop to consume the results.",
      "pos": [
        12478,
        12563
      ]
    },
    {
      "content": "This code prints the fields of each entity in the query results to the console.",
      "pos": [
        12564,
        12643
      ]
    },
    {
      "content": "How to: Retrieve a range of entities in a partition",
      "pos": [
        14174,
        14225
      ]
    },
    {
      "content": "If you don't want to query all the entities in a partition, you can specify a range by using comparison operators in a filter.",
      "pos": [
        14227,
        14353
      ]
    },
    {
      "content": "The following code combines two filters to get all entities in partition \"Smith\" where the row key (first name) starts with a letter up to 'E' in the alphabet.",
      "pos": [
        14354,
        14513
      ]
    },
    {
      "content": "Then it prints the query results.",
      "pos": [
        14514,
        14547
      ]
    },
    {
      "content": "If you use the entities added to the table in the batch insert section of this guide, only two entities are returned this time (Ben and Denise Smith); Jeff Smith is not included.",
      "pos": [
        14548,
        14726
      ]
    },
    {
      "content": "How to: Retrieve a single entity",
      "pos": [
        16697,
        16729
      ]
    },
    {
      "content": "You can write a query to retrieve a single, specific entity.",
      "pos": [
        16731,
        16791
      ]
    },
    {
      "content": "The following code calls <bpt id=\"p1\">**</bpt>TableOperation.retrieve<ept id=\"p1\">**</ept> with partition key and row key parameters to specify the customer \"Jeff Smith\", instead of creating a <bpt id=\"p2\">**</bpt>TableQuery<ept id=\"p2\">**</ept> and using filters to do the same thing.",
      "pos": [
        16792,
        17001
      ]
    },
    {
      "content": "When executed, the retrieve operation returns just one entity, rather than a collection.",
      "pos": [
        17002,
        17090
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>getResultAsType<ept id=\"p1\">**</ept> method casts the result to the type of the assignment target, a <bpt id=\"p2\">**</bpt>CustomerEntity<ept id=\"p2\">**</ept> object.",
      "pos": [
        17091,
        17205
      ]
    },
    {
      "content": "If this type is not compatible with the type specified for the query, an exception will be thrown.",
      "pos": [
        17206,
        17304
      ]
    },
    {
      "content": "A null value is returned if no entity has an exact partition and row key match.",
      "pos": [
        17305,
        17384
      ]
    },
    {
      "content": "Specifying both partition and row keys in a query is the fastest way to retrieve a single entity from the Table service.",
      "pos": [
        17385,
        17505
      ]
    },
    {
      "content": "How to: Modify an entity",
      "pos": [
        18760,
        18784
      ]
    },
    {
      "content": "To modify an entity, retrieve it from the table service, make changes to the entity object, and save the changes back to the table service with a replace or merge operation.",
      "pos": [
        18786,
        18959
      ]
    },
    {
      "content": "The following code changes an existing customer's phone number.",
      "pos": [
        18960,
        19023
      ]
    },
    {
      "content": "Instead of calling <bpt id=\"p1\">**</bpt>TableOperation.insert<ept id=\"p1\">**</ept> like we did to insert, this code calls <bpt id=\"p2\">**</bpt>TableOperation.replace<ept id=\"p2\">**</ept>.",
      "pos": [
        19024,
        19135
      ]
    },
    {
      "content": "The <bpt id=\"p1\">**</bpt>CloudTable.execute<ept id=\"p1\">**</ept> method calls the table service, and the entity is replaced, unless another application changed it in the time since this application retrieved it.",
      "pos": [
        19136,
        19309
      ]
    },
    {
      "content": "When that happens, an exception is thrown, and the entity must be retrieved, modified, and saved again.",
      "pos": [
        19310,
        19413
      ]
    },
    {
      "content": "This optimistic concurrency retry pattern is common in a distributed storage system.",
      "pos": [
        19414,
        19498
      ]
    },
    {
      "content": "How to: Query a subset of entity properties",
      "pos": [
        20758,
        20801
      ]
    },
    {
      "content": "A query to a table can retrieve just a few properties from an entity.",
      "pos": [
        20803,
        20872
      ]
    },
    {
      "content": "This technique, called projection, reduces bandwidth and can improve query performance, especially for large entities.",
      "pos": [
        20873,
        20991
      ]
    },
    {
      "content": "The query in the following code uses the <bpt id=\"p1\">**</bpt>select<ept id=\"p1\">**</ept> method to return only the email addresses of entities in the table.",
      "pos": [
        20992,
        21111
      ]
    },
    {
      "content": "The results are projected into a collection of <bpt id=\"p1\">**</bpt>String<ept id=\"p1\">**</ept> with the help of an <bpt id=\"p2\">**</bpt>EntityResolver<ept id=\"p2\">**</ept>, which does the type conversion on the entities returned from the server.",
      "pos": [
        21112,
        21282
      ]
    },
    {
      "content": "You can learn more about projection in this <bpt id=\"p1\">[</bpt>blog post<ept id=\"p1\">][]</ept>.",
      "pos": [
        21283,
        21341
      ]
    },
    {
      "content": "Note that projection is not supported on the local storage emulator, so this code runs only when using an account on the table service.",
      "pos": [
        21342,
        21477
      ]
    },
    {
      "content": "How to: Insert or Replace an entity",
      "pos": [
        22892,
        22927
      ]
    },
    {
      "content": "Often you want to add an entity to a table without knowing if it already exists in the table.",
      "pos": [
        22929,
        23022
      ]
    },
    {
      "content": "An insert-or-replace operation allows you to make a single request which will insert the entity if it does not exist or replace the existing one if it does.",
      "pos": [
        23023,
        23179
      ]
    },
    {
      "content": "Building on prior examples, the following code inserts or replaces the entity for \"Walter Harp\".",
      "pos": [
        23180,
        23276
      ]
    },
    {
      "content": "After creating a new entity, this code calls the <bpt id=\"p1\">**</bpt>TableOperation.insertOrReplace<ept id=\"p1\">**</ept> method.",
      "pos": [
        23277,
        23368
      ]
    },
    {
      "content": "This code then calls <bpt id=\"p1\">**</bpt>execute<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>CloudTable<ept id=\"p2\">**</ept> object with the table and the insert or replace table operation as the parameters.",
      "pos": [
        23369,
        23506
      ]
    },
    {
      "content": "To update only part of an entity, the <bpt id=\"p1\">**</bpt>TableOperation.insertOrMerge<ept id=\"p1\">**</ept> method can be used instead.",
      "pos": [
        23507,
        23605
      ]
    },
    {
      "content": "Note that insert-or-replace is not supported on the local storage emulator, so this code runs only when using an account on the table service.",
      "pos": [
        23606,
        23748
      ]
    },
    {
      "content": "You can learn more about insert-or-replace and insert-or-merge in this <bpt id=\"p1\">[</bpt>blog post<ept id=\"p1\">][]</ept>.",
      "pos": [
        23749,
        23834
      ]
    },
    {
      "content": "How to: Delete an entity",
      "pos": [
        24850,
        24874
      ]
    },
    {
      "content": "You can easily delete an entity after you have retrieved it.",
      "pos": [
        24876,
        24936
      ]
    },
    {
      "content": "Once the entity is retrieved, call <bpt id=\"p1\">**</bpt>TableOperation.delete<ept id=\"p1\">**</ept> with the entity to delete.",
      "pos": [
        24937,
        25024
      ]
    },
    {
      "content": "Then call <bpt id=\"p1\">**</bpt>execute<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>CloudTable<ept id=\"p2\">**</ept> object.",
      "pos": [
        25025,
        25076
      ]
    },
    {
      "content": "The following code retrieves and deletes a customer entity.",
      "pos": [
        25077,
        25136
      ]
    },
    {
      "content": "How to: Delete a table",
      "pos": [
        26328,
        26350
      ]
    },
    {
      "content": "Finally, the following code deletes a table from a storage account.",
      "pos": [
        26352,
        26419
      ]
    },
    {
      "content": "A table which has been deleted will be unavailable to be recreated for a period of time following the deletion, usually less than forty seconds.",
      "pos": [
        26420,
        26564
      ]
    },
    {
      "content": "Next steps",
      "pos": [
        27143,
        27153
      ]
    },
    {
      "content": "Now that you've learned the basics of table storage, follow these links to learn how to do more complex storage tasks.",
      "pos": [
        27155,
        27273
      ]
    },
    {
      "content": "Azure Storage SDK for Java",
      "pos": [
        27278,
        27304
      ]
    },
    {
      "content": "Azure Storage Client SDK Reference",
      "pos": [
        27311,
        27345
      ]
    },
    {
      "content": "Azure Storage REST API",
      "pos": [
        27352,
        27374
      ]
    },
    {
      "content": "Azure Storage Team Blog",
      "pos": [
        27381,
        27404
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"How to use Table storage from Java | Microsoft Azure\" \n    description=\"Learn how to use the table storage service in Azure. Code samples are written in Java code.\" \n    services=\"storage\" \n    documentationCenter=\"java\" \n    authors=\"rmcmurray\" \n    manager=\"wpickett\" \n    editor=\"jimbe\"/>\n\n<tags \n    ms.service=\"storage\" \n    ms.workload=\"storage\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"Java\" \n    ms.topic=\"article\" \n    ms.date=\"08/31/2015\" \n    ms.author=\"robmcm\"/>\n\n\n# How to use Table storage from Java\n\n[AZURE.INCLUDE [storage-selector-table-include](../../includes/storage-selector-table-include.md)]\n\n## Overview\n\nThis guide will show you how to perform common scenarios using the Azure Table storage service. The samples are written in Java and use the [Azure Storage SDK for Java][]. The scenarios covered include **creating**, **listing**, and **deleting** tables, as well as **inserting**, **querying**, **modifying**, and **deleting** entities in a table. For more information on tables, see the [Next steps](#NextSteps) section.\n\nNote: An SDK is available for developers who are using Azure Storage on Android devices. For more information, see the [Azure Storage SDK for Android][]. \n\n[AZURE.INCLUDE [storage-table-concepts-include](../../includes/storage-table-concepts-include.md)]\n\n[AZURE.INCLUDE [storage-create-account-include](../../includes/storage-create-account-include.md)]\n\n## Create a Java application\n\nIn this guide, you will use storage features which can be run within a Java application locally, or in code running within a web role or worker role in Azure.\n\nTo do so, you will need to install the Java Development Kit (JDK) and create an Azure storage account in your Azure subscription. Once you have done so, you will need to verify that your development system meets the minimum requirements and dependencies which are listed in the [Azure Storage SDK for Java][] repository on GitHub. If your system meets those requirements, you can follow the instructions for downloading and installing the Azure Storage Libraries for Java on your system from that repository. Once you have completed those tasks, you will be able to create a Java application which uses the examples in this article.\n\n## Configure your application to access table storage\n\nAdd the following import statements to the top of the Java file where you want to use Microsoft Azure storage APIs to access tables:\n\n    // Include the following imports to use table APIs\n    import com.microsoft.azure.storage.*;\n    import com.microsoft.azure.storage.table.*;\n    import com.microsoft.azure.storage.table.TableQuery.*;\n\n## Setup an Azure storage connection string\n\nAn Azure storage client uses a storage connection string to store endpoints and credentials for accessing data management services. When running in a client application, you must provide the storage connection string in the following format, using the name of your storage account and the Primary access key for the storage account listed in the Management Portal for the *AccountName* and *AccountKey* values. This example shows how you can declare a static field to hold the connection string:\n\n    // Define the connection-string with your values.\n    public static final String storageConnectionString = \n        \"DefaultEndpointsProtocol=http;\" + \n        \"AccountName=your_storage_account;\" + \n        \"AccountKey=your_storage_account_key\";\n\nIn an application running within a role in Microsoft Azure, this string can be stored in the service configuration file, *ServiceConfiguration.cscfg*, and can be accessed with a call to the **RoleEnvironment.getConfigurationSettings** method. Here's an example of getting the connection string from a **Setting** element named *StorageConnectionString* in the service configuration file:\n\n    // Retrieve storage account from connection-string.\n    String storageConnectionString = \n        RoleEnvironment.getConfigurationSettings().get(\"StorageConnectionString\");\n\nThe following samples assume that you have used one of these two methods to get the storage connection string.\n\n## How to: Create a table\n\nA **CloudTableClient** object lets you get reference objects for tables\nand entities. The following code creates a **CloudTableClient** object\nand uses it to create a new **CloudTable** object which represents a table named \"people\". (Note: There are additional ways to create **CloudStorageAccount** objects; for more information, see **CloudStorageAccount** in the [Azure Storage Client SDK Reference].)\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n           CloudStorageAccount.parse(storageConnectionString);\n\n       // Create the table client.\n       CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n       // Create the table if it doesn't exist.\n       String tableName = \"people\";\n       CloudTable cloudTable = new CloudTable(tableName,tableClient);\n       cloudTable.createIfNotExists();\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: List the tables\n\nTo get a list of tables, call the **CloudTableClient.listTables()** method to retrieve an iterable list of table names.\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n           CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n        // Loop through the collection of table names.\n        for (String table : tableClient.listTables())\n        {\n          // Output each table name.\n          System.out.println(table);\n       }\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: Add an entity to a table\n\nEntities map to Java objects using a custom class implementing **TableEntity**. For convenience, the **TableServiceEntity** class implements **TableEntity** and uses reflection to map properties to getter and setter methods named for the properties. To add an entity to a table, first create a class that defines the properties of your entity. The following code defines an entity class which uses the customer's first name as the row key, and last name as the partition key. Together, an entity's partition and row key uniquely identify the entity in the table. Entities with the same partition key can be queried faster than those with different partition keys.\n\n    public class CustomerEntity extends TableServiceEntity {\n        public CustomerEntity(String lastName, String firstName) {\n            this.partitionKey = lastName;\n            this.rowKey = firstName;\n        }\n\n        public CustomerEntity() { }\n\n        String email;\n        String phoneNumber;\n        \n        public String getEmail() {\n            return this.email;\n        }\n        \n        public void setEmail(String email) {\n            this.email = email;\n        }\n        \n        public String getPhoneNumber() {\n            return this.phoneNumber;\n        }\n        \n        public void setPhoneNumber(String phoneNumber) {\n            this.phoneNumber = phoneNumber;\n        }\n    }\n\nTable operations involving entities require a **TableOperation** object. This object defines the operation to be performed on an entity, which can be executed with a **CloudTable** object. The following code creates a new instance of the **CustomerEntity** class with some customer data to be stored. The code next calls **TableOperation.insertOrReplace** to create a **TableOperation** object to insert an entity into a table, and associates the new **CustomerEntity** with it. Finally, the code calls the **execute** method on the **CloudTable** object, specifying the \"people\" table and the new **TableOperation**, which then sends a request to the storage service to insert the new customer entity into the \"people\" table, or replace the entity if it already exists.\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n           CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n            \n        // Create a cloud table object for the table.\n        CloudTable cloudTable = tableClient.getTableReference(\"people\");\n            \n        // Create a new customer entity.\n        CustomerEntity customer1 = new CustomerEntity(\"Harp\", \"Walter\");\n        customer1.setEmail(\"Walter@contoso.com\");\n        customer1.setPhoneNumber(\"425-555-0101\");\n            \n        // Create an operation to add the new customer to the people table.\n        TableOperation insertCustomer1 = TableOperation.insertOrReplace(customer1);\n\n        // Submit the operation to the table service.\n        cloudTable.execute(insertCustomer1);\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: Insert a batch of entities\n\nYou can insert a batch of entities to the table service in one write operation. The following code creates a **TableBatchOperation** object, then adds three insert operations to it. Each insert operation is added by creating a new entity object, setting its values, and then calling the **insert** method on the **TableBatchOperation** object to associate the entity with a new insert operation. Then the code calls **execute** on the **CloudTable** object, specifying the \"people\" table and the **TableBatchOperation** object, which sends the batch of table operations to the storage service in a single request.\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n           CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n        // Define a batch operation.\n        TableBatchOperation batchOperation = new TableBatchOperation();\n\n        // Create a cloud table object for the table.\n        CloudTable cloudTable = tableClient.getTableReference(\"people\");\n\n        // Create a customer entity to add to the table.\n        CustomerEntity customer = new CustomerEntity(\"Smith\", \"Jeff\");\n        customer.setEmail(\"Jeff@contoso.com\");\n        customer.setPhoneNumber(\"425-555-0104\");\n        batchOperation.insertOrReplace(customer);\n\n       // Create another customer entity to add to the table.\n       CustomerEntity customer2 = new CustomerEntity(\"Smith\", \"Ben\");\n       customer2.setEmail(\"Ben@contoso.com\");\n       customer2.setPhoneNumber(\"425-555-0102\");\n       batchOperation.insertOrReplace(customer2);\n\n       // Create a third customer entity to add to the table.\n       CustomerEntity customer3 = new CustomerEntity(\"Smith\", \"Denise\");\n       customer3.setEmail(\"Denise@contoso.com\");\n       customer3.setPhoneNumber(\"425-555-0103\");\n       batchOperation.insertOrReplace(customer3);\n\n       // Execute the batch of operations on the \"people\" table.\n       cloudTable.execute(batchOperation);\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\nSome things to note on batch operations:\n\n- You can perform up to 100 insert, delete, merge, replace, insert or merge, and insert or replace operations in any combination in a single batch.\n- A batch operation can have a retrieve operation, if it is the only operation in the batch.\n- All entities in a single batch operation must have the same partition key.\n- A batch operation is limited to a 4MB data payload.\n\n## How to: Retrieve all entities in a partition\n\nTo query a table for entities in a partition, you can use a **TableQuery**. Call **TableQuery.from** to create a query on a particular table that returns a specified result type. The following code specifies a filter for entities where 'Smith' is the partition key. **TableQuery.generateFilterCondition** is a helper method to create filters for queries. Call **where** on the reference returned by the **TableQuery.from** method to apply the filter to the query. When the query is executed with a call to **execute** on the **CloudTable** object, it returns an **Iterator** with the **CustomerEntity** result type specified. You can then use the **Iterator** returned in a for each loop to consume the results. This code prints the fields of each entity in the query results to the console.\n\n    try\n    {\n        // Define constants for filters.\n        final String PARTITION_KEY = \"PartitionKey\";\n        final String ROW_KEY = \"RowKey\";\n        final String TIMESTAMP = \"Timestamp\";\n\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n           CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n            \n       // Create a cloud table object for the table.\n       CloudTable cloudTable = tableClient.getTableReference(\"people\");\n\n        // Create a filter condition where the partition key is \"Smith\".\n        String partitionFilter = TableQuery.generateFilterCondition(\n           PARTITION_KEY, \n           QueryComparisons.EQUAL,\n           \"Smith\");\n\n       // Specify a partition query, using \"Smith\" as the partition key filter.\n       TableQuery<CustomerEntity> partitionQuery =\n           TableQuery.from(CustomerEntity.class)\n           .where(partitionFilter);\n\n        // Loop through the results, displaying information about the entity.\n        for (CustomerEntity entity : cloudTable.execute(partitionQuery)) {\n            System.out.println(entity.getPartitionKey() +\n                \" \" + entity.getRowKey() + \n                \"\\t\" + entity.getEmail() +\n                \"\\t\" + entity.getPhoneNumber());\n       }\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: Retrieve a range of entities in a partition\n\nIf you don't want to query all the entities in a partition, you can specify a range by using comparison operators in a filter. The following code combines two filters to get all entities in partition \"Smith\" where the row key (first name) starts with a letter up to 'E' in the alphabet. Then it prints the query results. If you use the entities added to the table in the batch insert section of this guide, only two entities are returned this time (Ben and Denise Smith); Jeff Smith is not included.\n\n    try\n    {\n        // Define constants for filters.\n        final String PARTITION_KEY = \"PartitionKey\";\n        final String ROW_KEY = \"RowKey\";\n        final String TIMESTAMP = \"Timestamp\";\n            \n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n           CloudStorageAccount.parse(storageConnectionString);\n\n       // Create the table client.\n       CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n       // Create a cloud table object for the table.\n       CloudTable cloudTable = tableClient.getTableReference(\"people\");\n\n        // Create a filter condition where the partition key is \"Smith\".\n        String partitionFilter = TableQuery.generateFilterCondition(\n           PARTITION_KEY, \n           QueryComparisons.EQUAL,\n           \"Smith\");\n\n        // Create a filter condition where the row key is less than the letter \"E\".\n        String rowFilter = TableQuery.generateFilterCondition(\n           ROW_KEY, \n           QueryComparisons.LESS_THAN,\n           \"E\");\n\n        // Combine the two conditions into a filter expression.\n        String combinedFilter = TableQuery.combineFilters(partitionFilter, \n            Operators.AND, rowFilter);\n\n        // Specify a range query, using \"Smith\" as the partition key,\n        // with the row key being up to the letter \"E\".\n        TableQuery<CustomerEntity> rangeQuery =\n           TableQuery.from(CustomerEntity.class)\n           .where(combinedFilter);\n\n        // Loop through the results, displaying information about the entity\n        for (CustomerEntity entity : cloudTable.execute(rangeQuery)) {\n            System.out.println(entity.getPartitionKey() +\n                \" \" + entity.getRowKey() +\n                \"\\t\" + entity.getEmail() +\n                \"\\t\" + entity.getPhoneNumber());\n        }\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: Retrieve a single entity\n\nYou can write a query to retrieve a single, specific entity. The following code calls **TableOperation.retrieve** with partition key and row key parameters to specify the customer \"Jeff Smith\", instead of creating a **TableQuery** and using filters to do the same thing. When executed, the retrieve operation returns just one entity, rather than a collection. The **getResultAsType** method casts the result to the type of the assignment target, a **CustomerEntity** object. If this type is not compatible with the type specified for the query, an exception will be thrown. A null value is returned if no entity has an exact partition and row key match. Specifying both partition and row keys in a query is the fastest way to retrieve a single entity from the Table service.\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n           CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n        // Create a cloud table object for the table.\n        CloudTable cloudTable = tableClient.getTableReference(\"people\");\n\n        // Retrieve the entity with partition key of \"Smith\" and row key of \"Jeff\"\n        TableOperation retrieveSmithJeff = \n           TableOperation.retrieve(\"Smith\", \"Jeff\", CustomerEntity.class);\n\n       // Submit the operation to the table service and get the specific entity.\n       CustomerEntity specificEntity =\n            cloudTable.execute(retrieveSmithJeff).getResultAsType();\n            \n        // Output the entity.\n        if (specificEntity != null)\n        {\n            System.out.println(specificEntity.getPartitionKey() +\n                \" \" + specificEntity.getRowKey() +\n                \"\\t\" + specificEntity.getEmail() +\n                \"\\t\" + specificEntity.getPhoneNumber());\n       }\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: Modify an entity\n\nTo modify an entity, retrieve it from the table service, make changes to the entity object, and save the changes back to the table service with a replace or merge operation. The following code changes an existing customer's phone number. Instead of calling **TableOperation.insert** like we did to insert, this code calls **TableOperation.replace**. The **CloudTable.execute** method calls the table service, and the entity is replaced, unless another application changed it in the time since this application retrieved it. When that happens, an exception is thrown, and the entity must be retrieved, modified, and saved again. This optimistic concurrency retry pattern is common in a distributed storage system.\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n           CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n        // Create a cloud table object for the table.\n        CloudTable cloudTable = tableClient.getTableReference(\"people\");\n\n        // Retrieve the entity with partition key of \"Smith\" and row key of \"Jeff\".\n        TableOperation retrieveSmithJeff = \n           TableOperation.retrieve(\"Smith\", \"Jeff\", CustomerEntity.class);\n\n        // Submit the operation to the table service and get the specific entity.\n        CustomerEntity specificEntity =\n          cloudTable.execute(retrieveSmithJeff).getResultAsType();\n\n        // Specify a new phone number.\n        specificEntity.setPhoneNumber(\"425-555-0105\");\n\n        // Create an operation to replace the entity.\n        TableOperation replaceEntity = TableOperation.replace(specificEntity);\n\n        // Submit the operation to the table service.\n        cloudTable.execute(replaceEntity);\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: Query a subset of entity properties\n\nA query to a table can retrieve just a few properties from an entity. This technique, called projection, reduces bandwidth and can improve query performance, especially for large entities. The query in the following code uses the **select** method to return only the email addresses of entities in the table. The results are projected into a collection of **String** with the help of an **EntityResolver**, which does the type conversion on the entities returned from the server. You can learn more about projection in this [blog post][]. Note that projection is not supported on the local storage emulator, so this code runs only when using an account on the table service.\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n            CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n        // Create a cloud table object for the table.\n        CloudTable cloudTable = tableClient.getTableReference(\"people\");\n\n        // Define a projection query that retrieves only the Email property\n        TableQuery<CustomerEntity> projectionQuery = \n           TableQuery.from(CustomerEntity.class)\n           .select(new String[] {\"Email\"});\n\n        // Define a Entity resolver to project the entity to the Email value.\n        EntityResolver<String> emailResolver = new EntityResolver<String>() {\n            @Override\n            public String resolve(String PartitionKey, String RowKey, Date timeStamp, HashMap<String, EntityProperty> properties, String etag) {\n                return properties.get(\"Email\").getValueAsString();\n            }\n        };\n\n        // Loop through the results, displaying the Email values.\n        for (String projectedString : \n            cloudTable.execute(projectionQuery, emailResolver)) {\n                System.out.println(projectedString);\n        }\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: Insert or Replace an entity\n\nOften you want to add an entity to a table without knowing if it already exists in the table. An insert-or-replace operation allows you to make a single request which will insert the entity if it does not exist or replace the existing one if it does. Building on prior examples, the following code inserts or replaces the entity for \"Walter Harp\". After creating a new entity, this code calls the **TableOperation.insertOrReplace** method. This code then calls **execute** on the **CloudTable** object with the table and the insert or replace table operation as the parameters. To update only part of an entity, the **TableOperation.insertOrMerge** method can be used instead. Note that insert-or-replace is not supported on the local storage emulator, so this code runs only when using an account on the table service. You can learn more about insert-or-replace and insert-or-merge in this [blog post][].\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n            CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n        // Create a cloud table object for the table.\n        CloudTable cloudTable = tableClient.getTableReference(\"people\");\n\n        // Create a new customer entity.\n        CustomerEntity customer5 = new CustomerEntity(\"Harp\", \"Walter\");\n        customer5.setEmail(\"Walter@contoso.com\");\n        customer5.setPhoneNumber(\"425-555-0106\");\n\n        // Create an operation to add the new customer to the people table.\n        TableOperation insertCustomer5 = TableOperation.insertOrReplace(customer5);\n\n        // Submit the operation to the table service.\n        cloudTable.execute(insertCustomer5);\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: Delete an entity\n\nYou can easily delete an entity after you have retrieved it. Once the entity is retrieved, call **TableOperation.delete** with the entity to delete. Then call **execute** on the **CloudTable** object. The following code retrieves and deletes a customer entity.\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n            CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n        // Create a cloud table object for the table.\n        CloudTable cloudTable = tableClient.getTableReference(\"people\");\n\n        // Create an operation to retrieve the entity with partition key of \"Smith\" and row key of \"Jeff\".\n        TableOperation retrieveSmithJeff = TableOperation.retrieve(\"Smith\", \"Jeff\", CustomerEntity.class);\n\n        // Retrieve the entity with partition key of \"Smith\" and row key of \"Jeff\".\n        CustomerEntity entitySmithJeff =\n            cloudTable.execute(retrieveSmithJeff).getResultAsType();\n\n        // Create an operation to delete the entity.\n        TableOperation deleteSmithJeff = TableOperation.delete(entitySmithJeff);\n\n        // Submit the delete operation to the table service.\n        cloudTable.execute(deleteSmithJeff);\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## How to: Delete a table\n\nFinally, the following code deletes a table from a storage account. A table which has been deleted will be unavailable to be recreated for a period of time following the deletion, usually less than forty seconds.\n\n    try\n    {\n        // Retrieve storage account from connection-string.\n        CloudStorageAccount storageAccount =\n            CloudStorageAccount.parse(storageConnectionString);\n\n        // Create the table client.\n        CloudTableClient tableClient = storageAccount.createCloudTableClient();\n\n        // Delete the table and all its data if it exists.\n        CloudTable cloudTable = new CloudTable(\"people\",tableClient);\n        cloudTable.deleteIfExists();\n    }\n    catch (Exception e)\n    {\n        // Output the stack trace.\n        e.printStackTrace();\n    }\n\n## Next steps\n\nNow that you've learned the basics of table storage, follow these links to learn how to do more complex storage tasks.\n\n- [Azure Storage SDK for Java][]\n- [Azure Storage Client SDK Reference][]\n- [Azure Storage REST API][]\n- [Azure Storage Team Blog][]\n\n[Azure SDK for Java]: http://go.microsoft.com/fwlink/?LinkID=525671\n[Azure Storage SDK for Java]: https://github.com/azure/azure-storage-java\n[Azure Storage SDK for Android]: https://github.com/azure/azure-storage-android\n[Azure Storage Client SDK Reference]: http://dl.windowsazure.com/storage/javadoc/\n[Azure Storage REST API]: http://msdn.microsoft.com/library/azure/gg433040.aspx\n[Azure Storage Team Blog]: http://blogs.msdn.com/b/windowsazurestorage/\n[blog post]: http://blogs.msdn.com/b/windowsazurestorage/archive/2011/09/15/windows-azure-tables-introducing-upsert-and-query-projection.aspx\n "
}