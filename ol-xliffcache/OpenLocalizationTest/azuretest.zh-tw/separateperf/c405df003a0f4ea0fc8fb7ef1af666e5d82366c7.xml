{
  "nodes": [
    {
      "content": "Create a PHP web app in Azure App Service using Azure Storage",
      "pos": [
        28,
        89
      ]
    },
    {
      "content": "This tutorial shows you how to create a PHP web app in Azure App Service and use the Azure Tables storage service in the back-end.",
      "pos": [
        109,
        239
      ]
    },
    {
      "content": "Create a PHP web app in Azure App Service using Azure Storage",
      "pos": [
        568,
        629
      ]
    },
    {
      "content": "This tutorial shows you how to create a PHP web app in <bpt id=\"p1\">[</bpt>Azure App Service<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529714)</ept> and use the Azure Tables storage service in the back-end.",
      "pos": [
        631,
        810
      ]
    },
    {
      "content": "This tutorial assumes you have <bpt id=\"p1\">[</bpt>PHP<ept id=\"p1\">][install-php]</ept> and a web server installed on your computer.",
      "pos": [
        811,
        905
      ]
    },
    {
      "content": "The instructions in this tutorial can be followed on any operating system, including Windows, Mac, and  Linux.",
      "pos": [
        906,
        1016
      ]
    },
    {
      "content": "Upon completing this guide, you will have a PHP web app running in Azure and accessing the Table storage service.",
      "pos": [
        1017,
        1130
      ]
    },
    {
      "content": "You will learn:",
      "pos": [
        1133,
        1148
      ]
    },
    {
      "content": "How to install the Azure client libraries and include them into your application.",
      "pos": [
        1152,
        1233
      ]
    },
    {
      "content": "How to use the client libraries for creating tables, and for creating, querying and deleting table entities.",
      "pos": [
        1236,
        1344
      ]
    },
    {
      "content": "How to create an Azure Storage Account and set up your application to use it.",
      "pos": [
        1347,
        1424
      ]
    },
    {
      "content": "How to create an Azure web app and deploy to it using Git",
      "pos": [
        1427,
        1484
      ]
    },
    {
      "content": "You will build a simple Tasklist web application in PHP.",
      "pos": [
        1487,
        1543
      ]
    },
    {
      "content": "A screenshot of the completed application is below:",
      "pos": [
        1544,
        1595
      ]
    },
    {
      "content": "Azure PHP web app",
      "pos": [
        1599,
        1616
      ]
    },
    {
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> If you want to get started with Azure App Service before signing up for an Azure account, go to <bpt id=\"p1\">[</bpt>Try App Service<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=523751)</ept>, where you can immediately create a short-lived starter web app in App Service.",
      "pos": [
        1740,
        1993
      ]
    },
    {
      "content": "No credit cards required; no commitments.",
      "pos": [
        1994,
        2035
      ]
    },
    {
      "content": "Installing the Azure client libraries",
      "pos": [
        2039,
        2076
      ]
    },
    {
      "content": "To install the PHP Client Libraries for Azure via Composer, follow these steps:",
      "pos": [
        2078,
        2157
      ]
    },
    {
      "content": "Install Git",
      "pos": [
        2163,
        2174
      ]
    },
    {
      "pos": [
        2196,
        2300
      ],
      "content": "<ph id=\"ph1\">[AZURE.NOTE]</ph> On Windows, you will also need to add the Git executable to your PATH environment variable."
    },
    {
      "pos": [
        2305,
        2404
      ],
      "content": "Create a file named <bpt id=\"p1\">**</bpt>composer.json<ept id=\"p1\">**</ept> in the root of your project and add the following code to it:"
    },
    {
      "pos": [
        2864,
        2929
      ],
      "content": "Download <bpt id=\"p1\">**</bpt><bpt id=\"p2\">[</bpt>composer.phar<ept id=\"p2\">][composer-phar]</ept><ept id=\"p1\">**</ept> in your project root."
    },
    {
      "content": "Open a command prompt and execute this in your project root",
      "pos": [
        2934,
        2993
      ]
    },
    {
      "content": "Getting started with the client libraries",
      "pos": [
        3032,
        3073
      ]
    },
    {
      "content": "There are four basic steps that have to be performed before you can make a call to an Azure API wen using the libraries.",
      "pos": [
        3075,
        3195
      ]
    },
    {
      "content": "You will create an initialization script that will perform these steps.",
      "pos": [
        3196,
        3267
      ]
    },
    {
      "pos": [
        3271,
        3305
      ],
      "content": "Create a file called <bpt id=\"p1\">**</bpt>init.php<ept id=\"p1\">**</ept>."
    },
    {
      "content": "First, include the autoloader script:",
      "pos": [
        3309,
        3346
      ]
    },
    {
      "content": "Include the namespaces you are going to use.",
      "pos": [
        3400,
        3444
      ]
    },
    {
      "pos": [
        3450,
        3531
      ],
      "content": "To create any Azure service client you need to use the <bpt id=\"p1\">**</bpt>ServicesBuilder<ept id=\"p1\">**</ept> class:"
    },
    {
      "pos": [
        3587,
        3672
      ],
      "content": "To catch exceptions produced by any API call you need the <bpt id=\"p1\">**</bpt>ServiceException<ept id=\"p1\">**</ept> class:"
    },
    {
      "content": "To instantiate the service client you will also need a valid connection string.",
      "pos": [
        3731,
        3810
      ]
    },
    {
      "content": "The format for the table service connection strings is:",
      "pos": [
        3811,
        3866
      ]
    },
    {
      "content": "For accessing a live service:",
      "pos": [
        3872,
        3901
      ]
    },
    {
      "content": "For accessing the emulator storage:",
      "pos": [
        4009,
        4044
      ]
    },
    {
      "pos": [
        4088,
        4201
      ],
      "content": "Use the <ph id=\"ph1\">`ServicesBuilder::createTableService`</ph> factory method to instantiate a wrapper around Table service calls."
    },
    {
      "pos": [
        4309,
        4391
      ],
      "content": "<ph id=\"ph1\">`$tableRestProxy`</ph> contains a method for every REST call available on Azure Tables."
    },
    {
      "content": "Creating a Table",
      "pos": [
        4397,
        4413
      ]
    },
    {
      "content": "Before you can store data you first have to create a container for it, the Table.",
      "pos": [
        4415,
        4496
      ]
    },
    {
      "pos": [
        4501,
        4541
      ],
      "content": "Create a file named <bpt id=\"p1\">**</bpt>createtable.php<ept id=\"p1\">**</ept>."
    },
    {
      "content": "First, include the initialization script you just created.",
      "pos": [
        4545,
        4603
      ]
    },
    {
      "content": "You will be including this script in every file accessing Azure:",
      "pos": [
        4604,
        4668
      ]
    },
    {
      "content": "Then, make a call to <bpt id=\"p1\">*</bpt>createTable<ept id=\"p1\">*</ept> passing in the name of the table.",
      "pos": [
        4720,
        4788
      ]
    },
    {
      "content": "Similarly to other NoSQL table stores, no schema is required for Azure Tables.",
      "pos": [
        4789,
        4867
      ]
    },
    {
      "pos": [
        5145,
        5264
      ],
      "content": "Error codes and message scan be found here: <bpt id=\"p1\">[</bpt>http://msdn.microsoft.com/library/windowsazure/dd179438.aspx<ept id=\"p1\">][msdn-errors]</ept>"
    },
    {
      "content": "Querying a Table",
      "pos": [
        5269,
        5285
      ]
    },
    {
      "content": "The home page of the Tasklist application should list all existing tasks and allow the insertion of new ones.",
      "pos": [
        5287,
        5396
      ]
    },
    {
      "pos": [
        5400,
        5516
      ],
      "content": "Create a file named <bpt id=\"p1\">**</bpt>index.php<ept id=\"p1\">**</ept> and insert the following HTML and PHP code which will form the header of the page:"
    },
    {
      "content": "To query Azure Tables for <bpt id=\"p1\">**</bpt>all entities<ept id=\"p1\">**</ept> stored in the <bpt id=\"p2\">*</bpt>tasks<ept id=\"p2\">*</ept> table you call the <bpt id=\"p3\">*</bpt>queryEntities<ept id=\"p3\">*</ept> method passing only the name of the table.",
      "pos": [
        6487,
        6629
      ]
    },
    {
      "content": "In the <bpt id=\"p1\">**</bpt>Updating an Entity<ept id=\"p1\">**</ept> section below you will also see how to pass a filter querying for a specific entity.",
      "pos": [
        6630,
        6744
      ]
    },
    {
      "content": "To iterate on the entities in the result set:",
      "pos": [
        7025,
        7070
      ]
    },
    {
      "pos": [
        7184,
        7277
      ],
      "content": "Once you get an <ph id=\"ph1\">`Entity`</ph>, the model for reading data is <ph id=\"ph2\">`Entity-&gt;getPropertyValue('[name]')`</ph>:"
    },
    {
      "content": "Last, you must insert the form that feeds data into the task insertion script and complete the HTML:",
      "pos": [
        8632,
        8732
      ]
    },
    {
      "content": "Inserting Entities into a Table",
      "pos": [
        9475,
        9506
      ]
    },
    {
      "content": "Your application can now read all items stored in the table.",
      "pos": [
        9508,
        9568
      ]
    },
    {
      "content": "Since there won't be any at fist, let's add a function that writes data into the database.",
      "pos": [
        9569,
        9659
      ]
    },
    {
      "pos": [
        9663,
        9699
      ],
      "content": "Create a file named <bpt id=\"p1\">**</bpt>additem.php<ept id=\"p1\">**</ept>."
    },
    {
      "content": "Add the following to the file:",
      "pos": [
        9703,
        9733
      ]
    },
    {
      "pos": [
        9899,
        10006
      ],
      "content": "The first step of inserting an entity is instantiating an <ph id=\"ph1\">`Entity`</ph> object and setting the properties on it:"
    },
    {
      "pos": [
        10437,
        10515
      ],
      "content": "Then you can pass the <ph id=\"ph1\">`$entity`</ph> you just created to the <ph id=\"ph2\">`insertEntity`</ph> method:"
    },
    {
      "content": "Last, to make the page return to the home page after inserting the entity:",
      "pos": [
        10785,
        10859
      ]
    },
    {
      "content": "Updating an Entity",
      "pos": [
        10925,
        10943
      ]
    },
    {
      "content": "The task list app has the ability to mark an item as complete as well as to unmark it.",
      "pos": [
        10945,
        11031
      ]
    },
    {
      "content": "The home page passes in the <bpt id=\"p1\">*</bpt>RowKey<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>PartitionKey<ept id=\"p2\">*</ept> of an entity and the target state (marked==1, unmarked==0).",
      "pos": [
        11032,
        11147
      ]
    },
    {
      "pos": [
        11151,
        11221
      ],
      "content": "Create a file called <bpt id=\"p1\">**</bpt>markitem.php<ept id=\"p1\">**</ept> and add the initialization part:"
    },
    {
      "content": "The first step to updating an entity is fetching it from the Table:",
      "pos": [
        11289,
        11356
      ]
    },
    {
      "content": "As you can see the passed in query filter is of the form <ph id=\"ph1\">`Key eq 'Value'`</ph>.",
      "pos": [
        11589,
        11663
      ]
    },
    {
      "content": "A full description of the query syntax is available <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">][msdn-table-query-syntax]</ept>.",
      "pos": [
        11664,
        11748
      ]
    },
    {
      "content": "Then you can change any properties:",
      "pos": [
        11752,
        11787
      ]
    },
    {
      "pos": [
        11885,
        11935
      ],
      "content": "And the <ph id=\"ph1\">`updateEntity`</ph> method performs the update:"
    },
    {
      "content": "To make the page return to the home page after inserting the entity:",
      "pos": [
        12215,
        12283
      ]
    },
    {
      "content": "Deleting an Entity",
      "pos": [
        12346,
        12364
      ]
    },
    {
      "content": "Deleting an item is accomplished with a single call to <ph id=\"ph1\">`deleteItem`</ph>.",
      "pos": [
        12366,
        12434
      ]
    },
    {
      "content": "The passed in values are the <bpt id=\"p1\">**</bpt>PartitionKey<ept id=\"p1\">**</ept> and the <bpt id=\"p2\">**</bpt>RowKey<ept id=\"p2\">**</ept>, which together make up the primary key of the entity.",
      "pos": [
        12435,
        12554
      ]
    },
    {
      "content": "Create a file called <bpt id=\"p1\">**</bpt>deleteitem.php<ept id=\"p1\">**</ept> and insert the following code:",
      "pos": [
        12555,
        12625
      ]
    },
    {
      "content": "Create an Azure storage account",
      "pos": [
        12836,
        12867
      ]
    },
    {
      "pos": [
        12869,
        13053
      ],
      "content": "To make your application store data into the cloud you need to first create a storage account in Azure and then pass the proper authentication information to the <bpt id=\"p1\">*</bpt>Configuration<ept id=\"p1\">*</ept> class."
    },
    {
      "pos": [
        13058,
        13105
      ],
      "content": "Login to the <bpt id=\"p1\">[</bpt>Azure Portal<ept id=\"p1\">][management-portal]</ept>."
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>New<ept id=\"p1\">**</ept> icon on the bottom left of the portal, then click <bpt id=\"p2\">**</bpt>Data + Storage<ept id=\"p2\">**</ept> &gt; <bpt id=\"p3\">**</bpt>Storage<ept id=\"p3\">**</ept>.",
      "pos": [
        13110,
        13211
      ]
    },
    {
      "content": "Give the storage account a unique name and create a new <bpt id=\"p1\">[</bpt>resource group<ept id=\"p1\">](../resource-group-overview.md)</ept> for it.",
      "pos": [
        13212,
        13323
      ]
    },
    {
      "content": "Create a new storage account",
      "pos": [
        13331,
        13359
      ]
    },
    {
      "pos": [
        13392,
        13597
      ],
      "content": "When the storage account has been created, the <bpt id=\"p1\">**</bpt>Notifications<ept id=\"p1\">**</ept> button will flash a green <bpt id=\"p2\">**</bpt>SUCCESS<ept id=\"p2\">**</ept> and the storage account's blade is open to show that it belongs to the new resource group you created."
    },
    {
      "content": "Click the <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> part in the storage account's blade.",
      "pos": [
        13602,
        13661
      ]
    },
    {
      "content": "Take note of the account name and the primary key.",
      "pos": [
        13662,
        13712
      ]
    },
    {
      "content": "Select Manage Keys",
      "pos": [
        13720,
        13738
      ]
    },
    {
      "content": "Open <bpt id=\"p1\">**</bpt>init.php<ept id=\"p1\">**</ept> and replace <ph id=\"ph1\">`[YOUR_STORAGE_ACCOUNT_NAME]`</ph> and <ph id=\"ph2\">`[YOUR_STORAGE_ACCOUNT_KEY]`</ph> with the account name and key you took note of in the last step.",
      "pos": [
        13765,
        13922
      ]
    },
    {
      "content": "Save the file.",
      "pos": [
        13923,
        13937
      ]
    },
    {
      "content": "Create an Azure web app and set up Git publishing",
      "pos": [
        13942,
        13991
      ]
    },
    {
      "content": "Follow these steps to create an Azure web app:",
      "pos": [
        13993,
        14039
      ]
    },
    {
      "pos": [
        14044,
        14091
      ],
      "content": "Login to the <bpt id=\"p1\">[</bpt>Azure Portal<ept id=\"p1\">][management-portal]</ept>."
    },
    {
      "content": "Create an empty web app with the instructions at <bpt id=\"p1\">[</bpt>How to: Create a web app Using the Azure Portal<ept id=\"p1\">](../web-sites-create-deploy.md#createawebsiteportal)</ept>.",
      "pos": [
        14096,
        14247
      ]
    },
    {
      "content": "Be sure to create a new <bpt id=\"p1\">[</bpt>App Service plan<ept id=\"p1\">](azure-web-sites-web-hosting-plans-in-depth-overview)</ept> and select the resource group you created previously for the storage account.",
      "pos": [
        14248,
        14421
      ]
    },
    {
      "pos": [
        14427,
        14616
      ],
      "content": "When the web app has been created, the <bpt id=\"p1\">**</bpt>Notifications<ept id=\"p1\">**</ept> button will flash a green <bpt id=\"p2\">**</bpt>SUCCESS<ept id=\"p2\">**</ept> and the web app's blade is open to show that it belongs to the new resource group you created."
    },
    {
      "content": "In the web app's blade, click <bpt id=\"p1\">**</bpt>Set up continuous deployment<ept id=\"p1\">**</ept>, and choose <bpt id=\"p2\">**</bpt>Local Git Repository<ept id=\"p2\">**</ept>.",
      "pos": [
        14621,
        14721
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.",
      "pos": [
        14722,
        14735
      ]
    },
    {
      "content": "Set up Git publishing",
      "pos": [
        14743,
        14764
      ]
    },
    {
      "content": "Before you can deploy your local Git repository to Azure, you must also set up deployment credentials.",
      "pos": [
        14792,
        14894
      ]
    },
    {
      "content": "In the web app's blade, click <bpt id=\"p1\">**</bpt>All Settings<ept id=\"p1\">**</ept> &gt; <bpt id=\"p2\">**</bpt>Deployment credentials<ept id=\"p2\">**</ept> to configure the credentials.",
      "pos": [
        14895,
        15000
      ]
    },
    {
      "content": "Click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept> when you're done.",
      "pos": [
        15001,
        15033
      ]
    },
    {
      "content": "Create publishing credentials",
      "pos": [
        15041,
        15070
      ]
    },
    {
      "content": "It will take a few seconds to set up your repository.",
      "pos": [
        15090,
        15143
      ]
    },
    {
      "content": "Once the Git repository is ready, you now push your changes to it.",
      "pos": [
        15148,
        15214
      ]
    },
    {
      "content": "You can find the repo URL by clicking the same deployment part in the web app's blade.",
      "pos": [
        15215,
        15301
      ]
    },
    {
      "content": "Git deployment instructions returned after creating a repository for the web app.",
      "pos": [
        15310,
        15391
      ]
    },
    {
      "content": "Note the instructions, as these will be used in the next section to publish the application.",
      "pos": [
        15416,
        15508
      ]
    },
    {
      "content": "Publish Your Application",
      "pos": [
        15512,
        15536
      ]
    },
    {
      "content": "To publish your application with Git, follow the steps below.",
      "pos": [
        15538,
        15599
      ]
    },
    {
      "pos": [
        15604,
        15731
      ],
      "content": "Open the <bpt id=\"p1\">**</bpt>vendor/microsoft/windowsazure<ept id=\"p1\">**</ept> folder under the root of the application and delete the following files and folders:"
    },
    {
      "content": ".git",
      "pos": [
        15738,
        15742
      ]
    },
    {
      "content": ".gitattributes",
      "pos": [
        15749,
        15763
      ]
    },
    {
      "content": ".gitignore",
      "pos": [
        15770,
        15780
      ]
    },
    {
      "content": "When the Composer package manager downloads the Azure client libraries and their dependencies it does so by cloning the GitHub repository that they reside in.",
      "pos": [
        15798,
        15956
      ]
    },
    {
      "content": "In the next step, the application will be deployed via Git by creating a repository out of the root folder of the application.",
      "pos": [
        15957,
        16083
      ]
    },
    {
      "content": "Git will ignore the sub-repository where the client libraries live unless the repository-specific files are removed.",
      "pos": [
        16084,
        16200
      ]
    },
    {
      "pos": [
        16205,
        16354
      ],
      "content": "Open GitBash (or a terminal, if Git is in your <ph id=\"ph1\">`PATH`</ph>), change directories to the root directory of your application, and run the following commands:"
    },
    {
      "content": "You will be prompted for the password you created earlier.",
      "pos": [
        16522,
        16580
      ]
    },
    {
      "pos": [
        16585,
        16684
      ],
      "content": "Browse to <bpt id=\"p1\">**</bpt>http://[your web app domain]/createtable.php<ept id=\"p1\">**</ept> to create the table for the application."
    },
    {
      "pos": [
        16688,
        16772
      ],
      "content": "Browse to <bpt id=\"p1\">**</bpt>http://[your web app domain]/index.php<ept id=\"p1\">**</ept> to begin using the application."
    },
    {
      "content": "After you have published your application, you can begin making changes to it and use Git to publish them.",
      "pos": [
        16774,
        16880
      ]
    },
    {
      "content": "Publish Changes to Your Application",
      "pos": [
        16885,
        16920
      ]
    },
    {
      "content": "To publish changes to application, follow these steps:",
      "pos": [
        16922,
        16976
      ]
    },
    {
      "content": "Make changes to your application locally.",
      "pos": [
        16981,
        17022
      ]
    },
    {
      "pos": [
        17026,
        17175
      ],
      "content": "Open GitBash (or a terminal, it Git is in your <ph id=\"ph1\">`PATH`</ph>), change directories to the root directory of your application, and run the following commands:"
    },
    {
      "content": "You will be prompted for the password you created earlier.",
      "pos": [
        17281,
        17339
      ]
    },
    {
      "pos": [
        17344,
        17417
      ],
      "content": "Browse to <bpt id=\"p1\">**</bpt>http://[your web app domain]/index.php<ept id=\"p1\">**</ept> to see your changes."
    },
    {
      "content": "What's changed",
      "pos": [
        17423,
        17437
      ]
    },
    {
      "pos": [
        17440,
        17608
      ],
      "content": "For a guide to the change from Websites to App Service see: <bpt id=\"p1\">[</bpt>Azure App Service and Its Impact on Existing Azure Services<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529714)</ept>"
    },
    {
      "pos": [
        17611,
        17762
      ],
      "content": "For a guide to the change of the old portal to the new portal see: <bpt id=\"p1\">[</bpt>Reference for navigating the portal<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=529715)</ept>"
    },
    {
      "content": "test",
      "pos": [
        18600,
        18604
      ]
    }
  ],
  "content": "<properties \n    pageTitle=\"Create a PHP web app in Azure App Service using Azure Storage\" \n    description=\"This tutorial shows you how to create a PHP web app in Azure App Service and use the Azure Tables storage service in the back-end.\" \n    services=\"app-service\\web, storage\" \n    documentationCenter=\"php\" \n    authors=\"tfitzmac\" \n    manager=\"wpickett\" \n    editor=\"\"/>\n\n<tags \n    ms.service=\"app-service-web\" \n    ms.workload=\"web\" \n    ms.tgt_pltfrm=\"na\" \n    ms.devlang=\"PHP\" \n    ms.topic=\"article\" \n    ms.date=\"07/02/2015\" \n    ms.author=\"tomfitz\"/>\n\n# Create a PHP web app in Azure App Service using Azure Storage\n\nThis tutorial shows you how to create a PHP web app in [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714) and use the Azure Tables storage service in the back-end. This tutorial assumes you have [PHP][install-php] and a web server installed on your computer. The instructions in this tutorial can be followed on any operating system, including Windows, Mac, and  Linux. Upon completing this guide, you will have a PHP web app running in Azure and accessing the Table storage service.\n \nYou will learn:\n\n* How to install the Azure client libraries and include them into your application.\n* How to use the client libraries for creating tables, and for creating, querying and deleting table entities.\n* How to create an Azure Storage Account and set up your application to use it.\n* How to create an Azure web app and deploy to it using Git\n \nYou will build a simple Tasklist web application in PHP. A screenshot of the completed application is below:\n\n![Azure PHP web app][ws-storage-app]\n\n[AZURE.INCLUDE [create-account-and-websites-note](../../includes/create-account-and-websites-note.md)]\n\n>[AZURE.NOTE] If you want to get started with Azure App Service before signing up for an Azure account, go to [Try App Service](http://go.microsoft.com/fwlink/?LinkId=523751), where you can immediately create a short-lived starter web app in App Service. No credit cards required; no commitments.\n\n##Installing the Azure client libraries\n\nTo install the PHP Client Libraries for Azure via Composer, follow these steps:\n\n1. [Install Git][install-git]\n\n    > [AZURE.NOTE] On Windows, you will also need to add the Git executable to your PATH environment variable.\n\n2. Create a file named **composer.json** in the root of your project and add the following code to it:\n\n         {\n             \"repositories\": [\n                 {\n                     \"type\": \"pear\",\n                     \"url\": \"http://pear.php.net\"\n                 }\n             ],\n             \"require\": {\n                 \"pear-pear.php.net/mail_mime\" : \"*\",\n                 \"pear-pear.php.net/http_request2\" : \"*\",\n                 \"pear-pear.php.net/mail_mimedecode\" : \"*\",\n                 \"microsoft/windowsazure\": \"*\"\n             }\n         }\n\n3. Download **[composer.phar][composer-phar]** in your project root.\n\n4. Open a command prompt and execute this in your project root\n\n        php composer.phar install\n\n##Getting started with the client libraries\n\nThere are four basic steps that have to be performed before you can make a call to an Azure API wen using the libraries. You will create an initialization script that will perform these steps.\n\n* Create a file called **init.php**.\n\n* First, include the autoloader script:\n\n        require_once 'vendor\\autoload.php'; \n    \n* Include the namespaces you are going to use.\n\n    To create any Azure service client you need to use the **ServicesBuilder** class:\n\n        use WindowsAzure\\Common\\ServicesBuilder;\n\n    To catch exceptions produced by any API call you need the **ServiceException** class:\n\n        use WindowsAzure\\Common\\ServiceException;\n    \n* To instantiate the service client you will also need a valid connection string. The format for the table service connection strings is:\n\n    For accessing a live service:\n    \n        DefaultEndpointsProtocol=[http|https];AccountName=[yourAccount];AccountKey=[yourKey]\n    \n    For accessing the emulator storage:\n    \n        UseDevelopmentStorage=true\n\n* Use the `ServicesBuilder::createTableService` factory method to instantiate a wrapper around Table service calls.\n\n        $tableRestProxy = ServicesBuilder::getInstance()->createTableService($connectionString);\n    \n    `$tableRestProxy` contains a method for every REST call available on Azure Tables.\n\n\n## Creating a Table\n\nBefore you can store data you first have to create a container for it, the Table. \n\n* Create a file named **createtable.php**.\n\n* First, include the initialization script you just created. You will be including this script in every file accessing Azure:\n\n        <?php\n        require_once \"init.php\";\n\n* Then, make a call to *createTable* passing in the name of the table. Similarly to other NoSQL table stores, no schema is required for Azure Tables.\n    \n        try {\n            $tableRestProxy->createTable('tasks');\n        }\n        catch(ServiceException $e){\n            $code = $e->getCode();\n            $error_message = $e->getMessage();\n            echo $code.\": \".$error_message.\"<br />\";\n        }\n        ?>\n\n    Error codes and message scan be found here: [http://msdn.microsoft.com/library/windowsazure/dd179438.aspx][msdn-errors]\n\n\n##Querying a Table\n\nThe home page of the Tasklist application should list all existing tasks and allow the insertion of new ones.\n\n* Create a file named **index.php** and insert the following HTML and PHP code which will form the header of the page:\n    \n        <html>\n        <head>\n            <title>Index</title>\n            <style type=\"text/css\">\n                body { background-color: #fff; border-top: solid 10px #000;\n                    color: #333; font-size: .85em; margin: 20; padding: 20;\n                    font-family: \"Segoe UI\", Verdana, Helvetica, Sans-Serif;\n                }\n                h1, h2, h3,{ color: #000; margin-bottom: 0; padding-bottom: 0; }\n                h1 { font-size: 2em; }\n                h2 { font-size: 1.75em; }\n                h3 { font-size: 1.2em; }\n                table { margin-top: 0.75em; }\n                th { font-size: 1.2em; text-align: left; border: none; padding-left: 0; }\n                td { padding: 0.25em 2em 0.25em 0em; border: 0 none; }\n            </style>\n        </head>\n        <body>\n        <h1>My ToDo List <font color=\"grey\" size=\"5\">(powered by PHP and Azure Tables) </font></h1>\n        <?php       \n        require_once \"init.php\";\n\n* To query Azure Tables for **all entities** stored in the *tasks* table you call the *queryEntities* method passing only the name of the table. In the **Updating an Entity** section below you will also see how to pass a filter querying for a specific entity.\n\n        try {\n            $result = $tableRestProxy->queryEntities('tasks');\n        }\n        catch(ServiceException $e){\n            $code = $e->getCode();\n            $error_message = $e->getMessage();\n            echo $code.\": \".$error_message.\"<br />\";\n        }\n        \n* To iterate on the entities in the result set:\n\n        $entities = $result->getEntities();\n            \n        for ($i = 0; $i < count($entities); $i++) {\n\n* Once you get an `Entity`, the model for reading data is `Entity->getPropertyValue('[name]')`:\n\n            if ($i == 0) {\n                echo \"<table border='1'>\n                <tr>\n                    <td>Name</td>\n                    <td>Category</td>\n                    <td>Date</td>\n                    <td>Mark Complete?</td>\n                    <td>Delete?</td>\n                </tr>\";\n            }\n            echo \"\n                <tr>\n                    <td>\".$entities[$i]->getPropertyValue('name').\"</td>\n                    <td>\".$entities[$i]->getPropertyValue('category').\"</td>\n                    <td>\".$entities[$i]->getPropertyValue('date').\"</td>\";\n                    if ($entities[$i]->getPropertyValue('complete') == false)\n                        echo \"<td><a href='markitem.php?complete=true&pk=\".$entities[$i]->getPartitionKey().\"&rk=\".$entities[$i]->getRowKey().\"'>Mark Complete</a></td>\";\n                    else\n                        echo \"<td><a href='markitem.php?complete=false&pk=\".$entities[$i]->getPartitionKey().\"&rk=\".$entities[$i]->getRowKey().\"'>Unmark Complete</a></td>\";\n                    echo \"\n                    <td><a href='deleteitem.php?pk=\".$entities[$i]->getPartitionKey().\"&rk=\".$entities[$i]->getRowKey().\"'>Delete</a></td>\n                </tr>\";\n        }\n    \n        if ($i > 0)\n            echo \"</table>\";\n        else\n            echo \"<h3>No items on list.</h3>\";\n        ?>\n\n* Last, you must insert the form that feeds data into the task insertion script and complete the HTML:\n\n            <hr/>\n            <form action=\"additem.php\" method=\"post\">\n                <table border=\"1\">\n                    <tr>\n                        <td>Item Name: </td>\n                        <td><input name=\"itemname\" type=\"textbox\"/></td>\n                    </tr>\n                    <tr>\n                        <td>Category: </td>\n                        <td><input name=\"category\" type=\"textbox\"/></td>\n                    </tr>\n                    <tr>\n                        <td>Date: </td>\n                        <td><input name=\"date\" type=\"textbox\"/></td>\n                    </tr>\n                </table>\n                <input type=\"submit\" value=\"Add item\"/>\n            </form>\n        </body>\n        </html>\n\n## Inserting Entities into a Table\n\nYour application can now read all items stored in the table. Since there won't be any at fist, let's add a function that writes data into the database.\n\n* Create a file named **additem.php**.\n\n* Add the following to the file:\n\n        <?php       \n        require_once \"init.php\";        \n        use WindowsAzure\\Table\\Models\\Entity;\n        use WindowsAzure\\Table\\Models\\EdmType;      \n\n* The first step of inserting an entity is instantiating an `Entity` object and setting the properties on it:\n        \n        $entity = new Entity();\n        $entity->setPartitionKey('p1');\n        $entity->setRowKey((string) microtime(true));\n        $entity->addProperty('name', EdmType::STRING, $_POST['itemname']);\n        $entity->addProperty('category', EdmType::STRING, $_POST['category']);\n        $entity->addProperty('date', EdmType::STRING, $_POST['date']);\n        $entity->addProperty('complete', EdmType::BOOLEAN, false);\n\n* Then you can pass the `$entity` you just created to the `insertEntity` method:\n\n        try{\n            $tableRestProxy->insertEntity('tasks', $entity);\n        }\n        catch(ServiceException $e){\n            $code = $e->getCode();\n            $error_message = $e->getMessage();\n            echo $code.\": \".$error_message.\"<br />\";\n        }\n\n* Last, to make the page return to the home page after inserting the entity:\n\n        header('Location: index.php');      \n        ?>\n    \n## Updating an Entity\n\nThe task list app has the ability to mark an item as complete as well as to unmark it. The home page passes in the *RowKey* and *PartitionKey* of an entity and the target state (marked==1, unmarked==0).\n\n* Create a file called **markitem.php** and add the initialization part:\n\n        <?php       \n        require_once \"init.php\";\n        \n\n* The first step to updating an entity is fetching it from the Table:\n        \n        $result = $tableRestProxy->queryEntities('tasks', 'PartitionKey eq \\''.$_GET['pk'].'\\' and RowKey eq \\''.$_GET['rk'].'\\'');     \n        $entities = $result->getEntities();     \n        $entity = $entities[0];\n\n    As you can see the passed in query filter is of the form `Key eq 'Value'`. A full description of the query syntax is available [here][msdn-table-query-syntax].\n\n* Then you can change any properties:\n\n        $entity->setPropertyValue('complete', ($_GET['complete'] == 'true') ? true : false);\n\n* And the `updateEntity` method performs the update:\n\n        try{\n            $result = $tableRestProxy->updateEntity('tasks', $entity);\n        }\n        catch(ServiceException $e){\n            $code = $e->getCode();\n            $error_message = $e->getMessage();\n            echo $code.\": \".$error_message.\"<br />\";\n        }\n\n* To make the page return to the home page after inserting the entity:\n\n        header('Location: index.php');      \n        ?>\n\n\n## Deleting an Entity\n\nDeleting an item is accomplished with a single call to `deleteItem`. The passed in values are the **PartitionKey** and the **RowKey**, which together make up the primary key of the entity. Create a file called **deleteitem.php** and insert the following code:\n\n        <?php\n        \n        require_once \"init.php\";        \n        $tableRestProxy->deleteEntity('tasks', $_GET['pk'], $_GET['rk']);       \n        header('Location: index.php');\n        \n        ?>\n\n\n## Create an Azure storage account\n\nTo make your application store data into the cloud you need to first create a storage account in Azure and then pass the proper authentication information to the *Configuration* class.\n\n1. Login to the [Azure Portal][management-portal].\n\n2. Click the **New** icon on the bottom left of the portal, then click **Data + Storage** > **Storage**. Give the storage account a unique name and create a new [resource group](../resource-group-overview.md) for it.\n\n    ![Create a new storage account][storage-quick-create]\n    \n    When the storage account has been created, the **Notifications** button will flash a green **SUCCESS** and the storage account's blade is open to show that it belongs to the new resource group you created.\n\n5. Click the **Settings** part in the storage account's blade. Take note of the account name and the primary key.\n\n    ![Select Manage Keys][storage-access-keys]\n\n7. Open **init.php** and replace `[YOUR_STORAGE_ACCOUNT_NAME]` and `[YOUR_STORAGE_ACCOUNT_KEY]` with the account name and key you took note of in the last step. Save the file.\n\n## Create an Azure web app and set up Git publishing\n\nFollow these steps to create an Azure web app:\n\n1. Login to the [Azure Portal][management-portal].\n\n2. Create an empty web app with the instructions at [How to: Create a web app Using the Azure Portal](../web-sites-create-deploy.md#createawebsiteportal). Be sure to create a new [App Service plan](azure-web-sites-web-hosting-plans-in-depth-overview) and select the resource group you created previously for the storage account.\n\n    When the web app has been created, the **Notifications** button will flash a green **SUCCESS** and the web app's blade is open to show that it belongs to the new resource group you created.\n\n6. In the web app's blade, click **Set up continuous deployment**, and choose **Local Git Repository**. Click **OK**.\n\n    ![Set up Git publishing][setup-git-publishing]\n\n7. Before you can deploy your local Git repository to Azure, you must also set up deployment credentials. In the web app's blade, click **All Settings** > **Deployment credentials** to configure the credentials. Click **Save** when you're done.\n\n    ![Create publishing credentials][credentials]\n\n    It will take a few seconds to set up your repository.\n\n8. Once the Git repository is ready, you now push your changes to it. You can find the repo URL by clicking the same deployment part in the web app's blade. \n\n    ![Git deployment instructions returned after creating a repository for the web app.][git-instructions]\n\n    Note the instructions, as these will be used in the next section to publish the application.\n\n##Publish Your Application\n\nTo publish your application with Git, follow the steps below.\n\n1. Open the **vendor/microsoft/windowsazure** folder under the root of the application and delete the following files and folders:\n    * .git\n    * .gitattributes\n    * .gitignore\n            \n    When the Composer package manager downloads the Azure client libraries and their dependencies it does so by cloning the GitHub repository that they reside in. In the next step, the application will be deployed via Git by creating a repository out of the root folder of the application. Git will ignore the sub-repository where the client libraries live unless the repository-specific files are removed.\n\n2. Open GitBash (or a terminal, if Git is in your `PATH`), change directories to the root directory of your application, and run the following commands:\n\n        git init\n        git add .\n        git commit -m \"initial commit\"\n        git remote add azure [URL for remote repository]\n        git push azure master\n\n    You will be prompted for the password you created earlier.\n\n3. Browse to **http://[your web app domain]/createtable.php** to create the table for the application.\n4. Browse to **http://[your web app domain]/index.php** to begin using the application.\n\nAfter you have published your application, you can begin making changes to it and use Git to publish them. \n\n##Publish Changes to Your Application\n\nTo publish changes to application, follow these steps:\n\n1. Make changes to your application locally.\n2. Open GitBash (or a terminal, it Git is in your `PATH`), change directories to the root directory of your application, and run the following commands:\n\n        git add .\n        git commit -m \"comment describing changes\"\n        git push azure master\n\n    You will be prompted for the password you created earlier.\n\n3. Browse to **http://[your web app domain]/index.php** to see your changes. \n\n## What's changed\n* For a guide to the change from Websites to App Service see: [Azure App Service and Its Impact on Existing Azure Services](http://go.microsoft.com/fwlink/?LinkId=529714)\n* For a guide to the change of the old portal to the new portal see: [Reference for navigating the portal](http://go.microsoft.com/fwlink/?LinkId=529715)\n\n\n\n\n[install-php]: http://www.php.net/manual/en/install.php\n[install-git]: http://git-scm.com/book/en/Getting-Started-Installing-Git\n[composer-phar]: http://getcomposer.org/composer.phar\n[msdn-errors]: http://msdn.microsoft.com/library/windowsazure/dd179438.aspx\n\n[msdn-table-query-syntax]: http://msdn.microsoft.com/library/windowsazure/dd894031.aspx\n[ws-storage-app]: ./media/web-sites-php-storage/ws-storage-app.png\n[management-portal]: https://portal.azure.com\n\n[storage-quick-create]: ./media/web-sites-php-storage/createstorage.png\n[storage-access-keys]: ./media/web-sites-php-storage/keydetails.png\n\n[setup-git-publishing]: ./media/web-sites-php-storage/setup_git_publishing.png\n[credentials]: ./media/web-sites-php-storage/git-deployment-credentials.png\n\n[git-instructions]: ./media/web-sites-php-storage/git-instructions.png\n \n\ntest\n"
}