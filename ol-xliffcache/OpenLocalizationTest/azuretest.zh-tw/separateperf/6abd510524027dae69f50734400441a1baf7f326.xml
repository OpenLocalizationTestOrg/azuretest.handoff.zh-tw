{
  "nodes": [
    {
      "content": "Compute",
      "pos": [
        2,
        9
      ]
    },
    {
      "content": "Azure enables you to deploy and monitor your application code",
      "pos": [
        11,
        72
      ]
    },
    {
      "content": "running inside a Microsoft data center.",
      "pos": [
        73,
        112
      ]
    },
    {
      "content": "When you create an application",
      "pos": [
        113,
        143
      ]
    },
    {
      "content": "and run it on Azure, the code and configuration together is",
      "pos": [
        144,
        203
      ]
    },
    {
      "content": "called an Azure hosted service.",
      "pos": [
        204,
        235
      ]
    },
    {
      "content": "Hosted services are easy to",
      "pos": [
        236,
        263
      ]
    },
    {
      "content": "manage, scale up and down, reconfigure, and update with new versions of",
      "pos": [
        264,
        335
      ]
    },
    {
      "content": "your application's code.",
      "pos": [
        336,
        360
      ]
    },
    {
      "content": "This article focuses on the Azure",
      "pos": [
        361,
        394
      ]
    },
    {
      "content": "hosted service application model.<ph id=\"ph1\">&lt;a id=\"compare\" name=\"compare\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>",
      "pos": [
        395,
        463
      ]
    },
    {
      "pos": [
        468,
        520
      ],
      "content": "Table of Contents<ph id=\"ph1\">&lt;a id=\"_GoBack\" name=\"_GoBack\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>"
    },
    {
      "content": "Azure Application Model Benefits",
      "pos": [
        527,
        559
      ]
    },
    {
      "content": "Hosted Service Core Concepts",
      "pos": [
        568,
        596
      ]
    },
    {
      "content": "Hosted Service Design Considerations",
      "pos": [
        605,
        641
      ]
    },
    {
      "content": "Designing your Application for Scale",
      "pos": [
        650,
        686
      ]
    },
    {
      "content": "Hosted Service Definition and Configuration",
      "pos": [
        695,
        738
      ]
    },
    {
      "content": "The Service Definition File",
      "pos": [
        747,
        774
      ]
    },
    {
      "content": "The Service Configuration File",
      "pos": [
        783,
        813
      ]
    },
    {
      "content": "Creating and Deploying a Hosted Service",
      "pos": [
        822,
        861
      ]
    },
    {
      "content": "References",
      "pos": [
        870,
        880
      ]
    },
    {
      "pos": [
        888,
        942
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"benefits\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>Azure Application Model Benefits"
    },
    {
      "content": "When you deploy your application as a hosted service, Azure",
      "pos": [
        944,
        1003
      ]
    },
    {
      "content": "creates one or more virtual machines (VMs) that contain your",
      "pos": [
        1004,
        1064
      ]
    },
    {
      "content": "application's code, and boots the VMs on physical machines residing in",
      "pos": [
        1065,
        1135
      ]
    },
    {
      "content": "one of the Azure data centers.",
      "pos": [
        1136,
        1166
      ]
    },
    {
      "content": "As client requests to your hosted",
      "pos": [
        1167,
        1200
      ]
    },
    {
      "content": "application enter the data center, a load balancer distributes these",
      "pos": [
        1201,
        1269
      ]
    },
    {
      "content": "requests equally to the VMs.",
      "pos": [
        1270,
        1298
      ]
    },
    {
      "content": "While your application is hosted in",
      "pos": [
        1299,
        1334
      ]
    },
    {
      "content": "Azure, it gets three key benefits:",
      "pos": [
        1336,
        1370
      ]
    },
    {
      "pos": [
        1376,
        2233
      ],
      "content": "**High availability.** High availability means Azure ensures\nthat your application is running as much as possible and is able to\nrespond to client requests. If your application terminates (due to\nan unhandled exception, for example), then Azure will detect\nthis, and it will automatically re-start your application. If the\nmachine your application is running on experiences some kind of\nhardware failure, then Azure will also detect this and\nautomatically create a new VM on another working physical machine\nand run your code from there. NOTE: In order for your application to\nget Microsoft's Service Level Agreement of 99.95% available, you\nmust have at least two VMs running your application code. This\nallows one VM to process client requests while Azure moves\nyour code from a failed VM to a new, good VM.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**High availability.** High availability means Azure ensures",
          "pos": [
            0,
            60
          ],
          "nodes": [
            {
              "content": "High availability.",
              "pos": [
                2,
                20
              ]
            },
            {
              "content": "High availability means Azure ensures",
              "pos": [
                23,
                60
              ]
            }
          ]
        },
        {
          "content": "that your application is running as much as possible and is able to",
          "pos": [
            61,
            128
          ]
        },
        {
          "content": "respond to client requests. If your application terminates (due to",
          "pos": [
            129,
            195
          ],
          "nodes": [
            {
              "content": "respond to client requests.",
              "pos": [
                0,
                27
              ]
            },
            {
              "content": "If your application terminates (due to",
              "pos": [
                28,
                66
              ]
            }
          ]
        },
        {
          "content": "an unhandled exception, for example), then Azure will detect",
          "pos": [
            196,
            256
          ]
        },
        {
          "content": "this, and it will automatically re-start your application. If the",
          "pos": [
            257,
            322
          ],
          "nodes": [
            {
              "content": "this, and it will automatically re-start your application.",
              "pos": [
                0,
                58
              ]
            },
            {
              "content": "If the",
              "pos": [
                59,
                65
              ]
            }
          ]
        },
        {
          "content": "machine your application is running on experiences some kind of",
          "pos": [
            323,
            386
          ]
        },
        {
          "content": "hardware failure, then Azure will also detect this and",
          "pos": [
            387,
            441
          ]
        },
        {
          "content": "automatically create a new VM on another working physical machine",
          "pos": [
            442,
            507
          ]
        },
        {
          "content": "and run your code from there. NOTE: In order for your application to",
          "pos": [
            508,
            576
          ],
          "nodes": [
            {
              "content": "and run your code from there.",
              "pos": [
                0,
                29
              ]
            },
            {
              "content": "NOTE: In order for your application to",
              "pos": [
                30,
                68
              ]
            }
          ]
        },
        {
          "content": "get Microsoft's Service Level Agreement of 99.95% available, you",
          "pos": [
            577,
            641
          ]
        },
        {
          "content": "must have at least two VMs running your application code. This",
          "pos": [
            642,
            704
          ],
          "nodes": [
            {
              "content": "must have at least two VMs running your application code.",
              "pos": [
                0,
                57
              ]
            },
            {
              "content": "This",
              "pos": [
                58,
                62
              ]
            }
          ]
        },
        {
          "content": "allows one VM to process client requests while Azure moves",
          "pos": [
            705,
            763
          ]
        },
        {
          "content": "your code from a failed VM to a new, good VM.",
          "pos": [
            764,
            809
          ]
        }
      ]
    },
    {
      "pos": [
        2239,
        2753
      ],
      "content": "**Scalability.** Azure lets you easily and dynamically\nchange the number of VMs running your application code to handle the\nactual load being placed on your application. This allows you to\nadjust your application to the workload that your customers are\nplacing on it while paying only for the VMs you need when you need\nthem. When you want to change the number of VMs, Azure\nresponds within minutes making it possible to dynamically change the\nnumber of VMs running as often as desired.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Scalability.** Azure lets you easily and dynamically",
          "pos": [
            0,
            54
          ],
          "nodes": [
            {
              "content": "Scalability.",
              "pos": [
                2,
                14
              ]
            },
            {
              "content": "Azure lets you easily and dynamically",
              "pos": [
                17,
                54
              ]
            }
          ]
        },
        {
          "content": "change the number of VMs running your application code to handle the",
          "pos": [
            55,
            123
          ]
        },
        {
          "content": "actual load being placed on your application. This allows you to",
          "pos": [
            124,
            188
          ],
          "nodes": [
            {
              "content": "actual load being placed on your application.",
              "pos": [
                0,
                45
              ]
            },
            {
              "content": "This allows you to",
              "pos": [
                46,
                64
              ]
            }
          ]
        },
        {
          "content": "adjust your application to the workload that your customers are",
          "pos": [
            189,
            252
          ]
        },
        {
          "content": "placing on it while paying only for the VMs you need when you need",
          "pos": [
            253,
            319
          ]
        },
        {
          "content": "them. When you want to change the number of VMs, Azure",
          "pos": [
            320,
            374
          ],
          "nodes": [
            {
              "content": "them.",
              "pos": [
                0,
                5
              ]
            },
            {
              "content": "When you want to change the number of VMs, Azure",
              "pos": [
                6,
                54
              ]
            }
          ]
        },
        {
          "content": "responds within minutes making it possible to dynamically change the",
          "pos": [
            375,
            443
          ]
        },
        {
          "content": "number of VMs running as often as desired.",
          "pos": [
            444,
            486
          ]
        }
      ]
    },
    {
      "pos": [
        2759,
        3718
      ],
      "content": "**Manageability.** Because Azure is a Platform as a Service\n(PaaS) offering, it manages the infrastructure (the hardware itself,\nelectricity, and networking) required to keep these machines\nrunning. Azure also manages the platform, ensuring an\nup-to-date operating system with all the correct patches and\nsecurity updates, as well as component updates such as the .NET\nFramework and Internet Information Server. Because all the VMs are\nrunning Windows Server 2008, Azure provides additional\nfeatures such as diagnostic monitoring, remote desktop support,\nfirewalls, and certificate store configuration. All these features\nare provided at no extra cost. In fact, when you run your\napplication in Azure, the Windows Server 2008 operating\nsystem (OS) license is included. Since all of the VMs are running\nWindows Server 2008, any code that runs on Windows Server 2008 works\njust fine when running in Azure.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Manageability.** Because Azure is a Platform as a Service",
          "pos": [
            0,
            59
          ],
          "nodes": [
            {
              "content": "Manageability.",
              "pos": [
                2,
                16
              ]
            },
            {
              "content": "Because Azure is a Platform as a Service",
              "pos": [
                19,
                59
              ]
            }
          ]
        },
        {
          "content": "(PaaS) offering, it manages the infrastructure (the hardware itself,",
          "pos": [
            60,
            128
          ]
        },
        {
          "content": "electricity, and networking) required to keep these machines",
          "pos": [
            129,
            189
          ]
        },
        {
          "content": "running. Azure also manages the platform, ensuring an",
          "pos": [
            190,
            243
          ],
          "nodes": [
            {
              "content": "running.",
              "pos": [
                0,
                8
              ]
            },
            {
              "content": "Azure also manages the platform, ensuring an",
              "pos": [
                9,
                53
              ]
            }
          ]
        },
        {
          "content": "up-to-date operating system with all the correct patches and",
          "pos": [
            244,
            304
          ]
        },
        {
          "content": "security updates, as well as component updates such as the .NET",
          "pos": [
            305,
            368
          ]
        },
        {
          "content": "Framework and Internet Information Server. Because all the VMs are",
          "pos": [
            369,
            435
          ],
          "nodes": [
            {
              "content": "Framework and Internet Information Server.",
              "pos": [
                0,
                42
              ]
            },
            {
              "content": "Because all the VMs are",
              "pos": [
                43,
                66
              ]
            }
          ]
        },
        {
          "content": "running Windows Server 2008, Azure provides additional",
          "pos": [
            436,
            490
          ]
        },
        {
          "content": "features such as diagnostic monitoring, remote desktop support,",
          "pos": [
            491,
            554
          ]
        },
        {
          "content": "firewalls, and certificate store configuration. All these features",
          "pos": [
            555,
            621
          ],
          "nodes": [
            {
              "content": "firewalls, and certificate store configuration.",
              "pos": [
                0,
                47
              ]
            },
            {
              "content": "All these features",
              "pos": [
                48,
                66
              ]
            }
          ]
        },
        {
          "content": "are provided at no extra cost. In fact, when you run your",
          "pos": [
            622,
            679
          ],
          "nodes": [
            {
              "content": "are provided at no extra cost.",
              "pos": [
                0,
                30
              ]
            },
            {
              "content": "In fact, when you run your",
              "pos": [
                31,
                57
              ]
            }
          ]
        },
        {
          "content": "application in Azure, the Windows Server 2008 operating",
          "pos": [
            680,
            735
          ]
        },
        {
          "content": "system (OS) license is included. Since all of the VMs are running",
          "pos": [
            736,
            801
          ],
          "nodes": [
            {
              "content": "system (OS) license is included.",
              "pos": [
                0,
                32
              ]
            },
            {
              "content": "Since all of the VMs are running",
              "pos": [
                33,
                65
              ]
            }
          ]
        },
        {
          "content": "Windows Server 2008, any code that runs on Windows Server 2008 works",
          "pos": [
            802,
            870
          ]
        },
        {
          "content": "just fine when running in Azure.",
          "pos": [
            871,
            903
          ]
        }
      ]
    },
    {
      "pos": [
        3723,
        3773
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"concepts\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>Hosted Service Core Concepts"
    },
    {
      "content": "When your application is deployed as a hosted service in Azure,",
      "pos": [
        3775,
        3838
      ]
    },
    {
      "content": "it runs as one or more <bpt id=\"p1\">*</bpt>roles.<ept id=\"p1\">*</ept> A <bpt id=\"p2\">*</bpt>role<ept id=\"p2\">*</ept> simply refers to application",
      "pos": [
        3839,
        3908
      ]
    },
    {
      "content": "files and configuration.",
      "pos": [
        3909,
        3933
      ]
    },
    {
      "content": "You can define one or more roles for your",
      "pos": [
        3934,
        3975
      ]
    },
    {
      "content": "application, each with its own set of application files and",
      "pos": [
        3976,
        4035
      ]
    },
    {
      "content": "configuration.",
      "pos": [
        4036,
        4050
      ]
    },
    {
      "content": "For each role in your application, you can specify the",
      "pos": [
        4051,
        4105
      ]
    },
    {
      "content": "number of VMs, or <bpt id=\"p1\">*</bpt>role instances<ept id=\"p1\">*</ept>, to run.",
      "pos": [
        4106,
        4149
      ]
    },
    {
      "content": "The figure below show two",
      "pos": [
        4150,
        4175
      ]
    },
    {
      "content": "simple examples of an application modeled as a hosted service using",
      "pos": [
        4176,
        4243
      ]
    },
    {
      "content": "roles and role instances.",
      "pos": [
        4244,
        4269
      ]
    },
    {
      "content": "Figure 1: A single role with three instances (VMs) running in an Azure data center",
      "pos": [
        4277,
        4359
      ]
    },
    {
      "content": "image",
      "pos": [
        4363,
        4368
      ]
    },
    {
      "content": "Figure 2: Two roles, each with two instances (VMs), running in an Azure data center",
      "pos": [
        4380,
        4463
      ]
    },
    {
      "content": "image",
      "pos": [
        4467,
        4472
      ]
    },
    {
      "content": "Role instances typically process Internet client requests entering the",
      "pos": [
        4478,
        4548
      ]
    },
    {
      "content": "data center through what is called an <bpt id=\"p1\">*</bpt>input endpoint<ept id=\"p1\">*</ept>.",
      "pos": [
        4549,
        4604
      ]
    },
    {
      "content": "A single role",
      "pos": [
        4605,
        4618
      ]
    },
    {
      "content": "can have 0 or more input endpoints.",
      "pos": [
        4619,
        4654
      ]
    },
    {
      "content": "Each endpoint indicates a protocol",
      "pos": [
        4655,
        4689
      ]
    },
    {
      "content": "(HTTP, HTTPS, or TCP) and a port.",
      "pos": [
        4690,
        4723
      ]
    },
    {
      "content": "It is common to configure a role to",
      "pos": [
        4724,
        4759
      ]
    },
    {
      "content": "have two input endpoints: HTTP listening on port 80 and HTTPS listening",
      "pos": [
        4760,
        4831
      ]
    },
    {
      "content": "on port 443.",
      "pos": [
        4832,
        4844
      ]
    },
    {
      "content": "The figure below shows an example of two different roles",
      "pos": [
        4845,
        4901
      ]
    },
    {
      "content": "with different input endpoints directing client requests to them.",
      "pos": [
        4902,
        4967
      ]
    },
    {
      "content": "image",
      "pos": [
        4971,
        4976
      ]
    },
    {
      "content": "When you create a hosted service in Azure, it is assigned a",
      "pos": [
        4982,
        5041
      ]
    },
    {
      "content": "publicly addressable IP address that clients can use to access it.",
      "pos": [
        5042,
        5108
      ]
    },
    {
      "content": "Upon",
      "pos": [
        5109,
        5113
      ]
    },
    {
      "content": "creating the hosted service you must also select a URL prefix that is",
      "pos": [
        5114,
        5183
      ]
    },
    {
      "content": "mapped to that IP address.",
      "pos": [
        5184,
        5210
      ]
    },
    {
      "content": "This prefix must be unique as you are",
      "pos": [
        5211,
        5248
      ]
    },
    {
      "content": "essentially reserving the <bpt id=\"p1\">*</bpt>prefix<ept id=\"p1\">*</ept>.cloudapp.net URL so that no one else",
      "pos": [
        5249,
        5320
      ]
    },
    {
      "content": "can have it.",
      "pos": [
        5321,
        5333
      ]
    },
    {
      "content": "Clients communicate with your role instances by using the",
      "pos": [
        5334,
        5391
      ]
    },
    {
      "content": "URL.",
      "pos": [
        5392,
        5396
      ]
    },
    {
      "content": "Usually, you will not distribute or publish the Azure",
      "pos": [
        5397,
        5450
      ]
    },
    {
      "content": "<bpt id=\"p1\">*</bpt>prefix<ept id=\"p1\">*</ept>.cloudapp.net URL.",
      "pos": [
        5451,
        5477
      ]
    },
    {
      "content": "Instead, you will purchase a DNS name from",
      "pos": [
        5478,
        5520
      ]
    },
    {
      "content": "your DNS registrar of choice and configure your DNS name to redirect",
      "pos": [
        5521,
        5589
      ]
    },
    {
      "content": "client requests to the Azure URL.",
      "pos": [
        5590,
        5623
      ]
    },
    {
      "content": "For more details, see",
      "pos": [
        5624,
        5645
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>Configuring a Custom Domain Name in Azure<ept id=\"p1\">][]</ept>.",
      "pos": [
        5646,
        5692
      ]
    },
    {
      "pos": [
        5697,
        5761
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"considerations\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>Hosted Service Design Considerations"
    },
    {
      "content": "When designing an application to run in a cloud environment, there are",
      "pos": [
        5763,
        5833
      ]
    },
    {
      "content": "several considerations to think about such as latency,",
      "pos": [
        5834,
        5888
      ]
    },
    {
      "content": "high-availability, and scalability.",
      "pos": [
        5889,
        5924
      ]
    },
    {
      "content": "Deciding where to locate your application code is an important",
      "pos": [
        5926,
        5988
      ]
    },
    {
      "content": "consideration when running a hosted service in Azure.",
      "pos": [
        5989,
        6042
      ]
    },
    {
      "content": "It is",
      "pos": [
        6043,
        6048
      ]
    },
    {
      "content": "common to deploy your application to data centers that are closest to",
      "pos": [
        6049,
        6118
      ]
    },
    {
      "content": "your clients to reduce latency and get the best performance possible.",
      "pos": [
        6119,
        6188
      ]
    },
    {
      "content": "However, you might choose a data center closer to your company or closer",
      "pos": [
        6189,
        6261
      ]
    },
    {
      "content": "to your data if you have some jurisdictional or legal concerns about",
      "pos": [
        6262,
        6330
      ]
    },
    {
      "content": "your data and where it resides.",
      "pos": [
        6331,
        6362
      ]
    },
    {
      "content": "There are six data centers around the",
      "pos": [
        6363,
        6400
      ]
    },
    {
      "content": "globe capable of hosting your application code.",
      "pos": [
        6401,
        6448
      ]
    },
    {
      "content": "The table below shows",
      "pos": [
        6449,
        6470
      ]
    },
    {
      "content": "the available locations:",
      "pos": [
        6471,
        6495
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>Country/Region<ept id=\"p1\">**</ept>",
      "pos": [
        6622,
        6641
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>Sub-regions<ept id=\"p1\">**</ept>",
      "pos": [
        6675,
        6691
      ]
    },
    {
      "content": "United States",
      "pos": [
        6715,
        6728
      ]
    },
    {
      "content": "South Central &amp; North Central",
      "pos": [
        6741,
        6770
      ]
    },
    {
      "content": "Europe",
      "pos": [
        6794,
        6800
      ]
    },
    {
      "content": "North &amp; West",
      "pos": [
        6813,
        6825
      ]
    },
    {
      "content": "Asia",
      "pos": [
        6849,
        6853
      ]
    },
    {
      "content": "Southeast &amp; East",
      "pos": [
        6866,
        6882
      ]
    },
    {
      "content": "When creating a hosted service, you select a sub-region indicating the",
      "pos": [
        6914,
        6984
      ]
    },
    {
      "content": "location in which you want your code to execute.",
      "pos": [
        6985,
        7033
      ]
    },
    {
      "content": "To achieve high availability and scalability, it is critically important",
      "pos": [
        7035,
        7107
      ]
    },
    {
      "content": "that your application's data be kept in a central repository accessible",
      "pos": [
        7108,
        7179
      ]
    },
    {
      "content": "to multiple role instances.",
      "pos": [
        7180,
        7207
      ]
    },
    {
      "content": "To help with this, Azure offers",
      "pos": [
        7208,
        7239
      ]
    },
    {
      "content": "several storage options such as blobs, tables, and SQL Database.",
      "pos": [
        7240,
        7304
      ]
    },
    {
      "content": "Please see",
      "pos": [
        7305,
        7315
      ]
    },
    {
      "content": "the <bpt id=\"p1\">[</bpt>Data Storage Offerings in Azure<ept id=\"p1\">][]</ept> article for more",
      "pos": [
        7316,
        7372
      ]
    },
    {
      "content": "information about these storage technologies.",
      "pos": [
        7373,
        7418
      ]
    },
    {
      "content": "The figure below shows how",
      "pos": [
        7419,
        7445
      ]
    },
    {
      "content": "the load balancer inside the Azure data center distributes",
      "pos": [
        7446,
        7504
      ]
    },
    {
      "content": "client requests to different role instances all of which have access to",
      "pos": [
        7505,
        7576
      ]
    },
    {
      "content": "the same data storage.",
      "pos": [
        7577,
        7599
      ]
    },
    {
      "content": "image",
      "pos": [
        7603,
        7608
      ]
    },
    {
      "content": "Usually, you want to locate your application code and your data in the",
      "pos": [
        7614,
        7684
      ]
    },
    {
      "content": "same data center as this allows for low latency (better performance)",
      "pos": [
        7685,
        7753
      ]
    },
    {
      "content": "when your application code accesses the data.",
      "pos": [
        7754,
        7799
      ]
    },
    {
      "content": "In addition, you are not",
      "pos": [
        7800,
        7824
      ]
    },
    {
      "content": "charged for bandwidth when data is moved around within the same data",
      "pos": [
        7825,
        7893
      ]
    },
    {
      "content": "center.",
      "pos": [
        7894,
        7901
      ]
    },
    {
      "pos": [
        7906,
        7961
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"scale\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>Designing your Application for Scale"
    },
    {
      "content": "Sometimes, you may want to take a single application (like a simple web",
      "pos": [
        7963,
        8034
      ]
    },
    {
      "content": "site) and have it hosted in Azure.",
      "pos": [
        8035,
        8069
      ]
    },
    {
      "content": "But frequently, your",
      "pos": [
        8070,
        8090
      ]
    },
    {
      "content": "application may consist of several roles that all work together.",
      "pos": [
        8091,
        8155
      ]
    },
    {
      "content": "For",
      "pos": [
        8156,
        8159
      ]
    },
    {
      "content": "example, in the figure below, there are two instances of the Website",
      "pos": [
        8160,
        8228
      ]
    },
    {
      "content": "role, three instances of the Order Processing role, and one instance of",
      "pos": [
        8229,
        8300
      ]
    },
    {
      "content": "the Report Generator role.",
      "pos": [
        8301,
        8327
      ]
    },
    {
      "content": "These roles are all working together and the",
      "pos": [
        8328,
        8372
      ]
    },
    {
      "content": "code for all of them can be packaged together and deployed as a single",
      "pos": [
        8373,
        8443
      ]
    },
    {
      "content": "unit up to Azure.",
      "pos": [
        8444,
        8461
      ]
    },
    {
      "content": "image",
      "pos": [
        8465,
        8470
      ]
    },
    {
      "content": "The main reason to split an application into different roles each",
      "pos": [
        8476,
        8541
      ]
    },
    {
      "content": "running on its own set of role instances (that is, VMs) is to scale the",
      "pos": [
        8542,
        8613
      ]
    },
    {
      "content": "roles independently.",
      "pos": [
        8614,
        8634
      ]
    },
    {
      "content": "For example, during the holiday season, many",
      "pos": [
        8635,
        8679
      ]
    },
    {
      "content": "customers may be purchasing products from your company, so you might",
      "pos": [
        8680,
        8748
      ]
    },
    {
      "content": "want to increase the number of role instances running your Website role",
      "pos": [
        8749,
        8820
      ]
    },
    {
      "content": "as well as the number of role instances running your Order Processing",
      "pos": [
        8821,
        8890
      ]
    },
    {
      "content": "role.",
      "pos": [
        8891,
        8896
      ]
    },
    {
      "content": "After the holiday season, you may get a lot of products returned,",
      "pos": [
        8897,
        8962
      ]
    },
    {
      "content": "so you may still need a lot of Website instances but fewer Order",
      "pos": [
        8963,
        9027
      ]
    },
    {
      "content": "Processing instances.",
      "pos": [
        9028,
        9049
      ]
    },
    {
      "content": "During the rest of the year, you may only need a",
      "pos": [
        9050,
        9098
      ]
    },
    {
      "content": "few Website and Order Processing instances.",
      "pos": [
        9099,
        9142
      ]
    },
    {
      "content": "Throughout all of this, you",
      "pos": [
        9143,
        9170
      ]
    },
    {
      "content": "may need only one Report Generator instance.",
      "pos": [
        9171,
        9215
      ]
    },
    {
      "content": "The flexibility of",
      "pos": [
        9216,
        9234
      ]
    },
    {
      "content": "role-based deployments in Azure enables you to easily adapt your",
      "pos": [
        9235,
        9299
      ]
    },
    {
      "content": "application to your business needs.",
      "pos": [
        9300,
        9335
      ]
    },
    {
      "content": "It's common to have the role instances within your hosted service",
      "pos": [
        9337,
        9402
      ]
    },
    {
      "content": "communicate with each other.",
      "pos": [
        9403,
        9431
      ]
    },
    {
      "content": "For example, the website role accepts a",
      "pos": [
        9432,
        9471
      ]
    },
    {
      "content": "customer's order but then it offloads the order processing to the Order",
      "pos": [
        9472,
        9543
      ]
    },
    {
      "content": "Processing role instances.",
      "pos": [
        9544,
        9570
      ]
    },
    {
      "content": "The best way to pass work form one set of",
      "pos": [
        9571,
        9612
      ]
    },
    {
      "content": "role instances to another set of instances is using the queuing",
      "pos": [
        9613,
        9676
      ]
    },
    {
      "content": "technology provided by Azure, either the Queue Service or",
      "pos": [
        9677,
        9734
      ]
    },
    {
      "content": "Service Bus Queues.",
      "pos": [
        9735,
        9754
      ]
    },
    {
      "content": "The use of a queue is a critical part of the story",
      "pos": [
        9755,
        9805
      ]
    },
    {
      "content": "here.",
      "pos": [
        9806,
        9811
      ]
    },
    {
      "content": "The queue allows the hosted service to scale its roles",
      "pos": [
        9812,
        9866
      ]
    },
    {
      "content": "independently allowing you to balance the workload against cost.",
      "pos": [
        9867,
        9931
      ]
    },
    {
      "content": "If the",
      "pos": [
        9932,
        9938
      ]
    },
    {
      "content": "number of messages in the queue increases over time, then you can scale",
      "pos": [
        9939,
        10010
      ]
    },
    {
      "content": "up the number of Order Processing role instances.",
      "pos": [
        10011,
        10060
      ]
    },
    {
      "content": "If the number of",
      "pos": [
        10061,
        10077
      ]
    },
    {
      "content": "messages in the queue decreases over time, then you can scale down the",
      "pos": [
        10078,
        10148
      ]
    },
    {
      "content": "number of Order Processing role instances.",
      "pos": [
        10149,
        10191
      ]
    },
    {
      "content": "This way, you are only paying",
      "pos": [
        10192,
        10221
      ]
    },
    {
      "content": "for the instances required to handle the actual workload.",
      "pos": [
        10222,
        10279
      ]
    },
    {
      "content": "The queue also provides reliability.",
      "pos": [
        10281,
        10317
      ]
    },
    {
      "content": "When scaling down the number of",
      "pos": [
        10318,
        10349
      ]
    },
    {
      "content": "Order Processing role instances, Azure decides which instances",
      "pos": [
        10350,
        10412
      ]
    },
    {
      "content": "to terminate.",
      "pos": [
        10413,
        10426
      ]
    },
    {
      "content": "It may decide to terminate an instance that is in the",
      "pos": [
        10427,
        10480
      ]
    },
    {
      "content": "middle of processing a queue message.",
      "pos": [
        10481,
        10518
      ]
    },
    {
      "content": "However, because the message",
      "pos": [
        10519,
        10547
      ]
    },
    {
      "content": "processing does not complete successfully, the message becomes visible",
      "pos": [
        10548,
        10618
      ]
    },
    {
      "content": "again to another Order Processing role instance that picks it up and",
      "pos": [
        10619,
        10687
      ]
    },
    {
      "content": "processes it.",
      "pos": [
        10688,
        10701
      ]
    },
    {
      "content": "Because of queue message visibility, messages are",
      "pos": [
        10702,
        10751
      ]
    },
    {
      "content": "guaranteed to eventually get processed.",
      "pos": [
        10752,
        10791
      ]
    },
    {
      "content": "The queue also acts as a load",
      "pos": [
        10792,
        10821
      ]
    },
    {
      "content": "balancer by effectively distributing its messages to any and all role",
      "pos": [
        10822,
        10891
      ]
    },
    {
      "content": "instances that request messages from it.",
      "pos": [
        10892,
        10932
      ]
    },
    {
      "content": "For the Website role instances, you can monitor the traffic coming into",
      "pos": [
        10934,
        11005
      ]
    },
    {
      "content": "them and decide to scale the number of them up or down as well.",
      "pos": [
        11006,
        11069
      ]
    },
    {
      "content": "The",
      "pos": [
        11070,
        11073
      ]
    },
    {
      "content": "queue allows you to scale the number of Website role instances",
      "pos": [
        11074,
        11136
      ]
    },
    {
      "content": "independently of the Order Processing role instances.",
      "pos": [
        11137,
        11190
      ]
    },
    {
      "content": "This is very",
      "pos": [
        11191,
        11203
      ]
    },
    {
      "content": "powerful and gives you a lot of flexibility.",
      "pos": [
        11204,
        11248
      ]
    },
    {
      "content": "Of course, if your",
      "pos": [
        11249,
        11267
      ]
    },
    {
      "content": "application consists of additional roles, you could add additional",
      "pos": [
        11268,
        11334
      ]
    },
    {
      "content": "queues as the conduit to communicate between them in order to leverage",
      "pos": [
        11335,
        11405
      ]
    },
    {
      "content": "the same scaling and cost benefits.",
      "pos": [
        11406,
        11441
      ]
    },
    {
      "pos": [
        11446,
        11512
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"defandcfg\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>Hosted Service Definition and Configuration"
    },
    {
      "content": "Deploying a hosted service to Azure requires you to also have a",
      "pos": [
        11514,
        11577
      ]
    },
    {
      "content": "service definition file and a service configuration file.",
      "pos": [
        11578,
        11635
      ]
    },
    {
      "content": "Both of these",
      "pos": [
        11636,
        11649
      ]
    },
    {
      "content": "files are XML files, and they allow you to declaratively specify",
      "pos": [
        11650,
        11714
      ]
    },
    {
      "content": "deployment options for your hosted service.",
      "pos": [
        11715,
        11758
      ]
    },
    {
      "content": "The service definition file",
      "pos": [
        11759,
        11786
      ]
    },
    {
      "content": "describes all of the roles that make up your hosted service and how they",
      "pos": [
        11787,
        11859
      ]
    },
    {
      "content": "communicate.",
      "pos": [
        11860,
        11872
      ]
    },
    {
      "content": "The service configuration file describes the number of",
      "pos": [
        11873,
        11927
      ]
    },
    {
      "content": "instances for each role and settings used to configure each role",
      "pos": [
        11928,
        11992
      ]
    },
    {
      "content": "instance.",
      "pos": [
        11993,
        12002
      ]
    },
    {
      "pos": [
        12007,
        12051
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"def\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>The Service Definition File"
    },
    {
      "content": "As I mentioned earlier, the service definition (CSDEF) file is an XML",
      "pos": [
        12053,
        12122
      ]
    },
    {
      "content": "file that describes the various roles that make up your complete",
      "pos": [
        12123,
        12187
      ]
    },
    {
      "content": "application.",
      "pos": [
        12188,
        12200
      ]
    },
    {
      "content": "The complete schema for the XML file can be found here:",
      "pos": [
        12201,
        12256
      ]
    },
    {
      "content": "[http://msdn.microsoft.com/library/windowsazure/ee758711.aspx][].",
      "pos": [
        12257,
        12322
      ]
    },
    {
      "content": "The CSDEF file contains a WebRole or WorkerRole element for each role",
      "pos": [
        12323,
        12392
      ]
    },
    {
      "content": "that you want in your application.",
      "pos": [
        12393,
        12427
      ]
    },
    {
      "content": "Deploying a role as a web role (using",
      "pos": [
        12428,
        12465
      ]
    },
    {
      "content": "the WebRole element) means that the code will run on a role instance",
      "pos": [
        12466,
        12534
      ]
    },
    {
      "content": "containing Windows Server 2008 and Internet Information Server (IIS).",
      "pos": [
        12535,
        12604
      ]
    },
    {
      "content": "Deploying a role as a worker role (using the WorkerRole element) means",
      "pos": [
        12605,
        12675
      ]
    },
    {
      "content": "that the role instance will have Windows Server 2008 on it (IIS will not",
      "pos": [
        12676,
        12748
      ]
    },
    {
      "content": "be installed).",
      "pos": [
        12749,
        12763
      ]
    },
    {
      "content": "You can certainly create and deploy a worker role that uses some other",
      "pos": [
        12765,
        12835
      ]
    },
    {
      "content": "mechanism to listen for incoming web requests (for example, your code",
      "pos": [
        12836,
        12905
      ]
    },
    {
      "content": "could create and use a .NET HttpListener).",
      "pos": [
        12906,
        12948
      ]
    },
    {
      "content": "Since the role instances are",
      "pos": [
        12949,
        12977
      ]
    },
    {
      "content": "all running Windows Server 2008, your code can perform any operations",
      "pos": [
        12978,
        13047
      ]
    },
    {
      "content": "that are normally available to an application running on Windows Server",
      "pos": [
        13048,
        13119
      ]
    },
    {
      "content": "For each role, you indicate the desired VM size that instances of that",
      "pos": [
        13127,
        13197
      ]
    },
    {
      "content": "role should use.",
      "pos": [
        13198,
        13214
      ]
    },
    {
      "content": "The table below shows the various VM sizes available",
      "pos": [
        13215,
        13267
      ]
    },
    {
      "content": "today and the attributes of each:",
      "pos": [
        13268,
        13301
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>VM Size<ept id=\"p1\">**</ept>",
      "pos": [
        13432,
        13444
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>CPU<ept id=\"p1\">**</ept>",
      "pos": [
        13456,
        13464
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>RAM<ept id=\"p1\">**</ept>",
      "pos": [
        13476,
        13484
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>Disk<ept id=\"p1\">**</ept>",
      "pos": [
        13496,
        13505
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>Peak  \nNetwork I/O<ept id=\"p1\">**</ept>",
      "pos": [
        13517,
        13540
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>Extra Small<ept id=\"p1\">**</ept>",
      "pos": [
        13589,
        13605
      ]
    },
    {
      "content": "1 x 1.0 GHz",
      "pos": [
        13618,
        13629
      ]
    },
    {
      "content": "768 MB",
      "pos": [
        13642,
        13648
      ]
    },
    {
      "content": "20GB",
      "pos": [
        13661,
        13665
      ]
    },
    {
      "content": "\\~5 Mbps",
      "pos": [
        13678,
        13686
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>Small<ept id=\"p1\">**</ept>",
      "pos": [
        13735,
        13745
      ]
    },
    {
      "content": "1 x 1.6 GHz",
      "pos": [
        13758,
        13769
      ]
    },
    {
      "content": "1.75 GB",
      "pos": [
        13782,
        13789
      ]
    },
    {
      "content": "225GB",
      "pos": [
        13802,
        13807
      ]
    },
    {
      "content": "\\~100 Mbps",
      "pos": [
        13820,
        13830
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>Medium<ept id=\"p1\">**</ept>",
      "pos": [
        13879,
        13890
      ]
    },
    {
      "content": "2 x 1.6 GHz",
      "pos": [
        13903,
        13914
      ]
    },
    {
      "content": "3.5 GB",
      "pos": [
        13927,
        13933
      ]
    },
    {
      "content": "490GB",
      "pos": [
        13946,
        13951
      ]
    },
    {
      "content": "\\~200 Mbps",
      "pos": [
        13964,
        13974
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>Large<ept id=\"p1\">**</ept>",
      "pos": [
        14023,
        14033
      ]
    },
    {
      "content": "4 x 1.6 GHz",
      "pos": [
        14046,
        14057
      ]
    },
    {
      "content": "7 GB",
      "pos": [
        14070,
        14074
      ]
    },
    {
      "content": "1TB",
      "pos": [
        14087,
        14090
      ]
    },
    {
      "content": "\\~400 Mbps",
      "pos": [
        14103,
        14113
      ]
    },
    {
      "content": "<bpt id=\"p1\">\n**</bpt>Extra Large<ept id=\"p1\">**</ept>",
      "pos": [
        14162,
        14178
      ]
    },
    {
      "content": "8 x 1.6 GHz",
      "pos": [
        14191,
        14202
      ]
    },
    {
      "content": "14 GB",
      "pos": [
        14215,
        14220
      ]
    },
    {
      "content": "2TB",
      "pos": [
        14233,
        14236
      ]
    },
    {
      "content": "\\~800 Mbps",
      "pos": [
        14249,
        14259
      ]
    },
    {
      "content": "You are charged hourly for each VM you use as a role instance and you",
      "pos": [
        14291,
        14360
      ]
    },
    {
      "content": "are also charged for any data that your role instances send outside the",
      "pos": [
        14361,
        14432
      ]
    },
    {
      "content": "data center.",
      "pos": [
        14433,
        14445
      ]
    },
    {
      "content": "You are not charged for data entering the data center.",
      "pos": [
        14446,
        14500
      ]
    },
    {
      "content": "For",
      "pos": [
        14501,
        14504
      ]
    },
    {
      "content": "more information, see [Azure Pricing][].",
      "pos": [
        14505,
        14545
      ]
    },
    {
      "content": "In general, it is",
      "pos": [
        14546,
        14563
      ]
    },
    {
      "content": "advisable to use many small role instances as opposed to a few large",
      "pos": [
        14564,
        14632
      ]
    },
    {
      "content": "instances so that your application is more resilient to failure.",
      "pos": [
        14633,
        14697
      ]
    },
    {
      "content": "After",
      "pos": [
        14698,
        14703
      ]
    },
    {
      "content": "all, the fewer role instances you have, the more disastrous a failure in",
      "pos": [
        14704,
        14776
      ]
    },
    {
      "content": "one of them is to your overall application.",
      "pos": [
        14777,
        14820
      ]
    },
    {
      "content": "Also, as mentioned before,",
      "pos": [
        14821,
        14847
      ]
    },
    {
      "content": "you must deploy at least two instances for each role in order to get the",
      "pos": [
        14848,
        14920
      ]
    },
    {
      "content": "99.95% service level agreement Microsoft provides.",
      "pos": [
        14921,
        14971
      ]
    },
    {
      "content": "The service definition (CSDEF) file is also where you would specify many",
      "pos": [
        14973,
        15045
      ]
    },
    {
      "content": "attributes about each role in your application.",
      "pos": [
        15046,
        15093
      ]
    },
    {
      "content": "Here are some of the",
      "pos": [
        15094,
        15114
      ]
    },
    {
      "content": "more useful items available to you:",
      "pos": [
        15115,
        15150
      ]
    },
    {
      "pos": [
        15156,
        15532
      ],
      "content": "**Certificates**. You use certificates for encrypting data or if\nyour web service supports SSL. Any certificates need to be uploaded\nto Azure. For more information, see [Managing Certificates\nin Azure][]. This XML setting installs previously-uploaded\ncertificates into the role instance's certificate store so that they\nare usable by your application code.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Certificates**. You use certificates for encrypting data or if",
          "pos": [
            0,
            64
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Certificates<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                17
              ]
            },
            {
              "content": "You use certificates for encrypting data or if",
              "pos": [
                18,
                64
              ]
            }
          ]
        },
        {
          "content": "your web service supports SSL. Any certificates need to be uploaded",
          "pos": [
            65,
            132
          ],
          "nodes": [
            {
              "content": "your web service supports SSL.",
              "pos": [
                0,
                30
              ]
            },
            {
              "content": "Any certificates need to be uploaded",
              "pos": [
                31,
                67
              ]
            }
          ]
        },
        {
          "content": "to Azure. For more information, see [Managing Certificates\nin Azure][]. This XML setting installs previously-uploaded",
          "pos": [
            133,
            250
          ],
          "nodes": [
            {
              "content": "to Azure.",
              "pos": [
                0,
                9
              ]
            },
            {
              "content": "For more information, see <bpt id=\"p1\">[</bpt>Managing Certificates\nin Azure<ept id=\"p1\">][]</ept>.",
              "pos": [
                10,
                71
              ]
            },
            {
              "content": "This XML setting installs previously-uploaded",
              "pos": [
                72,
                117
              ]
            }
          ]
        },
        {
          "content": "certificates into the role instance's certificate store so that they",
          "pos": [
            251,
            319
          ]
        },
        {
          "content": "are usable by your application code.",
          "pos": [
            320,
            356
          ]
        }
      ]
    },
    {
      "pos": [
        15538,
        15984
      ],
      "content": "**Configuration Setting Names**. For values that you want your\napplication(s) to read while running on a role instance. The actual\nvalue of the configuration settings is set in the service\nconfiguration (CSCFG) file which can be updated at any time without\nrequiring you to redeploy your code. In fact, you can code your\napplications in such a way to detect the changed configuration\nvalues without incurring any downtime.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Configuration Setting Names**. For values that you want your",
          "pos": [
            0,
            62
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Configuration Setting Names<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                32
              ]
            },
            {
              "content": "For values that you want your",
              "pos": [
                33,
                62
              ]
            }
          ]
        },
        {
          "content": "application(s) to read while running on a role instance. The actual",
          "pos": [
            63,
            130
          ],
          "nodes": [
            {
              "content": "application(s) to read while running on a role instance.",
              "pos": [
                0,
                56
              ]
            },
            {
              "content": "The actual",
              "pos": [
                57,
                67
              ]
            }
          ]
        },
        {
          "content": "value of the configuration settings is set in the service",
          "pos": [
            131,
            188
          ]
        },
        {
          "content": "configuration (CSCFG) file which can be updated at any time without",
          "pos": [
            189,
            256
          ]
        },
        {
          "content": "requiring you to redeploy your code. In fact, you can code your",
          "pos": [
            257,
            320
          ],
          "nodes": [
            {
              "content": "requiring you to redeploy your code.",
              "pos": [
                0,
                36
              ]
            },
            {
              "content": "In fact, you can code your",
              "pos": [
                37,
                63
              ]
            }
          ]
        },
        {
          "content": "applications in such a way to detect the changed configuration",
          "pos": [
            321,
            383
          ]
        },
        {
          "content": "values without incurring any downtime.",
          "pos": [
            384,
            422
          ]
        }
      ]
    },
    {
      "pos": [
        15990,
        16268
      ],
      "content": "**Input Endpoints**. Here you specify any HTTP, HTTPS, or TCP\nendpoints (with ports) that you want to expose to the outside world\nvia your *prefix*.cloadapp.net URL. When Azure deploys your\nrole, it will configure the firewall on the role instance\nautomatically.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Input Endpoints**. Here you specify any HTTP, HTTPS, or TCP",
          "pos": [
            0,
            61
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Input Endpoints<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                20
              ]
            },
            {
              "content": "Here you specify any HTTP, HTTPS, or TCP",
              "pos": [
                21,
                61
              ]
            }
          ]
        },
        {
          "content": "endpoints (with ports) that you want to expose to the outside world",
          "pos": [
            62,
            129
          ]
        },
        {
          "content": "via your *prefix*.cloadapp.net URL. When Azure deploys your",
          "pos": [
            130,
            189
          ],
          "nodes": [
            {
              "content": "via your <bpt id=\"p1\">*</bpt>prefix<ept id=\"p1\">*</ept>.cloadapp.net URL.",
              "pos": [
                0,
                35
              ]
            },
            {
              "content": "When Azure deploys your",
              "pos": [
                36,
                59
              ]
            }
          ]
        },
        {
          "content": "role, it will configure the firewall on the role instance",
          "pos": [
            190,
            247
          ]
        },
        {
          "content": "automatically.",
          "pos": [
            248,
            262
          ]
        }
      ]
    },
    {
      "pos": [
        16274,
        16623
      ],
      "content": "**Internal Endpoints**. Here you specify any HTTP or TCP endpoints\nthat you want exposed to other role instances that are deployed as\npart of your application. Internal endpoints allow all the role\ninstances within your application to talk to each other but are not\naccessible to any role instances that are outside your application.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Internal Endpoints**. Here you specify any HTTP or TCP endpoints",
          "pos": [
            0,
            66
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Internal Endpoints<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                23
              ]
            },
            {
              "content": "Here you specify any HTTP or TCP endpoints",
              "pos": [
                24,
                66
              ]
            }
          ]
        },
        {
          "content": "that you want exposed to other role instances that are deployed as",
          "pos": [
            67,
            133
          ]
        },
        {
          "content": "part of your application. Internal endpoints allow all the role",
          "pos": [
            134,
            197
          ],
          "nodes": [
            {
              "content": "part of your application.",
              "pos": [
                0,
                25
              ]
            },
            {
              "content": "Internal endpoints allow all the role",
              "pos": [
                26,
                63
              ]
            }
          ]
        },
        {
          "content": "instances within your application to talk to each other but are not",
          "pos": [
            198,
            265
          ]
        },
        {
          "content": "accessible to any role instances that are outside your application.",
          "pos": [
            266,
            333
          ]
        }
      ]
    },
    {
      "pos": [
        16629,
        16897
      ],
      "content": "**Import Modules**. These optionally install useful components on\nyour role instances. Components exist for diagnostic monitoring,\nremote desktop, and Azure Connect (which allows your role\ninstance to access on-premises resources through a secure channel).",
      "leadings": [
        "",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Import Modules**. These optionally install useful components on",
          "pos": [
            0,
            65
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Import Modules<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                19
              ]
            },
            {
              "content": "These optionally install useful components on",
              "pos": [
                20,
                65
              ]
            }
          ]
        },
        {
          "content": "your role instances. Components exist for diagnostic monitoring,",
          "pos": [
            66,
            130
          ],
          "nodes": [
            {
              "content": "your role instances.",
              "pos": [
                0,
                20
              ]
            },
            {
              "content": "Components exist for diagnostic monitoring,",
              "pos": [
                21,
                64
              ]
            }
          ]
        },
        {
          "content": "remote desktop, and Azure Connect (which allows your role",
          "pos": [
            131,
            188
          ]
        },
        {
          "content": "instance to access on-premises resources through a secure channel).",
          "pos": [
            189,
            256
          ]
        }
      ]
    },
    {
      "pos": [
        16903,
        17092
      ],
      "content": "**Local Storage**. This allocates a subdirectory on the role\ninstance for your application to use. It is described in more detail\nin the [Data Storage Offerings in Azure][] article.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Local Storage**. This allocates a subdirectory on the role",
          "pos": [
            0,
            60
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Local Storage<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                18
              ]
            },
            {
              "content": "This allocates a subdirectory on the role",
              "pos": [
                19,
                60
              ]
            }
          ]
        },
        {
          "content": "instance for your application to use. It is described in more detail",
          "pos": [
            61,
            129
          ],
          "nodes": [
            {
              "content": "instance for your application to use.",
              "pos": [
                0,
                37
              ]
            },
            {
              "content": "It is described in more detail",
              "pos": [
                38,
                68
              ]
            }
          ]
        },
        {
          "content": "in the <bpt id=\"p1\">[</bpt>Data Storage Offerings in Azure<ept id=\"p1\">][]</ept> article.",
          "pos": [
            130,
            181
          ]
        }
      ]
    },
    {
      "pos": [
        17098,
        17283
      ],
      "content": "**Startup Tasks**. Startup tasks give you a way to install\nprerequisite components on a role instance as it boots up. The tasks\ncan run elevated as an administrator if required.",
      "leadings": [
        "",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Startup Tasks**. Startup tasks give you a way to install",
          "pos": [
            0,
            58
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Startup Tasks<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                18
              ]
            },
            {
              "content": "Startup tasks give you a way to install",
              "pos": [
                19,
                58
              ]
            }
          ]
        },
        {
          "content": "prerequisite components on a role instance as it boots up. The tasks",
          "pos": [
            59,
            127
          ],
          "nodes": [
            {
              "content": "prerequisite components on a role instance as it boots up.",
              "pos": [
                0,
                58
              ]
            },
            {
              "content": "The tasks",
              "pos": [
                59,
                68
              ]
            }
          ]
        },
        {
          "content": "can run elevated as an administrator if required.",
          "pos": [
            128,
            177
          ]
        }
      ]
    },
    {
      "pos": [
        17288,
        17335
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"cfg\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>The Service Configuration File"
    },
    {
      "content": "The service configuration (CSCFG) file is an XML file that describes",
      "pos": [
        17337,
        17405
      ]
    },
    {
      "content": "settings that can be changed without redeploying your application.",
      "pos": [
        17406,
        17472
      ]
    },
    {
      "content": "The",
      "pos": [
        17473,
        17476
      ]
    },
    {
      "content": "complete schema for the XML file can be found here:",
      "pos": [
        17477,
        17528
      ]
    },
    {
      "content": "<bpt id=\"p1\">[</bpt>http://msdn.microsoft.com/library/windowsazure/ee758710.aspx<ept id=\"p1\">][]</ept>.",
      "pos": [
        17529,
        17594
      ]
    },
    {
      "content": "The CSCFG file contains a Role element for each role in your",
      "pos": [
        17595,
        17655
      ]
    },
    {
      "content": "application.",
      "pos": [
        17656,
        17668
      ]
    },
    {
      "content": "Here are some of the items you can specify in the CSCFG",
      "pos": [
        17669,
        17724
      ]
    },
    {
      "content": "file:",
      "pos": [
        17725,
        17730
      ]
    },
    {
      "pos": [
        17736,
        18670
      ],
      "content": "**OS Version**. This attribute allows you to select the operating\nsystem (OS) version you want used for all the role instances running\nyour application code. This OS is known as the *guest OS*, and each\nnew version includes the latest security patches and updates\navailable at the time the guest OS is released. If you set the\nosVersion attribute value to \"\\*\", then Azure automatically\nupdates the guest OS on each of your role instances as new guest OS\nversions become available. However, you can opt out of automatic\nupdates by selecting a specific guest OS version. For example,\nsetting the osVersion attribute to a value of\n\"WA-GUEST-OS-2.8\\_201109-01\" causes all your role instances to get\nwhat is described on this web page:\n[http://msdn.microsoft.com/library/hh560567.aspx][]. For more\ninformation about guest OS versions, see [Managing Upgrades to the\nAzure Guests OS].",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**OS Version**. This attribute allows you to select the operating",
          "pos": [
            0,
            65
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>OS Version<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                15
              ]
            },
            {
              "content": "This attribute allows you to select the operating",
              "pos": [
                16,
                65
              ]
            }
          ]
        },
        {
          "content": "system (OS) version you want used for all the role instances running",
          "pos": [
            66,
            134
          ]
        },
        {
          "content": "your application code. This OS is known as the *guest OS*, and each",
          "pos": [
            135,
            202
          ],
          "nodes": [
            {
              "content": "your application code.",
              "pos": [
                0,
                22
              ]
            },
            {
              "content": "This OS is known as the <bpt id=\"p1\">*</bpt>guest OS<ept id=\"p1\">*</ept>, and each",
              "pos": [
                23,
                67
              ]
            }
          ]
        },
        {
          "content": "new version includes the latest security patches and updates",
          "pos": [
            203,
            263
          ]
        },
        {
          "content": "available at the time the guest OS is released. If you set the",
          "pos": [
            264,
            326
          ],
          "nodes": [
            {
              "content": "available at the time the guest OS is released.",
              "pos": [
                0,
                47
              ]
            },
            {
              "content": "If you set the",
              "pos": [
                48,
                62
              ]
            }
          ]
        },
        {
          "content": "osVersion attribute value to \"\\*\", then Azure automatically",
          "pos": [
            327,
            386
          ]
        },
        {
          "content": "updates the guest OS on each of your role instances as new guest OS",
          "pos": [
            387,
            454
          ]
        },
        {
          "content": "versions become available. However, you can opt out of automatic",
          "pos": [
            455,
            519
          ],
          "nodes": [
            {
              "content": "versions become available.",
              "pos": [
                0,
                26
              ]
            },
            {
              "content": "However, you can opt out of automatic",
              "pos": [
                27,
                64
              ]
            }
          ]
        },
        {
          "content": "updates by selecting a specific guest OS version. For example,",
          "pos": [
            520,
            582
          ],
          "nodes": [
            {
              "content": "updates by selecting a specific guest OS version.",
              "pos": [
                0,
                49
              ]
            },
            {
              "content": "For example,",
              "pos": [
                50,
                62
              ]
            }
          ]
        },
        {
          "content": "setting the osVersion attribute to a value of",
          "pos": [
            583,
            628
          ]
        },
        {
          "content": "\"WA-GUEST-OS-2.8\\_201109-01\" causes all your role instances to get",
          "pos": [
            629,
            695
          ]
        },
        {
          "content": "what is described on this web page:",
          "pos": [
            696,
            731
          ]
        },
        {
          "content": "[http://msdn.microsoft.com/library/hh560567.aspx][]. For more",
          "pos": [
            732,
            793
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">[</bpt>http://msdn.microsoft.com/library/hh560567.aspx<ept id=\"p1\">][]</ept>.",
              "pos": [
                0,
                52
              ]
            },
            {
              "content": "For more",
              "pos": [
                53,
                61
              ]
            }
          ]
        },
        {
          "content": "information about guest OS versions, see <bpt id=\"p1\">[</bpt><ph id=\"ph1\">Managing Upgrades to the</ph>\nAzure Guests OS<ept id=\"p1\">]</ept>.",
          "pos": [
            794,
            878
          ]
        }
      ]
    },
    {
      "pos": [
        18676,
        19286
      ],
      "content": "**Instances**. This element's value indicates the number of role\ninstances you want provisioned running the code for a particular\nrole. Since you can upload a new CSCFG file to Azure\n(without redeploying your application), it is trivially simple to\nchange the value for this element and upload a new CSCFG file to\ndynamically increase or decrease the number of role instances\nrunning your application code. This allows you to easily scale your\napplication up or down to meet actual workload demands while also\ncontrolling how much you are charged for running the role instances.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Instances**. This element's value indicates the number of role",
          "pos": [
            0,
            64
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Instances<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                14
              ]
            },
            {
              "content": "This element's value indicates the number of role",
              "pos": [
                15,
                64
              ]
            }
          ]
        },
        {
          "content": "instances you want provisioned running the code for a particular",
          "pos": [
            65,
            129
          ]
        },
        {
          "content": "role. Since you can upload a new CSCFG file to Azure",
          "pos": [
            130,
            182
          ],
          "nodes": [
            {
              "content": "role.",
              "pos": [
                0,
                5
              ]
            },
            {
              "content": "Since you can upload a new CSCFG file to Azure",
              "pos": [
                6,
                52
              ]
            }
          ]
        },
        {
          "content": "(without redeploying your application), it is trivially simple to",
          "pos": [
            183,
            248
          ]
        },
        {
          "content": "change the value for this element and upload a new CSCFG file to",
          "pos": [
            249,
            313
          ]
        },
        {
          "content": "dynamically increase or decrease the number of role instances",
          "pos": [
            314,
            375
          ]
        },
        {
          "content": "running your application code. This allows you to easily scale your",
          "pos": [
            376,
            443
          ],
          "nodes": [
            {
              "content": "running your application code.",
              "pos": [
                0,
                30
              ]
            },
            {
              "content": "This allows you to easily scale your",
              "pos": [
                31,
                67
              ]
            }
          ]
        },
        {
          "content": "application up or down to meet actual workload demands while also",
          "pos": [
            444,
            509
          ]
        },
        {
          "content": "controlling how much you are charged for running the role instances.",
          "pos": [
            510,
            578
          ]
        }
      ]
    },
    {
      "pos": [
        19292,
        19634
      ],
      "content": "**Configuration Setting Values**. This element indicates values for\nsettings (as defined in the CSDEF file). Your role can read these\nvalues while it is running. These configuration settings values are\ntypically used for connection strings to SQL Database or to \nAzure Storage, but they can be used for any purpose you desire.",
      "leadings": [
        "",
        "    ",
        "    ",
        "    ",
        "    "
      ],
      "nodes": [
        {
          "content": "**Configuration Setting Values**. This element indicates values for",
          "pos": [
            0,
            67
          ],
          "nodes": [
            {
              "content": "<bpt id=\"p1\">**</bpt>Configuration Setting Values<ept id=\"p1\">**</ept>.",
              "pos": [
                0,
                33
              ]
            },
            {
              "content": "This element indicates values for",
              "pos": [
                34,
                67
              ]
            }
          ]
        },
        {
          "content": "settings (as defined in the CSDEF file). Your role can read these",
          "pos": [
            68,
            133
          ],
          "nodes": [
            {
              "content": "settings (as defined in the CSDEF file).",
              "pos": [
                0,
                40
              ]
            },
            {
              "content": "Your role can read these",
              "pos": [
                41,
                65
              ]
            }
          ]
        },
        {
          "content": "values while it is running. These configuration settings values are",
          "pos": [
            134,
            201
          ],
          "nodes": [
            {
              "content": "values while it is running.",
              "pos": [
                0,
                27
              ]
            },
            {
              "content": "These configuration settings values are",
              "pos": [
                28,
                67
              ]
            }
          ]
        },
        {
          "content": "typically used for connection strings to SQL Database or to",
          "pos": [
            202,
            261
          ]
        },
        {
          "content": "Azure Storage, but they can be used for any purpose you desire.",
          "pos": [
            263,
            326
          ]
        }
      ]
    },
    {
      "pos": [
        19639,
        19706
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"hostedservices\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>Creating and Deploying a Hosted Service"
    },
    {
      "content": "Creating a hosted service requires that you first go to the <bpt id=\"p1\">[</bpt><ept id=\"p1\">Azure Management Portal]</ept> and provision a hosted service by specifying",
      "pos": [
        19708,
        19838
      ]
    },
    {
      "content": "a DNS prefix and the data center you ultimately want your code running",
      "pos": [
        19839,
        19909
      ]
    },
    {
      "content": "in.",
      "pos": [
        19910,
        19913
      ]
    },
    {
      "content": "Then in your development environment, you create your service",
      "pos": [
        19914,
        19975
      ]
    },
    {
      "content": "definition (CSDEF) file, build your application code and package (zip)",
      "pos": [
        19976,
        20046
      ]
    },
    {
      "content": "all these files into a service package (CSPKG) file.",
      "pos": [
        20047,
        20099
      ]
    },
    {
      "content": "You must also",
      "pos": [
        20100,
        20113
      ]
    },
    {
      "content": "prepare your service configuration (CSCFG) file.",
      "pos": [
        20114,
        20162
      ]
    },
    {
      "content": "To deploy your role,",
      "pos": [
        20163,
        20183
      ]
    },
    {
      "content": "you upload the CSPKG and CSCFG files with the Azure Service",
      "pos": [
        20184,
        20243
      ]
    },
    {
      "content": "Management API.",
      "pos": [
        20244,
        20259
      ]
    },
    {
      "content": "Once deployed, Azure, will provision role",
      "pos": [
        20260,
        20301
      ]
    },
    {
      "content": "instances in the data center (based upon the configuration data),",
      "pos": [
        20302,
        20367
      ]
    },
    {
      "content": "extract your application code from the package, copy it to the role",
      "pos": [
        20368,
        20435
      ]
    },
    {
      "content": "instances, and boot the instances.",
      "pos": [
        20436,
        20470
      ]
    },
    {
      "content": "Now, your code is up and running.",
      "pos": [
        20471,
        20504
      ]
    },
    {
      "content": "The figure below shows the CSPKG and CSCFG files you create on your",
      "pos": [
        20506,
        20573
      ]
    },
    {
      "content": "development computer.",
      "pos": [
        20574,
        20595
      ]
    },
    {
      "content": "The CSPKG file contains the CSDEF file and the",
      "pos": [
        20596,
        20642
      ]
    },
    {
      "content": "code for two roles.",
      "pos": [
        20643,
        20662
      ]
    },
    {
      "content": "After uploading the CSPKG and CSCFG files with the",
      "pos": [
        20663,
        20713
      ]
    },
    {
      "content": "Azure Service Management API, Azure creates the role",
      "pos": [
        20714,
        20766
      ]
    },
    {
      "content": "instances in the data center.",
      "pos": [
        20767,
        20796
      ]
    },
    {
      "content": "In this example, the CSCFG file indicated",
      "pos": [
        20797,
        20838
      ]
    },
    {
      "content": "that Azure should create three instances of role \\#1 and two",
      "pos": [
        20839,
        20899
      ]
    },
    {
      "content": "instances of Role \\#2.",
      "pos": [
        20900,
        20922
      ]
    },
    {
      "content": "image",
      "pos": [
        20926,
        20931
      ]
    },
    {
      "content": "For more information about deploying, upgrading, and reconfiguring your",
      "pos": [
        20937,
        21008
      ]
    },
    {
      "content": "roles, see the <bpt id=\"p1\">[</bpt>Deploying and Updating Azure Applications<ept id=\"p1\">][]</ept>",
      "pos": [
        21009,
        21069
      ]
    },
    {
      "content": "article.<ph id=\"ph1\">&lt;a id=\"Ref\" name=\"Ref\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>",
      "pos": [
        21070,
        21105
      ]
    },
    {
      "pos": [
        21110,
        21144
      ],
      "content": "<ph id=\"ph1\">&lt;a id=\"references\"&gt;</ph> <ph id=\"ph2\">&lt;/a&gt;</ph>References"
    },
    {
      "content": "Creating a Hosted Service for Azure",
      "pos": [
        21151,
        21186
      ]
    },
    {
      "content": "Managing Hosted Services in Azure",
      "pos": [
        21196,
        21229
      ]
    },
    {
      "content": "Migrating Applications to Azure",
      "pos": [
        21239,
        21270
      ]
    },
    {
      "content": "Configuring an Azure Application",
      "pos": [
        21280,
        21312
      ]
    },
    {
      "content": "Written by Jeffrey Richter (Wintellect)",
      "pos": [
        21426,
        21465
      ]
    }
  ],
  "content": "# Compute\n\nAzure enables you to deploy and monitor your application code\nrunning inside a Microsoft data center. When you create an application\nand run it on Azure, the code and configuration together is\ncalled an Azure hosted service. Hosted services are easy to\nmanage, scale up and down, reconfigure, and update with new versions of\nyour application's code. This article focuses on the Azure\nhosted service application model.<a id=\"compare\" name=\"compare\"></a>\n\n## Table of Contents<a id=\"_GoBack\" name=\"_GoBack\"></a>\n\n-   [Azure Application Model Benefits][]\n-   [Hosted Service Core Concepts][]\n-   [Hosted Service Design Considerations][]\n-   [Designing your Application for Scale][]\n-   [Hosted Service Definition and Configuration][]\n-   [The Service Definition File][]\n-   [The Service Configuration File][]\n-   [Creating and Deploying a Hosted Service][]\n-   [References][]\n\n## <a id=\"benefits\"> </a>Azure Application Model Benefits\n\nWhen you deploy your application as a hosted service, Azure\ncreates one or more virtual machines (VMs) that contain your\napplication's code, and boots the VMs on physical machines residing in\none of the Azure data centers. As client requests to your hosted\napplication enter the data center, a load balancer distributes these\nrequests equally to the VMs. While your application is hosted in \nAzure, it gets three key benefits:\n\n-   **High availability.** High availability means Azure ensures\n    that your application is running as much as possible and is able to\n    respond to client requests. If your application terminates (due to\n    an unhandled exception, for example), then Azure will detect\n    this, and it will automatically re-start your application. If the\n    machine your application is running on experiences some kind of\n    hardware failure, then Azure will also detect this and\n    automatically create a new VM on another working physical machine\n    and run your code from there. NOTE: In order for your application to\n    get Microsoft's Service Level Agreement of 99.95% available, you\n    must have at least two VMs running your application code. This\n    allows one VM to process client requests while Azure moves\n    your code from a failed VM to a new, good VM.\n\n-   **Scalability.** Azure lets you easily and dynamically\n    change the number of VMs running your application code to handle the\n    actual load being placed on your application. This allows you to\n    adjust your application to the workload that your customers are\n    placing on it while paying only for the VMs you need when you need\n    them. When you want to change the number of VMs, Azure\n    responds within minutes making it possible to dynamically change the\n    number of VMs running as often as desired.\n\n-   **Manageability.** Because Azure is a Platform as a Service\n    (PaaS) offering, it manages the infrastructure (the hardware itself,\n    electricity, and networking) required to keep these machines\n    running. Azure also manages the platform, ensuring an\n    up-to-date operating system with all the correct patches and\n    security updates, as well as component updates such as the .NET\n    Framework and Internet Information Server. Because all the VMs are\n    running Windows Server 2008, Azure provides additional\n    features such as diagnostic monitoring, remote desktop support,\n    firewalls, and certificate store configuration. All these features\n    are provided at no extra cost. In fact, when you run your\n    application in Azure, the Windows Server 2008 operating\n    system (OS) license is included. Since all of the VMs are running\n    Windows Server 2008, any code that runs on Windows Server 2008 works\n    just fine when running in Azure.\n\n## <a id=\"concepts\"> </a>Hosted Service Core Concepts\n\nWhen your application is deployed as a hosted service in Azure,\nit runs as one or more *roles.* A *role* simply refers to application\nfiles and configuration. You can define one or more roles for your\napplication, each with its own set of application files and\nconfiguration. For each role in your application, you can specify the\nnumber of VMs, or *role instances*, to run. The figure below show two\nsimple examples of an application modeled as a hosted service using\nroles and role instances.\n\n##### Figure 1: A single role with three instances (VMs) running in an Azure data center\n\n![image][0]\n\n##### Figure 2: Two roles, each with two instances (VMs), running in an Azure data center\n\n![image][1]\n\nRole instances typically process Internet client requests entering the\ndata center through what is called an *input endpoint*. A single role\ncan have 0 or more input endpoints. Each endpoint indicates a protocol\n(HTTP, HTTPS, or TCP) and a port. It is common to configure a role to\nhave two input endpoints: HTTP listening on port 80 and HTTPS listening\non port 443. The figure below shows an example of two different roles\nwith different input endpoints directing client requests to them.\n\n![image][2]\n\nWhen you create a hosted service in Azure, it is assigned a\npublicly addressable IP address that clients can use to access it. Upon\ncreating the hosted service you must also select a URL prefix that is\nmapped to that IP address. This prefix must be unique as you are\nessentially reserving the *prefix*.cloudapp.net URL so that no one else\ncan have it. Clients communicate with your role instances by using the\nURL. Usually, you will not distribute or publish the Azure\n*prefix*.cloudapp.net URL. Instead, you will purchase a DNS name from\nyour DNS registrar of choice and configure your DNS name to redirect\nclient requests to the Azure URL. For more details, see\n[Configuring a Custom Domain Name in Azure][].\n\n## <a id=\"considerations\"> </a>Hosted Service Design Considerations\n\nWhen designing an application to run in a cloud environment, there are\nseveral considerations to think about such as latency,\nhigh-availability, and scalability.\n\nDeciding where to locate your application code is an important\nconsideration when running a hosted service in Azure. It is\ncommon to deploy your application to data centers that are closest to\nyour clients to reduce latency and get the best performance possible.\nHowever, you might choose a data center closer to your company or closer\nto your data if you have some jurisdictional or legal concerns about\nyour data and where it resides. There are six data centers around the\nglobe capable of hosting your application code. The table below shows\nthe available locations:\n\n<table border=\"2\" cellspacing=\"0\" cellpadding=\"5\" style=\"border: 2px solid #000000;\">\n<tbody>\n<tr>\n<td style=\"width: 100px;\">\n**Country/Region**\n\n</td>\n<td style=\"width: 200px;\">\n**Sub-regions**\n\n</td>\n</tr>\n<tr>\n<td>\nUnited States\n\n</td>\n<td>\nSouth Central & North Central\n\n</td>\n</tr>\n<tr>\n<td>\nEurope\n\n</td>\n<td>\nNorth & West\n\n</td>\n</tr>\n<tr>\n<td>\nAsia\n\n</td>\n<td>\nSoutheast & East\n\n</td>\n</tr>\n</tbody>\n</table>\nWhen creating a hosted service, you select a sub-region indicating the\nlocation in which you want your code to execute.\n\nTo achieve high availability and scalability, it is critically important\nthat your application's data be kept in a central repository accessible\nto multiple role instances. To help with this, Azure offers\nseveral storage options such as blobs, tables, and SQL Database. Please see\nthe [Data Storage Offerings in Azure][] article for more\ninformation about these storage technologies. The figure below shows how\nthe load balancer inside the Azure data center distributes\nclient requests to different role instances all of which have access to\nthe same data storage.\n\n![image][3]\n\nUsually, you want to locate your application code and your data in the\nsame data center as this allows for low latency (better performance)\nwhen your application code accesses the data. In addition, you are not\ncharged for bandwidth when data is moved around within the same data\ncenter.\n\n## <a id=\"scale\"> </a>Designing your Application for Scale\n\nSometimes, you may want to take a single application (like a simple web\nsite) and have it hosted in Azure. But frequently, your\napplication may consist of several roles that all work together. For\nexample, in the figure below, there are two instances of the Website\nrole, three instances of the Order Processing role, and one instance of\nthe Report Generator role. These roles are all working together and the\ncode for all of them can be packaged together and deployed as a single\nunit up to Azure.\n\n![image][4]\n\nThe main reason to split an application into different roles each\nrunning on its own set of role instances (that is, VMs) is to scale the\nroles independently. For example, during the holiday season, many\ncustomers may be purchasing products from your company, so you might\nwant to increase the number of role instances running your Website role\nas well as the number of role instances running your Order Processing\nrole. After the holiday season, you may get a lot of products returned,\nso you may still need a lot of Website instances but fewer Order\nProcessing instances. During the rest of the year, you may only need a\nfew Website and Order Processing instances. Throughout all of this, you\nmay need only one Report Generator instance. The flexibility of\nrole-based deployments in Azure enables you to easily adapt your\napplication to your business needs.\n\nIt's common to have the role instances within your hosted service\ncommunicate with each other. For example, the website role accepts a\ncustomer's order but then it offloads the order processing to the Order\nProcessing role instances. The best way to pass work form one set of\nrole instances to another set of instances is using the queuing\ntechnology provided by Azure, either the Queue Service or\nService Bus Queues. The use of a queue is a critical part of the story\nhere. The queue allows the hosted service to scale its roles\nindependently allowing you to balance the workload against cost. If the\nnumber of messages in the queue increases over time, then you can scale\nup the number of Order Processing role instances. If the number of\nmessages in the queue decreases over time, then you can scale down the\nnumber of Order Processing role instances. This way, you are only paying\nfor the instances required to handle the actual workload.\n\nThe queue also provides reliability. When scaling down the number of\nOrder Processing role instances, Azure decides which instances\nto terminate. It may decide to terminate an instance that is in the\nmiddle of processing a queue message. However, because the message\nprocessing does not complete successfully, the message becomes visible\nagain to another Order Processing role instance that picks it up and\nprocesses it. Because of queue message visibility, messages are\nguaranteed to eventually get processed. The queue also acts as a load\nbalancer by effectively distributing its messages to any and all role\ninstances that request messages from it.\n\nFor the Website role instances, you can monitor the traffic coming into\nthem and decide to scale the number of them up or down as well. The\nqueue allows you to scale the number of Website role instances\nindependently of the Order Processing role instances. This is very\npowerful and gives you a lot of flexibility. Of course, if your\napplication consists of additional roles, you could add additional\nqueues as the conduit to communicate between them in order to leverage\nthe same scaling and cost benefits.\n\n## <a id=\"defandcfg\"> </a>Hosted Service Definition and Configuration\n\nDeploying a hosted service to Azure requires you to also have a\nservice definition file and a service configuration file. Both of these\nfiles are XML files, and they allow you to declaratively specify\ndeployment options for your hosted service. The service definition file\ndescribes all of the roles that make up your hosted service and how they\ncommunicate. The service configuration file describes the number of\ninstances for each role and settings used to configure each role\ninstance.\n\n## <a id=\"def\"> </a>The Service Definition File\n\nAs I mentioned earlier, the service definition (CSDEF) file is an XML\nfile that describes the various roles that make up your complete\napplication. The complete schema for the XML file can be found here:\n[http://msdn.microsoft.com/library/windowsazure/ee758711.aspx][].\nThe CSDEF file contains a WebRole or WorkerRole element for each role\nthat you want in your application. Deploying a role as a web role (using\nthe WebRole element) means that the code will run on a role instance\ncontaining Windows Server 2008 and Internet Information Server (IIS).\nDeploying a role as a worker role (using the WorkerRole element) means\nthat the role instance will have Windows Server 2008 on it (IIS will not\nbe installed).\n\nYou can certainly create and deploy a worker role that uses some other\nmechanism to listen for incoming web requests (for example, your code\ncould create and use a .NET HttpListener). Since the role instances are\nall running Windows Server 2008, your code can perform any operations\nthat are normally available to an application running on Windows Server\n2008.\n\nFor each role, you indicate the desired VM size that instances of that\nrole should use. The table below shows the various VM sizes available\ntoday and the attributes of each:\n\n<table border=\"2\" cellspacing=\"0\" cellpadding=\"5\" style=\"border: 2px solid #000000;\">\n<tbody>\n<tr align=\"left\" valign=\"top\">\n<td>\n**VM Size**\n\n</td>\n<td>\n**CPU**\n\n</td>\n<td>\n**RAM**\n\n</td>\n<td>\n**Disk**\n\n</td>\n<td>\n**Peak  \nNetwork I/O**\n\n</td>\n</tr>\n<tr align=\"left\" valign=\"top\">\n<td>\n**Extra Small**\n\n</td>\n<td>\n1 x 1.0 GHz\n\n</td>\n<td>\n768 MB\n\n</td>\n<td>\n20GB\n\n</td>\n<td>\n\\~5 Mbps\n\n</td>\n</tr>\n<tr align=\"left\" valign=\"top\">\n<td>\n**Small**\n\n</td>\n<td>\n1 x 1.6 GHz\n\n</td>\n<td>\n1.75 GB\n\n</td>\n<td>\n225GB\n\n</td>\n<td>\n\\~100 Mbps\n\n</td>\n</tr>\n<tr align=\"left\" valign=\"top\">\n<td>\n**Medium**\n\n</td>\n<td>\n2 x 1.6 GHz\n\n</td>\n<td>\n3.5 GB\n\n</td>\n<td>\n490GB\n\n</td>\n<td>\n\\~200 Mbps\n\n</td>\n</tr>\n<tr align=\"left\" valign=\"top\">\n<td>\n**Large**\n\n</td>\n<td>\n4 x 1.6 GHz\n\n</td>\n<td>\n7 GB\n\n</td>\n<td>\n1TB\n\n</td>\n<td>\n\\~400 Mbps\n\n</td>\n</tr>\n<tr align=\"left\" valign=\"top\">\n<td>\n**Extra Large**\n\n</td>\n<td>\n8 x 1.6 GHz\n\n</td>\n<td>\n14 GB\n\n</td>\n<td>\n2TB\n\n</td>\n<td>\n\\~800 Mbps\n\n</td>\n</tr>\n</tbody>\n</table>\nYou are charged hourly for each VM you use as a role instance and you\nare also charged for any data that your role instances send outside the\ndata center. You are not charged for data entering the data center. For\nmore information, see [Azure Pricing][]. In general, it is\nadvisable to use many small role instances as opposed to a few large\ninstances so that your application is more resilient to failure. After\nall, the fewer role instances you have, the more disastrous a failure in\none of them is to your overall application. Also, as mentioned before,\nyou must deploy at least two instances for each role in order to get the\n99.95% service level agreement Microsoft provides.\n\nThe service definition (CSDEF) file is also where you would specify many\nattributes about each role in your application. Here are some of the\nmore useful items available to you:\n\n-   **Certificates**. You use certificates for encrypting data or if\n    your web service supports SSL. Any certificates need to be uploaded\n    to Azure. For more information, see [Managing Certificates\n    in Azure][]. This XML setting installs previously-uploaded\n    certificates into the role instance's certificate store so that they\n    are usable by your application code.\n\n-   **Configuration Setting Names**. For values that you want your\n    application(s) to read while running on a role instance. The actual\n    value of the configuration settings is set in the service\n    configuration (CSCFG) file which can be updated at any time without\n    requiring you to redeploy your code. In fact, you can code your\n    applications in such a way to detect the changed configuration\n    values without incurring any downtime.\n\n-   **Input Endpoints**. Here you specify any HTTP, HTTPS, or TCP\n    endpoints (with ports) that you want to expose to the outside world\n    via your *prefix*.cloadapp.net URL. When Azure deploys your\n    role, it will configure the firewall on the role instance\n    automatically.\n\n-   **Internal Endpoints**. Here you specify any HTTP or TCP endpoints\n    that you want exposed to other role instances that are deployed as\n    part of your application. Internal endpoints allow all the role\n    instances within your application to talk to each other but are not\n    accessible to any role instances that are outside your application.\n\n-   **Import Modules**. These optionally install useful components on\n    your role instances. Components exist for diagnostic monitoring,\n    remote desktop, and Azure Connect (which allows your role\n    instance to access on-premises resources through a secure channel).\n\n-   **Local Storage**. This allocates a subdirectory on the role\n    instance for your application to use. It is described in more detail\n    in the [Data Storage Offerings in Azure][] article.\n\n-   **Startup Tasks**. Startup tasks give you a way to install\n    prerequisite components on a role instance as it boots up. The tasks\n    can run elevated as an administrator if required.\n\n## <a id=\"cfg\"> </a>The Service Configuration File\n\nThe service configuration (CSCFG) file is an XML file that describes\nsettings that can be changed without redeploying your application. The\ncomplete schema for the XML file can be found here:\n[http://msdn.microsoft.com/library/windowsazure/ee758710.aspx][].\nThe CSCFG file contains a Role element for each role in your\napplication. Here are some of the items you can specify in the CSCFG\nfile:\n\n-   **OS Version**. This attribute allows you to select the operating\n    system (OS) version you want used for all the role instances running\n    your application code. This OS is known as the *guest OS*, and each\n    new version includes the latest security patches and updates\n    available at the time the guest OS is released. If you set the\n    osVersion attribute value to \"\\*\", then Azure automatically\n    updates the guest OS on each of your role instances as new guest OS\n    versions become available. However, you can opt out of automatic\n    updates by selecting a specific guest OS version. For example,\n    setting the osVersion attribute to a value of\n    \"WA-GUEST-OS-2.8\\_201109-01\" causes all your role instances to get\n    what is described on this web page:\n    [http://msdn.microsoft.com/library/hh560567.aspx][]. For more\n    information about guest OS versions, see [Managing Upgrades to the\n    Azure Guests OS].\n\n-   **Instances**. This element's value indicates the number of role\n    instances you want provisioned running the code for a particular\n    role. Since you can upload a new CSCFG file to Azure\n    (without redeploying your application), it is trivially simple to\n    change the value for this element and upload a new CSCFG file to\n    dynamically increase or decrease the number of role instances\n    running your application code. This allows you to easily scale your\n    application up or down to meet actual workload demands while also\n    controlling how much you are charged for running the role instances.\n\n-   **Configuration Setting Values**. This element indicates values for\n    settings (as defined in the CSDEF file). Your role can read these\n    values while it is running. These configuration settings values are\n    typically used for connection strings to SQL Database or to \n    Azure Storage, but they can be used for any purpose you desire.\n\n## <a id=\"hostedservices\"> </a>Creating and Deploying a Hosted Service\n\nCreating a hosted service requires that you first go to the [Azure Management Portal] and provision a hosted service by specifying\na DNS prefix and the data center you ultimately want your code running\nin. Then in your development environment, you create your service\ndefinition (CSDEF) file, build your application code and package (zip)\nall these files into a service package (CSPKG) file. You must also\nprepare your service configuration (CSCFG) file. To deploy your role,\nyou upload the CSPKG and CSCFG files with the Azure Service\nManagement API. Once deployed, Azure, will provision role\ninstances in the data center (based upon the configuration data),\nextract your application code from the package, copy it to the role\ninstances, and boot the instances. Now, your code is up and running.\n\nThe figure below shows the CSPKG and CSCFG files you create on your\ndevelopment computer. The CSPKG file contains the CSDEF file and the\ncode for two roles. After uploading the CSPKG and CSCFG files with the\nAzure Service Management API, Azure creates the role\ninstances in the data center. In this example, the CSCFG file indicated\nthat Azure should create three instances of role \\#1 and two\ninstances of Role \\#2.\n\n![image][5]\n\nFor more information about deploying, upgrading, and reconfiguring your\nroles, see the [Deploying and Updating Azure Applications][]\narticle.<a id=\"Ref\" name=\"Ref\"></a>\n\n## <a id=\"references\"> </a>References\n\n-   [Creating a Hosted Service for Azure][]\n\n-   [Managing Hosted Services in Azure][]\n\n-   [Migrating Applications to Azure][]\n\n-   [Configuring an Azure Application][]\n\n<div style=\"width: 700px; border-top: solid; margin-top: 5px; padding-top: 5px; border-top-width: 1px;\">\n\n<p>Written by Jeffrey Richter (Wintellect)</p>\n\n</div>\n\n  [Azure Application Model Benefits]: #benefits\n  [Hosted Service Core Concepts]: #concepts\n  [Hosted Service Design Considerations]: #considerations\n  [Designing your Application for Scale]: #scale\n  [Hosted Service Definition and Configuration]: #defandcfg\n  [The Service Definition File]: #def\n  [The Service Configuration File]: #cfg\n  [Creating and Deploying a Hosted Service]: #hostedservices\n  [References]: #references\n  [0]: ./media/application-model/application-model-3.jpg\n  [1]: ./media/application-model/application-model-4.jpg\n  [2]: ./media/application-model/application-model-5.jpg\n  [Configuring a Custom Domain Name in Azure]: http://www.windowsazure.com/develop/net/common-tasks/custom-dns/\n  [Data Storage Offerings in Azure]: http://www.windowsazure.com/develop/net/fundamentals/cloud-storage/\n  [3]: ./media/application-model/application-model-6.jpg\n  [4]: ./media/application-model/application-model-7.jpg\n  \n  [Azure Pricing]: http://www.windowsazure.com/pricing/calculator/\n  [Managing Certificates in Azure]: http://msdn.microsoft.com/library/windowsazure/gg981929.aspx\n  [http://msdn.microsoft.com/library/windowsazure/ee758710.aspx]: http://msdn.microsoft.com/library/windowsazure/ee758710.aspx\n  [http://msdn.microsoft.com/library/hh560567.aspx]: http://msdn.microsoft.com/library/hh560567.aspx\n  [Managing Upgrades to the Azure Guests OS]: http://msdn.microsoft.com/library/ee924680.aspx\n  [Azure Management Portal]: http://manage.windowsazure.com/\n  [5]: ./media/application-model/application-model-8.jpg\n  [Deploying and Updating Azure Applications]: http://www.windowsazure.com/develop/net/fundamentals/deploying-applications/\n  [Creating a Hosted Service for Azure]: http://msdn.microsoft.com/library/gg432967.aspx\n  [Managing Hosted Services in Azure]: http://msdn.microsoft.com/library/gg433038.aspx\n  [Migrating Applications to Azure]: http://msdn.microsoft.com/library/gg186051.aspx\n  [Configuring an Azure Application]: http://msdn.microsoft.com/library/windowsazure/ee405486.aspx\n"
}